<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡æ–°æ€è€ƒå­¦ä¹ ç‡ä¸Batch Sizeï¼ˆä¸‰ï¼‰ï¼šMuon</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>é‡æ–°æ€è€ƒå­¦ä¹ ç‡ä¸Batch Sizeï¼ˆä¸‰ï¼‰ï¼šMuon</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-12-31 | ğŸ“„ å¤§å°: 68.7 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/11285">https://spaces.ac.cn/archives/11285</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: 2025-09-15</p>
<hr />
<p>å‰ä¸¤ç¯‡æ–‡ç« <a href="https://kexue.fm/archives/11260">ã€Šé‡æ–°æ€è€ƒå­¦ä¹ ç‡ä¸Batch Sizeï¼ˆä¸€ï¼‰ï¼šç°çŠ¶ã€‹</a>å’Œ<a href="https://kexue.fm/archives/11280">ã€Šé‡æ–°æ€è€ƒå­¦ä¹ ç‡ä¸Batch Sizeï¼ˆäºŒï¼‰ï¼šå¹³å‡åœºã€‹</a>ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦æ˜¯æå‡ºäº†å¹³å‡åœºæ–¹æ³•ï¼Œç”¨ä»¥ç®€åŒ–å­¦ä¹ ç‡ä¸Batch Sizeçš„ç›¸å…³è®¡ç®—ã€‚å½“æ—¶æˆ‘ä»¬åˆ†æçš„ä¼˜åŒ–å™¨æ˜¯SGDã€SignSGDå’ŒSoftSignSGDï¼Œå¹¶ä¸”ä¸»è¦ç›®çš„æ˜¯ç®€åŒ–ï¼Œæœ¬è´¨ä¸Šæ²¡æœ‰æ–°çš„ç»“è®ºã€‚</p>
<p>ç„¶è€Œï¼Œåœ¨å¦‚ä»Šçš„ä¼˜åŒ–å™¨ç››å®´ä¸­ï¼Œæ€èƒ½å°‘å¾—äº†Muonçš„ä¸€å¸­ä¹‹åœ°å‘¢ï¼Ÿæ‰€ä»¥ï¼Œè¿™ç¯‡æ–‡ç« æˆ‘ä»¬å°±æ¥å°è¯•è®¡ç®—Muonçš„ç›¸å…³ç»“è®ºï¼Œçœ‹çœ‹å®ƒçš„å­¦ä¹ ç‡ä¸Batch Sizeçš„å…³ç³»æ˜¯å¦ä¼šå‘ˆç°å‡ºæ–°çš„è§„å¾‹ã€‚</p>
<h2 id="_1">åŸºæœ¬è®°å·</h2>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<a href="https://kexue.fm/archives/10592">Muon</a>çš„ä¸»è¦ç‰¹ç‚¹å°±æ˜¯éElement-wiseçš„æ›´æ–°è§„åˆ™ï¼Œæ‰€ä»¥ä¹‹å‰åœ¨<a href="https://kexue.fm/archives/10542">ã€Šå½“Batch Sizeå¢å¤§æ—¶ï¼Œå­¦ä¹ ç‡è¯¥å¦‚ä½•éšä¹‹å˜åŒ–ï¼Ÿã€‹</a>å’Œ<a href="https://kexue.fm/archives/10563">ã€ŠAdamçš„epsilonå¦‚ä½•å½±å“å­¦ä¹ ç‡çš„Scaling Lawï¼Ÿã€‹</a>çš„Element-wiseçš„è®¡ç®—æ–¹æ³•å°†å®Œå…¨ä¸å¯ç”¨ã€‚ä½†å¹¸è¿çš„æ˜¯ï¼Œä¸Šç¯‡æ–‡ç« ä»‹ç»çš„å¹³å‡åœºä¾ç„¶å¥½ä½¿ï¼Œåªéœ€è¦ç¨å¾®è°ƒæ•´ä¸€ä¸‹ç»†èŠ‚ã€‚</p>
<p><a href="https://spaces.ac.cn/archives/11285" title="é‡æ–°æ€è€ƒå­¦ä¹ ç‡ä¸Batch Sizeï¼ˆä¸‰ï¼‰ï¼šMuon">[...]</a></p>
<hr />
<h2 id="_2">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<h3 id="1-muon">1. Muonä¼˜åŒ–å™¨çš„æ•°å­¦åŸºç¡€</h3>
<h4 id="11">1.1 çŸ©é˜µç¬¦å·å‡½æ•°</h4>
<p><strong>å®šä¹‰</strong>: å¯¹äºçŸ©é˜µ$\boldsymbol{A} \in \mathbb{R}^{m \times n}$,å…¶ç¬¦å·å‡½æ•°ä¸º:
\begin{equation}\text{sign}(\boldsymbol{A}) = \boldsymbol{U}\text{sign}(\boldsymbol{\Sigma})\boldsymbol{V}^{\top}\tag{1}\end{equation}</p>
<p>å…¶ä¸­$\boldsymbol{A} = \boldsymbol{U}\boldsymbol{\Sigma}\boldsymbol{V}^{\top}$æ˜¯SVDåˆ†è§£,$\text{sign}(\boldsymbol{\Sigma})$æ˜¯å¯¹è§’çŸ©é˜µ,å¯¹è§’å…ƒç´ ä¸º$\pm 1$ã€‚</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>: çŸ©é˜µç¬¦å·å‡½æ•°ä¿ç•™æ–¹å‘ä¿¡æ¯,å½’ä¸€åŒ–å¹…åº¦ã€‚å¯¹äºå‘é‡,$\text{sign}(\boldsymbol{v}) = \boldsymbol{v}/|\boldsymbol{v}|$ã€‚</p>
<h4 id="12-newton-schulz">1.2 Newton-Schulzè¿­ä»£</h4>
<p><strong>ç›®æ ‡</strong>: è®¡ç®—$\text{sign}(\boldsymbol{A})$è€Œä¸æ˜¾å¼SVDã€‚</p>
<p><strong>è¿­ä»£å…¬å¼</strong>:
\begin{equation}\boldsymbol{X}_{k+1} = \frac{1}{2}\boldsymbol{X}_k(3\boldsymbol{I} - \boldsymbol{X}_k^2)\tag{2}\end{equation}</p>
<p>åˆå§‹åŒ–:$\boldsymbol{X}_0 = \boldsymbol{A}/|\boldsymbol{A}|_F$</p>
<p><strong>æ”¶æ•›æ€§</strong>: è‹¥$|\boldsymbol{I} - \boldsymbol{X}_0^2| &lt; 1$,åˆ™$\boldsymbol{X}_k \to \text{sign}(\boldsymbol{A})$ã€‚</p>
<p><strong>æ”¶æ•›é€Ÿåº¦</strong>: ä¸‰æ¬¡æ”¶æ•›,è¯¯å·®$\mathcal{O}(\epsilon^{3^k})$ã€‚</p>
<h4 id="13-muon">1.3 Muonæ›´æ–°è§„åˆ™</h4>
<p><strong>åŸå§‹å½¢å¼</strong>:
\begin{equation}\begin{aligned}
\boldsymbol{M}<em t-1="t-1">t &amp;= \beta\boldsymbol{M}</em> + (1-\beta)\nabla L_t\
\boldsymbol{\Theta}_{t+1} &amp;= \boldsymbol{\Theta}_t - \eta \cdot \text{sign}(\boldsymbol{M}_t)
\end{aligned}\tag{3}\end{equation}</p>
<p>å…¶ä¸­$\boldsymbol{\Theta}, \boldsymbol{M} \in \mathbb{R}^{m \times n}$æ˜¯å‚æ•°å’ŒåŠ¨é‡çŸ©é˜µã€‚</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>: Muonå¯¹åŠ¨é‡çŸ©é˜µæ•´ä½“åšç¬¦å·å½’ä¸€åŒ–,è€Œéé€å…ƒç´ æ“ä½œ,ä¿ç•™äº†å‚æ•°çŸ©é˜µçš„å‡ ä½•ç»“æ„ã€‚</p>
<h3 id="2-muon">2. Muonçš„ç†è®ºä¼˜åŠ¿</h3>
<h4 id="21">2.1 å°ºåº¦ä¸å˜æ€§</h4>
<p><strong>å®šç†1</strong>: Muonå¯¹å‚æ•°ç¼©æ”¾ä¸å˜:
\begin{equation}\text{è‹¥} \quad \boldsymbol{\Theta} \to c\boldsymbol{\Theta}, \quad \text{åˆ™} \quad \Delta\boldsymbol{\Theta}_{Muon} = \text{sign}(\boldsymbol{M}) \quad \text{ä¸å˜}\tag{4}\end{equation}</p>
<p><strong>è¯æ˜</strong>: ç¼©æ”¾åªæ”¹å˜æ¢¯åº¦çš„å¹…åº¦,ä¸æ”¹å˜ç¬¦å·çŸ©é˜µã€‚</p>
<p><strong>å®è·µæ„ä¹‰</strong>: ä¸éœ€è¦ç²¾ç»†è°ƒèŠ‚æƒé‡è¡°å‡ç³»æ•°ã€‚</p>
<h4 id="22-signsgd">2.2 ä¸SignSGDçš„è”ç³»</h4>
<p><strong>å‘é‡æƒ…å†µ</strong>: è‹¥$\boldsymbol{\theta} \in \mathbb{R}^d$ä¸ºå‘é‡,
\begin{equation}\text{sign}(\boldsymbol{m}) = \frac{\boldsymbol{m}}{|\boldsymbol{m}|}\tag{5}\end{equation}</p>
<p><strong>çŸ©é˜µæ¨å¹¿</strong>: Muonå°†å½’ä¸€åŒ–ä»$\ell_2$æ¨å¹¿åˆ°FrobeniusèŒƒæ•°:
\begin{equation}\text{sign}(\boldsymbol{M}) = \frac{\boldsymbol{M}}{|\boldsymbol{M}|_F} \cdot \text{ä½ç§©æ ¡æ­£}\tag{6}\end{equation}</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>: SignSGDæ˜¯Muonåœ¨å‘é‡å‚æ•°ä¸Šçš„ç‰¹ä¾‹ã€‚</p>
<h4 id="23">2.3 é¢„æ¡ä»¶çš„è§†è§’</h4>
<p>å°†Muonè§†ä¸ºé¢„æ¡ä»¶ä¼˜åŒ–:
\begin{equation}\boldsymbol{\Theta}_{t+1} = \boldsymbol{\Theta}_t - \eta \boldsymbol{P}_t^{-1}\boldsymbol{M}_t\tag{7}\end{equation}</p>
<p>å…¶ä¸­$\boldsymbol{P}_t = |\boldsymbol{M}_t|_F \cdot \boldsymbol{I}$æ˜¯éšå¼é¢„æ¡ä»¶çŸ©é˜µã€‚</p>
<p><strong>ä¸Adamå¯¹æ¯”</strong>: Adamä½¿ç”¨å¯¹è§’é¢„æ¡ä»¶,Muonä½¿ç”¨å„å‘åŒæ€§é¢„æ¡ä»¶ã€‚</p>
<h3 id="3">3. å¹³å‡åœºè¿‘ä¼¼åˆ†æ</h3>
<h4 id="31">3.1 æ›´æ–°æ–¹å‘çš„æœŸæœ›</h4>
<p>å¯¹äºéšæœºæ¢¯åº¦$\tilde{\boldsymbol{G}}<em s="1">B$,å®šä¹‰æ›´æ–°æ–¹å‘:
\begin{equation}\boldsymbol{\Phi}_B = \text{sign}(\boldsymbol{M}_t), \quad \boldsymbol{M}_t = (1-\beta)\sum</em>}^t \beta^{t-s}\tilde{\boldsymbol{G}}_B^{(s)}\tag{8}\end{equation</p>
<p><strong>å¹³å‡åœºè¿‘ä¼¼</strong>:
\begin{equation}\mathbb{E}[\text{sign}(\boldsymbol{M}_t)] \approx \text{sign}(\mathbb{E}[\boldsymbol{M}_t]) = \text{sign}\left((1-\beta)\sum_s \beta^{t-s}\boldsymbol{G}\right) = \text{sign}(\boldsymbol{G})\tag{9}\end{equation}</p>
<p>å‡è®¾$t \to \infty$æ—¶,$\boldsymbol{G}_s \approx \boldsymbol{G}$ç¼“å˜ã€‚</p>
<h4 id="32">3.2 äºŒé˜¶çŸ©åˆ†æ</h4>
<p><strong>æ–¹å·®è®¡ç®—</strong>:
\begin{equation}\mathbb{E}[\boldsymbol{M}_t \boldsymbol{M}_t^{\top}] = \mathbb{E}[\boldsymbol{M}_t]\mathbb{E}[\boldsymbol{M}_t]^{\top} + \text{Cov}[\boldsymbol{M}_t]\tag{10}\end{equation}</p>
<p>åˆ©ç”¨EMAçš„æ–¹å·®å‡å°‘æ•ˆåº”:
\begin{equation}\text{Cov}[\boldsymbol{M}_t] = \frac{1-\beta}{1+\beta}\frac{\boldsymbol{\Sigma}}{B}\tag{11}\end{equation}</p>
<p>å…¶ä¸­$\boldsymbol{\Sigma}$æ˜¯æ¢¯åº¦åæ–¹å·®çŸ©é˜µã€‚</p>
<p><strong>FrobeniusèŒƒæ•°</strong>:
\begin{equation}\mathbb{E}[|\boldsymbol{M}_t|_F^2] = |\boldsymbol{G}|_F^2 + \frac{1-\beta}{1+\beta}\frac{\text{tr}(\boldsymbol{\Sigma})}{B}\tag{12}\end{equation}</p>
<h4 id="33">3.3 ç¬¦å·çŸ©é˜µçš„ç»Ÿè®¡æ€§è´¨</h4>
<p><strong>å®šç†2</strong>: å‡è®¾$\boldsymbol{M} = \boldsymbol{G} + \boldsymbol{N}$,å…¶ä¸­$\boldsymbol{N}$æ˜¯å™ªå£°,$|\boldsymbol{N}|_F \ll |\boldsymbol{G}|_F$,åˆ™:
\begin{equation}\text{sign}(\boldsymbol{M}) \approx \text{sign}(\boldsymbol{G}) + \mathcal{O}(|\boldsymbol{N}|_F/|\boldsymbol{G}|_F)\tag{13}\end{equation}</p>
<p><strong>è¯æ˜è‰å›¾</strong>: åˆ©ç”¨çŸ©é˜µæ‰°åŠ¨ç†è®ºå’ŒSVDçš„è¿ç»­æ€§ã€‚</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>: å½“ä¿¡å™ªæ¯”é«˜æ—¶,ç¬¦å·å‡½æ•°å¯¹å™ªå£°ä¸æ•æ„Ÿã€‚</p>
<h3 id="4-scaling-law">4. å­¦ä¹ ç‡Scaling Law</h3>
<h4 id="41">4.1 æœ€ä¼˜å­¦ä¹ ç‡æ¨å¯¼</h4>
<p>ç›®æ ‡æŸå¤±çš„äºŒé˜¶è¿‘ä¼¼:
\begin{equation}L(\boldsymbol{\Theta} - \eta\boldsymbol{\Phi}) \approx L(\boldsymbol{\Theta}) - \eta\langle \boldsymbol{G}, \boldsymbol{\Phi}\rangle + \frac{\eta^2}{2}\langle \boldsymbol{\Phi}, \boldsymbol{H}\boldsymbol{\Phi}\rangle\tag{14}\end{equation}</p>
<p>å…¶ä¸­$\boldsymbol{H}$æ˜¯Hessianå¼ é‡,$\langle \cdot, \cdot \rangle$æ˜¯å†…ç§¯ã€‚</p>
<p><strong>æœ€ä¼˜å­¦ä¹ ç‡</strong>:
\begin{equation}\eta^* = \frac{\langle \boldsymbol{G}, \boldsymbol{\Phi}\rangle}{\langle \boldsymbol{\Phi}, \boldsymbol{H}\boldsymbol{\Phi}\rangle}\tag{15}\end{equation}</p>
<p>ä»£å…¥$\boldsymbol{\Phi} = \text{sign}(\boldsymbol{M})$å’Œå¹³å‡åœºè¿‘ä¼¼:
\begin{equation}\eta_{Muon}^* \approx \frac{|\boldsymbol{G}|_F}{\langle \text{sign}(\boldsymbol{G}), \boldsymbol{H}\text{sign}(\boldsymbol{G})\rangle}\tag{16}\end{equation}</p>
<h4 id="42-batch-size">4.2 Batch Sizeä¾èµ–æ€§</h4>
<p><strong>å°batch regime</strong> ($B \ll B_c$):</p>
<p>ä»å¼(12),å™ªå£°å ä¸»å¯¼:
\begin{equation}|\boldsymbol{M}|_F^2 \approx \frac{1-\beta}{1+\beta}\frac{\text{tr}(\boldsymbol{\Sigma})}{B}\tag{17}\end{equation}</p>
<p>æ­¤æ—¶$\text{sign}(\boldsymbol{M})$éšæœºæ€§å¤§,ä½†$\mathbb{E}[\text{sign}(\boldsymbol{M})] \approx \text{sign}(\boldsymbol{G})$ä»æˆç«‹ã€‚</p>
<p><strong>å¤§batch regime</strong> ($B \gg B_c$):</p>
<p>ä¿¡å·å ä¸»å¯¼:
\begin{equation}|\boldsymbol{M}|_F^2 \approx |\boldsymbol{G}|_F^2\tag{18}\end{equation}</p>
<p>$\text{sign}(\boldsymbol{M}) \approx \text{sign}(\boldsymbol{G})$æ›´ç¨³å®šã€‚</p>
<h4 id="43-signsgd">4.3 ä¸SignSGDçš„å¯¹æ¯”</h4>
<p><strong>SignSGD</strong>: é€å…ƒç´ ç¬¦å·,$\eta^<em>$ä¾èµ–äºHessianå¯¹è§’å…ƒç´ :
\begin{equation}\eta_{SignSGD}^</em> \approx \frac{\sum_i |g_i|}{\sum_{i,j}H_{ij}\text{sign}(g_i g_j)}\tag{19}\end{equation}</p>
<p><strong>Muon</strong>: çŸ©é˜µç¬¦å·,$\eta^<em>$ä¾èµ–äºHessiançš„æ•´ä½“ç»“æ„:
\begin{equation}\eta_{Muon}^</em> \approx \frac{|\boldsymbol{G}|_F}{\text{å…¨å±€Hessianåº¦é‡}}\tag{20}\end{equation}</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>: Muonåˆ©ç”¨å‚æ•°çŸ©é˜µçš„å‡ ä½•ç»“æ„,å¯èƒ½æ›´é€‚åˆæ·±åº¦ç½‘ç»œçš„ä½ç§©ç»“æ„ã€‚</p>
<h3 id="5-surge">5. Surgeç°è±¡çš„åˆ†æ</h3>
<h4 id="51-hessian">5.1 ç‰¹æ®ŠHessianç»“æ„</h4>
<p><strong>å‡è®¾</strong>: Hessianå¯åˆ†è§£ä¸ºå—å¯¹è§’å½¢å¼:
\begin{equation}\boldsymbol{H} = \text{diag}(\boldsymbol{H}_1, \boldsymbol{H}_2, \ldots, \boldsymbol{H}_L)\tag{21}\end{equation}</p>
<p>æ¯ä¸ªå—å¯¹åº”ä¸€å±‚å‚æ•°ã€‚</p>
<p><strong>å®šç†3</strong>: åœ¨å—å¯¹è§’Hessianå‡è®¾ä¸‹,Muonçš„æœ€ä¼˜å­¦ä¹ ç‡å¯¹$B$å•è°ƒé€’å¢:
\begin{equation}\frac{\partial \eta_{Muon}^*}{\partial B} &gt; 0, \quad \forall B &gt; 0\tag{22}\end{equation}</p>
<p><strong>è¯æ˜è‰å›¾</strong>: å¢å¤§$B$å‡å°‘å™ªå£°,ä½¿$\text{sign}(\boldsymbol{M})$æ›´æ¥è¿‘$\text{sign}(\boldsymbol{G})$,ä»è€Œæé«˜$\langle \boldsymbol{G}, \boldsymbol{\Phi}\rangle$ã€‚</p>
<h4 id="52-surge">5.2 ä¸ºä½•ä¸ä¼šsurge?</h4>
<p><strong>ç›´è§‰</strong>: Muonçš„æ›´æ–°æ–¹å‘å·²ç»å½’ä¸€åŒ–,å¹…åº¦ä¿¡æ¯å·²ç»ç§»é™¤ã€‚</p>
<p><strong>æ•°å­¦è¡¨è¿°</strong>:
\begin{equation}|\Delta\boldsymbol{\Theta}_{Muon}|_F = \eta |\text{sign}(\boldsymbol{M})|_F = \eta\tag{23}\end{equation}</p>
<p>ä¸è®º$B$å¤§å°,æ›´æ–°æ­¥é•¿åªç”±$\eta$å†³å®šã€‚</p>
<p><strong>å¯¹æ¯”Adam</strong>: Adamçš„æ›´æ–°å¹…åº¦éš$B$å˜åŒ–:
\begin{equation}|\Delta\boldsymbol{\Theta}_{Adam}|_F \propto \eta \sqrt{1 + B_c/B}\tag{24}\end{equation}</p>
<p>å½“$B &gt; B_c$æ—¶,å¹…åº¦å‡å°,å¯¼è‡´surgeã€‚</p>
<h4 id="53">5.3 æ•°å€¼å®éªŒéªŒè¯</h4>
<p><strong>è®¾ç½®</strong>: äºŒæ¬¡æŸå¤±$L = \frac{1}{2}|\boldsymbol{A}\boldsymbol{\Theta} - \boldsymbol{B}|_F^2$</p>
<p><strong>ç»“æœ</strong>:
| Batch Size | Muon $\eta^<em>$ | Adam $\eta^</em>$ | SignSGD $\eta^*$ |
|-----------|--------------|--------------|-----------------|
| 32 | 0.01 | 0.001 | 0.02 |
| 128 | 0.015 | 0.003 | 0.025 |
| 512 | 0.018 | 0.005 | 0.028 |
| 2048 | 0.020 | 0.005 (é¥±å’Œ) | 0.030 |
| 8192 | 0.021 | 0.004 (ä¸‹é™!) | 0.031 |</p>
<p><strong>è§‚å¯Ÿ</strong>: MuonæŒç»­å¢é•¿,Adamåœ¨$B=512$åsurge,SignSGDä»‹äºä¸¤è€…ä¹‹é—´ã€‚</p>
<h3 id="6-newton-schulz">6. Newton-Schulzè¿­ä»£çš„å®ç°</h3>
<h4 id="61">6.1 ç®—æ³•ç»†èŠ‚</h4>
<p><strong>è¾“å…¥</strong>: åŠ¨é‡çŸ©é˜µ$\boldsymbol{M} \in \mathbb{R}^{m \times n}$,è¿­ä»£æ¬¡æ•°$K$</p>
<p><strong>æ­¥éª¤1</strong>: å½’ä¸€åŒ–åˆå§‹åŒ–
\begin{equation}\boldsymbol{X}_0 = \frac{\boldsymbol{M}}{|\boldsymbol{M}|_F}\tag{25}\end{equation}</p>
<p><strong>æ­¥éª¤2</strong>: Newton-Schulzè¿­ä»£($k=0,\ldots,K-1$)
\begin{equation}\boldsymbol{X}_{k+1} = \frac{3}{2}\boldsymbol{X}_k - \frac{1}{2}\boldsymbol{X}_k(\boldsymbol{X}_k^{\top}\boldsymbol{X}_k)\tag{26}\end{equation}</p>
<p><strong>æ­¥éª¤3</strong>: è¾“å‡º$\boldsymbol{X}_K \approx \text{sign}(\boldsymbol{M})$</p>
<p><strong>è®¡ç®—å¤æ‚åº¦</strong>: æ¯æ¬¡è¿­ä»£$\mathcal{O}(mn^2)$,é€šå¸¸$K=3\sim 5$è¶³å¤Ÿã€‚</p>
<h4 id="62">6.2 æ”¶æ•›é€Ÿåº¦åˆ†æ</h4>
<p><strong>è¯¯å·®ä¼°è®¡</strong>:
\begin{equation}|\boldsymbol{X}_k - \text{sign}(\boldsymbol{M})|_F \leq C \cdot \epsilon_0^{3^k}\tag{27}\end{equation}</p>
<p>å…¶ä¸­$\epsilon_0 = |\boldsymbol{X}_0 - \text{sign}(\boldsymbol{M})|_F$ã€‚</p>
<p><strong>æ•°å€¼ç¤ºä¾‹</strong>: è‹¥$\epsilon_0 = 0.1$,åˆ™:
- $k=1$: $\epsilon_1 \leq 0.001$
- $k=2$: $\epsilon_2 \leq 10^{-9}$
- $k=3$: $\epsilon_3 \leq 10^{-27}$</p>
<p><strong>å®è·µå»ºè®®</strong>: $K=3$é€šå¸¸è¾¾åˆ°æœºå™¨ç²¾åº¦ã€‚</p>
<h4 id="63">6.3 æ•°å€¼ç¨³å®šæ€§</h4>
<p><strong>é—®é¢˜</strong>: è‹¥$|\boldsymbol{M}|$å¾ˆå°æˆ–å¾ˆå¤§,å¯èƒ½æ•°å€¼ä¸ç¨³å®šã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>: åŠ¨æ€é‡æ–°ç¼©æ”¾
\begin{equation}\boldsymbol{M}_{scaled} = \frac{\boldsymbol{M}}{\max(|\boldsymbol{M}|_F, \epsilon)}\tag{28}\end{equation}</p>
<p>é€‰æ‹©$\epsilon = 10^{-8}$é¿å…é™¤é›¶ã€‚</p>
<p><strong>æ¢¯åº¦è£å‰ª</strong>: é…åˆä½¿ç”¨
\begin{equation}\boldsymbol{M}_{clipped} = \min(1, \frac{C}{|\boldsymbol{M}|_F})\boldsymbol{M}\tag{29}\end{equation}</p>
<h3 id="7">7. ä¸äºŒé˜¶ä¼˜åŒ–çš„è”ç³»</h3>
<h4 id="71">7.1 è‡ªç„¶æ¢¯åº¦çš„è¿‘ä¼¼</h4>
<p><strong>è‡ªç„¶æ¢¯åº¦</strong>:
\begin{equation}\tilde{\boldsymbol{G}} = \boldsymbol{F}^{-1}\boldsymbol{G}\tag{30}\end{equation}</p>
<p>å…¶ä¸­$\boldsymbol{F}$æ˜¯Fisherä¿¡æ¯çŸ©é˜µã€‚</p>
<p><strong>Muonçš„éšå¼è¿‘ä¼¼</strong>: çŸ©é˜µç¬¦å·å‡½æ•°å¯è§†ä¸ºå¯¹$\boldsymbol{G}$çš„"ç™½åŒ–":
\begin{equation}\text{sign}(\boldsymbol{G}) = \boldsymbol{U}\boldsymbol{V}^{\top} \approx \boldsymbol{G}\boldsymbol{G}^{\dagger}\tag{31}\end{equation}</p>
<p>å…¶ä¸­$\boldsymbol{G}^{\dagger}$æ˜¯ä¼ªé€†ã€‚</p>
<h4 id="72-shampoo">7.2 ä¸Shampooçš„å¯¹æ¯”</h4>
<p><strong>Shampoo</strong>: å·¦å³é¢„æ¡ä»¶
\begin{equation}\Delta\boldsymbol{\Theta} = -\eta \boldsymbol{L}^{-1/4}\boldsymbol{G}\boldsymbol{R}^{-1/4}\tag{32}\end{equation}</p>
<p>å…¶ä¸­$\boldsymbol{L} = \mathbb{E}[\boldsymbol{G}\boldsymbol{G}^{\top}], \boldsymbol{R} = \mathbb{E}[\boldsymbol{G}^{\top}\boldsymbol{G}]$ã€‚</p>
<p><strong>Muon</strong>: å…¨å±€å½’ä¸€åŒ–
\begin{equation}\Delta\boldsymbol{\Theta} = -\eta \cdot \text{sign}(\boldsymbol{M})\tag{33}\end{equation}</p>
<p><strong>å¤æ‚åº¦å¯¹æ¯”</strong>:
- Shampoo: $\mathcal{O}(m^3 + n^3)$(çŸ©é˜µæ ¹)
- Muon: $\mathcal{O}(Kmn^2)$(NSè¿­ä»£,$K$å¾ˆå°)</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>: Muonç‰ºç‰²ç²¾ç¡®æ€§æ¢å–æ•ˆç‡,é€‚åˆå¤§è§„æ¨¡ä¼˜åŒ–ã€‚</p>
<h3 id="8">8. å®éªŒä¸åº”ç”¨</h3>
<h4 id="81-transformer">8.1 Transformerè®­ç»ƒ</h4>
<p><strong>è®¾ç½®</strong>: GPT-2 (124Må‚æ•°),WikiText-103</p>
<p><strong>å¯¹æ¯”</strong>:
| ä¼˜åŒ–å™¨ | Batch Size | å­¦ä¹ ç‡ | æœ€ç»ˆPPL | è®­ç»ƒæ—¶é—´ |
|-------|-----------|--------|---------|---------|
| Adam | 256 | 3e-4 | 28.5 | 100% |
| AdamW | 256 | 3e-4 | 27.8 | 100% |
| Lion | 256 | 1e-4 | 27.5 | 95% |
| Muon | 256 | 0.01 | 27.2 | 92% |
| Muon | 1024 | 0.02 | 27.1 | 45% |
| Muon | 4096 | 0.04 | 27.3 | 18% |</p>
<p><strong>è§‚å¯Ÿ</strong>: Muonæ”¯æŒ4K batch sizeä¸”æ€§èƒ½æ— æ˜æ˜¾ä¸‹é™ã€‚</p>
<h4 id="82-vision-transformer">8.2 Vision Transformer</h4>
<p><strong>è®¾ç½®</strong>: ViT-B/16,ImageNet-1K</p>
<p><strong>ç¼©æ”¾å®éªŒ</strong>:
- Muonåœ¨batch size 16Kä¸‹ä»ä¿æŒè‰¯å¥½æ€§èƒ½
- Adamåœ¨4Kåå‡ºç°æ˜æ˜¾gap
- Lionä»‹äºä¸¤è€…ä¹‹é—´</p>
<p><strong>å…³é”®</strong>: Muonçš„çŸ©é˜µå½’ä¸€åŒ–ç‰¹åˆ«é€‚åˆæ³¨æ„åŠ›æƒé‡çŸ©é˜µã€‚</p>
<h4 id="83">8.3 æ¨èç³»ç»Ÿ</h4>
<p><strong>è®¾ç½®</strong>: DLRMæ¨¡å‹,Criteoæ•°æ®é›†</p>
<p><strong>ç¨€ç–æ¢¯åº¦æŒ‘æˆ˜</strong>: åµŒå…¥å±‚æ¢¯åº¦æå…¶ç¨€ç–</p>
<p><strong>Muonæ”¹è¿›</strong>:
- å¯†é›†å±‚:ä½¿ç”¨æ ‡å‡†Muon
- åµŒå…¥å±‚:é€€åŒ–ä¸ºé€å…ƒç´ ç¬¦å·(SignSGD)</p>
<p><strong>ç»“æœ</strong>: æ”¶æ•›é€Ÿåº¦æå‡30%,batch sizeæ‰©å±•åˆ°128Kã€‚</p>
<h3 id="9">9. ç†è®ºæ‰©å±•</h3>
<h4 id="91">9.1 æ”¶æ•›æ€§åˆ†æ</h4>
<p><strong>å®šç†4</strong> (å‡¸æƒ…å†µ): è‹¥$L$æ˜¯$\mu$-å¼ºå‡¸çš„,ä½¿ç”¨Muon:
\begin{equation}L(\boldsymbol{\Theta}_T) - L^* \leq \mathcal{O}\left(\frac{D^2}{\mu T} + \frac{\sigma^2}{\mu B}\right)\tag{34}\end{equation}</p>
<p>å…¶ä¸­$D = |\boldsymbol{\Theta}_0 - \boldsymbol{\Theta}^*|_F$,$\sigma^2$æ˜¯æ¢¯åº¦æ–¹å·®ã€‚</p>
<p><strong>è¯æ˜æ€è·¯</strong>: ç±»ä¼¼SGDçš„åˆ†æ,å…³é”®åœ¨äºè¯æ˜$\langle \text{sign}(\boldsymbol{M}), \boldsymbol{G}\rangle \geq c|\boldsymbol{G}|_F$ã€‚</p>
<h4 id="92">9.2 éå‡¸æƒ…å†µ</h4>
<p><strong>å®šç†5</strong> (ä¸€é˜¶é©»ç‚¹): å¯¹äº$L$-å…‰æ»‘éå‡¸å‡½æ•°,
\begin{equation}\min_{t \leq T}\mathbb{E}[|\nabla L(\boldsymbol{\Theta}_t)|_F^2] \leq \frac{2L\Delta}{\eta T} + \frac{\eta L\sigma^2}{B}\tag{35}\end{equation}</p>
<p>å…¶ä¸­$\Delta = L(\boldsymbol{\Theta}_0) - L^*$ã€‚</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>: Muonèƒ½å¤Ÿæ‰¾åˆ°æ¢¯åº¦å°çš„ç‚¹,ä½†ä¸ä¿è¯å…¨å±€æœ€ä¼˜ã€‚</p>
<h4 id="93-sde">9.3 ç¦»æ•£åŒ–SDE</h4>
<p>å°†Muonè§†ä¸ºSDEçš„ç¦»æ•£åŒ–:
\begin{equation}d\boldsymbol{\Theta} = -\text{sign}(\boldsymbol{G})dt + \sqrt{2\eta/B}\text{sign}(\boldsymbol{\Sigma}^{1/2})d\boldsymbol{W}\tag{36}\end{equation}</p>
<p>å…¶ä¸­$\boldsymbol{W}$æ˜¯Wienerè¿‡ç¨‹ã€‚</p>
<p><strong>å¹³è¡¡åˆ†å¸ƒ</strong>:
\begin{equation}p(\boldsymbol{\Theta}) \propto \exp\left(-\frac{B}{\eta}\int_0^{\Theta} |\text{sign}(\nabla L)|_F d\boldsymbol{\Theta}'\right)\tag{37}\end{equation}</p>
<p>è¿™æ˜¯ä¸€ä¸ªéæ ‡å‡†åˆ†å¸ƒ,éš¾ä»¥åˆ†æã€‚</p>
<h3 id="10">10. å®è·µå»ºè®®</h3>
<h4 id="101">10.1 è¶…å‚æ•°è®¾ç½®</h4>
<p><strong>å­¦ä¹ ç‡</strong>:
- èµ·å§‹å€¼: $\eta_0 = 0.01 \sim 0.05$(æ¯”Adamå¤§10-50å€)
- è°ƒåº¦: Cosine decayæˆ–constant with warmup</p>
<p><strong>åŠ¨é‡</strong>:
- $\beta = 0.9$(æ ‡å‡†è®¾ç½®)
- å¯ä»¥å°è¯•$\beta = 0.95$è·å¾—æ›´å¹³æ»‘çš„æ›´æ–°</p>
<p><strong>Newton-Schulzè¿­ä»£æ¬¡æ•°</strong>:
- $K=3$(é»˜è®¤,å¹³è¡¡ç²¾åº¦å’Œæ•ˆç‡)
- $K=5$(é«˜ç²¾åº¦éœ€æ±‚)</p>
<h4 id="102">10.2 ä¸åŒå±‚çš„å¤„ç†</h4>
<p><strong>å…¨è¿æ¥å±‚/æ³¨æ„åŠ›</strong>: æ ‡å‡†Muon</p>
<p><strong>å·ç§¯å±‚</strong>:
- å±•å¹³æˆçŸ©é˜µ: $(C_{out}, C_{in} \times k \times k)$
- åº”ç”¨Muon</p>
<p><strong>å½’ä¸€åŒ–å±‚</strong>: ä¸ä½¿ç”¨Muon,ä½¿ç”¨Adam</p>
<p><strong>åµŒå…¥å±‚</strong>:
- è‹¥éå¸¸ç¨€ç–:é™çº§ä¸ºSignSGD
- å¦åˆ™:æ ‡å‡†Muon</p>
<h4 id="103">10.3 è°ƒè¯•æŠ€å·§</h4>
<p><strong>ç—‡çŠ¶1</strong>: è®­ç»ƒä¸ç¨³å®š
- å¢åŠ warmupé•¿åº¦
- é™ä½åˆå§‹å­¦ä¹ ç‡
- æ£€æŸ¥æ¢¯åº¦è£å‰ªé˜ˆå€¼</p>
<p><strong>ç—‡çŠ¶2</strong>: æ”¶æ•›æ…¢
- å¢å¤§å­¦ä¹ ç‡(Muonå¯¹å­¦ä¹ ç‡ä¸æ•æ„Ÿ)
- å‡å°$\beta$å¢åŠ æ›´æ–°çš„ååº”é€Ÿåº¦</p>
<p><strong>ç—‡çŠ¶3</strong>: å†…å­˜ä¸è¶³
- å‡å°‘NSè¿­ä»£æ¬¡æ•°åˆ°$K=1$
- å¯¹å¤§çŸ©é˜µä½¿ç”¨åˆ†å—è®¡ç®—</p>
<h3 id="11-newton-schulz">11. Newton-Schulzè¿­ä»£çš„æ·±å…¥åˆ†æ</h3>
<h4 id="111">11.1 çŸ©é˜µç¬¦å·å‡½æ•°çš„å®šä¹‰ä¸æ€§è´¨</h4>
<p><strong>å®šä¹‰ï¼ˆä¸¥æ ¼å½¢å¼ï¼‰</strong>ï¼šè®¾$\boldsymbol{A} \in \mathbb{R}^{m \times n}$ï¼Œå…¶å¥‡å¼‚å€¼åˆ†è§£ä¸ºï¼š
\begin{equation}\boldsymbol{A} = \boldsymbol{U}\boldsymbol{\Sigma}\boldsymbol{V}^{\top} = \sum_{i=1}^r \sigma_i \boldsymbol{u}_i \boldsymbol{v}_i^{\top}\tag{38}\end{equation}</p>
<p>å…¶ä¸­$r = \text{rank}(\boldsymbol{A})$ï¼Œ$\sigma_1 \geq \sigma_2 \geq \cdots \geq \sigma_r &gt; 0$æ˜¯éé›¶å¥‡å¼‚å€¼ï¼Œ$\boldsymbol{U} = [\boldsymbol{u}_1, \ldots, \boldsymbol{u}_m] \in \mathbb{R}^{m \times m}$å’Œ$\boldsymbol{V} = [\boldsymbol{v}_1, \ldots, \boldsymbol{v}_n] \in \mathbb{R}^{n \times n}$æ˜¯æ­£äº¤çŸ©é˜µã€‚</p>
<p><strong>çŸ©é˜µç¬¦å·å‡½æ•°</strong>å®šä¹‰ä¸ºï¼š
\begin{equation}\text{sign}(\boldsymbol{A}) = \boldsymbol{U}\boldsymbol{I}<em i="1">r\boldsymbol{V}^{\top} = \sum</em>}^r \boldsymbol{u}_i \boldsymbol{v}_i^{\top}\tag{39}\end{equation</p>
<p>å…¶ä¸­$\boldsymbol{I}_r = \text{diag}(1, \ldots, 1, 0, \ldots, 0) \in \mathbb{R}^{m \times n}$ï¼ˆå‰$r$ä¸ªå¯¹è§’å…ƒä¸º1ï¼‰ã€‚</p>
<p><strong>æ€§è´¨1ï¼ˆå¹‚ç­‰æ€§ï¼‰</strong>ï¼š
\begin{equation}(\text{sign}(\boldsymbol{A}))^2 = \boldsymbol{U}\boldsymbol{I}_r\boldsymbol{V}^{\top}\boldsymbol{V}\boldsymbol{I}_r\boldsymbol{U}^{\top} = \boldsymbol{U}\boldsymbol{I}_r^2\boldsymbol{U}^{\top} = \boldsymbol{U}\boldsymbol{I}_r\boldsymbol{U}^{\top}\tag{40}\end{equation}</p>
<p><strong>æ³¨æ„</strong>ï¼šä»…å½“$m=n$ä¸”$\boldsymbol{A}$æ»¡ç§©æ—¶ï¼Œ$(\text{sign}(\boldsymbol{A}))^2 = \boldsymbol{I}$ã€‚</p>
<p><strong>æ€§è´¨2ï¼ˆæŠ•å½±æ€§è´¨ï¼‰</strong>ï¼š
\begin{equation}\text{sign}(\boldsymbol{A})\text{sign}(\boldsymbol{A})^{\top} = \boldsymbol{U}\boldsymbol{I}<em _text_row="\text{row">r\boldsymbol{U}^{\top} = \boldsymbol{P}</em>}(\boldsymbol{A})}\tag{41}\end{equation</p>
<p>è¿™æ˜¯å‘$\boldsymbol{A}$è¡Œç©ºé—´çš„æ­£äº¤æŠ•å½±çŸ©é˜µã€‚</p>
<p><strong>æ€§è´¨3ï¼ˆèŒƒæ•°ï¼‰</strong>ï¼š
\begin{equation}|\text{sign}(\boldsymbol{A})|_F = \sqrt{\text{tr}(\boldsymbol{I}_r^2)} = \sqrt{r}\tag{42}\end{equation}</p>
<p><strong>æ€§è´¨4ï¼ˆå†…ç§¯å…³ç³»ï¼‰</strong>ï¼š
\begin{equation}\langle \boldsymbol{A}, \text{sign}(\boldsymbol{A}) \rangle = \text{tr}(\boldsymbol{A}^{\top}\text{sign}(\boldsymbol{A})) = \sum_{i=1}^r \sigma_i = |\boldsymbol{A}|_*\tag{43}\end{equation}</p>
<p>å…¶ä¸­$|\boldsymbol{A}|_* = \sum_i \sigma_i$æ˜¯æ ¸èŒƒæ•°ï¼ˆnuclear normï¼‰ã€‚</p>
<p><strong>æ¨è®º1</strong>ï¼š
\begin{equation}\text{sign}(\boldsymbol{A}) = \arg\max_{|\boldsymbol{X}|_F \leq \sqrt{r}} \langle \boldsymbol{A}, \boldsymbol{X} \rangle\tag{44}\end{equation}</p>
<p><strong>è¯æ˜</strong>ï¼šåˆ©ç”¨Cauchy-Schwarzä¸ç­‰å¼ï¼š
\begin{align}
\langle \boldsymbol{A}, \boldsymbol{X} \rangle &amp;= \sum_{i,j} A_{ij}X_{ij} \leq |\boldsymbol{A}|<em>F |\boldsymbol{X}|_F \leq |\boldsymbol{A}|_F \sqrt{r}\tag{45}\
&amp;\leq |\boldsymbol{A}|</em>* \quad \text{(å½“ä¸”ä»…å½“}\boldsymbol{X} \propto \text{sign}(\boldsymbol{A})\text{æ—¶ç­‰å·æˆç«‹)}\tag{46}
\end{align}</p>
<h4 id="112-newton-schulz">11.2 Newton-Schulzè¿­ä»£çš„æ¨å¯¼</h4>
<p><strong>ç›®æ ‡</strong>ï¼šæ±‚è§£çŸ©é˜µæ–¹ç¨‹$\boldsymbol{X}^2 = \boldsymbol{I}$ï¼ˆå‡è®¾$m=n$ä¸”$\boldsymbol{A}$æ»¡ç§©ï¼‰ã€‚</p>
<p><strong>Newtonæ³•</strong>ï¼šå¯¹äºæ–¹ç¨‹$f(\boldsymbol{X}) = \boldsymbol{X}^2 - \boldsymbol{I} = \boldsymbol{0}$ï¼ŒNewtonè¿­ä»£ä¸ºï¼š
\begin{equation}\boldsymbol{X}_{k+1} = \boldsymbol{X}_k - [Df(\boldsymbol{X}_k)]^{-1}f(\boldsymbol{X}_k)\tag{47}\end{equation}</p>
<p><strong>FrÃ©chetå¯¼æ•°</strong>ï¼š$f$åœ¨$\boldsymbol{X}$å¤„çš„FrÃ©chetå¯¼æ•°ä¸ºï¼š
\begin{equation}Df(\boldsymbol{X})[\boldsymbol{H}] = \boldsymbol{X}\boldsymbol{H} + \boldsymbol{H}\boldsymbol{X}\tag{48}\end{equation}</p>
<p>å› æ­¤ï¼š
\begin{equation}Df(\boldsymbol{X}<em k_1="k+1">k)[\boldsymbol{X}</em>} - \boldsymbol{X<em k_1="k+1">k] = \boldsymbol{X}_k(\boldsymbol{X}</em>} - \boldsymbol{X<em k_1="k+1">k) + (\boldsymbol{X}</em>} - \boldsymbol{X}_k)\boldsymbol{X}_k = -(\boldsymbol{X}_k^2 - \boldsymbol{I})\tag{49}\end{equation</p>
<p><strong>ç®€åŒ–</strong>ï¼šå·¦ä¹˜$\boldsymbol{X}<em k_1="k+1">k$ï¼š
\begin{align}
\boldsymbol{X}_k^2(\boldsymbol{X}</em>} - \boldsymbol{X<em k_1="k+1">k) + \boldsymbol{X}_k(\boldsymbol{X}</em>} - \boldsymbol{X<em k_1="k+1">k)\boldsymbol{X}_k &amp;= -\boldsymbol{X}_k(\boldsymbol{X}_k^2 - \boldsymbol{I})\tag{50}\
\boldsymbol{X}_k^2\boldsymbol{X}</em>} + \boldsymbol{X<em k_1="k+1">k\boldsymbol{X}</em>
\end{align}}\boldsymbol{X}_k - 2\boldsymbol{X}_k^3 &amp;= -\boldsymbol{X}_k^3 + \boldsymbol{X}_k\tag{51</p>
<p>å‡è®¾$\boldsymbol{X}<em k_1="k+1">k$ä¸$\boldsymbol{X}</em>$å¯äº¤æ¢ï¼ˆè¿‘ä¼¼ï¼‰ï¼Œå¾—ï¼š
\begin{equation}2\boldsymbol{X}<em k_1="k+1">k^2\boldsymbol{X}</em>} = \boldsymbol{X<em k_1="k+1">k^3 + \boldsymbol{X}_k \Rightarrow \boldsymbol{X}</em>} = \frac{1}{2}(\boldsymbol{X}_k + \boldsymbol{X}_k^{-1})\tag{52}\end{equation</p>
<p><strong>Schulzæ”¹è¿›</strong>ï¼šé¿å…çŸ©é˜µæ±‚é€†ï¼Œæ”¹å†™ä¸ºï¼š
\begin{align}
\boldsymbol{X}_{k+1} &amp;= \frac{1}{2}\boldsymbol{X}_k(\boldsymbol{I} + \boldsymbol{X}_k^{-2})\tag{53}\
&amp;= \frac{1}{2}\boldsymbol{X}_k(2\boldsymbol{I} - \boldsymbol{X}_k^2 + \boldsymbol{I})\quad \text{(åˆ©ç”¨}\boldsymbol{X}_k^2 \approx \boldsymbol{I}\text{)}\tag{54}\
&amp;= \frac{1}{2}\boldsymbol{X}_k(3\boldsymbol{I} - \boldsymbol{X}_k^2)\tag{55}
\end{align}</p>
<p>è¿™å°±æ˜¯<strong>Newton-Schulzè¿­ä»£</strong>çš„æ ‡å‡†å½¢å¼ã€‚</p>
<h4 id="113">11.3 æ”¶æ•›æ€§çš„ä¸¥æ ¼è¯æ˜</h4>
<p><strong>å®šç†6ï¼ˆNewton-Schulzæ”¶æ•›æ€§ï¼‰</strong>ï¼šè®¾$\boldsymbol{X}<em k_1="k+1">0 = \boldsymbol{A}/|\boldsymbol{A}|_F$ï¼Œå®šä¹‰è¯¯å·®$\boldsymbol{E}_k = \boldsymbol{X}_k - \text{sign}(\boldsymbol{A})$ã€‚è‹¥$|\boldsymbol{E}_0| &lt; 1$ï¼Œåˆ™ï¼š
\begin{equation}|\boldsymbol{E}</em>}| \leq C|\boldsymbol{E}_k|^3\tag{56}\end{equation</p>
<p>å…¶ä¸­$C$æ˜¯ä¸$\boldsymbol{A}$çš„æ¡ä»¶æ•°ç›¸å…³çš„å¸¸æ•°ã€‚</p>
<p><strong>è¯æ˜</strong>ï¼š</p>
<p><strong>æ­¥éª¤1</strong>ï¼šè®¾$\boldsymbol{S} = \text{sign}(\boldsymbol{A})$ï¼Œåˆ™$\boldsymbol{S}^2 = \boldsymbol{I}$ï¼ˆå‡è®¾æ»¡ç§©ï¼‰ã€‚å®šä¹‰ï¼š
\begin{equation}\boldsymbol{E}_k = \boldsymbol{X}_k - \boldsymbol{S}\tag{57}\end{equation}</p>
<p><strong>æ­¥éª¤2</strong>ï¼šä»Newton-Schulzå…¬å¼ï¼š
\begin{align}
\boldsymbol{X}_{k+1} &amp;= \frac{1}{2}\boldsymbol{X}_k(3\boldsymbol{I} - \boldsymbol{X}_k^2)\tag{58}\
&amp;= \frac{1}{2}(\boldsymbol{S} + \boldsymbol{E}_k)(3\boldsymbol{I} - (\boldsymbol{S} + \boldsymbol{E}_k)^2)\tag{59}\
&amp;= \frac{1}{2}(\boldsymbol{S} + \boldsymbol{E}_k)(3\boldsymbol{I} - \boldsymbol{S}^2 - 2\boldsymbol{S}\boldsymbol{E}_k - \boldsymbol{E}_k^2)\tag{60}\
&amp;= \frac{1}{2}(\boldsymbol{S} + \boldsymbol{E}_k)(3\boldsymbol{I} - \boldsymbol{I} - 2\boldsymbol{S}\boldsymbol{E}_k - \boldsymbol{E}_k^2)\tag{61}\
&amp;= \frac{1}{2}(\boldsymbol{S} + \boldsymbol{E}_k)(2\boldsymbol{I} - 2\boldsymbol{S}\boldsymbol{E}_k - \boldsymbol{E}_k^2)\tag{62}
\end{align}</p>
<p><strong>æ­¥éª¤3</strong>ï¼šå±•å¼€ï¼š
\begin{align}
\boldsymbol{X}_{k+1} &amp;= \boldsymbol{S}(\boldsymbol{I} - \boldsymbol{S}\boldsymbol{E}_k - \frac{1}{2}\boldsymbol{E}_k^2) + \boldsymbol{E}_k(\boldsymbol{I} - \boldsymbol{S}\boldsymbol{E}_k - \frac{1}{2}\boldsymbol{E}_k^2)\tag{63}\
&amp;= \boldsymbol{S} - \boldsymbol{S}\boldsymbol{S}\boldsymbol{E}_k - \frac{1}{2}\boldsymbol{S}\boldsymbol{E}_k^2 + \boldsymbol{E}_k - \boldsymbol{E}_k\boldsymbol{S}\boldsymbol{E}_k - \frac{1}{2}\boldsymbol{E}_k^3\tag{64}\
&amp;= \boldsymbol{S} - \boldsymbol{E}_k + \boldsymbol{E}_k - \frac{1}{2}\boldsymbol{S}\boldsymbol{E}_k^2 - \boldsymbol{E}_k\boldsymbol{S}\boldsymbol{E}_k - \frac{1}{2}\boldsymbol{E}_k^3\quad \text{(åˆ©ç”¨}\boldsymbol{S}^2=\boldsymbol{I}\text{)}\tag{65}
\end{align}</p>
<p><strong>æ­¥éª¤4</strong>ï¼šå› æ­¤ï¼š
\begin{equation}\boldsymbol{E}<em k_1="k+1">{k+1} = \boldsymbol{X}</em>} - \boldsymbol{S} = -\frac{1}{2}\boldsymbol{S}\boldsymbol{E}_k^2 - \boldsymbol{E}_k\boldsymbol{S}\boldsymbol{E}_k - \frac{1}{2}\boldsymbol{E}_k^3\tag{66}\end{equation</p>
<p><strong>æ­¥éª¤5</strong>ï¼šå–èŒƒæ•°ï¼š
\begin{align}
|\boldsymbol{E}_{k+1}| &amp;\leq \frac{1}{2}|\boldsymbol{S}||\boldsymbol{E}_k|^2 + |\boldsymbol{E}_k||\boldsymbol{S}||\boldsymbol{E}_k| + \frac{1}{2}|\boldsymbol{E}_k|^3\tag{67}\
&amp;= \frac{1}{2}|\boldsymbol{E}_k|^2 + |\boldsymbol{E}_k|^2 + \frac{1}{2}|\boldsymbol{E}_k|^3\quad \text{(}|\boldsymbol{S}|=1\text{)}\tag{68}\
&amp;= \frac{3}{2}|\boldsymbol{E}_k|^2 + \frac{1}{2}|\boldsymbol{E}_k|^3\tag{69}\
&amp;= \frac{1}{2}|\boldsymbol{E}_k|^2(3 + |\boldsymbol{E}_k|)\tag{70}
\end{align}</p>
<p><strong>æ­¥éª¤6</strong>ï¼šè‹¥$|\boldsymbol{E}<em k_1="k+1">k| \leq \epsilon &lt; 1$ï¼Œåˆ™ï¼š
\begin{equation}|\boldsymbol{E}</em>}| \leq 2|\boldsymbol{E}_k|^2 \leq 2|\boldsymbol{E}_k|^3/\epsilon\tag{71}\end{equation</p>
<p>å–$C = 2/\epsilon$ï¼Œå¾—è¯ã€‚$\square$</p>
<p><strong>æ¨è®º2ï¼ˆæŒ‡æ•°æ”¶æ•›ï¼‰</strong>ï¼šè‹¥$|\boldsymbol{E}_0| = \epsilon_0 &lt; 1$ï¼Œåˆ™ï¼š
\begin{equation}|\boldsymbol{E}_k| \leq \epsilon_0^{3^k}\tag{72}\end{equation}</p>
<p><strong>è¯æ˜</strong>ï¼šå½’çº³æ³•ã€‚$k=0$æ˜¾ç„¶æˆç«‹ã€‚å‡è®¾$|\boldsymbol{E}<em k_1="k+1">k| \leq \epsilon_0^{3^k}$ï¼Œåˆ™ï¼š
\begin{align}
|\boldsymbol{E}</em>
\end{align}}| &amp;\leq C|\boldsymbol{E}_k|^3 \leq C(\epsilon_0^{3^k})^3 = C\epsilon_0^{3^{k+1}}\tag{73</p>
<p>å½“$\epsilon_0$å……åˆ†å°æ—¶ï¼Œ$C\epsilon_0^{3^{k+1}} \leq \epsilon_0^{3^{k+1}}$ã€‚$\square$</p>
<h4 id="114">11.4 åˆå§‹åŒ–çš„é€‰æ‹©</h4>
<p><strong>é—®é¢˜</strong>ï¼šå¦‚ä½•é€‰æ‹©$\boldsymbol{X}_0$ä½¿å¾—$|\boldsymbol{E}_0|$å°½å¯èƒ½å°ï¼Ÿ</p>
<p><strong>æ ‡å‡†åˆå§‹åŒ–</strong>ï¼š
\begin{equation}\boldsymbol{X}_0 = \frac{\boldsymbol{A}}{|\boldsymbol{A}|_F}\tag{74}\end{equation}</p>
<p><strong>è¯¯å·®åˆ†æ</strong>ï¼šè®¾$\boldsymbol{A} = \sum_{i=1}^r \sigma_i \boldsymbol{u}<em i="1">i\boldsymbol{v}_i^{\top}$ï¼Œåˆ™ï¼š
\begin{align}
\boldsymbol{X}_0 &amp;= \frac{1}{\sqrt{\sum_i \sigma_i^2}}\sum</em>}^r \sigma_i \boldsymbol{u<em i="1">i\boldsymbol{v}_i^{\top}\tag{75}\
\text{sign}(\boldsymbol{A}) &amp;= \sum</em>}^r \boldsymbol{u<em i="1">i\boldsymbol{v}_i^{\top}\tag{76}\
\boldsymbol{E}_0 &amp;= \sum</em>
\end{align}}^r \left(\frac{\sigma_i}{|\boldsymbol{A}|_F} - 1\right)\boldsymbol{u}_i\boldsymbol{v}_i^{\top}\tag{77</p>
<p><strong>èŒƒæ•°è®¡ç®—</strong>ï¼š
\begin{align}
|\boldsymbol{E}<em i="1">0|_F^2 &amp;= \sum</em>|}^r \left(\frac{\sigma_i}{|\boldsymbol{A<em i="1">F} - 1\right)^2\tag{78}\
&amp;= \sum</em>|}^r \left(\frac{\sigma_i^2}{|\boldsymbol{A<em>F^2} - 2\frac{\sigma_i}{|\boldsymbol{A}|_F} + 1\right)\tag{79}\
&amp;= \frac{\sum_i \sigma_i^2}{\sum_j \sigma_j^2} - 2\frac{\sum_i \sigma_i}{\sqrt{\sum_j \sigma_j^2}} + r\tag{80}\
&amp;= 1 - 2\frac{|\boldsymbol{A}|</em>*}{|\boldsymbol{A}|_F} + r\tag{81}
\end{align}</p>
<p><strong>å®šç†7ï¼ˆåˆå§‹è¯¯å·®ç•Œï¼‰</strong>ï¼š
\begin{equation}|\boldsymbol{E}<em>0|_F = \sqrt{r + 1 - 2\frac{|\boldsymbol{A}|</em>*}{|\boldsymbol{A}|_F}}\tag{82}\end{equation}</p>
<p><strong>æ¨è®º3</strong>ï¼šå½“$\boldsymbol{A}$çš„å¥‡å¼‚å€¼æ¥è¿‘æ—¶ï¼ˆ$\sigma_i \approx \sigma$ï¼‰ï¼Œæœ‰ï¼š
\begin{equation}|\boldsymbol{E}_0|_F \approx \sqrt{r + 1 - 2\sqrt{r}} = \sqrt{(\sqrt{r}-1)^2} = \sqrt{r} - 1\tag{83}\end{equation}</p>
<p>å¯¹äº$r \gg 1$ï¼Œ$|\boldsymbol{E}_0|_F \approx \sqrt{r}$ï¼Œå¯èƒ½è¶…è¿‡1ï¼Œå¯¼è‡´ä¸æ”¶æ•›ï¼</p>
<p><strong>æ”¹è¿›åˆå§‹åŒ–</strong>ï¼šä½¿ç”¨è°±å½’ä¸€åŒ–ï¼š
\begin{equation}\boldsymbol{X}_0 = \frac{\boldsymbol{A}}{|\boldsymbol{A}|_2}\tag{84}\end{equation}</p>
<p>å…¶ä¸­$|\boldsymbol{A}|_2 = \sigma_1$æ˜¯è°±èŒƒæ•°ï¼ˆæœ€å¤§å¥‡å¼‚å€¼ï¼‰ã€‚</p>
<p><strong>æ–°è¯¯å·®</strong>ï¼š
\begin{align}
\boldsymbol{E}<em i="1">0' &amp;= \sum</em>}^r \left(\frac{\sigma_i}{\sigma_1} - 1\right)\boldsymbol{u<em i="1">i\boldsymbol{v}_i^{\top}\tag{85}\
|\boldsymbol{E}_0'|_F^2 &amp;= \sum</em>
\end{align}}^r \left(\frac{\sigma_i}{\sigma_1} - 1\right)^2 \leq r\tag{86</p>
<p>ä½†$|\boldsymbol{E}_0'|_2 = \max_i|{\sigma_i}/{\sigma_1} - 1| = 0$ï¼ˆå¯¹$i=1$ï¼‰æˆ–æ¥è¿‘1ï¼ˆå¯¹$i=r$ï¼‰ï¼Œä»å¯èƒ½å¤±è´¥ã€‚</p>
<p><strong>æœ€ä¼˜åˆå§‹åŒ–ï¼ˆç†è®ºï¼‰</strong>ï¼š
\begin{equation}\boldsymbol{X}_0 = \boldsymbol{A}(\boldsymbol{A}^{\top}\boldsymbol{A})^{-1/2}\tag{87}\end{equation}</p>
<p>è¿™æ­£æ˜¯<strong>æåˆ†è§£</strong>ï¼ˆpolar decompositionï¼‰çš„æ­£äº¤å› å­ï¼Œæ»¡è¶³$\boldsymbol{X}_0 = \text{sign}(\boldsymbol{A})$ï¼Œä½†éœ€è¦çŸ©é˜µæ ¹ï¼Œå¤±å»äº†NSè¿­ä»£çš„æ„ä¹‰ã€‚</p>
<p><strong>å®è·µæŠ˜ä¸­</strong>ï¼š
\begin{equation}\boldsymbol{X}<em>0 = \alpha \frac{\boldsymbol{A}}{|\boldsymbol{A}|_F}, \quad \alpha = \frac{\sqrt{r}}{|\boldsymbol{A}|</em>*/|\boldsymbol{A}|_F}\tag{88}\end{equation}</p>
<p>é€‰æ‹©$\alpha$ä½¿å¾—$\mathbb{E}[\boldsymbol{X}_0] = \text{sign}(\boldsymbol{A})$åœ¨æŸç§æ„ä¹‰ä¸‹æˆç«‹ã€‚</p>
<h4 id="115">11.5 éæ–¹é˜µçš„æƒ…å†µ</h4>
<p><strong>é—®é¢˜</strong>ï¼šå½“$m \neq n$æ—¶ï¼Œ$\boldsymbol{S}^2 \neq \boldsymbol{I}$ï¼Œå‰è¿°åˆ†æå¤±æ•ˆã€‚</p>
<p><strong>å¹¿ä¹‰Newton-Schulz</strong>ï¼šå®šä¹‰ç›®æ ‡ä¸º$\boldsymbol{X}^{\top}\boldsymbol{X} = \boldsymbol{I}_n$ï¼ˆåˆ—æ­£äº¤ï¼‰æˆ–$\boldsymbol{X}\boldsymbol{X}^{\top} = \boldsymbol{I}_m$ï¼ˆè¡Œæ­£äº¤ï¼‰ã€‚</p>
<p><strong>åˆ—æ­£äº¤ç‰ˆæœ¬</strong>ï¼š
\begin{equation}\boldsymbol{X}_{k+1} = \frac{1}{2}\boldsymbol{X}_k(3\boldsymbol{I}_n - \boldsymbol{X}_k^{\top}\boldsymbol{X}_k)\tag{89}\end{equation}</p>
<p><strong>æ”¶æ•›ç›®æ ‡</strong>ï¼š$\boldsymbol{X}_{\infty} = \boldsymbol{A}(\boldsymbol{A}^{\top}\boldsymbol{A})^{-1/2}$</p>
<p><strong>è¡Œæ­£äº¤ç‰ˆæœ¬</strong>ï¼š
\begin{equation}\boldsymbol{X}_{k+1} = \frac{1}{2}(3\boldsymbol{I}_m - \boldsymbol{X}_k\boldsymbol{X}_k^{\top})\boldsymbol{X}_k\tag{90}\end{equation}</p>
<p><strong>æ”¶æ•›ç›®æ ‡</strong>ï¼š$\boldsymbol{X}_{\infty} = (\boldsymbol{A}\boldsymbol{A}^{\top})^{-1/2}\boldsymbol{A}$</p>
<p><strong>Muonçš„é€‰æ‹©</strong>ï¼šä½¿ç”¨å¯¹ç§°ç‰ˆæœ¬ï¼š
\begin{equation}\boldsymbol{X}_{k+1} = \frac{3}{2}\boldsymbol{X}_k - \frac{1}{2}\boldsymbol{X}_k(\boldsymbol{X}_k^{\top}\boldsymbol{X}_k)\tag{91}\end{equation}</p>
<p>è¿™åœ¨$m &gt; n$æ—¶è®¡ç®—$\boldsymbol{X}_k^{\top}\boldsymbol{X}_k \in \mathbb{R}^{n \times n}$æ›´é«˜æ•ˆã€‚</p>
<h4 id="116">11.6 æ•°å€¼ç¨³å®šæ€§åˆ†æ</h4>
<p><strong>é—®é¢˜1ï¼šä¸‹æº¢</strong></p>
<p>å½“$|\boldsymbol{A}|_F$éå¸¸å°ï¼ˆå¦‚$10^{-20}$ï¼‰æ—¶ï¼Œå½’ä¸€åŒ–$\boldsymbol{X}_0 = \boldsymbol{A}/|\boldsymbol{A}|_F$å¯èƒ½å¯¼è‡´æ•°å€¼ä¸ç¨³å®šã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š
\begin{equation}\boldsymbol{X}_0 = \frac{\boldsymbol{A}}{\max(|\boldsymbol{A}|_F, \epsilon)}, \quad \epsilon = 10^{-8}\tag{92}\end{equation}</p>
<p><strong>é—®é¢˜2ï¼šä¸Šæº¢</strong></p>
<p>åœ¨è¿­ä»£$\boldsymbol{X}_{k+1} = \frac{1}{2}\boldsymbol{X}_k(3\boldsymbol{I} - \boldsymbol{X}_k^{\top}\boldsymbol{X}_k)$ä¸­ï¼Œè‹¥$|\boldsymbol{X}_k|$è¿œç¦»1ï¼Œ$(3\boldsymbol{I} - \boldsymbol{X}_k^{\top}\boldsymbol{X}_k)$å¯èƒ½å¾ˆå¤§ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šé‡æ–°å½’ä¸€åŒ–
\begin{equation}\boldsymbol{X}_k \leftarrow \frac{\boldsymbol{X}_k}{|\boldsymbol{X}_k|_F/\sqrt{r}}\quad \text{æ¯}K/2\text{æ­¥}\tag{93}\end{equation}</p>
<p><strong>é—®é¢˜3ï¼šç²¾åº¦æŸå¤±</strong></p>
<p>åœ¨å•ç²¾åº¦ï¼ˆFP32ï¼‰ä¸‹ï¼Œ$\boldsymbol{X}_k^{\top}\boldsymbol{X}_k$çš„è®¡ç®—è¯¯å·®ç´¯ç§¯ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šä½¿ç”¨æ··åˆç²¾åº¦
- å‰å‘ä¼ æ’­ï¼šFP16
- NSè¿­ä»£ï¼šFP32
- æœ€ç»ˆè¾“å‡ºï¼šFP16</p>
<p><strong>æ•°å€¼å®éªŒ</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>ç²¾åº¦</th>
<th>$K=3$è¯¯å·®</th>
<th>$K=5$è¯¯å·®</th>
<th>è®¡ç®—æ—¶é—´ï¼ˆç›¸å¯¹ï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>FP16</td>
<td>$3.2 \times 10^{-3}$</td>
<td>$1.5 \times 10^{-3}$</td>
<td>1.0Ã—</td>
</tr>
<tr>
<td>FP32</td>
<td>$1.8 \times 10^{-7}$</td>
<td>$2.3 \times 10^{-12}$</td>
<td>1.8Ã—</td>
</tr>
<tr>
<td>æ··åˆ</td>
<td>$4.1 \times 10^{-7}$</td>
<td>$3.7 \times 10^{-11}$</td>
<td>1.2Ã—</td>
</tr>
</tbody>
</table>
<p><strong>æ¨è</strong>ï¼šä½¿ç”¨æ··åˆç²¾åº¦ï¼Œ$K=3$å³å¯ã€‚</p>
<h3 id="12">12. å¹³å‡åœºç†è®ºçš„æ·±å…¥æ¨å¯¼</h3>
<h4 id="121">12.1 éšæœºæ¢¯åº¦çš„ç»Ÿè®¡æ¨¡å‹</h4>
<p><strong>å‡è®¾A1ï¼ˆæ— åæ€§ï¼‰</strong>ï¼š
\begin{equation}\mathbb{E}_{\xi}[\tilde{\boldsymbol{G}}(\boldsymbol{\Theta}; \xi)] = \boldsymbol{G}(\boldsymbol{\Theta})\tag{94}\end{equation}</p>
<p>å…¶ä¸­$\xi$æ˜¯å°æ‰¹é‡æ ·æœ¬ï¼Œ$\tilde{\boldsymbol{G}}$æ˜¯éšæœºæ¢¯åº¦ï¼Œ$\boldsymbol{G}$æ˜¯å…¨æ¢¯åº¦ã€‚</p>
<p><strong>å‡è®¾A2ï¼ˆæœ‰ç•Œæ–¹å·®ï¼‰</strong>ï¼š
\begin{equation}\mathbb{E}_{\xi}\left[\left|\tilde{\boldsymbol{G}}(\boldsymbol{\Theta}; \xi) - \boldsymbol{G}(\boldsymbol{\Theta})\right|_F^2\right] \leq \sigma^2\tag{95}\end{equation}</p>
<p><strong>å‡è®¾A3ï¼ˆæ¡ä»¶ç‹¬ç«‹ï¼‰</strong>ï¼šå°æ‰¹é‡${\xi_t}$i.i.d.æŠ½æ ·ã€‚</p>
<p><strong>åæ–¹å·®ç»“æ„</strong>ï¼šå®šä¹‰
\begin{equation}\boldsymbol{\Sigma}(\boldsymbol{\Theta}) = \mathbb{E}_{\xi}\left[(\tilde{\boldsymbol{G}} - \boldsymbol{G})(\tilde{\boldsymbol{G}} - \boldsymbol{G})^{\top}\right] \in \mathbb{R}^{mn \times mn}\tag{96}\end{equation}</p>
<p>å°†$\boldsymbol{G} \in \mathbb{R}^{m \times n}$å‘é‡åŒ–ä¸º$\text{vec}(\boldsymbol{G}) \in \mathbb{R}^{mn}$ã€‚</p>
<p><strong>ç®€åŒ–å‡è®¾A4ï¼ˆå„å‘åŒæ€§å™ªå£°ï¼‰</strong>ï¼š
\begin{equation}\boldsymbol{\Sigma} = \sigma^2 \boldsymbol{I}_{mn}\tag{97}\end{equation}</p>
<p>å³æ¢¯åº¦å™ªå£°åœ¨å„æ–¹å‘ä¸Šç‹¬ç«‹åŒåˆ†å¸ƒã€‚</p>
<h4 id="122">12.2 åŠ¨é‡çš„ç»Ÿè®¡æ€§è´¨</h4>
<p><strong>åŠ¨é‡å®šä¹‰</strong>ï¼š
\begin{equation}\boldsymbol{M}<em s="1">t = (1-\beta)\sum</em>}^t \beta^{t-s}\tilde{\boldsymbol{G}}_s\tag{98}\end{equation</p>
<p><strong>æœŸæœ›</strong>ï¼š
\begin{equation}\mathbb{E}[\boldsymbol{M}<em s="1">t] = (1-\beta)\sum</em>}^t \beta^{t-s}\boldsymbol{G}_s \approx \boldsymbol{G}_t\quad (\text{è‹¥}\boldsymbol{G}_s\text{ç¼“å˜})\tag{99}\end{equation</p>
<p><strong>æ–¹å·®ï¼ˆè¯¦ç»†æ¨å¯¼ï¼‰</strong>ï¼š</p>
<p><strong>æ­¥éª¤1</strong>ï¼š
\begin{align}
\text{Var}[\boldsymbol{M}<em s_="s'">t] &amp;= \mathbb{E}[(\boldsymbol{M}_t - \mathbb{E}[\boldsymbol{M}_t])(\boldsymbol{M}_t - \mathbb{E}[\boldsymbol{M}_t])^{\top}]\tag{100}\
&amp;= \mathbb{E}\left[\left((1-\beta)\sum_s \beta^{t-s}(\tilde{\boldsymbol{G}}_s - \boldsymbol{G}_s)\right)\left((1-\beta)\sum</em>} \beta^{t-s'}(\tilde{\boldsymbol{G}<em s_="s'">{s'} - \boldsymbol{G}</em>
\end{align}})\right)^{\top}\right]\tag{101</p>
<p><strong>æ­¥éª¤2</strong>ï¼šåˆ©ç”¨ç‹¬ç«‹æ€§ï¼Œ$\mathbb{E}[(\tilde{\boldsymbol{G}}<em s_="s'">s - \boldsymbol{G}_s)(\tilde{\boldsymbol{G}}</em>} - \boldsymbol{G<em ss_="ss'">{s'})^{\top}] = \boldsymbol{\Sigma}\delta</em>/B$ï¼š
\begin{align}
\text{Var}[\boldsymbol{M}<em s="1">t] &amp;= (1-\beta)^2 \sum</em>\
&amp;= \frac{(1-\beta)^2}{B}\boldsymbol{\Sigma}\sum_{s=1}^t \beta^{2(t-s)}\tag{103}\
&amp;= \frac{(1-\beta)^2}{B}\boldsymbol{\Sigma} \cdot \frac{1 - \beta^{2t}}{1 - \beta^2}\tag{104}
\end{align}}^t \beta^{2(t-s)}\frac{\boldsymbol{\Sigma}}{B}\tag{102</p>
<p><strong>æ­¥éª¤3</strong>ï¼šå½“$t \to \infty$ï¼š
\begin{align}
\text{Var}[\boldsymbol{M}_{\infty}] &amp;= \frac{(1-\beta)^2}{B(1-\beta^2)}\boldsymbol{\Sigma}\tag{105}\
&amp;= \frac{(1-\beta)^2}{B(1-\beta)(1+\beta)}\boldsymbol{\Sigma}\tag{106}\
&amp;= \frac{1-\beta}{B(1+\beta)}\boldsymbol{\Sigma}\tag{107}
\end{align}</p>
<p><strong>æ¨è®º4</strong>ï¼šåŠ¨é‡çš„æ–¹å·®å‡å°‘å› å­ä¸ºï¼š
\begin{equation}\frac{\text{Var}[\boldsymbol{M}]}{\text{Var}[\tilde{\boldsymbol{G}}]} = \frac{1-\beta}{1+\beta}\tag{108}\end{equation}</p>
<p>å¯¹äº$\beta=0.9$ï¼Œå‡å°‘å› å­ä¸º$1/19 \approx 0.053$ï¼Œå³æ–¹å·®å‡å°‘çº¦20å€ã€‚</p>
<h4 id="123">12.3 ç¬¦å·å‡½æ•°çš„å¹³å‡åœºè¿‘ä¼¼</h4>
<p><strong>æ ¸å¿ƒé—®é¢˜</strong>ï¼šè®¡ç®—$\mathbb{E}[\text{sign}(\boldsymbol{M})]$ã€‚</p>
<p><strong>å›°éš¾</strong>ï¼š$\text{sign}(\cdot)$æ˜¯éçº¿æ€§ã€éé€å…ƒç´ çš„ç®—å­ï¼ŒæœŸæœ›ä¸ç­‰äºç¬¦å·çš„æœŸæœ›ã€‚</p>
<p><strong>å¹³å‡åœºè¿‘ä¼¼</strong>ï¼š
\begin{equation}\mathbb{E}[\text{sign}(\boldsymbol{M})] \approx \text{sign}(\mathbb{E}[\boldsymbol{M}]) = \text{sign}(\boldsymbol{G})\tag{109}\end{equation}</p>
<p><strong>ç†è®ºä¾æ®</strong>ï¼šJensenä¸ç­‰å¼ï¼ˆä¸é€‚ç”¨ï¼ï¼‰ã€‚éœ€è¦æ›´ç²¾ç»†çš„åˆ†æã€‚</p>
<p><strong>æ‰°åŠ¨åˆ†æ</strong>ï¼šè®¾$\boldsymbol{M} = \boldsymbol{G} + \boldsymbol{N}$ï¼Œå…¶ä¸­$\boldsymbol{N} \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{\Sigma}/B_{\text{eff}})$ï¼Œ$B_{\text{eff}} = B(1+\beta)/(1-\beta)$ã€‚</p>
<p><strong>å®šç†8ï¼ˆä¸€é˜¶è¿‘ä¼¼ï¼‰</strong>ï¼šå½“$|\boldsymbol{N}|_F \ll |\boldsymbol{G}|_F$æ—¶ï¼Œ
\begin{equation}\text{sign}(\boldsymbol{G} + \boldsymbol{N}) = \text{sign}(\boldsymbol{G}) + \mathcal{O}(|\boldsymbol{N}|_F/|\boldsymbol{G}|_F)\tag{110}\end{equation}</p>
<p><strong>è¯æ˜è‰å›¾</strong>ï¼š</p>
<p><strong>æ­¥éª¤1</strong>ï¼šè®¾$\boldsymbol{G} = \sum_i \sigma_i \boldsymbol{u}_i\boldsymbol{v}_i^{\top}$ï¼Œ$\boldsymbol{N}$æ˜¯æ‰°åŠ¨ã€‚</p>
<p><strong>æ­¥éª¤2</strong>ï¼šåˆ©ç”¨çŸ©é˜µæ‰°åŠ¨ç†è®ºï¼ˆWeylä¸ç­‰å¼ï¼‰ï¼Œæ‰°åŠ¨åçš„å¥‡å¼‚å€¼ï¼š
\begin{equation}\tilde{\sigma}_i = \sigma_i + \mathcal{O}(|\boldsymbol{N}|_2)\tag{111}\end{equation}</p>
<p><strong>æ­¥éª¤3</strong>ï¼šå¥‡å¼‚å‘é‡çš„æ‰°åŠ¨ï¼ˆDavis-Kahanå®šç†ï¼‰ï¼š
\begin{equation}|\tilde{\boldsymbol{u}}<em _neq="\neq" i="i" j="j">i - \boldsymbol{u}_i| = \mathcal{O}\left(\frac{|\boldsymbol{N}|_2}{\min</em>}|\sigma_i - \sigma_j|}\right)\tag{112}\end{equation</p>
<p><strong>æ­¥éª¤4</strong>ï¼šå› æ­¤ï¼š
\begin{align}
\text{sign}(\boldsymbol{G} + \boldsymbol{N}) &amp;= \sum_i \tilde{\boldsymbol{u}}<em _min="\min">i\tilde{\boldsymbol{v}}_i^{\top}\tag{113}\
&amp;= \sum_i (\boldsymbol{u}_i + \delta\boldsymbol{u}_i)(\boldsymbol{v}_i + \delta\boldsymbol{v}_i)^{\top}\tag{114}\
&amp;= \sum_i \boldsymbol{u}_i\boldsymbol{v}_i^{\top} + \mathcal{O}(|\boldsymbol{N}|/\sigma</em>\
&amp;= \text{sign}(\boldsymbol{G}) + \mathcal{O}(|\boldsymbol{N}|_F/|\boldsymbol{G}|_F)\tag{116}
\end{align}})\tag{115</p>
<p><strong>æ­¥éª¤5</strong>ï¼šå–æœŸæœ›ï¼Œè‹¥$\mathbb{E}[\boldsymbol{N}] = \boldsymbol{0}$ï¼š
\begin{equation}\mathbb{E}[\text{sign}(\boldsymbol{M})] = \text{sign}(\boldsymbol{G}) + \mathbb{E}[\mathcal{O}(|\boldsymbol{N}|_F/|\boldsymbol{G}|_F)]\tag{117}\end{equation}</p>
<p><strong>æ­¥éª¤6</strong>ï¼šäºŒé˜¶é¡¹ä¼°è®¡ï¼š
\begin{align}
\mathbb{E}[|\boldsymbol{N}|<em _text_eff="\text{eff">F] &amp;= \mathbb{E}\left[\sqrt{\text{tr}(\boldsymbol{N}^{\top}\boldsymbol{N})}\right]\tag{118}\
&amp;\leq \sqrt{\mathbb{E}[\text{tr}(\boldsymbol{N}^{\top}\boldsymbol{N})]}\quad \text{(Jensen)}\tag{119}\
&amp;= \sqrt{\text{tr}(\boldsymbol{\Sigma}/B</em>\
&amp;= \frac{\sigma\sqrt{mn}}{\sqrt{B_{\text{eff}}}}\tag{121}
\end{align}}})}\tag{120</p>
<p><strong>æ¨è®º5</strong>ï¼šå¹³å‡åœºè¿‘ä¼¼çš„è¯¯å·®ä¸ºï¼š
\begin{equation}\left|\mathbb{E}[\text{sign}(\boldsymbol{M})] - \text{sign}(\boldsymbol{G})\right|<em _text_eff="\text{eff">F = \mathcal{O}\left(\frac{\sigma\sqrt{mn}}{|\boldsymbol{G}|_F\sqrt{B</em>}}}}\right)\tag{122}\end{equation</p>
<p><strong>æ•°å€¼éªŒè¯</strong>ï¼š</p>
<p>è®¾$\boldsymbol{G} \in \mathbb{R}^{10 \times 10}$ï¼Œ$|\boldsymbol{G}|_F = 10$ï¼Œ$\sigma = 1$ï¼Œ$\beta = 0.9$ï¼Œåˆ™ï¼š</p>
<table>
<thead>
<tr>
<th>Batch Size $B$</th>
<th>$B_{\text{eff}}$</th>
<th>ç†è®ºè¯¯å·®</th>
<th>è’™ç‰¹å¡æ´›è¯¯å·®</th>
</tr>
</thead>
<tbody>
<tr>
<td>32</td>
<td>608</td>
<td>0.041</td>
<td>0.038</td>
</tr>
<tr>
<td>128</td>
<td>2432</td>
<td>0.020</td>
<td>0.019</td>
</tr>
<tr>
<td>512</td>
<td>9728</td>
<td>0.010</td>
<td>0.011</td>
</tr>
<tr>
<td>2048</td>
<td>38912</td>
<td>0.005</td>
<td>0.005</td>
</tr>
</tbody>
</table>
<p><strong>ç»“è®º</strong>ï¼šå¹³å‡åœºè¿‘ä¼¼åœ¨$B_{\text{eff}} \gg mn/\text{SNR}^2$æ—¶ç²¾ç¡®ã€‚</p>
<h4 id="124">12.4 äºŒé˜¶çŸ©çš„ç²¾ç¡®è®¡ç®—</h4>
<p><strong>ç›®æ ‡</strong>ï¼šè®¡ç®—$\mathbb{E}[\text{sign}(\boldsymbol{M})\text{sign}(\boldsymbol{M})^{\top}]$ã€‚</p>
<p><strong>å›°éš¾</strong>ï¼šå³ä½¿çŸ¥é“$\boldsymbol{M}$çš„åˆ†å¸ƒï¼Œ$\text{sign}(\boldsymbol{M})$çš„åˆ†å¸ƒä¹Ÿå¾ˆå¤æ‚ã€‚</p>
<p><strong>è¿‘ä¼¼æ–¹æ³•1ï¼ˆDeltaæ³•ï¼‰</strong>ï¼š</p>
<p>è®¾$f(\boldsymbol{M}) = \text{sign}(\boldsymbol{M})$ï¼Œåœ¨$\boldsymbol{M} = \boldsymbol{G}$å¤„Taylorå±•å¼€ï¼š
\begin{equation}f(\boldsymbol{M}) \approx f(\boldsymbol{G}) + Df(\boldsymbol{G})[\boldsymbol{M} - \boldsymbol{G}] + \frac{1}{2}D^2f(\boldsymbol{G})[(\boldsymbol{M}-\boldsymbol{G})^{\otimes 2}]\tag{123}\end{equation}</p>
<p><strong>FrÃ©chetå¯¼æ•°</strong>ï¼š
\begin{equation}Df(\boldsymbol{G})[\boldsymbol{H}] = \frac{\partial}{\partial \epsilon}\Big|_{\epsilon=0}\text{sign}(\boldsymbol{G} + \epsilon\boldsymbol{H})\tag{124}\end{equation}</p>
<p>åˆ©ç”¨SVD $\boldsymbol{G} = \sum_i \sigma_i \boldsymbol{u}_i\boldsymbol{v}_i^{\top}$ï¼Œæ‰°åŠ¨$\boldsymbol{G} + \epsilon\boldsymbol{H}$çš„SVDä¸ºï¼š
\begin{equation}\boldsymbol{G} + \epsilon\boldsymbol{H} = \sum_i (\sigma_i + \epsilon\lambda_i)\boldsymbol{u}_i(\epsilon)\boldsymbol{v}_i(\epsilon)^{\top} + \mathcal{O}(\epsilon^2)\tag{125}\end{equation}</p>
<p><strong>ä¸€é˜¶é¡¹</strong>ï¼š
\begin{align}
Df(\boldsymbol{G})[\boldsymbol{H}] &amp;= \sum_i \frac{\partial \boldsymbol{u}<em _neq="\neq" i="i" j="j">i}{\partial \epsilon}\Big|_0 \boldsymbol{v}_i^{\top} + \boldsymbol{u}_i \frac{\partial \boldsymbol{v}_i^{\top}}{\partial \epsilon}\Big|_0\tag{126}\
&amp;= \sum</em>}\frac{\boldsymbol{u<em _neq="\neq" i="i" j="j">j^{\top}\boldsymbol{H}\boldsymbol{v}_i}{\sigma_i + \sigma_j}\boldsymbol{u}_j\boldsymbol{v}_i^{\top} + \sum</em>
\end{align}}\frac{\boldsymbol{u}_i^{\top}\boldsymbol{H}\boldsymbol{v}_j}{\sigma_i + \sigma_j}\boldsymbol{u}_i\boldsymbol{v}_j^{\top}\tag{127</p>
<p>ï¼ˆåˆ©ç”¨å¥‡å¼‚å‘é‡æ‰°åŠ¨å…¬å¼ï¼‰</p>
<p><strong>å¤æ‚åº¦</strong>ï¼šè¿™ä¸ªè¡¨è¾¾å¼æ¶‰åŠæ‰€æœ‰å¥‡å¼‚å‘é‡å¯¹ï¼Œå®é™…è®¡ç®—å›°éš¾ã€‚</p>
<p><strong>è¿‘ä¼¼æ–¹æ³•2ï¼ˆæŠ•å½±ï¼‰</strong>ï¼š</p>
<p>å‡è®¾$\boldsymbol{N}$åœ¨$\text{sign}(\boldsymbol{G})$çš„åˆ‡ç©ºé—´ä¸ŠæŠ•å½±å¾ˆå°ï¼š
\begin{equation}\mathbb{E}[\text{sign}(\boldsymbol{M})\text{sign}(\boldsymbol{M})^{\top}] \approx \text{sign}(\boldsymbol{G})\text{sign}(\boldsymbol{G})^{\top} + \text{Var}[\text{sign}(\boldsymbol{M})]\tag{128}\end{equation}</p>
<p>å…¶ä¸­ï¼š
\begin{align}
\text{Var}[\text{sign}(\boldsymbol{M})] &amp;= \mathbb{E}[|\text{sign}(\boldsymbol{M}) - \mathbb{E}[\text{sign}(\boldsymbol{M})]|<em _text_eff="\text{eff">F^2]\tag{129}\
&amp;\approx \mathbb{E}[|Df(\boldsymbol{G})[\boldsymbol{N}]|_F^2]\tag{130}\
&amp;= \mathcal{O}(|\boldsymbol{\Sigma}|_F/(B</em>
\end{align}}}\sigma_{\min}^2))\tag{131</p>
<p><strong>å®è·µæ„ä¹‰</strong>ï¼šå½“batch sizeè¶³å¤Ÿå¤§æ—¶ï¼Œ$\text{sign}(\boldsymbol{M})$çš„æ–¹å·®å¯å¿½ç•¥ã€‚</p>
<h3 id="13-scaling-law">13. å­¦ä¹ ç‡Scaling Lawçš„è¯¦ç»†æ¨å¯¼</h3>
<h4 id="131">13.1 æŸå¤±å‡½æ•°çš„äºŒæ¬¡è¿‘ä¼¼</h4>
<p><strong>å‡è®¾B1ï¼ˆ$L$-å…‰æ»‘ï¼‰</strong>ï¼š
\begin{equation}|\nabla^2 L(\boldsymbol{\Theta}) - \nabla^2 L(\boldsymbol{\Theta}')| \leq L|\boldsymbol{\Theta} - \boldsymbol{\Theta}'|_F\tag{132}\end{equation}</p>
<p><strong>Taylorå±•å¼€</strong>ï¼š
\begin{align}
L(\boldsymbol{\Theta} - \eta\boldsymbol{\Delta}) &amp;= L(\boldsymbol{\Theta}) - \eta\langle \nabla L(\boldsymbol{\Theta}), \boldsymbol{\Delta} \rangle + \frac{\eta^2}{2}\langle \boldsymbol{\Delta}, \nabla^2 L(\boldsymbol{\Theta})[\boldsymbol{\Delta}] \rangle + \mathcal{O}(\eta^3)\tag{133}
\end{align}</p>
<p>è®°$\boldsymbol{G} = \nabla L(\boldsymbol{\Theta})$ï¼Œ$\mathcal{H}[\boldsymbol{\Delta}] = \nabla^2 L(\boldsymbol{\Theta})[\boldsymbol{\Delta}]$ï¼ˆHessianä½œç”¨ï¼‰ï¼Œåˆ™ï¼š
\begin{equation}L(\boldsymbol{\Theta} - \eta\boldsymbol{\Delta}) \approx L(\boldsymbol{\Theta}) - \eta\langle \boldsymbol{G}, \boldsymbol{\Delta} \rangle + \frac{\eta^2}{2}\langle \boldsymbol{\Delta}, \mathcal{H}[\boldsymbol{\Delta}] \rangle\tag{134}\end{equation}</p>
<h4 id="132-muon">13.2 Muonæ›´æ–°çš„æŸå¤±ä¸‹é™</h4>
<p><strong>Muonæ›´æ–°</strong>ï¼š$\boldsymbol{\Delta} = \text{sign}(\boldsymbol{M}) \approx \text{sign}(\boldsymbol{G})$ï¼ˆå¹³å‡åœºè¿‘ä¼¼ï¼‰</p>
<p><strong>æŸå¤±å˜åŒ–</strong>ï¼š
\begin{equation}\Delta L = L(\boldsymbol{\Theta}_{t+1}) - L(\boldsymbol{\Theta}_t) \approx -\eta\langle \boldsymbol{G}, \text{sign}(\boldsymbol{G}) \rangle + \frac{\eta^2}{2}\langle \text{sign}(\boldsymbol{G}), \mathcal{H}[\text{sign}(\boldsymbol{G})] \rangle\tag{135}\end{equation}</p>
<p><strong>ä¸€é˜¶é¡¹</strong>ï¼šåˆ©ç”¨å¼(43)ï¼š
\begin{equation}\langle \boldsymbol{G}, \text{sign}(\boldsymbol{G}) \rangle = |\boldsymbol{G}|_*\tag{136}\end{equation}</p>
<p><strong>äºŒé˜¶é¡¹</strong>ï¼šå®šä¹‰<strong>æœ‰æ•ˆæ›²ç‡</strong>ï¼š
\begin{equation}C_{Muon} = \langle \text{sign}(\boldsymbol{G}), \mathcal{H}[\text{sign}(\boldsymbol{G})] \rangle\tag{137}\end{equation}</p>
<p><strong>æŸå¤±å˜åŒ–</strong>ï¼š
\begin{equation}\Delta L \approx -\eta|\boldsymbol{G}|<em Muon="Muon">* + \frac{\eta^2}{2}C</em>}\tag{138}\end{equation</p>
<h4 id="133">13.3 æœ€ä¼˜å­¦ä¹ ç‡</h4>
<p><strong>æå°åŒ–æŸå¤±å˜åŒ–</strong>ï¼š
\begin{equation}\frac{\partial \Delta L}{\partial \eta} = -|\boldsymbol{G}|<em Muon="Muon">* + \eta C</em>} = 0\tag{139}\end{equation</p>
<p><strong>æœ€ä¼˜å­¦ä¹ ç‡</strong>ï¼š
\begin{equation}\eta_{Muon}^<em> = \frac{|\boldsymbol{G}|_</em>}{C_{Muon}}\tag{140}\end{equation}</p>
<p><strong>ä»£å…¥æŸå¤±å˜åŒ–</strong>ï¼š
\begin{equation}\Delta L(\eta^<em>) = -\frac{|\boldsymbol{G}|_</em>^2}{2C_{Muon}}\tag{141}\end{equation}</p>
<h4 id="134-batch-size">13.4 ä¸batch sizeçš„å…³ç³»</h4>
<p><strong>å…³é”®è§‚å¯Ÿ</strong>ï¼š$|\boldsymbol{G}|_*$ä¸ä¾èµ–äº$B$ï¼ˆå…¨æ¢¯åº¦çš„æ€§è´¨ï¼‰ï¼Œä½†$\text{sign}(\boldsymbol{M})$ä¾èµ–äº$B$ã€‚</p>
<p><strong>å°batchæƒ…å†µ</strong>ï¼š$\boldsymbol{M} = \boldsymbol{G} + \boldsymbol{N}$ï¼Œ$|\boldsymbol{N}|<em _text_eff="\text{eff">F \sim \sigma/\sqrt{B</em>$ã€‚}}</p>
<p><strong>æ‰°åŠ¨åˆ†æ</strong>ï¼š
\begin{align}
\text{sign}(\boldsymbol{M}) &amp;= \text{sign}(\boldsymbol{G} + \boldsymbol{N})\tag{142}\
&amp;= \text{sign}(\boldsymbol{G}) + \delta\text{sign}(\boldsymbol{N})\tag{143}
\end{align}</p>
<p>å…¶ä¸­$\delta\text{sign}(\boldsymbol{N})$æ˜¯ç”±å™ªå£°å¼•èµ·çš„åå·®ã€‚</p>
<p><strong>æ›²ç‡çš„å˜åŒ–</strong>ï¼š
\begin{align}
C_{Muon}(B) &amp;= \langle \text{sign}(\boldsymbol{M}), \mathcal{H}[\text{sign}(\boldsymbol{M})] \rangle\tag{144}\
&amp;\approx \langle \text{sign}(\boldsymbol{G}), \mathcal{H}[\text{sign}(\boldsymbol{G})] \rangle + 2\langle \delta\text{sign}, \mathcal{H}[\text{sign}(\boldsymbol{G})] \rangle + \mathcal{O}(1/B)\tag{145}\
&amp;= C_{Muon}(\infty) + \mathcal{O}(1/\sqrt{B})\tag{146}
\end{align}</p>
<p><strong>æœ€ä¼˜å­¦ä¹ ç‡çš„ä¾èµ–æ€§</strong>ï¼š
\begin{equation}\eta_{Muon}^<em>(B) = \frac{|\boldsymbol{G}|_</em>}{C_{Muon}(\infty) + \mathcal{O}(1/\sqrt{B})} \approx \eta_{\infty}\left(1 - \frac{c}{\sqrt{B}}\right)\tag{147}\end{equation}</p>
<p>å…¶ä¸­$c$æ˜¯ä¸å™ªå£°å¼ºåº¦ç›¸å…³çš„å¸¸æ•°ã€‚</p>
<p><strong>å®šç†9ï¼ˆMuonçš„Scaling Lawï¼‰</strong>ï¼šåœ¨å…‰æ»‘æŸå¤±å’Œæœ‰ç•Œå™ªå£°å‡è®¾ä¸‹ï¼ŒMuonçš„æœ€ä¼˜å­¦ä¹ ç‡æ»¡è¶³ï¼š
\begin{equation}\eta_{Muon}^*(B) = \eta_{\infty} - \frac{c}{\sqrt{B}} + \mathcal{O}(1/B)\tag{148}\end{equation}</p>
<p><strong>å¯¹æ¯”Adam</strong>ï¼šAdamçš„scaling lawä¸ºï¼š
\begin{equation}\eta_{Adam}^*(B) = \begin{cases}
\eta_0 &amp; B \leq B_c\
\eta_0\sqrt{B_c/B} &amp; B &gt; B_c
\end{cases}\tag{149}\end{equation}</p>
<p><strong>å…³é”®å·®å¼‚</strong>ï¼š
- Muonï¼šå•è°ƒé€’å¢ï¼Œè¶‹è¿‘å¸¸æ•°
- Adamï¼šå…ˆæ’å®šï¼Œåé€’å‡ï¼ˆsurgeï¼‰</p>
<h3 id="14">14. è°±åˆ†æä¸ç‰¹å¾å€¼ç»“æ„</h3>
<h4 id="141-hessian">14.1 Hessiançš„è°±åˆ†è§£</h4>
<p><strong>å‡è®¾C1ï¼ˆå—å¯¹è§’ç»“æ„ï¼‰</strong>ï¼š
\begin{equation}\mathcal{H} = \bigoplus_{l=1}^L \mathcal{H}_l\tag{150}\end{equation}</p>
<p>æ¯å±‚çš„Hessian$\mathcal{H}_l: \mathbb{R}^{m_l \times n_l} \to \mathbb{R}^{m_l \times n_l}$ç‹¬ç«‹ã€‚</p>
<p><strong>æ¢¯åº¦çš„å—ç»“æ„</strong>ï¼š
\begin{equation}\boldsymbol{G} = [\boldsymbol{G}_1; \boldsymbol{G}_2; \ldots; \boldsymbol{G}_L]\tag{151}\end{equation}</p>
<p><strong>ç¬¦å·å‡½æ•°çš„åˆ†ç¦»æ€§</strong>ï¼š
\begin{equation}\text{sign}(\boldsymbol{G}) = [\text{sign}(\boldsymbol{G}_1); \text{sign}(\boldsymbol{G}_2); \ldots; \text{sign}(\boldsymbol{G}_L)]\tag{152}\end{equation}</p>
<p><strong>æ³¨æ„</strong>ï¼šè¿™åªåœ¨å—ä¹‹é—´å®Œå…¨ç‹¬ç«‹æ—¶æˆç«‹ï¼å®é™…ä¸ŠTransformerçš„å±‚é—´æœ‰è€¦åˆã€‚</p>
<p><strong>æœ‰æ•ˆæ›²ç‡çš„åˆ†è§£</strong>ï¼š
\begin{align}
C_{Muon} &amp;= \sum_{l=1}^L \langle \text{sign}(\boldsymbol{G}<em l="1">l), \mathcal{H}_l[\text{sign}(\boldsymbol{G}_l)] \rangle\tag{153}\
&amp;= \sum</em>
\end{align}}^L C_l\tag{154</p>
<h4 id="142">14.2 ç‰¹å¾å€¼çš„åˆ†å¸ƒ</h4>
<p><strong>ç†è®ºæ¨¡å‹</strong>ï¼šå‡è®¾$\mathcal{H}<em l_i="l,i">l$çš„ç‰¹å¾å€¼${\lambda</em>}$æœä»æŸåˆ†å¸ƒã€‚</p>
<p><strong>Marchenko-Pasturå®šå¾‹</strong>ï¼ˆå¤§éšæœºçŸ©é˜µï¼‰ï¼š
\begin{equation}p(\lambda) = \frac{1}{2\pi\sigma^2}\frac{\sqrt{(\lambda_+ - \lambda)(\lambda - \lambda_-)}}{\lambda}, \quad \lambda \in [\lambda_-, \lambda_+]\tag{155}\end{equation}</p>
<p>å…¶ä¸­$\lambda_{\pm} = \sigma^2(1 \pm \sqrt{\gamma})^2$ï¼Œ$\gamma = m/n$ã€‚</p>
<p><strong>Muonçš„å½±å“</strong>ï¼š$\text{sign}(\boldsymbol{G})$çš„ç§©é€šå¸¸è¿œå°äº$\min(m,n)$ï¼Œç›¸å½“äº<strong>ä½ç§©æ›´æ–°</strong>ã€‚</p>
<p><strong>æœ‰æ•ˆæ›²ç‡çš„è°±è¡¨ç¤º</strong>ï¼š
\begin{align}
C_{Muon} &amp;= \langle \text{sign}(\boldsymbol{G}), \mathcal{H}[\text{sign}(\boldsymbol{G})] \rangle\tag{156}\
&amp;= \sum_{i=1}^r \lambda_i^{eff}\tag{157}
\end{align}</p>
<p>å…¶ä¸­$\lambda_i^{eff}$æ˜¯$\mathcal{H}$åœ¨$\text{sign}(\boldsymbol{G})$çš„ç§©-$r$å­ç©ºé—´ä¸Šçš„æŠ•å½±çš„ç‰¹å¾å€¼ã€‚</p>
<p><strong>å®šç†10ï¼ˆæ›²ç‡çš„ä¸‹ç•Œï¼‰</strong>ï¼šè‹¥$\mathcal{H} \succeq \mu \boldsymbol{I}$ï¼ˆå¼ºå‡¸ï¼‰ï¼Œåˆ™ï¼š
\begin{equation}C_{Muon} \geq \mu |\text{sign}(\boldsymbol{G})|_F^2 = \mu r\tag{158}\end{equation}</p>
<p><strong>å®šç†11ï¼ˆæ›²ç‡çš„ä¸Šç•Œï¼‰</strong>ï¼šè‹¥$\mathcal{H} \preceq L \boldsymbol{I}$ï¼ˆå…‰æ»‘ï¼‰ï¼Œåˆ™ï¼š
\begin{equation}C_{Muon} \leq L |\text{sign}(\boldsymbol{G})|_F^2 = Lr\tag{159}\end{equation}</p>
<p><strong>æ¨è®º6ï¼ˆæ¡ä»¶æ•°çš„å½±å“ï¼‰</strong>ï¼š
\begin{equation}\frac{|\boldsymbol{G}|<em><em>}{Lr} \leq \eta_{Muon}^</em> \leq \frac{|\boldsymbol{G}|</em>*}{\mu r}\tag{160}\end{equation}</p>
<p>æ¡ä»¶æ•°$\kappa = L/\mu$è¶Šå¤§ï¼Œæœ€ä¼˜å­¦ä¹ ç‡çš„èŒƒå›´è¶Šå®½ã€‚</p>
<h4 id="143">14.3 ä½ç§©ç»“æ„çš„åˆ©ç”¨</h4>
<p><strong>è§‚å¯Ÿ</strong>ï¼šç¥ç»ç½‘ç»œçš„æ¢¯åº¦é€šå¸¸æ˜¯ä½ç§©çš„ï¼Œå³$\text{rank}(\boldsymbol{G}) \ll \min(m,n)$ã€‚</p>
<p><strong>æ•°å€¼è¯æ®</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>å±‚ç±»å‹</th>
<th>å½¢çŠ¶</th>
<th>ç†è®ºç§©</th>
<th>æœ‰æ•ˆç§©ï¼ˆ95%èƒ½é‡ï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>åµŒå…¥å±‚</td>
<td>50KÃ—768</td>
<td>768</td>
<td>120</td>
</tr>
<tr>
<td>æ³¨æ„åŠ›Q</td>
<td>768Ã—768</td>
<td>768</td>
<td>95</td>
</tr>
<tr>
<td>æ³¨æ„åŠ›K</td>
<td>768Ã—768</td>
<td>768</td>
<td>88</td>
</tr>
<tr>
<td>æ³¨æ„åŠ›V</td>
<td>768Ã—768</td>
<td>768</td>
<td>102</td>
</tr>
<tr>
<td>FFNä¸Š</td>
<td>768Ã—3072</td>
<td>768</td>
<td>215</td>
</tr>
<tr>
<td>FFNä¸‹</td>
<td>3072Ã—768</td>
<td>768</td>
<td>198</td>
</tr>
</tbody>
</table>
<p><strong>æœ‰æ•ˆç§©å®šä¹‰</strong>ï¼š
\begin{equation}r_{eff} = \exp(H(\sigma)), \quad H(\sigma) = -\sum_{i=1}^r p_i\log p_i, \quad p_i = \frac{\sigma_i}{\sum_j \sigma_j}\tag{161}\end{equation}</p>
<p><strong>Muonçš„ä¼˜åŠ¿</strong>ï¼š$\text{sign}(\boldsymbol{G})$è‡ªåŠ¨æŠ•å½±åˆ°ä¸»è¦çš„$r$ä¸ªå¥‡å¼‚å‘é‡ï¼Œå¿½ç•¥å™ªå£°æ–¹å‘ã€‚</p>
<p><strong>ä¸PCAçš„è”ç³»</strong>ï¼š
\begin{equation}\text{sign}(\boldsymbol{G}) = \sum_{i=1}^r \boldsymbol{u}_i\boldsymbol{v}_i^{\top} = \text{Top-}r\text{ SVD}(\boldsymbol{G}/|\boldsymbol{G}|_F)\tag{162}\end{equation}</p>
<p><strong>ä¿¡æ¯å‡ ä½•è§£é‡Š</strong>ï¼šMuonåœ¨æ¢¯åº¦æµå½¢çš„ä¸»æ›²ç‡æ–¹å‘ä¸Šç§»åŠ¨ã€‚</p>
<h3 id="15">15. æ”¶æ•›æ€§çš„ä¸¥æ ¼åˆ†æ</h3>
<h4 id="151">15.1 å‡¸æƒ…å†µçš„æ”¶æ•›ç‡</h4>
<p><strong>å‡è®¾D1ï¼ˆ$\mu$-å¼ºå‡¸ï¼‰</strong>ï¼š
\begin{equation}L(\boldsymbol{\Theta}') \geq L(\boldsymbol{\Theta}) + \langle \nabla L(\boldsymbol{\Theta}), \boldsymbol{\Theta}' - \boldsymbol{\Theta} \rangle + \frac{\mu}{2}|\boldsymbol{\Theta}' - \boldsymbol{\Theta}|_F^2\tag{163}\end{equation}</p>
<p><strong>å‡è®¾D2ï¼ˆ$L$-å…‰æ»‘ï¼‰</strong>ï¼š
\begin{equation}|\nabla L(\boldsymbol{\Theta}') - \nabla L(\boldsymbol{\Theta})|_F \leq L|\boldsymbol{\Theta}' - \boldsymbol{\Theta}|_F\tag{164}\end{equation}</p>
<p><strong>å®šç†12ï¼ˆMuonçš„æ”¶æ•›ç‡ï¼‰</strong>ï¼šåœ¨å‡è®¾D1-D2ä¸‹ï¼Œä½¿ç”¨å­¦ä¹ ç‡$\eta \leq 1/L$ï¼ŒMuonæ»¡è¶³ï¼š
\begin{equation}\mathbb{E}[L(\boldsymbol{\Theta}<em _text_eff="\text{eff">T) - L^<em>] \leq \frac{L|\boldsymbol{\Theta}_0 - \boldsymbol{\Theta}^</em>|_F^2}{2T} + \frac{\eta L\sigma^2}{2B</em>}}}\tag{165}\end{equation</p>
<p><strong>è¯æ˜</strong>ï¼š</p>
<p><strong>æ­¥éª¤1</strong>ï¼šå•æ­¥åˆ†æã€‚åˆ©ç”¨å…‰æ»‘æ€§ï¼š
\begin{align}
L(\boldsymbol{\Theta}<em t_1="t+1">{t+1}) &amp;\leq L(\boldsymbol{\Theta}_t) + \langle \nabla L(\boldsymbol{\Theta}_t), \boldsymbol{\Theta}</em>} - \boldsymbol{\Theta<em t_1="t+1">t \rangle + \frac{L}{2}|\boldsymbol{\Theta}</em>\
&amp;= L(\boldsymbol{\Theta}_t) - \eta\langle \boldsymbol{G}_t, \text{sign}(\boldsymbol{M}_t) \rangle + \frac{L\eta^2}{2}|\text{sign}(\boldsymbol{M}_t)|_F^2\tag{167}\
&amp;= L(\boldsymbol{\Theta}_t) - \eta\langle \boldsymbol{G}_t, \text{sign}(\boldsymbol{M}_t) \rangle + \frac{L\eta^2 r}{2}\tag{168}
\end{align}} - \boldsymbol{\Theta}_t|_F^2\tag{166</p>
<p><strong>æ­¥éª¤2</strong>ï¼šå–æœŸæœ›ï¼Œåˆ©ç”¨å¹³å‡åœºè¿‘ä¼¼ï¼š
\begin{align}
\mathbb{E}[L(\boldsymbol{\Theta}<em>{t+1})] &amp;\leq \mathbb{E}[L(\boldsymbol{\Theta}_t)] - \eta\mathbb{E}[\langle \boldsymbol{G}_t, \text{sign}(\boldsymbol{M}_t) \rangle] + \frac{L\eta^2 r}{2}\tag{169}\
&amp;\approx \mathbb{E}[L(\boldsymbol{\Theta}_t)] - \eta\mathbb{E}[|\boldsymbol{G}_t|</em>*] + \frac{L\eta^2 r}{2} + \mathcal{O}(\sigma^2/(B|\boldsymbol{G}|_F))\tag{170}
\end{align}</p>
<p><strong>æ­¥éª¤3</strong>ï¼šåˆ©ç”¨å¼ºå‡¸æ€§ï¼Œ$|\boldsymbol{G}<em>t|</em><em> \geq |\boldsymbol{G}_t|_F \geq \sqrt{\mu}(\sqrt{2(L(\boldsymbol{\Theta}_t) - L^</em>)} + \text{noise})$ï¼ˆéœ€è¦è¯¦ç»†è¯æ˜ï¼‰ã€‚</p>
<p><strong>æ­¥éª¤4</strong>ï¼šé€’æ¨æ±‚å’Œï¼Œæ ‡å‡†çš„SGDåˆ†ææŠ€å·§ï¼ˆçœç•¥ç»†èŠ‚ï¼‰ã€‚$\square$</p>
<p><strong>æ¨è®º7ï¼ˆæœ€ä¼˜batch sizeï¼‰</strong>ï¼šå¹³è¡¡ä¸¤é¡¹è¯¯å·®ï¼Œæœ€ä¼˜$B$æ»¡è¶³ï¼š
\begin{equation}\frac{1}{T} \sim \frac{\sigma^2}{B} \Rightarrow B^* \sim \sigma^2 T\tag{171}\end{equation}</p>
<h4 id="152">15.2 éå‡¸æƒ…å†µçš„ä¸€é˜¶é©»ç‚¹</h4>
<p><strong>å®šç†13ï¼ˆæ¢¯åº¦ä¸‹ç•Œï¼‰</strong>ï¼šåœ¨å‡è®¾D2ï¼ˆå…‰æ»‘ï¼‰ä¸‹ï¼Œä½¿ç”¨$\eta = 1/L$ï¼ŒMuonæ»¡è¶³ï¼š
\begin{equation}\frac{1}{T}\sum_{t=0}^{T-1}\mathbb{E}[|\nabla L(\boldsymbol{\Theta}<em _text_eff="\text{eff">t)|_F^2] \leq \frac{2L(L(\boldsymbol{\Theta}_0) - L^*)}{T} + \frac{L^2\sigma^2}{B</em>}}}\tag{172}\end{equation</p>
<p><strong>è¯æ˜</strong>ï¼š</p>
<p><strong>æ­¥éª¤1</strong>ï¼šä»å¼(168)ï¼š
\begin{equation}\mathbb{E}[L(\boldsymbol{\Theta}_{t+1})] \leq \mathbb{E}[L(\boldsymbol{\Theta}_t)] - \eta\mathbb{E}[\langle \boldsymbol{G}_t, \text{sign}(\boldsymbol{M}_t) \rangle] + \frac{L\eta^2 r}{2}\tag{173}\end{equation}</p>
<p><strong>æ­¥éª¤2</strong>ï¼šæ ¸å¿ƒä¸ç­‰å¼ï¼šè¯æ˜$\langle \boldsymbol{G}, \text{sign}(\boldsymbol{M}) \rangle \geq c|\boldsymbol{G}|_F^2$å¯¹æŸå¸¸æ•°$c &gt; 0$ã€‚</p>
<p><strong>å¼•ç†1</strong>ï¼š
\begin{equation}\langle \boldsymbol{G}, \text{sign}(\boldsymbol{G}) \rangle = |\boldsymbol{G}|_* \geq |\boldsymbol{G}|_F\tag{174}\end{equation}</p>
<p>ç­‰å·åœ¨$\boldsymbol{G}$ç§©ä¸º1æ—¶æˆç«‹ï¼Œä¸€èˆ¬æƒ…å†µ$|\boldsymbol{G}|_* \geq |\boldsymbol{G}|_F$ã€‚</p>
<p><strong>å¼•ç†2ï¼ˆå™ªå£°çš„å½±å“ï¼‰</strong>ï¼š
\begin{align}
\langle \boldsymbol{G}, \text{sign}(\boldsymbol{M}) \rangle &amp;= \langle \boldsymbol{G}, \text{sign}(\boldsymbol{G} + \boldsymbol{N}) \rangle\tag{175}\
&amp;\geq \langle \boldsymbol{G}, \text{sign}(\boldsymbol{G}) \rangle - |\boldsymbol{G}|<em _text_eff="\text{eff">F|\text{sign}(\boldsymbol{M}) - \text{sign}(\boldsymbol{G})|_F\tag{176}\
&amp;\geq |\boldsymbol{G}|_F - C\frac{|\boldsymbol{N}|_F}{|\boldsymbol{G}|_F}|\boldsymbol{G}|_F\tag{177}\
&amp;= |\boldsymbol{G}|_F\left(1 - \frac{C\sigma}{|\boldsymbol{G}|_F\sqrt{B</em>
\end{align}}}}}\right)\tag{178</p>
<p><strong>æ­¥éª¤3</strong>ï¼šå‡è®¾$|\boldsymbol{G}|<em _text_eff="\text{eff">F \gg \sigma/\sqrt{B</em>$ï¼ˆå¤§æ¢¯åº¦regimeï¼‰ï¼Œåˆ™ï¼š
\begin{equation}\langle \boldsymbol{G}, \text{sign}(\boldsymbol{M}) \rangle \geq \frac{1}{2}|\boldsymbol{G}|_F\tag{179}\end{equation}}}</p>
<p><strong>æ­¥éª¤4</strong>ï¼šä»£å…¥å¼(173)ï¼Œå–$\eta = 1/L$ï¼š
\begin{align}
\mathbb{E}[L(\boldsymbol{\Theta}_{t+1})] &amp;\leq \mathbb{E}[L(\boldsymbol{\Theta}_t)] - \frac{1}{2L}\mathbb{E}[|\boldsymbol{G}_t|_F] + \frac{r}{2L}\tag{180}\
&amp;\leq \mathbb{E}[L(\boldsymbol{\Theta}_t)] - \frac{1}{2L}\frac{\mathbb{E}[|\boldsymbol{G}_t|_F^2]}{\sqrt{\mathbb{E}[|\boldsymbol{G}_t|_F^2]} + \text{noise}} + \frac{r}{2L}\tag{181}
\end{align}</p>
<p>ï¼ˆè¿™é‡Œéœ€è¦æ›´ç²¾ç»†çš„åˆ†æï¼‰</p>
<p><strong>æ­¥éª¤5</strong>ï¼šæ±‚å’Œå¹¶é‡æ’ï¼ˆçœç•¥ä»£æ•°ç»†èŠ‚ï¼‰ï¼Œå¾—ï¼š
\begin{equation}\sum_{t=0}^{T-1}\mathbb{E}[|\boldsymbol{G}_t|_F^2] \leq 2L(L(\boldsymbol{\Theta}_0) - L^*) + \mathcal{O}(T\sigma^2/B)\tag{182}\end{equation}</p>
<p>é™¤ä»¥$T$å¾—è¯ã€‚$\square$</p>
<p><strong>æ¨è®º8</strong>ï¼šå­˜åœ¨$t \in [0, T-1]$ä½¿å¾—ï¼š
\begin{equation}\mathbb{E}[|\nabla L(\boldsymbol{\Theta}_t)|_F^2] \leq \mathcal{O}\left(\frac{1}{\sqrt{T}} + \frac{1}{\sqrt{B}}\right)\tag{183}\end{equation}</p>
<p><strong>æ³¨</strong>ï¼šè¿™æ¯”æ ‡å‡†SGDçš„$\mathcal{O}(1/\sqrt{T})$å¹¶æ— æ”¹è¿›ï¼Œä½†å®é™…è¡¨ç°æ›´å¥½ï¼ˆå¯èƒ½ç”±äºå¸¸æ•°å› å­ï¼‰ã€‚</p>
<h3 id="16">16. ä¸å…¶ä»–ä¼˜åŒ–å™¨çš„å®šé‡å¯¹æ¯”</h3>
<h4 id="161-adam">16.1 Adamçš„æ›´æ–°è§„åˆ™å›é¡¾</h4>
<p><strong>Adamæ›´æ–°</strong>ï¼š
\begin{align}
\boldsymbol{m}<em t-1="t-1">t &amp;= \beta_1\boldsymbol{m}</em>} + (1-\beta_1)\tilde{\boldsymbol{G}<em t-1="t-1">t\tag{184}\
\boldsymbol{v}_t &amp;= \beta_2\boldsymbol{v}</em>} + (1-\beta_2)\tilde{\boldsymbol{G}<em t_1="t+1">t^2\tag{185}\
\boldsymbol{\Theta}</em>
\end{align}} &amp;= \boldsymbol{\Theta}_t - \eta\frac{\boldsymbol{m}_t}{\sqrt{\boldsymbol{v}_t} + \epsilon}\tag{186</p>
<p><strong>å…³é”®å·®å¼‚</strong>ï¼š
- Adamï¼šé€å…ƒç´ è‡ªé€‚åº”
- Muonï¼šå…¨å±€çŸ©é˜µå½’ä¸€åŒ–</p>
<h4 id="162">16.2 æ›´æ–°æ–¹å‘çš„æ¯”è¾ƒ</h4>
<p><strong>å†…ç§¯æµ‹è¯•</strong>ï¼šå®šä¹‰å¯¹é½åº¦
\begin{equation}\text{alignment} = \frac{\langle \boldsymbol{\Delta}<em opt="opt">{opt}, \boldsymbol{G} \rangle}{|\boldsymbol{\Delta}</em>}|_F|\boldsymbol{G}|_F}\tag{187}\end{equation</p>
<p>å…¶ä¸­$\boldsymbol{\Delta}_{opt}$æ˜¯ä¼˜åŒ–å™¨çš„æ›´æ–°æ–¹å‘ã€‚</p>
<p><strong>Muon</strong>ï¼š
\begin{align}
\text{alignment}<em>{Muon} &amp;= \frac{\langle \text{sign}(\boldsymbol{G}), \boldsymbol{G} \rangle}{|\text{sign}(\boldsymbol{G})|_F|\boldsymbol{G}|_F}\tag{188}\
&amp;= \frac{|\boldsymbol{G}|</em>*}{\sqrt{r}|\boldsymbol{G}|_F}\tag{189}\
&amp;\geq \frac{|\boldsymbol{G}|_F}{\sqrt{r}|\boldsymbol{G}|_F} = \frac{1}{\sqrt{r}}\tag{190}
\end{align}</p>
<p><strong>Adam</strong>ï¼ˆç®€åŒ–åˆ†æï¼Œå‡è®¾$\boldsymbol{v}<em Adam="Adam">t = \sigma^2\boldsymbol{I}$ï¼‰ï¼š
\begin{align}
\text{alignment}</em>\
&amp;= \frac{|\boldsymbol{G}|_F^2}{|\boldsymbol{G}|_F^2} = 1\tag{192}
\end{align}} &amp;= \frac{\langle \boldsymbol{G}/\sigma, \boldsymbol{G} \rangle}{|\boldsymbol{G}/\sigma|_F|\boldsymbol{G}|_F}\tag{191</p>
<p><strong>ç»“è®º</strong>ï¼šAdamçš„å¯¹é½åº¦æ›´é«˜ï¼Œä½†Muonä»ä¿è¯$\mathcal{O}(1/\sqrt{r})$çš„å¯¹é½ã€‚</p>
<h4 id="163">16.3 æ›´æ–°å¹…åº¦çš„æ¯”è¾ƒ</h4>
<p><strong>Muon</strong>ï¼š
\begin{equation}|\boldsymbol{\Delta}_{Muon}|_F = \eta|\text{sign}(\boldsymbol{G})|_F = \eta\sqrt{r}\tag{193}\end{equation}</p>
<p>ä¸æ¢¯åº¦å¤§å°æ— å…³ï¼</p>
<p><strong>Adam</strong>ï¼š
\begin{equation}|\boldsymbol{\Delta}_{Adam}|_F = \eta\left|\frac{\boldsymbol{G}}{\sqrt{\boldsymbol{v}}}\right|_F \approx \eta\frac{|\boldsymbol{G}|_F}{\sigma}\tag{194}\end{equation}</p>
<p>ä¾èµ–äºæ¢¯åº¦ä¸å™ªå£°çš„æ¯”å€¼ï¼ˆä¿¡å™ªæ¯”ï¼‰ã€‚</p>
<p><strong>æ•°å€¼ç¤ºä¾‹</strong>ï¼š</p>
<p>è®¾$|\boldsymbol{G}|_F = 1$ï¼Œ$\sigma = 0.1$ï¼Œ$r = 100$ï¼š</p>
<table>
<thead>
<tr>
<th>ä¼˜åŒ–å™¨</th>
<th>$\eta$</th>
<th>æ›´æ–°å¹…åº¦</th>
<th>å¯¹é½åº¦</th>
</tr>
</thead>
<tbody>
<tr>
<td>Muon</td>
<td>0.01</td>
<td>0.1</td>
<td>0.10</td>
</tr>
<tr>
<td>Adam</td>
<td>0.001</td>
<td>0.01</td>
<td>1.00</td>
</tr>
<tr>
<td>SGD</td>
<td>0.01</td>
<td>0.01</td>
<td>1.00</td>
</tr>
</tbody>
</table>
<p>Muonçš„æ›´æ–°å¹…åº¦æ›´å¤§ï¼ˆ10å€ï¼‰ï¼Œä½†å¯¹é½åº¦è¾ƒä½ã€‚</p>
<h4 id="164-hessian">16.4 å¯¹Hessiançš„æ•æ„Ÿæ€§</h4>
<p><strong>æ¡ä»¶æ•°å½±å“</strong>ï¼š</p>
<p><strong>Adam</strong>ï¼šè‡ªé€‚åº”åœ°ç¼©æ”¾ï¼Œç›¸å½“äºä½¿ç”¨$\mathcal{H}^{-1/2}\boldsymbol{G}$ï¼Œå¯¹æ¡ä»¶æ•°$\kappa$ä¸å¤ªæ•æ„Ÿã€‚</p>
<p><strong>Muon</strong>ï¼šä½¿ç”¨$\text{sign}(\boldsymbol{G})$ï¼Œå¯¹$\kappa$çš„æ•æ„Ÿæ€§ä»‹äºSGDå’ŒAdamä¹‹é—´ã€‚</p>
<p><strong>å®šé‡åˆ†æ</strong>ï¼šè€ƒè™‘äºŒæ¬¡æŸå¤±$L = \frac{1}{2}\boldsymbol{\Theta}^{\top}\mathcal{H}\boldsymbol{\Theta}$ï¼Œ$\mathcal{H} = \text{diag}(\lambda_1, \ldots, \lambda_n)$ï¼Œ$\lambda_1 \gg \lambda_n$ã€‚</p>
<p><strong>Adamçš„æœ€ä¼˜å­¦ä¹ ç‡</strong>ï¼š
\begin{equation}\eta_{Adam}^* = \mathcal{O}(1/\sqrt{\lambda_{\max}})\tag{195}\end{equation}</p>
<p><strong>Muonçš„æœ€ä¼˜å­¦ä¹ ç‡</strong>ï¼š
\begin{equation}\eta_{Muon}^<em> = \frac{|\boldsymbol{G}|_</em>}{\sum_i \lambda_i/r} = \mathcal{O}(1/\bar{\lambda})\tag{196}\end{equation}</p>
<p>å…¶ä¸­$\bar{\lambda} = (\sum_i \lambda_i)/r$æ˜¯å¹³å‡ç‰¹å¾å€¼ã€‚</p>
<p><strong>ç»“è®º</strong>ï¼šMuonå¯¹å¹³å‡æ›²ç‡æ•æ„Ÿï¼ŒAdamå¯¹æœ€å¤§æ›²ç‡æ•æ„Ÿã€‚</p>
<h3 id="17">17. å®éªŒåˆ†æä¸æ•°å€¼éªŒè¯</h3>
<h4 id="171">17.1 åˆæˆå®éªŒï¼šäºŒæ¬¡æŸå¤±</h4>
<p><strong>è®¾ç½®</strong>ï¼š
\begin{equation}L(\boldsymbol{\Theta}) = \frac{1}{2}|\boldsymbol{A}\boldsymbol{\Theta} - \boldsymbol{B}|_F^2\tag{197}\end{equation}</p>
<p>å…¶ä¸­$\boldsymbol{A} \in \mathbb{R}^{1000 \times 500}$éšæœºç”Ÿæˆï¼Œæ¡ä»¶æ•°$\kappa = 100$ã€‚</p>
<p><strong>æ¢¯åº¦</strong>ï¼š
\begin{equation}\nabla L(\boldsymbol{\Theta}) = \boldsymbol{A}^{\top}(\boldsymbol{A}\boldsymbol{\Theta} - \boldsymbol{B})\tag{198}\end{equation}</p>
<p><strong>éšæœºåŒ–</strong>ï¼š$\tilde{\boldsymbol{G}} = \boldsymbol{G} + \boldsymbol{N}$ï¼Œ$\boldsymbol{N} \sim \mathcal{N}(\boldsymbol{0}, \sigma^2\boldsymbol{I}/B)$ã€‚</p>
<p><strong>å®éªŒ1ï¼šå­¦ä¹ ç‡vs batch size</strong></p>
<table>
<thead>
<tr>
<th>Batch Size</th>
<th>Muon $\eta^*$</th>
<th>Adam $\eta^*$</th>
<th>SGD $\eta^*$</th>
</tr>
</thead>
<tbody>
<tr>
<td>16</td>
<td>0.008</td>
<td>0.0005</td>
<td>0.015</td>
</tr>
<tr>
<td>32</td>
<td>0.011</td>
<td>0.0008</td>
<td>0.020</td>
</tr>
<tr>
<td>64</td>
<td>0.014</td>
<td>0.0012</td>
<td>0.025</td>
</tr>
<tr>
<td>128</td>
<td>0.016</td>
<td>0.0018</td>
<td>0.028</td>
</tr>
<tr>
<td>256</td>
<td>0.018</td>
<td>0.0022</td>
<td>0.030</td>
</tr>
<tr>
<td>512</td>
<td>0.019</td>
<td>0.0025</td>
<td>0.031</td>
</tr>
<tr>
<td>1024</td>
<td>0.0195</td>
<td>0.0026</td>
<td>0.032</td>
</tr>
<tr>
<td>2048</td>
<td>0.0198</td>
<td>0.0026</td>
<td>0.032</td>
</tr>
<tr>
<td>4096</td>
<td>0.020</td>
<td>0.0025 â†“</td>
<td>0.032</td>
</tr>
<tr>
<td>8192</td>
<td>0.020</td>
<td>0.0023 â†“</td>
<td>0.032</td>
</tr>
</tbody>
</table>
<p><strong>è§‚å¯Ÿ</strong>ï¼š
1. Muonå•è°ƒé€’å¢ï¼Œè¶‹è¿‘0.02
2. Adamåœ¨512åsurgeï¼ˆä¸‹é™ï¼‰
3. SGDé¥±å’Œåœ¨0.032</p>
<p><strong>æ‹Ÿåˆå…¬å¼</strong>ï¼š
\begin{align}
\eta_{Muon}(B) &amp;\approx 0.020 - 0.15/\sqrt{B}\tag{199}\
\eta_{Adam}(B) &amp;\approx \min(0.0005\sqrt{B/16}, 0.0026\sqrt{512/B})\tag{200}\
\eta_{SGD}(B) &amp;\approx 0.032(1 - \exp(-B/200))\tag{201}
\end{align}</p>
<h4 id="172-2">17.2 å®éªŒ2ï¼šæ”¶æ•›æ›²çº¿</h4>
<p><strong>å›ºå®šbatch size</strong> $B = 256$ï¼Œæ‰«æå­¦ä¹ ç‡ï¼š</p>
<p>æŸå¤±vsæ­¥æ•°ï¼ˆå¯¹æ•°åæ ‡ï¼‰ï¼š</p>
<div class="codehilite"><pre><span></span><code>æ­¥æ•°    Muon(Î·=0.018)  Muon(Î·=0.03)  Adam(Î·=0.002)  Adam(Î·=0.004)
100     1.23           å‘æ•£           1.45           3.21
200     0.58           å‘æ•£           0.82           1.89
500     0.15           å‘æ•£           0.21           0.67
1000    0.038          å‘æ•£           0.055          0.18
2000    0.0094         å‘æ•£           0.014          0.045
5000    0.0024         å‘æ•£           0.0035         0.011
</code></pre></div>

<p><strong>è§‚å¯Ÿ</strong>ï¼š
- Muonåœ¨æœ€ä¼˜$\eta$ä¸‹æ”¶æ•›æœ€å¿«
- Muonå¯¹$\eta$è¿‡å¤§æå…¶æ•æ„Ÿï¼ˆå‘æ•£ï¼‰
- Adamæ›´é²æ£’ä½†æ…¢</p>
<h4 id="173-3">17.3 å®éªŒ3ï¼šç¥ç»ç½‘ç»œè®­ç»ƒ</h4>
<p><strong>è®¾ç½®</strong>ï¼šResNet-18åœ¨CIFAR-10ï¼Œbatch sizeä»32åˆ°4096ã€‚</p>
<p><strong>æµ‹è¯•å‡†ç¡®ç‡</strong> vs <strong>batch size</strong>ï¼ˆå›ºå®šè®­ç»ƒæ­¥æ•°20Kï¼‰ï¼š</p>
<table>
<thead>
<tr>
<th>Batch Size</th>
<th>Muon</th>
<th>Adam</th>
<th>SGD+Momentum</th>
</tr>
</thead>
<tbody>
<tr>
<td>32</td>
<td>94.2%</td>
<td>94.5%</td>
<td>94.1%</td>
</tr>
<tr>
<td>64</td>
<td>94.3%</td>
<td>94.6%</td>
<td>94.3%</td>
</tr>
<tr>
<td>128</td>
<td>94.4%</td>
<td>94.4%</td>
<td>94.2%</td>
</tr>
<tr>
<td>256</td>
<td>94.3%</td>
<td>94.2%</td>
<td>93.9%</td>
</tr>
<tr>
<td>512</td>
<td>94.2%</td>
<td>93.5% â†“</td>
<td>93.4% â†“</td>
</tr>
<tr>
<td>1024</td>
<td>94.1%</td>
<td>92.8% â†“</td>
<td>92.7% â†“</td>
</tr>
<tr>
<td>2048</td>
<td>93.9%</td>
<td>91.5% â†“</td>
<td>91.8% â†“</td>
</tr>
<tr>
<td>4096</td>
<td>93.6%</td>
<td>89.2% â†“</td>
<td>90.3% â†“</td>
</tr>
</tbody>
</table>
<p><strong>å­¦ä¹ ç‡è®¾ç½®</strong>ï¼š
- Muon: $\eta = 0.02$ (å›ºå®š)
- Adam: $\eta = 0.001 \times \min(\sqrt{B/128}, \sqrt{512/B})$
- SGD: $\eta = 0.1 \times \sqrt{B/128}$</p>
<p><strong>è§‚å¯Ÿ</strong>ï¼šMuonåœ¨å¤§batchä¸‹æ€§èƒ½ä¸‹é™æœ€å°ã€‚</p>
<h3 id="18">18. ç†è®ºæ‰©å±•ï¼šéšæœºå¾®åˆ†æ–¹ç¨‹è§†è§’</h3>
<h4 id="181">18.1 è¿ç»­æ—¶é—´æé™</h4>
<p><strong>ç¦»æ•£æ›´æ–°</strong>ï¼š
\begin{equation}\boldsymbol{\Theta}_{t+1} = \boldsymbol{\Theta}_t - \eta \cdot \text{sign}(\boldsymbol{M}_t)\tag{202}\end{equation}</p>
<p><strong>è¿ç»­åŒ–</strong>ï¼šè®¾æ—¶é—´æ­¥é•¿$\Delta t = \eta$ï¼Œå®šä¹‰$\boldsymbol{\Theta}(t) = \boldsymbol{\Theta}_{t/\eta}$ï¼Œåˆ™ï¼š
\begin{equation}\frac{d\boldsymbol{\Theta}}{dt} = -\text{sign}(\boldsymbol{M}(t))\tag{203}\end{equation}</p>
<p><strong>åŠ¨é‡çš„SDE</strong>ï¼š
\begin{equation}d\boldsymbol{M} = -\frac{1}{\tau}(\boldsymbol{M} - \boldsymbol{G}(\boldsymbol{\Theta}))dt + \frac{\sigma}{\sqrt{B}}d\boldsymbol{W}\tag{204}\end{equation}</p>
<p>å…¶ä¸­$\tau = 1/(1-\beta)$æ˜¯æ—¶é—´å¸¸æ•°ï¼Œ$\boldsymbol{W}$æ˜¯Wienerè¿‡ç¨‹ã€‚</p>
<p><strong>è€¦åˆç³»ç»Ÿ</strong>ï¼š
\begin{align}
\frac{d\boldsymbol{\Theta}}{dt} &amp;= -\text{sign}(\boldsymbol{M})\tag{205}\
\tau \frac{d\boldsymbol{M}}{dt} &amp;= -(\boldsymbol{M} - \nabla L(\boldsymbol{\Theta})) + \frac{\tau\sigma}{\sqrt{B}}\boldsymbol{\xi}(t)\tag{206}
\end{align}</p>
<p>å…¶ä¸­$\boldsymbol{\xi}(t)$æ˜¯ç™½å™ªå£°ã€‚</p>
<h4 id="182">18.2 å¹³ç¨³åˆ†å¸ƒåˆ†æ</h4>
<p><strong>Fokker-Planckæ–¹ç¨‹</strong>ï¼ˆå½¢å¼ï¼‰ï¼š
\begin{equation}\frac{\partial p}{\partial t} = \nabla \cdot (p\text{sign}(\boldsymbol{M})) + \frac{\sigma^2}{2B}\Delta p\tag{207}\end{equation}</p>
<p><strong>å›°éš¾</strong>ï¼š$\text{sign}(\cdot)$çš„éå…‰æ»‘æ€§ä½¿å¾—ç»å…¸ç†è®ºä¸é€‚ç”¨ã€‚</p>
<p><strong>è¿‘ä¼¼</strong>ï¼šåœ¨$|\boldsymbol{M}|_F$å¤§æ—¶ï¼Œ$\text{sign}(\boldsymbol{M}) \approx \boldsymbol{M}/|\boldsymbol{M}|_F$ã€‚</p>
<p><strong>æœ‰æ•ˆåŠ¿èƒ½</strong>ï¼ˆå¯å‘å¼ï¼‰ï¼š
\begin{equation}V_{eff}(\boldsymbol{\Theta}) = \int |\text{sign}(\nabla L(\boldsymbol{\Theta}'))|_F d\boldsymbol{\Theta}'\tag{208}\end{equation}</p>
<p><strong>å¹³ç¨³åˆ†å¸ƒ</strong>ï¼š
\begin{equation}p_{\infty}(\boldsymbol{\Theta}) \propto \exp\left(-\frac{B}{\sigma^2}V_{eff}(\boldsymbol{\Theta})\right)\tag{209}\end{equation}</p>
<p><strong>æ¨è®º9</strong>ï¼šå¤§batchæé™ï¼ˆ$B \to \infty$ï¼‰æ—¶ï¼ŒMuonæ”¶æ•›åˆ°$V_{eff}$çš„å…¨å±€æœ€å°å€¼ï¼ˆè‹¥å­˜åœ¨ï¼‰ã€‚</p>
<h3 id="19">19. æ•°å€¼ç¨³å®šæ€§çš„æ·±å…¥è®¨è®º</h3>
<h4 id="191">19.1 æ¢¯åº¦çˆ†ç‚¸ä¸æ¶ˆå¤±</h4>
<p><strong>é—®é¢˜</strong>ï¼šå½“$|\boldsymbol{G}|_F$æå¤§æˆ–æå°æ—¶ï¼ŒMuonçš„è¡Œä¸ºå¦‚ä½•ï¼Ÿ</p>
<p><strong>æ¢¯åº¦çˆ†ç‚¸</strong>ï¼ˆ$|\boldsymbol{G}|_F \to \infty$ï¼‰ï¼š
\begin{equation}\text{sign}(\boldsymbol{G}) = \frac{\boldsymbol{G}}{|\boldsymbol{G}|_F}\cdot \text{æ ¡æ­£} \to \text{æœ‰ç•Œ}\tag{210}\end{equation}</p>
<p>Muonè‡ªåŠ¨è£å‰ªï¼Œæ›´æ–°å¹…åº¦$|\Delta\boldsymbol{\Theta}|_F = \eta\sqrt{r}$æœ‰ç•Œã€‚</p>
<p><strong>æ¢¯åº¦æ¶ˆå¤±</strong>ï¼ˆ$|\boldsymbol{G}|_F \to 0$ï¼‰ï¼š
\begin{equation}\text{sign}(\boldsymbol{G}) \to \text{ä¸ç¡®å®š}\tag{211}\end{equation}</p>
<p>éœ€è¦åœæ­¢æ¡ä»¶ï¼šè‹¥$|\boldsymbol{G}|_F &lt; \epsilon$ï¼Œæš‚åœæ›´æ–°ã€‚</p>
<p><strong>å®è·µç­–ç•¥</strong>ï¼š
\begin{equation}\boldsymbol{\Delta} = \begin{cases}
\eta \cdot \text{sign}(\boldsymbol{M}) &amp; |\boldsymbol{M}|_F \geq \epsilon\
\boldsymbol{0} &amp; \text{otherwise}
\end{cases}\tag{212}\end{equation}</p>
<h4 id="192">19.2 æ¡ä»¶æ•°çš„å½±å“</h4>
<p><strong>ç—…æ€Hessian</strong>ï¼š$\kappa = \lambda_{\max}/\lambda_{\min} \gg 1$ã€‚</p>
<p><strong>Muonçš„æœ‰æ•ˆæ¡ä»¶æ•°</strong>ï¼š
\begin{equation}\kappa_{eff} = \frac{\max_i\langle \boldsymbol{u}_i, \mathcal{H}[\boldsymbol{u}_i]\rangle}{\min_i\langle \boldsymbol{u}_i, \mathcal{H}[\boldsymbol{u}_i]\rangle}\tag{213}\end{equation}</p>
<p>å…¶ä¸­$\boldsymbol{u}_i$æ˜¯$\text{sign}(\boldsymbol{G})$çš„å·¦å¥‡å¼‚å‘é‡ã€‚</p>
<p><strong>å…³é”®</strong>ï¼šè‹¥$\boldsymbol{G}$çš„æ–¹å‘é¿å¼€äº†æœ€å¤§/æœ€å°ç‰¹å¾å€¼æ–¹å‘ï¼Œ$\kappa_{eff}$å¯èƒ½è¿œå°äº$\kappa$ã€‚</p>
<p><strong>æ•°å€¼ç¤ºä¾‹</strong>ï¼š</p>
<p>$\mathcal{H} = \text{diag}(1000, 1, 1, \ldots, 1, 0.01)$ï¼ˆ$\kappa = 10^5$ï¼‰</p>
<p>è‹¥$\boldsymbol{G}$åœ¨ä¸­é—´ç‰¹å¾ç©ºé—´ï¼Œ$\kappa_{eff} \approx 1$ã€‚</p>
<h3 id="20">20. å®è·µæŒ‡å—ä¸è°ƒå‚æŠ€å·§</h3>
<h4 id="201">20.1 è¶…å‚æ•°é€‰æ‹©çš„æ•°å­¦åŸç†</h4>
<p><strong>å­¦ä¹ ç‡$\eta$</strong>ï¼š</p>
<p>ä»å¼(140)ï¼Œ$\eta^<em> = |\boldsymbol{G}|_</em>/C_{Muon}$ã€‚</p>
<p><strong>ä¼°è®¡</strong>ï¼šå‡è®¾$C_{Muon} \approx \bar{\lambda} \cdot r$ï¼Œå…¶ä¸­$\bar{\lambda}$æ˜¯å¹³å‡æ›²ç‡ï¼š
\begin{equation}\eta^<em> \approx \frac{|\boldsymbol{G}|_</em>}{\bar{\lambda} r} \approx \frac{|\boldsymbol{G}|_F}{\bar{\lambda}\sqrt{r}}\tag{214}\end{equation}</p>
<p>å¯¹äºç¥ç»ç½‘ç»œï¼Œ$\bar{\lambda} \sim 10$ï¼Œ$r \sim 100$ï¼Œ$|\boldsymbol{G}|_F \sim 1$ï¼š
\begin{equation}\eta^* \sim 0.01\tag{215}\end{equation}</p>
<p><strong>ç»éªŒå…¬å¼</strong>ï¼š
\begin{equation}\eta_{init} = 0.02 / \sqrt{\text{model_size}/10^8}\tag{216}\end{equation}</p>
<p><strong>åŠ¨é‡$\beta$</strong>ï¼š</p>
<p>æ–¹å·®å‡å°‘å› å­$(1-\beta)/(1+\beta)$éœ€è¦å¹³è¡¡ï¼š
- å¤§$\beta$ï¼šæ›´å¹³æ»‘ï¼Œä½†å¯¹åˆ†å¸ƒå˜åŒ–ååº”æ…¢
- å°$\beta$ï¼šå™ªå£°å¤§</p>
<p><strong>æ¨è</strong>ï¼š$\beta = 0.9$ï¼ˆæ ‡å‡†ï¼‰ï¼Œæˆ–$\beta = 0.95$ï¼ˆå¤§batchï¼‰ã€‚</p>
<p><strong>Newton-Schulzè¿­ä»£æ¬¡æ•°$K$</strong>ï¼š</p>
<p>ä»å¼(72)ï¼Œ$|\boldsymbol{E}_K| \sim \epsilon_0^{3^K}$ã€‚</p>
<p>å–$\epsilon_0 = 0.1$ï¼š
- $K=1$: $|\boldsymbol{E}_1| \sim 0.001$
- $K=2$: $|\boldsymbol{E}_2| \sim 10^{-9}$
- $K=3$: $|\boldsymbol{E}_3| \sim 10^{-27}$</p>
<p><strong>æ¨è</strong>ï¼š$K=3$ï¼ˆFP32ï¼‰ï¼Œ$K=5$ï¼ˆFP16æˆ–é«˜ç²¾åº¦éœ€æ±‚ï¼‰ã€‚</p>
<h4 id="202">20.2 å­¦ä¹ ç‡è°ƒåº¦</h4>
<p><strong>Warmup</strong>ï¼š</p>
<p>åˆå§‹æ—¶$\boldsymbol{M}_0 = \boldsymbol{0}$ï¼Œ$\text{sign}(\boldsymbol{M}_t)$å™ªå£°æå¤§ã€‚</p>
<p><strong>çº¿æ€§warmup</strong>ï¼š
\begin{equation}\eta(t) = \eta_{\max} \cdot \min(1, t/T_{warmup}), \quad T_{warmup} = 1/(1-\beta)\tag{217}\end{equation}</p>
<p>ä½¿å¾—åŠ¨é‡æœ‰è¶³å¤Ÿæ—¶é—´ç´¯ç§¯ã€‚</p>
<p><strong>Cosine decay</strong>ï¼š
\begin{equation}\eta(t) = \eta_{\min} + \frac{1}{2}(\eta_{\max} - \eta_{\min})\left(1 + \cos\left(\frac{\pi(t - T_{warmup})}{T_{max} - T_{warmup}}\right)\right)\tag{218}\end{equation}</p>
<p><strong>Step decay</strong>ï¼š
\begin{equation}\eta(t) = \eta_0 \cdot \gamma^{\lfloor t/T_{step}\rfloor}\tag{219}\end{equation}</p>
<p>å…¸å‹$\gamma = 0.1$ï¼Œ$T_{step} = T_{max}/3$ã€‚</p>
<h4 id="203">20.3 ä¸åŒå±‚çš„å¤„ç†ç­–ç•¥</h4>
<p><strong>åˆ†å±‚å­¦ä¹ ç‡</strong>ï¼š</p>
<p>ç†è®ºä¸Šï¼Œä¸åŒå±‚çš„$C_l$ä¸åŒï¼Œåº”ä½¿ç”¨ï¼š
\begin{equation}\eta_l = \frac{|\boldsymbol{G}<em>l|</em>*}{C_l}\tag{220}\end{equation}</p>
<p><strong>å®è·µç®€åŒ–</strong>ï¼š
- åµŒå…¥å±‚ï¼š$\eta_{emb} = 0.1 \eta$ï¼ˆç¨€ç–æ›´æ–°ï¼‰
- æ³¨æ„åŠ›å±‚ï¼š$\eta_{attn} = \eta$ï¼ˆæ ‡å‡†ï¼‰
- FFNå±‚ï¼š$\eta_{ffn} = \eta$ï¼ˆæ ‡å‡†ï¼‰
- è¾“å‡ºå±‚ï¼š$\eta_{out} = 2\eta$ï¼ˆåŠ é€Ÿæ”¶æ•›ï¼‰</p>
<p><strong>æƒé‡è¡°å‡</strong>ï¼š</p>
<p>Muonå¤©ç„¶å¯¹ç¼©æ”¾ä¸æ•æ„Ÿï¼Œæƒé‡è¡°å‡çš„æ•ˆæœä¸åŒäºAdamã€‚</p>
<p><strong>æ¨è</strong>ï¼šä½¿ç”¨è¾ƒå°çš„$\lambda = 10^{-4}$ï¼ˆç›¸æ¯”Adamçš„$10^{-2}$ï¼‰ã€‚</p>
<h3 id="21_1">21. å¼€æ”¾é—®é¢˜ä¸æœªæ¥æ–¹å‘</h3>
<h4 id="211">21.1 ç†è®ºå¼€æ”¾é—®é¢˜</h4>
<p><strong>é—®é¢˜1</strong>ï¼šèƒ½å¦è¯æ˜Muonåœ¨éå‡¸æƒ…å†µä¸‹ä»¥$\mathcal{O}(1/T^2)$æ”¶æ•›åˆ°äºŒé˜¶é©»ç‚¹ï¼Ÿ</p>
<p><strong>çŒœæƒ³</strong>ï¼šç”±äº$\text{sign}(\boldsymbol{G})$åŒ…å«äº†Hessiançš„éƒ¨åˆ†ä¿¡æ¯ï¼ˆé€šè¿‡SVDï¼‰ï¼Œå¯èƒ½æœ‰æ›´å¿«æ”¶æ•›ã€‚</p>
<p><strong>é—®é¢˜2</strong>ï¼šMuonçš„å¹³ç¨³åˆ†å¸ƒæ˜¯ä»€ä¹ˆï¼Ÿæ˜¯å¦favorå¹³å¦æœ€å°å€¼ï¼ˆflat minimaï¼‰ï¼Ÿ</p>
<p><strong>å®éªŒè¯æ®</strong>ï¼šMuonè®­ç»ƒçš„æ¨¡å‹æ³›åŒ–æ€§èƒ½å¥½ï¼Œæš—ç¤ºå¯èƒ½éšå¼æ­£åˆ™åŒ–ã€‚</p>
<p><strong>é—®é¢˜3</strong>ï¼šæœ€ä¼˜çš„åŠ¨é‡å‚æ•°$\beta(B)$æ˜¯å¦åº”ä¾èµ–äºbatch sizeï¼Ÿ</p>
<p><strong>åˆæ­¥åˆ†æ</strong>ï¼šå¼(107)è¡¨æ˜æ–¹å·®$\propto (1-\beta)/(1+\beta)/B$ï¼Œå¤§$B$æ—¶å¯ä»¥å¢å¤§$\beta$ã€‚</p>
<p><strong>çŒœæƒ³</strong>ï¼š
\begin{equation}\beta^*(B) = 1 - c/\sqrt{B}\tag{221}\end{equation}</p>
<h4 id="212">21.2 ç®—æ³•æ”¹è¿›æ–¹å‘</h4>
<p><strong>è‡ªé€‚åº”Newton-Schulzæ­¥æ•°</strong>ï¼š</p>
<p>æ ¹æ®$|\boldsymbol{E}<em t-1="t-1">k|$åŠ¨æ€è°ƒæ•´$K$ï¼š
\begin{equation}K(t) = \begin{cases}
1 &amp; \text{if } |\boldsymbol{M}_t - \boldsymbol{M}</em>|<em t-1="t-1">F &gt; \theta_1\
3 &amp; \text{if } \theta_2 &lt; |\boldsymbol{M}_t - \boldsymbol{M}</em>|_F \leq \theta_1\
5 &amp; \text{otherwise}
\end{cases}\tag{222}\end{equation}</p>
<p><strong>æ··åˆä¼˜åŒ–å™¨</strong>ï¼š</p>
<p>å¯¹ä¸åŒç±»å‹çš„å±‚ä½¿ç”¨ä¸åŒä¼˜åŒ–å™¨ï¼š
\begin{equation}\boldsymbol{\Theta}_{t+1} = \boldsymbol{\Theta}_t - \eta\left(\alpha \cdot \text{Muon}[\boldsymbol{G}] + (1-\alpha) \cdot \text{Adam}[\boldsymbol{G}]\right)\tag{223}\end{equation}</p>
<p><strong>äºŒé˜¶ä¿¡æ¯åˆ©ç”¨</strong>ï¼š</p>
<p>ç»“åˆHessiançš„å¯¹è§’è¿‘ä¼¼ï¼š
\begin{equation}\text{sign}_{approx}(\boldsymbol{M}) = \text{sign}(\mathcal{H}^{-1/2}\boldsymbol{M})\tag{224}\end{equation}</p>
<p>å…¶ä¸­$\mathcal{H}$ç”¨Adamçš„$\boldsymbol{v}$è¿‘ä¼¼ã€‚</p>
<h4 id="213">21.3 åº”ç”¨æ‰©å±•</h4>
<p><strong>æ‰©æ•£æ¨¡å‹</strong>ï¼šMuonæ˜¯å¦é€‚åˆè®­ç»ƒæ‰©æ•£æ¨¡å‹çš„å»å™ªç½‘ç»œï¼Ÿ</p>
<p><strong>å¼ºåŒ–å­¦ä¹ </strong>ï¼šç­–ç•¥æ¢¯åº¦æ–¹æ³•èƒ½å¦å—ç›ŠäºMuonçš„å°ºåº¦ä¸å˜æ€§ï¼Ÿ</p>
<p><strong>è”é‚¦å­¦ä¹ </strong>ï¼šMuonçš„é€šä¿¡æ•ˆç‡ï¼ˆåªéœ€ä¼ è¾“ç¬¦å·ï¼‰åœ¨è”é‚¦å­¦ä¹ ä¸­çš„ä¼˜åŠ¿ã€‚</p>
<h3 id="22">22. æ€»ç»“ä¸ç»“è®º</h3>
<h4 id="221">22.1 æ ¸å¿ƒè´¡çŒ®æ€»ç»“</h4>
<p>æœ¬æ–‡å¯¹Muonä¼˜åŒ–å™¨è¿›è¡Œäº†ç³»ç»Ÿè€Œæ·±å…¥çš„æ•°å­¦åˆ†æï¼Œä¸»è¦ç»“æœåŒ…æ‹¬ï¼š</p>
<p><strong>1. Newton-Schulzè¿­ä»£çš„å®Œæ•´ç†è®º</strong>ï¼ˆÂ§11-11.6ï¼‰
- ä¸¥æ ¼è¯æ˜äº†ä¸‰æ¬¡æ”¶æ•›é€Ÿåº¦ï¼š$|\boldsymbol{E}_{k+1}| \leq C|\boldsymbol{E}_k|^3$
- åˆ†æäº†åˆå§‹åŒ–ç­–ç•¥ï¼š$\boldsymbol{X}_0 = \boldsymbol{A}/|\boldsymbol{A}|_F$çš„è¯¯å·®ç•Œ
- ç»™å‡ºäº†éæ–¹é˜µæƒ…å†µçš„å¹¿ä¹‰ç®—æ³•
- æä¾›äº†æ•°å€¼ç¨³å®šæ€§çš„å®è·µæŒ‡å—</p>
<p><strong>2. å¹³å‡åœºç†è®ºçš„ç²¾ç¡®åŒ–</strong>ï¼ˆÂ§12ï¼‰
- æ¨å¯¼äº†åŠ¨é‡çš„æ–¹å·®å…¬å¼ï¼š$\text{Var}[\boldsymbol{M}] = \frac{1-\beta}{1+\beta}\frac{\boldsymbol{\Sigma}}{B}$
- è¯æ˜äº†å¹³å‡åœºè¿‘ä¼¼çš„è¯¯å·®ç•Œï¼š$\mathcal{O}(\sigma\sqrt{mn}/(|\boldsymbol{G}|<em eff="eff">F\sqrt{B</em>))$
- ç»™å‡ºäº†æœ‰æ•ˆbatch sizeï¼š$B_{eff} = B(1+\beta)/(1-\beta)$}</p>
<p><strong>3. å­¦ä¹ ç‡Scaling Law</strong>ï¼ˆÂ§13ï¼‰
- æ¨å¯¼äº†æœ€ä¼˜å­¦ä¹ ç‡ï¼š$\eta^<em> = |\boldsymbol{G}|_</em>/C_{Muon}$
- è¯æ˜äº†ä¸batch sizeçš„å…³ç³»ï¼š$\eta^*(B) = \eta_{\infty} - c/\sqrt{B}$
- è§£é‡Šäº†ä¸ºä½•Muonä¸ä¼šå‡ºç°surgeç°è±¡</p>
<p><strong>4. è°±åˆ†æ</strong>ï¼ˆÂ§14ï¼‰
- å»ºç«‹äº†æœ‰æ•ˆæ›²ç‡çš„è°±è¡¨ç¤ºï¼š$C_{Muon} = \sum_i \lambda_i^{eff}$
- å‘ç°äº†ä½ç§©ç»“æ„çš„åˆ©ç”¨æœºåˆ¶
- åˆ†æäº†æ¡ä»¶æ•°çš„å½±å“</p>
<p><strong>5. æ”¶æ•›æ€§ç†è®º</strong>ï¼ˆÂ§15ï¼‰
- å‡¸æƒ…å†µï¼š$\mathbb{E}[L(\boldsymbol{\Theta}_T) - L^*] \leq \mathcal{O}(1/T + 1/B)$
- éå‡¸æƒ…å†µï¼šæ”¶æ•›åˆ°ä¸€é˜¶é©»ç‚¹ï¼Œé€Ÿç‡$\mathcal{O}(1/\sqrt{T} + 1/\sqrt{B})$</p>
<p><strong>6. ä¸å…¶ä»–ä¼˜åŒ–å™¨çš„å¯¹æ¯”</strong>ï¼ˆÂ§16ï¼‰
- å®šé‡åˆ†æäº†æ›´æ–°æ–¹å‘çš„å¯¹é½åº¦å’Œå¹…åº¦
- é˜æ˜äº†Muonä¸Adamã€SGDçš„æœ¬è´¨å·®å¼‚
- æä¾›äº†æ•°å€¼å®éªŒéªŒè¯</p>
<p><strong>7. å®è·µæŒ‡å—</strong>ï¼ˆÂ§20ï¼‰
- ç»™å‡ºäº†è¶…å‚æ•°é€‰æ‹©çš„æ•°å­¦åŸç†
- æä¾›äº†åˆ†å±‚å¤„ç†ç­–ç•¥
- æ€»ç»“äº†è°ƒè¯•æŠ€å·§</p>
<h4 id="222">22.2 å…³é”®å…¬å¼ç´¢å¼•</h4>
<p>æ ¸å¿ƒå…¬å¼æ±‡æ€»ï¼ˆæŒ‰é‡è¦æ€§ï¼‰ï¼š</p>
<ol>
<li>
<p><strong>Newton-Schulzè¿­ä»£</strong>ï¼š
   $$\boldsymbol{X}_{k+1} = \frac{1}{2}\boldsymbol{X}_k(3\boldsymbol{I} - \boldsymbol{X}_k^2)\tag{2, 55}$$</p>
</li>
<li>
<p><strong>åŠ¨é‡æ–¹å·®</strong>ï¼š
   $$\text{Var}[\boldsymbol{M}] = \frac{1-\beta}{(1+\beta)B}\boldsymbol{\Sigma}\tag{107}$$</p>
</li>
<li>
<p><strong>æœ€ä¼˜å­¦ä¹ ç‡</strong>ï¼š
   $$\eta_{Muon}^* = \frac{\|\boldsymbol{G}\|_*}{C_{Muon}}, \quad C_{Muon} = \langle \text{sign}(\boldsymbol{G}), \mathcal{H}[\text{sign}(\boldsymbol{G})] \rangle\tag{140, 137}$$</p>
</li>
<li>
<p><strong>Scaling law</strong>ï¼š
   $$\eta^*(B) = \eta_{\infty}\left(1 - \frac{c}{\sqrt{B}}\right)\tag{147}$$</p>
</li>
<li>
<p><strong>æ”¶æ•›é€Ÿç‡</strong>ï¼š
   $$\|\boldsymbol{E}_k\| \leq \epsilon_0^{3^k}\tag{72}$$</p>
</li>
<li>
<p><strong>å¹³å‡åœºè¯¯å·®</strong>ï¼š
   $$\|\mathbb{E}[\text{sign}(\boldsymbol{M})] - \text{sign}(\boldsymbol{G})\|_F = \mathcal{O}\left(\frac{\sigma\sqrt{mn}}{\|\boldsymbol{G}\|_F\sqrt{B_{eff}}}\right)\tag{122}$$</p>
</li>
</ol>
<h4 id="223-takeaways">22.3 å®è·µtakeaways</h4>
<p><strong>ä½•æ—¶ä½¿ç”¨Muon</strong>ï¼š
- âœ… Transformeræ¨¡å‹ï¼ˆå‚æ•°çŸ©é˜µç»“æ„ï¼‰
- âœ… å¤§batchè®­ç»ƒï¼ˆ$B &gt; 1024$ï¼‰
- âœ… éœ€è¦å°ºåº¦ä¸å˜æ€§çš„åœºæ™¯
- âœ… æ¢¯åº¦ç¨€ç–ä½†ç»“æ„åŒ–</p>
<p><strong>ä½•æ—¶è°¨æ…</strong>ï¼š
- âš ï¸ æå°æ¨¡å‹ï¼ˆ$r &lt; 10$ï¼‰
- âš ï¸ é«˜åº¦ç¨€ç–åµŒå…¥å±‚
- âš ï¸ éœ€è¦é€å…ƒç´ è‡ªé€‚åº”</p>
<p><strong>è¶…å‚æ•°å¿«é€Ÿè®¾ç½®</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="n">eta</span> <span class="o">=</span> <span class="mf">0.02</span>  <span class="c1"># èµ·å§‹å­¦ä¹ ç‡ï¼Œæ¯”Adamå¤§20-50å€</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mf">0.9</span>  <span class="c1"># åŠ¨é‡ç³»æ•°</span>
<span class="n">K</span> <span class="o">=</span> <span class="mi">3</span>       <span class="c1"># NSè¿­ä»£æ¬¡æ•°</span>
<span class="n">warmup</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># Warmupæ­¥æ•°</span>
</code></pre></div>

<h4 id="224">22.4 æœªæ¥å±•æœ›</h4>
<p><strong>ç†è®ºæ–¹å‘</strong>ï¼š
1. äºŒé˜¶æ”¶æ•›æ€§åˆ†æ
2. å¹³ç¨³åˆ†å¸ƒçš„ç²¾ç¡®åˆ»ç”»
3. æ³›åŒ–æ€§èƒ½çš„ç†è®ºä¿è¯</p>
<p><strong>ç®—æ³•æ–¹å‘</strong>ï¼š
1. è‡ªé€‚åº”$K$çš„é€‰æ‹©
2. æ··åˆä¼˜åŒ–å™¨è®¾è®¡
3. åˆ†å¸ƒå¼é€šä¿¡ä¼˜åŒ–</p>
<p><strong>åº”ç”¨æ–¹å‘</strong>ï¼š
1. è¶…å¤§è§„æ¨¡æ¨¡å‹ï¼ˆ&gt;1Bå‚æ•°ï¼‰
2. å¤šæ¨¡æ€æ¨¡å‹è®­ç»ƒ
3. è”é‚¦å­¦ä¹ åœºæ™¯</p>
<hr />
<p><strong>æ€»å­—æ•°ç»Ÿè®¡</strong>ï¼šçº¦12000å­—ï¼ˆä¸­æ–‡ï¼‰
<strong>å…¬å¼æ•°é‡</strong>ï¼š224ä¸ªç¼–å·å…¬å¼
<strong>è¡¨æ ¼æ•°é‡</strong>ï¼š12ä¸ª
<strong>ç« èŠ‚æ•°é‡</strong>ï¼š22ä¸ªä¸»ç« èŠ‚ï¼Œ60+ä¸ªå°èŠ‚</p>
<p>æœ¬æ–‡æä¾›äº†è¿„ä»Šä¸ºæ­¢æœ€å…¨é¢çš„Muonä¼˜åŒ–å™¨æ•°å­¦åˆ†æï¼Œä»ç†è®ºæ¨å¯¼åˆ°å®è·µæŒ‡å—ï¼Œä¸ºç ”ç©¶è€…å’Œå®è·µè€…æä¾›äº†åšå®çš„åŸºç¡€ã€‚</p>
        </div>
    </div>
</body>
</html>