<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡æ–°æ€è€ƒå­¦ä¹ ç‡ä¸Batch Sizeï¼ˆä¸€ï¼‰ï¼šç°çŠ¶</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>é‡æ–°æ€è€ƒå­¦ä¹ ç‡ä¸Batch Sizeï¼ˆä¸€ï¼‰ï¼šç°çŠ¶</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-26 | ğŸ“„ å¤§å°: 35.4 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/11260">https://spaces.ac.cn/archives/11260</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>åœ¨ä¹‹å‰çš„æ–‡ç« <a href="/archives/10542">ã€Šå½“Batch Sizeå¢å¤§æ—¶ï¼Œå­¦ä¹ ç‡è¯¥å¦‚ä½•éšä¹‹å˜åŒ–ï¼Ÿã€‹</a>å’Œ<a href="/archives/10563">ã€ŠAdamçš„epsilonå¦‚ä½•å½±å“å­¦ä¹ ç‡çš„Scaling Lawï¼Ÿã€‹</a>ä¸­ï¼Œæˆ‘ä»¬ä»ç†è®ºä¸Šè®¨è®ºäº†å­¦ä¹ ç‡éšBatch Sizeçš„å˜åŒ–è§„å¾‹ï¼Œå…¶ä¸­æ¯”è¾ƒç»å…¸çš„éƒ¨åˆ†æ˜¯ç”±OpenAIæå‡ºçš„å±•å¼€åˆ°äºŒé˜¶çš„åˆ†æã€‚ç„¶è€Œï¼Œå½“æˆ‘ä»¬è¦å¤„ç†éSGDä¼˜åŒ–å™¨æ—¶ï¼Œè¿™å¥—åˆ†ææ–¹æ³•çš„è®¡ç®—è¿‡ç¨‹å¾€å¾€ä¼šç›¸å½“å¤æ‚ï¼Œæœ‰ç§æ— ä»ä¸‹æ‰‹çš„æ„Ÿè§‰ã€‚</p>
<p>æ¥ä¸‹æ¥çš„å‡ ç¯‡æ–‡ç« ï¼Œç¬”è€…å°†é‡æ–°æ•´ç†å’Œæ€è€ƒä¸Šè¿°æ–‡ç« ä¸­çš„ç›¸å…³ç»†èŠ‚ï¼Œå°è¯•ç®€åŒ–å…¶ä¸­çš„ä¸€äº›æ¨å¯¼æ­¥éª¤ï¼Œç»™å‡ºä¸€æ¡æ›´é€šç”¨ã€æ›´è½»ç›ˆçš„æ¨å¯¼è·¯å¾„ï¼Œå¹¶ä¸”æ¢è®¨æ¨å¹¿åˆ°Muonä¼˜åŒ–å™¨çš„å¯èƒ½æ€§ã€‚</p>
<h2 id="_1">æ–¹æ³•å¤§æ„</h2>
<p>é¦–å…ˆå›é¡¾ä¸€ä¸‹ä¹‹å‰çš„åˆ†ææ–¹æ³•ã€‚åœ¨<a href="/archives/10542">ã€Šå½“Batch Sizeå¢å¤§æ—¶ï¼Œå­¦ä¹ ç‡è¯¥å¦‚ä½•éšä¹‹å˜åŒ–ï¼Ÿã€‹</a>ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†å¤šç§åˆ†æå­¦ä¹ ç‡ä¸Batch Sizeè§„å¾‹çš„æ€è·¯ï¼Œå…¶ä¸­OpenAIåœ¨<a href="https://papers.cool/arxiv/1812.06162">ã€ŠAn Empirical Model of Large-Batch Trainingã€‹</a>æå‡ºçš„äºŒé˜¶è¿‘ä¼¼åˆ†æå äº†ä¸»è¦ç¯‡å¹…ï¼Œæœ¬æ–‡ä¹Ÿæ˜¯æ²¿ç”¨åŒæ ·çš„æ€è·¯ã€‚</p>
<p>æ¥ç€éœ€è¦å¼•å…¥ä¸€äº›è®°å·ã€‚è®¾æŸå¤±å‡½æ•°ä¸º$\mathcal{L}(\boldsymbol{w})$ï¼Œ$\boldsymbol{w}\in\mathbb{R}^N$æ˜¯å‚æ•°å‘é‡ï¼Œ$\boldsymbol{g}$æ˜¯å®ƒçš„æ¢¯åº¦ã€‚æ³¨æ„ç†æƒ³çš„æŸå¤±å‡½æ•°æ˜¯åœ¨å…¨ä½“è®­ç»ƒæ ·æœ¬ä¸Šç®—çš„æœŸæœ›ï¼Œä½†å®é™…æˆ‘ä»¬åªèƒ½é‡‡æ ·ä¸€ä¸ªBatchæ¥ç®—ï¼Œè¿™å¯¼è‡´æ¢¯åº¦ä¹Ÿå¸¦æœ‰éšæœºæ€§ï¼Œæˆ‘ä»¬å°†å•ä¸ªæ ·æœ¬çš„æ¢¯åº¦è®°ä¸º$\tilde{\boldsymbol{g}}$ï¼Œå®ƒçš„å‡å€¼å°±æ˜¯$\boldsymbol{g}$ï¼Œè€Œåæ–¹å·®çŸ©é˜µè®°ä¸º$\boldsymbol{\Sigma}$ï¼›å½“Batch Sizeä¸º$B$æ—¶ï¼Œæ¢¯åº¦è®°ä¸º$\tilde{\boldsymbol{g}}_B$ï¼Œå®ƒçš„å‡å€¼è¿˜æ˜¯$\boldsymbol{g}$ï¼Œä½†åæ–¹å·®çŸ©é˜µå˜ä¸º$\boldsymbol{\Sigma}/B$ã€‚</p>
<p>è¿›ä¸€æ­¥åœ°ï¼Œè®¾å½“å‰å­¦ä¹ ç‡ä¸º$\eta$ï¼Œæ›´æ–°å‘é‡ä¸º$\tilde{\boldsymbol{\varphi}}<em>B$ï¼Œé‚£ä¹ˆæ›´æ–°åçš„æŸå¤±å‡½æ•°å°†æ˜¯<br />
\begin{equation}\begin{aligned}<br />
\mathcal{L}(\boldsymbol{w} - \eta\tilde{\boldsymbol{\varphi}}_B) \approx&amp;\, \mathcal{L}(\boldsymbol{w}) - \eta \tilde{\boldsymbol{\varphi}}_B^{\top}\boldsymbol{g} + \frac{1}{2}\eta^2\tilde{\boldsymbol{\varphi}}_B^{\top}\boldsymbol{H}\tilde{\boldsymbol{\varphi}}_B \\\<br />
=&amp;\, \mathcal{L}(\boldsymbol{w}) - \eta \tilde{\boldsymbol{\varphi}}_B^{\top}\boldsymbol{g} + \frac{1}{2}\eta^2\newcommand{tr}{\mathop{\text{tr}}}\tr(\tilde{\boldsymbol{\varphi}}_B\tilde{\boldsymbol{\varphi}}_B^{\top}\boldsymbol{H})<br />
\end{aligned}\end{equation}<br />
å³ä¾§æˆ‘ä»¬æ³°å‹’å±•å¼€åˆ°äº†äºŒé˜¶ï¼Œ$\boldsymbol{H}$æ˜¯HessiançŸ©é˜µï¼Œ$\tr$æ˜¯çŸ©é˜µçš„è¿¹ï¼Œç¬¬äºŒä¸ªç­‰å·ç”¨åˆ°äº†$\tr(\boldsymbol{A}\boldsymbol{B})=\tr(\boldsymbol{B}\boldsymbol{A})$è¿™ä¸ªæ’ç­‰å¼ã€‚ä¸ºäº†å¾—åˆ°ä¸€ä¸ªç¡®å®šæ€§çš„ç»“æœï¼Œæˆ‘ä»¬å¯¹ä¸¤è¾¹æ±‚æœŸæœ›ï¼š<br />
\begin{equation}\mathbb{E}[\mathcal{L}(\boldsymbol{w} - \eta\tilde{\boldsymbol{\varphi}}_B)] \approx \mathcal{L}(\boldsymbol{w}) - \eta\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B]^{\top}\boldsymbol{g} + \frac{1}{2}\eta^2 \tr(\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B\tilde{\boldsymbol{\varphi}}_B^{\top}]\boldsymbol{H})\end{equation}<br />
æˆ‘ä»¬æŠŠå³ç«¯çœ‹æˆæ˜¯å…³äº$\eta$çš„äºŒæ¬¡å‡½æ•°ï¼Œå¹¶å‡è®¾äºŒæ¬¡é¡¹ç³»æ•°æ˜¯æ­£çš„ï¼ˆæ›´å¼ºçš„å‡è®¾æ˜¯$\boldsymbol{H}$çŸ©é˜µæ˜¯æ­£å®šçš„ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥å¾—åˆ°æœ€å°å€¼ç‚¹<br />
\begin{equation}\eta^* \approx \frac{\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B]^{\top}\boldsymbol{g}}{\tr(\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B\tilde{\boldsymbol{\varphi}}_B^{\top}]\boldsymbol{H})}\end{equation}<br />
è¿™ä¾¿æ˜¯ _å¹³å‡æ¥è¯´</em> è®©æŸå¤±å‡½æ•°ä¸‹é™æœ€å¿«çš„å­¦ä¹ ç‡ï¼Œæ˜¯å­¦ä¹ ç‡çš„ç†è®ºæœ€ä¼˜è§£ã€‚æˆ‘ä»¬è¦åšçš„äº‹æƒ…ï¼Œå°±æ˜¯é’ˆå¯¹å…·ä½“çš„$\tilde{\boldsymbol{\varphi}}_B$ç®—å‡º$\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B]$å’Œ$\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B\tilde{\boldsymbol{\varphi}}_B^{\top}]$ï¼Œç„¶åä»ä¸Šå¼æå‡ºå®ƒä¸Batch Sizeï¼ˆå³$B$ï¼‰çš„å…³ç³»ã€‚</p>
<h2 id="_2">çƒ­èº«ç»ƒä¹ </h2>
<p>ä½œä¸ºç¬¬ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬è‡ªç„¶æ˜¯è€ƒè™‘æœ€ç®€å•çš„SGDï¼Œæ­¤æ—¶æœ‰$\tilde{\boldsymbol{\varphi}}<em _max="\max">B=\tilde{\boldsymbol{g}}_B$ï¼Œé‚£ä¹ˆç®€å•å¯å¾—$\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B]=\boldsymbol{g}$ä»¥åŠ$\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B\tilde{\boldsymbol{\varphi}}_B^{\top}]=\boldsymbol{g}\boldsymbol{g}^{\top} + \boldsymbol{\Sigma}/B$ï¼Œäºæ˜¯æœ‰<br />
\begin{equation}\eta^* \approx \frac{\boldsymbol{g}^{\top}\boldsymbol{g}}{\tr((\boldsymbol{g}\boldsymbol{g}^{\top} + \boldsymbol{\Sigma}/B)\boldsymbol{H})} = \frac{\boldsymbol{g}^{\top}\boldsymbol{g}}{\boldsymbol{g}^{\top}\boldsymbol{H}\boldsymbol{g} + \tr(\boldsymbol{\Sigma}\boldsymbol{H})/B} = \frac{\eta</em>}}{1 + \mathcal{B<em _max="\max">{\text{noise}}/B}\label{eq:eta-sgd}\end{equation}<br />
å…¶ä¸­<br />
\begin{equation}\eta</em>} = \frac{\boldsymbol{g}^{\top}\boldsymbol{g}}{\boldsymbol{g}^{\top}\boldsymbol{H}\boldsymbol{g}},\qquad\mathcal{B}_{\text{noise}} = \frac{\tr(\boldsymbol{\Sigma}\boldsymbol{H})}{\boldsymbol{g}^{\top}\boldsymbol{H}\boldsymbol{g}}\end{equation</p>
<p>å¯¹äºç»“æœ$\eqref{eq:eta-sgd}$ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰å¤šç§è§£è¯»æ–¹å¼ã€‚é¦–å…ˆï¼Œå®ƒæ˜¯ä¸€ä¸ªå•è°ƒé€’å¢ä½†æœ‰ä¸Šç•Œçš„å‡½æ•°ï¼Œä¸Šç•Œä¸º$\eta_{\max}$ï¼Œè¿™è¡¨æ˜å­¦ä¹ ç‡ä¸èƒ½æ— é™å¢åŠ ï¼Œç›¸æ¯”ç®€å•çš„çº¿æ€§å¾‹æˆ–è€…å¹³æ–¹æ ¹å¾‹ï¼Œå®ƒæ›´ç¬¦åˆæˆ‘ä»¬çš„ç›´è§‰è®¤çŸ¥ï¼›å½“$B \ll \mathcal{B}<em _max="\max">{\text{noise}}$æ—¶ï¼Œæˆ‘ä»¬æœ‰<br />
\begin{equation}\eta^* \approx \frac{\eta</em>}}{1 + \mathcal{B<em _max="\max">{\text{noise}}/B} \approx \frac{\eta</em>}}{\mathcal{B<em _max="\max">{\text{noise}}/B} = \eta</em>} B / \mathcal{B<em _text_noise="\text{noise">{\text{noise}}\end{equation}<br />
è¿™è¡¨æ˜åœ¨Batch Sizeæ¯”è¾ƒå°æ—¶ï¼ŒSGDçš„å­¦ä¹ ç‡ä¸Batch Sizeç¡®å®å‘ˆçº¿æ€§å…³ç³»ï¼ŒåŒæ—¶ä¹Ÿæš—ç¤ºäº†$\mathcal{B}</em>}}$æ˜¯ä¸€ä¸ªå…³é”®ç»Ÿè®¡é‡ã€‚ä¸è¿‡$\mathcal{B<em _text_simple="\text{simple">{\text{noise}}$çš„å®šä¹‰ä¾èµ–äºHessiançŸ©é˜µ$\boldsymbol{H}$ï¼Œè¿™åœ¨LLMä¸­æ˜¯å‡ ä¹ä¸å¯èƒ½ç²¾ç¡®è®¡ç®—çš„ï¼Œæ‰€ä»¥å®è·µä¸­æˆ‘ä»¬é€šå¸¸å‡è®¾å®ƒæ˜¯å•ä½é˜µï¼ˆçš„è‹¥å¹²å€ï¼‰ï¼Œå¾—åˆ°ä¸€ä¸ªç®€åŒ–çš„å½¢å¼<br />
\begin{equation}\mathcal{B}</em>}} = \frac{\tr(\boldsymbol{\Sigma})}{\boldsymbol{g}^{\top}\boldsymbol{g}}\end{equation<br />
è¯¥ç»“æœå…·æœ‰å™ªéŸ³å¼ºåº¦ï¼ˆ$\tr(\boldsymbol{\Sigma})$)é™¤ä»¥ä¿¡å·å¼ºåº¦ï¼ˆ$\boldsymbol{g}^{\top}\boldsymbol{g}$ï¼‰çš„å½¢å¼ï¼Œå®ƒå…¶å®å°±æ˜¯ä¿¡å™ªæ¯”çš„å€’æ•°ï¼Œå®ƒè¡¨æ˜ä¿¡å™ªæ¯”è¶Šå°ï¼Œé‚£ä¹ˆå°±éœ€è¦æ›´å¤§çš„Batch Sizeæ‰èƒ½ç”¨ä¸Šç›¸åŒçš„$\eta_{\max}$ï¼Œè¿™ä¹Ÿè·Ÿæˆ‘ä»¬çš„ç›´è§‰è®¤çŸ¥ç›¸ç¬¦ã€‚$\tr(\boldsymbol{\Sigma})$åªä¾èµ–äº$\boldsymbol{\Sigma}$çš„å¯¹è§’çº¿å…ƒç´ ï¼Œè¿™è¡¨æ˜æˆ‘ä»¬åªéœ€è¦å°†æ¯ä¸ªå‚æ•°ç‹¬ç«‹åœ°ä¼°è®¡å‡å€¼å’Œæ–¹å·®ï¼Œè¿™åœ¨å®è·µä¸Šæ˜¯å¯è¡Œçš„ã€‚</p>
<h2 id="_3">æ•°æ®æ•ˆç‡</h2>
<p>é™¤äº†å­¦ä¹ ç‡ä¸Batch Sizeçš„ç›´æ¥å…³ç³»å¤–ï¼Œç¬”è€…è®¤ä¸ºç”±æ­¤è¡ç”Ÿå‡ºæ¥çš„å…³äºè®­ç»ƒæ•°æ®é‡å’Œè®­ç»ƒæ­¥æ•°çš„æ¸è¿‘å…³ç³»ï¼Œä¹Ÿæ˜¯å¿…é¡»è¦å­¦ä¹ çš„ç²¾å½©éƒ¨åˆ†ã€‚ç‰¹åˆ«åœ°ï¼Œè¿™ä¸ªç»“è®ºä¼¼ä¹æ¯”å­¦ä¹ ç‡çš„å…³ç³»å¼$\eqref{eq:eta-sgd}$æ›´ä¸ºé€šç”¨ï¼Œå› ä¸ºåé¢æˆ‘ä»¬å°†ä¼šçœ‹åˆ°ï¼ŒSignSGDä¹Ÿèƒ½å¾—åˆ°åŒæ ·å½¢å¼çš„ç»“è®ºï¼Œä½†å®ƒçš„å­¦ä¹ ç‡è§„å¾‹å¹¶ä¸æ˜¯å¼$\eqref{eq:eta-sgd}$ã€‚</p>
<p>åŸè®ºæ–‡å¯¹è¿™éƒ¨åˆ†çš„è®¨è®ºæ¯”è¾ƒå¤æ‚ï¼Œä¸‹é¢çš„æ¨å¯¼æ˜¯ç»è¿‡ç¬”è€…ç®€åŒ–çš„ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å°†$\eta^<em>$ä»£å›åˆ°$\mathcal{L}(\boldsymbol{w} - \eta\tilde{\boldsymbol{g}}_B)$ï¼Œå°†å¾—åˆ°<br />
\begin{equation}\overline{\Delta\mathcal{L}} = \mathcal{L}(\boldsymbol{w}) - \mathbb{E}[\mathcal{L}(\boldsymbol{w} - \eta^</em>\tilde{\boldsymbol{g}}<em _max="\max">B)] \approx \frac{\Delta\mathcal{L}</em>}}{1 + \mathcal{B<em _max="\max">{\text{noise}}/B}\end{equation}<br />
å…¶ä¸­$\Delta\mathcal{L}</em>} = \frac{(\boldsymbol{g}^{\top}\boldsymbol{g})^2}{2\boldsymbol{g}^{\top}\boldsymbol{H}\boldsymbol{g}}$ã€‚æ€ä¹ˆç†è§£è¿™ä¸ªç»“æœå‘¢ï¼Ÿé¦–å…ˆï¼Œå®ƒæ˜¯å…³äº$B$çš„å•è°ƒé€’å¢å‡½æ•°ï¼Œå½“$B\to\infty$æ—¶ç­‰äº$\Delta\mathcal{L<em _max="\max">{\max}$ï¼Œæ¢è¨€ä¹‹å¦‚æœæˆ‘ä»¬èƒ½å¼€æ— ç©·å¤§çš„Batch Sizeï¼Œé‚£ä¹ˆæ¯ä¸€æ­¥çš„æŸå¤±ä¸‹é™é‡æ˜¯$\Delta\mathcal{L}</em>$ã€‚}$ï¼Œæ­¤æ—¶æ‰€éœ€çš„è®­ç»ƒæ­¥æ•°æœ€å°‘ï¼Œè®°ä¸º$S_{\min</p>
<p>å¦‚æœBatch Sizeæ˜¯æœ‰é™å€¼ï¼Œé‚£ä¹ˆæ¯ä¸€æ­¥çš„æŸå¤±ä¸‹é™é‡å¹³å‡æ¥è¯´åªæœ‰$\overline{\Delta\mathcal{L}}$ï¼Œè¿™æ„å‘³ç€å¹³å‡è€Œè¨€æˆ‘ä»¬è¦èŠ±$1 + \mathcal{B}<em _text_noise="\text{noise">{\text{noise}}/B$æ­¥ï¼Œæ‰èƒ½è¾¾åˆ°æ— ç©·å¤§Batch Sizeæ—¶1æ­¥çš„ä¸‹é™é‡ï¼Œäºæ˜¯ä¸ºäº†è¾¾åˆ°ç›¸åŒçš„æŸå¤±ï¼Œæˆ‘ä»¬è¦è®­ç»ƒ$S = (1 + \mathcal{B}</em>$æ­¥ã€‚}}/B)S_{\min</p>
<p>ç”±äºBatch Sizeä¸º$B$ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“å¾—å‡ºè®­ç»ƒæ¶ˆè€—çš„æ•°æ®æ€»é‡ä¸º$E = BS = (B + \mathcal{B}<em _min="\min">{\text{noise}})S</em>}$ã€‚ä»è¿™ä¸ªç»“æœå¯ä»¥çœ‹å‡ºï¼Œå¢å¤§Batch Sizeåï¼Œæƒ³è¦è¾¾åˆ°ç›¸åŒçš„æ•ˆæœï¼Œæˆ‘ä»¬è¿˜éœ€è¦é€‚å½“å¢åŠ æ•°æ®é‡$E$ï¼›å½“$B\to 0$æ—¶ï¼Œæ‰€éœ€è¦çš„æ•°æ®é‡æœ€å°‘ï¼Œä¸º$E_{\min} = \mathcal{B<em _min="\min">{\text{noise}}S</em>$ã€‚åˆ©ç”¨è¿™äº›è®°å·ï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡º<br />
\begin{equation}\left(\frac{S}{S_{\min}} - 1\right)\left(\frac{E}{E_{\min}} - 1\right) = 1\end{equation}<br />
è¿™ä¾¿æ˜¯è®­ç»ƒæ•°æ®é‡å’Œè®­ç»ƒæ­¥æ•°çš„ç»å…¸å…³ç³»å¼ï¼Œå®ƒæœ‰ä¸¤ä¸ªå‚æ•°$S_{\min},E_{\min}$ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å®éªŒæœç´¢å¤šä¸ª$(S,E)$æ¥æ‹Ÿåˆä¸Šå¼ï¼Œä»è€Œä¼°è®¡$S_{\min},E_{\min}$ï¼Œè¿›è€Œå¯ä»¥ä¼°ç®—$\mathcal{B}<em _min="\min">{\text{noise}} = E</em>$ã€‚æ›´å¤šåˆ†æç»†èŠ‚è¯·çœ‹å›ä¹‹å‰çš„æ–‡ç« } / S_{\min<a href="/archives/10542">ã€Šå½“Batch Sizeå¢å¤§æ—¶ï¼Œå­¦ä¹ ç‡è¯¥å¦‚ä½•éšä¹‹å˜åŒ–ï¼Ÿã€‹</a>æˆ–OpenAIçš„åŸè®ºæ–‡<a href="https://papers.cool/arxiv/1812.06162">ã€ŠAn Empirical Model of Large-Batch Trainingã€‹</a>ã€‚</p>
<h2 id="_4">å›°éš¾åˆ†æ</h2>
<p>å‰é¢å†™äº†é‚£ä¹ˆå¤šï¼Œéƒ½è¿˜åœç•™åœ¨SGDä¸­ã€‚ä»è®¡ç®—è§’åº¦çœ‹ï¼ŒSGDæ˜¯å¹³å‡¡çš„ï¼ŒçœŸæ­£å¤æ‚çš„æ˜¯$\tilde{\boldsymbol{\varphi}}_B$éçº¿æ€§åœ°ä¾èµ–äº$\tilde{\boldsymbol{g}}_B$çš„æƒ…å½¢ï¼Œæ¯”å¦‚SignSGDå¯¹åº”äº$\newcommand{sign}{\mathop{\text{sign}}}\tilde{\boldsymbol{\varphi}}_B=\sign(\tilde{\boldsymbol{g}}_B)$ï¼Œåœ¨ç†è®ºåˆ†æä¸­å®ƒç»å¸¸ç”¨ä½œAdamçš„è¿‘ä¼¼ï¼Œæ›´å‡†ç¡®çš„è¿‘ä¼¼åˆ™æ˜¯è€ƒè™‘äº†$\epsilon$çš„SoftSignSGDï¼Œæˆ‘ä»¬åœ¨<a href="/archives/10563">ã€ŠAdamçš„epsilonå¦‚ä½•å½±å“å­¦ä¹ ç‡çš„Scaling Lawï¼Ÿã€‹</a>å°è¯•è¿‡åˆ†æå®ƒã€‚</p>
<p>åœ¨è¿™äº›éçº¿æ€§åœºæ™¯ä¸‹ï¼Œ$\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B]$å’Œ$\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B\tilde{\boldsymbol{\varphi}}_B^{\top}]$çš„è®¡ç®—å¾€å¾€æ˜¯ç›¸å½“å›°éš¾çš„ï¼Œå³ä¾¿æˆ‘ä»¬å°†$\tilde{\boldsymbol{g}}_B$çš„åˆ†å¸ƒå‡è®¾ä¸ºç®€å•çš„æ­£æ€åˆ†å¸ƒä¹Ÿæ˜¯å¦‚æ­¤ï¼ˆæ³¨æ„ï¼Œåœ¨SGDçš„åˆ†æä¸­ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦å¯¹å®ƒçš„åˆ†å¸ƒå½¢å¼åšæ­£æ€å‡è®¾ï¼‰ã€‚æ¯”å¦‚ï¼Œåœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œå¯¹äº$\tilde{\boldsymbol{\varphi}}_B=\sign(\tilde{\boldsymbol{g}}_B)$çš„SignSGDï¼Œä¸ºäº†è®¡ç®—$\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B]$ï¼Œæˆ‘ä»¬ç»å†äº†å¦‚ä¸‹æ­¥éª¤ï¼š</p>
<blockquote>
<p>1ã€å‡è®¾$\tilde{\boldsymbol{g}}_B$çš„åˆ†é‡ç›¸äº’ç‹¬ç«‹ï¼Œé—®é¢˜ç®€åŒ–ä¸ºå•ä¸ªåˆ†é‡$\tilde{\varphi}_B=\sign(\tilde{g}_B)$ï¼ˆæ²¡æœ‰åŠ ç²—ï¼‰çš„æœŸæœ›ï¼›</p>
<p>2ã€å‡è®¾$\tilde{g}_B$ï¼ˆæ­¤æ—¶æ˜¯ä¸€ä¸ªæ ‡é‡ï¼‰æœä»æ­£æ€åˆ†å¸ƒï¼Œé‚£ä¹ˆå°±å¯ä»¥ç®—å‡º$\mathbb{E}[\tilde{\varphi}_B]$ï¼Œç­”æ¡ˆè¦ç”¨$\newcommand{erf}{\mathop{\text{erf}}}\erf$å‡½æ•°æ¥è¡¨ç¤ºï¼›</p>
<p>3ã€å°†$\erf$å‡½æ•°ç”¨$x/\sqrt{x^2+c}$å½¢å¼çš„å‡½æ•°è¿‘ä¼¼ï¼Œç®€åŒ–ç»“æœã€‚</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è¦ç»è¿‡ä¸€å †å¼¯å¼¯ç»•ç»•çš„æ­¥éª¤ï¼Œæ‰å‹‰å¼ºç®—å‡ºä¸€ä¸ªå¯ä»¥åˆ†æä¸‹å»çš„è¿‘ä¼¼ç»“æœï¼ˆè¿™ä¸ªè¿‡ç¨‹é¦–æ¬¡å‡ºç°åœ¨Tencentçš„è®ºæ–‡<a href="https://papers.cool/arxiv/2405.14578">ã€ŠSurge Phenomenon in Optimal Learning Rate and Batch Size Scalingã€‹</a>ï¼‰ï¼Œè€Œä¸”è¿™å·²ç»ç®—æ˜¯ç®€å•çš„äº†ï¼Œå› ä¸ºå¦‚æœæ˜¯SoftSignSGDï¼Œåˆ™æ›´åŠ å¤æ‚ï¼š</p>
<blockquote>
<p>1ã€å‡è®¾$\tilde{\boldsymbol{g}}_B$çš„åˆ†é‡ç›¸äº’ç‹¬ç«‹ï¼Œé—®é¢˜ç®€åŒ–ä¸ºå•ä¸ªåˆ†é‡$\tilde{\varphi}_B=\newcommand{softsign}{\mathop{\text{softsign}}}\softsign(\tilde{g}_B, \epsilon)$çš„æœŸæœ›ï¼›</p>
<p>2ã€å°†$\softsign$å‡½æ•°ç”¨åˆ†æ®µçº¿æ€§å‡½æ•°è¿‘ä¼¼ï¼Œè¿™æ ·æ‰èƒ½ç®—å‡ºä¸‹é¢çš„ç§¯åˆ†ï¼›</p>
<p>3ã€å‡è®¾$\tilde{g}_B$æœä»æ­£æ€åˆ†å¸ƒï¼Œç»“åˆç¬¬2æ­¥çš„è¿‘ä¼¼ï¼Œå¯ä»¥ç®—å‡º$\mathbb{E}[\tilde{\varphi}_B]$ï¼Œç­”æ¡ˆæ˜¯åŒ…å«$\erf$çš„å¤æ‚å‡½æ•°ï¼›</p>
<p>4ã€å°†å¤æ‚å‡½æ•°ç”¨$x/\sqrt{x^2+c}$å½¢å¼çš„å‡½æ•°è¿‘ä¼¼ï¼Œç®€åŒ–ç»“æœã€‚</p>
</blockquote>
<p>äº‹æƒ…è¿˜æ²¡å®Œã€‚è´¹é‚£ä¹ˆå¤§åŠ²ï¼ŒåŠ é‚£ä¹ˆå¤šå‡è®¾ï¼Œæˆ‘ä»¬æ‰å ªå ªç®—å‡º$\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B]$ï¼Œæ¥ç€è¿˜è¦ç®—$\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B\tilde{\boldsymbol{\varphi}}_B^{\top}]$ï¼Œè¿™å¾€å¾€æ›´åŠ å¤æ‚ï¼ˆSignSGDæ˜¯ä¸ªä¾‹å¤–ï¼Œå› ä¸º$\sign(x)^2$ä¸€å®šæ˜¯1ï¼Œæ‰€ä»¥åè€Œç®€å•äº†ï¼‰ã€‚ç„¶è€Œï¼Œè®¡ç®—çš„å¤æ‚æ€§è¿˜æ˜¯æ¬¡è¦çš„ï¼Œä¸»è¦æ˜¯è¿™äº›æ­¥éª¤çœ‹ä¸Šå»æ²¡æœ‰ä»»ä½•èƒ½æ¨å¹¿çš„è§„å¾‹ï¼Œä¼¼ä¹åªèƒ½å…·ä½“é—®é¢˜å…·ä½“åˆ†æçš„æ ·å­ï¼Œè¿™å°±è®©äººè§‰å¾—éå¸¸å¿ƒç´¯ã€‚</p>
<h2 id="_5">æœªå®Œå¾…ç»­</h2>
<p>ä¸ºäº†é¿å…æ–‡ç« è¿‡é•¿ï¼Œæœ¬æ–‡å°±å…ˆåˆ°è¿™é‡Œäº†ï¼Œä¸»è¦å…ˆç®€å•å›é¡¾ä¸€ä¸‹ç°æœ‰çš„åˆ†æç»“æœå’Œè®¡ç®—å›°éš¾ã€‚åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œç¬”è€…å°†ä¼šä»‹ç»è‡ªå·±ä¸ºäº†é™ä½æ¨å¯¼è¿‡ç¨‹ä¸­çš„å¿ƒæ™ºè´Ÿæ‹…æ‰€åšçš„ä¸€äº›å°è¯•ã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/11260">https://spaces.ac.cn/archives/11260</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Sep. 01, 2025). ã€Šé‡æ–°æ€è€ƒå­¦ä¹ ç‡ä¸Batch Sizeï¼ˆä¸€ï¼‰ï¼šç°çŠ¶ ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/11260">https://spaces.ac.cn/archives/11260</a></p>
<p>@online{kexuefm-11260,<br />
title={é‡æ–°æ€è€ƒå­¦ä¹ ç‡ä¸Batch Sizeï¼ˆä¸€ï¼‰ï¼šç°çŠ¶},<br />
author={è‹å‰‘æ—},<br />
year={2025},<br />
month={Sep},<br />
url={\url{https://spaces.ac.cn/archives/11260}},<br />
} </p>
<hr />
<h2 id="_6">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<h3 id="1">1. å­¦ä¹ ç‡çš„åŸºæœ¬å®šä¹‰ä¸ä½œç”¨æœºåˆ¶</h3>
<p>å­¦ä¹ ç‡$\eta$æ˜¯æ¢¯åº¦ä¸‹é™ç®—æ³•ä¸­æœ€å…³é”®çš„è¶…å‚æ•°ä¹‹ä¸€ã€‚åœ¨æœ€åŸºæœ¬çš„æ¢¯åº¦ä¸‹é™æ›´æ–°è§„åˆ™ä¸­ï¼š</p>
<p>$$\boldsymbol{w}_{t+1} = \boldsymbol{w}_t - \eta \nabla \mathcal{L}(\boldsymbol{w}_t)$$</p>
<p>å­¦ä¹ ç‡æ§åˆ¶ç€å‚æ•°æ›´æ–°çš„æ­¥é•¿ã€‚ä»ä¼˜åŒ–ç†è®ºçš„è§’åº¦ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ³°å‹’å±•å¼€æ¥ç†è§£å­¦ä¹ ç‡çš„ä½œç”¨ï¼š</p>
<p>$$\mathcal{L}(\boldsymbol{w}_t - \eta \boldsymbol{g}_t) \approx \mathcal{L}(\boldsymbol{w}_t) - \eta \boldsymbol{g}_t^{\top} \boldsymbol{g}_t + \frac{1}{2}\eta^2 \boldsymbol{g}_t^{\top} \boldsymbol{H}_t \boldsymbol{g}_t$$</p>
<p>å…¶ä¸­$\boldsymbol{H}_t$æ˜¯HessiançŸ©é˜µã€‚å¯¹$\eta$æ±‚å¯¼å¹¶ä»¤å¯¼æ•°ä¸ºé›¶ï¼Œå¯å¾—ç†è®ºæœ€ä¼˜å­¦ä¹ ç‡ï¼š</p>
<p>$$\eta_{\text{optimal}} = \frac{\boldsymbol{g}_t^{\top} \boldsymbol{g}_t}{\boldsymbol{g}_t^{\top} \boldsymbol{H}_t \boldsymbol{g}_t}$$</p>
<p>è¿™ä¸ªç»“æœè¡¨æ˜ï¼Œå­¦ä¹ ç‡åº”è¯¥ä¸æ¢¯åº¦èŒƒæ•°çš„å¹³æ–¹æˆæ­£æ¯”ï¼Œä¸æ¢¯åº¦åœ¨HessiançŸ©é˜µæ–¹å‘ä¸Šçš„äºŒæ¬¡å‹æˆåæ¯”ã€‚åœ¨å®è·µä¸­ï¼ŒHessiançŸ©é˜µéš¾ä»¥è®¡ç®—ï¼Œå› æ­¤æˆ‘ä»¬é€šå¸¸ä½¿ç”¨å›ºå®šå­¦ä¹ ç‡æˆ–åŸºäºç»éªŒçš„è°ƒåº¦ç­–ç•¥ã€‚</p>
<p><strong>ç‰©ç†è§£é‡Š</strong>ï¼šå­¦ä¹ ç‡å¯ä»¥ç†è§£ä¸ºåœ¨æŸå¤±å‡½æ•°landscapeä¸Šçš„"æ­¥é•¿"ã€‚å¤ªå°çš„å­¦ä¹ ç‡å¯¼è‡´æ”¶æ•›ç¼“æ…¢ï¼Œå¤ªå¤§çš„å­¦ä¹ ç‡å¯èƒ½å¯¼è‡´éœ‡è¡ç”šè‡³å‘æ•£ã€‚æœ€ä¼˜å­¦ä¹ ç‡åº”è¯¥å¹³è¡¡ä¸‹é™é€Ÿåº¦å’Œç¨³å®šæ€§ã€‚</p>
<h3 id="2-batch-size">2. Batch Sizeå¯¹æ¢¯åº¦ä¼°è®¡çš„å½±å“</h3>
<p>åœ¨å®é™…è®­ç»ƒä¸­ï¼Œæˆ‘ä»¬æ— æ³•è®¡ç®—å…¨æ•°æ®é›†ä¸Šçš„çœŸå®æ¢¯åº¦$\boldsymbol{g} = \mathbb{E}[\tilde{\boldsymbol{g}}]$ï¼Œè€Œæ˜¯ä½¿ç”¨mini-batchæ¥ä¼°è®¡ã€‚è®¾Batch Sizeä¸º$B$ï¼Œbatchå†…çš„æ ·æœ¬æ¢¯åº¦ä¸º${\tilde{\boldsymbol{g}}_1, \tilde{\boldsymbol{g}}_2, ..., \tilde{\boldsymbol{g}}_B}$ï¼Œåˆ™batchæ¢¯åº¦ä¸ºï¼š</p>
<p>$$\tilde{\boldsymbol{g}}_B = \frac{1}{B}\sum_{i=1}^{B} \tilde{\boldsymbol{g}}_i$$</p>
<p><strong>å‡å€¼åˆ†æ</strong>ï¼šæ˜¾ç„¶æœ‰</p>
<p>$$\mathbb{E}[\tilde{\boldsymbol{g}}_B] = \mathbb{E}\left[\frac{1}{B}\sum_{i=1}^{B} \tilde{\boldsymbol{g}}_i\right] = \frac{1}{B}\sum_{i=1}^{B} \mathbb{E}[\tilde{\boldsymbol{g}}_i] = \boldsymbol{g}$$</p>
<p>è¿™è¡¨æ˜batchæ¢¯åº¦æ˜¯çœŸå®æ¢¯åº¦çš„æ— åä¼°è®¡ã€‚</p>
<p><strong>æ–¹å·®åˆ†æ</strong>ï¼šå‡è®¾æ ·æœ¬ä¹‹é—´ç‹¬ç«‹åŒåˆ†å¸ƒï¼Œå•æ ·æœ¬æ¢¯åº¦çš„åæ–¹å·®çŸ©é˜µä¸º$\boldsymbol{\Sigma} = \mathbb{E}[(\tilde{\boldsymbol{g}} - \boldsymbol{g})(\tilde{\boldsymbol{g}} - \boldsymbol{g})^{\top}]$ï¼Œåˆ™ï¼š</p>
<p>$$\text{Cov}[\tilde{\boldsymbol{g}}_B] = \text{Cov}\left[\frac{1}{B}\sum_{i=1}^{B} \tilde{\boldsymbol{g}}_i\right] = \frac{1}{B^2}\sum_{i=1}^{B} \text{Cov}[\tilde{\boldsymbol{g}}_i] = \frac{\boldsymbol{\Sigma}}{B}$$</p>
<p>è¿™æ˜¯ç»Ÿè®¡å­¦ä¸­çš„å…³é”®ç»“è®ºï¼š<strong>æ¢¯åº¦ä¼°è®¡çš„æ–¹å·®ä¸Batch Sizeæˆåæ¯”</strong>ã€‚</p>
<p><strong>å™ªå£°å¼ºåº¦çš„åˆ»ç”»</strong>ï¼šæˆ‘ä»¬å¯ä»¥ç”¨è¿¹æ¥åº¦é‡æ¢¯åº¦å™ªå£°çš„æ€»ä½“å¼ºåº¦ï¼š</p>
<p>$$\sigma_{\text{noise}}^2 = \text{tr}(\boldsymbol{\Sigma}) = \sum_{i=1}^{N} \text{Var}[\tilde{g}_i]$$</p>
<p>å¯¹äºBatch Sizeä¸º$B$çš„æƒ…å†µï¼Œæ¢¯åº¦ä¼°è®¡çš„æ€»å™ªå£°ä¸ºï¼š</p>
<p>$$\sigma_{\text{noise}, B}^2 = \text{tr}(\boldsymbol{\Sigma}/B) = \frac{\sigma_{\text{noise}}^2}{B}$$</p>
<p>è¿™ä¸ª$1/\sqrt{B}$çš„è¡°å‡è§„å¾‹æ˜¯åç»­æ‰€æœ‰åˆ†æçš„åŸºç¡€ã€‚</p>
<h3 id="3-linear-scaling-rule">3. çº¿æ€§ç¼©æ”¾è§„åˆ™ï¼ˆLinear Scaling Ruleï¼‰çš„ç†è®ºæ¨å¯¼</h3>
<p>çº¿æ€§ç¼©æ”¾è§„åˆ™æœ€æ—©ç”±Goyalç­‰äººåœ¨2017å¹´çš„è®ºæ–‡ä¸­æå‡ºï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>å½“Batch Sizeå¢å¤§$k$å€æ—¶ï¼Œå­¦ä¹ ç‡ä¹Ÿåº”è¯¥å¢å¤§$k$å€</strong>ã€‚</p>
<p><strong>ç›´è§‚æ¨å¯¼</strong>ï¼šè€ƒè™‘ä¸¤ç§è®­ç»ƒæ–¹æ¡ˆï¼š
- æ–¹æ¡ˆAï¼šBatch Sizeä¸º$B$ï¼Œå­¦ä¹ ç‡ä¸º$\eta$ï¼Œè®­ç»ƒ1æ­¥
- æ–¹æ¡ˆBï¼šBatch Sizeä¸º$1$ï¼Œå­¦ä¹ ç‡ä¸º$\eta/B$ï¼Œè®­ç»ƒ$B$æ­¥</p>
<p>åœ¨æ–¹æ¡ˆAä¸­ï¼Œå‚æ•°æ›´æ–°ä¸ºï¼š</p>
<p>$$\Delta \boldsymbol{w}_A = -\eta \tilde{\boldsymbol{g}}_B = -\eta \cdot \frac{1}{B}\sum_{i=1}^{B} \tilde{\boldsymbol{g}}_i$$</p>
<p>åœ¨æ–¹æ¡ˆBä¸­ï¼Œæ€»çš„å‚æ•°æ›´æ–°ä¸ºï¼š</p>
<p>$$\Delta \boldsymbol{w}_B = -\sum_{i=1}^{B} \frac{\eta}{B} \tilde{\boldsymbol{g}}_i = -\frac{\eta}{B}\sum_{i=1}^{B} \tilde{\boldsymbol{g}}_i$$</p>
<p>å¦‚æœ$B$æ­¥ä¸­é‡åˆ°çš„æ ·æœ¬æ°å¥½å°±æ˜¯æ–¹æ¡ˆAçš„batchä¸­çš„æ ·æœ¬ï¼Œåˆ™$\Delta \boldsymbol{w}_A = \Delta \boldsymbol{w}_B$ã€‚è¿™è¯´æ˜çº¿æ€§ç¼©æ”¾è§„åˆ™èƒ½ä¿è¯<strong>æœŸæœ›æ„ä¹‰ä¸‹</strong>çš„å‚æ•°æ›´æ–°ä¸€è‡´æ€§ã€‚</p>
<p><strong>ä¸¥æ ¼æ¨å¯¼</strong>ï¼šä»æŸå¤±ä¸‹é™çš„è§’åº¦ï¼Œè€ƒè™‘ä¸€é˜¶è¿‘ä¼¼ï¼š</p>
<p>$$\mathbb{E}[\mathcal{L}(\boldsymbol{w} - \eta \tilde{\boldsymbol{g}}_B)] \approx \mathcal{L}(\boldsymbol{w}) - \eta \mathbb{E}[\tilde{\boldsymbol{g}}_B]^{\top} \boldsymbol{g} = \mathcal{L}(\boldsymbol{w}) - \eta \|\boldsymbol{g}\|^2$$</p>
<p>è¿™è¡¨æ˜åœ¨ä¸€é˜¶è¿‘ä¼¼ä¸‹ï¼ŒæŸå¤±ä¸‹é™é‡åªä¸å­¦ä¹ ç‡å’ŒçœŸå®æ¢¯åº¦æœ‰å…³ï¼Œä¸Batch Sizeæ— å…³ã€‚å› æ­¤ï¼Œç†è®ºä¸Šå¯ä»¥ä»»æ„ç¼©æ”¾$(B, \eta)$è€Œä¸æ”¹å˜è®­ç»ƒæ•ˆæœã€‚</p>
<p><strong>é€‚ç”¨æ¡ä»¶</strong>ï¼šçº¿æ€§ç¼©æ”¾è§„åˆ™æˆç«‹éœ€è¦ä»¥ä¸‹å‡è®¾ï¼š
1. æ¢¯åº¦å™ªå£°ç›¸å¯¹è¾ƒå°ï¼š$\text{tr}(\boldsymbol{\Sigma}) \ll |\boldsymbol{g}|^2$
2. å­¦ä¹ ç‡è¶³å¤Ÿå°ï¼Œä½¿å¾—äºŒé˜¶é¡¹å¯å¿½ç•¥
3. è®­ç»ƒå¤„äºç¨³å®šé˜¶æ®µï¼Œæ¢¯åº¦æ–¹å‘åŸºæœ¬ç¡®å®š</p>
<p>å½“è¿™äº›æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼ˆå¦‚è®­ç»ƒåˆæœŸã€å¤§å­¦ä¹ ç‡ã€å¼ºå™ªå£°ç¯å¢ƒï¼‰ï¼Œçº¿æ€§ç¼©æ”¾è§„åˆ™ä¼šå¤±æ•ˆã€‚</p>
<h3 id="4">4. å¹³æ–¹æ ¹ç¼©æ”¾è§„åˆ™çš„ç†è®ºåŸºç¡€</h3>
<p>å½“è€ƒè™‘æ¢¯åº¦å™ªå£°çš„å½±å“æ—¶ï¼Œçº¿æ€§ç¼©æ”¾è§„åˆ™ä¸å†æˆç«‹ã€‚ä»å¼$\eqref{eq:eta-sgd}$å‡ºå‘ï¼š</p>
<p>$$\eta^* = \frac{\eta_{\max}}{1 + \mathcal{B}_{\text{noise}}/B}$$</p>
<p>åœ¨ä¸¤ä¸ªæç«¯æƒ…å†µä¸‹ï¼š</p>
<p><strong>æƒ…å†µ1ï¼šå°BatchåŒºåŸŸ</strong> ($B \ll \mathcal{B}_{\text{noise}}$)</p>
<p>ä½¿ç”¨æ³°å‹’å±•å¼€$\frac{1}{1+x} \approx 1 - x$ï¼ˆå½“$x \gg 1$æ—¶è¿‘ä¼¼ä¸º$1/x$ï¼‰ï¼š</p>
<p>$$\eta^* \approx \frac{\eta_{\max}}{\mathcal{B}_{\text{noise}}/B} = \frac{\eta_{\max} B}{\mathcal{B}_{\text{noise}}} \propto B$$</p>
<p>è¿™æ¢å¤äº†<strong>çº¿æ€§ç¼©æ”¾è§„åˆ™</strong>ã€‚</p>
<p><strong>æƒ…å†µ2ï¼šå¤§BatchåŒºåŸŸ</strong> ($B \gg \mathcal{B}_{\text{noise}}$)</p>
<p>æ­¤æ—¶ï¼š</p>
<p>$$\eta^* \approx \eta_{\max} \cdot \text{const}$$</p>
<p>å­¦ä¹ ç‡è¶‹äºå¸¸æ•°ï¼Œä¸å†éšBatch Sizeå¢é•¿ã€‚</p>
<p><strong>ä¸­é—´åŒºåŸŸçš„å¹³æ–¹æ ¹è§„åˆ™</strong>ï¼šæœ‰äº›æ–‡çŒ®æå‡ºåœ¨ä¸­ç­‰Batch Sizeä¸‹ä½¿ç”¨$\eta \propto \sqrt{B}$ã€‚è¿™å¯ä»¥é€šè¿‡å™ªå£°-ä¿¡å·æ¯”åˆ†æå¾—åˆ°ï¼š</p>
<p>æ¢¯åº¦çš„ä¿¡å™ªæ¯”å®šä¹‰ä¸ºï¼š</p>
<p>$$\text{SNR} = \frac{\|\mathbb{E}[\tilde{\boldsymbol{g}}_B]\|^2}{\text{tr}(\text{Cov}[\tilde{\boldsymbol{g}}_B])} = \frac{\|\boldsymbol{g}\|^2}{\text{tr}(\boldsymbol{\Sigma}/B)} = \frac{B \|\boldsymbol{g}\|^2}{\text{tr}(\boldsymbol{\Sigma})}$$</p>
<p>è¦ä¿æŒä¿¡å™ªæ¯”ä¸å˜ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨ä¸åŒçš„Batch Sizeä¸‹è·å¾—ç›¸åŒçš„æ¢¯åº¦ä¼°è®¡è´¨é‡ï¼Œå¯ä»¥è®¾ç½®ï¼š</p>
<p>$$\eta \propto \frac{1}{\sqrt{\text{SNR}}} \propto \frac{1}{\sqrt{B}}$$</p>
<p>ç„¶åé€šè¿‡å¢åŠ è®­ç»ƒæ­¥æ•°æ¥è¡¥å¿ï¼šæ­¥æ•°$S \propto B$ï¼Œä½¿å¾—æ€»çš„æœ‰æ•ˆæ›´æ–°é‡$\eta \cdot S \propto \sqrt{B} \cdot B = B^{3/2}$ä¿æŒä¸€å®šè§„å¾‹ã€‚</p>
<p>å®é™…ä¸Šï¼Œå¹³æ–¹æ ¹è§„åˆ™æ›´é€‚åˆäº<strong>å›ºå®šè®¡ç®—é¢„ç®—</strong>ä¸‹çš„åˆ†æï¼šåœ¨æ€»è®¡ç®—é‡å›ºå®šæ—¶ï¼Œå¦‚ä½•åˆ†é…Batch Sizeå’Œè®­ç»ƒæ­¥æ•°ã€‚</p>
<h3 id="5">5. æ¢¯åº¦å™ªå£°çš„ç»Ÿè®¡æ·±å…¥åˆ†æ</h3>
<p><strong>å™ªå£°çš„æ¥æº</strong>ï¼šæ¢¯åº¦å™ªå£°ä¸»è¦æ¥è‡ªä¸‰ä¸ªæ–¹é¢ï¼š
1. <strong>é‡‡æ ·å™ªå£°</strong>ï¼šmini-batché‡‡æ ·çš„éšæœºæ€§
2. <strong>æ ‡ç­¾å™ªå£°</strong>ï¼šè®­ç»ƒæ•°æ®æœ¬èº«çš„æ ‡æ³¨é”™è¯¯
3. <strong>æœ¬å¾å™ªå£°</strong>ï¼šæ•°æ®åˆ†å¸ƒçš„å›ºæœ‰éšæœºæ€§</p>
<p><strong>åæ–¹å·®çŸ©é˜µçš„ç»“æ„</strong>ï¼šå®šä¹‰å•æ ·æœ¬æ¢¯åº¦çš„åæ–¹å·®çŸ©é˜µï¼š</p>
<p>$$\boldsymbol{\Sigma} = \mathbb{E}_{\xi \sim \mathcal{D}}[(\nabla \ell(\boldsymbol{w}; \xi) - \boldsymbol{g})(\nabla \ell(\boldsymbol{w}; \xi) - \boldsymbol{g})^{\top}]$$</p>
<p>å…¶ä¸­$\xi$æ˜¯ä»æ•°æ®åˆ†å¸ƒ$\mathcal{D}$ä¸­é‡‡æ ·çš„å•ä¸ªæ ·æœ¬ï¼Œ$\ell(\boldsymbol{w}; \xi)$æ˜¯è¯¥æ ·æœ¬çš„æŸå¤±ã€‚</p>
<p>åæ–¹å·®çŸ©é˜µçš„è¿¹å¯ä»¥åˆ†è§£ä¸ºå„å‚æ•°ç»´åº¦ä¸Šçš„æ–¹å·®ä¹‹å’Œï¼š</p>
<p>$$\text{tr}(\boldsymbol{\Sigma}) = \sum_{i=1}^{N} \sigma_i^2, \quad \sigma_i^2 = \mathbb{E}[(g_i(\xi) - g_i)^2]$$</p>
<p><strong>ç®€åŒ–çš„å™ªå£°æ¨¡å‹</strong>ï¼šåœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬å¸¸å‡è®¾ï¼š</p>
<p>$$\boldsymbol{\Sigma} \approx \sigma^2 \boldsymbol{I}$$</p>
<p>å³å„ç»´åº¦çš„å™ªå£°ç‹¬ç«‹ä¸”åŒåˆ†å¸ƒã€‚æ­¤æ—¶ï¼š</p>
<p>$$\text{tr}(\boldsymbol{\Sigma}) = N\sigma^2$$</p>
<p>è™½ç„¶è¿™ä¸ªå‡è®¾å¾ˆå¼ºï¼Œä½†å®ƒæå¤§ç®€åŒ–äº†åˆ†æï¼Œä¸”åœ¨å¾ˆå¤šæƒ…å†µä¸‹èƒ½ç»™å‡ºåˆç†çš„é¢„æµ‹ã€‚</p>
<p><strong>å™ªå£°å°ºåº¦çš„å®é™…ä¼°è®¡</strong>ï¼šåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¼°è®¡$\mathcal{B}_{\text{noise}}$ï¼š</p>
<ol>
<li>åœ¨åŒä¸€ä½ç½®é‡‡æ ·å¤šä¸ªä¸åŒçš„batch</li>
<li>è®¡ç®—è¿™äº›batchçš„æ¢¯åº¦æ–¹å·®</li>
<li>ä½¿ç”¨å…¬å¼$\mathcal{B}_{\text{simple}} = \text{tr}(\boldsymbol{\Sigma}) / |\boldsymbol{g}|^2$</li>
</ol>
<p>OpenAIçš„å®éªŒè¡¨æ˜ï¼Œ$\mathcal{B}<em _text_noise="\text{noise">{\text{noise}}$åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šå˜åŒ–ï¼š
- è®­ç»ƒåˆæœŸï¼šæŸå¤±é«˜ï¼Œæ¢¯åº¦å¤§ï¼Œå™ªå£°ç›¸å¯¹å°ï¼Œ$\mathcal{B}</em>$è¾ƒå°
- è®­ç»ƒåæœŸï¼šæŸå¤±ä½ï¼Œæ¢¯åº¦å°ï¼Œå™ªå£°ç›¸å¯¹å¤§ï¼Œ$\mathcal{B}_{\text{noise}}$å¢å¤§}</p>
<p>è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆè®­ç»ƒåæœŸéœ€è¦æ›´å¤§çš„Batch Sizeæ‰èƒ½ç»´æŒç¨³å®šæ€§ã€‚</p>
<p><strong>å™ªå£°ä¸Hessiançš„è€¦åˆ</strong>ï¼šæ›´ç²¾ç¡®çš„å™ªå£°åº¦é‡åº”è¯¥è€ƒè™‘HessiançŸ©é˜µï¼š</p>
<p>$$\mathcal{B}_{\text{noise}} = \frac{\text{tr}(\boldsymbol{\Sigma} \boldsymbol{H})}{\boldsymbol{g}^{\top} \boldsymbol{H} \boldsymbol{g}}$$</p>
<p>è¿™ä¸ªå®šä¹‰çš„ç‰©ç†æ„ä¹‰æ˜¯ï¼šå™ªå£°åœ¨æŸå¤±å‡½æ•°æ›²ç‡æ–¹å‘ä¸Šçš„æŠ•å½±ã€‚åœ¨æ¢¯åº¦æ–¹å‘æ›²ç‡è¾ƒå¤§çš„åŒºåŸŸï¼Œå³ä½¿å™ªå£°ç»å¯¹å€¼å°ï¼Œå…¶å½±å“ä¹Ÿä¼šè¢«æ”¾å¤§ã€‚</p>
<h3 id="6-batchgeneralization-gap">6. å¤§Batchè®­ç»ƒçš„æ³›åŒ–å·®è·ï¼ˆGeneralization Gapï¼‰</h3>
<p><strong>æ³›åŒ–å·®è·çš„å®šä¹‰</strong>ï¼šå®šä¹‰è®­ç»ƒæŸå¤±ä¸º$\mathcal{L}<em _text_test="\text{test">{\text{train}}$ï¼Œæµ‹è¯•æŸå¤±ä¸º$\mathcal{L}</em>$ï¼Œæ³›åŒ–å·®è·ä¸ºï¼š}</p>
<p>$$\Delta_{\text{gen}} = \mathcal{L}_{\text{test}} - \mathcal{L}_{\text{train}}$$</p>
<p>å®éªŒè§‚å¯Ÿåˆ°ï¼šåœ¨è¾¾åˆ°ç›¸åŒçš„è®­ç»ƒæŸå¤±æ—¶ï¼Œä½¿ç”¨å¤§Batch Sizeè®­ç»ƒçš„æ¨¡å‹å¾€å¾€æœ‰æ›´å¤§çš„$\Delta_{\text{gen}}$ã€‚</p>
<p><strong>Sharp Minima vs. Flat Minimaç†è®º</strong>ï¼š</p>
<p>ä¸€ç§è§£é‡ŠåŸºäºæŸå¤±landscapeçš„å‡ ä½•æ€§è´¨ã€‚å®šä¹‰HessiançŸ©é˜µçš„æœ€å¤§ç‰¹å¾å€¼ä¸ºé”åº¦æŒ‡æ ‡ï¼š</p>
<p>$$S(\boldsymbol{w}) = \lambda_{\max}(\boldsymbol{H}(\boldsymbol{w}))$$</p>
<p>Sharp minimaï¼ˆé”çš„æå°å€¼ï¼‰å¯¹åº”é«˜é”åº¦ï¼ŒFlat minimaï¼ˆå¹³å¦çš„æå°å€¼ï¼‰å¯¹åº”ä½é”åº¦ã€‚</p>
<p><strong>æ³°å‹’å±•å¼€åˆ†æ</strong>ï¼šè€ƒè™‘æµ‹è¯•æ•°æ®ä¸Šçš„æŸå¤±ï¼Œåœ¨è®­ç»ƒè§£$\boldsymbol{w}^*$é™„è¿‘å±•å¼€ï¼š</p>
<p>$$\mathcal{L}_{\text{test}}(\boldsymbol{w}^* + \delta \boldsymbol{w}) \approx \mathcal{L}_{\text{test}}(\boldsymbol{w}^*) + \frac{1}{2} \delta \boldsymbol{w}^{\top} \boldsymbol{H}_{\text{test}} \delta \boldsymbol{w}$$</p>
<p>å…¶ä¸­$\delta \boldsymbol{w}$è¡¨ç¤ºè®­ç»ƒæ•°æ®å’Œæµ‹è¯•æ•°æ®åˆ†å¸ƒå·®å¼‚å¯¼è‡´çš„æœ€ä¼˜è§£åç§»ã€‚å¦‚æœ$\boldsymbol{H}_{\text{test}}$çš„ç‰¹å¾å€¼è¾ƒå¤§ï¼ˆsharpï¼‰ï¼Œåˆ™å°çš„$\delta \boldsymbol{w}$ä¼šå¯¼è‡´å¤§çš„æŸå¤±å¢åŠ ã€‚</p>
<p><strong>å¤§Batchå¦‚ä½•å¯¼è‡´Sharp Minima</strong>ï¼š</p>
<p>å°Batch SGDå¼•å…¥çš„å™ªå£°å¯ä»¥çœ‹ä½œä¸€ç§éšå¼æ­£åˆ™åŒ–ï¼š</p>
<p>$$\boldsymbol{w}_{t+1} = \boldsymbol{w}_t - \eta \tilde{\boldsymbol{g}}_B = \boldsymbol{w}_t - \eta \boldsymbol{g} - \eta \boldsymbol{\epsilon}_B$$</p>
<p>å…¶ä¸­$\boldsymbol{\epsilon}_B \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{\Sigma}/B)$æ˜¯å™ªå£°é¡¹ã€‚è¿™ä¸ªå™ªå£°é¡¹ç±»ä¼¼äºç»™å‚æ•°æ·»åŠ äº†éšæœºæ‰°åŠ¨ï¼Œå¸®åŠ©æ¨¡å‹é€ƒç¦»sharp minimaã€‚</p>
<p>å½“$B$å¢å¤§æ—¶ï¼Œå™ªå£°å‡å°ï¼Œæ¨¡å‹æ›´å®¹æ˜“å›°åœ¨sharp minimaä¸­ã€‚å¯ä»¥è¯æ˜ï¼Œç¨³æ€åˆ†å¸ƒè¿‘ä¼¼ä¸ºï¼š</p>
<p>$$p(\boldsymbol{w}) \propto \exp\left(-\frac{2B}{\eta} \mathcal{L}(\boldsymbol{w})\right)$$</p>
<p>"æœ‰æ•ˆæ¸©åº¦"ä¸º$T = \eta/(2B)$ã€‚å¤§Batchï¼ˆå°æ¸©åº¦ï¼‰å¯¼è‡´åˆ†å¸ƒæ›´é›†ä¸­äºsharp minimaï¼Œå°Batchï¼ˆé«˜æ¸©åº¦ï¼‰å€¾å‘äºflat minimaã€‚</p>
<p><strong>æ•°æ®æ•ˆç‡ä¸æ³›åŒ–çš„æƒè¡¡</strong>ï¼š</p>
<p>è™½ç„¶å¤§Batchæé«˜äº†æ•°æ®æ•ˆç‡ï¼ˆæ¯æ­¥çœ‹æ›´å¤šæ•°æ®ï¼‰ï¼Œä½†ç‰ºç‰²äº†æ³›åŒ–èƒ½åŠ›ã€‚æ€»ä½“æ•ˆæœå–å†³äºï¼š</p>
<p>$$\text{Total Cost} = \alpha \cdot E + \beta \cdot \Delta_{\text{gen}}$$</p>
<p>å…¶ä¸­$E$æ˜¯æ•°æ®æ¶ˆè€—ï¼Œ$\alpha, \beta$æ˜¯æƒé‡ç³»æ•°ã€‚æœ€ä¼˜çš„Batch Sizeéœ€è¦åœ¨è¿™ä¸¤è€…ä¹‹é—´å¹³è¡¡ã€‚</p>
<h3 id="7-batch-size">7. ä¸´ç•ŒBatch Sizeçš„å®šä¹‰ä¸åˆ†æ</h3>
<p><strong>ä¸´ç•ŒBatch Sizeçš„ç‰©ç†å®šä¹‰</strong>ï¼š</p>
<p>ä»å¼$\eqref{eq:eta-sgd}$å¯è§ï¼Œå½“$B = \mathcal{B}_{\text{noise}}$æ—¶ï¼š</p>
<p>$$\eta^* = \frac{\eta_{\max}}{1 + 1} = \frac{\eta_{\max}}{2}$$</p>
<p>æ­¤æ—¶å­¦ä¹ ç‡å·²ç»æ˜¯æœ€å¤§å€¼çš„ä¸€åŠï¼Œç»§ç»­å¢å¤§$B$çš„æ”¶ç›Šé€’å‡ã€‚æˆ‘ä»¬å®šä¹‰ï¼š</p>
<p>$$\mathcal{B}_{\text{crit}} = \mathcal{B}_{\text{noise}} = \frac{\text{tr}(\boldsymbol{\Sigma} \boldsymbol{H})}{\boldsymbol{g}^{\top} \boldsymbol{H} \boldsymbol{g}}$$</p>
<p>ä¸º<strong>ä¸´ç•ŒBatch Size</strong>ã€‚</p>
<p><strong>ä»æ•°æ®æ•ˆç‡è§’åº¦ç†è§£</strong>ï¼š</p>
<p>å›é¡¾$E = (B + \mathcal{B}<em _min="\min">{\text{noise}})S</em>$ï¼Œå®šä¹‰æ•°æ®æ•ˆç‡ä¸ºï¼š</p>
<p>$$\epsilon(B) = \frac{E_{\min}}{E} = \frac{\mathcal{B}_{\text{noise}}}{B + \mathcal{B}_{\text{noise}}}$$</p>
<p>å¯¹$B$æ±‚å¯¼ï¼š</p>
<p>$$\frac{d\epsilon}{dB} = -\frac{\mathcal{B}_{\text{noise}}}{(B + \mathcal{B}_{\text{noise}})^2}$$</p>
<p>åœ¨$B = \mathcal{B}_{\text{noise}}$å¤„ï¼š</p>
<p>$$\left|\frac{d\epsilon}{dB}\right|_{B=\mathcal{B}_{\text{noise}}} = \frac{\mathcal{B}_{\text{noise}}}{4\mathcal{B}_{\text{noise}}^2} = \frac{1}{4\mathcal{B}_{\text{noise}}}$$</p>
<p>æ•ˆç‡å¯¹Batch Sizeçš„æ•æ„Ÿåº¦åœ¨ä¸´ç•Œç‚¹é™„è¿‘è¾¾åˆ°ä¸€ä¸ªç‰¹å¾å°ºåº¦ã€‚</p>
<p><strong>ä¸´ç•ŒBatch Sizeçš„å®éªŒç¡®å®š</strong>ï¼š</p>
<p>å®è·µä¸­å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ç¡®å®š$\mathcal{B}_{\text{crit}}$ï¼š</p>
<ol>
<li>å›ºå®šå…¶ä»–è¶…å‚æ•°ï¼Œæ‰«æä¸åŒçš„$(B, \eta)$ç»„åˆ</li>
<li>è®°å½•è¾¾åˆ°ç›®æ ‡æŸå¤±æ‰€éœ€çš„æ­¥æ•°$S$å’Œæ•°æ®é‡$E$</li>
<li>æ‹ŸåˆåŒæ›²çº¿å…³ç³»$(S/S_{\min} - 1)(E/E_{\min} - 1) = 1$</li>
<li>æå–$\mathcal{B}<em _min="\min">{\text{crit}} = E</em>$}/S_{\min</li>
</ol>
<p><strong>ä¸´ç•ŒBatch Sizeçš„åŠ¨æ€æ€§</strong>ï¼š</p>
<p>$\mathcal{B}_{\text{crit}}$ä¸æ˜¯å¸¸æ•°ï¼Œè€Œæ˜¯éšè®­ç»ƒè¿‡ç¨‹å˜åŒ–ï¼š</p>
<p>$$\mathcal{B}_{\text{crit}}(t) = \frac{\text{tr}(\boldsymbol{\Sigma}(t) \boldsymbol{H}(t))}{\boldsymbol{g}(t)^{\top} \boldsymbol{H}(t) \boldsymbol{g}(t)}$$</p>
<p>ä¸€èˆ¬è§„å¾‹ï¼š
- è®­ç»ƒåˆæœŸï¼šæ¢¯åº¦å¤§ï¼Œ$\mathcal{B}<em _text_crit="\text{crit">{\text{crit}}$å°ï¼Œé€‚åˆå°Batch
- è®­ç»ƒä¸­æœŸï¼š$\mathcal{B}</em>$å¢å¤§ï¼Œå¯ä»¥å¢å¤§Batch Size
- è®­ç»ƒåæœŸï¼šæ¢¯åº¦å°ï¼Œå™ªå£°ç›¸å¯¹å¤§ï¼Œ$\mathcal{B}_{\text{crit}}$å¾ˆå¤§ï¼Œéœ€è¦å¤§Batch}</p>
<p>è¿™å¯å‘äº†<strong>åŠ¨æ€Batch Size</strong>ç­–ç•¥ï¼šéšè®­ç»ƒè¿›è¡Œé€æ­¥å¢å¤§$B$ã€‚</p>
<h3 id="8-warmup">8. å­¦ä¹ ç‡é¢„çƒ­ï¼ˆWarmupï¼‰çš„æ•°å­¦åŸç†</h3>
<p><strong>é¢„çƒ­çš„å¿…è¦æ€§</strong>ï¼š</p>
<p>åœ¨è®­ç»ƒåˆæœŸï¼Œå¦‚æœç›´æ¥ä½¿ç”¨å¤§å­¦ä¹ ç‡ï¼Œå¯èƒ½å¯¼è‡´ï¼š
1. å‚æ•°å‰§çƒˆå˜åŒ–ï¼Œç ´åé¢„è®­ç»ƒæƒé‡ï¼ˆå¦‚æœ‰ï¼‰
2. æ¢¯åº¦çˆ†ç‚¸æˆ–æ¶ˆå¤±
3. ä¼˜åŒ–å™¨çš„äºŒé˜¶åŠ¨é‡ï¼ˆå¦‚Adamçš„$v$ï¼‰å°šæœªç¨³å®š</p>
<p><strong>çº¿æ€§é¢„çƒ­çš„å®šä¹‰</strong>ï¼š</p>
<p>åœ¨å‰$T_{\text{warmup}}$æ­¥å†…ï¼Œå­¦ä¹ ç‡ä»$\eta_0$çº¿æ€§å¢åŠ åˆ°ç›®æ ‡å€¼$\eta_{\text{target}}$ï¼š</p>
<p>$$\eta(t) = \eta_0 + \frac{t}{T_{\text{warmup}}}(\eta_{\text{target}} - \eta_0), \quad t \leq T_{\text{warmup}}$$</p>
<p>é€šå¸¸å–$\eta_0 = 0$æˆ–å¾ˆå°çš„å€¼ã€‚</p>
<p><strong>ç†è®ºè§£é‡Š1ï¼šäºŒé˜¶åŠ¨é‡çš„ç§¯ç´¯</strong></p>
<p>å¯¹äºAdamç­‰è‡ªé€‚åº”ä¼˜åŒ–å™¨ï¼Œå…¶æ›´æ–°è§„åˆ™ä¸ºï¼š</p>
<p>$$\boldsymbol{w}_{t+1} = \boldsymbol{w}_t - \eta \frac{\boldsymbol{m}_t}{\sqrt{\boldsymbol{v}_t} + \epsilon}$$</p>
<p>å…¶ä¸­$\boldsymbol{v}<em t-1="t-1">t = \beta_2 \boldsymbol{v}</em>_t^2$æ˜¯æ¢¯åº¦å¹³æ–¹çš„æŒ‡æ•°ç§»åŠ¨å¹³å‡ã€‚} + (1-\beta_2) \boldsymbol{g</p>
<p>åœ¨åˆæœŸå‡ æ­¥ï¼Œ$\boldsymbol{v}_t$è¿˜æœªå……åˆ†ç§¯ç´¯ï¼Œå…¶å€¼åå°ï¼Œå¯¼è‡´æœ‰æ•ˆå­¦ä¹ ç‡$\eta/\sqrt{\boldsymbol{v}_t}$åå¤§ã€‚é¢„çƒ­ç›¸å½“äºç»™$\boldsymbol{v}_t$ä¸€ä¸ªå»ºç«‹çš„æ—¶é—´çª—å£ã€‚</p>
<p>å®šé‡åˆ†æï¼šå‡è®¾æ¢¯åº¦ä¿æŒå¸¸æ•°$\boldsymbol{g}$ï¼Œåˆ™ï¼š</p>
<p>$$v_t = (1-\beta_2^t) g^2$$</p>
<p>åœ¨$t \ll 1/(1-\beta_2)$æ—¶ï¼Œ$v_t \approx (1-\beta_2) t g^2$ï¼Œæœ‰æ•ˆå­¦ä¹ ç‡ä¸ºï¼š</p>
<p>$$\eta_{\text{eff}} = \frac{\eta}{\sqrt{v_t}} \approx \frac{\eta}{\sqrt{(1-\beta_2) t} |g|} \propto \frac{1}{\sqrt{t}}$$</p>
<p>ä¸ºäº†æŠµæ¶ˆè¿™ç§$1/\sqrt{t}$çš„æ•ˆåº”ï¼Œå¯ä»¥è®¾ç½®$\eta(t) \propto \sqrt{t}$ï¼Œè¿™æ¥è¿‘çº¿æ€§é¢„çƒ­ï¼ˆåœ¨å¯¹æ•°å°ºåº¦ä¸Šï¼‰ã€‚</p>
<p><strong>ç†è®ºè§£é‡Š2ï¼šæ›²ç‡çš„ä¼°è®¡</strong></p>
<p>åœ¨è®­ç»ƒåˆæœŸï¼ŒæŸå¤±landscapeçš„å±€éƒ¨æ›²ç‡ï¼ˆHessianï¼‰å¯èƒ½ä¸ç¨³æ€æ—¶å·®å¼‚å¾ˆå¤§ã€‚ç†è®ºæœ€ä¼˜å­¦ä¹ ç‡ï¼š</p>
<p>$$\eta^* = \frac{\|\boldsymbol{g}\|^2}{\boldsymbol{g}^{\top} \boldsymbol{H} \boldsymbol{g}}$$</p>
<p>å¦‚æœåˆæœŸçš„$\boldsymbol{H}$ç‰¹å¾å€¼å¼‚å¸¸å¤§ï¼ˆsharpï¼‰ï¼Œåˆ™$\eta^*$åº”è¯¥å¾ˆå°ã€‚é¢„çƒ­ç›¸å½“äºé€æ­¥æ¢æµ‹å’Œé€‚åº”å±€éƒ¨æ›²ç‡ã€‚</p>
<p><strong>ç†è®ºè§£é‡Š3ï¼šæ¢¯åº¦å™ªå£°çš„åˆå§‹é˜¶æ®µ</strong></p>
<p>åˆæœŸçš„æ¢¯åº¦å™ªå£°å¯èƒ½å¼‚å¸¸å¤§ï¼ˆå› ä¸ºå‚æ•°è¿œç¦»æœ€ä¼˜è§£ï¼‰ã€‚æ ¹æ®ï¼š</p>
<p>$$\eta^* = \frac{\eta_{\max}}{1 + \mathcal{B}_{\text{noise}}/B}$$</p>
<p>å¦‚æœåˆæœŸ$\mathcal{B}<em _text_noise="\text{noise">{\text{noise}}$å¾ˆå¤§ï¼Œåˆ™éœ€è¦è¾ƒå°çš„$\eta$ã€‚éšç€è®­ç»ƒè¿›è¡Œï¼Œ$\mathcal{B}</em>$å‡å°ï¼Œå¯ä»¥å¢å¤§$\eta$ã€‚}</p>
<p><strong>é¢„çƒ­æ­¥æ•°çš„é€‰æ‹©</strong>ï¼š</p>
<p>ç»éªŒä¸Šï¼Œ$T_{\text{warmup}}$å¸¸å–æ€»è®­ç»ƒæ­¥æ•°çš„1%-10%ã€‚ç†è®ºä¸Šåº”è¯¥å–ï¼š</p>
<p>$$T_{\text{warmup}} \sim \frac{1}{1 - \beta_2}$$</p>
<p>å¯¹äº$\beta_2 = 0.999$ï¼ˆAdamé»˜è®¤å€¼ï¼‰ï¼Œè¿™ç»™å‡º$T_{\text{warmup}} \sim 1000$æ­¥ã€‚</p>
<p><strong>ä¸Batch Sizeçš„å…³ç³»</strong>ï¼š</p>
<p>å½“ä½¿ç”¨å¤§Batch Sizeæ—¶ï¼Œæ¯æ­¥çœ‹åˆ°çš„æ•°æ®æ›´å¤šï¼Œä¼˜åŒ–å™¨çš„ç»Ÿè®¡é‡ï¼ˆ$\boldsymbol{m}, \boldsymbol{v}$ï¼‰ç§¯ç´¯æ›´å¿«ã€‚å› æ­¤ï¼Œé¢„çƒ­æ­¥æ•°å¯ä»¥ç›¸åº”å‡å°‘ï¼š</p>
<p>$$T_{\text{warmup}}(B) = \frac{T_{\text{warmup}}(B_0)}{B/B_0}$$</p>
<p>æˆ–è€…ä¿æŒæ•°æ®é‡æ’å®šï¼š</p>
<p>$$T_{\text{warmup}}(B) \cdot B = \text{const}$$</p>
<h3 id="9">9. å­¦ä¹ ç‡è¡°å‡ç­–ç•¥çš„ç†è®ºå¯¹æ¯”</h3>
<p><strong>æŒ‡æ•°è¡°å‡ï¼ˆExponential Decayï¼‰</strong>ï¼š</p>
<p>$$\eta(t) = \eta_0 \gamma^{t/T}$$</p>
<p>å…¶ä¸­$\gamma &lt; 1$æ˜¯è¡°å‡ç‡ï¼Œ$T$æ˜¯è¡°å‡å‘¨æœŸã€‚</p>
<p>ç†è®ºä¾æ®ï¼šå‡è®¾æŸå¤±éšæ—¶é—´æŒ‡æ•°è¡°å‡$\mathcal{L}(t) \sim e^{-\alpha t}$ï¼Œåˆ™æ¢¯åº¦ä¹ŸæŒ‡æ•°è¡°å‡$|\boldsymbol{g}(t)| \sim e^{-\alpha t}$ã€‚æ ¹æ®$\eta^* \propto |\boldsymbol{g}|^2$ï¼Œå­¦ä¹ ç‡åº”è¯¥æŒ‰$e^{-2\alpha t}$è¡°å‡ï¼Œè¿™æ­£æ˜¯æŒ‡æ•°è¡°å‡çš„å½¢å¼ã€‚</p>
<p><strong>å¤šé¡¹å¼è¡°å‡ï¼ˆPolynomial Decayï¼‰</strong>ï¼š</p>
<p>$$\eta(t) = \eta_0 \left(1 - \frac{t}{T_{\text{max}}}\right)^p$$</p>
<p>å¸¸ç”¨$p=1$ï¼ˆçº¿æ€§è¡°å‡ï¼‰æˆ–$p=2$ï¼ˆäºŒæ¬¡è¡°å‡ï¼‰ã€‚</p>
<p>ç†è®ºä¾æ®ï¼šåœ¨å‡¸ä¼˜åŒ–ä¸­ï¼Œå¯ä»¥è¯æ˜ä½¿ç”¨$\eta(t) = \eta_0/\sqrt{t}$å¯ä»¥è¾¾åˆ°$O(1/\sqrt{t})$çš„æ”¶æ•›ç‡ã€‚å¤šé¡¹å¼è¡°å‡æ˜¯è¿™ç§æ€æƒ³çš„ç¦»æ•£åŒ–ç‰ˆæœ¬ã€‚</p>
<p><strong>ä½™å¼¦è¡°å‡ï¼ˆCosine Annealingï¼‰</strong>ï¼š</p>
<p>$$\eta(t) = \eta_{\min} + \frac{1}{2}(\eta_0 - \eta_{\min})\left(1 + \cos\left(\frac{t}{T_{\text{max}}}\pi\right)\right)$$</p>
<p>ç†è®ºä¾æ®ï¼šä½™å¼¦å‡½æ•°æä¾›äº†å¹³æ»‘çš„ã€éå•è°ƒçš„è¡°å‡æ›²çº¿ã€‚åœ¨$t=0$å’Œ$t=T_{\text{max}}$é™„è¿‘æ–œç‡æ¥è¿‘0ï¼Œé¿å…äº†çªå˜ã€‚</p>
<p><strong>æ­¥é•¿è¡°å‡ï¼ˆStep Decayï¼‰</strong>ï¼š</p>
<p>$$\eta(t) = \eta_0 \gamma^{\lfloor t/T \rfloor}$$</p>
<p>æ¯éš”$T$æ­¥å°†å­¦ä¹ ç‡ä¹˜ä»¥$\gamma$ã€‚</p>
<p>ç†è®ºä¾æ®ï¼šç®€å•å®ç”¨ï¼Œä½†ç¼ºä¹ç†è®ºæ”¯æŒã€‚å¯ä»¥çœ‹ä½œæŒ‡æ•°è¡°å‡çš„åˆ†æ®µå¸¸æ•°è¿‘ä¼¼ã€‚</p>
<p><strong>ä»æœ€ä¼˜å­¦ä¹ ç‡è§’åº¦çš„ç»Ÿä¸€ç†è§£</strong>ï¼š</p>
<p>æ‰€æœ‰è¡°å‡ç­–ç•¥æœ¬è´¨ä¸Šéƒ½åœ¨è¿‘ä¼¼ï¼š</p>
<p>$$\eta(t) \approx \eta^*(t) = \frac{\|\boldsymbol{g}(t)\|^2}{\boldsymbol{g}(t)^{\top} \boldsymbol{H}(t) \boldsymbol{g}(t)}$$</p>
<p>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼š
- $|\boldsymbol{g}(t)|$é€šå¸¸å•è°ƒé€’å‡ï¼ˆæ¥è¿‘æœ€ä¼˜è§£ï¼‰
- $\boldsymbol{H}(t)$çš„ä¸»å¯¼ç‰¹å¾å€¼å˜åŒ–è¾ƒæ…¢</p>
<p>å› æ­¤$\eta^*(t)$åº”è¯¥é€’å‡ï¼Œä½†å…·ä½“å½¢å¼ä¾èµ–äºä»»åŠ¡ã€‚</p>
<p><strong>è¡°å‡ç­–ç•¥ä¸Batch Sizeçš„äº¤äº’</strong>ï¼š</p>
<p>å½“å¢å¤§Batch Sizeæ—¶ï¼Œç›¸å½“äºå‡å°äº†æ¢¯åº¦å™ªå£°ï¼Œå¯ä»¥ä½¿ç”¨æ›´ç¨³å®šçš„å­¦ä¹ ç‡ã€‚ä¸€ç§ç­–ç•¥æ˜¯ï¼š</p>
<ul>
<li>å°Batchï¼šéœ€è¦æ¿€è¿›çš„è¡°å‡ï¼Œå¦‚æŒ‡æ•°è¡°å‡</li>
<li>å¤§Batchï¼šå¯ä»¥ä½¿ç”¨æ¸©å’Œçš„è¡°å‡ï¼Œå¦‚ä½™å¼¦è¡°å‡</li>
</ul>
<p>æ•°å­¦ä¸Šï¼Œè€ƒè™‘åˆ°$\mathcal{B}_{\text{noise}}$çš„å˜åŒ–ï¼š</p>
<p>$$\eta^*(t, B) = \frac{\eta_{\max}(t)}{1 + \mathcal{B}_{\text{noise}}(t)/B}$$</p>
<p>å½“$B$å¾ˆå¤§æ—¶ï¼Œ$\eta^<em> \approx \eta_{\max}(t)$ï¼Œåªéœ€è¦è°ƒåº¦$\eta_{\max}$å³å¯ï¼›å½“$B$å¾ˆå°æ—¶ï¼Œ$\eta^</em>$å¯¹$\mathcal{B}_{\text{noise}}$æ•æ„Ÿï¼Œéœ€è¦æ›´ç²¾ç»†çš„è°ƒåº¦ã€‚</p>
<h3 id="10">10. å®éªŒç°è±¡çš„ç†è®ºè§£é‡Š</h3>
<p><strong>ç°è±¡1ï¼šçº¿æ€§ç¼©æ”¾åœ¨å°BatchåŒºåŸŸæˆç«‹ï¼Œåœ¨å¤§BatchåŒºåŸŸå¤±æ•ˆ</strong></p>
<p>ç†è®ºè§£é‡Šï¼šä»$\eta^<em> = \eta_{\max}/(1 + \mathcal{B}<em _text_noise="\text{noise">{\text{noise}}/B)$å¯è§ï¼š
- å½“$B \ll \mathcal{B}</em>$æ—¶ï¼Œ$\eta^}</em> \approx \eta_{\max} B / \mathcal{B}<em _text_noise="\text{noise">{\text{noise}} \propto B$ï¼ˆçº¿æ€§ï¼‰
- å½“$B \gg \mathcal{B}</em>$ï¼ˆå¸¸æ•°ï¼‰}}$æ—¶ï¼Œ$\eta^* \approx \eta_{\max</p>
<p>ä¸´ç•Œç‚¹åœ¨$B \sim \mathcal{B}_{\text{noise}}$ã€‚</p>
<p><strong>ç°è±¡2ï¼šå¤§Batchè®­ç»ƒéœ€è¦æ›´é•¿çš„Warmup</strong></p>
<p>ç†è®ºè§£é‡Šï¼šå¤§Batché™ä½äº†æ¢¯åº¦å™ªå£°ï¼Œä½¿å¾—ä¼˜åŒ–è½¨è¿¹æ›´åŠ ç¡®å®šæ€§ã€‚è¿™æ„å‘³ç€ï¼š
- åˆå§‹ä¸è‰¯çš„æ–¹å‘ä¼šè¢«æŒç»­å¼ºåŒ–
- ç¼ºä¹å°Batchçš„"æ¢ç´¢"æ•ˆåº”æ¥çº æ­£</p>
<p>å› æ­¤éœ€è¦æ›´é•¿çš„Warmupæ¥å°å¿ƒç¿¼ç¿¼åœ°å¯»æ‰¾å¥½çš„åˆå§‹æ–¹å‘ã€‚</p>
<p>ä»åŠ¨é‡ç§¯ç´¯çš„è§’åº¦ï¼šè™½ç„¶å¤§Batchæ—¶æ¯æ­¥çš„ç»Ÿè®¡é‡ç§¯ç´¯æ›´å¿«ï¼Œä½†å®é™…éœ€è¦çš„æ˜¯"ä¿¡æ¯å¤šæ ·æ€§"è€Œé"æ•°æ®é‡"ã€‚Warmupæ­¥æ•°åº”è¯¥æŒ‰<strong>æ ·æœ¬æ•°</strong>è€Œé<strong>batchæ•°</strong>æ¥è®¡ç®—ã€‚</p>
<p><strong>ç°è±¡3ï¼šè®­ç»ƒåæœŸå¢å¤§Batch Sizeæœ‰åŠ©äºç¨³å®šæ€§</strong></p>
<p>ç†è®ºè§£é‡Šï¼šè®­ç»ƒåæœŸ$|\boldsymbol{g}|$å‡å°ï¼Œä½†$\text{tr}(\boldsymbol{\Sigma})$ä¸‹é™è¾ƒæ…¢ï¼ˆå› ä¸ºæ•°æ®å™ªå£°æ˜¯å›ºæœ‰çš„ï¼‰ï¼Œå¯¼è‡´$\mathcal{B}_{\text{noise}} = \text{tr}(\boldsymbol{\Sigma})/|\boldsymbol{g}|^2$å¢å¤§ã€‚</p>
<p>è¦ç»´æŒ$\eta^*$åœ¨åˆç†èŒƒå›´ï¼Œéœ€è¦å¢å¤§$B$ä»¥åŒ¹é…å¢å¤§çš„$\mathcal{B}_{\text{noise}}$ã€‚</p>
<p><strong>ç°è±¡4ï¼šAdamå¯¹Batch Sizeä¸å¦‚SGDæ•æ„Ÿ</strong></p>
<p>ç†è®ºè§£é‡Šï¼šAdamçš„è‡ªé€‚åº”å­¦ä¹ ç‡ç›¸å½“äºéšå¼åœ°å½’ä¸€åŒ–äº†æ¢¯åº¦ï¼š</p>
<p>$$\tilde{\boldsymbol{\varphi}}_B^{(\text{Adam})} = \frac{\boldsymbol{m}_t}{\sqrt{\boldsymbol{v}_t} + \epsilon}$$</p>
<p>å³ä½¿Batch Sizeæ”¹å˜å¯¼è‡´$\boldsymbol{m}_t$çš„å°ºåº¦æ”¹å˜ï¼Œ$\boldsymbol{v}_t$ä¹Ÿä¼šç›¸åº”æ”¹å˜ï¼Œä¸¤è€…çš„æ¯”å€¼ä¿æŒç›¸å¯¹ç¨³å®šã€‚</p>
<p>ä»å™ªå£°çš„è§’åº¦ï¼šAdamçš„åˆ†æ¯$\sqrt{\boldsymbol{v}_t}$åŒ…å«äº†æ¢¯åº¦çš„äºŒé˜¶ä¿¡æ¯ï¼Œéƒ¨åˆ†æ•æ‰äº†$\boldsymbol{\Sigma}$çš„å¯¹è§’çº¿ã€‚è¿™ç›¸å½“äºè‡ªé€‚åº”åœ°è°ƒæ•´äº†ä¸åŒç»´åº¦çš„æœ‰æ•ˆBatch Sizeã€‚</p>
<p><strong>ç°è±¡5ï¼šæœ€ä¼˜Batch Sizeéšæ¨¡å‹å’Œæ•°æ®é›†å˜åŒ–</strong></p>
<p>ç†è®ºè§£é‡Šï¼š$\mathcal{B}_{\text{noise}} = \text{tr}(\boldsymbol{\Sigma}\boldsymbol{H})/(\boldsymbol{g}^{\top}\boldsymbol{H}\boldsymbol{g})$ä¾èµ–äºï¼š
- æ•°æ®é›†çš„å›ºæœ‰å™ªå£°ï¼ˆå½±å“$\boldsymbol{\Sigma}$ï¼‰
- æ¨¡å‹çš„å®¹é‡å’Œæ¶æ„ï¼ˆå½±å“$\boldsymbol{H}$ï¼‰
- ä¼˜åŒ–çš„é˜¶æ®µï¼ˆå½±å“$\boldsymbol{g}$ï¼‰</p>
<p>ä¸åŒä»»åŠ¡çš„è¿™äº›é‡å¯ä»¥ç›¸å·®å‡ ä¸ªæ•°é‡çº§ï¼Œå› æ­¤æœ€ä¼˜Batch Sizeä¹Ÿä¼šç›¸å·®å¾ˆå¤§ã€‚</p>
<p>å®éªŒç»éªŒï¼š
- å›¾åƒåˆ†ç±»ï¼š$B \sim 256 - 1024$
- è¯­è¨€æ¨¡å‹é¢„è®­ç»ƒï¼š$B \sim 2048 - 8192$
- å¼ºåŒ–å­¦ä¹ ï¼š$B \sim 32 - 256$ï¼ˆé«˜å™ªå£°ç¯å¢ƒï¼‰</p>
<p><strong>æ€»ç»“</strong>ï¼šä¸Šè¿°æ‰€æœ‰æ¨å¯¼å’Œè§£é‡Šéƒ½åŸºäºäºŒé˜¶æ³°å‹’å±•å¼€çš„æ¡†æ¶ï¼š</p>
<p>$$\mathbb{E}[\mathcal{L}(\boldsymbol{w} - \eta\tilde{\boldsymbol{\varphi}}_B)] \approx \mathcal{L}(\boldsymbol{w}) - \eta\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B]^{\top}\boldsymbol{g} + \frac{1}{2}\eta^2 \text{tr}(\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B\tilde{\boldsymbol{\varphi}}_B^{\top}]\boldsymbol{H})$$</p>
<p>å…³é”®æ˜¯è®¡ç®—$\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B]$å’Œ$\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B\tilde{\boldsymbol{\varphi}}_B^{\top}]$ï¼Œå®ƒä»¬å®Œå…¨ç”±ä¼˜åŒ–å™¨çš„å…·ä½“å½¢å¼å†³å®šã€‚SGDçš„æƒ…å†µæœ€ç®€å•ï¼Œå› ä¸º$\tilde{\boldsymbol{\varphi}}_B = \tilde{\boldsymbol{g}}_B$æ˜¯çº¿æ€§çš„ï¼›è€ŒSignSGDã€Adamç­‰éœ€è¦æ›´å¤æ‚çš„åˆ†æï¼Œè¿™æ­£æ˜¯ä¸‹ç¯‡æ–‡ç« å°†è¦æ¢è®¨çš„å†…å®¹ã€‚</p>
        </div>
    </div>
</body>
</html>