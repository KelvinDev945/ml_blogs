<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adamçš„epsilonå¦‚ä½•å½±å“å­¦ä¹ ç‡çš„Scaling Lawï¼Ÿ</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>Adamçš„epsilonå¦‚ä½•å½±å“å­¦ä¹ ç‡çš„Scaling Lawï¼Ÿ</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-26 | ğŸ“„ å¤§å°: 33.5 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/10563">https://spaces.ac.cn/archives/10563</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>ä¸Šä¸€ç¯‡æ–‡ç« <a href="/archives/10542">ã€Šå½“Batch Sizeå¢å¤§æ—¶ï¼Œå­¦ä¹ ç‡è¯¥å¦‚ä½•éšä¹‹å˜åŒ–ï¼Ÿã€‹</a>æˆ‘ä»¬ä»å¤šä¸ªè§’åº¦è®¨è®ºäº†å­¦ä¹ ç‡ä¸Batch Sizeä¹‹é—´çš„ç¼©æ”¾è§„å¾‹ï¼Œå…¶ä¸­å¯¹äºAdamä¼˜åŒ–å™¨æˆ‘ä»¬é‡‡ç”¨äº†SignSGDè¿‘ä¼¼ï¼Œè¿™æ˜¯åˆ†æAdamä¼˜åŒ–å™¨å¸¸ç”¨çš„æ‰‹æ®µã€‚é‚£ä¹ˆä¸€ä¸ªå¾ˆè‡ªç„¶çš„é—®é¢˜å°±æ˜¯ï¼šç”¨SignSGDæ¥è¿‘ä¼¼Adamç©¶ç«Ÿæœ‰å¤šç§‘å­¦å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼ŒAdamä¼˜åŒ–å™¨çš„æ›´æ–°é‡åˆ†æ¯ä¼šå¸¦æœ‰ä¸€ä¸ª$\epsilon$ï¼Œåˆè¡·æ˜¯é¢„é˜²é™¤é›¶é”™è¯¯ï¼Œæ‰€ä»¥å…¶å€¼é€šå¸¸å¾ˆæ¥è¿‘äºé›¶ï¼Œä»¥è‡³äºæˆ‘ä»¬åšç†è®ºåˆ†æçš„æ—¶å€™é€šå¸¸é€‰æ‹©å¿½ç•¥æ‰å®ƒã€‚ç„¶è€Œï¼Œå½“å‰LLMçš„è®­ç»ƒå°¤å…¶æ˜¯ä½ç²¾åº¦è®­ç»ƒï¼Œæˆ‘ä»¬å¾€å¾€ä¼šé€‰æ‹©åå¤§çš„$\epsilon$ï¼Œè¿™å¯¼è‡´åœ¨è®­ç»ƒçš„ä¸­ã€åæœŸ$\epsilon$å¾€å¾€å·²ç»è¶…è¿‡æ¢¯åº¦å¹³æ–¹å¤§å°ï¼Œæ‰€ä»¥$\epsilon$çš„å­˜åœ¨äº‹å®ä¸Šå·²ç»ä¸å¯å¿½ç•¥ã€‚</p>
<p>å› æ­¤ï¼Œè¿™ç¯‡æ–‡ç« æˆ‘ä»¬è¯•å›¾æ¢ç´¢$\epsilon$å¦‚ä½•å½±å“Adamçš„å­¦ä¹ ç‡ä¸Batch Sizeçš„Scaling Lawï¼Œä¸ºç›¸å…³é—®é¢˜æä¾›ä¸€ä¸ªå‚è€ƒçš„è®¡ç®—æ–¹æ¡ˆã€‚</p>
<h2 id="softsign">SoftSign</h2>
<p>ç”±äºæ˜¯æ¥ç€ä¸Šä¸€ç¯‡æ–‡ç« ä»‹ç»ï¼Œæ‰€ä»¥å°±ä¸å†é‡å¤ç›¸å…³èƒŒæ™¯äº†ã€‚ä¸ºäº†æ¢ç©¶$\epsilon$çš„ä½œç”¨ï¼Œæˆ‘ä»¬ä»SignSGDæ¢åˆ°SoftSignSGDï¼Œå³$\newcommand{sign}{\mathop{\text{sign}}}\tilde{\boldsymbol{\varphi}}_B = \sign(\tilde{\boldsymbol{g}}_B)$å˜æˆ$\tilde{\boldsymbol{\varphi}}_B = \text{softsign}(\tilde{\boldsymbol{g}}_B)$ï¼Œå…¶ä¸­<br />
\begin{equation}\sign(x)=\frac{x}{\sqrt{x^2}}\quad\to\quad\text{softsign}(x, \epsilon)=\frac{x}{\sqrt{x^2+\epsilon^2}}\end{equation}<br />
è¿™ä¸ªå½¢å¼æ— ç–‘æ›´è´´è¿‘æ›´è´´è¿‘Adamã€‚ä½†åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç¡®è®¤$\epsilon$æ˜¯å¦çœŸçš„ä¸å¯å¿½ç•¥ï¼Œæ‰èƒ½ç¡®å®šæ˜¯å¦æœ‰è¿›ä¸€æ­¥ç ”ç©¶çš„ä»·å€¼ã€‚</p>
<p>åœ¨Kerasçš„Adamå®ç°ä¸­ï¼Œ$\epsilon$çš„é»˜è®¤å€¼æ˜¯$10^{-7}$ï¼Œåœ¨Torchä¸­åˆ™æ˜¯$10^{-8}$ï¼Œè¿™æ—¶å€™æ¢¯åº¦ç»å¯¹å€¼å°äº$\epsilon$å‡ ç‡è¿˜ä¸ç®—å¤§ï¼›ä½†åœ¨LLMä¸­ï¼Œ$\epsilon$çš„æ™®éå–å€¼æ˜¯$10^{-5}$ï¼ˆæ¯”å¦‚<a href="https://papers.cool/arxiv/2307.09288">LLAMA2</a>ï¼‰ï¼Œå½“è®­ç»ƒè¿›å…¥â€œæ­£è½¨â€åï¼Œæ¢¯åº¦ç»å¯¹å€¼å°äº$\epsilon$çš„åˆ†é‡å°†ä¼šå¾ˆæ™®éäº†ï¼Œæ‰€ä»¥$\epsilon$çš„å½±å“æ˜¯æ˜¾è‘—çš„ã€‚</p>
<p>è¿™ä¸ªè·ŸLLMçš„å‚æ•°é‡ä¹Ÿæœ‰ä¸€å®šå…³ç³»ã€‚ä¸€ä¸ªèƒ½ç¨³å®šè®­ç»ƒçš„æ¨¡å‹ï¼Œä¸ç®¡å‚æ•°é‡å¤šå¤§ï¼Œå®ƒçš„æ¢¯åº¦ <em>æ¨¡é•¿å¤§å°</em> å¤§è‡´éƒ½åœ¨åŒä¸€æ•°é‡çº§ï¼Œè¿™æ˜¯åå‘ä¼ æ’­çš„ç¨³å®šæ€§å†³å®šçš„ï¼ˆå‚è€ƒ<a href="/archives/8978">ã€Šè®­ç»ƒ1000å±‚çš„Transformerç©¶ç«Ÿæœ‰ä»€ä¹ˆå›°éš¾ï¼Ÿã€‹</a>ï¼‰ã€‚å› æ­¤ï¼Œå‚æ•°é‡è¶Šå¤§çš„æ¨¡å‹ï¼Œå¹³å‡ä¸‹æ¥æ¯ä¸ªå‚æ•°çš„æ¢¯åº¦ç»åº¦å€¼å°±ç›¸å¯¹å˜å°äº†ï¼Œä»è€Œ$\epsilon$çš„ä½œç”¨å°±æ›´çªå‡ºäº†ã€‚</p>
<p>å€¼å¾—æŒ‡å‡ºçš„æ˜¯ï¼Œ$\epsilon$çš„å¼•å…¥å®é™…ä¸Šæä¾›äº†Adamä¸SGDä¹‹é—´çš„ä¸€ä¸ªæ’å€¼ï¼Œè¿™æ˜¯å› ä¸ºå½“$x\neq 0$æ—¶<br />
\begin{equation}\lim_{\epsilon\to \infty}\epsilon\,\text{softsign}(x, \epsilon)=\lim_{\epsilon\to \infty}\frac{x \epsilon}{\sqrt{x^2+\epsilon^2}} = x\end{equation}<br />
æ‰€ä»¥ï¼Œ$\epsilon$è¶Šå¤§ï¼ŒAdamè¡¨ç°è¶Šæ¥è¿‘SGDã€‚</p>
<h2 id="s">Så‹è¿‘ä¼¼</h2>
<p>ç¡®è®¤äº†å¼•å…¥$\epsilon$å¿…è¦æ€§åï¼Œæˆ‘ä»¬ç€æ‰‹å¼€å§‹åˆ†æã€‚åœ¨åˆ†æè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šåå¤é‡åˆ°Så‹å‡½æ•°ï¼Œæ‰€ä»¥è¿˜æœ‰ä¸€ä¸ªå‡†å¤‡å·¥ä½œæ˜¯æ¢ç©¶Så‹å‡½æ•°çš„ç®€å•è¿‘ä¼¼ã€‚</p>
<p>Så‹å‡½æ•°ç›¸æ¯”å¤§å®¶å·²ç»è§æ€ªä¸æ€ªï¼Œä¸Šä¸€èŠ‚å¼•å…¥çš„$\text{softsign}$å‡½æ•°æœ¬èº«å°±æ˜¯ä¹‹ä¸€ï¼Œä¸Šä¸€ç¯‡æ–‡ç« åˆ†æè¿‡ç¨‹ä¸­çš„$\text{erf}$å‡½æ•°ä¹Ÿæ˜¯ä¸€ä¾‹ï¼Œæ­¤å¤–è¿˜æœ‰$\tanh$ã€$\text{sigmoid}$ç­‰ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å¤„ç†çš„æ˜¯æ»¡è¶³å¦‚ä¸‹ç‰¹æ€§çš„Så‹å‡½æ•°$S(x)$ï¼š</p>
<blockquote>
<p>1ã€å…¨å±€å…‰æ»‘ä¸”å•è°ƒé€’å¢ï¼›</p>
<p>2ã€å¥‡å‡½æ•°ï¼Œå€¼åŸŸæ˜¯$[-1,1]$ï¼›</p>
<p>3ã€åœ¨åŸç‚¹å¤„æ–œç‡ä¸º$k &gt; 0$ã€‚</p>
</blockquote>
<p>å¯¹äºè¿™ç±»å‡½æ•°ï¼Œæˆ‘ä»¬è€ƒè™‘ä¸¤ç§è¿‘ä¼¼ã€‚ç¬¬ä¸€ç§è¿‘ä¼¼è·Ÿ$\text{softsign}$ç±»ä¼¼ï¼š<br />
\begin{equation}S(x)\approx \frac{x}{\sqrt{x^2 + 1/k^2}}\end{equation}<br />
å®ƒå¤§æ¦‚æ˜¯ä¿ç•™$S(x)$å¦‚ä¸Š3ç‚¹æ€§è´¨çš„æœ€ç®€å•å‡½æ•°äº†ï¼›ç¬¬äºŒç§è¿‘ä¼¼æ˜¯åŸºäº$\text{clip}$å‡½æ•°ï¼š<br />
\begin{equation}S(x)\approx \text{clip}(kx, -1, 1) \triangleq \left\{\begin{aligned}&amp;1, &amp;kx\geq 1 \\\<br />
&amp;kx, &amp;-1 &lt; kx &lt; 1\\\<br />
&amp;-1, &amp;kx \leq -1\end{aligned}\right.\end{equation}<br />
è¿™æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåˆ†æ®µçº¿æ€§å‡½æ•°ï¼Œæ”¾å¼ƒäº†å…¨å±€å…‰æ»‘çš„æ€§è´¨ï¼Œä½†åˆ†æ®µçº¿æ€§ä¼šä½¿å¾—ç§¯åˆ†ç®—èµ·æ¥æ›´å®¹æ˜“ï¼Œæˆ‘ä»¬å¾ˆå¿«å°±ä¼šçœ‹åˆ°è¿™ä¸€ç‚¹ã€‚</p>
<p><a href="/usr/uploads/2024/11/103719578.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="Erfå‡½æ•°ä¸å®ƒçš„ä¸¤ç§è¿‘ä¼¼" src="/usr/uploads/2024/11/103719578.png" /></a></p>
<p>Erfå‡½æ•°ä¸å®ƒçš„ä¸¤ç§è¿‘ä¼¼</p>
<h2 id="_1">å‡å€¼ä¼°è®¡</h2>
<p>äº‹ä¸å®œè¿Ÿï¼Œæ²¿ç€ä¸Šä¸€ç¯‡æ–‡ç« çš„æ–¹æ³•ï¼Œå‡ºå‘ç‚¹è¿˜æ˜¯<br />
\begin{equation}\mathbb{E}[\mathcal{L}(\boldsymbol{w} - \eta\tilde{\boldsymbol{\varphi}}_B)] \approx \mathcal{L}(\boldsymbol{w}) - \eta\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B]^{\top}\boldsymbol{g} + \frac{1}{2}\eta^2 \text{Tr}(\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B\tilde{\boldsymbol{\varphi}}_B^{\top}]\boldsymbol{H})\end{equation}<br />
æˆ‘ä»¬éœ€è¦åšçš„äº‹æƒ…å°±æ˜¯ä¼°è®¡$\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B]$å’Œ$\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B\tilde{\boldsymbol{\varphi}}_B^{\top}]$ã€‚</p>
<p>è¿™ä¸€èŠ‚æˆ‘ä»¬ç®—çš„æ˜¯$\mathbb{E}[\tilde{\boldsymbol{\varphi}}<em -_infty="-\infty">B]$ï¼Œä¸ºæ­¤æˆ‘ä»¬éœ€è¦ç”¨$\text{clip}$å‡½æ•°å»è¿‘ä¼¼$\text{softsign}$å‡½æ•°ï¼š<br />
\begin{equation}\text{softsign}(x, \epsilon)\approx \text{clip}(x/\epsilon, -1, 1) = \left\{\begin{aligned}&amp;1, &amp; x/\epsilon \geq 1 \\\<br />
&amp; x / \epsilon, &amp; -1 &lt; x/\epsilon &lt; 1 \\\<br />
&amp;-1, &amp; x/\epsilon \leq -1 \\\<br />
\end{aligned}\right.\end{equation}<br />
ç„¶åæˆ‘ä»¬æœ‰<br />
\begin{equation}\begin{aligned}<br />
\mathbb{E}[\tilde{\varphi}_B] =&amp;\, \mathbb{E}[\text{softsign}(g + \sigma z/\sqrt{B}, \epsilon)] \approx \mathbb{E}[\text{clip}(g/\epsilon + \sigma z/\epsilon\sqrt{B},-1, 1)] \\\[5pt]<br />
=&amp;\,\frac{1}{\sqrt{2\pi}}\int</em>dz \\\[5pt]}^{\infty} \text{clip}(g/\epsilon + \sigma z/\epsilon\sqrt{B},-1, 1) e^{-z^2/2<br />
=&amp;\,\frac{1}{\sqrt{2\pi}}\int_{-\infty}^{-(g+\epsilon)\sqrt{B}/\sigma} (-1)\times e^{-z^2/2}dz + \frac{1}{\sqrt{2\pi}}\int_{-(g-\epsilon)\sqrt{B}/\sigma}^{\infty} 1\times e^{-z^2/2}dz \\\[5pt]<br />
&amp;\,\qquad\qquad + \frac{1}{\sqrt{2\pi}}\int_{-(g+\epsilon)\sqrt{B}/\sigma}^{-(g-\epsilon)\sqrt{B}/\sigma} (g/\epsilon + \sigma z/\epsilon\sqrt{B})\times e^{-z^2/2}dz<br />
\end{aligned}\end{equation}<br />
ç§¯åˆ†å½¢å¼å¾ˆå¤æ‚ï¼Œä½†ç”¨Mathematicaç®—å¹¶ä¸éš¾ï¼Œç»“æœå¯ä»¥ç”¨$\text{erf}$å‡½æ•°è¡¨è¾¾å‡ºæ¥ï¼š<br />
\begin{equation}\frac{1}{2}\left[\text{erf}\left(\frac{a+b}{\sqrt{2}}\right)+\text{erf}\left(\frac{a-b}{\sqrt{2}}\right)\right]+\frac{a}{2b}\left[\text{erf}\left(\frac{a+b}{\sqrt{2}}\right)-\text{erf}\left(\frac{a-b}{\sqrt{2}}\right)\right]+\frac{e^{-(a+b)^2/2} - e^{-(a-b)^2/2}}{b\sqrt{2\pi}}\end{equation}<br />
å…¶ä¸­$a = g\sqrt{B}/\sigma, b=\epsilon \sqrt{B}/\sigma$ã€‚è¿™ä¸ªå‡½æ•°çœ‹èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œä½†å®ƒåˆšå¥½æ˜¯$a$çš„Så‹å‡½æ•°ï¼Œå€¼åŸŸä¸º$(-1,1)$ä¸”åœ¨$a=0$å¤„çš„æ–œç‡æ˜¯$\text{erf}(b/\sqrt{2})/b$ï¼Œæ‰€ä»¥åˆ©ç”¨ç¬¬ä¸€ç§è¿‘ä¼¼å½¢å¼<br />
\begin{equation}\mathbb{E}[\tilde{\varphi}_B]\approx\frac{a}{\sqrt{a^2 + b^2 / \text{erf}(b/\sqrt{2})^2}}\approx \frac{a}{\sqrt{a^2 + b^2 + \pi / 2}}=\frac{g/\sigma}{\sqrt{(g^2+\epsilon^2)/\sigma^2 + \pi / 2B}}\label{eq:E-u-approx}\end{equation}<br />
ç¬¬äºŒä¸ªçº¦ç­‰å·æ˜¯åˆ©ç”¨è¿‘ä¼¼$\text{erf}(x)\approx x / \sqrt{x^2 + \pi / 4}$æ¥å¤„ç†åˆ†æ¯ä¸­çš„$\text{erf}(b/\sqrt{2})$ã€‚å¯ä»¥è¯´ç›¸å½“å¹¸è¿ï¼Œæœ€ç»ˆçš„å½¢å¼å¹¶æ²¡æœ‰å¤ªå¤æ‚ã€‚æ¥ç€æˆ‘ä»¬æœ‰<br />
\begin{equation}\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B]_i \approx \frac{g_i/\sigma_i}{\sqrt{(g_i^2+\epsilon^2)/\sigma_i^2 + \pi / 2B}} = \frac{\text{softsign}(g_i, \epsilon)}{\sqrt{1 + \pi \sigma_i^2 /(g_i^2+\epsilon^2)/2B}}\approx \frac{\text{softsign}(g_i, \epsilon)}{\sqrt{1 + \pi \kappa^2/2B}} = \nu_i \beta\end{equation}<br />
è·Ÿä¸Šä¸€ç¯‡æ–‡ç« ä¸€æ ·ï¼Œæœ€åä¸€ä¸ªçº¦ç­‰å·ä½¿ç”¨äº†å¹³å‡åœºè¿‘ä¼¼ï¼Œ$\kappa^2$æ˜¯å…¨ä½“$\sigma_i^2 /(g_i^2+\epsilon^2)$çš„æŸç§å¹³å‡ï¼Œè€Œ$\nu_i = \text{softsign}(g_i, \epsilon)$ä»¥åŠ$\beta = (1 + \pi\kappa^2 / 2B)^{-1/2}$ã€‚</p>
<h2 id="_2">æ–¹å·®ä¼°è®¡</h2>
<p>å‡å€¼ä¹Ÿå°±æ˜¯ä¸€é˜¶çŸ©è§£å†³äº†ï¼Œç°åœ¨è½®åˆ°äºŒé˜¶çŸ©äº†<br />
\begin{equation}\begin{aligned}<br />
\mathbb{E}[\tilde{\varphi}<em -_infty="-\infty">B^2] =&amp;\, \mathbb{E}[\text{softsign}(g + \sigma z/\sqrt{B}, \epsilon)^2] \approx \mathbb{E}[\text{clip}(g/\epsilon + \sigma z/\epsilon\sqrt{B},-1, 1)^2] \\\[5pt]<br />
=&amp;\,\frac{1}{\sqrt{2\pi}}\int</em>dz \\\[5pt]}^{\infty} \text{clip}(g/\epsilon + \sigma z/\epsilon\sqrt{B},-1, 1)^2 e^{-z^2/2<br />
=&amp;\,\frac{1}{\sqrt{2\pi}}\int_{-\infty}^{-(g+\epsilon)\sqrt{B}/\sigma} (-1)^2\times e^{-z^2/2}dz + \frac{1}{\sqrt{2\pi}}\int_{-(g-\epsilon)\sqrt{B}/\sigma}^{\infty} 1^2\times e^{-z^2/2}dz \\\[5pt]<br />
&amp;\,\qquad\qquad + \frac{1}{\sqrt{2\pi}}\int_{-(g+\epsilon)\sqrt{B}/\sigma}^{-(g-\epsilon)\sqrt{B}/\sigma} (g/\epsilon + \sigma z/\epsilon\sqrt{B})^2\times e^{-z^2/2}dz<br />
\end{aligned}\end{equation}<br />
ç»“æœåŒæ ·å¯ä»¥ç”¨$\text{erf}$å‡½æ•°è¡¨ç¤ºï¼Œä½†æ›´åŠ å†—é•¿ï¼Œè¿™é‡Œå°±ä¸å†™å‡ºæ¥äº†ï¼Œè¿˜æ˜¯é‚£å¥è¯ï¼Œå¯¹Mathematicaæ¥è¯´è¿™éƒ½ä¸æ˜¯äº‹ã€‚è§†ä¸º$a$çš„å‡½æ•°æ—¶ï¼Œå¯ä»¥å‘ç°ç»“æœæ˜¯ä¸€æ¡å€’é’Ÿå½¢çš„æ›²çº¿ï¼Œå…³äº$y$è½´å¯¹ç§°ï¼Œä¸Šç•Œæ˜¯$1$ï¼Œæœ€å°å€¼æ˜¯åˆ™åœ¨$(0,1)$å†…ã€‚å‚è€ƒ$\mathbb{E}[\tilde{\varphi}<em i_i="i,i">B]$çš„è¿‘ä¼¼å¼$\eqref{eq:E-u-approx}$ï¼Œæˆ‘ä»¬é€‰æ‹©å¦‚ä¸‹è¿‘ä¼¼<br />
\begin{equation}\mathbb{E}[\tilde{\varphi}_B^2] \approx 1 - \frac{b^2}{a^2 + b^2 + \pi / 2} = 1 - \frac{\epsilon^2/(g^2+\epsilon^2)}{1 + \pi\sigma^2/(g^2+\epsilon^2) / 2B}\end{equation}<br />
æœ‰ä¸€è¯´ä¸€ï¼Œè¿™ä¸ªè¿‘ä¼¼çš„ç²¾åº¦å¹¶ä¸é«˜ï¼Œä¸»è¦æ˜¯ä¸ºäº†è®¡ç®—çš„æ–¹ä¾¿ï¼Œä½†å®ƒå·²ç»ä¿ç•™äº†å€’é’Ÿå½¢ã€$y$è½´å¯¹ç§°ã€ä¸Šç•Œä¸º1ã€$b=0$æ—¶ç»“æœä¸º1ã€$b\to\infty$ç»“æœåˆ™ä¸º0ç­‰å…³é”®ç‰¹æ€§ã€‚æ¥ä¸‹æ¥ç»§ç»­åº”ç”¨å¹³å‡åœºè¿‘ä¼¼ï¼š<br />
\begin{equation}\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B\tilde{\boldsymbol{\varphi}}_B^{\top}]</em>} \approx 1 - \frac{\epsilon^2/(g_i^2+\epsilon^2)}{1 + \pi\sigma_i^2/(g_i^2+\epsilon^2) / 2B}\approx 1 - \frac{\epsilon^2/(g_i^2+\epsilon^2)}{1 + \pi\kappa^2 / 2B} = \nu_i^2 \beta^2 + (1 - \beta^2)\end{equation<br />
æ‰€ä»¥$\mathbb{E}[\tilde{\boldsymbol{\varphi}}<em i_j="i,j">B\tilde{\boldsymbol{\varphi}}_B^{\top}]</em>$å„åˆ†é‡ä¹‹é—´çš„ç‹¬ç«‹æ€§ï¼Œæ‰€ä»¥åæ–¹å·®çŸ©é˜µå¿…ç„¶æ˜¯å¯¹è§’é˜µã€‚}\approx \nu_i \nu_j \beta^2 + \delta_{i,j}(1-\beta^2)$ã€‚å…¶ä¸­$\delta_{i,j}(1-\beta^2)$è¿™ä¸€é¡¹å°±ä»£è¡¨äº†$\tilde{\boldsymbol{\varphi}}$çš„åæ–¹å·®çŸ©é˜µ$(1-\beta^2)\boldsymbol{I}$ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯¹è§’é˜µï¼Œè¿™æ˜¯å¯ä»¥é¢„æ–™çš„ï¼Œå› ä¸ºæˆ‘ä»¬çš„å‡è®¾ä¹‹ä¸€æ˜¯$\tilde{\boldsymbol{\varphi}</p>
<h2 id="_3">ç»“æœåˆæ¢</h2>
<p>ç”±æ­¤æˆ‘ä»¬å¾—åˆ°<br />
\begin{equation}\eta^<em> \approx \frac{\mathbb{E}[\tilde{\boldsymbol{\varphi}}<em i_j="i,j">B]^{\top}\boldsymbol{g}}{\text{Tr}(\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B\tilde{\boldsymbol{\varphi}}_B^{\top}]\boldsymbol{H})} \approx \frac{\beta\sum_i \nu_i g_i}{\beta^2\sum</em>} \nu_i \nu_j H_{i,j} + (1-\beta^2)\sum_i H_{i,i} }\end{equation<br />
æ³¨æ„ï¼Œé™¤äº†$\beta$å¤–ï¼Œå‰©ä½™çš„å…¶ä»–ç¬¦å·éƒ½ä¸ä¾èµ–äº$B$ï¼Œæ‰€ä»¥ä¸Šå¼å·²ç»ç»™å‡º$\eta^</em>$ä¸$B$çš„ä¾èµ–å…³ç³»ã€‚æ³¨æ„ä¸ºäº†ä¿è¯æå°å€¼çš„å­˜åœ¨æ€§ï¼Œæˆ‘ä»¬éƒ½ä¼šå‡è®¾$\boldsymbol{H}$çŸ©é˜µçš„æ­£å®šæ€§ï¼Œè€Œåœ¨æ­¤å‡è®¾ä¹‹ä¸‹å¿…ç„¶æœ‰$\sum_{i,j} \nu_i \nu_j H_{i,j} &gt; 0$å’Œ$\sum_i H_{i,i} &gt; 0$ã€‚</p>
<p>ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬è¯´Adamæœ€é‡è¦çš„ç‰¹æ€§æ˜¯å¯èƒ½ä¼šå‡ºç°â€œSurgeç°è±¡â€ï¼Œå³$\eta^<em>$å…³äº$B$ä¸å†æ˜¯å…¨å±€çš„å•è°ƒé€’å¢å‡½æ•°ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†ä¼šè¯æ˜ï¼Œ$\epsilon &gt; 0$çš„å¼•å…¥ä¼šé™ä½Surgeç°è±¡å‡ºç°çš„å‡ ç‡ï¼Œå¹¶ä¸”$\epsilon \to \infty$æ—¶å®Œå…¨æ¶ˆå¤±ã€‚è¿™ä¸ªè¯æ˜å¹¶ä¸éš¾ï¼Œå¾ˆæ˜æ˜¾Surgeç°è±¡å‡ºç°çš„å¿…è¦æ¡ä»¶æ˜¯<br />
\begin{equation}\sum_{i,j} \nu_i \nu_j H_{i,j} - \sum_i H_{i,i} &gt; 0\end{equation}<br />
è‹¥å¦ï¼Œæ•´ä¸ª$\eta^</em>$å…³äº$\beta$ä¾¿æ˜¯å•è°ƒé€’å¢çš„ï¼Œè€Œ$\beta$å…³äº$B$æ˜¯å•è°ƒé€’å¢çš„ï¼Œæ‰€ä»¥æ•´ä¸ª$\eta^*$å…³äº$B$å•è°ƒé€’å¢ï¼Œä¸å­˜åœ¨Surgeç°è±¡ã€‚åˆ«å¿˜äº†$\nu_i = \text{softsign}(g_i, \epsilon)$æ˜¯å…³äº$\epsilon$çš„å•è°ƒé€’å‡å‡½æ•°ï¼Œæ‰€ä»¥å½“$\epsilon$å¢å¤§æ—¶$\sum_{i,j} \nu_i \nu_j H_{i,j}$ä¼šæ›´å°ï¼Œä»è€Œä¸Šè¿°ä¸ç­‰å¼æˆç«‹çš„å¯èƒ½æ€§æ›´ä½ï¼Œå¹¶ä¸”$\epsilon\to \infty$æ—¶$\nu_i$ä¸ºé›¶ï¼Œä¸Šè¿°ä¸ç­‰å¼ä¸å¯èƒ½å†æˆç«‹ï¼Œå› æ­¤Surgeç°è±¡æ¶ˆå¤±ã€‚</p>
<p>è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬å¯ä»¥è¯æ˜$\epsilon\to\infty$æ—¶ï¼Œç»“æœè·ŸSGDçš„ä¸€è‡´ï¼Œè¿™åªéœ€è¦ç•™æ„åˆ°<br />
\begin{equation}\frac{\eta^<em>}{\epsilon} \approx \frac{\beta\sum_i (\epsilon \nu_i) g_i}{\beta^2\sum_{i,j} (\epsilon \nu_i)(\epsilon \nu_j) H_{i,j} + \epsilon^2(1-\beta^2)\sum_i H_{i,i} }\end{equation}<br />
æˆ‘ä»¬æœ‰æé™<br />
\begin{equation}\lim_{\epsilon\to\infty} \beta = 1,\quad\lim_{\epsilon\to\infty} \epsilon \nu_i = g_i, \quad \lim_{\epsilon\to\infty} \epsilon^2(1-\beta^2) = \pi \sigma^2 / 2B\end{equation}<br />
è¿™é‡Œ$\sigma^2$æ˜¯å…¨ä½“$\sigma_i^2$çš„æŸç§å¹³å‡ã€‚äºæ˜¯æˆ‘ä»¬å¾—åˆ°å½“$\epsilon$è¶³å¤Ÿå¤§æ—¶æœ‰è¿‘ä¼¼<br />
\begin{equation}\frac{\eta^</em>}{\epsilon} \approx \frac{\sum_i g_i^2}{\sum_{i,j} g_i g_j H_{i,j} + \left(\pi \sigma^2\sum_i H_{i,i}\right)/2B }\end{equation}<br />
å³ç«¯å°±æ˜¯å‡è®¾æ¢¯åº¦åæ–¹å·®çŸ©é˜µä¸º$(\pi\sigma^2/2B)\boldsymbol{I}$æ—¶çš„SGDç»“æœã€‚</p>
<h2 id="_4">æ–‡ç« å°ç»“</h2>
<p>æœ¬æ–‡å»¶ç»­äº†ä¸Šä¸€ç¯‡æ–‡ç« çš„æ–¹æ³•ï¼Œå°è¯•åˆ†æäº†Adamçš„$\epsilon$å¯¹å­¦ä¹ ç‡ä¸Batch Sizeä¹‹é—´çš„Scaling Lawçš„å½±å“ï¼Œç»“æœæ˜¯ä¸€ä¸ªä»‹ä¹SGDä¸SignSGDä¹‹é—´çš„å½¢å¼ï¼Œå½“$\epsilon$è¶Šå¤§ï¼Œç»“æœè¶Šæ¥è¿‘SGDï¼Œâ€œSurgeç°è±¡â€å‡ºç°çš„æ¦‚ç‡å°±è¶Šä½ã€‚æ€»çš„æ¥è¯´ï¼Œè®¡ç®—ç»“æœæ²¡æœ‰ç‰¹åˆ«è®©äººæ„å¤–ä¹‹å¤„ï¼Œä½†å¯ä»¥ä½œä¸ºåˆ†æ$\epsilon$ä½œç”¨çš„ä¸€ä¸ªå‚è€ƒè¿‡ç¨‹ã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/10563">https://spaces.ac.cn/archives/10563</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Nov. 18, 2024). ã€ŠAdamçš„epsilonå¦‚ä½•å½±å“å­¦ä¹ ç‡çš„Scaling Lawï¼Ÿ ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/10563">https://spaces.ac.cn/archives/10563</a></p>
<p>@online{kexuefm-10563,<br />
title={Adamçš„epsilonå¦‚ä½•å½±å“å­¦ä¹ ç‡çš„Scaling Lawï¼Ÿ},<br />
author={è‹å‰‘æ—},<br />
year={2024},<br />
month={Nov},<br />
url={\url{https://spaces.ac.cn/archives/10563}},<br />
} </p>
<hr />
<h2 id="_5">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<p>æœ¬èŠ‚æä¾›æå…¶è¯¦ç»†çš„æ•°å­¦æ¨å¯¼ï¼Œæ·±å…¥æ¢è®¨Adamä¼˜åŒ–å™¨ä¸­epsilonå‚æ•°çš„ä½œç”¨æœºåˆ¶åŠå…¶å¯¹å­¦ä¹ ç‡Scaling Lawçš„å½±å“ã€‚</p>
<h3 id="1-adam">1. Adamä¼˜åŒ–å™¨çš„å®Œæ•´æ•°å­¦å®šä¹‰</h3>
<p><strong>åŸºæœ¬æ›´æ–°è§„åˆ™</strong></p>
<p>Adamä¼˜åŒ–å™¨çš„å®Œæ•´æ›´æ–°å…¬å¼å¯ä»¥å†™æˆï¼š</p>
<p>$$
\begin{aligned}
\boldsymbol{m}_t &= \beta_1 \boldsymbol{m}_{t-1} + (1-\beta_1)\boldsymbol{g}_t \\
\boldsymbol{v}_t &= \beta_2 \boldsymbol{v}_{t-1} + (1-\beta_2)\boldsymbol{g}_t^2 \\
\hat{\boldsymbol{m}}_t &= \frac{\boldsymbol{m}_t}{1-\beta_1^t} \\
\hat{\boldsymbol{v}}_t &= \frac{\boldsymbol{v}_t}{1-\beta_2^t} \\
\boldsymbol{w}_{t+1} &= \boldsymbol{w}_t - \eta\frac{\hat{\boldsymbol{m}}_t}{\sqrt{\hat{\boldsymbol{v}}_t}+\epsilon}
\end{aligned}
$$</p>
<p><strong>æ³¨é‡Š1</strong>ï¼š$\boldsymbol{m}_t$ æ˜¯æ¢¯åº¦çš„ä¸€é˜¶çŸ©ï¼ˆåŠ¨é‡ï¼‰çš„æŒ‡æ•°ç§»åŠ¨å¹³å‡ã€‚$\beta_1$ é€šå¸¸å–0.9ï¼Œæ„å‘³ç€å†å²æ¢¯åº¦çš„å½±å“ä»¥æŒ‡æ•°è¡°å‡çš„æ–¹å¼ä¿ç•™ã€‚</p>
<p><strong>æ³¨é‡Š2</strong>ï¼š$\boldsymbol{v}_t$ æ˜¯æ¢¯åº¦å¹³æ–¹çš„äºŒé˜¶çŸ©ä¼°è®¡ã€‚$\beta_2$ é€šå¸¸å–0.999ï¼Œç›¸æ¯”ä¸€é˜¶çŸ©ï¼ŒäºŒé˜¶çŸ©éœ€è¦æ›´é•¿çš„å†å²çª—å£æ‰èƒ½ç¨³å®šã€‚</p>
<p><strong>æ³¨é‡Š3</strong>ï¼šåå·®ä¿®æ­£é¡¹ $1-\beta_1^t$ å’Œ $1-\beta_2^t$ ç”¨äºä¿®æ­£åˆå§‹åŒ–ä¸ºé›¶å‘é‡å¯¼è‡´çš„åå·®ã€‚åœ¨è®­ç»ƒåˆæœŸï¼ˆ$t$ è¾ƒå°æ—¶ï¼‰è¿™äº›ä¿®æ­£éå¸¸é‡è¦ã€‚</p>
<p><strong>æ¨å¯¼1ï¼šåå·®ä¿®æ­£çš„å¿…è¦æ€§</strong></p>
<p>å‡è®¾åˆå§‹åŒ– $\boldsymbol{m}_0 = \boldsymbol{0}$ï¼ŒçœŸå®æ¢¯åº¦ä¸ºå¸¸æ•° $\boldsymbol{g}$ï¼Œåˆ™ï¼š</p>
<p>$$
\begin{aligned}
\boldsymbol{m}_1 &= \beta_1 \cdot \boldsymbol{0} + (1-\beta_1)\boldsymbol{g} = (1-\beta_1)\boldsymbol{g} \\
\boldsymbol{m}_2 &= \beta_1(1-\beta_1)\boldsymbol{g} + (1-\beta_1)\boldsymbol{g} = (1-\beta_1)(1+\beta_1)\boldsymbol{g} \\
\boldsymbol{m}_t &= (1-\beta_1)\sum_{i=0}^{t-1}\beta_1^i \boldsymbol{g} = (1-\beta_1)\frac{1-\beta_1^t}{1-\beta_1}\boldsymbol{g} = (1-\beta_1^t)\boldsymbol{g}
\end{aligned}
$$</p>
<p>å› æ­¤ $\mathbb{E}[\boldsymbol{m}_t] = (1-\beta_1^t)\boldsymbol{g}$ è€Œé $\boldsymbol{g}$ï¼Œéœ€è¦é™¤ä»¥ $1-\beta_1^t$ æ¥ä¿®æ­£ã€‚</p>
<h3 id="2-epsilon">2. Epsilonå‚æ•°çš„æ•°å€¼ç¨³å®šæ€§ä½œç”¨</h3>
<p><strong>æ¨å¯¼2ï¼šé™¤é›¶ä¿æŠ¤</strong></p>
<p>è€ƒè™‘åˆ†æ¯ $\sqrt{\hat{\boldsymbol{v}}<em t_i="t,i">t}+\epsilon$ï¼Œå¦‚æœæŸä¸ªå‚æ•°çš„æ¢¯åº¦å§‹ç»ˆå¾ˆå°ï¼Œå¯èƒ½å¯¼è‡´ $\hat{v}</em> \approx 0$ã€‚æ­¤æ—¶ï¼š</p>
<p>$$
\frac{\hat{m}_{t,i}}{\sqrt{\hat{v}_{t,i}}+\epsilon} \approx \frac{\hat{m}_{t,i}}{\epsilon}
$$</p>
<p><strong>æ³¨é‡Š4</strong>ï¼š$\epsilon$ ä¸ºå°æ­£æ•°ï¼ˆå¦‚ $10^{-7}$ æˆ– $10^{-8}$ï¼‰é˜²æ­¢é™¤é›¶é”™è¯¯ï¼ŒåŒæ—¶ä¿è¯æ•°å€¼ç¨³å®šæ€§ã€‚</p>
<p><strong>æ¨å¯¼3ï¼šæœ‰æ•ˆå­¦ä¹ ç‡çš„å°ºåº¦åˆ†æ</strong></p>
<p>å¯¹äºç¬¬ $i$ ä¸ªå‚æ•°ï¼Œå®é™…æ›´æ–°æ­¥é•¿ä¸ºï¼š</p>
<p>$$
\Delta w_{t,i} = -\eta\frac{\hat{m}_{t,i}}{\sqrt{\hat{v}_{t,i}}+\epsilon}
$$</p>
<p>å®šä¹‰æœ‰æ•ˆå­¦ä¹ ç‡ï¼š</p>
<p>$$
\eta_{\text{eff},i} = \frac{\eta}{\sqrt{\hat{v}_{t,i}}+\epsilon}
$$</p>
<p>å½“æ¢¯åº¦å°ºåº¦è¾ƒå¤§æ—¶ï¼ˆ$\hat{v}_{t,i} \gg \epsilon^2$ï¼‰ï¼š</p>
<p>$$
\eta_{\text{eff},i} \approx \frac{\eta}{\sqrt{\hat{v}_{t,i}}} = \frac{\eta}{\text{RMS}(g_{t,i})}
$$</p>
<p>è¿™æ˜¯æ ‡å‡†çš„è‡ªé€‚åº”å­¦ä¹ ç‡ã€‚</p>
<p>å½“æ¢¯åº¦å°ºåº¦è¾ƒå°æ—¶ï¼ˆ$\hat{v}_{t,i} \ll \epsilon^2$ï¼‰ï¼š</p>
<p>$$
\eta_{\text{eff},i} \approx \frac{\eta}{\epsilon}
$$</p>
<p>æ­¤æ—¶æœ‰æ•ˆå­¦ä¹ ç‡ç”± $\epsilon$ ä¸»å¯¼ï¼Œä¸å†è‡ªé€‚åº”ã€‚</p>
<h3 id="3-softsign">3. SoftSignå‡½æ•°çš„è¯¦ç»†åˆ†æ</h3>
<p><strong>å®šä¹‰ä¸æ€§è´¨</strong></p>
<p>SoftSignå‡½æ•°å®šä¹‰ä¸ºï¼š</p>
<p>$$
\text{softsign}(x, \epsilon) = \frac{x}{\sqrt{x^2+\epsilon^2}}
$$</p>
<p><strong>æ¨å¯¼4ï¼šä¸Signå‡½æ•°çš„å…³ç³»</strong></p>
<p>$$
\lim_{\epsilon\to 0}\text{softsign}(x, \epsilon) = \lim_{\epsilon\to 0}\frac{x}{\sqrt{x^2+\epsilon^2}} = \frac{x}{|x|} = \text{sign}(x)
$$</p>
<p><strong>æ¨å¯¼5ï¼šå¯¼æ•°è®¡ç®—</strong></p>
<p>$$
\begin{aligned}
\frac{\partial}{\partial x}\text{softsign}(x, \epsilon) &= \frac{\partial}{\partial x}\left[x(x^2+\epsilon^2)^{-1/2}\right] \\
&= (x^2+\epsilon^2)^{-1/2} + x \cdot \left(-\frac{1}{2}\right)(x^2+\epsilon^2)^{-3/2}\cdot 2x \\
&= \frac{1}{\sqrt{x^2+\epsilon^2}} - \frac{x^2}{(x^2+\epsilon^2)^{3/2}} \\
&= \frac{x^2+\epsilon^2-x^2}{(x^2+\epsilon^2)^{3/2}} \\
&= \frac{\epsilon^2}{(x^2+\epsilon^2)^{3/2}}
\end{aligned}
$$</p>
<p><strong>æ³¨é‡Š5</strong>ï¼šå¯¼æ•°åœ¨ $x=0$ å¤„è¾¾åˆ°æœ€å¤§å€¼ $1/\epsilon$ï¼Œä¸”å¯¼æ•°æ’æ­£ï¼Œè¯´æ˜softsignæ˜¯å•è°ƒé€’å¢çš„å…‰æ»‘å‡½æ•°ã€‚</p>
<p><strong>æ¨å¯¼6ï¼šæ¸è¿‘è¡Œä¸º</strong></p>
<p>å½“ $|x| \to \infty$ æ—¶ï¼š</p>
<p>$$
\text{softsign}(x, \epsilon) = \frac{x}{\sqrt{x^2+\epsilon^2}} = \frac{x}{|x|\sqrt{1+\epsilon^2/x^2}} \to \text{sign}(x)
$$</p>
<p>å½“ $x \to 0$ æ—¶ï¼Œä½¿ç”¨æ³°å‹’å±•å¼€ï¼š</p>
<p>$$
\text{softsign}(x, \epsilon) = \frac{x}{\epsilon\sqrt{1+x^2/\epsilon^2}} \approx \frac{x}{\epsilon}\left(1-\frac{x^2}{2\epsilon^2}\right) = \frac{x}{\epsilon} - \frac{x^3}{2\epsilon^3}
$$</p>
<h3 id="4-adamsgd">4. Adamå‘SGDçš„æ’å€¼æ€§è´¨</h3>
<p><strong>æ¨å¯¼7ï¼šå¤§epsilonæé™</strong></p>
<p>è€ƒè™‘æ›´æ–°æ–¹å‘ï¼š</p>
<p>$$
\boldsymbol{\varphi} = \frac{\boldsymbol{m}}{\sqrt{\boldsymbol{v}}+\epsilon}
$$</p>
<p>å½“ $\epsilon \to \infty$ æ—¶ï¼Œå¯¹ç¬¬ $i$ ä¸ªåˆ†é‡ï¼š</p>
<p>$$
\varphi_i = \frac{m_i}{\sqrt{v_i}+\epsilon} = \frac{m_i}{\epsilon\sqrt{v_i/\epsilon^2+1}} \approx \frac{m_i}{\epsilon}\left(1-\frac{v_i}{2\epsilon^2}\right)
$$</p>
<p>å› æ­¤æ•´ä¸ªæ›´æ–°é‡ï¼š</p>
<p>$$
\eta\boldsymbol{\varphi} = \eta\frac{\boldsymbol{m}}{\epsilon} - \eta\frac{\boldsymbol{m}\odot\boldsymbol{v}}{2\epsilon^3} \approx \frac{\eta}{\epsilon}\boldsymbol{m}
$$</p>
<p>å®šä¹‰ $\tilde{\eta} = \eta/\epsilon$ï¼Œåˆ™ï¼š</p>
<p>$$
\lim_{\epsilon\to\infty}\eta\frac{\boldsymbol{m}}{\sqrt{\boldsymbol{v}}+\epsilon} = \tilde{\eta}\boldsymbol{m}
$$</p>
<p><strong>æ³¨é‡Š6</strong>ï¼šè¿™è¡¨æ˜å½“ $\epsilon$ è¶³å¤Ÿå¤§æ—¶ï¼ŒAdamçš„è¡Œä¸ºæ¥è¿‘äºåŠ¨é‡SGDï¼Œåªæ˜¯å­¦ä¹ ç‡éœ€è¦ç›¸åº”ç¼©æ”¾ã€‚</p>
<h3 id="5-s">5. Så‹å‡½æ•°çš„è¿‘ä¼¼ç†è®º</h3>
<p><strong>æ¨å¯¼8ï¼šClipå‡½æ•°è¿‘ä¼¼softsign</strong></p>
<p>è€ƒè™‘softsignå‡½æ•°åœ¨åŸç‚¹å¤„çš„æ–œç‡ï¼š</p>
<p>$$
\left.\frac{d}{dx}\text{softsign}(x,\epsilon)\right|_{x=0} = \frac{\epsilon^2}{\epsilon^3} = \frac{1}{\epsilon}
$$</p>
<p>å› æ­¤çº¿æ€§åŒºåŸŸçš„è¿‘ä¼¼ä¸ºï¼š</p>
<p>$$
\text{softsign}(x,\epsilon) \approx \frac{x}{\epsilon}, \quad |x| \ll \epsilon
$$</p>
<p>å½“ $|x/\epsilon| \geq 1$ æ—¶ï¼Œ$\text{softsign}(x,\epsilon) \approx \text{sign}(x)$ã€‚ç»¼åˆå¾—åˆ°clipè¿‘ä¼¼ï¼š</p>
<p>$$
\text{softsign}(x,\epsilon) \approx \text{clip}(x/\epsilon, -1, 1)
$$</p>
<p><strong>æ¨å¯¼9ï¼šè¯¯å·®å‡½æ•°erfçš„è¿‘ä¼¼</strong></p>
<p>è¯¯å·®å‡½æ•°å®šä¹‰ä¸ºï¼š</p>
<p>$$
\text{erf}(x) = \frac{2}{\sqrt{\pi}}\int_0^x e^{-t^2}dt
$$</p>
<p>åœ¨åŸç‚¹å¤„çš„æ³°å‹’å±•å¼€ï¼š</p>
<p>$$
\text{erf}(x) = \frac{2}{\sqrt{\pi}}\left(x - \frac{x^3}{3} + \frac{x^5}{10} - \cdots\right)
$$</p>
<p>åŸç‚¹å¤„çš„æ–œç‡ä¸º $2/\sqrt{\pi}$ã€‚ä½¿ç”¨ç¬¬ä¸€ç§è¿‘ä¼¼å½¢å¼ï¼Œè¦æ±‚åœ¨ $x=0$ å¤„æ–œç‡åŒ¹é…ï¼š</p>
<p>$$
\frac{d}{dx}\frac{x}{\sqrt{x^2+c}}\bigg|_{x=0} = \frac{1}{\sqrt{c}} = \frac{2}{\sqrt{\pi}}
$$</p>
<p>è§£å¾— $c = \pi/4$ã€‚</p>
<h3 id="6">6. æ¢¯åº¦æœŸæœ›å€¼çš„è¯¦ç»†æ¨å¯¼</h3>
<p><strong>æ¨å¯¼10ï¼šå•ä¸ªåˆ†é‡çš„æœŸæœ›è®¡ç®—</strong></p>
<p>å‡è®¾æ¢¯åº¦çš„å•ä¸ªåˆ†é‡æœä» $\tilde{g}_B \sim \mathcal{N}(g, \sigma^2/B)$ï¼Œæˆ‘ä»¬è¦è®¡ç®—ï¼š</p>
<p>$$
\mathbb{E}[\text{softsign}(\tilde{g}_B, \epsilon)]
$$</p>
<p>ä½¿ç”¨clipè¿‘ä¼¼ï¼š</p>
<p>$$
\mathbb{E}[\text{clip}(\tilde{g}_B/\epsilon, -1, 1)] = \int_{-\infty}^{\infty} \text{clip}(z/\epsilon, -1, 1) \cdot \frac{B}{2\pi\sigma^2}\exp\left(-\frac{B(z-g)^2}{2\sigma^2}\right)dz
$$</p>
<p><strong>æ¨å¯¼11ï¼šåˆ†æ®µç§¯åˆ†</strong></p>
<p>å°†ç§¯åˆ†åˆ†ä¸ºä¸‰ä¸ªåŒºåŸŸï¼š</p>
<p>åŒºåŸŸ1ï¼š$z &lt; -\epsilon$ï¼Œæ­¤æ—¶clipå€¼ä¸º-1
åŒºåŸŸ2ï¼š$-\epsilon \leq z \leq \epsilon$ï¼Œæ­¤æ—¶clipå€¼ä¸º $z/\epsilon$
åŒºåŸŸ3ï¼š$z &gt; \epsilon$ï¼Œæ­¤æ—¶clipå€¼ä¸º1</p>
<p>$$
\begin{aligned}
\mathbb{E}[\text{clip}] &= \int_{-\infty}^{-\epsilon}(-1)\cdot p(z)dz + \int_{-\epsilon}^{\epsilon}\frac{z}{\epsilon}p(z)dz + \int_{\epsilon}^{\infty}1\cdot p(z)dz \\
&= -P(Z<-\epsilon) + \frac{1}{\epsilon}\mathbb{E}[Z\mathbb{1}_{|Z|\leq\epsilon}] + P(Z>\epsilon)
\end{aligned}
$$</p>
<p>å…¶ä¸­ $Z \sim \mathcal{N}(g, \sigma^2/B)$ã€‚</p>
<p><strong>æ¨å¯¼12ï¼šæ ‡å‡†åŒ–å˜æ¢</strong></p>
<p>ä»¤ $U = \frac{\sqrt{B}(Z-g)}{\sigma} \sim \mathcal{N}(0,1)$ï¼Œåˆ™ $Z = g + \frac{\sigma U}{\sqrt{B}}$ï¼š</p>
<p>$$
\begin{aligned}
P(Z < -\epsilon) &= P\left(U < -\frac{\sqrt{B}(g+\epsilon)}{\sigma}\right) = \Phi\left(-\frac{(g+\epsilon)\sqrt{B}}{\sigma}\right) \\
P(Z > \epsilon) &= P\left(U > \frac{\sqrt{B}(\epsilon-g)}{\sigma}\right) = 1-\Phi\left(\frac{(\epsilon-g)\sqrt{B}}{\sigma}\right)
\end{aligned}
$$</p>
<p>è¿™é‡Œ $\Phi$ æ˜¯æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„ç´¯ç§¯åˆ†å¸ƒå‡½æ•°ã€‚</p>
<p><strong>æ¨å¯¼13ï¼šç”¨erfè¡¨ç¤º</strong></p>
<p>åˆ©ç”¨ $\Phi(x) = \frac{1}{2}\left[1+\text{erf}\left(\frac{x}{\sqrt{2}}\right)\right]$ï¼š</p>
<p>$$
\begin{aligned}
-P(Z<-\epsilon) + P(Z>\epsilon) &= -\frac{1}{2}\left[1+\text{erf}\left(-\frac{(g+\epsilon)\sqrt{B}}{\sigma\sqrt{2}}\right)\right] + \frac{1}{2}\left[1-\text{erf}\left(\frac{(\epsilon-g)\sqrt{B}}{\sigma\sqrt{2}}\right)\right] \\
&= \frac{1}{2}\left[\text{erf}\left(\frac{(g+\epsilon)\sqrt{B}}{\sigma\sqrt{2}}\right) - \text{erf}\left(\frac{(\epsilon-g)\sqrt{B}}{\sigma\sqrt{2}}\right)\right]
\end{aligned}
$$</p>
<p><strong>æ¨å¯¼14ï¼šä¸­é—´é¡¹çš„è®¡ç®—</strong></p>
<p>å¯¹äºä¸­é—´é¡¹ï¼š</p>
<p>$$
\frac{1}{\epsilon}\mathbb{E}[Z\mathbb{1}_{|Z|\leq\epsilon}] = \frac{1}{\epsilon}\int_{-\epsilon}^{\epsilon}z\cdot\frac{1}{\sqrt{2\pi\sigma^2/B}}\exp\left(-\frac{B(z-g)^2}{2\sigma^2}\right)dz
$$</p>
<p>è¿™ä¸ªç§¯åˆ†æ¯”è¾ƒå¤æ‚ï¼Œæœ€ç»ˆç»“æœå¯ä»¥ç”¨é«˜æ–¯åˆ†å¸ƒçš„æ€§è´¨è¡¨ç¤ºä¸ºï¼š</p>
<p>$$
\frac{1}{\epsilon}\mathbb{E}[Z\mathbb{1}_{|Z|\leq\epsilon}] = \frac{g}{2\epsilon}\left[\text{erf}\left(\frac{(g+\epsilon)\sqrt{B}}{\sigma\sqrt{2}}\right)-\text{erf}\left(\frac{(g-\epsilon)\sqrt{B}}{\sigma\sqrt{2}}\right)\right] + \frac{\sigma}{\epsilon\sqrt{2\pi B}}\left[e^{-\frac{B(g-\epsilon)^2}{2\sigma^2}} - e^{-\frac{B(g+\epsilon)^2}{2\sigma^2}}\right]
$$</p>
<h3 id="7-softsign">7. ç®€åŒ–ä¸ºsoftsignå½¢å¼</h3>
<p><strong>æ¨å¯¼15ï¼šå¼•å…¥æ— é‡çº²å‚æ•°</strong></p>
<p>å®šä¹‰ï¼š
- $a = g\sqrt{B}/\sigma$ï¼šä¿¡å·å¼ºåº¦å‚æ•°
- $b = \epsilon\sqrt{B}/\sigma$ï¼šå™ªå£°å°ºåº¦å‚æ•°</p>
<p>åˆ™å‰é¢çš„æœŸæœ›å¯ä»¥é‡å†™ä¸ºå…³äº $a$ å’Œ $b$ çš„å‡½æ•°ã€‚</p>
<p><strong>æ¨å¯¼16ï¼šå¤§Bæé™</strong></p>
<p>å½“ $B \to \infty$ æ—¶ï¼Œ$a,b \to \infty$ï¼Œæ­¤æ—¶ï¼š</p>
<p>$$
\mathbb{E}[\text{clip}(\tilde{g}_B/\epsilon, -1, 1)] \to \text{sign}(g)
$$</p>
<p>è¿™æ˜¯å› ä¸ºå™ªå£° $\sigma/\sqrt{B} \to 0$ï¼Œæ¢¯åº¦ä¼°è®¡å˜å¾—å‡†ç¡®ã€‚</p>
<p><strong>æ¨å¯¼17ï¼šerfå‡½æ•°çš„softsignè¿‘ä¼¼</strong></p>
<p>æ ¹æ®å‰é¢çš„åˆ†æï¼Œå¤æ‚çš„erfè¡¨è¾¾å¼å¯ä»¥è¿‘ä¼¼ä¸ºï¼š</p>
<p>$$
\mathbb{E}[\tilde{\varphi}_B] \approx \frac{a}{\sqrt{a^2+b^2+\pi/2}} = \frac{g/\sigma}{\sqrt{(g^2+\epsilon^2)/\sigma^2 + \pi/2B}}
$$</p>
<p>è¿›ä¸€æ­¥æ•´ç†ï¼š</p>
<p>$$
\mathbb{E}[\tilde{\varphi}_B] = \frac{g}{\sqrt{g^2+\epsilon^2+\pi\sigma^2/2B}}
$$</p>
<h3 id="8">8. å¹³å‡åœºè¿‘ä¼¼</h3>
<p><strong>æ¨å¯¼18ï¼šå¼•å…¥æ–¹å·®æ¯”å‚æ•°</strong></p>
<p>å®šä¹‰æ–¹å·®æ¯”ï¼š</p>
<p>$$
\kappa_i^2 = \frac{\sigma_i^2}{g_i^2+\epsilon^2}
$$</p>
<p>è¿™ä¸ªé‡è¡¡é‡äº†å™ªå£°ç›¸å¯¹äºä¿¡å·çš„å¼ºåº¦ã€‚</p>
<p><strong>æ¨å¯¼19ï¼šåˆ†è§£æ›´æ–°æ–¹å‘</strong></p>
<p>å¯ä»¥å°†æœŸæœ›å€¼é‡å†™ä¸ºï¼š</p>
<p>$$
\mathbb{E}[\tilde{\varphi}_B]_i = \frac{g_i}{\sqrt{g_i^2+\epsilon^2}}\cdot\frac{1}{\sqrt{1+\pi\kappa_i^2/2B}} = \nu_i \beta_i
$$</p>
<p>å…¶ä¸­ï¼š
- $\nu_i = \text{softsign}(g_i, \epsilon)$ æ˜¯ç¡®å®šæ€§éƒ¨åˆ†
- $\beta_i = (1+\pi\kappa_i^2/2B)^{-1/2}$ æ˜¯éšæœºæ€§ä¿®æ­£</p>
<p><strong>æ¨å¯¼20ï¼šå¹³å‡åœºå‡è®¾</strong></p>
<p>å‡è®¾å­˜åœ¨å¹³å‡çš„ $\kappa^2$ï¼Œä½¿å¾—ï¼š</p>
<p>$$
\kappa^2 \approx \frac{1}{n}\sum_{i=1}^n \kappa_i^2 = \frac{1}{n}\sum_{i=1}^n \frac{\sigma_i^2}{g_i^2+\epsilon^2}
$$</p>
<p>åˆ™æ‰€æœ‰åˆ†é‡çš„ä¿®æ­£å› å­è¿‘ä¼¼ç›¸åŒï¼š</p>
<p>$$
\beta_i \approx \beta = \frac{1}{\sqrt{1+\pi\kappa^2/2B}}
$$</p>
<p><strong>æ³¨é‡Š7</strong>ï¼šè¿™ä¸ªè¿‘ä¼¼å‡è®¾æ‰€æœ‰å‚æ•°çš„"ä¿¡å™ªæ¯”"ç›¸è¿‘ï¼Œåœ¨å®é™…è®­ç»ƒä¸­åæœŸé€šå¸¸æˆç«‹ã€‚</p>
<h3 id="9">9. äºŒé˜¶çŸ©çš„è¯¦ç»†è®¡ç®—</h3>
<p><strong>æ¨å¯¼21ï¼šsignå‡½æ•°çš„å¹³æ–¹</strong></p>
<p>å¯¹äº $\tilde{\varphi}_B = \text{sign}(\tilde{g}_B)$ï¼š</p>
<p>$$
\tilde{\varphi}_B^2 = \text{sign}(\tilde{g}_B)^2 = 1
$$</p>
<p>å› æ­¤ï¼š</p>
<p>$$
\mathbb{E}[\tilde{\varphi}_B^2] = 1
$$</p>
<p><strong>æ¨å¯¼22ï¼šsoftsignå¹³æ–¹çš„æœŸæœ›</strong></p>
<p>å¯¹äºsoftsignï¼š</p>
<p>$$
\mathbb{E}[\text{softsign}(\tilde{g}_B, \epsilon)^2] = \mathbb{E}\left[\frac{\tilde{g}_B^2}{\tilde{g}_B^2+\epsilon^2}\right]
$$</p>
<p>è¿™ä¸ªæœŸæœ›çš„ç²¾ç¡®è®¡ç®—å¾ˆå¤æ‚ï¼Œæˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹è¿‘ä¼¼ã€‚å½“ $|\tilde{g}_B| \gg \epsilon$ æ—¶ï¼Œsoftsign$^2 \approx 1$ï¼›å½“ $|\tilde{g}_B| \ll \epsilon$ æ—¶ï¼Œsoftsign$^2 \approx \tilde{g}_B^2/\epsilon^2$ã€‚</p>
<p><strong>æ¨å¯¼23ï¼šå€’é’Ÿå½¢è¿‘ä¼¼</strong></p>
<p>åŸºäºå‰é¢çš„åˆ†æï¼Œæˆ‘ä»¬é‡‡ç”¨å¦‚ä¸‹è¿‘ä¼¼å½¢å¼ï¼š</p>
<p>$$
\mathbb{E}[\text{softsign}(\tilde{g}_B, \epsilon)^2] \approx 1 - \frac{\epsilon^2/(g^2+\epsilon^2)}{1+\pi\sigma^2/(g^2+\epsilon^2)/2B}
$$</p>
<p><strong>æ³¨é‡Š8</strong>ï¼šè¿™ä¸ªå…¬å¼çš„ç›´è§‚è§£é‡Šæ˜¯ï¼šå½“çœŸå®æ¢¯åº¦ $g$ å¾ˆå¤§æ—¶ï¼ŒæœŸæœ›æ¥è¿‘1ï¼›å½“ $g$ æ¥è¿‘0æ—¶ï¼ŒæœŸæœ›æ¥è¿‘ $1-1/(1+\text{const})$ï¼Œå°äº1ã€‚</p>
<p><strong>æ¨å¯¼24ï¼šåæ–¹å·®çŸ©é˜µçš„ç»“æ„</strong></p>
<p>å¯¹äºäºŒé˜¶çŸ©çŸ©é˜µï¼š</p>
<p>$$
\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B\tilde{\boldsymbol{\varphi}}_B^T]_{ij} = \begin{cases}
\mathbb{E}[\tilde{\varphi}_{B,i}^2] \approx 1-\frac{\epsilon^2/(g_i^2+\epsilon^2)}{1+\pi\kappa^2/2B}, & i=j \\
\mathbb{E}[\tilde{\varphi}_{B,i}]\mathbb{E}[\tilde{\varphi}_{B,j}] \approx \nu_i\nu_j\beta^2, & i\neq j
\end{cases}
$$</p>
<p><strong>æ¨å¯¼25ï¼šå¯¹è§’é¡¹çš„è¿›ä¸€æ­¥å¤„ç†</strong></p>
<p>å¯¹è§’é¡¹å¯ä»¥åˆ†è§£ä¸ºï¼š</p>
<p>$$
\begin{aligned}
\mathbb{E}[\tilde{\varphi}_{B,i}^2] &\approx 1 - \frac{\epsilon^2/(g_i^2+\epsilon^2)}{1+\pi\kappa^2/2B} \\
&= \frac{1+\pi\kappa^2/2B - \epsilon^2/(g_i^2+\epsilon^2)}{1+\pi\kappa^2/2B} \\
&= \frac{(g_i^2+\epsilon^2+\pi\kappa^2\sigma_i^2/2B)-\epsilon^2}{(g_i^2+\epsilon^2)(1+\pi\kappa^2/2B)} \\
&\approx \nu_i^2\beta^2 + (1-\beta^2)
\end{aligned}
$$</p>
<p>å…¶ä¸­æœ€åä¸€æ­¥ä½¿ç”¨äº† $\nu_i^2 = g_i^2/(g_i^2+\epsilon^2)$ã€‚</p>
<h3 id="10">10. æœ€ä¼˜å­¦ä¹ ç‡çš„æ¨å¯¼</h3>
<p><strong>æ¨å¯¼26ï¼šæŸå¤±å‡½æ•°çš„äºŒé˜¶è¿‘ä¼¼</strong></p>
<p>ä»åŸºæœ¬çš„æ³°å‹’å±•å¼€å¼€å§‹ï¼š</p>
<p>$$
\mathcal{L}(\boldsymbol{w}-\eta\tilde{\boldsymbol{\varphi}}_B) \approx \mathcal{L}(\boldsymbol{w}) - \eta\tilde{\boldsymbol{\varphi}}_B^T\boldsymbol{g} + \frac{\eta^2}{2}\tilde{\boldsymbol{\varphi}}_B^T\boldsymbol{H}\tilde{\boldsymbol{\varphi}}_B
$$</p>
<p>å–æœŸæœ›ï¼š</p>
<p>$$
\mathbb{E}[\mathcal{L}(\boldsymbol{w}-\eta\tilde{\boldsymbol{\varphi}}_B)] \approx \mathcal{L}(\boldsymbol{w}) - \eta\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B]^T\boldsymbol{g} + \frac{\eta^2}{2}\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B^T\boldsymbol{H}\tilde{\boldsymbol{\varphi}}_B]
$$</p>
<p><strong>æ¨å¯¼27ï¼šè¿¹çš„æŠ€å·§</strong></p>
<p>åˆ©ç”¨æ ‡é‡çš„è¿¹ç­‰äºè‡ªèº«ï¼š</p>
<p>$$
\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B^T\boldsymbol{H}\tilde{\boldsymbol{\varphi}}_B] = \mathbb{E}[\text{Tr}(\tilde{\boldsymbol{\varphi}}_B^T\boldsymbol{H}\tilde{\boldsymbol{\varphi}}_B)] = \text{Tr}(\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B\tilde{\boldsymbol{\varphi}}_B^T]\boldsymbol{H})
$$</p>
<p><strong>æ¨å¯¼28ï¼šå±•å¼€è¿¹</strong></p>
<p>$$
\begin{aligned}
\text{Tr}(\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B\tilde{\boldsymbol{\varphi}}_B^T]\boldsymbol{H}) &= \sum_i\mathbb{E}[\tilde{\varphi}_{B,i}^2]H_{ii} + \sum_{i\neq j}\mathbb{E}[\tilde{\varphi}_{B,i}\tilde{\varphi}_{B,j}]H_{ij} \\
&\approx \sum_i(\nu_i^2\beta^2+(1-\beta^2))H_{ii} + \sum_{i\neq j}\nu_i\nu_j\beta^2 H_{ij} \\
&= \beta^2\sum_{i,j}\nu_i\nu_j H_{ij} + (1-\beta^2)\sum_i H_{ii}
\end{aligned}
$$</p>
<p><strong>æ¨å¯¼29ï¼šæœ€ä¼˜åŒ–é—®é¢˜</strong></p>
<p>è¦æœ€å°åŒ–æœŸæœ›æŸå¤±ï¼Œå¯¹ $\eta$ æ±‚å¯¼å¹¶ä»¤å…¶ä¸ºé›¶ï¼š</p>
<p>$$
\frac{d}{d\eta}\mathbb{E}[\mathcal{L}] = -\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B]^T\boldsymbol{g} + \eta\text{Tr}(\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B\tilde{\boldsymbol{\varphi}}_B^T]\boldsymbol{H}) = 0
$$</p>
<p>è§£å¾—ï¼š</p>
<p>$$
\eta^* = \frac{\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B]^T\boldsymbol{g}}{\text{Tr}(\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B\tilde{\boldsymbol{\varphi}}_B^T]\boldsymbol{H})}
$$</p>
<p><strong>æ¨å¯¼30ï¼šä»£å…¥å‰é¢çš„ç»“æœ</strong></p>
<p>$$
\eta^* \approx \frac{\beta\sum_i\nu_i g_i}{\beta^2\sum_{i,j}\nu_i\nu_j H_{ij} + (1-\beta^2)\sum_i H_{ii}}
$$</p>
<h3 id="11-surge">11. Surgeç°è±¡çš„ç†è®ºåˆ†æ</h3>
<p><strong>æ¨å¯¼31ï¼šå•è°ƒæ€§æ¡ä»¶</strong></p>
<p>$\eta^*$ å…³äº $\beta$ çš„å¯¼æ•°ä¸ºï¼š</p>
<p>$$
\frac{d\eta^*}{d\beta} = \frac{d}{d\beta}\left[\frac{\beta\sum_i\nu_i g_i}{\beta^2\sum_{i,j}\nu_i\nu_j H_{ij} + (1-\beta^2)\sum_i H_{ii}}\right]
$$</p>
<p>è®° $A = \sum_i\nu_i g_i$ï¼Œ$B = \sum_{i,j}\nu_i\nu_j H_{ij}$ï¼Œ$C = \sum_i H_{ii}$ï¼Œåˆ™ï¼š</p>
<p>$$
\eta^* = \frac{A\beta}{\beta^2 B + (1-\beta^2)C} = \frac{A\beta}{\beta^2(B-C) + C}
$$</p>
<p><strong>æ¨å¯¼32ï¼šæ±‚å¯¼</strong></p>
<p>$$
\frac{d\eta^*}{d\beta} = \frac{A[\beta^2(B-C)+C] - A\beta\cdot 2\beta(B-C)}{[\beta^2(B-C)+C]^2} = \frac{A[C-\beta^2(B-C)]}{[\beta^2(B-C)+C]^2}
$$</p>
<p><strong>æ¨å¯¼33ï¼šå•è°ƒæ€§åˆ¤å®š</strong></p>
<p>å½“ $B &gt; C$ æ—¶ï¼Œå­˜åœ¨ä¸´ç•Œç‚¹ $\beta_c = \sqrt{C/(B-C)}$ã€‚å½“ $\beta &lt; \beta_c$ æ—¶ï¼Œå¯¼æ•°ä¸ºæ­£ï¼ˆé€’å¢ï¼‰ï¼›å½“ $\beta &gt; \beta_c$ æ—¶ï¼Œå¯¼æ•°ä¸ºè´Ÿï¼ˆé€’å‡ï¼‰ã€‚</p>
<p><strong>æ³¨é‡Š9</strong>ï¼šè¿™å°±æ˜¯Surgeç°è±¡çš„æ•°å­¦æ ¹æºâ€”â€”å½“HessiançŸ©é˜µçš„éå¯¹è§’å…ƒç´ è¶³å¤Ÿå¤§æ—¶ï¼ˆ$B &gt; C$ï¼‰ï¼Œæœ€ä¼˜å­¦ä¹ ç‡å…ˆå¢åå‡ã€‚</p>
<h3 id="12-epsilon">12. Epsilonè¶‹äºæ— ç©·çš„æé™è¡Œä¸º</h3>
<p><strong>æ¨å¯¼34</strong>ï¼šå½“ $\epsilon \to \infty$ æ—¶ï¼Œ</p>
<p>$$
\nu_i = \frac{g_i}{\sqrt{g_i^2+\epsilon^2}} = \frac{g_i/\epsilon}{\sqrt{g_i^2/\epsilon^2+1}} \to 0
$$</p>
<p>ä½†æ˜¯ï¼š</p>
<p>$$
\epsilon\nu_i = \frac{g_i}{\sqrt{1+g_i^2/\epsilon^2}} \to g_i
$$</p>
<p><strong>æ¨å¯¼35</strong>ï¼šå¯¹äº $\beta$ï¼š</p>
<p>$$
\beta = \frac{1}{\sqrt{1+\pi\kappa^2/2B}} = \frac{1}{\sqrt{1+\frac{\pi\sigma^2}{2B(g_i^2+\epsilon^2)}}}
$$</p>
<p>å½“ $\epsilon \to \infty$ æ—¶ï¼š</p>
<p>$$
1-\beta^2 = \frac{\pi\sigma^2/2B}{g_i^2+\epsilon^2} \approx \frac{\pi\sigma^2}{2B\epsilon^2}
$$</p>
<p>å› æ­¤ï¼š</p>
<p>$$
\epsilon^2(1-\beta^2) \to \frac{\pi\sigma^2}{2B}
$$</p>
<p><strong>æ¨å¯¼36</strong>ï¼šä»£å…¥ $\eta^*/\epsilon$ï¼š</p>
<p>$$
\frac{\eta^*}{\epsilon} = \frac{\beta\sum_i(\epsilon\nu_i)g_i}{\beta^2\sum_{i,j}(\epsilon\nu_i)(\epsilon\nu_j)H_{ij} + \epsilon^2(1-\beta^2)\sum_i H_{ii}}
$$</p>
<p>å–æé™ï¼š</p>
<p>$$
\lim_{\epsilon\to\infty}\frac{\eta^*}{\epsilon} = \frac{\sum_i g_i^2}{\sum_{i,j}g_i g_j H_{ij} + \frac{\pi\sigma^2}{2B}\sum_i H_{ii}}
$$</p>
<p>è¿™æ­£æ˜¯SGDçš„å½¢å¼ï¼</p>
<h3 id="13-batch-size">13. ä¸åŒBatch Sizeä¸‹çš„è¡Œä¸º</h3>
<p><strong>æ¨å¯¼37</strong>ï¼šå°Batch Sizeæé™ï¼ˆ$B \ll \pi\kappa^2/2$ï¼‰</p>
<p>$$
\beta \approx \sqrt{\frac{2B}{\pi\kappa^2}}, \quad \beta^2 \approx \frac{2B}{\pi\kappa^2}
$$</p>
<p>å› æ­¤ï¼š</p>
<p>$$
\eta^* \approx \frac{\sqrt{2B/\pi\kappa^2}\sum_i\nu_i g_i}{\frac{2B}{\pi\kappa^2}\sum_{i,j}\nu_i\nu_j H_{ij} + \sum_i H_{ii}} \approx \frac{\sqrt{2B/\pi\kappa^2}\sum_i\nu_i g_i}{\sum_i H_{ii}} \propto \sqrt{B}
$$</p>
<p><strong>æ³¨é‡Š10</strong>ï¼šè¿™è¯æ˜äº†å°Batch Sizeä¸‹çš„å¹³æ–¹æ ¹ç¼©æ”¾è§„å¾‹ã€‚</p>
<p><strong>æ¨å¯¼38</strong>ï¼šå¤§Batch Sizeæé™ï¼ˆ$B \gg \pi\kappa^2/2$ï¼‰</p>
<p>$$
\beta \approx 1 - \frac{\pi\kappa^2}{4B}, \quad 1-\beta^2 \approx \frac{\pi\kappa^2}{2B}
$$</p>
<p>æ­¤æ—¶ï¼š</p>
<p>$$
\eta^* \approx \frac{\sum_i\nu_i g_i}{\sum_{i,j}\nu_i\nu_j H_{ij} + \frac{\pi\kappa^2}{2B}\sum_i H_{ii}}
$$</p>
<p>å½“ $B$ ç»§ç»­å¢å¤§ï¼Œ$\eta^*$ è¶‹äºé¥±å’Œã€‚</p>
<h3 id="14-epsilon">14. Epsilonå¯¹ä¸åŒæ¢¯åº¦å°ºåº¦çš„å½±å“</h3>
<p><strong>æ¨å¯¼39</strong>ï¼šå®šä¹‰æ¢¯åº¦å°ºåº¦åˆ†ç±»</p>
<p>å¯¹äºä¸åŒçš„å‚æ•°ï¼Œæ ¹æ® $|g_i|$ ä¸ $\epsilon$ çš„å¤§å°å…³ç³»åˆ†ç±»ï¼š</p>
<ul>
<li>å¤§æ¢¯åº¦å‚æ•°ï¼š$|g_i| \gg \epsilon$ï¼Œæ­¤æ—¶ $\nu_i \approx \text{sign}(g_i)$</li>
<li>å°æ¢¯åº¦å‚æ•°ï¼š$|g_i| \ll \epsilon$ï¼Œæ­¤æ—¶ $\nu_i \approx g_i/\epsilon$</li>
</ul>
<p><strong>æ¨å¯¼40</strong>ï¼šæ··åˆè¡Œä¸º</p>
<p>å¯¹äºå¤§æ¢¯åº¦å‚æ•°ï¼ŒAdamè¡¨ç°ä¸ºç¬¦å·æ›´æ–°ï¼ˆæ¥è¿‘AdaSignï¼‰ï¼›å¯¹äºå°æ¢¯åº¦å‚æ•°ï¼ŒAdamè¡¨ç°ä¸ºç¼©æ”¾çš„æ¢¯åº¦æ›´æ–°ï¼ˆæ¥è¿‘SGDï¼‰ã€‚æ•´ä½“è¡Œä¸ºæ˜¯è¿™ä¸¤ç§æ¨¡å¼çš„æ··åˆã€‚</p>
<h3 id="15">15. å®é™…å½±å“çš„å®šé‡åˆ†æ</h3>
<p><strong>æ¨å¯¼41</strong>ï¼šæœ‰æ•ˆå­¦ä¹ ç‡çš„åˆ†å¸ƒ</p>
<p>è€ƒè™‘å‚æ•°çš„æœ‰æ•ˆå­¦ä¹ ç‡åˆ†å¸ƒï¼š</p>
<p>$$
\eta_{\text{eff},i} = \eta\frac{\nu_i\beta}{v_i^{1/2}+\epsilon}
$$</p>
<p>å…¶ä¸­ $v_i$ æ˜¯ç¬¬ $i$ ä¸ªå‚æ•°çš„äºŒé˜¶çŸ©ä¼°è®¡ã€‚</p>
<p>å½“ $\epsilon$ å¢å¤§æ—¶ï¼š
1. åˆ†å­ä¸­çš„ $\nu_i$ å‡å°
2. åˆ†æ¯ä¸­çš„ $\epsilon$ å¢å¤§</p>
<p>ä¸¤è€…å…±åŒä½œç”¨ä½¿å¾—æœ‰æ•ˆå­¦ä¹ ç‡å‡å°ã€‚</p>
<p><strong>æ³¨é‡Š11</strong>ï¼šè¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆLLMè®­ç»ƒä¸­ä½¿ç”¨è¾ƒå¤§çš„ $\epsilon$ï¼ˆå¦‚ $10^{-5}$ï¼‰éœ€è¦ç›¸åº”è°ƒæ•´åŸºç¡€å­¦ä¹ ç‡ã€‚</p>
<h3 id="_6">æ€»ç»“</h3>
<p>æœ¬èŠ‚è¯¦ç»†æ¨å¯¼äº†Adamä¼˜åŒ–å™¨ä¸­epsilonå‚æ•°çš„æ•°å­¦æœºåˆ¶ã€‚å…³é”®å‘ç°åŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>Epsilonçš„åŒé‡ä½œç”¨</strong>ï¼šæ—¢æä¾›æ•°å€¼ç¨³å®šæ€§ï¼Œåˆæ§åˆ¶Adamåˆ°SGDçš„æ’å€¼ç¨‹åº¦</li>
<li><strong>å¹³æ–¹æ ¹ç¼©æ”¾è§„å¾‹</strong>ï¼šåœ¨å°Batch Sizeä¸‹ï¼ŒAdaméµå¾ª $\eta \propto \sqrt{B}$ çš„è§„å¾‹</li>
<li><strong>Surgeç°è±¡çš„æŠ‘åˆ¶</strong>ï¼šå¢å¤§epsilonå¯ä»¥é™ä½Surgeç°è±¡å‡ºç°çš„æ¦‚ç‡</li>
<li><strong>è‡ªé€‚åº”æ€§çš„æƒè¡¡</strong>ï¼šEpsilonè¶Šå¤§ï¼Œè‡ªé€‚åº”ç¨‹åº¦è¶Šå¼±ï¼Œä½†è®­ç»ƒç¨³å®šæ€§å¯èƒ½æé«˜</li>
</ol>
<p>è¿™äº›ç†è®ºåˆ†æä¸ºå®é™…è®­ç»ƒä¸­epsilonçš„é€‰æ‹©æä¾›äº†æ•°å­¦ä¾æ®ã€‚</p>
        </div>
    </div>
</body>
</html>