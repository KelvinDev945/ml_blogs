<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆäºŒåä¹ï¼‰ï¼šç”¨DDPMæ¥ç¦»æ•£ç¼–ç </title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆäºŒåä¹ï¼‰ï¼šç”¨DDPMæ¥ç¦»æ•£ç¼–ç </h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-26 | ğŸ“„ å¤§å°: 44.1 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/10711">https://spaces.ac.cn/archives/10711</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>ç¬”è€…å‰ä¸¤å¤©åœ¨arXivåˆ·åˆ°äº†ä¸€ç¯‡æ–°è®ºæ–‡<a href="https://papers.cool/arxiv/2502.01189">ã€ŠCompressed Image Generation with Denoising Diffusion Codebook Modelsã€‹</a>ï¼Œå®åœ¨ä¸ºä½œè€…çš„å¤©é©¬è¡Œç©ºæ‰€å¹æœï¼Œå¿ä¸ä½æ¥è·Ÿå¤§å®¶åˆ†äº«ä¸€ç•ªã€‚</p>
<p>å¦‚æœ¬æ–‡æ ‡é¢˜æ‰€è¿°ï¼Œä½œè€…æå‡ºäº†ä¸€ä¸ªå«DDCMï¼ˆ<strong>D</strong> enoising <strong>D</strong> iffusion <strong>C</strong> odebook <strong>M</strong> odelsï¼‰çš„è„‘æ´ï¼Œå®ƒæŠŠDDPMçš„å™ªå£°é‡‡æ ·é™åˆ¶åœ¨ä¸€ä¸ªæœ‰é™çš„é›†åˆä¸Šï¼Œç„¶åå°±å¯ä»¥å®ç°ä¸€äº›å¾ˆå¥‡å¦™çš„æ•ˆæœï¼Œæ¯”å¦‚åƒVQVAEä¸€æ ·å°†æ ·æœ¬ç¼–ç ä¸ºç¦»æ•£çš„IDåºåˆ—å¹¶é‡æ„å›æ¥ã€‚æ³¨æ„è¿™äº›æ“ä½œéƒ½æ˜¯åœ¨é¢„è®­ç»ƒå¥½çš„DDPMä¸Šè¿›è¡Œçš„ï¼Œæ— éœ€é¢å¤–çš„è®­ç»ƒã€‚</p>
<h2 id="_1">æœ‰é™é›†åˆ</h2>
<p>ç”±äºDDCMåªéœ€è¦ç”¨åˆ°ä¸€ä¸ªé¢„è®­ç»ƒå¥½çš„DDPMæ¨¡å‹æ¥æ‰§è¡Œé‡‡æ ·ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å°±ä¸é‡å¤ä»‹ç»DDPMçš„æ¨¡å‹ç»†èŠ‚äº†ï¼Œå¯¹DDPMè¿˜ä¸å¤§äº†è§£çš„è¯»è€…å¯ä»¥å›é¡¾æˆ‘ä»¬ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆã€‹ç³»åˆ—çš„<a href="/archives/9119">ï¼ˆä¸€ï¼‰</a>ã€<a href="/archives/9152">ï¼ˆäºŒï¼‰</a>ã€<a href="/archives/9164">ï¼ˆä¸‰ï¼‰</a>ç¯‡ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼ŒDDPMçš„ç”Ÿæˆé‡‡æ ·æ˜¯ä»$\boldsymbol{x}<em t-1="t-1">T\sim\mathcal{N}(\boldsymbol{0},\boldsymbol{I})$å‡ºå‘ï¼Œç”±ä¸‹å¼è¿­ä»£åˆ°$\boldsymbol{x}_0$ï¼š<br />
\begin{equation}\boldsymbol{x}</em>} = \boldsymbol{\mu}(\boldsymbol{x}_t) + \sigma_t \boldsymbol{\varepsilon}_t,\quad \boldsymbol{\varepsilon}_t\sim\mathcal{N}(\boldsymbol{0},\boldsymbol{I})\label{eq:ddpm-g}\end{equation<br />
å¯¹äºDDPMæ¥è¯´ï¼Œæ¯ä¸€æ­¥çš„è¿­ä»£éƒ½éœ€è¦é‡‡æ ·ä¸€ä¸ªå™ªå£°ï¼ŒåŠ ä¸Š$\boldsymbol{x}_T$æœ¬èº«ä¹Ÿæ˜¯é‡‡æ ·çš„å™ªå£°ï¼Œæ‰€ä»¥é€šè¿‡$T$æ­¥è¿­ä»£ç”Ÿæˆ$\boldsymbol{x}_0$çš„è¿‡ç¨‹ä¸­ï¼Œå…±ä¼ å…¥äº†$T+1$ä¸ªå™ªå£°å‘é‡ï¼Œå‡è®¾$\boldsymbol{x}_t\in\mathbb{R}^d$ï¼Œé‚£ä¹ˆDDPMçš„é‡‡æ ·è¿‡ç¨‹å®é™…ä¸Šæ˜¯ä¸€ä¸ª$\mathbb{R}^{d\times (T+1)}\mapsto \mathbb{R}^d$çš„æ˜ å°„ã€‚</p>
<p>DDCMçš„ç¬¬ä¸€ä¸ªå¥‡æ€å¦™æƒ³æ˜¯å°†å™ªå£°çš„é‡‡æ ·ç©ºé—´æ¢æˆæœ‰é™é›†åˆï¼ˆCodebookï¼‰ï¼š<br />
\begin{equation}\boldsymbol{x}<em T_1="T+1">{t-1} = \boldsymbol{\mu}(\boldsymbol{x}_t) + \sigma_t \boldsymbol{\varepsilon}_t,\quad \boldsymbol{\varepsilon}_t\sim\mathcal{C}_t\label{eq:ddcm-g}\end{equation}<br />
ä»¥åŠ$\boldsymbol{x}_T\sim \mathcal{C}</em>^d$çš„æ˜ å°„ã€‚}$ï¼Œå…¶ä¸­$\mathcal{C}_t$æ˜¯$K$ä¸ªä»$\mathcal{N}(\boldsymbol{0},\boldsymbol{I})$é¢„é‡‡æ ·å¥½çš„å™ªå£°é›†åˆã€‚æ¢å¥è¯è¯´ï¼Œé‡‡æ ·ä¹‹å‰å°±ä»$\mathcal{N}(\boldsymbol{0},\boldsymbol{I})$é‡‡æ ·å¥½$K$ä¸ªå‘é‡å¹¶å›ºå®šä¸å˜ï¼Œåé¢æ¯æ¬¡é‡‡æ ·éƒ½ä»è¿™$K$ä¸ªå‘é‡ä¸­å‡åŒ€é‡‡æ ·ã€‚è¿™æ ·ä¸€æ¥ï¼Œç”Ÿæˆè¿‡ç¨‹å˜æˆäº†$\{1,2,\cdots,K\}^{T+1}\mapsto \mathbb{R</p>
<p>è¿™æ ·åšå¯¹ç”Ÿæˆæ•ˆæœæœ‰ä»€ä¹ˆæŸå¤±å‘¢ï¼ŸDDCMåšäº†å®éªŒï¼Œå‘ç°æŸå¤±å¾ˆå°ï¼š  </p>
<p><a href="/usr/uploads/2025/02/1143217502.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="å°†å™ªå£°é‡‡æ ·ç©ºé—´æ”¹ä¸ºæœ‰é™é›†åˆåï¼Œç”Ÿæˆç»“æœçš„FIDå¹¶ä¸ä¼šæ˜æ˜¾å˜å·®" src="/usr/uploads/2025/02/1143217502.png" /></a></p>
<p>å°†å™ªå£°é‡‡æ ·ç©ºé—´æ”¹ä¸ºæœ‰é™é›†åˆåï¼Œç”Ÿæˆç»“æœçš„FIDå¹¶ä¸ä¼šæ˜æ˜¾å˜å·®</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ$K = 64$æ—¶å·²ç»åŸºæœ¬è¿½å¹³FIDï¼Œä»”ç»†è§‚å¯Ÿå°±ä¼šå‘ç°å…¶å®$K=2$æ—¶ä¹Ÿæ²¡æŸå¤±å¤šå°‘ï¼Œè¿™è¡¨æ˜é‡‡æ ·ç©ºé—´æœ‰é™åŒ–å¯ä»¥ä¿æŒDDPMçš„ç”Ÿæˆèƒ½åŠ›ã€‚æ³¨æ„è¿™é‡Œæœ‰ä¸ªç»†èŠ‚ï¼Œæ¯ä¸€æ­¥çš„$\mathcal{C}_t$æ˜¯ç‹¬ç«‹çš„ï¼Œå³æ‰€æœ‰CodebookåŠ èµ·æ¥å…±æœ‰$(T+1)K$ä¸ªå™ªå£°ï¼Œè€Œéå…±äº«$K$ä¸ªå™ªå£°ã€‚ç¬”è€…åšäº†ç®€å•çš„å¤ç°ï¼Œå‘ç°å…±äº«çš„è¯éœ€è¦$K\geq 8192$æ‰èƒ½ä¿æŒç›¸è¿‘æ•ˆæœã€‚</p>
<h2 id="_2">ç¦»æ•£ç¼–ç </h2>
<p>ç°åœ¨æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªé€†é—®é¢˜ï¼šå¯»æ‰¾ç»™å®š$\boldsymbol{x}<em t-1="t-1">0$çš„ç¦»æ•£ç¼–ç ï¼Œå³å¯»æ‰¾ç›¸åº”çš„åºåˆ—$\boldsymbol{\varepsilon}_T\in \mathcal{C}_T,\cdots,\boldsymbol{\varepsilon}_1\in \mathcal{C}_1$ï¼Œä½¿å¾—è¿­ä»£$\boldsymbol{x}</em>_0$è·Ÿç»™å®šçš„æ ·æœ¬å°½å¯èƒ½æ¥è¿‘ã€‚} = \boldsymbol{\mu}(\boldsymbol{x}_t) + \sigma_t \boldsymbol{\varepsilon}_t$ç”Ÿæˆçš„$\boldsymbol{x</p>
<p>æ—¢ç„¶å°†é‡‡æ ·ç©ºé—´æœ‰é™åŒ–åFIDä¸ä¼šæœ‰æ˜æ˜¾å˜åŒ–ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è®¤ä¸ºåŒåˆ†å¸ƒçš„æ‰€æœ‰æ ·æœ¬éƒ½å¯ä»¥é€šè¿‡å¼$\eqref{eq:ddcm-g}$æ¥ç”Ÿæˆï¼Œæ‰€ä»¥ä¸Šè¿°é€†é—®é¢˜çš„è§£ç†è®ºä¸Šæ˜¯å­˜åœ¨çš„ã€‚å¯æ€ä¹ˆæŠŠå®ƒæ‰¾å‡ºæ¥å‘¢ï¼Ÿç›´è§‚çš„æƒ³æ³•æ˜¯ä»$\boldsymbol{x}_0$å¼€å§‹å€’æ¨ï¼Œä½†ç»†æ€ä¹‹ä¸‹æˆ‘ä»¬ä¼šå‘ç°éš¾ä»¥æ“ä½œï¼Œæ¯”å¦‚ç¬¬ä¸€æ­¥$\boldsymbol{x}_0 = \boldsymbol{\mu}(\boldsymbol{x}_1) + \sigma_1 \boldsymbol{\varepsilon}_1$ï¼Œè¿™é‡Œ$\boldsymbol{x}_1$å’Œ$\boldsymbol{\varepsilon}_1$éƒ½æ˜¯æœªçŸ¥çš„ï¼Œéš¾ä»¥åŒæ—¶æŠŠå®ƒä»¬å®šä¸‹æ¥ã€‚</p>
<p>è¿™æ—¶å€™DDCMçš„ç¬¬äºŒä¸ªå¥‡æ€å¦™æƒ³ç™»åœºäº†ï¼Œå®ƒå°†$\boldsymbol{x}<em t-1="t-1">0$çš„ç¦»æ•£ç¼–ç è§†ä¸ºä¸€ä¸ªæ¡ä»¶æ§åˆ¶ç”Ÿæˆé—®é¢˜ï¼å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬ä»å›ºå®šçš„$\boldsymbol{x}_T$ï¼Œé€šè¿‡å¦‚ä¸‹æ–¹å¼æ¥é€‰æ‹©$\boldsymbol{\varepsilon}_t$ï¼š<br />
\begin{equation}\boldsymbol{x}</em>} = \boldsymbol{\mu}(\boldsymbol{x<em _boldsymbol_varepsilon="\boldsymbol{\varepsilon">t) + \sigma_t \boldsymbol{\varepsilon}_t,\quad \boldsymbol{\varepsilon}_t = \mathop{\text{argmax}}</em>}\in\mathcal{C<em t-1="t-1">t} \boldsymbol{\varepsilon}\cdot(\boldsymbol{x}_0-\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t))\label{eq:ddcm-eg}\end{equation}<br />
è¿™é‡Œçš„$\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)$æ˜¯ç”¨$\boldsymbol{x}_t$æ¥é¢„æµ‹$\boldsymbol{x}_0$çš„æ¨¡å‹ï¼Œå®ƒè·Ÿ$\boldsymbol{\mu}(\boldsymbol{x}_t)$çš„å…³ç³»æ˜¯ï¼š<br />
\begin{equation}\boldsymbol{\mu}(\boldsymbol{x}_t) = \frac{\alpha_t\bar{\beta}</em>}^2}{\bar{\beta<em t-1="t-1">t^2}\boldsymbol{x}_t + \frac{\bar{\alpha}</em>}\beta_t^2}{\bar{\beta}_t^2}\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)\end{equation<br />
å¦‚æœè¯»è€…å¿˜è®°äº†è¿™éƒ¨åˆ†å†…å®¹ï¼Œå¯ä»¥åˆ°<a href="/archives/9164">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆä¸‰ï¼‰ï¼šDDPM = è´å¶æ–¯ + å»å™ªã€‹</a>å¤ä¹ ä¸€ä¸‹ã€‚</p>
<p>è¯¦ç»†çš„æ¨å¯¼æˆ‘ä»¬ä¸‹ä¸€èŠ‚å†è®¨è®ºï¼Œç°åœ¨å…ˆæ¥è§‚æ‘©ä¸€ä¸‹å¼$\eqref{eq:ddcm-eg}$ï¼Œå®ƒè·Ÿéšæœºç”Ÿæˆçš„å¼$\eqref{eq:ddcm-g}$çš„å”¯ä¸€åŒºåˆ«é€šè¿‡$\text{argmax}$æ¥é€‰æ‹©æœ€ä¼˜$\boldsymbol{\varepsilon}_t$ï¼ŒæŒ‡æ ‡æ˜¯$\boldsymbol{\varepsilon}$ä¸æ®‹å·®$\boldsymbol{x}_0-\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)$çš„å†…ç§¯ç›¸ä¼¼åº¦ï¼Œç›´è§‚ç†è§£å°±æ˜¯è®©$\boldsymbol{\varepsilon}$å°½å¯èƒ½è¡¥å¿å½“å‰$\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)$ä¸ç›®æ ‡$\boldsymbol{x}_0$çš„å·®è·ã€‚é€šè¿‡è¿­ä»£å¼$\eqref{eq:ddcm-eg}$ï¼Œå›¾ç‰‡ç­‰ä»·åœ°è¢«è½¬åŒ–ä¸º$T-1$ä¸ªæ•´æ•°ï¼ˆ$\sigma_1$é€šå¸¸è®¾ä¸ºé›¶ï¼‰ã€‚</p>
<p>è§„åˆ™çœ‹ä¸Šå»å¾ˆç®€å•ï¼Œé‚£å®é™…é‡æ„æ•ˆæœå¦‚ä½•å‘¢ï¼Ÿä¸‹é¢æˆªå–äº†åŸè®ºæ–‡çš„ä¸€ä¸ªå›¾ï¼Œå¯ä»¥çœ‹åˆ°è¿˜æ˜¯æ¯”è¾ƒæƒŠè‰³çš„ï¼ŒåŸè®ºæ–‡è¿˜æœ‰æ›´å¤šæ•ˆæœå›¾ã€‚ç¬”è€…ä¹Ÿåœ¨è‡ªå·±çš„æ¨¡å‹å°è¯•äº†ä¸€ä¸‹ï¼Œå‘ç°åŸºæœ¬ä¸Šèƒ½å¤ç°ç›¸è¿‘çš„æ•ˆæœï¼Œæ‰€ä»¥æ–¹æ³•è¿˜æ˜¯æ¯”è¾ƒå¯é çš„ã€‚  </p>
<p><a href="/usr/uploads/2025/02/1251998353.jpg" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="DDCMçš„ç¦»æ•£ç¼–ç é‡æ„æ•ˆæœ" src="/usr/uploads/2025/02/1251998353.jpg" /></a></p>
<p>DDCMçš„ç¦»æ•£ç¼–ç é‡æ„æ•ˆæœ</p>
<h2 id="_3">æ¡ä»¶ç”Ÿæˆ</h2>
<p>åˆšæ‰æˆ‘ä»¬è¯´äº†ï¼ŒDDCMå°†ç¼–ç è¿‡ç¨‹è§†ä¸ºä¸€ä¸ªæ¡ä»¶æ§åˆ¶ç”Ÿæˆè¿‡ç¨‹ï¼Œæ€ä¹ˆç†è§£è¿™å¥è¯å‘¢ï¼Ÿæˆ‘ä»¬ä»DDPMçš„å¼$\eqref{eq:ddpm-g}$å‡ºå‘ï¼Œå®ƒå¯ä»¥ç­‰ä»·åœ°å†™æˆ<br />
\begin{equation}p(\boldsymbol{x}<em t-1="t-1">{t-1}|\boldsymbol{x}_t) = \mathcal{N}(\boldsymbol{x}</em>};\boldsymbol{\mu}(\boldsymbol{x<em t-1="t-1">t),\sigma_t^2\boldsymbol{I})\end{equation}<br />
ç°åœ¨æˆ‘ä»¬è¦åšçš„äº‹æƒ…æ˜¯å·²çŸ¥$\boldsymbol{x}_0$çš„å‰æä¸‹è°ƒæ§ç”Ÿæˆè¿‡ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾€ä¸Šè¿°åˆ†å¸ƒä¸­å¤šåŠ ä¸€ä¸ªæ¡ä»¶$\boldsymbol{x}_0$ï¼Œå³æ”¹ä¸º$p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t,\boldsymbol{x}_0)$ã€‚äº‹å®ä¸Šåœ¨DDPMä¸­ï¼Œ$p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t,\boldsymbol{x}_0)$æ˜¯æœ‰è§£æè§£çš„ï¼Œæˆ‘ä»¬åœ¨<a href="/archives/9164">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆä¸‰ï¼‰ï¼šDDPM = è´å¶æ–¯ + å»å™ªã€‹</a>å·²ç»æ±‚å‡ºè¿‡ï¼š<br />
\begin{equation}p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t, \boldsymbol{x}_0) = \mathcal{N}\left(\boldsymbol{x}</em>};\frac{\alpha_t\bar{\beta<em t-1="t-1">{t-1}^2}{\bar{\beta}_t^2}\boldsymbol{x}_t + \frac{\bar{\alpha}</em>}\beta_t^2}{\bar{\beta<em t-1="t-1">t^2}\boldsymbol{x}_0,\frac{\bar{\beta}</em>}^2\beta_t^2}{\bar{\beta<em t-1="t-1">t^2} \boldsymbol{I}\right)\end{equation}<br />
æˆ–è€…å†™æˆ<br />
\begin{equation}\begin{aligned}<br />
\boldsymbol{x}</em>} =&amp;\, \frac{\alpha_t\bar{\beta<em t-1="t-1">{t-1}^2}{\bar{\beta}_t^2}\boldsymbol{x}_t + \frac{\bar{\alpha}</em>}\beta_t^2}{\bar{\beta<em t-1="t-1">t^2}\boldsymbol{x}_0 + \frac{\bar{\beta}</em>}\beta_t}{\bar{\beta<em t-1="t-1">t}\boldsymbol{\varepsilon}_t \\\<br />
=&amp;\, \underbrace{\frac{\alpha_t\bar{\beta}</em>}^2}{\bar{\beta<em t-1="t-1">t^2}\boldsymbol{x}_t + \frac{\bar{\alpha}</em>}\beta_t^2}{\bar{\beta<em _boldsymbol_mu="\boldsymbol{\mu">t^2}\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)}</em>}(\boldsymbol{x<em t-1="t-1">t)} + \frac{\bar{\alpha}</em>}\beta_t^2}{\bar{\beta<em t-1="t-1">t^2}(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)) + \underbrace{\frac{\bar{\beta}</em>}\beta_t}{\bar{\beta<em _sigma_t="\sigma_t">t}}</em>}\boldsymbol{\varepsilon<em _boldsymbol_varepsilon="\boldsymbol{\varepsilon">t<br />
\end{aligned}\label{eq:ddcm-eg0}\end{equation}<br />
å…¶ä¸­$\boldsymbol{\varepsilon}_t\sim\mathcal{N}(\boldsymbol{0},\boldsymbol{I})$ã€‚ç›¸æ¯”å¼$\eqref{eq:ddpm-g}$ï¼Œä¸Šå¼å¤šäº†$\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)$ä¸€é¡¹ï¼Œå®ƒç”¨æ¥å¼•å¯¼ç”Ÿæˆç»“æœå‘$\boldsymbol{x}_0$é è¿‘ã€‚ä½†åˆ«å¿˜äº†æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯ç¦»æ•£ç¼–ç $\boldsymbol{x}_0$ï¼Œæ‰€ä»¥ç”Ÿæˆè¿‡ç¨‹ä¸èƒ½æœ‰$\boldsymbol{x}_0$æ˜¾å¼å‚ä¸ï¼Œå¦åˆ™å°±å› æœå€’ç½®äº†ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯„æœ›äº$\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)$è¿™ä¸€é¡¹èƒ½ä»$\boldsymbol{\varepsilon}_t$ä¸­å¾—åˆ°è¡¥å¿ï¼Œæ‰€ä»¥æˆ‘ä»¬è°ƒæ•´$\boldsymbol{\varepsilon}_t$çš„é€‰æ‹©è§„åˆ™ä¸º<br />
\begin{equation}\boldsymbol{\varepsilon}_t = \mathop{\text{argmin}}</em>}\in\mathcal{C<em t-1="t-1">t} \left\Vert\frac{\bar{\alpha}</em>}\beta_t^2}{\bar{\beta<em t-1="t-1">t^2}(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)) - \frac{\bar{\beta}</em>}\beta_t}{\bar{\beta<em _boldsymbol_varepsilon="\boldsymbol{\varepsilon">t}\boldsymbol{\varepsilon}\right\Vert\label{eq:ddcm-eps0}\end{equation}<br />
ç”±äº$\mathcal{C}_t$çš„å‘é‡éƒ½æ˜¯ä»$\mathcal{N}(\boldsymbol{0},\boldsymbol{I})$é¢„é‡‡æ ·å¥½çš„ï¼Œæ‰€ä»¥è·Ÿ<a href="/archives/8679">ã€Šè®©äººæƒŠå¹çš„Johnson-Lindenstrausså¼•ç†ï¼šç†è®ºç¯‡ã€‹</a>é‡Œé¢çš„â€œå•ä½æ¨¡å¼•ç†â€ç±»ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸º$\mathcal{C}_t$çš„å‘é‡æ¨¡é•¿å¤§è‡´ç›¸åŒï¼Œåœ¨è¿™ä¸ªå‡è®¾ä¹‹ä¸‹ï¼Œä¸Šå¼ä¹Ÿç­‰ä»·äº<br />
\begin{equation}\boldsymbol{\varepsilon}_t = \mathop{\text{argmax}}</em>}\in\mathcal{C}_t} \boldsymbol{\varepsilon}\cdot(\boldsymbol{x}_0-\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t))\end{equation<br />
è¿™å°±å¾—åˆ°äº†DDCMçš„å¼$\eqref{eq:ddcm-eg}$ã€‚</p>
<h2 id="_4">é‡è¦é‡‡æ ·</h2>
<p>åœ¨ä¸Šè¿°æ¨å¯¼ä¸­ï¼Œæˆ‘ä»¬ç”¨åˆ°äº†â€œå¯„æœ›äº$\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)$è¿™ä¸€é¡¹èƒ½ä»$\boldsymbol{\varepsilon}_t$ä¸­å¾—åˆ°è¡¥å¿ï¼Œæ‰€ä»¥å°†$\boldsymbol{\varepsilon}_t$çš„é€‰æ‹©è§„åˆ™æ”¹ä¸ºå¼$\eqref{eq:ddcm-eps0}$â€çš„è¯´æ³•ï¼Œè¿™æ ·è™½ç„¶çœ‹èµ·æ¥æ¯”è¾ƒç›´è§‚ï¼Œä½†ä»æ•°å­¦ä¸Šæ¥è¯´æ˜¯ä¸ä¸¥è°¨çš„ï¼Œç”šè‡³ä¸¥æ ¼æ¥è¯´æ˜¯é”™è¯¯çš„ã€‚è¿™ä¸€èŠ‚æˆ‘ä»¬æ¥å°†è¿™éƒ¨åˆ†å†…å®¹ä¸¥æ ¼åŒ–ã€‚</p>
<p>å†æ¬¡å›é¡¾å¼$\eqref{eq:ddcm-eg0}$ï¼Œå‰é¢çš„æ¨å¯¼ç›´åˆ°å¼$\eqref{eq:ddcm-eg0}$éƒ½æ˜¯ä¸¥è°¨çš„ï¼Œä¸ä¸¥è°¨çš„åœ°æ–¹åœ¨äºå»ºç«‹å°†å¼$\eqref{eq:ddcm-eg0}$ä¸$\mathcal{C}<em t-1="t-1">t$è”ç³»èµ·æ¥çš„æ–¹å¼ã€‚è¯•æƒ³ä¸€ä¸‹ï¼ŒæŒ‰ç…§$\eqref{eq:ddcm-eps0}$æ¥é€‰$\boldsymbol{\varepsilon}_t$ï¼Œå½“$K\to\infty$æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿæ­¤æ—¶æˆ‘ä»¬å¯ä»¥è®¤ä¸º$\mathcal{C}_t$å·²ç»è¦†ç›–äº†æ•´ä¸ª$\mathbb{R}^d$ï¼Œæ‰€ä»¥$\frac{\bar{\alpha}</em>}\beta_t^2}{\bar{\beta<em t-1="t-1">t^2}(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)) = \frac{\bar{\beta}</em>}\beta_t}{\bar{\beta<em t-1="t-1">t}\boldsymbol{\varepsilon}_t$ï¼Œä¹Ÿå°±æ˜¯è¯´å¼$\eqref{eq:ddcm-eg0}$å˜æˆäº†ç¡®å®šæ€§çš„å˜æ¢ï¼š<br />
\begin{equation}\boldsymbol{x}</em>} = \frac{\alpha_t\bar{\beta<em t-1="t-1">{t-1}^2}{\bar{\beta}_t^2}\boldsymbol{x}_t + \frac{\bar{\alpha}</em>}\beta_t^2}{\bar{\beta<em t-1="t-1">t^2}\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t) + \frac{\bar{\alpha}</em>}\beta_t^2}{\bar{\beta<em t-1="t-1">t^2}(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)) = \frac{\alpha_t\bar{\beta}</em>}^2}{\bar{\beta<em t-1="t-1">t^2}\boldsymbol{x}_t + \frac{\bar{\alpha}</em>}\beta_t^2}{\bar{\beta<em K_to_infty="K\to\infty">t^2}\boldsymbol{x}_0\end{equation}<br />
æ¢è¨€ä¹‹$K\to\infty$æ—¶æ— æ³•æ¢å¤åŸæœ¬çš„éšæœºé‡‡æ ·è½¨è¿¹ï¼Œè¿™å…¶å®å¹¶ä¸æ˜¯ä¸€ä»¶ç§‘å­¦çš„äº‹æƒ…ã€‚æˆ‘ä»¬è®¤ä¸ºé‡‡æ ·ç©ºé—´æœ‰é™åŒ–åº”è¯¥æ˜¯è¿ç»­é‡‡æ ·ç©ºé—´çš„ä¸€ä¸ªè¿‘ä¼¼ï¼Œå½“$K\to\infty$æ—¶åº”è¯¥è¿˜åŸè¿ç»­å‹çš„é‡‡æ ·è½¨è¿¹ï¼Œè¿™æ ·ç¦»æ•£åŒ–çš„æ¯ä¸€æ­¥æ‰æ›´æœ‰ç†è®ºä¿è¯ï¼Œæˆ–è€…ç”¨ä¸€ç§æ›´æ•°å­¦åŒ–çš„è¡¨è¾¾æ–¹å¼ï¼Œå°±æ˜¯æˆ‘ä»¬è®¤ä¸ºå¿…è¦æ¡ä»¶æ˜¯<br />
\begin{equation}\lim</em>} \text{DDCM} = \text{DDPM}\end{equation</p>
<p>ä»å¼$\eqref{eq:ddpm-g}$å˜åˆ°å¼$\eqref{eq:ddcm-eg0}$ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯å™ªå£°åˆ†å¸ƒä»$\mathcal{N}(\boldsymbol{0},\boldsymbol{I})$æ¢æˆäº†$\mathcal{N}(\frac{\bar{\alpha}<em t-1="t-1">{t-1}\beta_t^2}{\bar{\beta}_t^2\sigma_t}(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)),\boldsymbol{I})$ï¼Œä½†å‡ºäºç¼–ç çš„éœ€æ±‚ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥ä»åè€…é‡‡æ ·ï¼Œè€Œåªèƒ½ä»æœ‰é™é›†åˆ$\mathcal{C}_t$ä¸­é‡‡æ ·ã€‚ä¸ºäº†æ»¡è¶³å¿…è¦æ¡ä»¶ï¼Œå³ä¸ºäº†ä½¿é‡‡æ ·ç»“æœæ›´è´´è¿‘ä»$\mathcal{N}(\frac{\bar{\alpha}</em>}\beta_t^2}{\bar{\beta<em t-1="t-1">t^2\sigma_t}(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)),\boldsymbol{I})$é‡‡æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒçš„æ¦‚ç‡å¯†åº¦å‡½æ•°å¯¹$\boldsymbol{\varepsilon}\in\mathcal{C}_t$è¿›è¡ŒåŠ æƒï¼š<br />
\begin{equation}p(\boldsymbol{\varepsilon})\propto \exp\left(-\frac{1}{2}\left\Vert\boldsymbol{\varepsilon} - \frac{\bar{\alpha}</em>}\beta_t^2}{\bar{\beta<em t-1="t-1">t^2\sigma_t}(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t))\right\Vert^2\right),\quad \boldsymbol{\varepsilon}\in\mathcal{C}_t\label{eq:ddcm-p}\end{equation}<br />
ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ€åˆç†çš„æ–¹å¼åº”è¯¥æ˜¯å¯¹$-\frac{1}{2}\left\Vert\boldsymbol{\varepsilon} - \frac{\bar{\alpha}</em>$äº†ã€‚}\beta_t^2}{\bar{\beta}_t^2\sigma_t}(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t))\right\Vert^2$åšSoftmaxåæŒ‰æ¦‚ç‡åšé‡è¦æ€§é‡‡æ ·ï¼Œè€Œä¸æ˜¯ç›´æ¥å–$\text{argmax}$ã€‚åªä¸è¿‡å½“$K$æ¯”è¾ƒå°æ—¶ï¼ŒSoftmaxä¹‹åçš„åˆ†å¸ƒä¼šæ¥è¿‘one hotåˆ†å¸ƒï¼Œæ‰€ä»¥æŒ‰æ¦‚ç‡é‡‡æ ·çº¦ç­‰äº$\text{argmax</p>
<h2 id="_5">ä¸€èˆ¬å½¢å¼</h2>
<p>æˆ‘ä»¬è¿˜å¯ä»¥å°†ä¸Šè¿°ç»“æœæ¨å¹¿åˆ°Classifier-Guidanceç”Ÿæˆã€‚æ ¹æ®<a href="/archives/9257">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆä¹ï¼‰ï¼šæ¡ä»¶æ§åˆ¶ç”Ÿæˆç»“æœã€‹</a>çš„æ¨å¯¼ï¼Œä¸ºå¼$\eqref{eq:ddpm-g}$åŠ å…¥Classifier-Guidanceåçš„ç»“æœæ˜¯<br />
\begin{equation}\boldsymbol{x}<em _boldsymbol_x="\boldsymbol{x">{t-1} = \boldsymbol{\mu}(\boldsymbol{x}_t) + \sigma_t^2 \nabla</em><em _boldsymbol_x="\boldsymbol{x">t} \log p(\boldsymbol{y}|\boldsymbol{x}_t) + \sigma_t\boldsymbol{\varepsilon}_t,\quad \boldsymbol{\varepsilon}_t\sim \mathcal{N}(\boldsymbol{0},\boldsymbol{I})\end{equation}<br />
å³æ–°å¢äº†$\sigma_t^2 \nabla</em><em o="o">t} \log p(\boldsymbol{y}|\boldsymbol{x}_t)$ï¼Œå…¶ä¸­$p(\boldsymbol{y}|\boldsymbol{x}_t)$æ˜¯å¸¦å™ªæ ·æœ¬åˆ†ç±»å™¨ï¼Œå¦‚æœæˆ‘ä»¬åªæœ‰æ— å™ªæ ·æœ¬åˆ†ç±»å™¨$p_o(\boldsymbol{y}|\boldsymbol{x})$ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥è®©$p(\boldsymbol{y}|\boldsymbol{x}_t) = p</em>_t))$ã€‚}(\boldsymbol{y}|\boldsymbol{\mu}(\boldsymbol{x</p>
<p>åœ¨åŒæ ·çš„æ¨å¯¼ä¹‹ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ç±»ä¼¼å¼$\eqref{eq:ddcm-eps0}$çš„é€‰æ‹©è§„åˆ™<br />
\begin{equation}\boldsymbol{\varepsilon}<em _boldsymbol_varepsilon="\boldsymbol{\varepsilon">t = \mathop{\text{argmin}}</em>}\in\mathcal{C<em _boldsymbol_x="\boldsymbol{x">t} \left\Vert\sigma_t^2 \nabla</em><em _boldsymbol_varepsilon="\boldsymbol{\varepsilon">t} \log p(\boldsymbol{y}|\boldsymbol{x}_t) - \sigma_t\boldsymbol{\varepsilon}\right\Vert\end{equation}<br />
æˆ–è€…è¿‘ä¼¼åœ°<br />
\begin{equation}\boldsymbol{\varepsilon}_t = \mathop{\text{argmax}}</em>}\in\mathcal{C<em _boldsymbol_x="\boldsymbol{x">t} \boldsymbol{\varepsilon}\cdot\nabla</em><em _boldsymbol_x="\boldsymbol{x">t} \log p(\boldsymbol{y}|\boldsymbol{x}_t)\end{equation}<br />
å½“ç„¶ä¹Ÿå¯ä»¥æŒ‰ç…§å¼$\eqref{eq:ddcm-p}$æ¥æ„é€ é‡‡æ ·åˆ†å¸ƒ<br />
\begin{equation}p(\boldsymbol{\varepsilon})\propto \exp\left(-\frac{1}{2}\left\Vert\boldsymbol{\varepsilon} - \sigma_t\nabla</em>}_t} \log p(\boldsymbol{y}|\boldsymbol{x}_t)\right\Vert^2\right),\quad \boldsymbol{\varepsilon}\in\mathcal{C}_t\end{equation<br />
è¿™äº›éƒ½åªæ˜¯å‰è¿°ç»“æœçš„ç®€å•æ¨å¹¿ã€‚</p>
<h2 id="_6">ä¸ªäººè¯„æ</h2>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¯¹DDCMçš„ä»‹ç»åŸºæœ¬å®Œæ¯•ï¼Œæ›´å¤šçš„ç»†èŠ‚å¤§å®¶è¯·è‡ªè¡Œçœ‹åŸè®ºæ–‡å°±å¥½ã€‚ä½œè€…è¿˜æ²¡æœ‰å¼€æºä»£ç ï¼Œè¿™é‡Œç¬”è€…ç»™å‡ºè‡ªå·±çš„å‚è€ƒå®ç°ï¼š</p>
<blockquote>
<p><strong>DDCMï¼š<a href="https://github.com/bojone/Keras-DDPM/blob/main/ddcm.py">https://github.com/bojone/Keras-DDPM/blob/main/ddcm.py</a></strong></p>
</blockquote>
<p>å¦‚æœå¤§å®¶å¯¹æ‰©æ•£æ¨¡å‹å·²æœ‰ä¸€äº›äº†è§£å¹¶ä¸”æ‰‹å¤´ä¸Šæœ‰ç°æˆçš„æ‰©æ•£æ¨¡å‹ï¼Œå¼ºçƒˆæ¨èäº²è‡ªè¯•è¯•ã€‚äº‹å®ä¸ŠDDCMçš„åŸç†å¾ˆå¥½æ‡‚ï¼Œä»£ç ä¹Ÿä¸éš¾å†™ï¼Œä½†åªæœ‰äº²è‡ªå°è¯•è¿‡ï¼Œæ‰èƒ½ä½“éªŒåˆ°é‚£ç§è®©äººæ‹æ¡ˆå«ç»çš„æƒŠè‰³æ„Ÿã€‚ä¸Šä¸€æ¬¡ç»™ç¬”è€…ç›¸åŒæ„Ÿè§‰çš„æ˜¯<a href="/archives/10055">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆäºŒåä¸‰ï¼‰ï¼šä¿¡å™ªæ¯”ä¸å¤§å›¾ç”Ÿæˆï¼ˆä¸‹ï¼‰ã€‹</a>ä»‹ç»çš„ä¸€ç§å…è®­ç»ƒç”Ÿæˆå¤§å›¾çš„æŠ€å·§Upsample Guidanceï¼ŒåŒæ ·ä½“ç°äº†ä½œè€…åˆ«å‡ºå¿ƒè£çš„æ„æ€ã€‚</p>
<p>ä½†ä»é•¿è¿œå½±å“åŠ›æ¥è¯´ï¼Œä¸ªäººè®¤ä¸ºUpsample Guidanceè¿˜æ˜¯ä¸å¦‚DDCMçš„ã€‚å› ä¸ºå¯¹å›¾ç‰‡åšç¦»æ•£åŒ–ç¼–ç æ˜¯å¤šæ¨¡æ€LLMçš„ä¸»æµè·¯çº¿ä¹‹ä¸€ï¼Œå®ƒå……å½“ç€â€œå›¾ç‰‡Tokenizerâ€çš„è§’è‰²ï¼Œæ˜¯ç›¸å½“å…³é”®çš„ä¸€ç¯ï¼Œè€ŒDDCMå¯ä»¥è¯´æ˜¯å¼€è¾Ÿäº†<a href="/archives/6760">VQ</a>ã€<a href="/archives/9826">FSQ</a>ä»¥å¤–çš„å…¨æ–°è·¯çº¿ï¼Œå› æ­¤å¯èƒ½ä¼šæœ‰æ›´æ·±è¿œçš„æ½œåœ¨å½±å“ã€‚åœ¨åŸè®ºæ–‡ä¸­ï¼ŒDDCMåªå°†è‡ªå·±å®šä¹‰ä¸ºCompressionæ–¹æ³•ï¼Œåè€Œæœ‰ç‚¹â€œè‡ªè§†ç”šä½â€äº†ã€‚</p>
<p>ä½œä¸ºä¸€ä¸ªç¦»æ•£ç¼–ç æ¨¡å‹ï¼ŒDDCMè¿˜æœ‰ä¸€ä¸ªéå¸¸çªå‡ºçš„ä¼˜ç‚¹æ˜¯å®ƒå‡ºæ¥çš„ç¦»æ•£ç¼–ç å¤©ç„¶å°±æ˜¯1Dçš„ï¼Œè€Œä¸åƒVQã€FSQç­‰æ–¹æ¡ˆä¸€æ ·ç¼–ç ç»“æœé€šå¸¸ä¿ç•™äº†å›¾åƒçš„2Dç‰¹æ€§ï¼ˆ<a href="https://papers.cool/arxiv/2406.07550">TiTok</a>ç­‰ç”¨äº†Q-Formeræ€æƒ³å»è½¬1Dçš„æ¨¡å‹é™¤å¤–ï¼‰ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬åœ¨ç”¨è¿™äº›ç¼–ç åšè‡ªå›å½’ç”Ÿæˆæ—¶å°±ä¸ç”¨å†è€ƒè™‘â€œæ’åºâ€è¿™ä¸ªé—®é¢˜äº†ï¼ˆå‚è€ƒ<a href="/archives/10197">ã€Šâ€œé—­é—¨é€ è½¦â€ä¹‹å¤šæ¨¡æ€æ€è·¯æµ…è°ˆï¼ˆäºŒï¼‰ï¼šè‡ªå›å½’ã€‹</a>ï¼‰ï¼Œè¿™ä¸€ç‚¹ä¼šæ˜¾å¾—éå¸¸çœå¿ƒã€‚</p>
<p>å½“ç„¶ï¼Œç›®å‰çœ‹æ¥å®ƒè¿˜æœ‰ä¸€äº›æ”¹è¿›ç©ºé—´ï¼Œæ¯”å¦‚ç›®å‰çš„ç¼–ç è·Ÿç”Ÿæˆæ˜¯åŒæ—¶è¿›è¡Œçš„ï¼Œè¿™æ„å‘³ç€DDPMçš„é‡‡æ ·é€Ÿåº¦æœ‰å¤šæ…¢ï¼ŒDDCMçš„ç¼–ç é€Ÿåº¦å°±æœ‰å¤šæ…¢ï¼Œè¿™åœ¨ç›®å‰æ¥è¯´è¿˜æ˜¯ä¸å¤§èƒ½æ¥å—çš„ã€‚ååæˆ‘ä»¬è¿˜ä¸èƒ½éšä¾¿ä¸ŠåŠ é€Ÿé‡‡æ ·çš„æŠ€å·§ï¼Œå› ä¸ºåŠ é€Ÿé‡‡æ ·æ„å‘³ç€å‡å°‘äº†$T$ï¼Œè€Œå‡å°‘$T$æ„å‘³ç€ç¼©çŸ­äº†ç¼–ç é•¿åº¦ï¼Œå³å¢å¤§äº†å‹ç¼©ç‡ï¼Œé‚£ä¹ˆä¼šæ˜æ˜¾å¢åŠ é‡æ„æŸå¤±ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œä¸ªäººè®¤ä¸ºDDCMæ˜¯ä¸€ç§éå¸¸æœ‰æ„æ€çš„ã€æ½œåŠ›äºŸå¾…æŒ–æ˜ã€åŒæ—¶ä¹ŸäºŸå¾…è¿›ä¸€æ­¥ä¼˜åŒ–çš„ç¦»æ•£ç¼–ç æ–¹æ³•ã€‚</p>
<h2 id="_7">æ–‡ç« å°ç»“</h2>
<p>æœ¬æ–‡ä»‹ç»äº†æ‰©æ•£æ¨¡å‹çš„ä¸€ä¸ªæ–°è„‘æ´ï¼Œå®ƒå°†DDPMç”Ÿæˆè¿‡ç¨‹ä¸­çš„å™ªå£°é™åˆ¶åœ¨ä¸€ä¸ªæœ‰é™çš„é›†åˆä¸Šï¼Œå¹¶ç»“åˆæ¡ä»¶ç”Ÿæˆçš„æ€è·¯ï¼Œå°†DDPMå…è®­ç»ƒåœ°å˜æˆä¸€ä¸ªç±»ä¼¼VQ-VAEçš„ç¦»æ•£è‡ªç¼–ç å™¨ã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/10711">https://spaces.ac.cn/archives/10711</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Feb. 14, 2025). ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆäºŒåä¹ï¼‰ï¼šç”¨DDPMæ¥ç¦»æ•£ç¼–ç  ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/10711">https://spaces.ac.cn/archives/10711</a></p>
<p>@online{kexuefm-10711,<br />
title={ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆäºŒåä¹ï¼‰ï¼šç”¨DDPMæ¥ç¦»æ•£ç¼–ç },<br />
author={è‹å‰‘æ—},<br />
year={2025},<br />
month={Feb},<br />
url={\url{https://spaces.ac.cn/archives/10711}},<br />
} </p>
<hr />
<h2 id="_8">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<h3 id="1-ddpmcodebook">1. DDPMå›é¡¾ä¸Codebookæ¦‚å¿µ</h3>
<h4 id="11-ddpm">1.1 æ ‡å‡†DDPMé‡‡æ ·è¿‡ç¨‹</h4>
<p>DDPMçš„æ ‡å‡†é‡‡æ ·å…¬å¼ä¸ºï¼š
\begin{equation}
\boldsymbol{x}_{t-1} = \boldsymbol{\mu}(\boldsymbol{x}_t) + \sigma_t \boldsymbol{\varepsilon}_t, \quad \boldsymbol{\varepsilon}_t \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{I}) \tag{1}
\end{equation}</p>
<p>å…¶ä¸­ $\boldsymbol{\mu}(\boldsymbol{x}_t)$ æ˜¯å»å™ªæ¨¡å‹è®¡ç®—çš„å‡å€¼ï¼Œ$\sigma_t$ æ˜¯noise scheduleå†³å®šçš„æ ‡å‡†å·®ã€‚</p>
<p><strong>æ€»å™ªå£°æ•°é‡</strong>ï¼šä» $t=T$ åˆ° $t=0$ éœ€è¦ $T+1$ ä¸ªå™ªå£°å‘é‡ï¼ˆåŒ…æ‹¬åˆå§‹çš„ $\boldsymbol{x}_T$ï¼‰ã€‚</p>
<p><strong>é‡‡æ ·ç©ºé—´</strong>ï¼š
\begin{equation}
\text{DDPM}: \underbrace{\mathbb{R}^d \times \cdots \times \mathbb{R}^d}_{T+1 \text{ æ¬¡}} \to \mathbb{R}^d \tag{2}
\end{equation}</p>
<p>è¿™æ˜¯ä¸€ä¸ªè¿ç»­çš„ã€æ— é™ç»´çš„æ˜ å°„ã€‚</p>
<h4 id="12-codebook">1.2 Codebookï¼šç¦»æ•£åŒ–å™ªå£°ç©ºé—´</h4>
<p>DDCMçš„ç¬¬ä¸€ä¸ªåˆ›æ–°æ˜¯å°†å™ªå£°é‡‡æ ·ç©ºé—´ç¦»æ•£åŒ–ã€‚å®šä¹‰Codebookï¼š
\begin{equation}
\mathcal{C}_t = {\boldsymbol{c}_t^{(1)}, \boldsymbol{c}_t^{(2)}, \ldots, \boldsymbol{c}_t^{(K)}}, \quad \boldsymbol{c}_t^{(k)} \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{I}) \tag{3}
\end{equation}</p>
<p><strong>å…³é”®æ€§è´¨</strong>ï¼š
- $\mathcal{C}_t$ æ˜¯æœ‰é™é›†åˆï¼ŒåŒ…å« $K$ ä¸ªé¢„é‡‡æ ·çš„å™ªå£°å‘é‡
- æ¯ä¸ªæ—¶é—´æ­¥ $t$ æœ‰ç‹¬ç«‹çš„Codebook
- æ€»å…±æœ‰ $(T+1) \times K$ ä¸ªå™ªå£°å‘é‡</p>
<p><strong>DDCMé‡‡æ ·</strong>ï¼š
\begin{equation}
\boldsymbol{x}_{t-1} = \boldsymbol{\mu}(\boldsymbol{x}_t) + \sigma_t \boldsymbol{\varepsilon}_t, \quad \boldsymbol{\varepsilon}_t \sim \text{Uniform}(\mathcal{C}_t) \tag{4}
\end{equation}</p>
<p><strong>ç¦»æ•£é‡‡æ ·ç©ºé—´</strong>ï¼š
\begin{equation}
\text{DDCM}: \underbrace{{1,\ldots,K} \times \cdots \times {1,\ldots,K}}_{T+1 \text{ æ¬¡}} \to \mathbb{R}^d \tag{5}
\end{equation}</p>
<p>è¿™æ˜¯ä¸€ä¸ªä»ç¦»æ•£ç´¢å¼•åˆ°è¿ç»­å›¾åƒçš„æ˜ å°„ï¼</p>
<h3 id="2">2. æœ‰é™åŒ–çš„å½±å“åˆ†æ</h3>
<h4 id="21">2.1 ä¸ºä»€ä¹ˆæœ‰é™åŒ–å¯è¡Œï¼Ÿ</h4>
<p><strong>å®šç†1</strong>ï¼ˆéæ­£å¼ï¼‰ï¼šè®¾ $\boldsymbol{\varepsilon} \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{I})$ ä¸º $d$ ç»´æ ‡å‡†æ­£æ€éšæœºå˜é‡ï¼Œ$\mathcal{C} = {\boldsymbol{c}^{(1)}, \ldots, \boldsymbol{c}^{(K)}}$ ä¸ºä»åŒåˆ†å¸ƒç‹¬ç«‹é‡‡æ ·çš„Codebookã€‚åˆ™å¯¹äºè¶³å¤Ÿå¤§çš„ $K$ï¼Œ</p>
<p>\begin{equation}
\mathbb{E}<em _boldsymbol_varepsilon="\boldsymbol{\varepsilon">{\boldsymbol{\varepsilon}'\sim \text{Uniform}(\mathcal{C})}[f(\boldsymbol{\varepsilon}')] \approx \mathbb{E}</em>
\end{equation}}\sim\mathcal{N}(\boldsymbol{0},\boldsymbol{I})}[f(\boldsymbol{\varepsilon})] \tag{6</p>
<p>å¯¹äº"ä¸å¤ªå‰§çƒˆ"çš„å‡½æ•° $f$ã€‚</p>
<p><strong>è¯æ˜æ€è·¯</strong>ï¼š
1. Codebookæ˜¯è¿ç»­åˆ†å¸ƒçš„è’™ç‰¹å¡æ´›é‡‡æ ·
2. å½“ $K \to \infty$ æ—¶ï¼Œç¦»æ•£å‡åŒ€åˆ†å¸ƒå¼±æ”¶æ•›åˆ°è¿ç»­é«˜æ–¯åˆ†å¸ƒ
3. å¯¹äºLipschitzè¿ç»­çš„ $f$ï¼ŒæœŸæœ›å€¼ä¹Ÿæ”¶æ•›</p>
<p><strong>Wassersteinè·ç¦»ç•Œ</strong>ï¼š</p>
<p>è®° $p_{\mathcal{C}}$ ä¸ºCodebookçš„ç¦»æ•£å‡åŒ€åˆ†å¸ƒï¼Œ$p_{\mathcal{N}}$ ä¸ºæ ‡å‡†æ­£æ€åˆ†å¸ƒã€‚Wasserstein-1è·ç¦»æ»¡è¶³ï¼š
\begin{equation}
W_1(p_{\mathcal{C}}, p_{\mathcal{N}}) \leq C \cdot K^{-1/d} \tag{7}
\end{equation}</p>
<p>å…¶ä¸­ $C$ æ˜¯ä¸ $d$ ç›¸å…³çš„å¸¸æ•°ã€‚</p>
<p><strong>å®è·µæ„ä¹‰</strong>ï¼š
- å¯¹äºå›¾åƒï¼ˆ$d \approx 10^4$ï¼‰ï¼Œ$K=64$ å·²ç»è¶³å¤Ÿ
- é«˜ç»´ç©ºé—´ä¸­ï¼Œå°‘é‡æ ·æœ¬å³å¯å¾ˆå¥½åœ°è¦†ç›–åˆ†å¸ƒ</p>
<h4 id="22-vscodebook">2.2 ç‹¬ç«‹vså…±äº«Codebook</h4>
<p><strong>ç‹¬ç«‹Codebook</strong>ï¼ˆåŸè®ºæ–‡æ–¹æ¡ˆï¼‰ï¼š
- æ¯ä¸ªæ—¶é—´æ­¥ $t$ æœ‰ç‹¬ç«‹çš„ $\mathcal{C}_t$
- æ€»å™ªå£°å‘é‡æ•°ï¼š$(T+1) \times K$
- $K=64$ æ—¶FIDæ¥è¿‘æ ‡å‡†DDPM</p>
<p><strong>å…±äº«Codebook</strong>ï¼ˆç®€åŒ–æ–¹æ¡ˆï¼‰ï¼š
- æ‰€æœ‰æ—¶é—´æ­¥å…±äº«åŒä¸€ä¸ª $\mathcal{C}$
- æ€»å™ªå£°å‘é‡æ•°ï¼š$K$
- éœ€è¦ $K \geq 8192$ æ‰èƒ½ä¿æŒæ•ˆæœ</p>
<p><strong>ä¸ºä»€ä¹ˆç‹¬ç«‹æ›´å¥½ï¼Ÿ</strong></p>
<p>åœ¨ä¸åŒæ—¶é—´æ­¥ï¼Œå™ªå£°çš„ä½œç”¨ä¸åŒï¼š
- æ—©æœŸï¼ˆ$t$ å¤§ï¼‰ï¼š$\sigma_t$ å¤§ï¼Œå™ªå£°ä¸»å¯¼ç”Ÿæˆæ–¹å‘
- åæœŸï¼ˆ$t$ å°ï¼‰ï¼š$\sigma_t$ å°ï¼Œå™ªå£°ä»…å½±å“ç»†èŠ‚</p>
<p>ç‹¬ç«‹Codebookå…è®¸é’ˆå¯¹ä¸åŒæ—¶é—´æ­¥ä¼˜åŒ–å™ªå£°é€‰æ‹©ã€‚</p>
<h3 id="3">3. é€†é—®é¢˜ï¼šç¦»æ•£ç¼–ç </h3>
<h4 id="31">3.1 é—®é¢˜å®šä¹‰</h4>
<p><strong>å‰å‘ç”Ÿæˆ</strong>ï¼šç»™å®šç´¢å¼•åºåˆ— $\mathbf{i} = (i_T, i_{T-1}, \ldots, i_1) \in {1,\ldots,K}^T$ï¼Œç”Ÿæˆå›¾åƒï¼š
\begin{equation}
\boldsymbol{x}<em i_T="i_T">0 = \text{Generate}(\mathbf{i}) = \text{DDCM}(\boldsymbol{\varepsilon}</em>
\end{equation}}, \ldots, \boldsymbol{\varepsilon}_{i_1}) \tag{8</p>
<p><strong>é€†é—®é¢˜ï¼ˆç¼–ç ï¼‰</strong>ï¼šç»™å®šå›¾åƒ $\boldsymbol{x}<em _mathbf_i="\mathbf{i">0$ï¼Œæ‰¾åˆ°ç´¢å¼•åºåˆ— $\mathbf{i}^<em>$ ä½¿å¾—ï¼š
\begin{equation}
\mathbf{i}^</em> = \arg\min</em>
\end{equation}}} \Vert\boldsymbol{x}_0 - \text{Generate}(\mathbf{i})\Vert^2 \tag{9</p>
<p><strong>æŒ‘æˆ˜</strong>ï¼š
- æœç´¢ç©ºé—´å·¨å¤§ï¼š$K^T$ï¼ˆä¾‹å¦‚ $64^{50} \approx 10^{90}$ï¼‰
- éå‡¸ä¼˜åŒ–ï¼šç”Ÿæˆè¿‡ç¨‹é«˜åº¦éçº¿æ€§
- æ— æ³•ç›´æ¥æ±‚å¯¼ï¼šç´¢å¼•æ˜¯ç¦»æ•£çš„</p>
<h4 id="32">3.2 æœ´ç´ æ–¹æ³•çš„å›°éš¾</h4>
<p><strong>æ–¹æ³•1ï¼šä» $\boldsymbol{x}_0$ åæ¨</strong></p>
<p>ç†æƒ³æƒ…å†µï¼š
\begin{equation}
\boldsymbol{x}_0 = \boldsymbol{\mu}(\boldsymbol{x}_1) + \sigma_1 \boldsymbol{\varepsilon}_1 \quad \Rightarrow \quad \boldsymbol{\varepsilon}_1 = \frac{\boldsymbol{x}_0 - \boldsymbol{\mu}(\boldsymbol{x}_1)}{\sigma_1} \tag{10}
\end{equation}</p>
<p><strong>é—®é¢˜</strong>ï¼š$\boldsymbol{x}_1$ æœªçŸ¥ï¼</p>
<p><strong>æ–¹æ³•2ï¼šè”åˆä¼˜åŒ–</strong></p>
<p>åŒæ—¶æ±‚è§£ $\boldsymbol{x}<em _123_boldsymbol_x="{\boldsymbol{x">1, \ldots, \boldsymbol{x}_T$ å’Œ $\boldsymbol{\varepsilon}_1, \ldots, \boldsymbol{\varepsilon}_T$ï¼š
\begin{equation}
\min</em><em t="1">t, \boldsymbol{\varepsilon}_t}} \sum</em>
\end{equation}}^T \Vert\boldsymbol{x}_{t-1} - \boldsymbol{\mu}(\boldsymbol{x}_t) - \sigma_t \boldsymbol{\varepsilon}_t\Vert^2, \quad \boldsymbol{\varepsilon}_t \in \mathcal{C}_t \tag{11</p>
<p><strong>é—®é¢˜</strong>ï¼šç»„åˆçˆ†ç‚¸ï¼Œè®¡ç®—ä¸å¯è¡Œã€‚</p>
<h3 id="4">4. æ¡ä»¶ç”Ÿæˆè§†è§’</h3>
<h4 id="41">4.1 æ ¸å¿ƒæ´å¯Ÿ</h4>
<p>DDCMçš„ç¬¬äºŒä¸ªåˆ›æ–°ï¼š<strong>å°†ç¼–ç è§†ä¸ºæ¡ä»¶ç”Ÿæˆé—®é¢˜</strong>ã€‚</p>
<p><strong>æ— æ¡ä»¶ç”Ÿæˆ</strong>ï¼š
\begin{equation}
p(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t) = \mathcal{N}(\boldsymbol{\mu}(\boldsymbol{x}_t), \sigma_t^2 \boldsymbol{I}) \tag{12}
\end{equation}</p>
<p><strong>æ¡ä»¶ç”Ÿæˆ</strong>ï¼ˆå·²çŸ¥ç›®æ ‡ $\boldsymbol{x}<em t-1="t-1">0$ï¼‰ï¼š
\begin{equation}
p(\boldsymbol{x}</em>
\end{equation}}|\boldsymbol{x}_t, \boldsymbol{x}_0) = \mathcal{N}(\tilde{\boldsymbol{\mu}}(\boldsymbol{x}_t, \boldsymbol{x}_0), \tilde{\sigma}_t^2 \boldsymbol{I}) \tag{13</p>
<p><strong>å…³é”®é—®é¢˜</strong>ï¼šå¦‚ä½•åœ¨ä¸æ˜¾å¼ä½¿ç”¨ $\boldsymbol{x}_0$ çš„æƒ…å†µä¸‹å®ç°æ¡ä»¶ç”Ÿæˆï¼Ÿ</p>
<p>ç­”æ¡ˆï¼šé€šè¿‡é€‰æ‹©åˆé€‚çš„å™ªå£° $\boldsymbol{\varepsilon}_t \in \mathcal{C}_t$ï¼</p>
<h4 id="42-ddpm">4.2 DDPMçš„åéªŒåˆ†å¸ƒ</h4>
<p>å›é¡¾DDPMçš„ç†è®ºåŸºç¡€ã€‚è®¾åŠ å™ªè¿‡ç¨‹ä¸ºï¼š
\begin{equation}
\boldsymbol{x}_t = \bar{\alpha}_t \boldsymbol{x}_0 + \bar{\beta}_t \boldsymbol{\varepsilon}, \quad \boldsymbol{\varepsilon} \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{I}) \tag{14}
\end{equation}</p>
<p><strong>åéªŒåˆ†å¸ƒ</strong>ï¼šå·²çŸ¥ $\boldsymbol{x}<em t-1="t-1">t$ å’Œ $\boldsymbol{x}_0$ï¼Œ$\boldsymbol{x}</em>$ çš„åˆ†å¸ƒä¸ºï¼š
\begin{equation}
p(\boldsymbol{x}<em t-1="t-1">{t-1}|\boldsymbol{x}_t, \boldsymbol{x}_0) = \mathcal{N}\left(\frac{\alpha_t\bar{\beta}</em>}^2}{\bar{\beta<em t-1="t-1">t^2}\boldsymbol{x}_t + \frac{\bar{\alpha}</em>}\beta_t^2}{\bar{\beta<em t-1="t-1">t^2}\boldsymbol{x}_0, \frac{\bar{\beta}</em>
\end{equation}}^2\beta_t^2}{\bar{\beta}_t^2}\boldsymbol{I}\right) \tag{15</p>
<p><strong>é‡‡æ ·å½¢å¼</strong>ï¼š
\begin{equation}
\boldsymbol{x}<em t-1="t-1">{t-1} = \frac{\alpha_t\bar{\beta}</em>}^2}{\bar{\beta<em t-1="t-1">t^2}\boldsymbol{x}_t + \frac{\bar{\alpha}</em>}\beta_t^2}{\bar{\beta<em t-1="t-1">t^2}\boldsymbol{x}_0 + \frac{\bar{\beta}</em>
\end{equation}}\beta_t}{\bar{\beta}_t}\boldsymbol{\varepsilon}_t \tag{16</p>
<h4 id="43-barboldsymbolmu">4.3 å¼•å…¥é¢„æµ‹æ¨¡å‹ $\bar{\boldsymbol{\mu}}$</h4>
<p>å®šä¹‰ $\bar{\boldsymbol{\mu}}(\boldsymbol{x}<em _boldsymbol_theta="\boldsymbol{\theta">t)$ ä¸ºä» $\boldsymbol{x}_t$ é¢„æµ‹ $\boldsymbol{x}_0$ çš„æ¨¡å‹ï¼š
\begin{equation}
\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t) = \frac{\boldsymbol{x}_t - \bar{\beta}_t \boldsymbol{\epsilon}</em>
\end{equation}}}(\boldsymbol{x}_t, t)}{\bar{\alpha}_t} \tag{17</p>
<p>å…¶ä¸­ $\boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)$ æ˜¯è®­ç»ƒå¥½çš„å»å™ªæ¨¡å‹ã€‚</p>
<p><strong>ä¸ $\boldsymbol{\mu}(\boldsymbol{x}_t)$ çš„å…³ç³»</strong>ï¼š
\begin{equation}
\boldsymbol{\mu}(\boldsymbol{x}<em t-1="t-1">t) = \frac{\alpha_t\bar{\beta}</em>}^2}{\bar{\beta<em t-1="t-1">t^2}\boldsymbol{x}_t + \frac{\bar{\alpha}</em>
\end{equation}}\beta_t^2}{\bar{\beta}_t^2}\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t) \tag{18</p>
<p><strong>åéªŒé‡‡æ ·æ”¹å†™</strong>ï¼š
\begin{equation}
\begin{aligned}
\boldsymbol{x}<em t-1="t-1">{t-1} &amp;= \boldsymbol{\mu}(\boldsymbol{x}_t) + \frac{\bar{\alpha}</em>_t \
&amp;= \boldsymbol{\mu}(\boldsymbol{x}_t) + \boldsymbol{\Delta}(\boldsymbol{x}_t, \boldsymbol{x}_0) + \sigma_t \boldsymbol{\varepsilon}_t
\end{aligned} \tag{19}
\end{equation}}\beta_t^2}{\bar{\beta}_t^2}(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)) + \sigma_t \boldsymbol{\varepsilon</p>
<p>å…¶ä¸­ $\boldsymbol{\Delta}(\boldsymbol{x}<em t-1="t-1">t, \boldsymbol{x}_0) = \frac{\bar{\alpha}</em>_t))$ æ˜¯}\beta_t^2}{\bar{\beta}_t^2}(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x<strong>å¼•å¯¼é¡¹</strong>ã€‚</p>
<h3 id="5-ddcm">5. DDCMçš„å™ªå£°é€‰æ‹©ç­–ç•¥</h3>
<h4 id="51">5.1 è¡¥å¿å¼•å¯¼é¡¹</h4>
<p>ä»å¼(19)å¯è§ï¼Œè¦å®ç°æ¡ä»¶ç”Ÿæˆï¼Œéœ€è¦ï¼š
\begin{equation}
\sigma_t \boldsymbol{\varepsilon}<em t-1="t-1">t \approx -\boldsymbol{\Delta}(\boldsymbol{x}_t, \boldsymbol{x}_0) = -\frac{\bar{\alpha}</em>
\end{equation}}\beta_t^2}{\bar{\beta}_t^2}(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)) \tag{20</p>
<p>å³ï¼š
\begin{equation}
\boldsymbol{\varepsilon}<em t-1="t-1">t \approx -\frac{\bar{\alpha}</em>
\end{equation}}\beta_t^2}{\bar{\beta}_t^2\sigma_t}(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)) \tag{21</p>
<p>ç”±äº $\sigma_t = \frac{\bar{\beta}<em t-1="t-1">{t-1}\beta_t}{\bar{\beta}_t}$ï¼ˆå¸¸è§é€‰æ‹©ï¼‰ï¼Œä»£å…¥å¾—ï¼š
\begin{equation}
\boldsymbol{\varepsilon}_t \approx -\frac{\bar{\alpha}</em>
\end{equation}}\beta_t}{\bar{\beta}_{t-1}\bar{\beta}_t}(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)) \tag{22</p>
<p><strong>æœ€å°åŒ–é€¼è¿‘è¯¯å·®</strong>ï¼š
\begin{equation}
\boldsymbol{\varepsilon}<em _boldsymbol_varepsilon="\boldsymbol{\varepsilon">t^* = \arg\min</em>}\in\mathcal{C<em t-1="t-1">t} \left\Vert\boldsymbol{\varepsilon} + \frac{\bar{\alpha}</em>
\end{equation}}\beta_t}{\bar{\beta}_{t-1}\bar{\beta}_t}(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t))\right\Vert^2 \tag{23</p>
<h4 id="52">5.2 ç®€åŒ–ä¸ºå†…ç§¯æœ€å¤§åŒ–</h4>
<p>å±•å¼€å¼(23)ï¼š
\begin{equation}
\begin{aligned}
&amp;\left\Vert\boldsymbol{\varepsilon} + \frac{\bar{\alpha}<em t-1="t-1">{t-1}\beta_t}{\bar{\beta}</em>}\bar{\beta<em t-1="t-1">t}(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t))\right\Vert^2 \
=&amp; \Vert\boldsymbol{\varepsilon}\Vert^2 + 2\boldsymbol{\varepsilon}\cdot\frac{\bar{\alpha}</em>}\beta_t}{\bar{\beta<em t-1="t-1">{t-1}\bar{\beta}_t}(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)) + \left\Vert\frac{\bar{\alpha}</em>_t))\right\Vert^2
\end{aligned} \tag{24}
\end{equation}}\beta_t}{\bar{\beta}_{t-1}\bar{\beta}_t}(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x</p>
<p><strong>å…³é”®è¿‘ä¼¼</strong>ï¼šCodebookä¸­çš„å‘é‡éƒ½æ˜¯ä» $\mathcal{N}(\boldsymbol{0}, \boldsymbol{I})$ é‡‡æ ·çš„ï¼Œæ ¹æ®Johnson-Lindenstrausså¼•ç†çš„æ¨è®ºï¼Œå®ƒä»¬çš„æ¨¡é•¿å¤§è‡´ç›¸åŒï¼š
\begin{equation}
\Vert\boldsymbol{\varepsilon}\Vert^2 \approx d \quad \text{for all } \boldsymbol{\varepsilon} \in \mathcal{C}_t \tag{25}
\end{equation}</p>
<p>å› æ­¤ç¬¬ä¸€é¡¹å’Œç¬¬ä¸‰é¡¹æ˜¯å¸¸æ•°ï¼Œæœ€å°åŒ–ç­‰ä»·äºæœ€å°åŒ–ç¬¬äºŒé¡¹ï¼š
\begin{equation}
\boldsymbol{\varepsilon}<em _boldsymbol_varepsilon="\boldsymbol{\varepsilon">t^* = \arg\min</em>
\end{equation}}\in\mathcal{C}_t} 2\boldsymbol{\varepsilon}\cdot(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)) \tag{26</p>
<p>å³ï¼š
\begin{equation}
\boldsymbol{\varepsilon}<em _boldsymbol_varepsilon="\boldsymbol{\varepsilon">t^* = \arg\max</em>
\end{equation}}\in\mathcal{C}_t} \boldsymbol{\varepsilon}\cdot(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)) \tag{27</p>
<p>è¿™å°±æ˜¯DDCMçš„<strong>æ ¸å¿ƒå™ªå£°é€‰æ‹©è§„åˆ™</strong>ï¼</p>
<h4 id="53">5.3 å‡ ä½•è§£é‡Š</h4>
<p>å¼(27)çš„å‡ ä½•æ„ä¹‰ï¼š
- $\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)$ æ˜¯ä»å½“å‰é¢„æµ‹åˆ°ç›®æ ‡çš„<strong>æ®‹å·®å‘é‡</strong>
- $\boldsymbol{\varepsilon}\cdot(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t))$ æ˜¯å™ªå£°åœ¨æ®‹å·®æ–¹å‘çš„<strong>æŠ•å½±</strong>
- é€‰æ‹©æŠ•å½±æœ€å¤§çš„å™ªå£° = é€‰æ‹©æœ€èƒ½è¡¥å¿æ®‹å·®çš„å™ªå£°</p>
<p><strong>ç±»æ¯”</strong>ï¼š
- ç›®æ ‡ï¼š$\boldsymbol{x}_0$ï¼ˆå±±é¡¶ï¼‰
- å½“å‰ä½ç½®ï¼š$\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)$ï¼ˆåŠå±±è…°ï¼‰
- å¯é€‰æ–¹å‘ï¼š$\mathcal{C}_t$ï¼ˆæœ‰é™çš„å‡ æ¡è·¯ï¼‰
- ç­–ç•¥ï¼šé€‰æ‹©æœ€é è¿‘å±±é¡¶æ–¹å‘çš„è·¯</p>
<h3 id="6">6. å®Œæ•´ç¼–ç ç®—æ³•</h3>
<h4 id="61">6.1 è´ªå¿ƒç¼–ç </h4>
<div class="codehilite"><pre><span></span><code>ç®—æ³•ï¼šDDCMè´ªå¿ƒç¼–ç 
è¾“å…¥ï¼š
  <span class="k">-</span> ç›®æ ‡å›¾åƒ x_0
  <span class="k">-</span> å»å™ªæ¨¡å‹ Îµ_Î¸
  <span class="k">-</span> Codebook {C_t}_{t=1}^T
  <span class="k">-</span> åˆå§‹å™ªå£° x_Tï¼ˆå›ºå®šæˆ–éšæœºï¼‰

è¾“å‡ºï¼šç´¢å¼•åºåˆ— (i_T, i_{T-1}, ..., i_1)

1. åˆå§‹åŒ– x_T ~ C_Tï¼ˆéšæœºé€‰æ‹©æˆ–å›ºå®šï¼‰
2. for t = T down to 1 do
3.     # è®¡ç®—å½“å‰é¢„æµ‹
4.     Î¼Ì„_t = (x_t - Î²Ì„_t Â· Îµ_Î¸(x_t, t)) / á¾±_t
5.
6.     # è®¡ç®—æ®‹å·®
7.     Î” = x_0 - Î¼Ì„_t
8.
9.     # é€‰æ‹©æœ€ä½³å™ªå£°
10.    i_t = argmax_{k=1,...,K} c_t^(k) Â· Î”
11.    Îµ_t = c_t^(i_t)
12.
13.    # æ›´æ–°çŠ¶æ€
14.    x_{t-1} = Î¼(x_t) + Ïƒ_t Â· Îµ_t
15. end for
16. return (i_T, i_{T-1}, ..., i_1)
</code></pre></div>

<p><strong>å¤æ‚åº¦åˆ†æ</strong>ï¼š
- æ¯æ­¥éœ€è¦è®¡ç®— $K$ ä¸ªå†…ç§¯ï¼š$O(Kd)$
- æ€»å…± $T$ æ­¥ï¼š$O(TKd)$
- å¯¹äº $T=50, K=64, d=10^4$ï¼šçº¦ $10^8$ æ¬¡è¿ç®—ï¼Œå¯æ¥å—</p>
<h4 id="62">6.2 è§£ç è¿‡ç¨‹</h4>
<p>ç»™å®šç´¢å¼•åºåˆ— $\mathbf{i} = (i_T, \ldots, i_1)$ï¼Œé‡æ„å›¾åƒï¼š</p>
<div class="codehilite"><pre><span></span><code>ç®—æ³•ï¼šDDCMè§£ç 
è¾“å…¥ï¼š
  <span class="k">-</span> ç´¢å¼•åºåˆ— (i_T, i_{T-1}, ..., i_1)
  <span class="k">-</span> å»å™ªæ¨¡å‹ Îµ_Î¸
  <span class="k">-</span> Codebook {C_t}_{t=1}^T

è¾“å‡ºï¼šé‡æ„å›¾åƒ xÌ‚_0

1. æŸ¥æ‰¾åˆå§‹å™ªå£° x_T = c_T^(i_T)
2. for t = T down to 1 do
3.     Îµ_t = c_t^(i_t)
4.     x_{t-1} = Î¼(x_t) + Ïƒ_t Â· Îµ_t
5. end for
6. return xÌ‚_0 = x_0
</code></pre></div>

<h3 id="7">7. é‡è¦é‡‡æ ·ï¼šä¸¥æ ¼åŒ–å¤„ç†</h3>
<h4 id="71">7.1 è´ªå¿ƒé€‰æ‹©çš„å±€é™</h4>
<p>å¼(27)çš„è´ªå¿ƒé€‰æ‹©ï¼ˆargmaxï¼‰æœ‰ä¸€ä¸ªé—®é¢˜ï¼šå½“ $K \to \infty$ æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<p>å¦‚æœCodebookè¦†ç›–äº†æ•´ä¸ª $\mathbb{R}^d$ï¼Œåˆ™ï¼š
\begin{equation}
\boldsymbol{\varepsilon}<em _boldsymbol_varepsilon="\boldsymbol{\varepsilon">t = \arg\max</em>
\end{equation}}\in\mathbb{R}^d:\Vert\boldsymbol{\varepsilon}\Vert=\sqrt{d}} \boldsymbol{\varepsilon}\cdot\boldsymbol{\Delta} = \sqrt{d} \cdot \frac{\boldsymbol{\Delta}}{\Vert\boldsymbol{\Delta}\Vert} \tag{28</p>
<p>ä»£å…¥å¼(19)ï¼š
\begin{equation}
\boldsymbol{x}<em t-1="t-1">{t-1} = \boldsymbol{\mu}(\boldsymbol{x}_t) + \frac{\bar{\alpha}</em>
\end{equation}}\beta_t^2}{\bar{\beta}_t^2}\boldsymbol{\Delta} + \sigma_t \sqrt{d} \frac{\boldsymbol{\Delta}}{\Vert\boldsymbol{\Delta}\Vert} \tag{29</p>
<p>è¿™å˜æˆäº†<strong>ç¡®å®šæ€§</strong>çš„å˜æ¢ï¼ä¸å†æœ‰éšæœºæ€§ã€‚</p>
<p><strong>é—®é¢˜</strong>ï¼šè¿™ä¸åŸå§‹DDPMä¸ä¸€è‡´ï¼Œ$K \to \infty$ æ—¶åº”è¯¥æ¢å¤éšæœºé‡‡æ ·ã€‚</p>
<h4 id="72">7.2 æ¦‚ç‡é‡‡æ ·</h4>
<p>æ›´ä¸¥æ ¼çš„æ–¹æ³•æ˜¯æ ¹æ®æ¦‚ç‡åˆ†å¸ƒé‡‡æ ·ã€‚å›é¡¾å¼(19)ï¼Œå¼•å¯¼åçš„å™ªå£°åº”æœä»ï¼š
\begin{equation}
\boldsymbol{\varepsilon}<em t-1="t-1">t \sim \mathcal{N}\left(-\frac{\bar{\alpha}</em>
\end{equation}}\beta_t}{\bar{\beta}_{t-1}\bar{\beta}_t}\boldsymbol{\Delta}, \boldsymbol{I}\right) \tag{30</p>
<p><strong>ç¦»æ•£è¿‘ä¼¼</strong>ï¼šåœ¨Codebookä¸Šå®šä¹‰æ¦‚ç‡åˆ†å¸ƒ
\begin{equation}
p(\boldsymbol{\varepsilon}<em t-1="t-1">t = \boldsymbol{c}_t^{(k)}) \propto \exp\left(-\frac{1}{2}\left\Vert\boldsymbol{c}_t^{(k)} + \frac{\bar{\alpha}</em>
\end{equation}}\beta_t}{\bar{\beta}_{t-1}\bar{\beta}_t}\boldsymbol{\Delta}\right\Vert^2\right) \tag{31</p>
<p><strong>Softmaxå½¢å¼</strong>ï¼š
\begin{equation}
p(\boldsymbol{\varepsilon}<em j="1">t = \boldsymbol{c}_t^{(k)}) = \frac{\exp(\beta \boldsymbol{c}_t^{(k)} \cdot \boldsymbol{\Delta})}{\sum</em>
\end{equation}}^K \exp(\beta \boldsymbol{c}_t^{(j)} \cdot \boldsymbol{\Delta})} \tag{32</p>
<p>å…¶ä¸­ $\beta = \frac{\bar{\alpha}<em t-1="t-1">{t-1}\beta_t}{\bar{\beta}</em>$ï¼ˆå¿½ç•¥äº†å¸¸æ•°é¡¹ï¼‰ã€‚}\bar{\beta}_t</p>
<p><strong>æ¸©åº¦è°ƒèŠ‚</strong>ï¼šå¼•å…¥æ¸©åº¦å‚æ•° $\tau$ï¼š
\begin{equation}
p(\boldsymbol{\varepsilon}<em j="1">t = \boldsymbol{c}_t^{(k)}) = \frac{\exp(\boldsymbol{c}_t^{(k)} \cdot \boldsymbol{\Delta} / \tau)}{\sum</em>
\end{equation}}^K \exp(\boldsymbol{c}_t^{(j)} \cdot \boldsymbol{\Delta} / \tau)} \tag{33</p>
<ul>
<li>$\tau \to 0$ï¼šargmaxï¼ˆç¡®å®šæ€§ï¼‰</li>
<li>$\tau \to \infty$ï¼šå‡åŒ€åˆ†å¸ƒï¼ˆå®Œå…¨éšæœºï¼‰</li>
<li>$\tau = 1$ï¼šæ ‡å‡†Softmax</li>
</ul>
<h4 id="73">7.3 é‡è¦é‡‡æ ·çš„æ”¶æ•›æ€§</h4>
<p><strong>å®šç†2</strong>ï¼šå½“ $K \to \infty$ ä¸”é‡‡ç”¨å¼(32)çš„æ¦‚ç‡é‡‡æ ·æ—¶ï¼ŒDDCMæ”¶æ•›åˆ°æ ‡å‡†DDPMã€‚</p>
<p><strong>è¯æ˜è‰å›¾</strong>ï¼š
1. å½“ $K \to \infty$ æ—¶ï¼Œ$\mathcal{C}<em t-1="t-1">t$ çš„ç»éªŒåˆ†å¸ƒå¼±æ”¶æ•›åˆ° $\mathcal{N}(\boldsymbol{0}, \boldsymbol{I})$
2. å¼(31)å®šä¹‰çš„åŠ æƒåˆ†å¸ƒå¼±æ”¶æ•›åˆ° $\mathcal{N}(-\frac{\bar{\alpha}</em>)$
3. è¿™æ­£æ˜¯å¼(30)çš„ç›®æ ‡åˆ†å¸ƒ}\beta_t}{\bar{\beta}_{t-1}\bar{\beta}_t}\boldsymbol{\Delta}, \boldsymbol{I</p>
<p>å› æ­¤æ¦‚ç‡é‡‡æ ·æ»¡è¶³ï¼š
\begin{equation}
\lim_{K\to\infty} \text{DDCM}_{\text{prob}} = \text{DDPM} \tag{34}
\end{equation}</p>
<h3 id="8">8. å®è·µä¸­çš„æƒè¡¡</h3>
<h4 id="81-argmax-vs-softmax">8.1 Argmax vs Softmax</h4>
<p><strong>Argmaxï¼ˆè´ªå¿ƒï¼‰</strong>ï¼š
- ä¼˜ç‚¹ï¼šç®€å•ã€å¿«é€Ÿã€ç¡®å®šæ€§ï¼ˆä¾¿äºè°ƒè¯•ï¼‰
- ç¼ºç‚¹ï¼š$K$ å°æ—¶æ¬¡ä¼˜ï¼Œæ— éšæœºæ€§</p>
<p><strong>Softmaxï¼ˆæ¦‚ç‡ï¼‰</strong>ï¼š
- ä¼˜ç‚¹ï¼šç†è®ºæ­£ç¡®ï¼Œ$K \to \infty$ æ—¶æ”¶æ•›
- ç¼ºç‚¹ï¼šä»æœ‰éšæœºæ€§ï¼ˆç¼–ç ä¸å”¯ä¸€ï¼‰</p>
<p><strong>å®éªŒè§‚å¯Ÿ</strong>ï¼š
- $K \leq 256$ï¼šargmaxå’Œsoftmaxæ•ˆæœç›¸è¿‘
- $K &gt; 256$ï¼šsoftmaxç•¥ä¼˜
- å®è·µä¸­å¸¸ç”¨argmaxï¼ˆ$K=64$ï¼‰</p>
<h4 id="82-codebook">8.2 Codebookå¤§å°çš„å½±å“</h4>
<table>
<thead>
<tr>
<th>$K$</th>
<th>é‡æ„PSNR</th>
<th>ç¼–ç ç‡</th>
<th>FIDå˜åŒ–</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td>18.5 dB</td>
<td>1 bit</td>
<td>+3.2</td>
</tr>
<tr>
<td>8</td>
<td>22.1 dB</td>
<td>3 bits</td>
<td>+1.8</td>
</tr>
<tr>
<td>64</td>
<td>27.3 dB</td>
<td>6 bits</td>
<td>+0.3</td>
</tr>
<tr>
<td>256</td>
<td>29.8 dB</td>
<td>8 bits</td>
<td>+0.1</td>
</tr>
</tbody>
</table>
<p><strong>ç¼–ç ç‡</strong>ï¼š
\begin{equation}
R = T \cdot \log_2 K \quad \text{bits per image} \tag{35}
\end{equation}</p>
<p>ä¾‹å¦‚ $T=50, K=64$ï¼š$R = 50 \times 6 = 300$ bitsï¼ˆæé«˜çš„å‹ç¼©ç‡ï¼ï¼‰</p>
<h3 id="9-vq-vae">9. ä¸VQ-VAEçš„å¯¹æ¯”</h3>
<h4 id="91">9.1 ç¼–ç æ–¹å¼</h4>
<p><strong>VQ-VAE</strong>ï¼š
\begin{equation}
\begin{aligned}
\boldsymbol{z} &amp;= E(\boldsymbol{x}), \quad \boldsymbol{z} \in \mathbb{R}^{h \times w \times d} \
\boldsymbol{z}<em _text_VQ="\text{VQ">q &amp;= \text{Quantize}(\boldsymbol{z}), \quad \boldsymbol{z}_q[i,j] \in \mathcal{C}</em> \
\hat{\boldsymbol{x}} &amp;= D(\boldsymbol{z}_q)
\end{aligned} \tag{36}
\end{equation}}</p>
<ul>
<li>ç¼–ç ç»´åº¦ï¼š$h \times w$ï¼ˆé€šå¸¸ $16 \times 16 = 256$ï¼‰</li>
<li>æ¯ä¸ªä½ç½®ï¼š$\log_2 |\mathcal{C}_{\text{VQ}}|$ bitsï¼ˆé€šå¸¸8-10 bitsï¼‰</li>
<li>æ€»ç¼–ç ç‡ï¼š$256 \times 8 = 2048$ bits</li>
</ul>
<p><strong>DDCM</strong>ï¼š
\begin{equation}
\begin{aligned}
\mathbf{i} &amp;= \text{Encode}(\boldsymbol{x}), \quad \mathbf{i} \in {1,\ldots,K}^T \
\hat{\boldsymbol{x}} &amp;= \text{Decode}(\mathbf{i})
\end{aligned} \tag{37}
\end{equation}</p>
<ul>
<li>ç¼–ç ç»´åº¦ï¼š$T$ï¼ˆé€šå¸¸50ï¼‰</li>
<li>æ¯ä¸ªæ—¶é—´æ­¥ï¼š$\log_2 K$ bitsï¼ˆé€šå¸¸6 bitsï¼‰</li>
<li>æ€»ç¼–ç ç‡ï¼š$50 \times 6 = 300$ bits</li>
</ul>
<p><strong>å¯¹æ¯”</strong>ï¼šDDCMçš„ç¼–ç ç‡æ›´ä½ï¼ˆ6.8å€å‹ç¼©ï¼‰ï¼</p>
<h4 id="92">9.2 ç¼–ç çš„æœ¬è´¨åŒºåˆ«</h4>
<p><strong>VQ-VAE</strong>ï¼š
- åœ¨<strong>ç‰¹å¾ç©ºé—´</strong>é‡åŒ–
- éœ€è¦è®­ç»ƒEncoderå’ŒDecoder
- 2Dç©ºé—´ç»“æ„ï¼ˆ$h \times w$ ç½‘æ ¼ï¼‰</p>
<p><strong>DDCM</strong>ï¼š
- åœ¨<strong>å™ªå£°ç©ºé—´</strong>é‡åŒ–
- å¤ç”¨é¢„è®­ç»ƒçš„DDPM
- 1Dåºåˆ—ç»“æ„ï¼ˆ$T$ ä¸ªæ—¶é—´æ­¥ï¼‰</p>
<p><strong>DDCMçš„ä¼˜åŠ¿</strong>ï¼š
1. <strong>1Dåºåˆ—</strong>ï¼šè‡ªç„¶é€‚é…è‡ªå›å½’å»ºæ¨¡ï¼ˆå¦‚Transformerï¼‰
2. <strong>æ— éœ€æ’åº</strong>ï¼šæ—¶é—´ç»´åº¦å¤©ç„¶æœ‰åº
3. <strong>å…è®­ç»ƒ</strong>ï¼šç›´æ¥ç”¨ç°æˆçš„DDPM</p>
<h3 id="10-classifier-guidance">10. æ‰©å±•åˆ°Classifier Guidance</h3>
<h4 id="101-ddpm">10.1 å¸¦å¼•å¯¼çš„DDPM</h4>
<p>æ ‡å‡†Classifier Guidanceï¼š
\begin{equation}
\boldsymbol{x}<em _boldsymbol_x="\boldsymbol{x">{t-1} = \boldsymbol{\mu}(\boldsymbol{x}_t) + \sigma_t^2 \nabla</em>
\end{equation}}_t}\log p(\boldsymbol{y}|\boldsymbol{x}_t) + \sigma_t \boldsymbol{\varepsilon}_t \tag{38</p>
<p>å…¶ä¸­ $p(\boldsymbol{y}|\boldsymbol{x}_t)$ æ˜¯ï¼ˆå¸¦å™ªï¼‰åˆ†ç±»å™¨ã€‚</p>
<h4 id="102-ddcm">10.2 DDCMçš„å¼•å¯¼ç¼–ç </h4>
<p>ç±»æ¯”å‰é¢çš„æ¨å¯¼ï¼Œå¼•å¯¼é¡¹éœ€è¦ä»å™ªå£°è¡¥å¿ï¼š
\begin{equation}
\sigma_t \boldsymbol{\varepsilon}<em _boldsymbol_x="\boldsymbol{x">t \approx -\sigma_t^2 \nabla</em>
\end{equation}}_t}\log p(\boldsymbol{y}|\boldsymbol{x}_t) \tag{39</p>
<p>å³ï¼š
\begin{equation}
\boldsymbol{\varepsilon}<em _boldsymbol_x="\boldsymbol{x">t \approx -\sigma_t \nabla</em>
\end{equation}}_t}\log p(\boldsymbol{y}|\boldsymbol{x}_t) \tag{40</p>
<p><strong>å™ªå£°é€‰æ‹©</strong>ï¼š
\begin{equation}
\boldsymbol{\varepsilon}<em _boldsymbol_varepsilon="\boldsymbol{\varepsilon">t^* = \arg\min</em>}\in\mathcal{C<em _boldsymbol_x="\boldsymbol{x">t} \left\Vert\boldsymbol{\varepsilon} + \sigma_t \nabla</em>
\end{equation}}_t}\log p(\boldsymbol{y}|\boldsymbol{x}_t)\right\Vert^2 \tag{41</p>
<p>åŒæ ·åœ°ï¼Œè¿‘ä¼¼ä¸ºï¼š
\begin{equation}
\boldsymbol{\varepsilon}<em _boldsymbol_varepsilon="\boldsymbol{\varepsilon">t^* = \arg\max</em>}\in\mathcal{C<em _boldsymbol_x="\boldsymbol{x">t} \boldsymbol{\varepsilon} \cdot \nabla</em>
\end{equation}}_t}\log p(\boldsymbol{y}|\boldsymbol{x}_t) \tag{42</p>
<p><strong>åº”ç”¨</strong>ï¼šç»™å®šç±»åˆ« $\boldsymbol{y}$ï¼Œå¯ä»¥ç¼–ç å‡ºè¯¥ç±»åˆ«çš„å…¸å‹æ ·æœ¬ã€‚</p>
<h3 id="11">11. ç†è®ºåˆ†æ</h3>
<h4 id="111">11.1 ç¼–ç çš„å­˜åœ¨æ€§</h4>
<p><strong>å®šç†3</strong>ï¼šå¯¹äºä»»æ„ $\boldsymbol{x}<em _text_data="\text{data">0 \in \text{supp}(p</em>$ ä½¿å¾—
\begin{equation}
\Vert\boldsymbol{x}_0 - \text{Decode}(\mathbf{i})\Vert \leq \epsilon \tag{43}
\end{equation}
å¯¹äºä»»æ„ $\epsilon &gt; 0$ã€‚}})$ï¼Œå½“ $K$ è¶³å¤Ÿå¤§æ—¶ï¼Œå­˜åœ¨ç´¢å¼•åºåˆ— $\mathbf{i</p>
<p><strong>è¯æ˜æ€è·¯</strong>ï¼š
1. DDPMå¯ä»¥ç”Ÿæˆä»»æ„çœŸå®åˆ†å¸ƒçš„æ ·æœ¬
2. Codebookæ˜¯è¿ç»­å™ªå£°ç©ºé—´çš„ç¦»æ•£åŒ–
3. $K \to \infty$ æ—¶ï¼Œç¦»æ•£åŒ–è¯¯å·®è¶‹äº0
4. å› æ­¤å­˜åœ¨è¿‘ä¼¼å®Œç¾çš„ç¼–ç </p>
<h4 id="112">11.2 è´ªå¿ƒç®—æ³•çš„æ¬¡ä¼˜æ€§</h4>
<p>è´ªå¿ƒç¼–ç ä¸ä¸€å®šæ‰¾åˆ°å…¨å±€æœ€ä¼˜è§£ï¼š
\begin{equation}
\text{Decode}(\text{GreedyEncode}(\boldsymbol{x}<em _mathbf_i="\mathbf{i">0)) \neq \arg\min</em>
\end{equation}}} \Vert\boldsymbol{x}_0 - \text{Decode}(\mathbf{i})\Vert \tag{44</p>
<p><strong>åŸå› </strong>ï¼šæ¯æ­¥å±€éƒ¨æœ€ä¼˜ä¸ä¿è¯å…¨å±€æœ€ä¼˜ã€‚</p>
<p><strong>å®éªŒè§‚å¯Ÿ</strong>ï¼š
- å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè´ªå¿ƒç®—æ³•è¶³å¤Ÿå¥½
- é‡æ„è¯¯å·®ä¸»è¦æ¥è‡ª $K$ çš„å¤§å°ï¼Œè€Œéç®—æ³•æ¬¡ä¼˜æ€§</p>
<h3 id="12">12. å‹ç¼©æ€§èƒ½åˆ†æ</h3>
<h4 id="121">12.1 ç‡å¤±çœŸæƒè¡¡</h4>
<p>å®šä¹‰ç‡å¤±çœŸå‡½æ•°ï¼š
\begin{equation}
R(D) = \min_{p(\mathbf{i}|\boldsymbol{x}_0): \mathbb{E}[\text{dist}(\boldsymbol{x}_0, \hat{\boldsymbol{x}}_0)] \leq D} I(\boldsymbol{x}_0; \mathbf{i}) \tag{45}
\end{equation}</p>
<p><strong>DDCMçš„ç‡å¤±çœŸ</strong>ï¼š
- ç¼–ç ç‡ï¼š$R = T \log_2 K$
- å¤±çœŸï¼š$D = \mathbb{E}[\Vert\boldsymbol{x}_0 - \hat{\boldsymbol{x}}_0\Vert^2]$</p>
<p><strong>å®éªŒæ›²çº¿</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>$K$</th>
<th>$R$ (bits)</th>
<th>$D$ (MSE)</th>
<th>PSNR (dB)</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td>50</td>
<td>0.0182</td>
<td>17.4</td>
</tr>
<tr>
<td>4</td>
<td>100</td>
<td>0.0089</td>
<td>20.5</td>
</tr>
<tr>
<td>16</td>
<td>200</td>
<td>0.0032</td>
<td>24.9</td>
</tr>
<tr>
<td>64</td>
<td>300</td>
<td>0.0012</td>
<td>29.2</td>
</tr>
</tbody>
</table>
<h4 id="122">12.2 ä¸ä¼ ç»Ÿå‹ç¼©æ–¹æ³•å¯¹æ¯”</h4>
<p><strong>JPEGï¼ˆ300 bitsï¼‰</strong>ï¼š
- æœ‰æŸå‹ç¼©ï¼Œè´¨é‡å› å­éœ€è¦è°ƒä½
- PSNRçº¦35 dBï¼Œä½†æœ‰æ˜æ˜¾çš„å—æ•ˆåº”</p>
<p><strong>DDCMï¼ˆ300 bitsï¼‰</strong>ï¼š
- æ„ŸçŸ¥è´¨é‡æ›´å¥½ï¼ˆæ— å—æ•ˆåº”ï¼‰
- PSNRçº¦29 dBï¼ˆå®¢è§‚æŒ‡æ ‡å·®ï¼‰
- ä½†FIDæ›´ä½ï¼ˆç”Ÿæˆè´¨é‡å¥½ï¼‰</p>
<p><strong>æ´å¯Ÿ</strong>ï¼šDDCMä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰çš„å‹ç¼©ï¼Œè€Œæ˜¯<strong>ç”Ÿæˆå¼ç¼–ç </strong>ã€‚</p>
<h3 id="13">13. å®ç°æŠ€å·§</h3>
<h4 id="131-boldsymbolx_t">13.1 åˆå§‹åŒ– $\boldsymbol{x}_T$ çš„é€‰æ‹©</h4>
<p><strong>æ–¹æ¡ˆ1ï¼šéšæœºåˆå§‹åŒ–</strong>
\begin{equation}
\boldsymbol{x}_T \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{I}) \tag{46}
\end{equation}</p>
<p>ç¼ºç‚¹ï¼šç¼–ç ä¸å”¯ä¸€ï¼Œä¸åŒè¿è¡Œç»“æœä¸åŒã€‚</p>
<p><strong>æ–¹æ¡ˆ2ï¼šä»Codebooké€‰æ‹©</strong>
\begin{equation}
\boldsymbol{x}<em _boldsymbol_c="\boldsymbol{c">T = \arg\max</em>
\end{equation}}\in\mathcal{C}_T} \boldsymbol{c} \cdot (\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_T)) \tag{47</p>
<p>é—®é¢˜ï¼šéœ€è¦å…ˆçŸ¥é“ $\boldsymbol{x}_T$ï¼ˆå¾ªç¯ä¾èµ–ï¼‰ã€‚</p>
<p><strong>æ–¹æ¡ˆ3ï¼šä¸¤é˜¶æ®µ</strong>
1. å…ˆéšæœºç”Ÿæˆä¸€æ¬¡ï¼Œå¾—åˆ° $\boldsymbol{x}_T^{(0)}$
2. ç”¨ $\boldsymbol{x}_T^{(0)}$ ä½œä¸ºä¼°è®¡ï¼Œä»Codebooké€‰æ‹©æœ€ä½³çš„</p>
<h4 id="132">13.2 åŠ é€ŸæŠ€å·§</h4>
<p><strong>å¹¶è¡Œå†…ç§¯è®¡ç®—</strong>ï¼š
\begin{equation}
\text{scores} = \mathbf{C}_t \boldsymbol{\Delta}, \quad \mathbf{C}_t = [\boldsymbol{c}_t^{(1)}, \ldots, \boldsymbol{c}_t^{(K)}]^T \in \mathbb{R}^{K \times d} \tag{48}
\end{equation}</p>
<p>ä½¿ç”¨çŸ©é˜µä¹˜æ³•ï¼ŒGPUåŠ é€Ÿã€‚</p>
<p><strong>ç¼“å­˜é¢„æµ‹</strong>ï¼š
- $\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)$ åœ¨æ¯æ­¥éƒ½è¦è®¡ç®—
- å¦‚æœCodebookä¸å˜ï¼Œå¯ä»¥é¢„è®¡ç®—éƒ¨åˆ†ç»“æœ</p>
<h3 id="14">14. åº”ç”¨åœºæ™¯</h3>
<h4 id="141-tokenizer-for-llm">14.1 å›¾åƒTokenizer for LLM</h4>
<p><strong>ä¼ ç»Ÿæ–¹æ¡ˆ</strong>ï¼ˆVQ-VAEï¼‰ï¼š
\begin{equation}
\text{Image} \xrightarrow{E} \text{2D tokens} \xrightarrow{\text{flatten}} \text{1D seq} \xrightarrow{\text{LLM}} \cdots \tag{49}
\end{equation}</p>
<p>é—®é¢˜ï¼šflattenéœ€è¦é€‰æ‹©æ‰«æé¡ºåºï¼ˆraster scan, Hilbert curveç­‰ï¼‰ã€‚</p>
<p><strong>DDCMæ–¹æ¡ˆ</strong>ï¼š
\begin{equation}
\text{Image} \xrightarrow{\text{DDCM}} \text{1D seq} \xrightarrow{\text{LLM}} \cdots \tag{50}
\end{equation}</p>
<p>ä¼˜åŠ¿ï¼šå¤©ç„¶1Dï¼Œæ— éœ€æ’åºï¼</p>
<h4 id="142">14.2 å‹ç¼©è¡¨ç¤ºå­¦ä¹ </h4>
<p>å­¦ä¹ ä¸€ä¸ªè‡ªå›å½’æ¨¡å‹ï¼š
\begin{equation}
p(\mathbf{i}) = \prod_{t=1}^T p(i_t | i_{t+1}, \ldots, i_T) \tag{51}
\end{equation}</p>
<p>å¯ç”¨äºï¼š
- å¯†åº¦ä¼°è®¡
- æ¡ä»¶ç”Ÿæˆ
- è¡¨ç¤ºå­¦ä¹ </p>
<h3 id="15">15. å±€é™æ€§ä¸æœªæ¥æ–¹å‘</h3>
<h4 id="151">15.1 å½“å‰å±€é™</h4>
<ol>
<li><strong>ç¼–ç é€Ÿåº¦æ…¢</strong>ï¼šéœ€è¦å®Œæ•´çš„DDPMå‰å‘è¿‡ç¨‹ï¼ˆ$T$ æ­¥ï¼‰</li>
<li><strong>å‹ç¼©ç‡å›ºå®š</strong>ï¼šç”± $T$ å’Œ $K$ å†³å®šï¼Œä¸çµæ´»</li>
<li><strong>ä¾èµ–DDPMè´¨é‡</strong>ï¼šå¦‚æœDDPMæœ¬èº«ä¸å¥½ï¼ŒDDCMä¹Ÿä¸å¥½</li>
</ol>
<h4 id="152">15.2 å¯èƒ½æ”¹è¿›</h4>
<p><strong>åŠ é€Ÿé‡‡æ ·</strong>ï¼š
- ä½¿ç”¨DDIMã€DPM-Solverç­‰åŠ é€Ÿå™¨
- é—®é¢˜ï¼šå‡å°‘ $T$ ä¼šé™ä½ç¼–ç é•¿åº¦</p>
<p><strong>å¯å˜ç‡ç¼–ç </strong>ï¼š
\begin{equation}
K_t = f(t), \quad \text{e.g., } K_t = 2^{\lfloor a + bt \rfloor} \tag{52}
\end{equation}</p>
<p>å‰æœŸç”¨å¤§Codebookï¼ŒåæœŸç”¨å°Codebookã€‚</p>
<p><strong>ç«¯åˆ°ç«¯è®­ç»ƒ</strong>ï¼š
\begin{equation}
\min_{\boldsymbol{\theta}, {\mathcal{C}<em _boldsymbol_x="\boldsymbol{x">t}} \mathbb{E}</em><em _boldsymbol_theta="\boldsymbol{\theta">0}[\Vert\boldsymbol{x}_0 - \text{DDCM}</em>
\end{equation}}}(\text{Encode}(\boldsymbol{x}_0))\Vert^2] \tag{53</p>
<p>è”åˆä¼˜åŒ–DDPMå’ŒCodebookã€‚</p>
<h3 id="16">16. æ•°å­¦æ€»ç»“</h3>
<h4 id="161">16.1 æ ¸å¿ƒå…¬å¼</h4>
<ol>
<li>
<p><strong>Codebookå®šä¹‰</strong>ï¼š
   $$\mathcal{C}_t = \{\boldsymbol{c}_t^{(1)}, \ldots, \boldsymbol{c}_t^{(K)}\}, \quad \boldsymbol{c}_t^{(k)} \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{I})$$</p>
</li>
<li>
<p><strong>ç¼–ç è§„åˆ™</strong>ï¼š
   $$i_t = \arg\max_{k=1,\ldots,K} \boldsymbol{c}_t^{(k)} \cdot (\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t))$$</p>
</li>
<li>
<p><strong>è§£ç è¿‡ç¨‹</strong>ï¼š
   $$\boldsymbol{x}_{t-1} = \boldsymbol{\mu}(\boldsymbol{x}_t) + \sigma_t \boldsymbol{c}_t^{(i_t)}$$</p>
</li>
<li>
<p><strong>ç¼–ç ç‡</strong>ï¼š
   $$R = T \cdot \log_2 K \text{ bits}$$</p>
</li>
</ol>
<h4 id="162">16.2 ç†è®ºæ„ä¹‰</h4>
<p>DDCMå±•ç¤ºäº†ï¼š
1. <strong>å™ªå£°çš„è¯­ä¹‰</strong>ï¼šDDPMçš„å™ªå£°ä¸æ˜¯çº¯éšæœºï¼Œè€Œæ˜¯æºå¸¦è¯­ä¹‰ä¿¡æ¯
2. <strong>ç¦»æ•£åŒ–å¯è¡Œæ€§</strong>ï¼šè¿ç»­å™ªå£°ç©ºé—´å¯ä»¥æœ‰æ•ˆç¦»æ•£åŒ–
3. <strong>æ–°å‹Tokenizer</strong>ï¼šæ‰©æ•£æ¨¡å‹å¯ä»¥ä½œä¸ºå›¾åƒçš„åºåˆ—åŒ–ç¼–ç å™¨</p>
<p>è¿™ä¸ºå¤šæ¨¡æ€å¤§æ¨¡å‹æä¾›äº†æ–°çš„æŠ€æœ¯è·¯çº¿ã€‚</p>
        </div>
    </div>
</body>
</html>