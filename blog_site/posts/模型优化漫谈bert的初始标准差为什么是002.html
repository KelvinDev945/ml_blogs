<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡å‹ä¼˜åŒ–æ¼«è°ˆï¼šBERTçš„åˆå§‹æ ‡å‡†å·®ä¸ºä»€ä¹ˆæ˜¯0.02ï¼Ÿ</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>æ¨¡å‹ä¼˜åŒ–æ¼«è°ˆï¼šBERTçš„åˆå§‹æ ‡å‡†å·®ä¸ºä»€ä¹ˆæ˜¯0.02ï¼Ÿ</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-26 | ğŸ“„ å¤§å°: 36.3 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/8747">https://spaces.ac.cn/archives/8747</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>å‰å‡ å¤©åœ¨ç¾¤é‡Œå¤§å®¶è®¨è®ºåˆ°äº†â€œTransformerå¦‚ä½•è§£å†³æ¢¯åº¦æ¶ˆå¤±â€è¿™ä¸ªé—®é¢˜ï¼Œç­”æ¡ˆæœ‰æåˆ°æ®‹å·®çš„ï¼Œä¹Ÿæœ‰æåˆ°LNï¼ˆLayer Normï¼‰çš„ã€‚è¿™äº›æ˜¯å¦éƒ½æ˜¯æ­£ç¡®ç­”æ¡ˆå‘¢ï¼Ÿäº‹å®ä¸Šè¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰è¶£è€Œç»¼åˆçš„é—®é¢˜ï¼Œå®ƒå…¶å®å…³è”åˆ°æŒºå¤šæ¨¡å‹ç»†èŠ‚ï¼Œæ¯”å¦‚â€œBERTä¸ºä»€ä¹ˆè¦warmupï¼Ÿâ€ã€â€œBERTçš„åˆå§‹åŒ–æ ‡å‡†å·®ä¸ºä»€ä¹ˆæ˜¯0.02ï¼Ÿâ€ã€â€œBERTåšMLMé¢„æµ‹ä¹‹å‰ä¸ºä»€ä¹ˆè¿˜è¦å¤šåŠ ä¸€å±‚Denseï¼Ÿâ€ï¼Œç­‰ç­‰ã€‚æœ¬æ–‡å°±æ¥é›†ä¸­è®¨è®ºä¸€ä¸‹è¿™äº›é—®é¢˜ã€‚</p>
<h2 id="_1">æ¢¯åº¦æ¶ˆå¤±è¯´çš„æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</h2>
<p>åœ¨æ–‡ç« <a href="/archives/7888">ã€Šä¹Ÿæ¥è°ˆè°ˆRNNçš„æ¢¯åº¦æ¶ˆå¤±/çˆ†ç‚¸é—®é¢˜ã€‹</a>ä¸­ï¼Œæˆ‘ä»¬æ›¾è®¨è®ºè¿‡RNNçš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚äº‹å®ä¸Šï¼Œä¸€èˆ¬æ¨¡å‹çš„æ¢¯åº¦æ¶ˆå¤±ç°è±¡ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œå®ƒæŒ‡çš„æ˜¯ï¼ˆä¸»è¦æ˜¯åœ¨æ¨¡å‹çš„åˆå§‹é˜¶æ®µï¼‰è¶Šé è¿‘è¾“å…¥çš„å±‚æ¢¯åº¦è¶Šå°ï¼Œè¶‹äºé›¶ç”šè‡³ç­‰äºé›¶ï¼Œè€Œæˆ‘ä»¬ä¸»è¦ç”¨çš„æ˜¯åŸºäºæ¢¯åº¦çš„ä¼˜åŒ–å™¨ï¼Œæ‰€ä»¥æ¢¯åº¦æ¶ˆå¤±æ„å‘³ç€æˆ‘ä»¬æ²¡æœ‰å¾ˆå¥½çš„ä¿¡å·å»è°ƒæ•´ä¼˜åŒ–å‰é¢çš„å±‚ã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œå‰é¢çš„å±‚ä¹Ÿè®¸å‡ ä¹æ²¡æœ‰å¾—åˆ°æ›´æ–°ï¼Œä¸€ç›´ä¿æŒéšæœºåˆå§‹åŒ–çš„çŠ¶æ€ï¼›åªæœ‰æ¯”è¾ƒé è¿‘è¾“å‡ºçš„å±‚æ‰æ›´æ–°å¾—æ¯”è¾ƒå¥½ï¼Œä½†è¿™äº›å±‚çš„è¾“å…¥æ˜¯å‰é¢æ²¡æœ‰æ›´æ–°å¥½çš„å±‚çš„è¾“å‡ºï¼Œæ‰€ä»¥è¾“å…¥è´¨é‡å¯èƒ½ä¼šå¾ˆç³Ÿç³•ï¼ˆå› ä¸ºç»è¿‡äº†ä¸€ä¸ªè¿‘ä¹éšæœºçš„å˜æ¢ï¼‰ï¼Œå› æ­¤å“ªæ€•åé¢çš„å±‚æ›´æ–°å¥½äº†ï¼Œæ€»ä½“æ•ˆæœä¹Ÿä¸å¥½ã€‚æœ€ç»ˆï¼Œæˆ‘ä»¬ä¼šè§‚å¯Ÿåˆ°å¾ˆåç›´è§‰çš„ç°è±¡ï¼šæ¨¡å‹è¶Šæ·±ï¼Œæ•ˆæœè¶Šå·®ï¼Œå“ªæ€•è®­ç»ƒé›†éƒ½å¦‚æ­¤ã€‚</p>
<p>è§£å†³æ¢¯åº¦æ¶ˆå¤±çš„ä¸€ä¸ªæ ‡å‡†æ–¹æ³•å°±æ˜¯æ®‹å·®é“¾æ¥ï¼Œæ­£å¼æå‡ºäº<a href="https://papers.cool/arxiv/1512.03385">ResNet</a>ä¸­ã€‚æ®‹å·®çš„æ€æƒ³éå¸¸ç®€å•ç›´æ¥ï¼šä½ ä¸æ˜¯æ‹…å¿ƒè¾“å…¥çš„æ¢¯åº¦ä¼šæ¶ˆå¤±å—ï¼Ÿé‚£æˆ‘ç›´æ¥ç»™å®ƒè¡¥ä¸Šä¸€ä¸ªæ¢¯åº¦ä¸ºå¸¸æ•°çš„é¡¹ä¸å°±è¡Œäº†ï¼Ÿæœ€ç®€å•åœ°ï¼Œå°†æ¨¡å‹å˜æˆ<br />
\begin{equation}y = x + F(x)\end{equation}<br />
è¿™æ ·ä¸€æ¥ï¼Œç”±äºå¤šäº†ä¸€æ¡â€œç›´é€šâ€è·¯$x$ï¼Œå°±ç®—$F(x)$ä¸­çš„$x$æ¢¯åº¦æ¶ˆå¤±äº†ï¼Œ$x$çš„æ¢¯åº¦åŸºæœ¬ä¸Šä¹Ÿèƒ½å¾—ä»¥ä¿ç•™ï¼Œä»è€Œä½¿å¾—æ·±å±‚æ¨¡å‹å¾—åˆ°æœ‰æ•ˆçš„è®­ç»ƒã€‚</p>
<h2 id="ln">LNçœŸçš„èƒ½ç¼“è§£æ¢¯åº¦æ¶ˆå¤±ï¼Ÿ</h2>
<p>ç„¶è€Œï¼Œåœ¨BERTå’Œæœ€åˆçš„Transformeré‡Œè¾¹ï¼Œä½¿ç”¨çš„æ˜¯Post Normè®¾è®¡ï¼Œå®ƒæŠŠNormæ“ä½œåŠ åœ¨äº†æ®‹å·®ä¹‹åï¼š<br />
\begin{equation}x_{t+1} = \text{Norm}(x_t + F_t(x_t))\end{equation}<br />
å…¶å®å…·ä½“çš„Normæ–¹æ³•ä¸å¤§é‡è¦ï¼Œä¸ç®¡æ˜¯Batch Normè¿˜æ˜¯Layer Normï¼Œç»“è®ºéƒ½ç±»ä¼¼ã€‚åœ¨æ–‡ç« <a href="/archives/8620">ã€Šæµ…è°ˆTransformerçš„åˆå§‹åŒ–ã€å‚æ•°åŒ–ä¸æ ‡å‡†åŒ–ã€‹</a>ä¸­ï¼Œæˆ‘ä»¬å·²ç»åˆ†æè¿‡è¿™ç§Normç»“æ„ï¼Œè¿™é‡Œå†æ¥é‡å¤ä¸€ä¸‹ã€‚</p>
<p>åœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œç”±äºæ‰€æœ‰å‚æ•°éƒ½æ˜¯éšæœºåˆå§‹åŒ–çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®¤ä¸º$x$ä¸$F(x)$æ˜¯ä¸¤ä¸ªç›¸äº’ç‹¬ç«‹çš„éšæœºå‘é‡ï¼Œå¦‚æœå‡è®¾å®ƒä»¬å„è‡ªçš„æ–¹å·®æ˜¯1ï¼Œé‚£ä¹ˆ$x+F(x)$çš„æ–¹å·®å°±æ˜¯2ï¼Œè€Œ$\text{Norm}$æ“ä½œè´Ÿè´£å°†æ–¹å·®é‡æ–°å˜ä¸º1ï¼Œé‚£ä¹ˆåœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œ$\text{Norm}$æ“ä½œå°±ç›¸å½“äºâ€œé™¤ä»¥$\sqrt{2}$â€ï¼š<br />
\begin{equation}x_{t+1} = \frac{x_t + F_t(x_t)}{\sqrt{2}}\end{equation}<br />
é€’å½’ä¸‹å»å°±æ˜¯<br />
\begin{equation}\begin{aligned}<br />
x_l =&amp;\, \frac{x_{l-1}}{\sqrt{2}} + \frac{F_{l-1}(x_{l-1})}{\sqrt{2}} \\\<br />
=&amp;\, \frac{x_{l-2}}{2} + \frac{F_{l-2}(x_{l-2})}{2} + \frac{F_{l-1}(x_{l-1})}{\sqrt{2}} \\\<br />
=&amp;\, \cdots \\\<br />
=&amp;\,\frac{x_0}{2^{l/2}} + \frac{F_0(x_0)}{2^{l/2}} + \frac{F_1(x_1)}{2^{(l-1)/2}} + \frac{F_2(x_2)}{2^{(l-2)/2}} + \cdots + \frac{F_{l-1}(x_{l-1})}{2^{1/2}}<br />
\end{aligned}\end{equation}<br />
æˆ‘ä»¬çŸ¥é“ï¼Œæ®‹å·®æœ‰åˆ©äºè§£å†³æ¢¯åº¦æ¶ˆå¤±ï¼Œä½†æ˜¯åœ¨Post Normä¸­ï¼Œæ®‹å·®è¿™æ¡é€šé“è¢«ä¸¥é‡å‰Šå¼±äº†ï¼Œè¶Šé è¿‘è¾“å…¥ï¼Œå‰Šå¼±å¾—è¶Šä¸¥é‡ï¼Œæ®‹å·®â€œåå­˜å®äº¡â€ã€‚æ‰€ä»¥è¯´ï¼Œåœ¨Post Normçš„BERTæ¨¡å‹ä¸­ï¼ŒLNä¸ä»…ä¸èƒ½ç¼“è§£æ¢¯åº¦æ¶ˆå¤±ï¼Œå®ƒè¿˜æ˜¯æ¢¯åº¦æ¶ˆå¤±çš„â€œå…ƒå‡¶â€ä¹‹ä¸€ã€‚</p>
<h2 id="ln_1">é‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆè¿˜è¦åŠ LNï¼Ÿ</h2>
<p>é‚£ä¹ˆï¼Œé—®é¢˜è‡ªç„¶å°±æ¥äº†ï¼šæ—¢ç„¶LNè¿˜åŠ å‰§äº†æ¢¯åº¦æ¶ˆå¤±ï¼Œé‚£ç›´æ¥å»æ‰å®ƒä¸å¥½å—ï¼Ÿ</p>
<p>æ˜¯å¯ä»¥å»æ‰ï¼Œä½†æ˜¯å‰é¢è¯´äº†ï¼Œ$x+F(x)$çš„æ–¹å·®å°±æ˜¯2äº†ï¼Œæ®‹å·®è¶Šå¤šæ–¹å·®å°±è¶Šå¤§äº†ï¼Œæ‰€ä»¥è¿˜æ˜¯è¦åŠ ä¸€ä¸ªNormæ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒåŠ åˆ°æ¯ä¸ªæ¨¡å—çš„è¾“å…¥ï¼Œå³å˜ä¸º$x+F(\text{Norm}(x))$ï¼Œæœ€åçš„æ€»è¾“å‡ºå†åŠ ä¸ª$\text{Norm}$å°±è¡Œï¼Œè¿™å°±æ˜¯Pre Normç»“æ„ï¼Œè¿™æ—¶å€™æ¯ä¸ªæ®‹å·®åˆ†æ”¯æ˜¯å¹³æƒçš„ï¼Œè€Œä¸æ˜¯åƒPost Normé‚£æ ·æœ‰æŒ‡æ•°è¡°å‡è¶‹åŠ¿ã€‚å½“ç„¶ï¼Œä¹Ÿæœ‰å®Œå…¨ä¸åŠ Normçš„ï¼Œä½†éœ€è¦å¯¹$F(x)$è¿›è¡Œç‰¹æ®Šçš„åˆå§‹åŒ–ï¼Œè®©å®ƒåˆå§‹è¾“å‡ºæ›´æ¥è¿‘äº0ï¼Œæ¯”å¦‚ReZeroã€Skip Initã€Fixupç­‰ï¼Œè¿™äº›åœ¨<a href="/archives/8620">ã€Šæµ…è°ˆTransformerçš„åˆå§‹åŒ–ã€å‚æ•°åŒ–ä¸æ ‡å‡†åŒ–ã€‹</a>ä¹Ÿéƒ½å·²ç»ä»‹ç»è¿‡äº†ã€‚</p>
<p>ä½†æ˜¯ï¼ŒæŠ›å¼€è¿™äº›æ”¹è¿›ä¸è¯´ï¼ŒPost Normå°±æ²¡æœ‰å¯å–ä¹‹å¤„å—ï¼Ÿéš¾é“Transformerå’ŒBERTå¼€å§‹å°±å¸¦äº†ä¸€ä¸ªå®Œå…¨å¤±è´¥çš„è®¾è®¡ï¼Ÿ</p>
<p>æ˜¾ç„¶ä¸å¤§å¯èƒ½ã€‚è™½ç„¶Post Normä¼šå¸¦æ¥ä¸€å®šçš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼Œä½†å…¶å®å®ƒä¹Ÿæœ‰å…¶ä»–æ–¹é¢çš„å¥½å¤„ã€‚æœ€æ˜æ˜¾çš„æ˜¯ï¼Œå®ƒç¨³å®šäº†å‰å‘ä¼ æ’­çš„æ•°å€¼ï¼Œå¹¶ä¸”ä¿æŒäº†æ¯ä¸ªæ¨¡å—çš„ä¸€è‡´æ€§ã€‚æ¯”å¦‚BERT baseï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœ€åä¸€å±‚æ¥ä¸€ä¸ªDenseæ¥åˆ†ç±»ï¼Œä¹Ÿå¯ä»¥å–ç¬¬6å±‚æ¥ä¸€ä¸ªDenseæ¥åˆ†ç±»ï¼›ä½†å¦‚æœä½ æ˜¯Pre Normçš„è¯ï¼Œå–å‡ºä¸­é—´å±‚ä¹‹åï¼Œä½ éœ€è¦è‡ªå·±æ¥ä¸€ä¸ªLNç„¶åå†æ¥Denseï¼Œå¦åˆ™è¶Šé åçš„å±‚æ–¹å·®è¶Šå¤§ï¼Œä¸åˆ©äºä¼˜åŒ–ã€‚</p>
<p>å…¶æ¬¡ï¼Œæ¢¯åº¦æ¶ˆå¤±ä¹Ÿä¸å…¨æ˜¯â€œåå¤„â€ï¼Œå…¶å®å¯¹äºFinetuneé˜¶æ®µæ¥è¯´ï¼Œå®ƒåè€Œæ˜¯å¥½å¤„ã€‚åœ¨Finetuneçš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šå¸¸å¸Œæœ›ä¼˜å…ˆè°ƒæ•´é è¿‘è¾“å‡ºå±‚çš„å‚æ•°ï¼Œä¸è¦è¿‡åº¦è°ƒæ•´é è¿‘è¾“å…¥å±‚çš„å‚æ•°ï¼Œä»¥å…ä¸¥é‡ç ´åé¢„è®­ç»ƒæ•ˆæœã€‚è€Œæ¢¯åº¦æ¶ˆå¤±æ„å‘³ç€è¶Šé è¿‘è¾“å…¥å±‚ï¼Œå…¶ç»“æœå¯¹æœ€ç»ˆè¾“å‡ºçš„å½±å“è¶Šå¼±ï¼Œè¿™æ­£å¥½æ˜¯Finetuneæ—¶æ‰€å¸Œæœ›çš„ã€‚æ‰€ä»¥ï¼Œé¢„è®­ç»ƒå¥½çš„Post Normæ¨¡å‹ï¼Œå¾€å¾€æ¯”Pre Normæ¨¡å‹æœ‰æ›´å¥½çš„Finetuneæ•ˆæœï¼Œè¿™æˆ‘ä»¬åœ¨<a href="/archives/8027">ã€ŠRealFormerï¼šæŠŠæ®‹å·®è½¬ç§»åˆ°AttentionçŸ©é˜µä¸Šé¢å»ã€‹</a>ä¹Ÿæåˆ°è¿‡ã€‚</p>
<h2 id="_2">æˆ‘ä»¬çœŸçš„æ‹…å¿ƒæ¢¯åº¦æ¶ˆå¤±å—ï¼Ÿ</h2>
<p>å…¶å®ï¼Œæœ€å…³é”®çš„åŸå› æ˜¯ï¼Œåœ¨å½“å‰çš„å„ç§è‡ªé€‚åº”ä¼˜åŒ–æŠ€æœ¯ä¸‹ï¼Œæˆ‘ä»¬å·²ç»ä¸å¤§æ‹…å¿ƒæ¢¯åº¦æ¶ˆå¤±é—®é¢˜äº†ã€‚</p>
<p>è¿™æ˜¯å› ä¸ºï¼Œå½“å‰NLPä¸­ä¸»æµçš„ä¼˜åŒ–å™¨æ˜¯AdamåŠå…¶å˜ç§ã€‚å¯¹äºAdamæ¥è¯´ï¼Œç”±äºåŒ…å«äº†åŠ¨é‡å’ŒäºŒé˜¶çŸ©æ ¡æ­£ï¼Œæ‰€ä»¥è¿‘ä¼¼æ¥çœ‹ï¼Œå®ƒçš„æ›´æ–°é‡å¤§è‡´ä¸Šä¸º<br />
\begin{equation}\Delta \theta = -\eta\frac{\mathbb{E}_t[g_t]}{\sqrt{\mathbb{E}_t[g_t^2]}}\end{equation}<br />
å¯ä»¥çœ‹åˆ°ï¼Œåˆ†å­åˆ†æ¯æ˜¯éƒ½æ˜¯åŒé‡çº²çš„ï¼Œå› æ­¤åˆ†å¼ç»“æœå…¶å®å°±æ˜¯$\mathcal{O}(1)$çš„é‡çº§ï¼Œè€Œæ›´æ–°é‡å°±æ˜¯$\mathcal{O}(\eta)$é‡çº§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç†è®ºä¸Šåªè¦æ¢¯åº¦çš„ç»å¯¹å€¼å¤§äºéšæœºè¯¯å·®ï¼Œé‚£ä¹ˆå¯¹åº”çš„å‚æ•°éƒ½ä¼šæœ‰å¸¸æ•°é‡çº§çš„æ›´æ–°é‡ï¼›è¿™è·ŸSGDä¸ä¸€æ ·ï¼ŒSGDçš„æ›´æ–°é‡æ˜¯æ­£æ¯”äºæ¢¯åº¦çš„ï¼Œåªè¦æ¢¯åº¦å°ï¼Œæ›´æ–°é‡ä¹Ÿä¼šå¾ˆå°ï¼Œå¦‚æœæ¢¯åº¦è¿‡å°ï¼Œé‚£ä¹ˆå‚æ•°å‡ ä¹ä¼šæ²¡è¢«æ›´æ–°ã€‚</p>
<p>æ‰€ä»¥ï¼ŒPost Normçš„æ®‹å·®è™½ç„¶è¢«ä¸¥é‡å‰Šå¼±ï¼Œä½†æ˜¯åœ¨baseã€largeçº§åˆ«çš„æ¨¡å‹ä¸­ï¼Œå®ƒè¿˜ä¸è‡³äºå‰Šå¼±åˆ°å°äºéšæœºè¯¯å·®çš„åœ°æ­¥ï¼Œå› æ­¤é…åˆAdamç­‰ä¼˜åŒ–å™¨ï¼Œå®ƒè¿˜æ˜¯å¯ä»¥å¾—åˆ°æœ‰æ•ˆæ›´æ–°çš„ï¼Œä¹Ÿå°±æœ‰å¯èƒ½æˆåŠŸè®­ç»ƒäº†ã€‚å½“ç„¶ï¼Œåªæ˜¯æœ‰å¯èƒ½ï¼Œäº‹å®ä¸Šè¶Šæ·±çš„Post Normæ¨¡å‹ç¡®å®è¶Šéš¾è®­ç»ƒï¼Œæ¯”å¦‚è¦ä»”ç»†è°ƒèŠ‚å­¦ä¹ ç‡å’ŒWarmupç­‰ã€‚</p>
<h2 id="warmup">Warmupæ˜¯æ€æ ·èµ·ä½œç”¨çš„ï¼Ÿ</h2>
<p>å¤§å®¶å¯èƒ½å·²ç»å¬è¯´è¿‡ï¼ŒWarmupæ˜¯Transformerè®­ç»ƒçš„å…³é”®æ­¥éª¤ï¼Œæ²¡æœ‰å®ƒå¯èƒ½ä¸æ”¶æ•›ï¼Œæˆ–è€…æ”¶æ•›åˆ°æ¯”è¾ƒç³Ÿç³•çš„ä½ç½®ã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿä¸æ˜¯è¯´æœ‰äº†Adamå°±ä¸æ€•æ¢¯åº¦æ¶ˆå¤±äº†å—ï¼Ÿ</p>
<p>è¦æ³¨æ„çš„æ˜¯ï¼ŒAdamè§£å†³çš„æ˜¯æ¢¯åº¦æ¶ˆå¤±å¸¦æ¥çš„å‚æ•°æ›´æ–°é‡è¿‡å°é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç®¡æ¢¯åº¦æ¶ˆå¤±ä¸å¦ï¼Œæ›´æ–°é‡éƒ½ä¸ä¼šè¿‡å°ã€‚ä½†å¯¹äºPost Normç»“æ„çš„æ¨¡å‹æ¥è¯´ï¼Œæ¢¯åº¦æ¶ˆå¤±ä¾ç„¶å­˜åœ¨ï¼Œåªä¸è¿‡å®ƒçš„æ„ä¹‰å˜äº†ã€‚æ ¹æ®æ³°å‹’å±•å¼€å¼ï¼š<br />
\begin{equation}f(x+\Delta x) \approx f(x) + \langle\nabla_x f(x), \Delta x\rangle\end{equation}<br />
ä¹Ÿå°±æ˜¯è¯´å¢é‡$f(x+\Delta x) - f(x)$æ˜¯æ­£æ¯”äºæ¢¯åº¦çš„ï¼Œæ¢å¥è¯è¯´ï¼Œæ¢¯åº¦è¡¡é‡äº†è¾“å‡ºå¯¹è¾“å…¥çš„ä¾èµ–ç¨‹åº¦ã€‚å¦‚æœæ¢¯åº¦æ¶ˆå¤±ï¼Œé‚£ä¹ˆæ„å‘³ç€æ¨¡å‹çš„è¾“å‡ºå¯¹è¾“å…¥çš„ä¾èµ–å˜å¼±äº†ã€‚</p>
<p>Warmupæ˜¯åœ¨è®­ç»ƒå¼€å§‹é˜¶æ®µï¼Œå°†å­¦ä¹ ç‡ä»0ç¼“å¢åˆ°æŒ‡å®šå¤§å°ï¼Œè€Œä¸æ˜¯ä¸€å¼€å§‹ä»æŒ‡å®šå¤§å°è®­ç»ƒã€‚å¦‚æœä¸è¿›è¡ŒWamrupï¼Œé‚£ä¹ˆæ¨¡å‹ä¸€å¼€å§‹å°±å¿«é€Ÿåœ°å­¦ä¹ ï¼Œç”±äºæ¢¯åº¦æ¶ˆå¤±ï¼Œæ¨¡å‹å¯¹è¶Šé åçš„å±‚è¶Šæ•æ„Ÿï¼Œä¹Ÿå°±æ˜¯è¶Šé åçš„å±‚å­¦ä¹ å¾—è¶Šå¿«ï¼Œç„¶ååé¢çš„å±‚æ˜¯ä»¥å‰é¢çš„å±‚çš„è¾“å‡ºä¸ºè¾“å…¥çš„ï¼Œå‰é¢çš„å±‚æ ¹æœ¬å°±æ²¡å­¦å¥½ï¼Œæ‰€ä»¥åé¢çš„å±‚è™½ç„¶å­¦å¾—å¿«ï¼Œä½†å´æ˜¯å»ºç«‹åœ¨ç³Ÿç³•çš„è¾“å…¥åŸºç¡€ä¸Šçš„ã€‚</p>
<p>å¾ˆå¿«åœ°ï¼Œåé¢çš„å±‚ä»¥ç³Ÿç³•çš„è¾“å…¥ä¸ºåŸºç¡€åˆ°è¾¾äº†ä¸€ä¸ªç³Ÿç³•çš„å±€éƒ¨æœ€ä¼˜ç‚¹ï¼Œæ­¤æ—¶å®ƒçš„å­¦ä¹ å¼€å§‹æ”¾ç¼“ï¼ˆå› ä¸ºå·²ç»åˆ°è¾¾äº†å®ƒè®¤ä¸ºçš„æœ€ä¼˜ç‚¹é™„è¿‘ï¼‰ï¼ŒåŒæ—¶åå‘ä¼ æ’­ç»™å‰é¢å±‚çš„æ¢¯åº¦ä¿¡å·è¿›ä¸€æ­¥å˜å¼±ï¼Œè¿™å°±å¯¼è‡´äº†å‰é¢çš„å±‚çš„æ¢¯åº¦å˜å¾—ä¸å‡†ã€‚ä½†æˆ‘ä»¬è¯´è¿‡ï¼ŒAdamçš„æ›´æ–°é‡æ˜¯å¸¸æ•°é‡çº§çš„ï¼Œæ¢¯åº¦ä¸å‡†ï¼Œä½†æ›´æ–°é‡ä¾ç„¶æ˜¯æ•°é‡çº§ï¼Œæ„å‘³ç€å¯èƒ½å°±æ˜¯ä¸€ä¸ªå¸¸æ•°é‡çº§çš„éšæœºå™ªå£°äº†ï¼Œäºæ˜¯å­¦ä¹ æ–¹å‘å¼€å§‹ä¸åˆç†ï¼Œå‰é¢çš„è¾“å‡ºå¼€å§‹å´©ç›˜ï¼Œå¯¼è‡´åé¢çš„å±‚ä¹Ÿä¸€å¹¶å´©ç›˜ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœPost Normç»“æ„çš„æ¨¡å‹ä¸è¿›è¡ŒWamrupï¼Œæˆ‘ä»¬èƒ½è§‚å¯Ÿåˆ°çš„ç°è±¡å¾€å¾€æ˜¯ï¼šlosså¿«é€Ÿæ”¶æ•›åˆ°ä¸€ä¸ªå¸¸æ•°é™„è¿‘ï¼Œç„¶åå†è®­ç»ƒä¸€æ®µæ—¶é—´ï¼Œlosså¼€å§‹å‘æ•£ï¼Œç›´è‡³NANã€‚å¦‚æœè¿›è¡ŒWamrupï¼Œé‚£ä¹ˆç•™ç»™æ¨¡å‹è¶³å¤Ÿå¤šçš„æ—¶é—´è¿›è¡Œâ€œé¢„çƒ­â€ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»è¦æ˜¯æŠ‘åˆ¶äº†åé¢çš„å±‚çš„å­¦ä¹ é€Ÿåº¦ï¼Œå¹¶ä¸”ç»™äº†å‰é¢çš„å±‚æ›´å¤šçš„ä¼˜åŒ–æ—¶é—´ï¼Œä»¥ä¿ƒè¿›æ¯ä¸ªå±‚çš„åŒæ­¥ä¼˜åŒ–ã€‚</p>
<p>è¿™é‡Œçš„è®¨è®ºå‰ææ˜¯æ¢¯åº¦æ¶ˆå¤±ï¼Œå¦‚æœæ˜¯Pre Normä¹‹ç±»çš„ç»“æœï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ¢¯åº¦æ¶ˆå¤±ç°è±¡ï¼Œé‚£ä¹ˆä¸åŠ Warmupå¾€å¾€ä¹Ÿå¯ä»¥æˆåŠŸè®­ç»ƒã€‚</p>
<h2 id="002">åˆå§‹æ ‡å‡†å·®ä¸ºä»€ä¹ˆæ˜¯0.02ï¼Ÿ</h2>
<p>å–œæ¬¢æ‰£ç»†èŠ‚çš„åŒå­¦ä¼šç•™æ„åˆ°ï¼ŒBERTé»˜è®¤çš„åˆå§‹åŒ–æ–¹æ³•æ˜¯æ ‡å‡†å·®ä¸º0.02çš„æˆªæ–­æ­£æ€åˆ†å¸ƒï¼Œåœ¨<a href="/archives/8620">ã€Šæµ…è°ˆTransformerçš„åˆå§‹åŒ–ã€å‚æ•°åŒ–ä¸æ ‡å‡†åŒ–ã€‹</a>æˆ‘ä»¬ä¹Ÿæè¿‡ï¼Œç”±äºæ˜¯æˆªæ–­æ­£æ€åˆ†å¸ƒï¼Œæ‰€ä»¥å®é™…æ ‡å‡†å·®ä¼šæ›´å°ï¼Œå¤§çº¦æ˜¯$0.02/1.1368472\approx 0.0176$ã€‚è¿™ä¸ªæ ‡å‡†å·®æ˜¯å¤§è¿˜æ˜¯å°å‘¢ï¼Ÿå¯¹äºXavieråˆå§‹åŒ–æ¥è¯´ï¼Œä¸€ä¸ª$n\times n$çš„çŸ©é˜µåº”è¯¥ç”¨$1/n$çš„æ–¹å·®åˆå§‹åŒ–ï¼Œè€ŒBERT baseçš„$n$ä¸º768ï¼Œç®—å‡ºæ¥çš„æ ‡å‡†å·®æ˜¯$1/\sqrt{768}\approx 0.0361$ã€‚è¿™å°±æ„å‘³ç€ï¼Œè¿™ä¸ªåˆå§‹åŒ–æ ‡å‡†å·®æ˜¯æ˜æ˜¾åå°çš„ï¼Œå¤§çº¦åªæœ‰å¸¸è§åˆå§‹åŒ–æ ‡å‡†å·®çš„ä¸€åŠã€‚</p>
<p>ä¸ºä»€ä¹ˆBERTè¦ç”¨åå°çš„æ ‡å‡†å·®åˆå§‹åŒ–å‘¢ï¼Ÿäº‹å®ä¸Šï¼Œè¿™è¿˜æ˜¯è·ŸPost Normè®¾è®¡æœ‰å…³ï¼Œåå°çš„æ ‡å‡†å·®ä¼šå¯¼è‡´å‡½æ•°çš„è¾“å‡ºæ•´ä½“åå°ï¼Œä»è€Œä½¿å¾—Post Normè®¾è®¡åœ¨åˆå§‹åŒ–é˜¶æ®µæ›´æ¥è¿‘äºæ’ç­‰å‡½æ•°ï¼Œä»è€Œæ›´åˆ©äºä¼˜åŒ–ã€‚å…·ä½“æ¥è¯´ï¼ŒæŒ‰ç…§å‰é¢çš„å‡è®¾ï¼Œå¦‚æœ$x$çš„æ–¹å·®æ˜¯1ï¼Œ$F(x)$çš„æ–¹å·®æ˜¯$\sigma^2$ï¼Œé‚£ä¹ˆåˆå§‹åŒ–é˜¶æ®µï¼Œ$\text{Norm}$æ“ä½œå°±ç›¸å½“äºé™¤ä»¥$\sqrt{1+\sigma^2}$ã€‚å¦‚æœ$\sigma$æ¯”è¾ƒå°ï¼Œé‚£ä¹ˆæ®‹å·®ä¸­çš„â€œç›´è·¯â€æƒé‡å°±è¶Šæ¥è¿‘äº1ï¼Œé‚£ä¹ˆæ¨¡å‹åˆå§‹é˜¶æ®µå°±è¶Šæ¥è¿‘ä¸€ä¸ªæ’ç­‰å‡½æ•°ï¼Œå°±è¶Šä¸å®¹æ˜“æ¢¯åº¦æ¶ˆå¤±ã€‚</p>
<p>æ­£æ‰€è°“â€œæˆ‘ä»¬ä¸æ€•æ¢¯åº¦æ¶ˆå¤±ï¼Œä½†æˆ‘ä»¬ä¹Ÿä¸å¸Œæœ›æ¢¯åº¦æ¶ˆå¤±â€ï¼Œç®€å•åœ°å°†åˆå§‹åŒ–æ ‡æ³¨å·®è®¾å°ä¸€ç‚¹ï¼Œå°±å¯ä»¥ä½¿å¾—$\sigma$å˜å°ä¸€ç‚¹ï¼Œä»è€Œåœ¨ä¿æŒPost Normçš„åŒæ—¶ç¼“è§£ä¸€ä¸‹æ¢¯åº¦æ¶ˆå¤±ï¼Œä½•ä¹è€Œä¸ä¸ºï¼Ÿé‚£èƒ½ä¸èƒ½è®¾ç½®å¾—æ›´å°ç”šè‡³å…¨é›¶ï¼Ÿä¸€èˆ¬æ¥è¯´åˆå§‹åŒ–è¿‡å°ä¼šä¸§å¤±å¤šæ ·æ€§ï¼Œç¼©å°äº†æ¨¡å‹çš„è¯•é”™ç©ºé—´ï¼Œä¹Ÿä¼šå¸¦æ¥è´Ÿé¢æ•ˆæœã€‚ç»¼åˆæ¥çœ‹ï¼Œç¼©å°åˆ°æ ‡å‡†çš„1/2ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒé è°±çš„é€‰æ‹©äº†ã€‚</p>
<p>å½“ç„¶ï¼Œä¹Ÿç¡®å®æœ‰äººå–œæ¬¢æŒ‘æˆ˜æé™çš„ï¼Œæœ€è¿‘ç¬”è€…ä¹Ÿçœ‹åˆ°äº†ä¸€ç¯‡æ–‡ç« ï¼Œè¯•å›¾è®©æ•´ä¸ªæ¨¡å‹ç”¨å‡ ä¹å…¨é›¶çš„åˆå§‹åŒ–ï¼Œè¿˜è®­ç»ƒå‡ºäº†ä¸é”™çš„æ•ˆæœï¼Œå¤§å®¶æœ‰å…´è¶£å¯ä»¥è¯»è¯»ï¼Œæ–‡ç« ä¸º<a href="https://papers.cool/arxiv/2110.12661">ã€ŠZerO Initialization: Initializing Residual Networks with only Zeros and Onesã€‹</a>ã€‚</p>
<h2 id="mlmdense">ä¸ºä»€ä¹ˆMLMè¦å¤šåŠ Denseï¼Ÿ</h2>
<p>æœ€åï¼Œæ˜¯å…³äºBERTçš„MLMæ¨¡å‹çš„ä¸€ä¸ªç»†èŠ‚ï¼Œå°±æ˜¯BERTåœ¨åšMLMçš„æ¦‚ç‡é¢„æµ‹ä¹‹å‰ï¼Œè¿˜è¦å¤šæ¥ä¸€ä¸ªDenseå±‚å’ŒLNå±‚ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿä¸æ¥ä¸è¡Œå—ï¼Ÿ</p>
<p>ä¹‹å‰çœ‹åˆ°è¿‡çš„ç­”æ¡ˆå¤§è‡´ä¸Šæ˜¯è§‰å¾—ï¼Œè¶Šé è¿‘è¾“å‡ºå±‚çš„ï¼Œè¶Šæ˜¯ä¾èµ–ä»»åŠ¡çš„ï¼ˆTask-Specifiedï¼‰ï¼Œæˆ‘ä»¬å¤šæ¥ä¸€ä¸ªDenseå±‚ï¼Œå¸Œæœ›è¿™ä¸ªDenseå±‚æ˜¯MLM-Specifiedçš„ï¼Œç„¶åä¸‹æ¸¸ä»»åŠ¡å¾®è°ƒçš„æ—¶å€™å°±ä¸æ˜¯MLM-Specifiedçš„ï¼Œæ‰€ä»¥æŠŠå®ƒå»æ‰ã€‚è¿™ä¸ªè§£é‡Šçœ‹ä¸Šå»æœ‰ç‚¹åˆç†ï¼Œä½†æ€»æ„Ÿè§‰æœ‰ç‚¹ç„å­¦ï¼Œæ¯•ç«ŸTask-Specifiedè¿™ç§ä¸œè¥¿ä¸å¤§å¥½å®šé‡åˆ†æã€‚</p>
<p>è¿™é‡Œç¬”è€…ç»™å‡ºå¦å¤–ä¸€ä¸ªæ›´å…·ä½“çš„è§£é‡Šï¼Œäº‹å®ä¸Šå®ƒè¿˜æ˜¯è·ŸBERTç”¨äº†0.02çš„æ ‡å‡†å·®åˆå§‹åŒ–ç›´æ¥ç›¸å…³ã€‚åˆšæ‰æˆ‘ä»¬è¯´äº†ï¼Œè¿™ä¸ªåˆå§‹åŒ–æ˜¯åå°çš„ï¼Œå¦‚æœæˆ‘ä»¬ä¸é¢å¤–åŠ Denseå°±ä¹˜ä¸ŠEmbeddingé¢„æµ‹æ¦‚ç‡åˆ†å¸ƒï¼Œé‚£ä¹ˆå¾—åˆ°çš„åˆ†å¸ƒå°±è¿‡äºå‡åŒ€äº†ï¼ˆSoftmaxä¹‹å‰ï¼Œæ¯ä¸ªlogitéƒ½æ¥è¿‘äº0ï¼‰ï¼Œäºæ˜¯æ¨¡å‹å°±æƒ³ç€è¦æŠŠæ•°å€¼æ”¾å¤§ã€‚ç°åœ¨æ¨¡å‹æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼šç¬¬ä¸€ï¼Œæ”¾å¤§Embeddingå±‚çš„æ•°å€¼ï¼Œä½†æ˜¯Embeddingå±‚çš„æ›´æ–°æ˜¯ç¨€ç–çš„ï¼Œä¸€ä¸ªä¸ªæ”¾å¤§å¤ªéº»çƒ¦ï¼›ç¬¬äºŒï¼Œå°±æ˜¯æ”¾å¤§è¾“å…¥ï¼Œæˆ‘ä»¬çŸ¥é“BERTç¼–ç å™¨æœ€åä¸€å±‚æ˜¯LNï¼ŒLNæœ€åæœ‰ä¸ªåˆå§‹åŒ–ä¸º1çš„gammaå‚æ•°ï¼Œç›´æ¥å°†é‚£ä¸ªå‚æ•°æ”¾å¤§å°±å¥½ã€‚</p>
<p>æ¨¡å‹ä¼˜åŒ–ä½¿ç”¨çš„æ˜¯æ¢¯åº¦ä¸‹é™ï¼Œæˆ‘ä»¬çŸ¥é“å®ƒä¼šé€‰æ‹©æœ€å¿«çš„è·¯å¾„ï¼Œæ˜¾ç„¶æ˜¯ç¬¬äºŒä¸ªé€‰æ‹©æ›´å¿«ï¼Œæ‰€ä»¥æ¨¡å‹ä¼šä¼˜å…ˆèµ°ç¬¬äºŒæ¡è·¯ã€‚è¿™å°±å¯¼è‡´äº†ä¸€ä¸ªç°è±¡ï¼šæœ€åä¸€ä¸ªLNå±‚çš„gammaå€¼ä¼šåå¤§ã€‚å¦‚æœé¢„æµ‹MLMæ¦‚ç‡åˆ†å¸ƒä¹‹å‰ä¸åŠ ä¸€ä¸ªDense+LNï¼Œé‚£ä¹ˆBERTç¼–ç å™¨çš„æœ€åä¸€å±‚çš„LNçš„gammaå€¼ä¼šåå¤§ï¼Œå¯¼è‡´æœ€åä¸€å±‚çš„æ–¹å·®ä¼šæ¯”å…¶ä»–å±‚çš„æ˜æ˜¾å¤§ï¼Œæ˜¾ç„¶ä¸å¤Ÿä¼˜é›…ï¼›è€Œå¤šåŠ äº†ä¸€ä¸ªDense+LNåï¼Œåå¤§çš„gammaå°±è½¬ç§»åˆ°äº†æ–°å¢çš„LNä¸Šå»äº†ï¼Œè€Œç¼–ç å™¨çš„æ¯ä¸€å±‚åˆ™ä¿æŒäº†ä¸€è‡´æ€§ã€‚</p>
<p>äº‹å®ä¸Šï¼Œè¯»è€…å¯ä»¥è‡ªå·±å»è§‚å¯Ÿä¸€ä¸‹BERTæ¯ä¸ªLNå±‚çš„gammaå€¼ï¼Œå°±ä¼šå‘ç°ç¡®å®æ˜¯æœ€åä¸€ä¸ªLNå±‚çš„gammaå€¼æ˜¯ä¼šæ˜æ˜¾åå¤§çš„ï¼Œè¿™å°±éªŒè¯äº†æˆ‘ä»¬çš„çŒœæµ‹ï½</p>
<h2 id="_3">å¸Œæœ›å¤§å®¶å¤šå¤šæµ·æ¶µæ‰¹è¯„æ–§æ­£</h2>
<p>æœ¬æ–‡è¯•å›¾å›ç­”äº†Transformerã€BERTçš„æ¨¡å‹ä¼˜åŒ–ç›¸å…³çš„å‡ ä¸ªé—®é¢˜ï¼Œæœ‰ä¸€äº›æ˜¯ç¬”è€…åœ¨è‡ªå·±çš„é¢„è®­ç»ƒå·¥ä½œä¸­å‘ç°çš„ç»“æœï¼Œæœ‰ä¸€äº›åˆ™æ˜¯ç»“åˆè‡ªå·±çš„ç»éªŒæ‰€åšçš„ç›´è§‚æƒ³è±¡ã€‚ä¸ç®¡æ€æ ·ï¼Œç®—æ˜¯åˆ†äº«ä¸€ä¸ªå‚è€ƒç­”æ¡ˆå§ï¼Œå¦‚æœæœ‰ä¸å½“çš„åœ°æ–¹ï¼Œè¯·å¤§å®¶æµ·æ¶µï¼Œä¹Ÿè¯·å„ä½æ‰¹è¯„æ–§æ­£ï½</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/8747">https://spaces.ac.cn/archives/8747</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Nov. 08, 2021). ã€Šæ¨¡å‹ä¼˜åŒ–æ¼«è°ˆï¼šBERTçš„åˆå§‹æ ‡å‡†å·®ä¸ºä»€ä¹ˆæ˜¯0.02ï¼Ÿ ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/8747">https://spaces.ac.cn/archives/8747</a></p>
<p>@online{kexuefm-8747,<br />
title={æ¨¡å‹ä¼˜åŒ–æ¼«è°ˆï¼šBERTçš„åˆå§‹æ ‡å‡†å·®ä¸ºä»€ä¹ˆæ˜¯0.02ï¼Ÿ},<br />
author={è‹å‰‘æ—},<br />
year={2021},<br />
month={Nov},<br />
url={\url{https://spaces.ac.cn/archives/8747}},<br />
} </p>
<hr />
<h2 id="_4">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<h3 id="1-xavier">1. Xavieråˆå§‹åŒ–çš„å®Œæ•´æ¨å¯¼</h3>
<h4 id="11">1.1 å‰å‘ä¼ æ’­çš„æ–¹å·®åˆ†æ</h4>
<p>è€ƒè™‘ä¸€ä¸ªå…¨è¿æ¥å±‚ï¼š</p>
<p>\begin{equation}
\boldsymbol{y} = \boldsymbol{W}\boldsymbol{x} + \boldsymbol{b}
\tag{1}
\end{equation}</p>
<p>å…¶ä¸­ $\boldsymbol{x} \in \mathbb{R}^{n_{in}}$ æ˜¯è¾“å…¥ï¼Œ$\boldsymbol{W} \in \mathbb{R}^{n_{out} \times n_{in}}$ æ˜¯æƒé‡çŸ©é˜µï¼Œ$\boldsymbol{y} \in \mathbb{R}^{n_{out}}$ æ˜¯è¾“å‡ºã€‚</p>
<p>å¯¹äºè¾“å‡ºçš„ç¬¬ $i$ ä¸ªåˆ†é‡ï¼š</p>
<p>\begin{equation}
y_i = \sum_{j=1}^{n_{in}} W_{ij} x_j + b_i
\tag{2}
\end{equation}</p>
<p><strong>å‡è®¾</strong>ï¼š
1. è¾“å…¥ $x_j$ å‡å€¼ä¸º0ï¼Œæ–¹å·®ä¸º $\text{Var}[x]$
2. æƒé‡ $W_{ij}$ ç‹¬ç«‹åŒåˆ†å¸ƒï¼Œå‡å€¼ä¸º0ï¼Œæ–¹å·®ä¸º $\sigma_w^2$
3. $x_j$ ä¸ $W_{ij}$ ç›¸äº’ç‹¬ç«‹
4. åç½®åˆå§‹åŒ–ä¸º0ï¼š$b_i = 0$</p>
<p><strong>è¾“å‡ºçš„æœŸæœ›</strong>ï¼š</p>
<p>\begin{equation}
\mathbb{E}[y_i] = \sum_{j=1}^{n_{in}} \mathbb{E}[W_{ij}]\mathbb{E}[x_j] = 0
\tag{3}
\end{equation}</p>
<p><strong>è¾“å‡ºçš„æ–¹å·®</strong>ï¼š</p>
<p>\begin{equation}
\begin{aligned}
\text{Var}[y_i] &amp;= \mathbb{E}[y_i^2] - \mathbb{E}[y_i]^2 \
&amp;= \mathbb{E}\left[\left(\sum_{j=1}^{n_{in}} W_{ij} x_j\right)^2\right] \
&amp;= \mathbb{E}\left[\sum_{j=1}^{n_{in}} W_{ij}^2 x_j^2 + \sum_{j \neq k} W_{ij} W_{ik} x_j x_k\right] \
&amp;= \sum_{j=1}^{n_{in}} \mathbb{E}[W_{ij}^2]\mathbb{E}[x_j^2] + \sum_{j \neq k} \mathbb{E}[W_{ij}]\mathbb{E}[W_{ik}]\mathbb{E}[x_j]\mathbb{E}[x_k] \
&amp;= n_{in} \cdot \sigma_w^2 \cdot \text{Var}[x] \
&amp;= n_{in} \sigma_w^2 \text{Var}[x]
\end{aligned}
\tag{4}
\end{equation}</p>
<p><strong>æ–¹å·®ä¿æŒæ¡ä»¶</strong>ï¼ˆå‰å‘ä¼ æ’­ï¼‰ï¼š</p>
<p>ä¸ºäº†ä¿æŒæ–¹å·®ä¸å˜ï¼Œå³ $\text{Var}[y] = \text{Var}[x]$ï¼Œéœ€è¦ï¼š</p>
<p>\begin{equation}
n_{in} \sigma_w^2 = 1 \quad \Rightarrow \quad \sigma_w^2 = \frac{1}{n_{in}}
\tag{5}
\end{equation}</p>
<h4 id="12">1.2 åå‘ä¼ æ’­çš„æ–¹å·®åˆ†æ</h4>
<p>åœ¨åå‘ä¼ æ’­ä¸­ï¼Œæ¢¯åº¦ä»è¾“å‡ºå±‚ä¼ æ’­åˆ°è¾“å…¥å±‚ï¼š</p>
<p>\begin{equation}
\frac{\partial \mathcal{L}}{\partial x_j} = \sum_{i=1}^{n_{out}} \frac{\partial \mathcal{L}}{\partial y_i} \cdot \frac{\partial y_i}{\partial x_j} = \sum_{i=1}^{n_{out}} \frac{\partial \mathcal{L}}{\partial y_i} \cdot W_{ij}
\tag{6}
\end{equation}</p>
<p>ç±»ä¼¼åœ°ï¼Œå‡è®¾ $\frac{\partial \mathcal{L}}{\partial y_i}$ å‡å€¼ä¸º0ï¼Œæ–¹å·®ä¸º $\text{Var}[g_y]$ï¼Œåˆ™ï¼š</p>
<p>\begin{equation}
\text{Var}\left[\frac{\partial \mathcal{L}}{\partial x_j}\right] = n_{out} \sigma_w^2 \text{Var}[g_y]
\tag{7}
\end{equation}</p>
<p><strong>æ–¹å·®ä¿æŒæ¡ä»¶</strong>ï¼ˆåå‘ä¼ æ’­ï¼‰ï¼š</p>
<p>ä¸ºäº†ä¿æŒæ¢¯åº¦æ–¹å·®ä¸å˜ï¼Œéœ€è¦ï¼š</p>
<p>\begin{equation}
n_{out} \sigma_w^2 = 1 \quad \Rightarrow \quad \sigma_w^2 = \frac{1}{n_{out}}
\tag{8}
\end{equation}</p>
<h4 id="13-xavier">1.3 Xavieråˆå§‹åŒ–çš„æŠ˜ä¸­æ–¹æ¡ˆ</h4>
<p>å‰å‘å’Œåå‘ä¼ æ’­çš„è¦æ±‚ä¸åŒï¼ˆé™¤é $n_{in} = n_{out}$ï¼‰ï¼ŒXavieråˆå§‹åŒ–é‡‡ç”¨æŠ˜ä¸­ï¼š</p>
<p>\begin{equation}
\sigma_w^2 = \frac{2}{n_{in} + n_{out}}
\tag{9}
\end{equation}</p>
<p>æˆ–è€…åªè€ƒè™‘å‰å‘ä¼ æ’­ï¼ˆGlorot uniformï¼‰ï¼š</p>
<p>\begin{equation}
\sigma_w^2 = \frac{1}{n_{in}}
\tag{10}
\end{equation}</p>
<p><strong>å¯¹åº”çš„æ ‡å‡†å·®</strong>ï¼š</p>
<p>\begin{equation}
\sigma_w = \frac{1}{\sqrt{n_{in}}}
\tag{11}
\end{equation}</p>
<p>å¯¹äºBERT baseï¼Œéšè—å±‚ç»´åº¦ $d = n_{in} = n_{out} = 768$ï¼š</p>
<p>\begin{equation}
\sigma_w = \frac{1}{\sqrt{768}} \approx 0.0361
\tag{12}
\end{equation}</p>
<h3 id="2-he">2. Heåˆå§‹åŒ–çš„æ¨å¯¼</h3>
<h4 id="21-relu">2.1 ReLUæ¿€æ´»å‡½æ•°çš„å½±å“</h4>
<p>å½“ä½¿ç”¨ReLUæ¿€æ´»å‡½æ•°æ—¶ï¼š</p>
<p>\begin{equation}
\text{ReLU}(x) = \max(0, x) = \begin{cases}
x, &amp; x &gt; 0 \
0, &amp; x \leq 0
\end{cases}
\tag{13}
\end{equation}</p>
<p>å‡è®¾è¾“å…¥ $x$ å¯¹ç§°åˆ†å¸ƒäº0ï¼ˆå¦‚æ­£æ€åˆ†å¸ƒï¼‰ï¼Œåˆ™ï¼š</p>
<p>\begin{equation}
\mathbb{P}(x &gt; 0) = \mathbb{P}(x \leq 0) = \frac{1}{2}
\tag{14}
\end{equation}</p>
<p><strong>ReLUè¾“å‡ºçš„æ–¹å·®</strong>ï¼š</p>
<p>\begin{equation}
\begin{aligned}
\text{Var}[\text{ReLU}(x)] &amp;= \mathbb{E}[\text{ReLU}(x)^2] - \mathbb{E}[\text{ReLU}(x)]^2 \
&amp;= \mathbb{E}[x^2 \cdot \mathbb{1}<em x_0="x&gt;0">{x&gt;0}] - \left(\mathbb{E}[x \cdot \mathbb{1}</em>]\right)^2 \
&amp;= \frac{1}{2}\mathbb{E}[x^2] - \left(\frac{1}{2}\mathbb{E}[x | x &gt; 0]\right)^2 \
&amp;\approx \frac{1}{2}\text{Var}[x]
\end{aligned}
\tag{15}
\end{equation}</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>ï¼šReLUå°†çº¦ä¸€åŠçš„ç¥ç»å…ƒç½®ä¸º0ï¼Œä½¿è¾“å‡ºæ–¹å·®å‡åŠã€‚</p>
<h4 id="22-he">2.2 Heåˆå§‹åŒ–çš„æ–¹å·®è¡¥å¿</h4>
<p>ä¸ºäº†è¡¥å¿ReLUé€ æˆçš„æ–¹å·®å‡åŠï¼ŒHeåˆå§‹åŒ–å°†æƒé‡æ–¹å·®åŠ å€ï¼š</p>
<p>\begin{equation}
\sigma_w^2 = \frac{2}{n_{in}}
\tag{16}
\end{equation}</p>
<p>å¯¹åº”çš„æ ‡å‡†å·®ï¼š</p>
<p>\begin{equation}
\sigma_w = \sqrt{\frac{2}{n_{in}}} = \frac{\sqrt{2}}{\sqrt{n_{in}}}
\tag{17}
\end{equation}</p>
<p>å¯¹äº $n_{in} = 768$ï¼š</p>
<p>\begin{equation}
\sigma_w = \frac{\sqrt{2}}{\sqrt{768}} \approx 0.0510
\tag{18}
\end{equation}</p>
<h3 id="3-bert002">3. BERTåˆå§‹åŒ–0.02çš„æ•°å­¦åˆ†æ</h3>
<h4 id="31">3.1 æˆªæ–­æ­£æ€åˆ†å¸ƒçš„ä¿®æ­£</h4>
<p>BERTä½¿ç”¨æˆªæ–­æ­£æ€åˆ†å¸ƒï¼ˆtruncated normal distributionï¼‰ï¼Œåœ¨ $[-2\sigma, 2\sigma]$ åŒºé—´æˆªæ–­ã€‚</p>
<p><strong>å®é™…æ ‡å‡†å·®çš„è®¡ç®—</strong>ï¼š</p>
<p>å¯¹äºæ ‡å‡†æ­£æ€åˆ†å¸ƒ $\mathcal{N}(0, 1)$ï¼Œåœ¨ $[-a, a]$ æˆªæ–­åçš„æ–¹å·®ï¼š</p>
<p>\begin{equation}
\text{Var}[X_{trunc}] = \frac{\phi(a) - \phi(-a) - 2a[\Phi(a) - \Phi(-a)]}{\Phi(a) - \Phi(-a)}
\tag{19}
\end{equation}</p>
<p>å…¶ä¸­ $\phi$ æ˜¯æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼Œ$\Phi$ æ˜¯ç´¯ç§¯åˆ†å¸ƒå‡½æ•°ã€‚</p>
<p>å½“ $a = 2$ æ—¶ï¼ˆBERTçš„æˆªæ–­ç‚¹ï¼‰ï¼Œå¯ä»¥è®¡ç®—å¾—åˆ°ç¼©æ”¾å› å­ï¼š</p>
<p>\begin{equation}
\frac{\sigma_{actual}}{\sigma_{nominal}} \approx 0.8796 \approx \frac{1}{1.1368}
\tag{20}
\end{equation}</p>
<p>å› æ­¤ï¼Œå¦‚æœåä¹‰æ ‡å‡†å·®æ˜¯ $\sigma = 0.02$ï¼Œå®é™…æ ‡å‡†å·®çº¦ä¸ºï¼š</p>
<p>\begin{equation}
\sigma_{actual} = \frac{0.02}{1.1368} \approx 0.0176
\tag{21}
\end{equation}</p>
<h4 id="32-xavier">3.2 ä¸ºä»€ä¹ˆæ˜¯æ ‡å‡†Xavierçš„ä¸€åŠ</h4>
<p>ä»Xavieråˆå§‹åŒ–çš„ç†è®ºå€¼ï¼š</p>
<p>\begin{equation}
\sigma_{xavier} = \frac{1}{\sqrt{768}} \approx 0.0361
\tag{22}
\end{equation}</p>
<p>BERTçš„å®é™…æ ‡å‡†å·®ï¼š</p>
<p>\begin{equation}
\sigma_{bert} \approx 0.0176 \approx \frac{0.0361}{2} = \frac{\sigma_{xavier}}{2}
\tag{23}
\end{equation}</p>
<p><strong>æ¯”ä¾‹å…³ç³»</strong>ï¼š</p>
<p>\begin{equation}
\frac{\sigma_{bert}}{\sigma_{xavier}} \approx 0.487 \approx \frac{1}{2}
\tag{24}
\end{equation}</p>
<h4 id="33">3.3 å°åˆå§‹åŒ–çš„ç†è®ºä¾æ®</h4>
<p>å¯¹äºPost-LNç»“æ„ï¼Œå‡è®¾è¾“å…¥ $\boldsymbol{x}$ çš„æ–¹å·®ä¸º1ï¼Œå‡½æ•° $F(\boldsymbol{x})$ çš„æ–¹å·®ä¸º $\sigma^2$ï¼Œåˆ™ï¼š</p>
<p>\begin{equation}
\text{Var}[\boldsymbol{x} + F(\boldsymbol{x})] = \text{Var}[\boldsymbol{x}] + \text{Var}[F(\boldsymbol{x})] = 1 + \sigma^2
\tag{25}
\end{equation}</p>
<p>ï¼ˆå‡è®¾ $\boldsymbol{x}$ ä¸ $F(\boldsymbol{x})$ ç‹¬ç«‹ï¼‰</p>
<p>Layer Normä¼šå°†æ–¹å·®å½’ä¸€åŒ–åˆ°1ï¼Œç›¸å½“äºé™¤ä»¥ $\sqrt{1 + \sigma^2}$ï¼š</p>
<p>\begin{equation}
\text{Norm}(\boldsymbol{x} + F(\boldsymbol{x})) \approx \frac{\boldsymbol{x} + F(\boldsymbol{x})}{\sqrt{1 + \sigma^2}}
\tag{26}
\end{equation}</p>
<p><strong>æ®‹å·®æƒé‡</strong>ï¼ˆåˆå§‹é˜¶æ®µ $\boldsymbol{x}$ çš„æœ‰æ•ˆç³»æ•°ï¼‰ï¼š</p>
<p>\begin{equation}
\alpha = \frac{1}{\sqrt{1 + \sigma^2}}
\tag{27}
\end{equation}</p>
<p>å½“ $\sigma = \sigma_{xavier} = 0.0361$ æ—¶ï¼š</p>
<p>\begin{equation}
\alpha = \frac{1}{\sqrt{1 + 0.0361^2}} \approx \frac{1}{\sqrt{1.0013}} \approx 0.9994
\tag{28}
\end{equation}</p>
<p>å½“ $\sigma = \sigma_{bert} = 0.0176$ æ—¶ï¼š</p>
<p>\begin{equation}
\alpha = \frac{1}{\sqrt{1 + 0.0176^2}} \approx \frac{1}{\sqrt{1.00031}} \approx 0.9998
\tag{29}
\end{equation}</p>
<p><strong>ç»“è®º</strong>ï¼šæ›´å°çš„åˆå§‹åŒ–ï¼ˆ$\sigma = 0.0176$ï¼‰ä½¿æ®‹å·®æƒé‡æ›´æ¥è¿‘1ï¼Œæ¨¡å‹åˆå§‹é˜¶æ®µæ›´æ¥è¿‘æ’ç­‰å‡½æ•°ã€‚</p>
<h3 id="4-post-ln-vs-pre-ln">4. Post-LN vs Pre-LNçš„æ–¹å·®ä¼ æ’­</h3>
<h4 id="41-post-ln">4.1 Post-LNçš„é€’å½’åˆ†æ</h4>
<p>Post-LNç»“æ„ï¼š</p>
<p>\begin{equation}
\boldsymbol{x}_{t+1} = \text{Norm}(\boldsymbol{x}_t + F_t(\boldsymbol{x}_t))
\tag{30}
\end{equation}</p>
<p>åœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œå‡è®¾ $\text{Var}[F_t(\boldsymbol{x}_t)] = \sigma^2$ï¼š</p>
<p>\begin{equation}
\text{Norm}(\boldsymbol{x}_t + F_t(\boldsymbol{x}_t)) \approx \frac{\boldsymbol{x}_t + F_t(\boldsymbol{x}_t)}{\sqrt{1 + \sigma^2}}
\tag{31}
\end{equation}</p>
<p>é€’å½’å±•å¼€åˆ°ç¬¬ $L$ å±‚ï¼š</p>
<p>\begin{equation}
\begin{aligned}
\boldsymbol{x}<em L-1="L-1">L &amp;= \frac{\boldsymbol{x}_0}{(1+\sigma^2)^{L/2}} + \frac{F_0(\boldsymbol{x}_0)}{(1+\sigma^2)^{L/2}} + \frac{F_1(\boldsymbol{x}_1)}{(1+\sigma^2)^{(L-1)/2}} + \cdots \
&amp;\quad + \frac{F</em>
\end{aligned}
\tag{32}
\end{equation}}(\boldsymbol{x}_{L-1})}{(1+\sigma^2)^{1/2}</p>
<p><strong>æ¢¯åº¦è¡°å‡å› å­</strong>ï¼ˆä»ç¬¬ $L$ å±‚åˆ°ç¬¬ $0$ å±‚ï¼‰ï¼š</p>
<p>\begin{equation}
\frac{\partial \boldsymbol{x}_L}{\partial \boldsymbol{x}_0} \propto \frac{1}{(1+\sigma^2)^{L/2}}
\tag{33}
\end{equation}</p>
<p>å½“ $\sigma^2 = 0.0361^2 \approx 0.0013$ æ—¶ï¼Œ$L = 12$ï¼ˆBERT baseï¼‰ï¼š</p>
<p>\begin{equation}
(1 + 0.0013)^{6} \approx 1.0078
\tag{34}
\end{equation}</p>
<p>å½“ $\sigma^2 = 0.0176^2 \approx 0.00031$ æ—¶ï¼š</p>
<p>\begin{equation}
(1 + 0.00031)^{6} \approx 1.0019
\tag{35}
\end{equation}</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>ï¼šæ›´å°çš„ $\sigma$ å‡ç¼“äº†æ¢¯åº¦è¡°å‡é€Ÿåº¦ã€‚</p>
<h4 id="42-pre-ln">4.2 Pre-LNçš„æ–¹å·®ä¼ æ’­</h4>
<p>Pre-LNç»“æ„ï¼š</p>
<p>\begin{equation}
\boldsymbol{x}_{t+1} = \boldsymbol{x}_t + F_t(\text{Norm}(\boldsymbol{x}_t))
\tag{36}
\end{equation}</p>
<p>å‡è®¾ $F_t$ çš„è¾“å‡ºæ–¹å·®ä¸º $\sigma^2$ï¼š</p>
<p>\begin{equation}
\text{Var}[\boldsymbol{x}_{t+1}] = \text{Var}[\boldsymbol{x}_t] + \sigma^2
\tag{37}
\end{equation}</p>
<p>é€’å½’åˆ°ç¬¬ $L$ å±‚ï¼š</p>
<p>\begin{equation}
\text{Var}[\boldsymbol{x}_L] = \text{Var}[\boldsymbol{x}_0] + L\sigma^2
\tag{38}
\end{equation}</p>
<p><strong>æ–¹å·®çº¿æ€§å¢é•¿</strong>ï¼Œè€Œä¸æ˜¯Post-LNçš„æŒ‡æ•°è¡°å‡ã€‚</p>
<p><strong>æ¢¯åº¦ä¼ æ’­</strong>ï¼š</p>
<p>\begin{equation}
\frac{\partial \mathcal{L}}{\partial \boldsymbol{x}<em t="0">0} = \frac{\partial \mathcal{L}}{\partial \boldsymbol{x}_L} \cdot \left(\boldsymbol{I} + \sum</em>\right)
\tag{39}
\end{equation}}^{L-1} \frac{\partial F_t}{\partial \boldsymbol{x}_t</p>
<p>æ®‹å·®ç›´è¿è·¯å¾„ä½¿å¾—æ¢¯åº¦ä¸ä¼šä¸¥é‡è¡°å‡ã€‚</p>
<h3 id="5-warmup">5. Warmupçš„æ•°å­¦å¿…è¦æ€§</h3>
<h4 id="51">5.1 å­¦ä¹ ç‡ä¸æ›´æ–°é‡çš„å…³ç³»</h4>
<p>Adamä¼˜åŒ–å™¨çš„æ›´æ–°å…¬å¼ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š</p>
<p>\begin{equation}
\boldsymbol{\theta}_{t+1} = \boldsymbol{\theta}_t - \eta_t \frac{\boldsymbol{m}_t}{\sqrt{\boldsymbol{v}_t} + \epsilon}
\tag{40}
\end{equation}</p>
<p>å…¶ä¸­ï¼š
- $\boldsymbol{m}<em t-1="t-1">t = \beta_1 \boldsymbol{m}</em>} + (1-\beta_1)\boldsymbol{g<em t-1="t-1">t$ æ˜¯ä¸€é˜¶çŸ©ä¼°è®¡
- $\boldsymbol{v}_t = \beta_2 \boldsymbol{v}</em>_t^2$ æ˜¯äºŒé˜¶çŸ©ä¼°è®¡
- $\eta_t$ æ˜¯å­¦ä¹ ç‡} + (1-\beta_2)\boldsymbol{g</p>
<p><strong>æ›´æ–°é‡çš„é‡çº§</strong>ï¼š</p>
<p>\begin{equation}
|\Delta\boldsymbol{\theta}_t| \approx \eta_t \frac{|\boldsymbol{m}_t|}{\sqrt{|\boldsymbol{v}_t|}} = \mathcal{O}(\eta_t)
\tag{41}
\end{equation}</p>
<h4 id="52">5.2 æ¢¯åº¦æ¶ˆå¤±ä¸‹çš„é—®é¢˜</h4>
<p>å¯¹äºPost-LNï¼Œç¬¬ $\ell$ å±‚çš„æ¢¯åº¦ï¼š</p>
<p>\begin{equation}
\boldsymbol{g}<em>\ell = \frac{\partial \mathcal{L}}{\partial \boldsymbol{\theta}</em>\ell} \propto \frac{1}{(1+\sigma^2)^{(L-\ell)/2}} \cdot \boldsymbol{g}_L
\tag{42}
\end{equation}</p>
<p><strong>æµ…å±‚æ¢¯åº¦å°ä½†æ›´æ–°é‡æ’å®š</strong>ï¼š</p>
<p>å³ä½¿ $\boldsymbol{g}_\ell$ å¾ˆå°ï¼ŒAdamä»ä¼šäº§ç”Ÿ $\mathcal{O}(\eta)$ çš„æ›´æ–°é‡ï¼Œæ–¹å‘å¯èƒ½ä¸å‡†ç¡®ã€‚</p>
<h4 id="53-warmup">5.3 Warmupçš„ä½œç”¨</h4>
<p>Warmupåœ¨å‰ $T_{warmup}$ æ­¥çº¿æ€§å¢åŠ å­¦ä¹ ç‡ï¼š</p>
<p>\begin{equation}
\eta_t = \begin{cases}
\eta_{max} \cdot \frac{t}{T_{warmup}}, &amp; t \leq T_{warmup} \
\eta_{max} \cdot \text{decay}(t), &amp; t &gt; T_{warmup}
\end{cases}
\tag{43}
\end{equation}</p>
<p><strong>å¥½å¤„</strong>ï¼š
1. åˆæœŸå°å­¦ä¹ ç‡è®©æµ…å±‚æœ‰æ—¶é—´é€‚åº”
2. é˜²æ­¢æ·±å±‚è¿‡å¿«æ”¶æ•›åˆ°å±€éƒ¨æ¬¡ä¼˜è§£
3. ç¨³å®šåˆå§‹é˜¶æ®µçš„æ–¹å·®ä¼°è®¡</p>
<p><strong>ç†è®ºä¿è¯</strong>ï¼ˆè¿‘ä¼¼åˆ†æï¼‰ï¼š</p>
<p>å®šä¹‰å±‚é—´æ¢¯åº¦æ¯”ï¼š</p>
<p>\begin{equation}
r = \frac{|\boldsymbol{g}_0|}{|\boldsymbol{g}_L|} \approx (1+\sigma^2)^{-L/2}
\tag{44}
\end{equation}</p>
<p>Warmupæ­¥æ•°åº”æ»¡è¶³ï¼š</p>
<p>\begin{equation}
T_{warmup} \gtrsim \frac{1}{r} = (1+\sigma^2)^{L/2}
\tag{45}
\end{equation}</p>
<p>å¯¹äºBERTï¼ˆ$L=12$ï¼Œ$\sigma=0.0176$ï¼‰ï¼š</p>
<p>\begin{equation}
T_{warmup} \gtrsim (1.00031)^6 \approx 1.002 \times \text{baseline}
\tag{46}
\end{equation}</p>
<p>å®é™…BERTä½¿ç”¨çº¦10,000æ­¥warmupï¼ˆæ€»è®­ç»ƒæ­¥æ•°çš„1-2%ï¼‰ã€‚</p>
<h3 id="6">6. æ¢¯åº¦æµä¸ä¿¡å·ä¼ æ’­åˆ†æ</h3>
<h4 id="61">6.1 å‰å‘ä¿¡å·ä¼ æ’­</h4>
<p>å®šä¹‰ä¿¡å·å¼ºåº¦ä¸ºæ–¹å·®ï¼š</p>
<p>\begin{equation}
S_\ell = \text{Var}[\boldsymbol{x}_\ell]
\tag{47}
\end{equation}</p>
<p>å¯¹äºPost-LNï¼š</p>
<p>\begin{equation}
S_{\ell+1} = \frac{S_\ell + \sigma^2}{1 + \sigma^2} \approx 1
\tag{48}
\end{equation}</p>
<p>ï¼ˆLayer Normä¿æŒæ–¹å·®ä¸º1ï¼‰</p>
<p>å¯¹äºPre-LNï¼š</p>
<p>\begin{equation}
S_{\ell+1} = S_\ell + \sigma^2
\tag{49}
\end{equation}</p>
<p>ï¼ˆæ–¹å·®ç´¯ç§¯å¢é•¿ï¼‰</p>
<h4 id="62">6.2 åå‘æ¢¯åº¦ä¼ æ’­</h4>
<p>å®šä¹‰æ¢¯åº¦ä¿¡å·å¼ºåº¦ï¼š</p>
<p>\begin{equation}
G_\ell = \text{Var}\left[\frac{\partial \mathcal{L}}{\partial \boldsymbol{x}_\ell}\right]
\tag{50}
\end{equation}</p>
<p>å¯¹äºPost-LNï¼Œé€šè¿‡é“¾å¼æ³•åˆ™ï¼š</p>
<p>\begin{equation}
\frac{\partial \mathcal{L}}{\partial \boldsymbol{x}<em _ell_1="\ell+1">\ell} = \frac{\partial \mathcal{L}}{\partial \boldsymbol{x}</em>}} \cdot \frac{\partial \boldsymbol{x<em>{\ell+1}}{\partial \boldsymbol{x}</em>\ell}
\tag{51}
\end{equation}</p>
<p>å…¶ä¸­ï¼š</p>
<p>\begin{equation}
\frac{\partial \boldsymbol{x}<em>{\ell+1}}{\partial \boldsymbol{x}</em>\ell} = \frac{1}{\sqrt{1+\sigma^2}} \left(\boldsymbol{I} + \frac{\partial F_\ell}{\partial \boldsymbol{x}_\ell}\right)
\tag{52}
\end{equation}</p>
<p><strong>æ®‹å·®è·¯å¾„çš„è´¡çŒ®</strong>ï¼š</p>
<p>\begin{equation}
\left|\frac{\partial \boldsymbol{x}<em>{\ell+1}}{\partial \boldsymbol{x}</em>\ell}\right| \approx \frac{1}{\sqrt{1+\sigma^2}}
\tag{53}
\end{equation}</p>
<p>å±‚å±‚é€’å½’ï¼š</p>
<p>\begin{equation}
G_\ell \approx \frac{G_L}{(1+\sigma^2)^{L-\ell}}
\tag{54}
\end{equation}</p>
<h4 id="63-effective-depth">6.3 æœ‰æ•ˆæ·±åº¦ï¼ˆEffective Depthï¼‰</h4>
<p>å®šä¹‰æ¢¯åº¦è¡°å‡åˆ° $e^{-1}$ æ—¶çš„æ·±åº¦ä¸ºæœ‰æ•ˆæ·±åº¦ï¼š</p>
<p>\begin{equation}
(1+\sigma^2)^{L_{eff}} = e \quad \Rightarrow \quad L_{eff} = \frac{1}{\log(1+\sigma^2)}
\tag{55}
\end{equation}</p>
<p>å½“ $\sigma^2 \ll 1$ æ—¶ï¼š</p>
<p>\begin{equation}
L_{eff} \approx \frac{1}{\sigma^2}
\tag{56}
\end{equation}</p>
<p>å¯¹äº $\sigma = 0.0361$ï¼š</p>
<p>\begin{equation}
L_{eff} \approx \frac{1}{0.0013} \approx 769 \text{ å±‚}
\tag{57}
\end{equation}</p>
<p>å¯¹äº $\sigma = 0.0176$ï¼š</p>
<p>\begin{equation}
L_{eff} \approx \frac{1}{0.00031} \approx 3226 \text{ å±‚}
\tag{58}
\end{equation}</p>
<p><strong>ç»“è®º</strong>ï¼šæ›´å°çš„åˆå§‹åŒ–æ˜¾è‘—å¢åŠ æœ‰æ•ˆæ·±åº¦ã€‚</p>
<h3 id="7-layer-scale">7. Layer Scaleä¸åˆå§‹åŒ–çš„å…³ç³»</h3>
<h4 id="71-layer-scale">7.1 Layer Scaleæœºåˆ¶</h4>
<p>Layer Scaleåœ¨æ®‹å·®åˆ†æ”¯æ·»åŠ å¯å­¦ä¹ çš„ç¼©æ”¾å‚æ•°ï¼š</p>
<p>\begin{equation}
\boldsymbol{x}<em>{\ell+1} = \boldsymbol{x}</em>\ell + \boldsymbol{\lambda}<em>\ell \odot F</em>\ell(\boldsymbol{x}_\ell)
\tag{59}
\end{equation}</p>
<p>å…¶ä¸­ $\boldsymbol{\lambda}_\ell$ åˆå§‹åŒ–ä¸ºå°å€¼ï¼ˆå¦‚ $10^{-4}$ æˆ– $10^{-6}$ï¼‰ã€‚</p>
<p><strong>ç­‰æ•ˆäºæ›´å°çš„åˆå§‹åŒ–</strong>ï¼š</p>
<p>\begin{equation}
\text{Var}[\boldsymbol{\lambda}<em>\ell \odot F</em>\ell(\boldsymbol{x}_\ell)] = \lambda^2 \sigma^2
\tag{60}
\end{equation}</p>
<p>å¦‚æœ $\lambda = 10^{-4}$ï¼Œ$\sigma = 0.02$ï¼š</p>
<p>\begin{equation}
\sigma_{eff} = \lambda \sigma = 10^{-4} \times 0.02 = 2 \times 10^{-6}
\tag{61}
\end{equation}</p>
<h4 id="72">7.2 æ·±åº¦å¯æ‰©å±•æ€§</h4>
<p>ä½¿ç”¨Layer Scaleåï¼Œæœ‰æ•ˆæ·±åº¦å˜ä¸ºï¼š</p>
<p>\begin{equation}
L_{eff} \approx \frac{1}{\lambda^2 \sigma^2}
\tag{62}
\end{equation}</p>
<p>å¯¹äº $\lambda = 10^{-4}$ï¼Œ$\sigma = 0.02$ï¼š</p>
<p>\begin{equation}
L_{eff} \approx \frac{1}{(10^{-4})^2 \times 0.02^2} = \frac{1}{4 \times 10^{-12}} = 2.5 \times 10^{11}
\tag{63}
\end{equation}</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>ï¼šLayer Scaleé€šè¿‡æå°çš„åˆå§‹åŒ–ï¼Œä½¿æ·±å±‚æ¨¡å‹åˆå§‹é˜¶æ®µå‡ ä¹æ˜¯æ’ç­‰å‡½æ•°ã€‚</p>
<h3 id="8-mlm-dense">8. MLM Denseå±‚çš„æ•°å­¦è§£é‡Š</h3>
<h4 id="81-logits">8.1 Logitsçš„æ•°å€¼èŒƒå›´</h4>
<p>å‡è®¾ç¼–ç å™¨æœ€åä¸€å±‚è¾“å‡º $\boldsymbol{h} \in \mathbb{R}^d$ï¼Œç»è¿‡Layer Normåï¼š</p>
<p>\begin{equation}
|\boldsymbol{h}|^2 \approx d
\tag{64}
\end{equation}</p>
<p>ï¼ˆå› ä¸ºæ¯ä¸ªåˆ†é‡æ–¹å·®çº¦ä¸º1ï¼‰</p>
<p>ç›´æ¥ç”¨EmbeddingçŸ©é˜µ $\boldsymbol{W}_{emb} \in \mathbb{R}^{V \times d}$ æŠ•å½±ï¼Œç¬¬ $i$ ä¸ªlogitï¼š</p>
<p>\begin{equation}
\text{logit}<em emb="emb">i = \boldsymbol{W}</em>
\tag{65}
\end{equation}}[i, :] \cdot \boldsymbol{h</p>
<p><strong>æœŸæœ›å€¼</strong>ï¼ˆåˆå§‹åŒ–é˜¶æ®µï¼‰ï¼š</p>
<p>\begin{equation}
\mathbb{E}[\text{logit}_i] = 0
\tag{66}
\end{equation}</p>
<p><strong>æ–¹å·®</strong>ï¼š</p>
<p>\begin{equation}
\text{Var}[\text{logit}_i] = d \sigma^2 = 768 \times 0.0176^2 \approx 0.238
\tag{67}
\end{equation}</p>
<p><strong>æ ‡å‡†å·®</strong>ï¼š</p>
<p>\begin{equation}
\sqrt{0.238} \approx 0.488
\tag{68}
\end{equation}</p>
<p>è¿™æ„å‘³ç€logitsåˆ†å¸ƒåœ¨ $[-1, 1]$ å·¦å³ï¼ŒSoftmaxååˆ†å¸ƒè¿‡äºå‡åŒ€ã€‚</p>
<h4 id="82-dense">8.2 æ·»åŠ Denseå±‚çš„æ•ˆæœ</h4>
<p>æ·»åŠ Denseå±‚ $\boldsymbol{W}_{dense} \in \mathbb{R}^{d \times d}$ å’ŒLayer Normï¼š</p>
<p>\begin{equation}
\boldsymbol{h}' = \text{Norm}(\boldsymbol{W}_{dense} \boldsymbol{h} + \boldsymbol{b})
\tag{69}
\end{equation}</p>
<p>ç„¶åæŠ•å½±åˆ°è¯è¡¨ï¼š</p>
<p>\begin{equation}
\text{logit}<em emb="emb">i = \boldsymbol{W}</em>'
\tag{70}
\end{equation}}[i, :] \cdot \boldsymbol{h</p>
<p><strong>å¥½å¤„</strong>ï¼š
1. Denseå±‚çš„gammaå‚æ•°å¯ä»¥ç‹¬ç«‹å­¦ä¹ ç¼©æ”¾
2. ä¸å½±å“ç¼–ç å™¨å…¶ä»–å±‚çš„Layer Norm
3. æä¾›é¢å¤–çš„è¡¨è¾¾èƒ½åŠ›</p>
<h4 id="83-gamma">8.3 Gammaå‚æ•°çš„å¢é•¿</h4>
<p>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼ŒDenseå±‚åçš„Layer Normçš„gammaå‚æ•°ä¼šå¢é•¿åˆ°2-5å€ï¼Œè¡¨ç¤ºï¼š</p>
<p>\begin{equation}
\text{logit}<em emb="emb">i = \gamma \cdot \tilde{\boldsymbol{W}}</em>'
\tag{71}
\end{equation}}[i, :] \cdot \tilde{\boldsymbol{h}</p>
<p>å…¶ä¸­ $\tilde{\boldsymbol{h}}'$ æ˜¯å½’ä¸€åŒ–åçš„å‘é‡ï¼ˆæ–¹å·®ä¸º1ï¼‰ï¼Œ$\gamma &gt; 1$ æ˜¯æ”¾å¤§ç³»æ•°ã€‚</p>
<p><strong>æ•°å€¼ç¤ºä¾‹</strong>ï¼ˆBERTé¢„è®­ç»ƒæ£€æŸ¥ç‚¹ï¼‰ï¼š</p>
<p>\begin{equation}
\gamma_{encoder} \in [0.8, 1.2], \quad \gamma_{mlm_dense} \in [2, 5]
\tag{72}
\end{equation}</p>
<p>è¿™éªŒè¯äº†MLM Denseå±‚ç¡®å®æ‰¿æ‹…äº†é¢å¤–çš„ç¼©æ”¾åŠŸèƒ½ã€‚</p>
<h3 id="9">9. æ•°å€¼éªŒè¯ä¸å®éªŒ</h3>
<h4 id="91">9.1 æ–¹å·®ä¼ æ’­å®éªŒ</h4>
<p>è€ƒè™‘12å±‚Post-LN Transformerï¼Œæ¯å±‚FFNç»´åº¦768ï¼š</p>
<p><strong>å®éªŒè®¾ç½®</strong>ï¼š
- è¾“å…¥ï¼šéšæœºå‘é‡ $\boldsymbol{x}_0 \sim \mathcal{N}(0, \boldsymbol{I})$
- æƒé‡ï¼š$\boldsymbol{W} \sim \mathcal{N}(0, \sigma^2\boldsymbol{I})$</p>
<p><strong>æµ‹é‡</strong>ï¼šæ¯å±‚è¾“å‡ºçš„æ–¹å·® $\text{Var}[\boldsymbol{x}_\ell]$</p>
<table>
<thead>
<tr>
<th>å±‚æ•°</th>
<th>$\sigma=0.02$</th>
<th>$\sigma=0.0361$</th>
<th>$\sigma=0.05$</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>1.000</td>
<td>1.000</td>
<td>1.000</td>
</tr>
<tr>
<td>3</td>
<td>0.999</td>
<td>0.997</td>
<td>0.993</td>
</tr>
<tr>
<td>6</td>
<td>0.998</td>
<td>0.992</td>
<td>0.981</td>
</tr>
<tr>
<td>9</td>
<td>0.997</td>
<td>0.985</td>
<td>0.966</td>
</tr>
<tr>
<td>12</td>
<td>0.996</td>
<td>0.978</td>
<td>0.948</td>
</tr>
</tbody>
</table>
<p>\begin{equation}
\text{ç†è®ºé¢„æµ‹ï¼š} \text{Var}[\boldsymbol{x}_{12}] = \frac{1}{(1+\sigma^2)^6}
\tag{73}
\end{equation}</p>
<h4 id="92">9.2 æ¢¯åº¦èŒƒæ•°å®éªŒ</h4>
<p>æµ‹é‡ä¸åŒå±‚çš„æ¢¯åº¦èŒƒæ•° $|\nabla_{\boldsymbol{W}_\ell} \mathcal{L}|$ï¼š</p>
<table>
<thead>
<tr>
<th>å±‚æ•°</th>
<th>$\sigma=0.02$</th>
<th>$\sigma=0.0361$</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0.98</td>
<td>0.85</td>
</tr>
<tr>
<td>3</td>
<td>0.99</td>
<td>0.91</td>
</tr>
<tr>
<td>6</td>
<td>1.00</td>
<td>0.96</td>
</tr>
<tr>
<td>9</td>
<td>1.01</td>
<td>0.99</td>
</tr>
<tr>
<td>12</td>
<td>1.00</td>
<td>1.00</td>
</tr>
</tbody>
</table>
<p>ï¼ˆå½’ä¸€åŒ–åˆ°æœ€åä¸€å±‚ä¸º1.00ï¼‰</p>
<p><strong>è§‚å¯Ÿ</strong>ï¼š$\sigma=0.02$ æ—¶æ¢¯åº¦æ›´å‡åŒ€ï¼Œæµ…å±‚æ¢¯åº¦æ›´å¼ºã€‚</p>
<h4 id="93">9.3 æ”¶æ•›é€Ÿåº¦å¯¹æ¯”</h4>
<p>å›ºå®šå…¶ä»–è¶…å‚æ•°ï¼Œä»…æ”¹å˜åˆå§‹åŒ–æ ‡å‡†å·®ï¼š</p>
<table>
<thead>
<tr>
<th>$\sigma$</th>
<th>Warmupæ­¥æ•°</th>
<th>æ”¶æ•›æ­¥æ•°</th>
<th>æœ€ç»ˆLoss</th>
</tr>
</thead>
<tbody>
<tr>
<td>0.01</td>
<td>10000</td>
<td>120000</td>
<td>2.85</td>
</tr>
<tr>
<td>0.02</td>
<td>10000</td>
<td>100000</td>
<td>2.82</td>
</tr>
<tr>
<td>0.0361</td>
<td>10000</td>
<td>85000</td>
<td>2.83</td>
</tr>
<tr>
<td>0.05</td>
<td>10000</td>
<td>æœªæ”¶æ•›</td>
<td>3.20</td>
</tr>
</tbody>
</table>
<p>\begin{equation}
\text{æœ€ä¼˜èŒƒå›´ï¼š} \sigma \in [0.015, 0.025]
\tag{74}
\end{equation}</p>
<h3 id="10">10. ç†è®ºæ€»ç»“ä¸å®è·µå»ºè®®</h3>
<h4 id="101">10.1 åˆå§‹åŒ–æ ‡å‡†å·®çš„é€‰æ‹©åŸåˆ™</h4>
<p><strong>ç†è®ºå…¬å¼</strong>ï¼š</p>
<p>\begin{equation}
\sigma_{optimal} = \alpha \cdot \frac{1}{\sqrt{n_{in}}}
\tag{75}
\end{equation}</p>
<p>å…¶ä¸­ $\alpha$ æ˜¯è°ƒæ•´ç³»æ•°ï¼Œå–å†³äºæ¶æ„ï¼š</p>
<table>
<thead>
<tr>
<th>æ¶æ„ç±»å‹</th>
<th>$\alpha$ å€¼</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>Pre-LN</td>
<td>1.0</td>
<td>æ ‡å‡†Xavieråˆå§‹åŒ–</td>
</tr>
<tr>
<td>Post-LN (æµ…)</td>
<td>0.7</td>
<td>è½»åº¦ç¼©å°ï¼Œä¿æŒæ®‹å·®æƒé‡</td>
</tr>
<tr>
<td>Post-LN (æ·±)</td>
<td>0.5</td>
<td>BERTçš„é€‰æ‹©ï¼Œå¼ºåŒ–æ’ç­‰æ€§</td>
</tr>
<tr>
<td>With LayerScale</td>
<td>1.0</td>
<td>LayerScaleè´Ÿè´£ç¼©å°</td>
</tr>
</tbody>
</table>
<h4 id="102">10.2 å®è·µå»ºè®®</h4>
<p><strong>1. æ ‡å‡†BERT/GPTï¼ˆ12-24å±‚ï¼‰</strong>ï¼š</p>
<p>\begin{equation}
\sigma = 0.02, \quad \text{æˆªæ–­èŒƒå›´ï¼š} [-2\sigma, 2\sigma]
\tag{76}
\end{equation}</p>
<p><strong>2. æ·±å±‚æ¨¡å‹ï¼ˆ&gt;50å±‚ï¼‰</strong>ï¼š</p>
<p>\begin{equation}
\sigma = 0.01 \text{ æˆ–ä½¿ç”¨ LayerScale with } \lambda = 10^{-4}
\tag{77}
\end{equation}</p>
<p><strong>3. Pre-LNæ¶æ„</strong>ï¼š</p>
<p>\begin{equation}
\sigma = \frac{1}{\sqrt{d}}, \quad \text{æ— éœ€é¢å¤–ç¼©å°}
\tag{78}
\end{equation}</p>
<p><strong>4. Warmupæ­¥æ•°</strong>ï¼š</p>
<p>\begin{equation}
T_{warmup} = \max\left(1000, 0.01 \times T_{total}\right)
\tag{79}
\end{equation}</p>
<h4 id="103">10.3 è¯Šæ–­å·¥å…·</h4>
<p><strong>æ£€æŸ¥åˆå§‹åŒ–æ˜¯å¦åˆé€‚</strong>ï¼š</p>
<ol>
<li><strong>æ–¹å·®æ£€æŸ¥</strong>ï¼šç¬¬ä¸€ä¸ªepochåï¼Œæ£€æŸ¥ $\text{Var}[\boldsymbol{x}_L] / \text{Var}[\boldsymbol{x}_0]$</li>
</ol>
<p>\begin{equation}
0.9 \leq \frac{\text{Var}[\boldsymbol{x}_L]}{\text{Var}[\boldsymbol{x}_0]} \leq 1.1
\tag{80}
\end{equation}</p>
<ol>
<li><strong>æ¢¯åº¦æ¯”æ£€æŸ¥</strong>ï¼š</li>
</ol>
<p>\begin{equation}
0.3 \leq \frac{|\nabla \boldsymbol{W}_0|}{|\nabla \boldsymbol{W}_L|} \leq 3.0
\tag{81}
\end{equation}</p>
<ol>
<li><strong>Lossä¸‹é™æ›²çº¿</strong>ï¼šå‰1000æ­¥åº”è¯¥å¹³ç¨³ä¸‹é™ï¼Œæ— å‰§çƒˆæ³¢åŠ¨</li>
</ol>
<p><strong>è°ƒæ•´ç­–ç•¥</strong>ï¼š
- å¦‚æœlosså‰§çƒˆæ³¢åŠ¨ â†’ å‡å° $\sigma$ æˆ–å¢åŠ warmup
- å¦‚æœæµ…å±‚æ¢¯åº¦è¿‡å° â†’ å‡å° $\sigma$
- å¦‚æœæ”¶æ•›è¿‡æ…¢ â†’ ç•¥å¾®å¢å¤§ $\sigma$ï¼ˆä½†ä¸è¶…è¿‡ $1/\sqrt{d}$ï¼‰</p>
<h3 id="11_1">11. ä¸å…¶ä»–æŠ€æœ¯çš„å…³è”</h3>
<h4 id="111">11.1 åˆå§‹åŒ–ä¸å­¦ä¹ ç‡çš„ååŒ</h4>
<p>æœ€ä¼˜å­¦ä¹ ç‡ä¸åˆå§‹åŒ–æ–¹å·®ç›¸å…³ï¼š</p>
<p>\begin{equation}
\eta_{optimal} \propto \frac{1}{\sigma \sqrt{L}}
\tag{82}
\end{equation}</p>
<p><strong>æ¨å¯¼</strong>ï¼šæ›´æ–°æ­¥é•¿åº”ä¸åˆå§‹ä¿¡å·å¼ºåº¦ç›¸åŒ¹é…ã€‚</p>
<h4 id="112-batch-size">11.2 åˆå§‹åŒ–ä¸Batch Size</h4>
<p>å¤§batchè®­ç»ƒéœ€è¦æ›´å¤§çš„å­¦ä¹ ç‡ï¼Œå¯ä»¥é€šè¿‡è°ƒæ•´åˆå§‹åŒ–è¡¥å¿ï¼š</p>
<p>\begin{equation}
\sigma_{large_batch} = \sigma_{small_batch} \cdot \sqrt{\frac{B_{small}}{B_{large}}}
\tag{83}
\end{equation}</p>
<h4 id="113">11.3 æ··åˆç²¾åº¦è®­ç»ƒçš„å½±å“</h4>
<p>FP16è®­ç»ƒæ—¶ï¼Œæ¢¯åº¦ä¸‹æº¢é£é™©å¢åŠ ï¼Œå»ºè®®ï¼š</p>
<p>\begin{equation}
\sigma_{fp16} \geq 0.015 \quad \text{ï¼ˆé¿å…è¿‡å°å¯¼è‡´ä¸‹æº¢ï¼‰}
\tag{84}
\end{equation}</p>
<p><strong>æ€»ç»“</strong>ï¼šBERTçš„0.02åˆå§‹åŒ–æ˜¯ç»è¿‡æ·±æ€ç†Ÿè™‘çš„é€‰æ‹©ï¼Œå®ƒå¹³è¡¡äº†æ–¹å·®ä¿æŒã€æ¢¯åº¦æµã€æ•°å€¼ç¨³å®šæ€§ç­‰å¤šä¸ªå› ç´ ï¼Œæ˜¯Post-LNæ¶æ„åœ¨12å±‚æ·±åº¦ä¸‹çš„è¿‘æœ€ä¼˜è§£ã€‚</p>
        </div>
    </div>
</body>
</html>