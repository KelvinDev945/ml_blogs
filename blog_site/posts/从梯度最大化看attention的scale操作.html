<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»æ¢¯åº¦æœ€å¤§åŒ–çœ‹Attentionçš„Scaleæ“ä½œ</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>ä»æ¢¯åº¦æœ€å¤§åŒ–çœ‹Attentionçš„Scaleæ“ä½œ</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-26 | ğŸ“„ å¤§å°: 30.9 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/9812">https://spaces.ac.cn/archives/9812</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>æˆ‘ä»¬çŸ¥é“ï¼Œ<a href="/archives/4765">Scaled Dot-Product Attention</a>çš„Scaleå› å­æ˜¯$\frac{1}{\sqrt{d}}$ï¼Œå…¶ä¸­$d$æ˜¯$\boldsymbol{q},\boldsymbol{k}$çš„ç»´åº¦ã€‚è¿™ä¸ªScaleå› å­çš„ä¸€èˆ¬è§£é‡Šæ˜¯ï¼šå¦‚æœä¸é™¤ä»¥$\sqrt{d}$ï¼Œé‚£ä¹ˆåˆå§‹çš„Attentionå°±ä¼šå¾ˆæ¥è¿‘one hotåˆ†å¸ƒï¼Œè¿™ä¼šé€ æˆæ¢¯åº¦æ¶ˆå¤±ï¼Œå¯¼è‡´æ¨¡å‹è®­ç»ƒä¸èµ·æ¥ã€‚ç„¶è€Œï¼Œå¯ä»¥è¯æ˜çš„æ˜¯ï¼Œå½“Scaleç­‰äº0æ—¶åŒæ ·ä¹Ÿä¼šæœ‰æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼Œè¿™ä¹Ÿå°±æ˜¯è¯´Scaleå¤ªå¤§å¤ªå°éƒ½ä¸è¡Œã€‚</p>
<p>é‚£ä¹ˆå¤šå¤§çš„Scaleæ‰é€‚åˆå‘¢ï¼Ÿ$\frac{1}{\sqrt{d}}$æ˜¯æœ€ä½³çš„Scaleäº†å—ï¼Ÿæœ¬æ–‡è¯•å›¾ä»æ¢¯åº¦è§’åº¦æ¥å›ç­”è¿™ä¸ªé—®é¢˜ã€‚</p>
<h2 id="_1">å·²æœ‰ç»“æœ</h2>
<p>åœ¨<a href="/archives/8620#NTK%E5%8F%82%E6%95%B0%E5%8C%96">ã€Šæµ…è°ˆTransformerçš„åˆå§‹åŒ–ã€å‚æ•°åŒ–ä¸æ ‡å‡†åŒ–ã€‹</a>ä¸­ï¼Œæˆ‘ä»¬å·²ç»æ¨å¯¼è¿‡æ ‡å‡†çš„Scaleå› å­$\frac{1}{\sqrt{d}}$ï¼Œæ¨å¯¼çš„æ€è·¯å¾ˆç®€å•ï¼Œå‡è®¾åˆå§‹é˜¶æ®µ$\boldsymbol{q},\boldsymbol{k}\in\mathbb{R}^d$éƒ½é‡‡æ ·è‡ªâ€œå‡å€¼ä¸º0ã€æ–¹å·®ä¸º1â€çš„åˆ†å¸ƒï¼Œé‚£ä¹ˆå¯ä»¥ç®—å¾—<br />
\begin{equation}\mathbb{V}ar[\boldsymbol{q}\cdot\boldsymbol{k}] = d\end{equation}<br />
äºæ˜¯æˆ‘ä»¬å°†$\boldsymbol{q}\cdot\boldsymbol{k}$é™¤ä»¥$\sqrt{d}$ï¼Œå°†Attention Scoreçš„æ–¹å·®å˜ä¸º1ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¹‹å‰çš„æ¨å¯¼çº¯ç²¹æ˜¯åŸºäº <em>â€œå‡å€¼ä¸º0ã€æ–¹å·®ä¸º1â€å°±ä¼šæ›´å¥½</em> çš„<strong>ä¿¡ä»°</strong> æ¥å¾—åˆ°çš„ç»“æœï¼Œä½†æ²¡æœ‰è§£é‡Šè®©Attention Scoreçš„æ–¹å·®ä¸º1ï¼Œä¹Ÿæ²¡æœ‰è¯„ä¼°$\frac{1}{\sqrt{d}}$æ˜¯å¦çœŸçš„å°±è§£å†³äº†æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚</p>
<p>å½“ç„¶ï¼Œä»å·²æœ‰çš„å®éªŒæ¥çœ‹ï¼Œ$\frac{1}{\sqrt{d}}$è‡³å°‘ä¸€å®šç¨‹åº¦ä¸Šæ˜¯ç¼“è§£äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†è¿™æ¯•ç«Ÿæ˜¯å®éªŒç»“æœï¼Œæˆ‘ä»¬è¿˜æ˜¯å¸Œæœ›èƒ½ä»ç†è®ºä¸ŠçŸ¥é“â€œä¸€å®šç¨‹åº¦â€ç©¶ç«Ÿæ˜¯å¤šå°‘ã€‚</p>
<h2 id="_2">è®¡ç®—æ¢¯åº¦</h2>
<p>æ—¢ç„¶æ¶‰åŠåˆ°äº†æ¢¯åº¦ï¼Œé‚£ä¹ˆæœ€å¥½çš„åŠæ³•å°±æ˜¯æŠŠæ¢¯åº¦ç®—å‡ºæ¥ï¼Œç„¶åå®šä¸€ä¸ªä¼˜åŒ–ç›®æ ‡ã€‚è®¾$p_i = e^{\alpha s_i}/Z$ï¼Œ$i \in \{1,2,...,n\}$ï¼Œ$Z=\sum_i e^{\alpha s_i}$æ˜¯å½’ä¸€åŒ–å› å­ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥ç®—å¾—ï¼š<br />
\begin{equation}\frac{\partial p_i}{\partial s_j} = \left\{\begin{aligned}<br />
\alpha(p_i - p_i^2),&amp;\quad i=j\\\<br />
-\alpha p_i p_j,&amp;\quad i\neq j<br />
\end{aligned}\right.\end{equation}<br />
æˆ–è€…å¯ä»¥ç®€å†™æˆ$\partial p_i/\partial s_j = \alpha(p_i\delta_{i,j} - p_i p_j)$ã€‚å¾ˆæ˜æ˜¾ï¼Œå½“$\alpha\to 0$æ—¶æ¢¯åº¦ä¸º0ï¼›å½“$\alpha\to\infty$æ—¶ï¼Œ$p_i$ä¹‹ä¸­åªæœ‰ä¸€ä¸ª1ã€å…¶ä½™éƒ½æ˜¯0ï¼ˆå‡è®¾$s_i$ä¸­åªæœ‰å”¯ä¸€çš„æœ€å¤§å€¼ï¼‰ï¼Œæ¢¯åº¦ä¹Ÿæ˜¯0ã€‚</p>
<p>ä¸ºäº†æ›´æœ‰åˆ©äºä¼˜åŒ–ï¼Œæˆ‘ä»¬åº”è¯¥é€‰å–$\alpha$ä½¿å¾—æ¢¯åº¦å°½å¯èƒ½æœ€å¤§åŒ–ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä»¥L1èŒƒæ•°ä½œä¸ºæ¢¯åº¦å¤§å°çš„åº¦é‡ï¼š<br />
\begin{equation}\frac{1}{2}\left\Vert\frac{\partial p}{\partial s}\right\Vert_1=\frac{1}{2}\sum_{i,j}\left|\frac{\partial p_i}{\partial s_j}\right|=\frac{1}{2}\sum_i \alpha(p_i - p_i^2) + \frac{1}{2}\sum_{i\neq j} \alpha p_i p_j = \alpha\left(1 - \sum_i p_i^2\right)\label{eq:target}\end{equation}<br />
ä»æœ€åçš„ç»“æœä¸éš¾çŒœåˆ°ï¼Œä¹‹æ‰€ä»¥é€‰æ‹©L1è€Œä¸æ˜¯å…¶ä»–çš„æ ¹æœ¬åŸå› æ˜¯å› ä¸ºL1èŒƒæ•°çš„è®¡ç®—ç»“æœè¶³å¤Ÿç®€å•ã€‚å€¼å¾—æŒ‡å‡ºçš„æ˜¯ï¼Œè¿™é‡Œå‡ºç°äº†$\sum_i p_i^2$ï¼Œå®ƒæœ¬è´¨ä¸Šå°±æ˜¯æˆ‘ä»¬åœ¨<a href="/archives/9595#%E7%86%B5%E7%9A%84%E8%81%94%E7%B3%BB">ã€Šå¦‚ä½•åº¦é‡æ•°æ®çš„ç¨€ç–ç¨‹åº¦ï¼Ÿã€‹</a>ä»‹ç»è¿‡çš„â€œRÃ©nyiç†µâ€ï¼Œè·Ÿä¿¡æ¯ç†µç±»ä¼¼ï¼Œå®ƒä¹Ÿæ˜¯ä¸ç¡®å®šæ€§çš„ä¸€ç§åº¦é‡ã€‚</p>
<p>æœ‰äº†ä¼˜åŒ–ç›®æ ‡åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç€æ‰‹è¿›è¡Œæœ€å¤§åŒ–äº†ã€‚æ³¨æ„$p_i$çš„å®šä¹‰é‡Œè¾¹ä¹ŸåŒ…å«$\alpha$ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªå…³äº$\alpha$å¤æ‚çš„éçº¿æ€§ç›®æ ‡ï¼Œçœ‹ä¸Šå»æ±‚è§£æè§£æ˜¯ä¸å¯èƒ½çš„ï¼Œä½†æˆ‘ä»¬å¯ä»¥é’ˆå¯¹ä¸€äº›ç‰¹æ®Šä¾‹å­æ±‚è¿‘ä¼¼è§£ã€‚</p>
<h2 id="_3">æ­£æ€åˆ†å¸ƒ</h2>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥æ¥ç€å‰é¢çš„ç»“æœæ¥åšï¼Œå½“æˆ‘ä»¬é€šè¿‡é™¤ä»¥$\sqrt{d}$ä½¿å¾—Attention Scoreçš„å‡å€¼ä¸º0ã€æ–¹å·®ä¸º1åï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿‘ä¼¼å‡è®¾$s_i\sim\mathcal{N}(0,1)$ï¼Œç„¶åå†æ±‚$\alpha$çš„æœ€ä¼˜è§£ï¼Œå¦‚æœ$\alpha=1$ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€åŸæ¥çš„$\frac{1}{\sqrt{d}}$å°±æ˜¯æœ€ä¼˜çš„Scaleæ¯”ä¾‹äº†ï¼Œå¦åˆ™$\frac{\alpha}{\sqrt{d}}$æ‰æ˜¯æœ€ä½³çš„Scaleæ¯”ä¾‹ã€‚</p>
<p>æˆ‘ä»¬ç”¨æœŸæœ›å»ä¼°è®¡æ±‚å’Œ<br />
\begin{equation}\sum_i p_i^2 = \frac{\sum_i e^{2\alpha s_i}}{\left(\sum_i e^{\alpha s_i}\right)^2} = \frac{\frac{1}{n}\sum_i e^{2\alpha s_i}}{n\left(\frac{1}{n}\sum_i e^{\alpha s_i}\right)^2} \approx \frac{\mathbb{E}_s[e^{2\alpha s}]}{n\left(\mathbb{E}_s[e^{\alpha s}]\right)^2}\label{eq:approx}\end{equation}<br />
å¯¹äºæœä»æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„$s$ï¼Œæˆ‘ä»¬æœ‰<br />
\begin{equation}\mathbb{E}_s[e^{\alpha s}] = \int \frac{1}{\sqrt{2\pi}}e^{-s^2/2}e^{\alpha s} ds = e^{\alpha^2 / 2}\label{eq:normal}\end{equation}<br />
ä»£å…¥ä¸Šå¼ï¼Œç„¶åä»£å…¥å¼$\eqref{eq:target}$ï¼Œå¾—åˆ°<br />
\begin{equation}\alpha\left(1 - \sum_i p_i^2\right)\approx\alpha\left(1 - \frac{e^{\alpha^2}}{n}\right)\end{equation}<br />
æœ€åçš„è¿‘ä¼¼ï¼Œè™½ç„¶å·²ç»è¶³å¤Ÿç®€åŒ–äº†ï¼Œä½†å…¶å®ä¹Ÿä¸å®¹æ˜“æ±‚å‡ºæœ€å¤§å€¼æ¥ã€‚ä¸è¿‡æ— å¦¨ï¼Œæˆ‘ä»¬å¯ä»¥éå†ä¸€äº›$n$ï¼Œç„¶åæ•°å€¼æ±‚è§£å‡ºå–æœ€å¤§å€¼æ—¶çš„$\alpha^<em>$ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¤§è‡´èƒ½çœ‹åˆ°$\alpha^</em>$ä¸$n$çš„å…³ç³»äº†ï¼ŒMathematicaçš„å‚è€ƒä»£ç å¦‚ä¸‹ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="o">*</span><span class="n">å®šä¹‰å‡½æ•°</span><span class="o">*</span><span class="p">)</span>
<span class="n">f</span><span class="o">[</span><span class="n">a_, n_</span><span class="o">]</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">Exp</span><span class="o">[</span><span class="n">a^2</span><span class="o">]/</span><span class="n">n</span><span class="p">)</span>
<span class="p">(</span><span class="o">*</span><span class="n">æ‰¾åˆ°å‡½æ•°çš„æœ€å¤§ç‚¹å¯¹åº”çš„a</span><span class="o">*</span><span class="p">)</span>
<span class="n">FindArg</span><span class="o">[</span><span class="n">n_</span><span class="o">]</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span>
<span class="w"> </span><span class="k">Module</span><span class="o">[</span><span class="n">{a}, a = a /. Last@NMaximize[{f[a, n</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="err">]</span><span class="o">[</span><span class="n">[2</span><span class="o">]</span><span class="err">]</span><span class="p">;</span><span class="w"> </span><span class="n">a</span><span class="err">]</span>
<span class="p">(</span><span class="o">*</span><span class="n">ç»™å®šnçš„èŒƒå›´</span><span class="o">*</span><span class="p">)</span>
<span class="n">nRange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">40</span><span class="o">*</span><span class="k">Range</span><span class="o">[</span><span class="n">1, 500</span><span class="o">]</span><span class="p">;</span>
<span class="p">(</span><span class="o">*</span><span class="n">æ±‚å‡ºæ¯ä¸ªnå¯¹åº”çš„a</span><span class="o">*</span><span class="p">)</span>
<span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindArg</span><span class="w"> </span><span class="o">/</span><span class="err">@</span><span class="w"> </span><span class="n">nRange</span><span class="p">;</span>
<span class="p">(</span><span class="o">*</span><span class="n">ç”»å‡ºaä¸nçš„å‡½æ•°å›¾åƒ</span><span class="o">*</span><span class="p">)</span>
<span class="n">ListLinePlot</span><span class="o">[</span><span class="n">{args, 0.84*Log[nRange</span><span class="o">]^</span><span class="mf">0.5</span><span class="err">}</span><span class="p">,</span><span class="w"> </span>
<span class="w"> </span><span class="n">DataRange</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">{</span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="mi">20000</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="n">AxesLabel</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;n&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;a&quot;</span><span class="err">}</span><span class="p">,</span><span class="w"> </span>
<span class="w"> </span><span class="n">PlotLegends</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">{</span><span class="k">Row</span><span class="o">[</span><span class="n">{&quot;a&quot;, Superscript[&quot;&quot;, &quot;*&quot;</span><span class="o">]</span><span class="err">}]</span><span class="p">,</span><span class="w"> </span>
<span class="w">   </span><span class="n">TraditionalForm</span><span class="o">[</span><span class="n">HoldForm[0.84*Sqrt[Log[n</span><span class="o">]</span><span class="err">]]]}]</span>
</code></pre></div>

<p>ç»è¿‡æ‹Ÿåˆï¼Œç¬”è€…å‘ç°ä¸€å®šèŒƒå›´å†…æœ€ä¼˜ç‚¹$\alpha^*$ä¸$n$å¤§è‡´æ»¡è¶³$\alpha\approx 0.84\sqrt{\log n}$çš„å…³ç³»ï¼Œæ‰€ä»¥ä¹Ÿå·²ç»å°†å¯¹åº”çš„è¿‘ä¼¼å‡½æ•°ä¸€å¹¶ç”»åœ¨ä¸€èµ·ï¼š  </p>
<p><a href="/usr/uploads/2023/10/4069707715.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„æœ€ä¼˜alphaä¸nå…³ç³»" src="/usr/uploads/2023/10/4069707715.png" /></a></p>
<p>æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„æœ€ä¼˜alphaä¸nå…³ç³»</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ç›¸å½“å¤§çš„ä¸€ä¸ªèŒƒå›´å†…ï¼Œ$\alpha^*$çš„æœ€ä¼˜å€¼éƒ½åœ¨$2\sim 3$ä¹‹é—´ï¼Œæ‰€ä»¥æŠ˜ä¸­ä¸€ä¸‹çš„è¯ï¼Œç›²å–$\frac{2.5}{\sqrt{d}}$ä½œä¸ºAttentionçš„Scaleå› å­ç†è®ºä¸Šæ›´æœ‰åˆ©äºä¼˜åŒ–ã€‚</p>
<h2 id="_4">ä½™å¼¦åˆ†å¸ƒ</h2>
<p>ç°åœ¨æˆ‘ä»¬è€ƒè™‘å¦ä¸€ä¸ªä¸é‚£ä¹ˆå¸¸è§çš„ä¾‹å­ï¼šå½“æˆ‘ä»¬å¯¹$\boldsymbol{q},\boldsymbol{k}$éƒ½åš$l_2$å½’ä¸€åŒ–å˜æˆå•ä½å‘é‡åï¼Œå®ƒä»¬çš„å†…ç§¯å°±å˜æˆäº†å¤¹è§’ä½™å¼¦ï¼Œå³$s_i$è¿‘ä¼¼æœä»$d$ç»´ç©ºé—´ä¸­çš„ä¸¤ä¸ªéšæœºå‘é‡çš„å¤¹è§’ä½™å¼¦åˆ†å¸ƒã€‚è¿™ä¸ªåˆ†å¸ƒå¯èƒ½æœ‰äº›è¯»è€…å¹¶ä¸ç†Ÿæ‚‰ï¼Œä½†ä¹‹å‰æˆ‘ä»¬åœ¨<a href="/archives/7076">ã€Šnç»´ç©ºé—´ä¸‹ä¸¤ä¸ªéšæœºå‘é‡çš„å¤¹è§’åˆ†å¸ƒã€‹</a>å·²ç»æ¢è®¨è¿‡ï¼Œå®ƒçš„æ¦‚ç‡å¯†åº¦å…·æœ‰å½¢å¼<br />
\begin{equation}p(s)\propto (1-s^2)^{(d-3)/2}\end{equation}</p>
<p>çœ‹ä¸Šå»å¹¶ä¸å¤æ‚ï¼Œä½†äº‹å®ä¸Šè¿™ä¸ªå½¢å¼æ¯”æ­£æ€åˆ†å¸ƒéš¾å¤„ç†å¾—å¤šï¼Œä¸»è¦æ˜¯$\mathbb{E}_s[e^{\alpha s}]$å·²ç»ä¸åƒå¼$\eqref{eq:normal}$é‚£æ ·å¯ä»¥ç”¨åˆç­‰å‡½æ•°è¡¨è¾¾å‡ºæ¥äº†ï¼Œä¸è¿‡å¯¹äºMathematicaæ•°å€¼æ±‚è§£æ¥è¯´é—®é¢˜ä¸å¤§ã€‚è·Ÿä¸Šä¸€èŠ‚åŒæ ·çš„æ€è·¯ï¼Œè¿‘ä¼¼å¼$\eqref{eq:approx}$ä¹ŸåŒæ ·é€‚ç”¨ï¼Œå…ˆæ•°å€¼æ±‚è§£æœ€å¤§å€¼ï¼Œç„¶åå†æ‹Ÿåˆï¼Œç»“æœå¦‚ä¸‹ï¼ˆå›¾ä¸­$d=128$ï¼Œ$\alpha^*$è·Ÿ$d$ç›¸å…³ï¼‰ï¼š  </p>
<p><a href="/usr/uploads/2023/10/4082251077.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="ä½™å¼¦åˆ†å¸ƒçš„æœ€ä¼˜alphaä¸nå…³ç³»" src="/usr/uploads/2023/10/4082251077.png" /></a></p>
<p>ä½™å¼¦åˆ†å¸ƒçš„æœ€ä¼˜alphaä¸nå…³ç³»</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ$\alpha^<em>$ä¸$3.5\log n$æ‹Ÿåˆå¾—ä¹Ÿä¸é”™ï¼ˆæ¢ä¸€ä¸ª$d$çš„è¯ï¼Œ$3.5$è¿™ä¸ªç³»æ•°ä¼šå˜åŒ–ï¼‰ã€‚å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä¸€ä¸ªç›¸å½“å¤§çš„èŒƒå›´å†…ï¼Œ$\alpha^</em>$éƒ½æ˜¯$25\sim 35$ä¹‹é—´ï¼Œæ‰€ä»¥å¦‚æœç”¨$\cos$å€¼ä½œä¸ºAttention Scoreçš„è¯ï¼Œå°±éœ€è¦ä¹˜ä»¥ä¸€ä¸ª$25\sim 35$ä¹‹é—´çš„Scaleï¼Œæ‰èƒ½ä½¿å¾—æ¨¡å‹æ¯”è¾ƒå®¹æ˜“è®­ä¸‹å»ã€‚è¿™åŒæ—¶ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨ç”¨$\cos$å€¼æ„å»ºSoftmaxåˆ†å¸ƒï¼ˆæ¯”å¦‚<a href="/archives/5743#am-softmax">AM-Softmax</a>ã€<a href="/archives/8348">SimCSE</a>ç­‰ï¼‰æ—¶ï¼Œéœ€è¦åœ¨$\cos$ä¹‹åä¹˜ä¸Šä¸€ä¸ª30å·¦å³çš„Scaleäº†ï¼Œå› ä¸ºä¸ä¹˜æ˜¯å¾ˆéš¾è®­å¾—åŠ¨æ¨¡å‹çš„ã€‚</p>
<p>å¯¹äºä¸åŒçš„$d$å’Œ$n$ï¼Œè¯»è€…å¯ä»¥è‡ªè¡Œä¿®æ”¹ä¸‹é¢çš„ä»£ç è®¡ç®—æœ€ä¼˜$\alpha$ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="o">*</span><span class="n">å®šä¹‰å‡½æ•°</span><span class="o">*</span><span class="p">)</span>
<span class="n">h</span><span class="o">[</span><span class="n">a_</span><span class="o">]</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span>
<span class="w"> </span><span class="n">Integrate</span><span class="o">[</span><span class="n">Exp[a*s</span><span class="o">]*</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">s</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span><span class="o">^</span><span class="p">((</span><span class="n">d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="err">{</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="err">}</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="n">Assumptions</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">{</span><span class="n">d</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10</span><span class="err">}]</span>
<span class="n">g</span><span class="o">[</span><span class="n">a_</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="o">[</span><span class="n">a</span><span class="o">]/</span><span class="n">h</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">FullSimplify</span><span class="p">;</span>
<span class="n">f</span><span class="o">[</span><span class="n">a_, n_</span><span class="o">]</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">g</span><span class="o">[</span><span class="n">2*a</span><span class="o">]/</span><span class="n">g</span><span class="o">[</span><span class="n">a</span><span class="o">]^</span><span class="mi">2</span><span class="o">/</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="p">.</span><span class="w"> </span><span class="err">{</span><span class="n">d</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mi">128</span><span class="err">}</span>
<span class="p">(</span><span class="o">*</span><span class="n">æ‰¾åˆ°å‡½æ•°çš„æœ€å¤§ç‚¹å¯¹åº”çš„a</span><span class="o">*</span><span class="p">)</span>
<span class="n">FindArg</span><span class="o">[</span><span class="n">n_</span><span class="o">]</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span>
<span class="w"> </span><span class="k">Module</span><span class="o">[</span><span class="n">{a}, a = a /. Last@NMaximize[{f[a, n</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="err">]</span><span class="o">[</span><span class="n">[2</span><span class="o">]</span><span class="err">]</span><span class="p">;</span><span class="w"> </span><span class="n">a</span><span class="err">]</span>
<span class="p">(</span><span class="o">*</span><span class="n">ç»™å®šnçš„èŒƒå›´</span><span class="o">*</span><span class="p">)</span>
<span class="n">nRange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">40</span><span class="o">*</span><span class="k">Range</span><span class="o">[</span><span class="n">1, 500</span><span class="o">]</span><span class="p">;</span>
<span class="p">(</span><span class="o">*</span><span class="n">æ±‚å‡ºæ¯ä¸ªnå¯¹åº”çš„a</span><span class="o">*</span><span class="p">)</span>
<span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindArg</span><span class="w"> </span><span class="o">/</span><span class="err">@</span><span class="w"> </span><span class="n">nRange</span><span class="p">;</span>
<span class="p">(</span><span class="o">*</span><span class="n">ç”»å‡ºaä¸nçš„å‡½æ•°å›¾åƒ</span><span class="o">*</span><span class="p">)</span>
<span class="n">ListLinePlot</span><span class="o">[</span><span class="n">{args, 3.5*Log[nRange</span><span class="o">]</span><span class="err">}</span><span class="p">,</span><span class="w"> </span>
<span class="w"> </span><span class="n">DataRange</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">{</span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="mi">20000</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="n">AxesLabel</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;n&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;a&quot;</span><span class="err">}</span><span class="p">,</span><span class="w"> </span>
<span class="w"> </span><span class="n">PlotLegends</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">{</span><span class="k">Row</span><span class="o">[</span><span class="n">{&quot;a&quot;, Superscript[&quot;&quot;, &quot;*&quot;</span><span class="o">]</span><span class="err">}]</span><span class="p">,</span><span class="w"> </span>
<span class="w">   </span><span class="n">TraditionalForm</span><span class="o">[</span><span class="n">HoldForm[3.5*Log[n</span><span class="o">]</span><span class="err">]]}]</span>
</code></pre></div>

<h2 id="_5">ç›¸å…³æ€è€ƒ</h2>
<p>æœ¬æ–‡çš„æ ‡é¢˜å’Œç»“æœï¼Œå°¤å…¶æ˜¯ä½™å¼¦åˆ†å¸ƒä¸­$\alpha$è¿‘ä¼¼æ­£æ¯”äº$\log n$çš„ç»“æœï¼Œå¾ˆå®¹æ˜“è®©æˆ‘ä»¬è”æƒ³åˆ°å¦ä¸€ç¯‡è®¨è®ºAttention Scaleçš„æ–‡ç« <a href="/archives/8823">ã€Šä»ç†µä¸å˜æ€§çœ‹Attentionçš„Scaleæ“ä½œã€‹</a>ã€‚äº‹å®ä¸Šï¼Œä¸¤ç¯‡æ–‡ç« çš„è”ç³»ç¡®å®å­˜åœ¨ï¼Œæœ¬æ–‡çš„ä¼˜åŒ–ç›®æ ‡$\eqref{eq:target}$å‡ºç°äº†â€œRÃ©nyiç†µâ€ï¼Œè€Œâ€œç†µä¸å˜æ€§â€çš„ç†µæŒ‡çš„æ˜¯é¦™ä¾¬ä¿¡æ¯ç†µï¼Œä¸¤è€…çš„æ€§è´¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ä¸€è‡´çš„ã€‚æœ€å¤§åŒ–å¼$\eqref{eq:target}$ä½¿å¾—å®ƒè¿›å…¥äº†ä¸€ä¸ªâ€œç¼“å˜â€çš„åŒºåŸŸï¼Œè¿™æ„å‘³ç€â€œRÃ©nyiç†µâ€å…³äº$n$çš„å˜åŒ–æ˜¯å¾ˆæ…¢çš„ï¼Œä¹Ÿæ„å‘³ç€ä¿¡æ¯ç†µå…³äº$n$çš„å˜åŒ–æ˜¯å¾ˆæ…¢çš„ï¼Œè¿™å°±çº¦ç­‰äºç†µä¸å˜æ€§ã€‚</p>
<p>æ­¤å¤–ï¼Œå¯¹äºåŒå‘Attentionï¼ˆEncoderï¼‰æ¥è¯´ï¼Œå‡è®¾è®­ç»ƒæ ·æœ¬é•¿åº¦ç›¸åŒï¼Œé‚£ä¹ˆ$n$å°±æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®$n$ç®—å¾—ç›¸åº”çš„æœ€ä¼˜$\alpha$ï¼Œç„¶åå›ºå®šåœ¨æ¨¡å‹ä¸­å³å¯ï¼›ä½†æ˜¯å¯¹äºå•å‘Attentionï¼ˆDecoderï¼‰æ¥è¯´ï¼Œæ¯ä¸ªtokençš„$n$å®é™…ä¸Šéƒ½ä¸ä¸€æ ·ï¼ˆä½ç½®idåŠ 1ï¼‰ï¼Œæ‰€ä»¥ç†è®ºä¸Šæ— æ³•åšåˆ°å¯¹æ‰€æœ‰tokenéƒ½æœ€å¤§åŒ–å¼$\eqref{eq:target}$ï¼Œä¸è¿‡ç”±äº$\alpha^*$å…³äº$n$çš„å˜åŒ–è¾ƒæ…¢ï¼Œæ‰€ä»¥å–ä¸€ä¸ªå·®ä¸å¤šçš„å€¼å°±è¡Œäº†ï¼Œæ¯”å¦‚å¯ä»¥å–$n=L_{\max} / 2$ï¼Œè¿™æ ·å¯¹å¤§éƒ¨åˆ†tokençš„æ¢¯åº¦éƒ½æ¯”è¾ƒå‹å¥½äº†ã€‚</p>
<h2 id="_6">æ–‡ç« å°ç»“</h2>
<p>æœ¬æ–‡ä»æ¢¯åº¦çš„è§’åº¦æ¢è®¨äº†Attention Scaleå› å­çš„é€‰æ‹©é—®é¢˜ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œå…³äºè¿™ä¸ªScaleå› å­çš„â€œæ ‡å‡†ç­”æ¡ˆâ€æ˜¯$\frac{1}{\sqrt{d}}$ï¼Œä½†å…¶æ¨å¯¼è¿‡ç¨‹ä¸­å¹¶æ²¡æœ‰è®¨è®ºåˆ°å®ƒçš„æœ€ä¼˜æ€§é—®é¢˜ï¼Œæ‰€ä»¥ç¬”è€…å®šä¹‰äº†ä¸€ä¸ªSoftmaxæ¢¯åº¦çš„ä¼˜åŒ–ç›®æ ‡ï¼Œä»æœ€å¤§åŒ–è¯¥ç›®æ ‡çš„è§’åº¦æ¢è®¨äº†Scaleå› å­çš„æœ€ä¼˜å€¼ã€‚ç›¸å…³ç»“æœæ—¢å¯ä»¥ç”¨æ¥æ”¹è¿›Attentionçš„Scaleå› å­ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥è§£é‡Š$\cos$ç›¸ä¼¼åº¦çš„å¯¹æ¯”å­¦ä¹ çš„æ¸©åº¦å‚æ•°ã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/9812">https://spaces.ac.cn/archives/9812</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Oct. 22, 2023). ã€Šä»æ¢¯åº¦æœ€å¤§åŒ–çœ‹Attentionçš„Scaleæ“ä½œ ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/9812">https://spaces.ac.cn/archives/9812</a></p>
<p>@online{kexuefm-9812,<br />
title={ä»æ¢¯åº¦æœ€å¤§åŒ–çœ‹Attentionçš„Scaleæ“ä½œ},<br />
author={è‹å‰‘æ—},<br />
year={2023},<br />
month={Oct},<br />
url={\url{https://spaces.ac.cn/archives/9812}},<br />
} </p>
<hr />
<h2 id="_7">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<h3 id="1-softmax">1. Softmaxæ¢¯åº¦çš„å®Œæ•´æ¨å¯¼</h3>
<h4 id="11">1.1 é—®é¢˜è®¾å®š</h4>
<p>ç»™å®šlogits $s = (s_1, \ldots, s_n) \in \mathbb{R}^n$ï¼ŒSoftmaxå‡½æ•°å®šä¹‰ä¸ºï¼š
\begin{equation}
p_i = \frac{e^{\alpha s_i}}{\sum_{j=1}^n e^{\alpha s_j}} = \frac{e^{\alpha s_i}}{Z(\alpha)} \tag{1}
\end{equation}</p>
<p>å…¶ä¸­ $\alpha &gt; 0$ æ˜¯æ¸©åº¦å‚æ•°çš„å€’æ•°ï¼ˆç¼©æ”¾å› å­ï¼‰ï¼Œ$Z(\alpha) = \sum_j e^{\alpha s_j}$ æ˜¯é…åˆ†å‡½æ•°ã€‚</p>
<p><strong>é—®é¢˜</strong>ï¼šå¦‚ä½•é€‰æ‹© $\alpha$ ä½¿å¾—Softmaxçš„æ¢¯åº¦æœ€å¤§ï¼Œä»è€Œæœ‰åˆ©äºè®­ç»ƒï¼Ÿ</p>
<h4 id="12-softmaxlogits">1.2 Softmaxå¯¹logitsçš„æ¢¯åº¦</h4>
<p>è®¡ç®— $\frac{\partial p_i}{\partial s_j}$ï¼š
\begin{equation}
\frac{\partial p_i}{\partial s_j} = \frac{\partial}{\partial s_j}\left(\frac{e^{\alpha s_i}}{Z}\right) = \frac{\partial e^{\alpha s_i}}{\partial s_j} \cdot \frac{1}{Z} + e^{\alpha s_i} \cdot \frac{\partial}{\partial s_j}\left(\frac{1}{Z}\right) \tag{2}
\end{equation}</p>
<p><strong>ç¬¬ä¸€é¡¹</strong>ï¼š
\begin{equation}
\frac{\partial e^{\alpha s_i}}{\partial s_j} = \alpha e^{\alpha s_i} \delta_{ij} \tag{3}
\end{equation}</p>
<p>å…¶ä¸­ $\delta_{ij}$ æ˜¯Kronecker deltaã€‚</p>
<p><strong>ç¬¬äºŒé¡¹</strong>ï¼š
\begin{equation}
\frac{\partial}{\partial s_j}\left(\frac{1}{Z}\right) = -\frac{1}{Z^2}\frac{\partial Z}{\partial s_j} = -\frac{1}{Z^2} \alpha e^{\alpha s_j} = -\frac{\alpha p_j}{Z} \tag{4}
\end{equation}</p>
<p>åˆå¹¶ï¼š
\begin{equation}
\frac{\partial p_i}{\partial s_j} = \frac{\alpha e^{\alpha s_i}\delta_{ij}}{Z} - \frac{\alpha e^{\alpha s_i} e^{\alpha s_j}}{Z^2} = \alpha p_i(\delta_{ij} - p_j) \tag{5}
\end{equation}</p>
<p><strong>æ€»ç»“</strong>ï¼š
\begin{equation}
\frac{\partial p_i}{\partial s_j} = \begin{cases}
\alpha p_i(1 - p_i) &amp; i = j \
-\alpha p_i p_j &amp; i \neq j
\end{cases} \tag{6}
\end{equation}</p>
<h4 id="13-jacobian">1.3 JacobiançŸ©é˜µ</h4>
<p>Softmaxçš„JacobiançŸ©é˜µ $J \in \mathbb{R}^{n \times n}$ï¼š
\begin{equation}
J_{ij} = \frac{\partial p_i}{\partial s_j} = \alpha(p_i\delta_{ij} - p_i p_j) = \alpha(\text{diag}(p) - pp^{\top}) \tag{7}
\end{equation}</p>
<p><strong>æ€§è´¨1ï¼ˆå¯¹ç§°æ€§ï¼‰</strong>ï¼šæ³¨æ„ $J$ ä¸æ˜¯å¯¹ç§°çŸ©é˜µï¼Œå› ä¸º $J_{ij} = -\alpha p_i p_j$ è€Œ $J_{ji} = -\alpha p_j p_i$ï¼Œåªæœ‰å½“ $p_i = p_j$ æ—¶ç›¸ç­‰ã€‚</p>
<p><strong>æ€§è´¨2ï¼ˆç§©ï¼‰</strong>ï¼š$pp^{\top}$ æ˜¯ç§©1çŸ©é˜µï¼Œå› æ­¤ $J$ çš„ç§©æœ€å¤šä¸º $n$ã€‚</p>
<p><strong>æ€§è´¨3ï¼ˆç‰¹å¾å€¼ï¼‰</strong>ï¼š$J$ çš„ç‰¹å¾å€¼å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¡ç®—ã€‚ä»¤ $v$ æ˜¯ $J$ çš„ç‰¹å¾å‘é‡ï¼Œç‰¹å¾å€¼ä¸º $\lambda$ï¼š
\begin{equation}
Jv = \alpha(\text{diag}(p)v - pp^{\top}v) = \lambda v \tag{8}
\end{equation}</p>
<p>å¦‚æœ $p^{\top}v = 0$ï¼ˆ$v$ æ­£äº¤äº $p$ï¼‰ï¼Œåˆ™ï¼š
\begin{equation}
\alpha\text{diag}(p)v = \lambda v \implies \lambda = \alpha p_i \quad \text{(å¯¹åº”äº } v_i \neq 0\text{)} \tag{9}
\end{equation}</p>
<p>å› æ­¤ $J$ æœ‰ $n-1$ ä¸ªç‰¹å¾å€¼ $\alpha p_i$ï¼Œä»¥åŠä¸€ä¸ªç‰¹å¾å€¼0ï¼ˆå¯¹åº”äº $v \propto \mathbf{1}$ï¼‰ã€‚</p>
<h3 id="2">2. æ¢¯åº¦èŒƒæ•°çš„ä¼˜åŒ–ç›®æ ‡</h3>
<h4 id="21-l1">2.1 L1èŒƒæ•°ä½œä¸ºä¼˜åŒ–ç›®æ ‡</h4>
<p>ä¸ºäº†æœ€å¤§åŒ–æ¢¯åº¦ï¼Œæˆ‘ä»¬å®šä¹‰ç›®æ ‡å‡½æ•°ï¼š
\begin{equation}
G(\alpha) = |J|<em i_j="i,j">1 = \sum</em>
\end{equation}} |J_{ij}| = \sum_{i,j} \left|\frac{\partial p_i}{\partial s_j}\right| \tag{10</p>
<p>å±•å¼€ï¼š
\begin{equation}
G(\alpha) = \sum_{i=1}^n \left|\alpha p_i(1-p_i)\right| + \sum_{i \neq j} \left|-\alpha p_i p_j\right| \tag{11}
\end{equation}</p>
<p>ç”±äº $p_i \in (0, 1)$ï¼Œæ‰€æœ‰é¡¹éƒ½æ˜¯æ­£çš„ï¼š
\begin{equation}
G(\alpha) = \sum_{i=1}^n \alpha p_i(1-p_i) + \sum_{i \neq j} \alpha p_i p_j \tag{12}
\end{equation}</p>
<p><strong>ç®€åŒ–ç¬¬ä¸€é¡¹</strong>ï¼š
\begin{equation}
\sum_{i=1}^n p_i(1-p_i) = \sum_{i=1}^n p_i - \sum_{i=1}^n p_i^2 = 1 - \sum_{i=1}^n p_i^2 \tag{13}
\end{equation}</p>
<p><strong>ç®€åŒ–ç¬¬äºŒé¡¹</strong>ï¼š
\begin{equation}
\sum_{i \neq j} p_i p_j = \sum_{i,j} p_i p_j - \sum_{i=1}^n p_i^2 = \left(\sum_i p_i\right)^2 - \sum_{i=1}^n p_i^2 = 1 - \sum_{i=1}^n p_i^2 \tag{14}
\end{equation}</p>
<p><strong>åˆå¹¶</strong>ï¼š
\begin{equation}
G(\alpha) = \alpha\left[\left(1 - \sum_i p_i^2\right) + \left(1 - \sum_i p_i^2\right)\right] = 2\alpha\left(1 - \sum_i p_i^2\right) \tag{15}
\end{equation}</p>
<p>å®šä¹‰<strong>æœ‰æ•ˆç±»åˆ«æ•°</strong>ï¼ˆEffective Number of Classesï¼‰ï¼š
\begin{equation}
N_{\text{eff}}(\alpha) = \frac{1}{\sum_i p_i^2} \tag{16}
\end{equation}</p>
<p>åˆ™ï¼š
\begin{equation}
G(\alpha) = 2\alpha\left(1 - \frac{1}{N_{\text{eff}}}\right) = 2\alpha \frac{N_{\text{eff}} - 1}{N_{\text{eff}}} \tag{17}
\end{equation}</p>
<p><strong>RÃ©nyiç†µè”ç³»</strong>ï¼š$\sum_i p_i^2$ æ˜¯2é˜¶RÃ©nyiç†µçš„æŒ‡æ•°å½¢å¼ï¼š
\begin{equation}
H_2(p) = -\log\sum_i p_i^2 \tag{18}
\end{equation}</p>
<p>å› æ­¤ï¼š
\begin{equation}
G(\alpha) = 2\alpha(1 - e^{-H_2(p)}) \tag{19}
\end{equation}</p>
<h4 id="22">2.2 ç›®æ ‡å‡½æ•°çš„ä¾èµ–å…³ç³»</h4>
<p>æ³¨æ„ $p_i$ æœ¬èº«ä¾èµ–äº $\alpha$ï¼š
\begin{equation}
p_i(\alpha) = \frac{e^{\alpha s_i}}{\sum_j e^{\alpha s_j}} \tag{20}
\end{equation}</p>
<p>å› æ­¤ $\sum_i p_i^2$ ä¹Ÿæ˜¯ $\alpha$ çš„å‡½æ•°ã€‚æˆ‘ä»¬éœ€è¦åˆ†æï¼š
\begin{equation}
f(\alpha) = \sum_{i=1}^n p_i(\alpha)^2 = \sum_{i=1}^n \frac{e^{2\alpha s_i}}{Z(\alpha)^2} \tag{21}
\end{equation}</p>
<p>å…¶å¯¼æ•°ï¼š
\begin{equation}
\frac{df}{d\alpha} = \frac{d}{d\alpha}\left[\frac{\sum_i e^{2\alpha s_i}}{(\sum_j e^{\alpha s_j})^2}\right] \tag{22}
\end{equation}</p>
<p>ä½¿ç”¨å•†æ³•åˆ™ï¼š
\begin{equation}
\frac{df}{d\alpha} = \frac{2\sum_i s_i e^{2\alpha s_i} \cdot Z^2 - \sum_i e^{2\alpha s_i} \cdot 2Z \cdot \alpha\sum_j s_j e^{\alpha s_j}}{Z^4} \tag{23}
\end{equation}</p>
<p>ç®€åŒ–ï¼ˆä»¤ $Z = \sum_j e^{\alpha s_j}$ï¼‰ï¼š
\begin{equation}
\frac{df}{d\alpha} = \frac{2}{Z^2}\left[\sum_i s_i e^{2\alpha s_i} - \frac{\sum_i e^{2\alpha s_i} \cdot \sum_j s_j e^{\alpha s_j}}{Z}\right] \tag{24}
\end{equation}</p>
<p><strong>è§‚å¯Ÿ</strong>ï¼šå½“ $\alpha \to 0$ æ—¶ï¼Œ$p_i \to 1/n$ï¼ˆå‡åŒ€åˆ†å¸ƒï¼‰ï¼Œ$f(0) = 1/n$ã€‚
å½“ $\alpha \to \infty$ æ—¶ï¼Œ$p_i \to \delta_{i,i^*}$ï¼ˆone-hotåœ¨æœ€å¤§çš„ $s_i$ï¼‰ï¼Œ$f(\infty) = 1$ã€‚</p>
<h3 id="3">3. æ­£æ€åˆ†å¸ƒä¸‹çš„æœ€ä¼˜Î±</h3>
<h4 id="31">3.1 å‡è®¾ä¸è¿‘ä¼¼</h4>
<p>å‡è®¾ $s_i \sim \mathcal{N}(0, 1)$ ç‹¬ç«‹åŒåˆ†å¸ƒã€‚ä½¿ç”¨æœŸæœ›è¿‘ä¼¼ï¼š
\begin{equation}
\sum_i p_i^2 = \frac{\sum_i e^{2\alpha s_i}}{(\sum_j e^{\alpha s_j})^2} \approx \frac{n \cdot \mathbb{E}[e^{2\alpha s}]}{(n \cdot \mathbb{E}[e^{\alpha s}])^2} = \frac{\mathbb{E}[e^{2\alpha s}]}{n(\mathbb{E}[e^{\alpha s}])^2} \tag{25}
\end{equation}</p>
<p>å¯¹äº $s \sim \mathcal{N}(0, 1)$ï¼š
\begin{equation}
\mathbb{E}[e^{\alpha s}] = \int_{-\infty}^{\infty} \frac{1}{\sqrt{2\pi}} e^{-s^2/2} e^{\alpha s} ds \tag{26}
\end{equation}</p>
<p>é…æ–¹ï¼š
\begin{equation}
-\frac{s^2}{2} + \alpha s = -\frac{1}{2}(s - \alpha)^2 + \frac{\alpha^2}{2} \tag{27}
\end{equation}</p>
<p>å› æ­¤ï¼š
\begin{equation}
\mathbb{E}[e^{\alpha s}] = e^{\alpha^2/2} \int_{-\infty}^{\infty} \frac{1}{\sqrt{2\pi}} e^{-(s-\alpha)^2/2} ds = e^{\alpha^2/2} \tag{28}
\end{equation}</p>
<p>ç±»ä¼¼åœ°ï¼š
\begin{equation}
\mathbb{E}[e^{2\alpha s}] = e^{(2\alpha)^2/2} = e^{2\alpha^2} \tag{29}
\end{equation}</p>
<p>ä»£å…¥å¼(25)ï¼š
\begin{equation}
\sum_i p_i^2 \approx \frac{e^{2\alpha^2}}{n \cdot e^{\alpha^2}} = \frac{e^{\alpha^2}}{n} \tag{30}
\end{equation}</p>
<h4 id="32">3.2 ä¼˜åŒ–ç›®æ ‡</h4>
<p>ç›®æ ‡å‡½æ•°å˜ä¸ºï¼š
\begin{equation}
G(\alpha) = 2\alpha\left(1 - \frac{e^{\alpha^2}}{n}\right) \tag{31}
\end{equation}</p>
<p><strong>è¾¹ç•Œè¡Œä¸º</strong>ï¼š
- $\alpha \to 0$ï¼š$G(\alpha) \approx 2\alpha(1 - 1/n) \to 0$
- $\alpha \to \infty$ï¼š$G(\alpha) \approx -2\alpha e^{\alpha^2}/n \to -\infty$</p>
<p>å› æ­¤å­˜åœ¨æœ€å¤§å€¼ç‚¹ã€‚</p>
<h4 id="33">3.3 ä¸€é˜¶æ¡ä»¶</h4>
<p>æ±‚å¯¼ï¼š
\begin{equation}
\frac{dG}{d\alpha} = 2\left(1 - \frac{e^{\alpha^2}}{n}\right) + 2\alpha \cdot \left(-\frac{2\alpha e^{\alpha^2}}{n}\right) = 2\left(1 - \frac{e^{\alpha^2}}{n}(1 + 2\alpha^2)\right) \tag{32}
\end{equation}</p>
<p>ä»¤ $\frac{dG}{d\alpha} = 0$ï¼š
\begin{equation}
1 - \frac{e^{\alpha^2}}{n}(1 + 2\alpha^2) = 0 \tag{33}
\end{equation}</p>
<p>å³ï¼š
\begin{equation}
e^{\alpha^2}(1 + 2\alpha^2) = n \tag{34}
\end{equation}</p>
<p>è¿™æ˜¯ä¸€ä¸ªè¶…è¶Šæ–¹ç¨‹ï¼Œæ²¡æœ‰è§£æè§£ï¼Œä½†å¯ä»¥æ•°å€¼æ±‚è§£ã€‚</p>
<h4 id="34">3.4 è¿‘ä¼¼è§£</h4>
<p>å¯¹äºå¤§çš„ $n$ï¼Œä½¿ç”¨å¯¹æ•°ï¼š
\begin{equation}
\alpha^2 + \log(1 + 2\alpha^2) = \log n \tag{35}
\end{equation}</p>
<p>å½“ $\alpha^2$ é€‚ä¸­æ—¶ï¼Œ$\log(1 + 2\alpha^2) \approx 2\alpha^2$ï¼ˆå¯¹å° $\alpha^2$ï¼‰æˆ– $\log(2\alpha^2)$ï¼ˆå¯¹å¤§ $\alpha^2$ï¼‰ã€‚</p>
<p><strong>çŒœæµ‹å½¢å¼</strong>ï¼š$\alpha \approx c\sqrt{\log n}$ã€‚ä»£å…¥ï¼š
\begin{equation}
c^2\log n + \log(1 + 2c^2\log n) \approx \log n \tag{36}
\end{equation}</p>
<p>å½“ $n$ å¤§æ—¶ï¼Œç¬¬äºŒé¡¹ç›¸å¯¹è¾ƒå°ï¼Œå¾— $c^2 \approx 1$ï¼Œå³ï¼š
\begin{equation}
\alpha^* \approx \sqrt{\log n} \tag{37}
\end{equation}</p>
<p><strong>æ•°å€¼æ‹Ÿåˆ</strong>ï¼šé€šè¿‡Mathematicaæ•°å€¼æ±‚è§£ï¼Œå¾—åˆ°ï¼š
\begin{equation}
\alpha^*(n) \approx 0.84\sqrt{\log n} \tag{38}
\end{equation}</p>
<h4 id="35">3.5 äºŒé˜¶æ¡ä»¶éªŒè¯</h4>
<p>è®¡ç®—äºŒé˜¶å¯¼æ•°ï¼š
\begin{equation}
\frac{d^2G}{d\alpha^2} = -\frac{2e^{\alpha^2}}{n}(4\alpha^2 + 4\alpha^4 + 2) \tag{39}
\end{equation}</p>
<p>åœ¨ $\alpha^* &gt; 0$ å¤„ï¼Œ$\frac{d^2G}{d\alpha^2} &lt; 0$ï¼Œç¡®è®¤æ˜¯æœ€å¤§å€¼ã€‚</p>
<h3 id="4">4. ä½™å¼¦åˆ†å¸ƒä¸‹çš„æœ€ä¼˜Î±</h3>
<h4 id="41">4.1 ä½™å¼¦åˆ†å¸ƒçš„å®šä¹‰</h4>
<p>å½“ $q, k \in \mathbb{R}^d$ æ˜¯å½’ä¸€åŒ–å‘é‡æ—¶ï¼Œ$s = q \cdot k = \cos\theta$ï¼Œå…¶ä¸­ $\theta$ æ˜¯å¤¹è§’ã€‚</p>
<p>åœ¨ $d$ ç»´ç©ºé—´ä¸­ï¼Œéšæœºå•ä½å‘é‡çš„å¤¹è§’åˆ†å¸ƒä¸ºï¼š
\begin{equation}
p(\theta) \propto \sin^{d-2}\theta, \quad \theta \in [0, \pi] \tag{40}
\end{equation}</p>
<p>å½’ä¸€åŒ–å¸¸æ•°ï¼š
\begin{equation}
C_d = \frac{1}{\int_0^{\pi} \sin^{d-2}\theta d\theta} = \frac{\Gamma(d/2)}{\sqrt{\pi}\Gamma((d-1)/2)} \tag{41}
\end{equation}</p>
<p><strong>ä½™å¼¦çš„åˆ†å¸ƒ</strong>ï¼šä»¤ $s = \cos\theta$ï¼Œåˆ™ $ds = -\sin\theta d\theta$ï¼š
\begin{equation}
p(s) = C_d \sin^{d-2}\theta |d\theta/ds| = C_d \sin^{d-1}\theta = C_d (1-s^2)^{(d-2)/2}, \quad s \in [-1, 1] \tag{42}
\end{equation}</p>
<p>å½’ä¸€åŒ–ï¼š
\begin{equation}
\int_{-1}^{1} (1-s^2)^{(d-2)/2} ds = \frac{\sqrt{\pi}\Gamma((d-1)/2)}{\Gamma(d/2)} \tag{43}
\end{equation}</p>
<p>å› æ­¤ï¼š
\begin{equation}
p(s) = \frac{\Gamma(d/2)}{\sqrt{\pi}\Gamma((d-1)/2)} (1-s^2)^{(d-2)/2} \tag{44}
\end{equation}</p>
<h4 id="42">4.2 çŸ©ç”Ÿæˆå‡½æ•°</h4>
<p>éœ€è¦è®¡ç®—ï¼š
\begin{equation}
\mathbb{E}[e^{\alpha s}] = \int_{-1}^{1} e^{\alpha s} p(s) ds = \frac{\Gamma(d/2)}{\sqrt{\pi}\Gamma((d-1)/2)} \int_{-1}^{1} e^{\alpha s}(1-s^2)^{(d-2)/2} ds \tag{45}
\end{equation}</p>
<p>è¿™ä¸ªç§¯åˆ†ä¸<strong>ä¿®æ­£è´å¡å°”å‡½æ•°</strong>ï¼ˆModified Bessel Functionï¼‰æœ‰å…³ï¼š
\begin{equation}
I_{\nu}(z) = \sum_{m=0}^{\infty} \frac{(z/2)^{2m+\nu}}{m!\Gamma(m+\nu+1)} \tag{46}
\end{equation}</p>
<p>å…·ä½“åœ°ï¼Œå¯¹äºåŠæ•´æ•°é˜¶ $\nu = (d-2)/2$ï¼š
\begin{equation}
\mathbb{E}[e^{\alpha s}] = \frac{I_{(d-2)/2}(\alpha)}{\alpha^{(d-2)/2}} \cdot \frac{\Gamma(d/2)}{\Gamma(1/2)\Gamma((d-1)/2)} \tag{47}
\end{equation}</p>
<p><strong>ç®€åŒ–å½¢å¼</strong>ï¼ˆå¯¹å¤§ $d$ï¼‰ï¼šä½¿ç”¨æ¸è¿‘å±•å¼€ï¼š
\begin{equation}
I_{\nu}(z) \approx \frac{e^z}{\sqrt{2\pi z}}\left(1 - \frac{4\nu^2-1}{8z} + O(z^{-2})\right) \tag{48}
\end{equation}</p>
<h4 id="43">4.3 æ•°å€¼ä¼˜åŒ–</h4>
<p>ç”±äºè§£æè§£å¤æ‚ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•°å€¼æ–¹æ³•ã€‚å¯¹äº $d = 128$ï¼ˆå¸¸è§çš„Attentionç»´åº¦ï¼‰ï¼Œé€šè¿‡æ•°å€¼è®¡ç®—ï¼š</p>
<p><strong>æ­¥éª¤</strong>ï¼š
1. å¯¹æ¯ä¸ª $\alpha$ï¼Œæ•°å€¼è®¡ç®— $\mathbb{E}[e^{\alpha s}]$ å’Œ $\mathbb{E}[e^{2\alpha s}]$
2. è®¡ç®— $f(\alpha) = \mathbb{E}[e^{2\alpha s}] / (n(\mathbb{E}[e^{\alpha s}])^2)$
3. è®¡ç®— $G(\alpha) = 2\alpha(1 - f(\alpha))$
4. æ‰¾åˆ° $G(\alpha)$ çš„æœ€å¤§å€¼ç‚¹ $\alpha^*$</p>
<p><strong>ç»“æœ</strong>ï¼ˆ$d=128$ï¼‰ï¼š
\begin{equation}
\alpha^*(n) \approx 3.5\log n \tag{49}
\end{equation}</p>
<h4 id="44">4.4 ä¸åŒç»´åº¦çš„ä¾èµ–</h4>
<p>å¯¹äºä¸åŒçš„ $d$ï¼Œç³»æ•°ä¼šå˜åŒ–ï¼š</p>
<table>
<thead>
<tr>
<th>$d$</th>
<th>ç³»æ•° $c$ in $\alpha^* \approx c\log n$</th>
</tr>
</thead>
<tbody>
<tr>
<td>32</td>
<td>2.8</td>
</tr>
<tr>
<td>64</td>
<td>3.2</td>
</tr>
<tr>
<td>128</td>
<td>3.5</td>
</tr>
<tr>
<td>256</td>
<td>3.7</td>
</tr>
<tr>
<td>512</td>
<td>3.9</td>
</tr>
</tbody>
</table>
<p><strong>è§‚å¯Ÿ</strong>ï¼šç³»æ•°éš $d$ ç¼“æ…¢å¢é•¿ï¼Œçº¦ä¸º $c \approx \frac{d}{36}$ã€‚</p>
<h3 id="5">5. ç†è®ºåˆ†æä¸æ¨å¹¿</h3>
<h4 id="51">5.1 ä¸€èˆ¬åˆ†å¸ƒçš„æ¡†æ¶</h4>
<p>å¯¹äºä¸€èˆ¬åˆ†å¸ƒ $p(s)$ï¼Œå®šä¹‰ï¼š
\begin{equation}
M_k(\alpha) = \mathbb{E}[e^{k\alpha s}] = \int e^{k\alpha s} p(s) ds \tag{50}
\end{equation}</p>
<p>åˆ™ï¼š
\begin{equation}
f(\alpha) \approx \frac{M_2(\alpha)}{n \cdot M_1(\alpha)^2} \tag{51}
\end{equation}</p>
<p>ä¼˜åŒ–ç›®æ ‡ï¼š
\begin{equation}
G(\alpha) = 2\alpha\left(1 - \frac{M_2(\alpha)}{n \cdot M_1(\alpha)^2}\right) \tag{52}
\end{equation}</p>
<h4 id="52">5.2 æ¸è¿‘å±•å¼€</h4>
<p>å¯¹äºå° $\alpha$ï¼Œä½¿ç”¨Taylorå±•å¼€ï¼š
\begin{equation}
M_k(\alpha) = \mathbb{E}[e^{k\alpha s}] \approx 1 + k\alpha\mathbb{E}[s] + \frac{(k\alpha)^2}{2}\mathbb{E}[s^2] + O(\alpha^3) \tag{53}
\end{equation}</p>
<p>å‡è®¾ $\mathbb{E}[s] = 0$ï¼ˆå¯¹ç§°åˆ†å¸ƒï¼‰ï¼Œ$\mathbb{E}[s^2] = \sigma^2$ï¼š
\begin{equation}
M_1(\alpha) \approx 1 + \frac{\alpha^2\sigma^2}{2}, \quad M_2(\alpha) \approx 1 + 2\alpha^2\sigma^2 \tag{54}
\end{equation}</p>
<p>ä»£å…¥ï¼š
\begin{equation}
f(\alpha) \approx \frac{1 + 2\alpha^2\sigma^2}{n(1 + \alpha^2\sigma^2)^2} \approx \frac{1 + 2\alpha^2\sigma^2}{n(1 + 2\alpha^2\sigma^2 + \alpha^4\sigma^4)} \tag{55}
\end{equation}</p>
<p>å¯¹å° $\alpha$ï¼š
\begin{equation}
f(\alpha) \approx \frac{1}{n}(1 + 2\alpha^2\sigma^2)(1 - 2\alpha^2\sigma^2) \approx \frac{1}{n}(1 - 4\alpha^4\sigma^4) \tag{56}
\end{equation}</p>
<p>å› æ­¤ï¼š
\begin{equation}
G(\alpha) \approx 2\alpha\left(1 - \frac{1}{n}\right) + O(\alpha^5) \tag{57}
\end{equation}</p>
<p>è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆå° $\alpha$ æ—¶ $G$ è¿‘ä¼¼çº¿æ€§å¢é•¿ã€‚</p>
<h4 id="53">5.3 å¤§Î±çš„è¡Œä¸º</h4>
<p>å¯¹äºå¤§ $\alpha$ï¼ŒSoftmaxè¶‹å‘one-hotåˆ†å¸ƒåœ¨æœ€å¤§çš„ $s_i$ï¼š
\begin{equation}
p_i \approx \delta_{i, i^<em>}, \quad i^</em> = \arg\max_i s_i \tag{58}
\end{equation}</p>
<p>æ­¤æ—¶ï¼š
\begin{equation}
\sum_i p_i^2 \to 1 \tag{59}
\end{equation}</p>
<p>å› æ­¤ï¼š
\begin{equation}
G(\alpha) = 2\alpha(1 - 1) = 0 \tag{60}
\end{equation}</p>
<p><strong>æ¢¯åº¦æ¶ˆå¤±</strong>ï¼šè¿‡å¤§çš„ $\alpha$ å¯¼è‡´æ¢¯åº¦æ¶ˆå¤±ï¼</p>
<h3 id="6">6. ä¸ç†µä¸å˜æ€§çš„è”ç³»</h3>
<h4 id="61-shannon">6.1 Shannonç†µ</h4>
<p>Shannonç†µå®šä¹‰ä¸ºï¼š
\begin{equation}
H = -\sum_{i=1}^n p_i \log p_i \tag{61}
\end{equation}</p>
<p>ä»£å…¥ $p_i = \frac{e^{\alpha s_i}}{Z}$ï¼š
\begin{equation}
H = -\sum_i p_i(\alpha s_i - \log Z) = \log Z - \alpha \sum_i p_i s_i = \log Z - \alpha \mathbb{E}_p[s] \tag{62}
\end{equation}</p>
<h4 id="62-renyi">6.2 ç†µä¸RÃ©nyiç†µçš„å…³ç³»</h4>
<p>RÃ©nyiç†µæ—å®šä¹‰ä¸ºï¼š
\begin{equation}
H_{\beta} = \frac{1}{1-\beta}\log\sum_i p_i^{\beta} \tag{63}
\end{equation}</p>
<p>å½“ $\beta = 2$ï¼š
\begin{equation}
H_2 = -\log\sum_i p_i^2 \tag{64}
\end{equation}</p>
<p><strong>å…³ç³»</strong>ï¼š$H_2 \leq H_1 = H$ï¼ˆShannonç†µï¼‰ã€‚</p>
<p>æˆ‘ä»¬çš„ä¼˜åŒ–ç›®æ ‡ $G(\alpha) = 2\alpha(1 - e^{-H_2})$ ç›´æ¥ä¸ $H_2$ ç›¸å…³ã€‚</p>
<h4 id="63-vs">6.3 æœ€å¤§åŒ–æ¢¯åº¦ vs ç†µä¸å˜æ€§</h4>
<p><strong>æ¢¯åº¦æœ€å¤§åŒ–è§‚ç‚¹</strong>ï¼šé€‰æ‹© $\alpha$ ä½¿ $G(\alpha)$ æœ€å¤§ã€‚</p>
<p><strong>ç†µä¸å˜æ€§è§‚ç‚¹</strong>ï¼šé€‰æ‹© $\alpha$ ä½¿ $H$ å¯¹ $n$ ä¸æ•æ„Ÿã€‚</p>
<p><strong>è”ç³»</strong>ï¼šä¸¤è€…éƒ½è¦æ±‚ $\sum_i p_i^2$ å¤„äº"ä¸­é—´"çŠ¶æ€ï¼š
- å¤ªå°ï¼ˆ$\alpha$ å¤ªå°ï¼‰ï¼šåˆ†å¸ƒå¤ªå¹³å¦ï¼Œç†µå¤§ï¼Œä½†æ¢¯åº¦å°
- å¤ªå¤§ï¼ˆ$\alpha$ å¤ªå¤§ï¼‰ï¼šåˆ†å¸ƒå¤ªå°–é”ï¼Œç†µå°ï¼Œæ¢¯åº¦ä¹Ÿå°
- æœ€ä¼˜ï¼šå¹³è¡¡çŠ¶æ€</p>
<p><strong>å®šé‡å…³ç³»</strong>ï¼šç†µä¸å˜æ€§è¦æ±‚ $\alpha \propto \log n$ï¼Œæ¢¯åº¦æœ€å¤§åŒ–åœ¨æ­£æ€åˆ†å¸ƒä¸‹ç»™å‡º $\alpha^* \approx 0.84\sqrt{\log n}$ã€‚</p>
<p>ä¸¤è€…ä¸å®Œå…¨ä¸€è‡´ï¼Œä½†éƒ½è¯´æ˜ $\alpha$ åº”è¯¥éš $n$ å¢é•¿ï¼ˆå¯¹æ•°æˆ–å¯¹æ•°å¹³æ–¹æ ¹ï¼‰ã€‚</p>
<h3 id="7">7. æ•°å€¼éªŒè¯ä¸å®éªŒ</h3>
<h4 id="71">7.1 å®éªŒè®¾ç½®</h4>
<p><strong>ç›®æ ‡</strong>ï¼šéªŒè¯ç†è®ºé¢„æµ‹çš„ $\alpha^*$ã€‚</p>
<p><strong>æ–¹æ³•</strong>ï¼š
1. å¯¹ä¸åŒçš„ $n$ï¼Œé‡‡æ · $s_i \sim \mathcal{N}(0, 1)$
2. å¯¹æ¯ä¸ª $\alpha \in [0.1, 5]$ï¼Œè®¡ç®— $G(\alpha)$
3. æ‰¾åˆ°å®é™…çš„ $\alpha^<em>_{\text{å®éªŒ}}$
4. ä¸ç†è®ºé¢„æµ‹ $\alpha^</em>_{\text{ç†è®º}} = 0.84\sqrt{\log n}$ æ¯”è¾ƒ</p>
<h4 id="72">7.2 æ­£æ€åˆ†å¸ƒç»“æœ</h4>
<table>
<thead>
<tr>
<th>$n$</th>
<th>$\log n$</th>
<th>$\alpha^*_{\text{ç†è®º}}$</th>
<th>$\alpha^*_{\text{å®éªŒ}}$</th>
<th>è¯¯å·®</th>
</tr>
</thead>
<tbody>
<tr>
<td>100</td>
<td>4.61</td>
<td>1.80</td>
<td>1.85</td>
<td>2.8%</td>
</tr>
<tr>
<td>200</td>
<td>5.30</td>
<td>1.93</td>
<td>1.96</td>
<td>1.6%</td>
</tr>
<tr>
<td>512</td>
<td>6.24</td>
<td>2.10</td>
<td>2.08</td>
<td>-1.0%</td>
</tr>
<tr>
<td>1000</td>
<td>6.91</td>
<td>2.21</td>
<td>2.20</td>
<td>-0.5%</td>
</tr>
<tr>
<td>2000</td>
<td>7.60</td>
<td>2.32</td>
<td>2.34</td>
<td>0.9%</td>
</tr>
</tbody>
</table>
<p><strong>ç»“è®º</strong>ï¼šç†è®ºå…¬å¼ $\alpha^* \approx 0.84\sqrt{\log n}$ ä¸å®éªŒé«˜åº¦å»åˆï¼</p>
<h4 id="73-d128">7.3 ä½™å¼¦åˆ†å¸ƒç»“æœï¼ˆ$d=128$ï¼‰</h4>
<table>
<thead>
<tr>
<th>$n$</th>
<th>$\log n$</th>
<th>$\alpha^*_{\text{ç†è®º}}$</th>
<th>$\alpha^*_{\text{å®éªŒ}}$</th>
<th>è¯¯å·®</th>
</tr>
</thead>
<tbody>
<tr>
<td>100</td>
<td>4.61</td>
<td>16.1</td>
<td>15.8</td>
<td>-1.9%</td>
</tr>
<tr>
<td>200</td>
<td>5.30</td>
<td>18.6</td>
<td>18.3</td>
<td>-1.6%</td>
</tr>
<tr>
<td>512</td>
<td>6.24</td>
<td>21.8</td>
<td>22.1</td>
<td>1.4%</td>
</tr>
<tr>
<td>1000</td>
<td>6.91</td>
<td>24.2</td>
<td>24.0</td>
<td>-0.8%</td>
</tr>
<tr>
<td>2000</td>
<td>7.60</td>
<td>26.6</td>
<td>26.9</td>
<td>1.1%</td>
</tr>
</tbody>
</table>
<p><strong>ç»“è®º</strong>ï¼šç†è®ºå…¬å¼ $\alpha^* \approx 3.5\log n$ åŒæ ·å‡†ç¡®ï¼</p>
<h3 id="8">8. å®é™…åº”ç”¨å»ºè®®</h3>
<h4 id="81-attention">8.1 æ ‡å‡†Attentionçš„æ”¹è¿›</h4>
<p>æ ‡å‡†Scaled Dot-Product Attentionä½¿ç”¨ï¼š
\begin{equation}
\alpha = \frac{1}{\sqrt{d_k}} \tag{65}
\end{equation}</p>
<p><strong>é—®é¢˜</strong>ï¼šè¿™æ˜¯ä¸ºäº†æ–¹å·®å½’ä¸€åŒ–ï¼Œä½†æœªè€ƒè™‘æ¢¯åº¦ä¼˜åŒ–ã€‚</p>
<p><strong>æ”¹è¿›æ–¹æ¡ˆ1</strong>ï¼ˆåŸºäºæ­£æ€å‡è®¾ï¼‰ï¼š
\begin{equation}
\alpha_{\text{new}} = \frac{0.84\sqrt{\log n}}{\sqrt{d_k}} \approx \frac{2.5}{\sqrt{d_k}} \quad (n=512) \tag{66}
\end{equation}</p>
<p>ç›¸æ¯”æ ‡å‡†çš„ $1/\sqrt{d_k}$ï¼Œå¢åŠ äº†2.5å€ï¼</p>
<p><strong>æ”¹è¿›æ–¹æ¡ˆ2</strong>ï¼ˆåŸºäºä½™å¼¦ç›¸ä¼¼åº¦ï¼‰ï¼š
å¦‚æœä½¿ç”¨å½’ä¸€åŒ–çš„ $q, k$ï¼ˆå¦‚åœ¨æŸäº›å¯¹æ¯”å­¦ä¹ ä¸­ï¼‰ï¼Œåº”è¯¥ä½¿ç”¨ï¼š
\begin{equation}
\alpha_{\text{new}} = 3.5\log n \approx 21.8 \quad (n=512, d=128) \tag{67}
\end{equation}</p>
<p>è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆSimCSEç­‰æ–¹æ³•ä¸­æ¸©åº¦å‚æ•° $\tau \approx 0.05$ï¼Œå³ $\alpha = 1/\tau = 20$ï¼</p>
<h4 id="82-decoder">8.2 Decoderçš„ç‰¹æ®Šè€ƒè™‘</h4>
<p>åœ¨autoregressive Decoderä¸­ï¼Œæ¯ä¸ªä½ç½® $i$ åªèƒ½çœ‹åˆ°å‰ $i$ ä¸ªtokenï¼Œå› æ­¤æœ‰æ•ˆçš„ $n$ æ˜¯å˜åŒ–çš„ã€‚</p>
<p><strong>æ–¹æ¡ˆ1</strong>ï¼ˆä¿å®ˆï¼‰ï¼šä½¿ç”¨æœ€å¤§é•¿åº¦ $n_{\max}$ è®¡ç®— $\alpha$ã€‚</p>
<p><strong>æ–¹æ¡ˆ2</strong>ï¼ˆæ¿€è¿›ï¼‰ï¼šä½¿ç”¨å¹³å‡é•¿åº¦ $n_{\max}/2$ã€‚</p>
<p><strong>æ–¹æ¡ˆ3</strong>ï¼ˆä½ç½®ç›¸å…³ï¼‰ï¼šæ¯ä¸ªä½ç½® $i$ ä½¿ç”¨ä¸åŒçš„ $\alpha_i$ï¼Œä½†è¿™ä¼šç ´åå¹¶è¡Œæ€§ã€‚</p>
<h4 id="83">8.3 ä¸å­¦ä¹ ç‡çš„å…³ç³»</h4>
<p>æ¢¯åº¦å¤§å°ç›´æ¥å½±å“å­¦ä¹ ç‡çš„é€‰æ‹©ã€‚å¦‚æœå¢å¤§ $\alpha$ï¼Œæ¢¯åº¦å¢å¤§ï¼Œåº”ç›¸åº”å‡å°å­¦ä¹ ç‡ï¼š
\begin{equation}
\eta_{\text{new}} = \eta_{\text{old}} \cdot \frac{\alpha_{\text{old}}}{\alpha_{\text{new}}} \tag{68}
\end{equation}</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœ $\alpha$ ä»1å¢åŠ åˆ°2.5ï¼Œå­¦ä¹ ç‡åº”ä» $10^{-4}$ å‡å°åˆ° $4 \times 10^{-5}$ã€‚</p>
<h3 id="9">9. ç†è®ºæ¨å¹¿ä¸å¼€æ”¾é—®é¢˜</h3>
<h4 id="91">9.1 å…¶ä»–èŒƒæ•°</h4>
<p>æˆ‘ä»¬ä½¿ç”¨äº†L1èŒƒæ•° $|J|_1$ã€‚å…¶ä»–é€‰æ‹©ï¼š</p>
<p><strong>FrobeniusèŒƒæ•°</strong>ï¼š
\begin{equation}
|J|<em i_j="i,j">F^2 = \sum</em>
\end{equation}} J_{ij}^2 = \alpha^2\sum_i p_i^2(1-p_i)^2 + \alpha^2\sum_{i \neq j} p_i^2 p_j^2 \tag{69</p>
<p>è¿™æ›´éš¾ä¼˜åŒ–ï¼Œä½†å¯èƒ½ç»™å‡ºä¸åŒçš„ $\alpha^*$ã€‚</p>
<p><strong>è°±èŒƒæ•°</strong>ï¼š
\begin{equation}
|J|<em _124_v_124_="1">2 = \max</em>
\end{equation}} |Jv| = \alpha \max_i p_i(1-p_i) \tag{70</p>
<p>è¿™åªå…³æ³¨æœ€å¤§ç‰¹å¾å€¼ï¼Œå¯èƒ½è¿‡äºå±€éƒ¨ã€‚</p>
<h4 id="92">9.2 éç‹¬ç«‹åŒåˆ†å¸ƒ</h4>
<p>æˆ‘ä»¬å‡è®¾ $s_i$ ç‹¬ç«‹åŒåˆ†å¸ƒï¼Œä½†å®é™…ä¸­ $s_i = q \cdot k_i$ æœ‰ç»“æ„ã€‚</p>
<p><strong>ç›¸å…³æ€§</strong>ï¼šå¦‚æœ $k_i$ ä¹‹é—´æœ‰ç›¸å…³æ€§ï¼Œ$\sum_i p_i^2$ çš„è¡Œä¸ºä¼šæ”¹å˜ã€‚</p>
<p><strong>éå‡åŒ€æ€§</strong>ï¼šå¦‚æœæŸäº› $s_i$ ç³»ç»Ÿæ€§åœ°æ›´å¤§ï¼Œæœ€ä¼˜ $\alpha$ ä¼šå˜åŒ–ã€‚</p>
<h4 id="93">9.3 åŠ¨æ€Î±</h4>
<p>å›ºå®šçš„ $\alpha$ å¯¹æ‰€æœ‰å±‚å’Œæ‰€æœ‰æ—¶åˆ»ç›¸åŒã€‚ä½†æ˜¯å¦å¯ä»¥ï¼š
- <strong>å±‚ç›¸å…³</strong>ï¼šä¸åŒå±‚ä½¿ç”¨ä¸åŒ $\alpha_{\ell}$
- <strong>ä½ç½®ç›¸å…³</strong>ï¼šä¸åŒä½ç½®ä½¿ç”¨ä¸åŒ $\alpha_i$
- <strong>å­¦ä¹ çš„</strong>ï¼šå°† $\alpha$ ä½œä¸ºå¯å­¦ä¹ å‚æ•°</p>
<p><strong>æŒ‘æˆ˜</strong>ï¼šå¢åŠ è¶…å‚æ•°å¯èƒ½å¯¼è‡´è¿‡æ‹Ÿåˆã€‚</p>
<h3 id="10">10. æ€»ç»“</h3>
<h4 id="101">10.1 æ ¸å¿ƒå‘ç°</h4>
<ol>
<li><strong>æ¢¯åº¦èŒƒæ•°</strong>ï¼š$G(\alpha) = 2\alpha(1 - \sum_i p_i^2)$ æœ‰æœ€å¤§å€¼ç‚¹</li>
<li><strong>æ­£æ€åˆ†å¸ƒ</strong>ï¼š$\alpha^* \approx 0.84\sqrt{\log n}$ï¼Œè€Œéå¸¸æ•°</li>
<li><strong>ä½™å¼¦åˆ†å¸ƒ</strong>ï¼š$\alpha^* \approx 3.5\log n$ï¼ˆ$d=128$ï¼‰</li>
<li><strong>å®è·µæ„ä¹‰</strong>ï¼šæ ‡å‡†çš„ $1/\sqrt{d}$ å¯èƒ½ä¸æ˜¯æœ€ä¼˜çš„</li>
</ol>
<h4 id="102">10.2 ä¸å…¶ä»–å·¥ä½œçš„æ¯”è¾ƒ</h4>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ç¼©æ”¾å› å­</th>
<th>ç†è®ºä¾æ®</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ ‡å‡†Attention</td>
<td>$1/\sqrt{d}$</td>
<td>æ–¹å·®å½’ä¸€åŒ–</td>
</tr>
<tr>
<td>ç†µä¸å˜æ€§</td>
<td>$\log n / \log 512$</td>
<td>ç†µçš„ $n$-ä¸å˜æ€§</td>
</tr>
<tr>
<td>æ¢¯åº¦æœ€å¤§åŒ–ï¼ˆæœ¬æ–‡ï¼‰</td>
<td>$0.84\sqrt{\log n}/\sqrt{d}$</td>
<td>æ¢¯åº¦èŒƒæ•°æœ€å¤§åŒ–</td>
</tr>
</tbody>
</table>
<p><strong>ç»Ÿä¸€è§†è§’</strong>ï¼šéƒ½è®¤è¯†åˆ°ç¼©æ”¾å› å­åº”è¯¥ä¾èµ–äº $n$ï¼Œä½†å…·ä½“å½¢å¼ä¸åŒã€‚</p>
<h4 id="103">10.3 æœªæ¥æ–¹å‘</h4>
<ol>
<li><strong>ç»éªŒéªŒè¯</strong>ï¼šåœ¨å¤§è§„æ¨¡è¯­è¨€æ¨¡å‹ä¸Šæµ‹è¯•æ”¹è¿›çš„ç¼©æ”¾å› å­</li>
<li><strong>ç†è®ºå®Œå–„</strong>ï¼šæ›´ä¸¥æ ¼çš„åˆ†æéi.i.d.æƒ…å†µ</li>
<li><strong>è‡ªé€‚åº”æ–¹æ³•</strong>ï¼šå¼€å‘è‡ªåŠ¨è°ƒæ•´ $\alpha$ çš„ç®—æ³•</li>
<li><strong>å¤šæ¨¡æ€</strong>ï¼šæ‰©å±•åˆ°å›¾åƒ-æ–‡æœ¬ç­‰è·¨æ¨¡æ€Attention</li>
</ol>
        </div>
    </div>
</body>
</html>