<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆå…«ï¼‰ï¼šæœ€ä¼˜æ‰©æ•£æ–¹å·®ä¼°è®¡ï¼ˆä¸‹ï¼‰</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆå…«ï¼‰ï¼šæœ€ä¼˜æ‰©æ•£æ–¹å·®ä¼°è®¡ï¼ˆä¸‹ï¼‰</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-26 | ğŸ“„ å¤§å°: 41.1 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/9246">https://spaces.ac.cn/archives/9246</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« <a href="/archives/9245">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆä¸ƒï¼‰ï¼šæœ€ä¼˜æ‰©æ•£æ–¹å·®ä¼°è®¡ï¼ˆä¸Šï¼‰ã€‹</a>ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»å¹¶æ¨å¯¼äº†Analytic-DPMä¸­çš„æ‰©æ•£æ¨¡å‹æœ€ä¼˜æ–¹å·®ä¼°è®¡ç»“æœï¼Œå®ƒæ˜¯ç›´æ¥ç»™å‡ºäº†å·²ç»è®­ç»ƒå¥½çš„ç”Ÿæˆæ‰©æ•£æ¨¡å‹çš„æœ€ä¼˜æ–¹å·®çš„ä¸€ä¸ªè§£æä¼°è®¡ï¼Œå®éªŒæ˜¾ç¤ºè¯¥ä¼°è®¡ç»“æœç¡®å®èƒ½æœ‰æ•ˆæé«˜æ‰©æ•£æ¨¡å‹çš„ç”Ÿæˆè´¨é‡ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« æˆ‘ä»¬ç»§ç»­ä»‹ç»Analytic-DPMçš„å‡çº§ç‰ˆï¼Œå‡ºè‡ªåŒä¸€ä½œè€…å›¢é˜Ÿçš„è®ºæ–‡<a href="https://papers.cool/arxiv/2206.07309">ã€ŠEstimating the Optimal Covariance with Imperfect Mean in Diffusion Probabilistic Modelsã€‹</a>ï¼Œåœ¨å®˜æ–¹Githubä¸­è¢«ç§°ä¸ºâ€œExtended-Analytic-DPMâ€ï¼Œä¸‹é¢æˆ‘ä»¬ä¹Ÿç”¨è¿™ä¸ªç§°å‘¼ã€‚</p>
<h2 id="_1">ç»“æœå›é¡¾</h2>
<p>ä¸Šä¸€ç¯‡æ–‡ç« æ˜¯åœ¨DDIMçš„åŸºç¡€ä¸Šï¼Œæ¨å‡ºDDIMçš„ç”Ÿæˆè¿‡ç¨‹æœ€ä¼˜æ–¹å·®åº”è¯¥æ˜¯<br />
\begin{equation}\sigma_t^2 + \gamma_t^2\bar{\sigma}<em _boldsymbol_x="\boldsymbol{x">t^2\end{equation}<br />
å…¶ä¸­$\bar{\sigma}_t^2$æ˜¯åˆ†å¸ƒ$p(\boldsymbol{x}_0|\boldsymbol{x}_t)$çš„æ–¹å·®ï¼Œå®ƒæœ‰å¦‚ä¸‹çš„ä¼°è®¡ç»“æœï¼ˆè¿™é‡Œå–â€œ<a href="/archives/9245#%E6%96%B9%E5%B7%AE%E4%BC%B0%E8%AE%A12">æ–¹å·®ä¼°è®¡2</a>â€çš„ç»“æœï¼‰ï¼š<br />
\begin{equation}\bar{\sigma}_t^2 = \frac{\bar{\beta}_t^2}{\bar{\alpha}_t^2}\left(1 - \frac{1}{d}\mathbb{E}</em><em _boldsymbol_theta="\boldsymbol{\theta">t\sim p(\boldsymbol{x}_t)}\left[ \Vert\boldsymbol{\epsilon}</em>}}(\boldsymbol{x}_t, t)\Vert^2\right]\right)\label{eq:basic}\end{equation</p>
<p>äº‹åæ¥çœ‹ï¼Œå…¶å®ä¼°è®¡æ€è·¯ä¹Ÿä¸ç®—éš¾ï¼Œå‡è®¾<br />
\begin{equation}\bar{\boldsymbol{\mu}}(\boldsymbol{x}<em _boldsymbol_theta="\boldsymbol{\theta">t) = \frac{1}{\bar{\alpha}_t}\left(\boldsymbol{x}_t - \bar{\beta}_t \boldsymbol{\epsilon}</em>}}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t, t)\right)\label{eq:bar-mu}\end{equation}<br />
å·²ç»å‡†ç¡®é¢„æµ‹äº†åˆ†å¸ƒ$p(\boldsymbol{x}_0|\boldsymbol{x}_t)$çš„å‡å€¼å‘é‡ï¼Œé‚£ä¹ˆæ ¹æ®å®šä¹‰å¯ä»¥å¾—åˆ°åæ–¹å·®ä¸º<br />
\begin{equation}\begin{aligned}<br />
\boldsymbol{\Sigma}(\boldsymbol{x}_t)=&amp;\, \mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">0\sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\left(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)\right)\left(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)\right)^{\top}\right] \\\<br />
=&amp;\, \frac{1}{\bar{\alpha}_t^2}\mathbb{E}</em><em _boldsymbol_theta="\boldsymbol{\theta">0\sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\left(\boldsymbol{x}_t - \bar{\alpha}_t\boldsymbol{x}_0\right)\left(\boldsymbol{x}_t - \bar{\alpha}_t\boldsymbol{x}_0\right)^{\top}\right] - \frac{\bar{\beta}_t^2}{\bar{\alpha}_t^2} \boldsymbol{\epsilon}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, t)\boldsymbol{\epsilon}</em>}}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t, t)^{\top}\\\<br />
\end{aligned}\label{eq:full-cov}\end{equation}<br />
ä¸¤ç«¯å¯¹$\boldsymbol{x}_t\sim p(\boldsymbol{x}_t)$æ±‚å¹³å‡ï¼Œä»¥æ¶ˆé™¤å¯¹$\boldsymbol{x}_t$çš„ä¾èµ–<br />
\begin{equation}<br />
\boldsymbol{\Sigma}_t = \mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">t\sim p(\boldsymbol{x}_t)}[\boldsymbol{\Sigma}(\boldsymbol{x}_t)] = \frac{\bar{\beta}_t^2}{\bar{\alpha}_t^2}\left(\boldsymbol{I} - \mathbb{E}</em><em _boldsymbol_theta="\boldsymbol{\theta">t\sim p(\boldsymbol{x}_t)}\left[ \boldsymbol{\epsilon}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, t)\boldsymbol{\epsilon}</em>}}(\boldsymbol{x}_t, t)^{\top}\right]\right)\label{eq:uncond-var-2}\end{equation<br />
æœ€åï¼Œå¯¹è§’çº¿å…ƒç´ å–å¹³å‡ï¼Œä½¿å…¶å˜ä¸ºä¸€ä¸ªæ ‡é‡ï¼ˆæˆ–è€…è¯´åæ–¹å·®æ˜¯å•ä½é˜µçš„å€æ•°ï¼‰ï¼Œå³$\bar{\sigma}_t^2 = \text{Tr}(\boldsymbol{\Sigma}_t)/d$ï¼Œä¾¿å¯å¾—åˆ°ä¼°è®¡å¼$\eqref{eq:basic}$ã€‚</p>
<h2 id="_2">å¦‚ä½•æ”¹è¿›</h2>
<p>åœ¨æ­£å¼ä»‹ç»Extended-Analytic-DPMä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæƒ³æƒ³ï¼ŒAnalytic-DPMè¿˜æœ‰ä»€ä¹ˆæ”¹è¿›ç©ºé—´ï¼Ÿ</p>
<p>å…¶å®ç¨åŠ æ€è€ƒå°±å¯ä»¥å‘ç°å¾ˆå¤šï¼Œæ¯”å¦‚Analytic-DPMå‡è®¾ç”¨æ¥é€¼è¿‘$p(\boldsymbol{x}<em _boldsymbol_x="\boldsymbol{x">0|\boldsymbol{x}_t)$çš„æ­£æ€åˆ†å¸ƒåæ–¹å·®çŸ©é˜µè®¾è®¡ä¸ºä¸º$\bar{\sigma}_t^2\boldsymbol{I}$ï¼Œå³å¯¹è§’çº¿å…ƒç´ ç›¸åŒçš„å¯¹è§’é˜µï¼Œé‚£ä¹ˆä¸€ä¸ªç›´æ¥çš„æ”¹è¿›å°±æ˜¯å…è®¸å¯¹è§’çº¿å…ƒç´ äº’ä¸ç›¸åŒäº†ï¼Œå³$\text{diag}(\bar{\boldsymbol{\sigma}}_t^2)$ï¼Œè¿™é‡Œçº¦å®šå‘é‡çš„ä¹˜æ³•éƒ½æ˜¯åŸºäºHadamardç§¯è¿›è¡Œï¼Œæ¯”å¦‚$\boldsymbol{x}^2=\boldsymbol{x}\otimes \boldsymbol{x}$ã€‚å¯¹åº”çš„ç»“æœå°±æ˜¯åªè€ƒè™‘$\boldsymbol{\Sigma}_t$çš„å¯¹è§’çº¿éƒ¨åˆ†ï¼Œæ‰€ä»¥ä»å¼$\eqref{eq:uncond-var-2}$å‡ºå‘ï¼Œå¯ä»¥å¾—åˆ°ç›¸åº”çš„ä¼°è®¡æ˜¯<br />
\begin{equation}\bar{\boldsymbol{\sigma}}_t^2 = \frac{\bar{\beta}_t^2}{\bar{\alpha}_t^2}\left(\boldsymbol{1}_d - \mathbb{E}</em><em _boldsymbol_theta="\boldsymbol{\theta">t\sim p(\boldsymbol{x}_t)}\left[ \boldsymbol{\epsilon}</em>}}^2(\boldsymbol{x}_t, t)\right]\right) \end{equation<br />
å…¶ä¸­$\boldsymbol{1}_d$æ˜¯$d$ç»´å…¨1å‘é‡ã€‚è¿˜æœ‰ä¸€ä¸ªæ›´è¿›ä¸€æ­¥çš„æ”¹è¿›æ˜¯ä¿ç•™$\bar{\boldsymbol{\sigma}}_t^2$å¯¹$\boldsymbol{x}_t$çš„ä¾èµ–å…³ç³»ï¼Œå³è€ƒè™‘$\bar{\boldsymbol{\sigma}}_t^2(\boldsymbol{x}_t)$ï¼Œè¿™å°±è·Ÿ$\boldsymbol{\mu}(\boldsymbol{x}_t)$ç±»ä¼¼ï¼Œéœ€è¦ç”¨ä¸€ä¸ªä»¥$\boldsymbol{x}_t$ä¸ºè¾“å…¥çš„æ¨¡å‹æ¥å­¦ä¹ å®ƒã€‚</p>
<p>é‚£ä¹ˆå¯ä¸å¯ä»¥è€ƒè™‘å®Œæ•´çš„$\boldsymbol{\Sigma}_t$å‘¢ï¼Ÿç†è®ºä¸Šå¯ä»¥ï¼Œå®é™…ä¸ŠåŸºæœ¬ä¸å¯è¡Œï¼Œå› ä¸ºå®Œæ•´çš„$\boldsymbol{\Sigma}_t$æ˜¯ä¸€ä¸ª$d\times d$çŸ©é˜µï¼Œå¯¹äºå›¾ç‰‡åœºæ™¯æ¥è¯´ï¼Œ$d$æ˜¯å›¾ç‰‡çš„æ€»åƒç´ ä¸ªæ•°ï¼Œå³ä¾¿æ˜¯å¯¹äºcifar10æ¥è¯´ä¹Ÿå·²ç»æœ‰$d=32^2\times 3=3072$äº†ï¼Œæ›´ä¸ç”¨è¯´æ›´é«˜åˆ†è¾¨ç‡çš„å›¾ç‰‡ã€‚æ‰€ä»¥ç»“åˆå®éªŒèƒŒæ™¯ï¼Œ$d\times d$çŸ©é˜µåœ¨å‚¨å­˜å’Œè®¡ç®—ä¸Šçš„æˆæœ¬éƒ½è¿‡å¤§äº†ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œå¯èƒ½æœ‰ä¸€ä¸ªé—®é¢˜ä¸å°‘è¯»è€…éƒ½æ²¡æ„è¯†åˆ°ï¼Œå°±æ˜¯å‰é¢çš„è§£æè§£æ¨å¯¼éƒ½ä¾èµ–äº$\bar{\boldsymbol{\mu}}(\boldsymbol{x}<em _boldsymbol_x="\boldsymbol{x">t) = \mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">0\sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}[\boldsymbol{x}_0]$ï¼Œäº‹å®ä¸Š$\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)$æ˜¯ç”±æ¨¡å‹å­¦ä¹ å‡ºæ¥çš„ï¼Œå®ƒæœªå¿…èƒ½å¤Ÿç²¾ç¡®ç­‰äºå‡å€¼$\mathbb{E}</em>_0]$ï¼Œè¿™å°±æ˜¯Extended-Analytic-DPMçš„è®ºæ–‡æ ‡é¢˜æ‰€æåˆ°çš„Imperfect Meançš„å«ä¹‰ã€‚å¦‚æœåœ¨Imperfect Meanä¸‹æ”¹è¿›ä¼°è®¡ç»“æœï¼Œæ›´åŠ æœ‰å®è·µæ„ä¹‰ã€‚}_0\sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}[\boldsymbol{x</p>
<h2 id="_3">æœ€å¤§ä¼¼ç„¶</h2>
<p>å‡è®¾å‡å€¼æ¨¡å‹$\bar{\boldsymbol{\mu}}(\boldsymbol{x}<em _boldsymbol_x="\boldsymbol{x">t)$å·²ç»äº‹å…ˆè®­ç»ƒå¥½ï¼Œé‚£ä¹ˆå¾…å®šåˆ†å¸ƒ$\mathcal{N}(\boldsymbol{x}_0;\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t),\bar{\sigma}_t^2\boldsymbol{I})$çš„å‚æ•°å°±åªå‰©ä¸‹äº†$\bar{\sigma}_t^2$ï¼Œå¯¹åº”çš„è´Ÿå¯¹æ•°ä¼¼ç„¶ä¸º<br />
\begin{equation}\begin{aligned}<br />
&amp;\, \mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">t\sim p(\boldsymbol{x}_t)}\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">0\sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[-\log \mathcal{N}(\boldsymbol{x}_0;\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t),\bar{\sigma}_t^2\boldsymbol{I})\right] \\\<br />
=&amp;\, \frac{\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">t,\boldsymbol{x}_0\sim p(\boldsymbol{x}_t|\boldsymbol{x}_0)\tilde{p}(\boldsymbol{x}_0)}\left[\Vert\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)\Vert^2\right]}{2\bar{\sigma}_t^2} + \frac{d}{2}\log \bar{\sigma}_t^2 + \frac{d}{2}\log 2\pi \\\<br />
\end{aligned}\label{eq:neg-log}\end{equation}<br />
å¯ä»¥è§£å¾—å–æœ€å°å€¼æ­£å¥½æ˜¯<br />
\begin{equation}\bar{\sigma}_t^2 = \frac{1}{d}\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">t,\boldsymbol{x}_0\sim p(\boldsymbol{x}_t|\boldsymbol{x}_0)\tilde{p}(\boldsymbol{x}_0)}\left[\Vert\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)\Vert^2\right]\end{equation}<br />
å®ƒçš„ç‰¹ç‚¹æ˜¯$\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)$æœªå¿…æ˜¯å‡†ç¡®çš„å‡å€¼ç»“æœï¼Œå› æ­¤å¼$\eqref{eq:full-cov}$çš„ç¬¬äºŒä¸ªç­‰å·ä¸æˆç«‹ï¼Œåªèƒ½æˆç«‹ç¬¬ä¸€ä¸ªç­‰å·ã€‚å°†å¼$\eqref{eq:bar-mu}$ä»£å…¥ï¼Œå¾—åˆ°<br />
\begin{equation}\bar{\sigma}_t^2 = \frac{\bar{\beta}_t^2}{\bar{\alpha}_t^2 d}\mathbb{E}</em><em _boldsymbol_theta="\boldsymbol{\theta">0\sim \tilde{p}(\boldsymbol{x}_0),\boldsymbol{\varepsilon}\sim\mathcal{N}(\boldsymbol{0},\boldsymbol{I})}\left[\left\Vert\boldsymbol{\varepsilon} - \boldsymbol{\epsilon}</em>}}(\bar{\alpha<em _boldsymbol_x="\boldsymbol{x">t\boldsymbol{x}_0 + \bar{\beta}_t\boldsymbol{\varepsilon}, t)\right\Vert^2\right]\end{equation}<br />
å½“ç„¶ï¼Œè¿™é‡Œåªåˆ†æäº†åæ–¹å·®çŸ©é˜µä¸º$\bar{\sigma}_t^2\boldsymbol{I}$çš„ç®€å•æƒ…å½¢ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è€ƒè™‘æ›´ä¸€èˆ¬çš„å¯¹è§’é˜µåæ–¹å·®ï¼Œå³$\mathcal{N}(\boldsymbol{x}_0;\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t),\text{diag}(\bar{\boldsymbol{\sigma}}_t^2))$ï¼Œå¯¹åº”çš„ç»“æœæ˜¯<br />
\begin{equation}\bar{\boldsymbol{\sigma}}_t^2 = \frac{\bar{\beta}_t^2}{\bar{\alpha}_t^2 }\mathbb{E}</em><em _boldsymbol_theta="\boldsymbol{\theta">0\sim \tilde{p}(\boldsymbol{x}_0),\boldsymbol{\varepsilon}\sim\mathcal{N}(\boldsymbol{0},\boldsymbol{I})}\left[\left(\boldsymbol{\varepsilon} - \boldsymbol{\epsilon}</em>}}(\bar{\alpha}_t\boldsymbol{x}_0 + \bar{\beta}_t\boldsymbol{\varepsilon}, t)\right)^2\right]\end{equation</p>
<h2 id="_4">æ¡ä»¶æ–¹å·®</h2>
<p>å¦‚æœæƒ³è¦å¾—åˆ°å¸¦æ¡ä»¶$\boldsymbol{x}<em _boldsymbol_x="\boldsymbol{x">t$çš„åæ–¹å·®$\text{diag}(\bar{\boldsymbol{\sigma}}_t^2(\boldsymbol{x}_t))$ï¼Œé‚£ä¹ˆå°±ç›¸å½“äºæ¯ä¸ªåˆ†é‡ç‹¬ç«‹è®¡ç®—ï¼Œç»“æœæ˜¯å…é™¤äº†$\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">t\sim p(\boldsymbol{x}_t)}$è¿™ä¸€æ­¥å¹³å‡ï¼š<br />
\begin{equation}\bar{\boldsymbol{\sigma}}_t^2(\boldsymbol{x}_t) = \mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">0\sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t))^2\right] = \frac{\bar{\beta}_t^2}{\bar{\alpha}_t^2}\mathbb{E}</em><em _boldsymbol_theta="\boldsymbol{\theta">0\sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\left(\boldsymbol{\epsilon}_t - \boldsymbol{\epsilon}</em>}}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t, t)\right)^2\right] \end{equation}<br />
å…¶ä¸­$\boldsymbol{\epsilon}_t = \frac{\boldsymbol{x}_t - \bar{\alpha}_t \boldsymbol{x}_0}{\bar{\beta}_t}$ã€‚è·Ÿä¸Šä¸€ç¯‡æ–‡ç« ä¸€æ ·ï¼Œåˆ©ç”¨<br />
\begin{equation}\mathbb{E}</em>}}[\boldsymbol{x}] = \mathop{\text{argmin}<em _boldsymbol_x="\boldsymbol{x">{\boldsymbol{\mu}}\mathbb{E}</em>}}\left[\Vert \boldsymbol{x} - \boldsymbol{\mu}\Vert^2\right]\label{eq:mean-opt}\end{equation<br />
å¾—åˆ°<br />
\begin{equation}\begin{aligned}<br />
\bar{\boldsymbol{\sigma}}<em _boldsymbol_x="\boldsymbol{x">t^2(\boldsymbol{x}_t) =&amp;\, \frac{\bar{\beta}_t^2}{\bar{\alpha}_t^2}\mathbb{E}</em><em _boldsymbol_theta="\boldsymbol{\theta">0\sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\left(\boldsymbol{\epsilon}_t - \boldsymbol{\epsilon}</em>}}(\boldsymbol{x<em _boldsymbol_g="\boldsymbol{g">t, t)\right)^2\right] \\\<br />
=&amp;\, \frac{\bar{\beta}_t^2}{\bar{\alpha}_t^2}\mathop{\text{argmin}}</em>}}\mathbb{E<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{x}_0\sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\left\Vert\left(\boldsymbol{\epsilon}_t - \boldsymbol{\epsilon}</em>}}(\boldsymbol{x<em _boldsymbol_g="\boldsymbol{g">t, t)\right)^2-\boldsymbol{g}\right\Vert^2\right] \\\<br />
=&amp;\, \frac{\bar{\beta}_t^2}{\bar{\alpha}_t^2}\mathop{\text{argmin}}</em>}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t)}\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">t\sim p(\boldsymbol{x}_t)}\mathbb{E}</em><em _boldsymbol_theta="\boldsymbol{\theta">0\sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\left\Vert\left(\boldsymbol{\epsilon}_t - \boldsymbol{\epsilon}</em>}}(\boldsymbol{x<em _boldsymbol_g="\boldsymbol{g">t, t)\right)^2-\boldsymbol{g}(\boldsymbol{x}_t)\right\Vert^2\right] \\\<br />
=&amp;\, \frac{\bar{\beta}_t^2}{\bar{\alpha}_t^2}\mathop{\text{argmin}}</em>}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t)}\mathbb{E}</em><em _boldsymbol_theta="\boldsymbol{\theta">t,\boldsymbol{x}_0\sim p(\boldsymbol{x}_t|\boldsymbol{x}_0)\tilde{p}(\boldsymbol{x}_0)}\left[\left\Vert\left(\boldsymbol{\epsilon}_t - \boldsymbol{\epsilon}</em>_t)\right\Vert^2\right] \\\}}(\boldsymbol{x}_t, t)\right)^2-\boldsymbol{g}(\boldsymbol{x<br />
\end{aligned}\end{equation}<br />
è¿™å°±æ˜¯Extended-Analytic-DPMä¸­å­¦ä¹ æ¡ä»¶æ–¹å·®çš„â€œNPR-DPMâ€æ–¹æ¡ˆã€‚å¦å¤–ï¼ŒåŸè®ºæ–‡è¿˜æäº†ä¸ªâ€œSN-DPMâ€æ–¹æ¡ˆï¼Œå®ƒæ˜¯åŸºäºPerfect Meanå‡è®¾è€Œä¸æ˜¯Imperfect Meançš„ã€‚ç„¶è€Œè®ºæ–‡çš„å®éªŒç»“æœå´æ˜¯SN-DPMè¦ä¼˜äºNPR-DPMï¼Œä¹Ÿå°±æ˜¯è¯´è®ºæ–‡å·ç§°è‡ªå·±åœ¨è§£å†³Imperfect Meané—®é¢˜ï¼Œç»“æœå®éªŒæ˜¾ç¤ºPerfect Meanå‡è®¾çš„æ–¹æ¡ˆæ›´å¥½ï¼Œè¿™å°±åè¿‡æ¥è¯´æ˜Perfect Meanå‡è®¾å…¶å®å¾ˆè´´åˆå®è·µæƒ…å†µï¼Œæ¢å¥è¯è¯´Imperfect Meané—®é¢˜å¯ä»¥è§†ä¸ºä¸å­˜åœ¨äº†ã€‚</p>
<h2 id="_5">ä¸¤ä¸ªé˜¶æ®µ</h2>
<p>å¯èƒ½è¯»è€…æœ‰ç–‘é—®ï¼Œä¸€å¼€å§‹ä¸æ˜¯è¯´<a href="https://papers.cool/arxiv/2006.11239">ã€ŠImproved Denoising Diffusion Probabilistic Modelsã€‹</a>çš„å¯å­¦ä¹ æ–¹å·®å¢åŠ äº†è®­ç»ƒéš¾åº¦å—ï¼Ÿé‚£Extended-Analytic-DPMä¸ºå•¥åˆé‡æ–°å»åšå¯è®­ç»ƒçš„æ–¹å·®æ¨¡å‹å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼ŒDDPMæä¾›äº†æ–¹å·®çš„ä¸¤ç§æ–¹æ¡ˆ$\sigma_t = \frac{\bar{\beta}_{t-1}}{\bar{\beta}_t}\beta_t$å’Œ$\sigma_t = \beta_t$ï¼Œè¿™ä¸¤ç§ç®€å•æ–¹æ¡ˆçš„æ•ˆæœå…¶å®å·²ç»ç›¸å½“ä¸é”™äº†ã€‚è¿™ä¾§é¢è¯´æ˜ï¼Œæ›´ç²¾ç»†åœ°è°ƒæ•´æ–¹å·®å¯¹ç”Ÿæˆç»“æœçš„å½±å“ä¸å¤§ï¼ˆè‡³å°‘å¯¹äºå®Œæ•´çš„$T$æ­¥æ‰©æ•£æ˜¯è¿™æ ·ï¼‰ï¼Œä¸»è¦çš„è¿˜æ˜¯$\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)$çš„å­¦ä¹ ï¼Œæ–¹å·®åªæ˜¯â€œé”¦ä¸Šæ·»èŠ±â€çš„ä½œç”¨ã€‚å¦‚æœå°†æ–¹å·®è§†ä¸ºå¯å­¦ä¹ å‚æ•°æˆ–è€…æ¨¡å‹ï¼Œè·Ÿå‡å€¼æ¨¡å‹$\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)$ä¸€åŒå­¦ä¹ ï¼Œé‚£ä¹ˆéšç€è®­ç»ƒè¿‡ç¨‹å˜åŒ–çš„æ–¹å·®å°±ä¼šä¸¥é‡å¹²æ‰°å‡å€¼æ¨¡å‹$\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)$çš„å­¦ä¹ è¿‡ç¨‹ï¼Œè¿åäº†â€œ$\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)$ä¸ºä¸»ã€æ–¹å·®ä¸ºè¾…â€çš„åŸåˆ™ã€‚</p>
<p>Extended-Analytic-DPMçš„èªæ˜ä¹‹å¤„åœ¨äºï¼Œå®ƒæå‡ºäº†ä¸¤é˜¶æ®µçš„è®­ç»ƒæ–¹æ¡ˆï¼Œå³ç”¨åŸå§‹å›ºå®šæ–¹å·®çš„æµ‹è¯•è®­ç»ƒå¥½å‡å€¼æ¨¡å‹$\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)$ï¼Œç„¶åå›ºå®šè¯¥æ¨¡å‹ï¼Œå¹¶é‡ç”¨è¯¥æ¨¡å‹çš„å¤§éƒ¨åˆ†å‚æ•°æ¥å­¦ä¸€ä¸ªæ–¹å·®æ¨¡å‹ï¼Œè¿™æ ·ä¸€æ¥åè€Œâ€œä¸€ä¸¾ä¸‰å¾—â€ï¼š</p>
<blockquote>
<p>ä¸€ã€é™ä½äº†å‚æ•°é‡å’Œè®­ç»ƒæˆæœ¬ï¼›</p>
<p>äºŒã€å…è®¸é‡ç”¨å·²ç»è®­ç»ƒå¥½çš„å‡å€¼æ¨¡å‹ï¼›</p>
<p>ä¸‰ã€è®­ç»ƒè¿‡ç¨‹æ›´åŠ ç¨³å®šã€‚</p>
</blockquote>
<h2 id="_6">ä¸ªäººæ€è€ƒ</h2>
<p>åˆ°è¿™é‡Œï¼ŒExtended-Analytic-DPMçš„ä»‹ç»å°±åŸºæœ¬å®Œæˆäº†ã€‚æœ‰å¿ƒçš„è¯»è€…å¯èƒ½ä¼šæ„Ÿè§‰åˆ°ï¼Œå¦‚æœè¯´ä¸Šä¸€ç¯‡Analytic-DPMçš„ç»“æœç»™äººâ€œæƒŠè‰³â€ä¹‹æ„Ÿï¼Œé‚£ä¹ˆè¿™ä¸€ç¯‡Extended-Analytic-DPMå°±æ˜¾å¾—ä¸­è§„ä¸­çŸ©ï¼Œæ²¡ä»€ä¹ˆå¤ªåŠ¨äººå¿ƒå¼¦çš„åœ°æ–¹ã€‚å¯ä»¥è¯´ï¼ŒExtended-Analytic-DPMå°±æ˜¯Analytic-DPMçš„å¹³å‡¡æ¨å¹¿ï¼Œå°½ç®¡å®éªŒç»“æœæ˜¾ç¤ºå®ƒè¿˜æ˜¯èƒ½å¸¦æ¥ä¸é”™çš„æå‡ï¼Œä½†æ€»ä½“è€Œè¨€ç»™äººçš„æ„Ÿè§‰å°±æ˜¯å¾ˆå¹³æ·¡äº†ã€‚å½“ç„¶ï¼Œå¤§ä½“ä¸Šæ˜¯å› ä¸ºAnalytic-DPMâ€œç ç‰åœ¨å‰â€ï¼Œå¯¹æ¯”ä¹‹ä¸‹æ‰æ˜¾å¾—å®ƒæš—æ·¡ä¸€äº›ï¼Œæœ¬èº«ä¹Ÿç®—æ˜¯ä¸€ç¯‡æ¯”è¾ƒæ‰å®çš„å·¥ä½œã€‚</p>
<p>æ­¤å¤–ï¼Œå‰é¢æˆ‘ä»¬å·²ç»æåˆ°ï¼Œå®éªŒç»“æœæ˜¾ç¤ºï¼ŒåŸºäºPerfect Meanå‡è®¾çš„SN-DPMï¼Œæ•ˆæœè¦æ¯”åŸºäºImperfect Meanå‡è®¾çš„NPR-DPMè¦å¥½ï¼ŒåŒæ—¶è¿™ä¸€ç»“æœä¹Ÿä½¿å¾—åŸè®ºæ–‡çš„æ ‡é¢˜æœ‰ç‚¹â€œåä¸å‰¯å®â€äº†â€”â€”æ—¢ç„¶å®éªŒæ˜¾ç¤ºPerfect Meanå‡è®¾çš„æ–¹æ¡ˆæ›´å¥½ï¼Œåè¿‡æ¥æ„å‘³ç€Imperfect Meané—®é¢˜å¯ä»¥è§†ä¸ºä¸å­˜åœ¨äº†ã€‚åŸè®ºæ–‡å¹¶æ²¡æœ‰å¯¹æ­¤ç»“æœåšè¿›ä¸€æ­¥çš„åˆ†æå’Œè¯„ä»·ï¼Œç¬”è€…æƒ³ä¼šä¸ä¼šè·Ÿæ–¹å·®ä¼°è®¡çš„æœ‰åæ€§æœ‰å…³ï¼Ÿå¤§å®¶çŸ¥é“ï¼Œç›´æ¥ç”¨â€œé™¤ä»¥$n$â€çš„å…¬å¼å»ä¼°è®¡æ–¹å·®æ˜¯æœ‰åçš„ï¼Œè€ŒNPR-DPMæ­£æ˜¯åŸºäºå®ƒæ¥æ“ä½œçš„ï¼Œç›¸æ¯”ä¹‹ä¸‹SN-DPMåˆ™æ˜¯ç›´æ¥å–ä¼°è®¡äºŒé˜¶çŸ©ï¼ŒäºŒé˜¶çŸ©çš„ä¼°è®¡æ˜¯æ— åçš„ã€‚æ€»æ„Ÿè§‰æœ‰ç‚¹é“ç†ï¼Œä½†ä¹Ÿä¸èƒ½å®Œå…¨è¯´é€šï¼Œæœ‰ç‚¹è¿·ï½</p>
<p>æœ€åï¼Œä¸çŸ¥é“è¯»è€…ä¼šä¸ä¼šè·Ÿç¬”è€…ä¸€æ ·æœ‰ä¸ªç–‘é—®ï¼šåœ¨ç»™å®š$\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)$çš„å‰æä¸‹ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨åƒå¼$\eqref{eq:neg-log}$çš„è´Ÿå¯¹æ•°ä¼¼ç„¶ä¸ºæŸå¤±å‡½æ•°æ¥å­¦ä¹ æ–¹å·®ï¼Œè€Œæ˜¯è¦é‡æ–°è®¾è®¡NPR-DPMæˆ–SN-DPMè¿™ä¸¤ç§MSEå½¢å¼çš„lossï¼ŸMSEå½¢å¼çš„lossæœ‰ä»€ä¹ˆç‰¹åˆ«çš„å¥½å¤„å—ï¼Ÿç¬”è€…æš‚æ—¶ä¹Ÿæ²¡æƒ³åˆ°ç­”æ¡ˆã€‚</p>
<h2 id="_7">æ–‡ç« å°ç»“</h2>
<p>æœ¬æ–‡ä»‹ç»äº†è®ºæ–‡Analytic-DPMçš„å‡çº§ç‰ˆâ€”â€”â€œExtended-Analytic-DPMâ€ä¸­çš„æ‰©æ•£æ¨¡å‹æœ€ä¼˜æ–¹å·®ä¼°è®¡ç»“æœï¼Œå®ƒä¸»è¦é’ˆå¯¹ä¸å®Œç¾å‡å€¼æƒ…å½¢è¿›è¡Œäº†æ¨å¯¼ï¼Œå¹¶æå‡ºäº†æœ‰æ¡ä»¶æ–¹å·®çš„å­¦ä¹ æ–¹æ¡ˆã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/9246">https://spaces.ac.cn/archives/9246</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Aug. 18, 2022). ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆå…«ï¼‰ï¼šæœ€ä¼˜æ‰©æ•£æ–¹å·®ä¼°è®¡ï¼ˆä¸‹ï¼‰ ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/9246">https://spaces.ac.cn/archives/9246</a></p>
<p>@online{kexuefm-9246,<br />
title={ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆå…«ï¼‰ï¼šæœ€ä¼˜æ‰©æ•£æ–¹å·®ä¼°è®¡ï¼ˆä¸‹ï¼‰},<br />
author={è‹å‰‘æ—},<br />
year={2022},<br />
month={Aug},<br />
url={\url{https://spaces.ac.cn/archives/9246}},<br />
} </p>
<hr />
<h2 id="_8">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<h3 id="1">1. æ ¸å¿ƒæ¦‚å¿µä¸ç†è®ºåŸºç¡€</h3>
<h4 id="11">1.1 æ¡ä»¶åˆ†å¸ƒä¸æ–¹å·®ä¼°è®¡é—®é¢˜</h4>
<p>åœ¨æ‰©æ•£æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å»ºæ¨¡æ¡ä»¶åˆ†å¸ƒ$p(\boldsymbol{x}_0|\boldsymbol{x}_t)$ã€‚<strong>Analytic-DPM</strong>å‡è®¾è¿™ä¸ªåˆ†å¸ƒå¯ä»¥ç”¨æ­£æ€åˆ†å¸ƒè¿‘ä¼¼ï¼š</p>
<p>$$
p(\boldsymbol{x}_0|\boldsymbol{x}_t) \approx \mathcal{N}(\boldsymbol{x}_0; \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t), \bar{\sigma}_t^2\boldsymbol{I}) \tag{1}
$$</p>
<p>å…¶ä¸­ï¼š
- $\bar{\boldsymbol{\mu}}(\boldsymbol{x}<em>t) = \frac{1}{\bar{\alpha}_t}(\boldsymbol{x}_t - \bar{\beta}_t\boldsymbol{\epsilon}</em>\theta(\boldsymbol{x}_t, t))$ï¼šé¢„æµ‹çš„å‡å€¼
- $\bar{\sigma}_t^2$ï¼šå¾…ä¼°è®¡çš„æ–¹å·®ï¼ˆæ ‡é‡ï¼‰
- $\boldsymbol{I}$ï¼šå•ä½çŸ©é˜µï¼ˆå„å‘åŒæ€§å‡è®¾ï¼‰</p>
<p><strong>æ ¸å¿ƒé—®é¢˜</strong>ï¼šå¦‚ä½•ä¼°è®¡$\bar{\sigma}_t^2$ï¼Ÿ</p>
<h4 id="12-perfect-mean">1.2 å®Œç¾å‡å€¼å‡è®¾ï¼ˆPerfect Meanï¼‰</h4>
<p><strong>å‡è®¾1.1</strong>ï¼ˆå®Œç¾å‡å€¼ï¼‰ï¼šæ¨¡å‹$\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)$èƒ½å¤Ÿç²¾ç¡®é¢„æµ‹æ¡ä»¶æœŸæœ›ï¼š</p>
<p>$$
\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t) = \mathbb{E}_{\boldsymbol{x}_0 \sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}[\boldsymbol{x}_0] \tag{2}
$$</p>
<p>åœ¨æ­¤å‡è®¾ä¸‹ï¼Œåæ–¹å·®çŸ©é˜µçš„å®šä¹‰ä¸ºï¼š</p>
<p>$$
\boldsymbol{\Sigma}(\boldsymbol{x}_t) = \mathbb{E}_{\boldsymbol{x}_0 \sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t))(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t))^\top\right] \tag{3}
$$</p>
<p><strong>æ¨å¯¼</strong>ï¼šåˆ©ç”¨å‰å‘æ‰©æ•£è¿‡ç¨‹$\boldsymbol{x}_t = \bar{\alpha}_t\boldsymbol{x}_0 + \bar{\beta}_t\boldsymbol{\epsilon}$ï¼ˆå…¶ä¸­$\boldsymbol{\epsilon} \sim \mathcal{N}(\mathbf{0}, \boldsymbol{I})$ï¼‰ï¼Œæœ‰ï¼š</p>
<p>$$
\boldsymbol{x}_t - \bar{\alpha}_t\boldsymbol{x}_0 = \bar{\beta}_t\boldsymbol{\epsilon} \tag{4}
$$</p>
<p>å› æ­¤ï¼š</p>
<p>$$
\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t) = \frac{1}{\bar{\alpha}_t}(\boldsymbol{x}_t - \bar{\beta}_t\boldsymbol{\epsilon}_\theta(\boldsymbol{x}_t, t)) \tag{5}
$$</p>
<p>å°†(5)ä»£å…¥(3)ï¼š</p>
<p>$$
\begin{aligned}
\boldsymbol{\Sigma}(\boldsymbol{x}_t) &= \mathbb{E}_{\boldsymbol{x}_0 \sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\left(\boldsymbol{x}_0 - \frac{1}{\bar{\alpha}_t}(\boldsymbol{x}_t - \bar{\beta}_t\boldsymbol{\epsilon}_\theta)\right)\left(\boldsymbol{x}_0 - \frac{1}{\bar{\alpha}_t}(\boldsymbol{x}_t - \bar{\beta}_t\boldsymbol{\epsilon}_\theta)\right)^\top\right] \\
&= \frac{1}{\bar{\alpha}_t^2}\mathbb{E}_{\boldsymbol{x}_0 \sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[(\bar{\alpha}_t\boldsymbol{x}_0 - \boldsymbol{x}_t + \bar{\beta}_t\boldsymbol{\epsilon}_\theta)(\bar{\alpha}_t\boldsymbol{x}_0 - \boldsymbol{x}_t + \bar{\beta}_t\boldsymbol{\epsilon}_\theta)^\top\right] \\
&= \frac{1}{\bar{\alpha}_t^2}\mathbb{E}_{\boldsymbol{x}_0 \sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[(\bar{\beta}_t\boldsymbol{\epsilon} - \bar{\beta}_t\boldsymbol{\epsilon}_\theta)(\bar{\beta}_t\boldsymbol{\epsilon} - \bar{\beta}_t\boldsymbol{\epsilon}_\theta)^\top\right] \\
&= \frac{\bar{\beta}_t^2}{\bar{\alpha}_t^2}\mathbb{E}_{\boldsymbol{x}_0 \sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[(\boldsymbol{\epsilon} - \boldsymbol{\epsilon}_\theta)(\boldsymbol{\epsilon} - \boldsymbol{\epsilon}_\theta)^\top\right]
\end{aligned} \tag{6}
$$</p>
<h4 id="13-imperfect-mean">1.3 ä¸å®Œç¾å‡å€¼å‡è®¾ï¼ˆImperfect Meanï¼‰</h4>
<p><strong>ç°å®æƒ…å†µ</strong>ï¼šæ¨¡å‹$\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)$å¹¶ä¸å®Œç¾ï¼Œå­˜åœ¨åå·®ï¼š</p>
<p>$$
\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t) \neq \mathbb{E}_{\boldsymbol{x}_0 \sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}[\boldsymbol{x}_0] \tag{7}
$$</p>
<p><strong>Extended-Analytic-DPM</strong>çš„ç›®æ ‡æ˜¯åœ¨ä¸å®Œç¾å‡å€¼æƒ…å†µä¸‹æ”¹è¿›æ–¹å·®ä¼°è®¡ã€‚å®šä¹‰åå·®ä¸ºï¼š</p>
<p>$$
\boldsymbol{\delta}(\boldsymbol{x}_t) = \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t) - \mathbb{E}_{\boldsymbol{x}_0 \sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}[\boldsymbol{x}_0] \tag{8}
$$</p>
<p>åˆ™çœŸå®çš„å‡æ–¹è¯¯å·®ä¸ºï¼š</p>
<p>$$
\begin{aligned}
&\mathbb{E}_{\boldsymbol{x}_0 \sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\|\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)\|^2\right] \\
=& \mathbb{E}_{\boldsymbol{x}_0 \sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\|\boldsymbol{x}_0 - \mathbb{E}[\boldsymbol{x}_0] + \mathbb{E}[\boldsymbol{x}_0] - \bar{\boldsymbol{\mu}}\|^2\right] \\
=& \text{Var}(\boldsymbol{x}_0|\boldsymbol{x}_t) + \|\boldsymbol{\delta}(\boldsymbol{x}_t)\|^2
\end{aligned} \tag{9}
$$</p>
<h3 id="2">2. æœ€å¤§ä¼¼ç„¶æ¡†æ¶ä¸‹çš„æ–¹å·®ä¼°è®¡</h3>
<h4 id="21">2.1 æ ‡é‡æ–¹å·®çš„æœ€å¤§ä¼¼ç„¶ä¼°è®¡</h4>
<p>å‡è®¾$\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)$å·²å›ºå®šï¼Œæˆ‘ä»¬ç”¨æ­£æ€åˆ†å¸ƒ$\mathcal{N}(\boldsymbol{x}_0; \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t), \bar{\sigma}_t^2\boldsymbol{I})$æ¥å»ºæ¨¡$p(\boldsymbol{x}_0|\boldsymbol{x}_t)$ã€‚</p>
<p><strong>è´Ÿå¯¹æ•°ä¼¼ç„¶</strong>ï¼š</p>
<p>$$
\begin{aligned}
\mathcal{L}(\bar{\sigma}_t^2) &= \mathbb{E}_{\boldsymbol{x}_t \sim p(\boldsymbol{x}_t)}\mathbb{E}_{\boldsymbol{x}_0 \sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[-\log \mathcal{N}(\boldsymbol{x}_0; \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t), \bar{\sigma}_t^2\boldsymbol{I})\right] \\
&= \mathbb{E}_{\boldsymbol{x}_t, \boldsymbol{x}_0}\left[\frac{\|\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)\|^2}{2\bar{\sigma}_t^2} + \frac{d}{2}\log(2\pi\bar{\sigma}_t^2)\right]
\end{aligned} \tag{10}
$$</p>
<p><strong>ä¼˜åŒ–</strong>ï¼šå¯¹$\bar{\sigma}_t^2$æ±‚å¯¼å¹¶ä»¤å…¶ä¸ºé›¶ï¼š</p>
<p>$$
\frac{\partial \mathcal{L}}{\partial \bar{\sigma}_t^2} = -\frac{\mathbb{E}[\|\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)\|^2]}{2(\bar{\sigma}_t^2)^2} + \frac{d}{2\bar{\sigma}_t^2} = 0 \tag{11}
$$</p>
<p>è§£å¾—ï¼š</p>
<p>$$
\bar{\sigma}_t^2 = \frac{1}{d}\mathbb{E}_{\boldsymbol{x}_t, \boldsymbol{x}_0 \sim p(\boldsymbol{x}_t|\boldsymbol{x}_0)\tilde{p}(\boldsymbol{x}_0)}\left[\|\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)\|^2\right] \tag{12}
$$</p>
<p>è¿™é‡Œä½¿ç”¨äº†è”åˆåˆ†å¸ƒåˆ†è§£ï¼š</p>
<p>$$
p(\boldsymbol{x}_t, \boldsymbol{x}_0) = p(\boldsymbol{x}_t|\boldsymbol{x}_0)\tilde{p}(\boldsymbol{x}_0) \tag{13}
$$</p>
<h4 id="22">2.2 ç”¨å™ªå£°å‚æ•°åŒ–çš„æ–¹å·®ä¼°è®¡</h4>
<p><strong>å…³é”®è½¬æ¢</strong>ï¼šå°†$\bar{\boldsymbol{\mu}}(\boldsymbol{x}<em>t) = \frac{1}{\bar{\alpha}_t}(\boldsymbol{x}_t - \bar{\beta}_t\boldsymbol{\epsilon}</em>\theta(\boldsymbol{x}_t, t))$ä»£å…¥(12)ï¼š</p>
<p>$$
\begin{aligned}
\|\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)\|^2 &= \left\|\boldsymbol{x}_0 - \frac{1}{\bar{\alpha}_t}(\boldsymbol{x}_t - \bar{\beta}_t\boldsymbol{\epsilon}_\theta)\right\|^2 \\
&= \left\|\boldsymbol{x}_0 - \frac{1}{\bar{\alpha}_t}(\bar{\alpha}_t\boldsymbol{x}_0 + \bar{\beta}_t\boldsymbol{\epsilon} - \bar{\beta}_t\boldsymbol{\epsilon}_\theta)\right\|^2 \\
&= \left\|\frac{\bar{\beta}_t}{\bar{\alpha}_t}(\boldsymbol{\epsilon} - \boldsymbol{\epsilon}_\theta)\right\|^2 \\
&= \frac{\bar{\beta}_t^2}{\bar{\alpha}_t^2}\|\boldsymbol{\epsilon} - \boldsymbol{\epsilon}_\theta(\boldsymbol{x}_t, t)\|^2
\end{aligned} \tag{14}
$$</p>
<p>å› æ­¤ï¼Œæ–¹å·®ä¼°è®¡è½¬åŒ–ä¸ºï¼š</p>
<p>$$
\bar{\sigma}_t^2 = \frac{\bar{\beta}_t^2}{\bar{\alpha}_t^2 d}\mathbb{E}_{\boldsymbol{x}_0 \sim \tilde{p}(\boldsymbol{x}_0), \boldsymbol{\epsilon} \sim \mathcal{N}(\mathbf{0}, \boldsymbol{I})}\left[\|\boldsymbol{\epsilon} - \boldsymbol{\epsilon}_\theta(\bar{\alpha}_t\boldsymbol{x}_0 + \bar{\beta}_t\boldsymbol{\epsilon}, t)\|^2\right] \tag{15}
$$</p>
<p><strong>å®šç†2.1</strong>ï¼ˆä¸å®Œç¾å‡å€¼ä¸‹çš„æ–¹å·®ä¼°è®¡ï¼‰ï¼šåœ¨ä¸å®Œç¾å‡å€¼å‡è®¾ä¸‹ï¼Œæœ€å¤§ä¼¼ç„¶ä¼°è®¡çš„æ–¹å·®ä¸ºï¼š</p>
<p>$$
\bar{\sigma}_t^2 = \frac{\bar{\beta}_t^2}{\bar{\alpha}_t^2 d}\mathbb{E}_{\tilde{p}(\boldsymbol{x}_0), \mathcal{N}(\boldsymbol{\epsilon})}\left[\|\boldsymbol{\epsilon} - \boldsymbol{\epsilon}_\theta(\sqrt{\bar{\alpha}_t}\boldsymbol{x}_0 + \sqrt{1-\bar{\alpha}_t}\boldsymbol{\epsilon}, t)\|^2\right] \tag{16}
$$</p>
<p>è¿™é‡Œä½¿ç”¨äº†æ ‡å‡†å‚æ•°åŒ–$\bar{\alpha}_t = \bar{\alpha}_t^2$ï¼Œ$\bar{\beta}_t = \sqrt{1-\bar{\alpha}_t}$ã€‚</p>
<h4 id="23">2.3 å¯¹è§’æ–¹å·®çŸ©é˜µçš„ä¼°è®¡</h4>
<p><strong>æ¨å¹¿åˆ°å¯¹è§’åæ–¹å·®</strong>ï¼šå…è®¸æ¯ä¸ªç»´åº¦æœ‰ä¸åŒçš„æ–¹å·®ï¼Œå³$\boldsymbol{\Sigma} = \text{diag}(\bar{\boldsymbol{\sigma}}_t^2)$ã€‚</p>
<p>è´Ÿå¯¹æ•°ä¼¼ç„¶å˜ä¸ºï¼š</p>
<p>$$
\mathcal{L}(\bar{\boldsymbol{\sigma}}_t^2) = \mathbb{E}_{\boldsymbol{x}_t, \boldsymbol{x}_0}\left[\sum_{i=1}^d \frac{(x_{0,i} - \bar{\mu}_i(\boldsymbol{x}_t))^2}{2\bar{\sigma}_{t,i}^2} + \frac{1}{2}\sum_{i=1}^d \log(2\pi\bar{\sigma}_{t,i}^2)\right] \tag{17}
$$</p>
<p>å¯¹æ¯ä¸ªåˆ†é‡ç‹¬ç«‹ä¼˜åŒ–ï¼Œå¾—åˆ°ï¼š</p>
<p>$$
\bar{\sigma}_{t,i}^2 = \mathbb{E}_{\boldsymbol{x}_t, \boldsymbol{x}_0}\left[(x_{0,i} - \bar{\mu}_i(\boldsymbol{x}_t))^2\right] \tag{18}
$$</p>
<p>å‘é‡å½¢å¼ï¼ˆHadamardç§¯ï¼‰ï¼š</p>
<p>$$
\bar{\boldsymbol{\sigma}}_t^2 = \mathbb{E}_{\boldsymbol{x}_t, \boldsymbol{x}_0}\left[(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t))^2\right] \tag{19}
$$</p>
<p>ç”¨å™ªå£°å‚æ•°åŒ–ï¼š</p>
<p>$$
\bar{\boldsymbol{\sigma}}_t^2 = \frac{\bar{\beta}_t^2}{\bar{\alpha}_t^2}\mathbb{E}_{\tilde{p}(\boldsymbol{x}_0), \mathcal{N}(\boldsymbol{\epsilon})}\left[(\boldsymbol{\epsilon} - \boldsymbol{\epsilon}_\theta(\bar{\alpha}_t\boldsymbol{x}_0 + \bar{\beta}_t\boldsymbol{\epsilon}, t))^2\right] \tag{20}
$$</p>
<h3 id="3">3. æ¡ä»¶æ–¹å·®çš„å­¦ä¹ æ–¹æ³•</h3>
<h4 id="31">3.1 æ¡ä»¶æ–¹å·®çš„å®šä¹‰</h4>
<p><strong>ç›®æ ‡</strong>ï¼šä¼°è®¡ä¾èµ–äº$\boldsymbol{x}_t$çš„æ–¹å·®$\bar{\boldsymbol{\sigma}}_t^2(\boldsymbol{x}_t)$ï¼Œè€Œéå¯¹æ‰€æœ‰$\boldsymbol{x}_t$å¹³å‡çš„æ ‡é‡æˆ–å‘é‡ã€‚</p>
<p>æ¡ä»¶æ–¹å·®å®šä¹‰ä¸ºï¼š</p>
<p>$$
\bar{\boldsymbol{\sigma}}_t^2(\boldsymbol{x}_t) = \mathbb{E}_{\boldsymbol{x}_0 \sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t))^2\right] \tag{21}
$$</p>
<p>ç”¨å™ªå£°è¡¨ç¤ºï¼š</p>
<p>$$
\bar{\boldsymbol{\sigma}}_t^2(\boldsymbol{x}_t) = \frac{\bar{\beta}_t^2}{\bar{\alpha}_t^2}\mathbb{E}_{\boldsymbol{x}_0 \sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[(\boldsymbol{\epsilon}_t - \boldsymbol{\epsilon}_\theta(\boldsymbol{x}_t, t))^2\right] \tag{22}
$$</p>
<p>å…¶ä¸­$\boldsymbol{\epsilon}_t = \frac{\boldsymbol{x}_t - \bar{\alpha}_t\boldsymbol{x}_0}{\bar{\beta}_t}$æ˜¯å‰å‘æ‰©æ•£è¿‡ç¨‹ä¸­çš„çœŸå®å™ªå£°ã€‚</p>
<h4 id="32-npr-dpmnoise-prediction-residual">3.2 NPR-DPMæ–¹æ³•ï¼ˆNoise Prediction Residualï¼‰</h4>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šåˆ©ç”¨æœ€ä¼˜åŒ–ç­‰ä»·æ€§ï¼Œå°†æ¡ä»¶æœŸæœ›è½¬åŒ–ä¸ºå¯å­¦ä¹ çš„ç›®æ ‡ã€‚</p>
<p><strong>å¼•ç†3.1</strong>ï¼ˆæ¡ä»¶æœŸæœ›çš„æœ€å°åŒ–ç­‰ä»·ï¼‰ï¼šå¯¹äºéšæœºå˜é‡$\boldsymbol{Z}$å’Œæ¡ä»¶$\boldsymbol{X}$ï¼š</p>
<p>$$
\mathbb{E}[\boldsymbol{Z}|\boldsymbol{X}] = \arg\min_{\boldsymbol{g}(\boldsymbol{X})} \mathbb{E}\left[\|\boldsymbol{Z} - \boldsymbol{g}(\boldsymbol{X})\|^2\right] \tag{23}
$$</p>
<p><strong>åº”ç”¨åˆ°æ–¹å·®ä¼°è®¡</strong>ï¼šè®¾$\boldsymbol{Z} = (\boldsymbol{\epsilon}<em>t - \boldsymbol{\epsilon}</em>\theta(\boldsymbol{x}_t, t))^2$ï¼Œ$\boldsymbol{X} = \boldsymbol{x}_t$ï¼Œåˆ™ï¼š</p>
<p>$$
\begin{aligned}
\bar{\boldsymbol{\sigma}}_t^2(\boldsymbol{x}_t) &= \frac{\bar{\beta}_t^2}{\bar{\alpha}_t^2}\mathbb{E}_{\boldsymbol{x}_0 \sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[(\boldsymbol{\epsilon}_t - \boldsymbol{\epsilon}_\theta)^2\right] \\
&= \frac{\bar{\beta}_t^2}{\bar{\alpha}_t^2}\arg\min_{\boldsymbol{v}(\boldsymbol{x}_t)} \mathbb{E}_{\boldsymbol{x}_0 \sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\|(\boldsymbol{\epsilon}_t - \boldsymbol{\epsilon}_\theta)^2 - \boldsymbol{v}(\boldsymbol{x}_t)\|^2\right]
\end{aligned} \tag{24}
$$</p>
<p><strong>è®­ç»ƒç›®æ ‡</strong>ï¼šå¤–å±‚å–$\mathbb{E}_{\boldsymbol{x}_t \sim p(\boldsymbol{x}_t)}$ï¼Œå¹¶ç”¨è´å¶æ–¯å…¬å¼è½¬æ¢ä¸ºå‰å‘è¿‡ç¨‹ï¼š</p>
<p>$$
\begin{aligned}
\mathcal{L}_{\text{NPR}} &= \mathbb{E}_{\boldsymbol{x}_t \sim p(\boldsymbol{x}_t)}\mathbb{E}_{\boldsymbol{x}_0 \sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\|(\boldsymbol{\epsilon}_t - \boldsymbol{\epsilon}_\theta(\boldsymbol{x}_t, t))^2 - \boldsymbol{v}_\phi(\boldsymbol{x}_t, t)\|^2\right] \\
&= \mathbb{E}_{\boldsymbol{x}_0 \sim \tilde{p}(\boldsymbol{x}_0), \boldsymbol{\epsilon} \sim \mathcal{N}(\mathbf{0}, \boldsymbol{I})}\left[\|(\boldsymbol{\epsilon} - \boldsymbol{\epsilon}_\theta(\boldsymbol{x}_t, t))^2 - \boldsymbol{v}_\phi(\boldsymbol{x}_t, t)\|^2\right]
\end{aligned} \tag{25}
$$</p>
<p>å…¶ä¸­$\boldsymbol{x}<em>t = \bar{\alpha}_t\boldsymbol{x}_0 + \bar{\beta}_t\boldsymbol{\epsilon}$ï¼Œ$\boldsymbol{v}</em>\phi$æ˜¯å¾…å­¦ä¹ çš„æ–¹å·®é¢„æµ‹ç½‘ç»œã€‚</p>
<p><strong>æœ€ç»ˆæ–¹å·®ä¼°è®¡</strong>ï¼š</p>
<p>$$
\hat{\bar{\boldsymbol{\sigma}}}_t^2(\boldsymbol{x}_t) = \frac{\bar{\beta}_t^2}{\bar{\alpha}_t^2} \boldsymbol{v}_\phi(\boldsymbol{x}_t, t) \tag{26}
$$</p>
<h4 id="33-sn-dpmsecond-moment-network">3.3 SN-DPMæ–¹æ³•ï¼ˆSecond-moment Networkï¼‰</h4>
<p><strong>åŸºäºå®Œç¾å‡å€¼å‡è®¾</strong>ï¼šå°½ç®¡æ ‡é¢˜å¼ºè°ƒImperfect Meanï¼Œå®éªŒæ˜¾ç¤ºPerfect Meanå‡è®¾çš„æ–¹æ³•æ›´æœ‰æ•ˆã€‚</p>
<p>åœ¨å®Œç¾å‡å€¼å‡è®¾ä¸‹ï¼Œä»(6)å‡ºå‘ï¼Œè€ƒè™‘å¯¹è§’å…ƒç´ ï¼š</p>
<p>$$
\bar{\boldsymbol{\sigma}}_t^2(\boldsymbol{x}_t) = \frac{\bar{\beta}_t^2}{\bar{\alpha}_t^2}\mathbb{E}_{\boldsymbol{x}_0 \sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[(\boldsymbol{\epsilon} - \boldsymbol{\epsilon}_\theta)^2 - (\mathbb{E}[\boldsymbol{\epsilon} - \boldsymbol{\epsilon}_\theta])^2\right] \tag{27}
$$</p>
<p><strong>ç®€åŒ–å‡è®¾</strong>ï¼šå‡è®¾å™ªå£°é¢„æµ‹çš„åå·®å¯å¿½ç•¥ï¼Œå³$\mathbb{E}[\boldsymbol{\epsilon} - \boldsymbol{\epsilon}_\theta] \approx \mathbf{0}$ï¼Œåˆ™ï¼š</p>
<p>$$
\bar{\boldsymbol{\sigma}}_t^2(\boldsymbol{x}_t) \approx \frac{\bar{\beta}_t^2}{\bar{\alpha}_t^2}\mathbb{E}_{\boldsymbol{x}_0 \sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[(\boldsymbol{\epsilon} - \boldsymbol{\epsilon}_\theta)^2\right] \tag{28}
$$</p>
<p><strong>è®­ç»ƒç›®æ ‡</strong>ï¼šç›´æ¥é¢„æµ‹äºŒé˜¶çŸ©ï¼ˆæ— ä¸­å¿ƒåŒ–ï¼‰ï¼š</p>
<p>$$
\mathcal{L}_{\text{SN}} = \mathbb{E}_{\boldsymbol{x}_0 \sim \tilde{p}(\boldsymbol{x}_0), \boldsymbol{\epsilon} \sim \mathcal{N}(\mathbf{0}, \boldsymbol{I})}\left[\|(\boldsymbol{\epsilon} - \boldsymbol{\epsilon}_\theta(\boldsymbol{x}_t, t))^2 - \boldsymbol{s}_\psi(\boldsymbol{x}_t, t)\|^2\right] \tag{29}
$$</p>
<p>å…¶ä¸­$\boldsymbol{s}_\psi$æ˜¯ç¬¬äºŒçŸ©ç½‘ç»œã€‚</p>
<p><strong>æ–¹å·®ä¼°è®¡</strong>ï¼š</p>
<p>$$
\hat{\bar{\boldsymbol{\sigma}}}_t^2(\boldsymbol{x}_t) = \frac{\bar{\beta}_t^2}{\bar{\alpha}_t^2} \boldsymbol{s}_\psi(\boldsymbol{x}_t, t) \tag{30}
$$</p>
<h4 id="34">3.4 ä¸¤ç§æ–¹æ³•çš„æ¯”è¾ƒ</h4>
<p><strong>å®šç†3.2</strong>ï¼ˆNPR vs SNï¼‰ï¼š</p>
<ol>
<li>
<p><strong>NPR-DPM</strong>ç›´æ¥ä¼°è®¡æ–¹å·®ï¼ˆæœ‰åä¼°è®¡ï¼‰ï¼š
   $$
   \text{Var}[\boldsymbol{Z}] = \mathbb{E}[\boldsymbol{Z}^2] - (\mathbb{E}[\boldsymbol{Z}])^2
   $$
   å½“ç”¨æ ·æœ¬å‡å€¼ä¼°è®¡æ—¶ï¼Œæ ·æœ¬æ–¹å·®$\frac{1}{n}\sum (Z_i - \bar{Z})^2$æ˜¯æœ‰åçš„ã€‚</p>
</li>
<li>
<p><strong>SN-DPM</strong>ä¼°è®¡äºŒé˜¶çŸ©ï¼ˆæ— åä¼°è®¡ï¼‰ï¼š
   $$
   \mathbb{E}[\boldsymbol{Z}^2]
   $$
   äºŒé˜¶çŸ©çš„æ ·æœ¬ä¼°è®¡$\frac{1}{n}\sum Z_i^2$æ˜¯æ— åçš„ã€‚</p>
</li>
</ol>
<p><strong>æ¨è®º</strong>ï¼šSN-DPMåœ¨å®éªŒä¸­è¡¨ç°æ›´å¥½ï¼Œå¯èƒ½å› ä¸ºï¼š
- æ— åæ€§å¸¦æ¥æ›´ç¨³å®šçš„æ¢¯åº¦
- é¿å…äº†ä¸­å¿ƒåŒ–æ“ä½œå¼•å…¥çš„é¢å¤–å™ªå£°</p>
<h3 id="4">4. å®Œæ•´åæ–¹å·®çŸ©é˜µçš„ç†è®ºåˆ†æ</h3>
<h4 id="41">4.1 å®Œæ•´åæ–¹å·®çš„å½¢å¼</h4>
<p>ç†è®ºä¸Šï¼Œæœ€å®Œæ•´çš„å»ºæ¨¡æ˜¯ä½¿ç”¨éå¯¹è§’åæ–¹å·®çŸ©é˜µï¼š</p>
<p>$$
\boldsymbol{\Sigma}(\boldsymbol{x}_t) = \mathbb{E}_{\boldsymbol{x}_0 \sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t))(\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}(\boldsymbol{x}_t))^\top\right] \tag{31}
$$</p>
<p>ä»å®Œç¾å‡å€¼å‡è®¾å‡ºå‘ï¼Œæœ‰ï¼š</p>
<p>$$
\boldsymbol{\Sigma}(\boldsymbol{x}_t) = \frac{\bar{\beta}_t^2}{\bar{\alpha}_t^2}\left[\boldsymbol{I} - \mathbb{E}_{\boldsymbol{x}_0 \sim p(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\boldsymbol{\epsilon}_\theta(\boldsymbol{x}_t, t)\boldsymbol{\epsilon}_\theta(\boldsymbol{x}_t, t)^\top\right]\right] \tag{32}
$$</p>
<p>åœ¨ä¸å®Œç¾å‡å€¼æƒ…å†µä¸‹ï¼š</p>
<p>$$
\begin{aligned}
\boldsymbol{\Sigma}(\boldsymbol{x}_t) &= \mathbb{E}[(\boldsymbol{x}_0 - \mathbb{E}[\boldsymbol{x}_0])(\boldsymbol{x}_0 - \mathbb{E}[\boldsymbol{x}_0])^\top] \\
&\quad + (\mathbb{E}[\boldsymbol{x}_0] - \bar{\boldsymbol{\mu}})(\mathbb{E}[\boldsymbol{x}_0] - \bar{\boldsymbol{\mu}})^\top
\end{aligned} \tag{33}
$$</p>
<p>ç¬¬ä¸€é¡¹æ˜¯çœŸå®æ¡ä»¶æ–¹å·®ï¼Œç¬¬äºŒé¡¹æ˜¯å‡å€¼åå·®çš„å¤–ç§¯ã€‚</p>
<h4 id="42">4.2 ç»´åº¦è¯…å’’ä¸ç®€åŒ–å¿…è¦æ€§</h4>
<p><strong>è®¡ç®—å¤æ‚åº¦åˆ†æ</strong>ï¼š</p>
<p>å¯¹äºå›¾åƒæ•°æ®ï¼Œè®¾åˆ†è¾¨ç‡ä¸º$H \times W$ï¼Œé€šé“æ•°ä¸º$C$ï¼Œåˆ™ï¼š
- ç»´åº¦ï¼š$d = H \times W \times C$
- å®Œæ•´åæ–¹å·®çŸ©é˜µå¤§å°ï¼š$d \times d$</p>
<p><strong>ä¾‹å­</strong>ï¼š
- CIFAR-10ï¼š$32 \times 32 \times 3 = 3072$ â†’ åæ–¹å·®çŸ©é˜µï¼š$3072^2 \approx 9.4 \times 10^6$å…ƒç´ 
- ImageNet (256Ã—256)ï¼š$256 \times 256 \times 3 = 196608$ â†’ åæ–¹å·®çŸ©é˜µï¼š$\approx 3.9 \times 10^{10}$å…ƒç´ </p>
<p><strong>å­˜å‚¨éœ€æ±‚</strong>ï¼ˆå•ç²¾åº¦æµ®ç‚¹ï¼‰ï¼š
- CIFAR-10ï¼š$\approx 38$ MB
- ImageNetï¼š$\approx 154$ GBï¼ˆå•ä¸ªæ ·æœ¬ï¼ï¼‰</p>
<p><strong>ç»“è®º</strong>ï¼šå®Œæ•´åæ–¹å·®çŸ©é˜µåœ¨å®è·µä¸­ä¸å¯è¡Œï¼Œå¿…é¡»é‡‡ç”¨ç®€åŒ–å‡è®¾ï¼ˆå„å‘åŒæ€§æˆ–å¯¹è§’ï¼‰ã€‚</p>
<h4 id="43">4.3 ä½ç§©è¿‘ä¼¼çš„å¯èƒ½æ€§</h4>
<p><strong>å‡è®¾</strong>ï¼šåæ–¹å·®çŸ©é˜µå¯ä»¥ä½ç§©åˆ†è§£ï¼š</p>
<p>$$
\boldsymbol{\Sigma}(\boldsymbol{x}_t) \approx \boldsymbol{U}\boldsymbol{\Lambda}\boldsymbol{U}^\top + \sigma_0^2\boldsymbol{I} \tag{34}
$$</p>
<p>å…¶ä¸­$\boldsymbol{U} \in \mathbb{R}^{d \times r}$ï¼ˆ$r \ll d$ï¼‰ï¼Œ$\boldsymbol{\Lambda} \in \mathbb{R}^{r \times r}$æ˜¯å¯¹è§’çŸ©é˜µã€‚</p>
<p><strong>å‚æ•°é‡</strong>ï¼š$dr + r \approx dr$ï¼ˆå½“$r \ll d$æ—¶ï¼‰</p>
<p><strong>æŒ‘æˆ˜</strong>ï¼š
- å­¦ä¹ ç¨³å®šæ€§ï¼šä½ç§©åˆ†è§£éœ€è¦æ­£å®šæ€§çº¦æŸ
- é‡‡æ ·æ•ˆç‡ï¼šå¤šå…ƒæ­£æ€é‡‡æ ·éœ€è¦Choleskyåˆ†è§£æˆ–ç‰¹å¾å€¼åˆ†è§£ï¼Œ$O(r^3)$å¤æ‚åº¦
- å®éªŒéªŒè¯ï¼šç›®å‰ç¼ºä¹è¯æ®è¡¨æ˜ä½ç§©å‡è®¾åœ¨æ‰©æ•£æ¨¡å‹ä¸­æœ‰æ•ˆ</p>
<h3 id="5">5. ä¸¤é˜¶æ®µè®­ç»ƒæ–¹æ¡ˆ</h3>
<h4 id="51">5.1 è”åˆè®­ç»ƒçš„é—®é¢˜</h4>
<p><strong>ä¼ ç»Ÿæ–¹æ¡ˆ</strong>ï¼šåŒæ—¶è®­ç»ƒå‡å€¼ç½‘ç»œ$\boldsymbol{\epsilon}<em>\theta$å’Œæ–¹å·®ç½‘ç»œ$\boldsymbol{v}</em>\phi$ï¼š</p>
<p>$$
\min_{\theta, \phi} \mathbb{E}\left[\|\boldsymbol{\epsilon} - \boldsymbol{\epsilon}_\theta(\boldsymbol{x}_t, t)\|^2 + \lambda\|(\boldsymbol{\epsilon} - \boldsymbol{\epsilon}_\theta)^2 - \boldsymbol{v}_\phi(\boldsymbol{x}_t, t)\|^2\right] \tag{35}
$$</p>
<p><strong>é—®é¢˜</strong>ï¼š
1. <strong>æ¢¯åº¦å¹²æ‰°</strong>ï¼š$\boldsymbol{v}<em>\phi$çš„è®­ç»ƒä¾èµ–äº$(\boldsymbol{\epsilon} - \boldsymbol{\epsilon}</em>\theta)^2$ï¼Œä½†$\boldsymbol{\epsilon}_\theta$ä¹Ÿåœ¨æ›´æ–°ï¼Œå¯¼è‡´ç›®æ ‡ä¸ç¨³å®š
2. <strong>ä¸»æ¬¡é¢ å€’</strong>ï¼šæ–¹å·®å¯¹ç”Ÿæˆè´¨é‡çš„å½±å“è¾ƒå°ï¼ˆ"é”¦ä¸Šæ·»èŠ±"ï¼‰ï¼Œä½†è”åˆè®­ç»ƒæ—¶å¯èƒ½è¿‡åº¦å…³æ³¨æ–¹å·®ä¼˜åŒ–
3. <strong>æ”¶æ•›å›°éš¾</strong>ï¼šImproved DDPMæŠ¥å‘Šè¿‡å¯å­¦ä¹ æ–¹å·®å¢åŠ è®­ç»ƒéš¾åº¦</p>
<h4 id="52">5.2 ä¸¤é˜¶æ®µè®­ç»ƒç­–ç•¥</h4>
<p><strong>é˜¶æ®µ1</strong>ï¼šå›ºå®šæ–¹å·®è®­ç»ƒå‡å€¼</p>
<p>$$
\min_\theta \mathbb{E}_{\boldsymbol{x}_0 \sim \tilde{p}(\boldsymbol{x}_0), \boldsymbol{\epsilon} \sim \mathcal{N}(\mathbf{0}, \boldsymbol{I})}\left[\|\boldsymbol{\epsilon} - \boldsymbol{\epsilon}_\theta(\bar{\alpha}_t\boldsymbol{x}_0 + \bar{\beta}_t\boldsymbol{\epsilon}, t)\|^2\right] \tag{36}
$$</p>
<p>ä½¿ç”¨å›ºå®šæ–¹å·®ï¼ˆå¦‚$\beta_t$æˆ–$\frac{\bar{\beta}_{t-1}}{\bar{\beta}_t}\beta_t$ï¼‰ã€‚</p>
<p><strong>é˜¶æ®µ2</strong>ï¼šå›ºå®šå‡å€¼è®­ç»ƒæ–¹å·®</p>
<p>$$
\min_\phi \mathbb{E}_{\boldsymbol{x}_0 \sim \tilde{p}(\boldsymbol{x}_0), \boldsymbol{\epsilon} \sim \mathcal{N}(\mathbf{0}, \boldsymbol{I})}\left[\|(\boldsymbol{\epsilon} - \boldsymbol{\epsilon}_\theta^*(\boldsymbol{x}_t, t))^2 - \boldsymbol{v}_\phi(\boldsymbol{x}_t, t)\|^2\right] \tag{37}
$$</p>
<p>å…¶ä¸­$\boldsymbol{\epsilon}_\theta^*$æ˜¯é˜¶æ®µ1è®­ç»ƒå¥½çš„å›ºå®šæ¨¡å‹ã€‚</p>
<p><strong>å‚æ•°å…±äº«æŠ€å·§</strong>ï¼š
- $\boldsymbol{\epsilon}<em>\theta$å’Œ$\boldsymbol{v}</em>\phi$å…±äº«ä¸»å¹²ç½‘ç»œï¼ˆU-Netçš„ç¼–ç å™¨-è§£ç å™¨ï¼‰
- åªæœ‰æœ€åçš„è¾“å‡ºå±‚ä¸åŒï¼š
  - $\boldsymbol{\epsilon}<em>\theta$ï¼šè¾“å‡º$d$ç»´å™ªå£°é¢„æµ‹
  - $\boldsymbol{v}</em>\phi$ï¼šè¾“å‡º$d$ç»´æ–¹å·®é¢„æµ‹</p>
<p>$$
\begin{aligned}
\boldsymbol{h} &= \text{U-Net}_{\text{shared}}(\boldsymbol{x}_t, t) \\
\boldsymbol{\epsilon}_\theta &= W_\epsilon \boldsymbol{h} + \boldsymbol{b}_\epsilon \\
\boldsymbol{v}_\phi &= W_v \boldsymbol{h} + \boldsymbol{b}_v
\end{aligned} \tag{38}
$$</p>
<h4 id="53">5.3 ä¸¤é˜¶æ®µè®­ç»ƒçš„ä¼˜åŠ¿</h4>
<p><strong>å®šç†5.1</strong>ï¼ˆä¸¤é˜¶æ®µè®­ç»ƒçš„æ”¶æ•›æ€§ï¼‰ï¼šè®¾$\boldsymbol{\epsilon}<em _text_stage2="\text{stage2">\theta^*$æ˜¯é˜¶æ®µ1çš„æœ€ä¼˜è§£ï¼Œ$\mathcal{L}</em>$æ˜¯é˜¶æ®µ2çš„æŸå¤±ï¼Œåˆ™ï¼š}</p>
<p>$$
\min_\phi \mathcal{L}_{\text{stage2}}(\phi | \theta^*) \leq \min_{\theta, \phi} \mathcal{L}_{\text{joint}}(\theta, \phi) \tag{39}
$$</p>
<p>åœ¨å›ºå®š$\theta^*$çš„çº¦æŸä¸‹ã€‚</p>
<p><strong>è¯æ˜</strong>ï¼šé˜¶æ®µ2çš„ä¼˜åŒ–ä¸å—å‡å€¼ç½‘ç»œæ›´æ–°çš„å¹²æ‰°ï¼Œæ¢¯åº¦æ–¹å‘æ›´ç¨³å®šï¼š</p>
<p>$$
\nabla_\phi \mathcal{L}_{\text{stage2}} = \mathbb{E}\left[2\left(\boldsymbol{v}_\phi - (\boldsymbol{\epsilon} - \boldsymbol{\epsilon}_\theta^*)^2\right)\nabla_\phi \boldsymbol{v}_\phi\right] \tag{40}
$$</p>
<p>è€Œè”åˆè®­ç»ƒæ—¶ï¼š</p>
<p>$$
\nabla_\phi \mathcal{L}_{\text{joint}} = \mathbb{E}\left[2\left(\boldsymbol{v}_\phi - (\boldsymbol{\epsilon} - \boldsymbol{\epsilon}_\theta)^2\right)\nabla_\phi \boldsymbol{v}_\phi\right] + \text{cross-terms} \tag{41}
$$</p>
<p>äº¤å‰é¡¹å¼•å…¥é¢å¤–å™ªå£°å’Œä¸ç¨³å®šæ€§ã€‚â–¡</p>
<p><strong>å®è·µä¼˜åŠ¿</strong>ï¼š
1. <strong>çµæ´»æ€§</strong>ï¼šå¯ä»¥é‡ç”¨å·²è®­ç»ƒçš„DDPMæ¨¡å‹ï¼Œæ— éœ€ä»å¤´è®­ç»ƒ
2. <strong>æ•ˆç‡</strong>ï¼šé˜¶æ®µ2è®­ç»ƒé€šå¸¸åªéœ€é˜¶æ®µ1çš„10-20%çš„è¿­ä»£æ¬¡æ•°
3. <strong>ç¨³å®šæ€§</strong>ï¼šé¿å…äº†è”åˆä¼˜åŒ–çš„éœ‡è¡é—®é¢˜</p>
<h3 id="6-vs">6. æœ‰åvsæ— åä¼°è®¡çš„æ·±å…¥åˆ†æ</h3>
<h4 id="61">6.1 æ–¹å·®ä¼°è®¡çš„åå·®æ¥æº</h4>
<p>è®¾çœŸå®æ–¹å·®ä¸º$\sigma^2 = \text{Var}[Z]$ï¼Œæ ·æœ¬ä¸º$Z_1, \ldots, Z_n$ã€‚</p>
<p><strong>æ ·æœ¬æ–¹å·®</strong>ï¼ˆæœ‰åï¼‰ï¼š</p>
<p>$$
\hat{\sigma}_{\text{biased}}^2 = \frac{1}{n}\sum_{i=1}^n (Z_i - \bar{Z})^2 \tag{42}
$$</p>
<p><strong>æœŸæœ›</strong>ï¼š</p>
<p>$$
\mathbb{E}[\hat{\sigma}_{\text{biased}}^2] = \frac{n-1}{n}\sigma^2 \neq \sigma^2 \tag{43}
$$</p>
<p><strong>äºŒé˜¶çŸ©ä¼°è®¡</strong>ï¼ˆæ— åï¼‰ï¼š</p>
<p>$$
\hat{m}_2 = \frac{1}{n}\sum_{i=1}^n Z_i^2 \tag{44}
$$</p>
<p><strong>æœŸæœ›</strong>ï¼š</p>
<p>$$
\mathbb{E}[\hat{m}_2] = \mathbb{E}[Z^2] = \sigma^2 + \mu^2 \tag{45}
$$</p>
<h4 id="62-npr-dpm">6.2 NPR-DPMçš„åå·®åˆ†æ</h4>
<p>NPR-DPMä¼°è®¡$\bar{\boldsymbol{\sigma}}<em>t^2 = \mathbb{E}[(\boldsymbol{\epsilon} - \boldsymbol{\epsilon}</em>\theta)^2 | \boldsymbol{x}_t]$ï¼Œå®é™…è®¡ç®—ï¼š</p>
<p>$$
\hat{\bar{\boldsymbol{\sigma}}}_t^2 = \frac{1}{K}\sum_{k=1}^K (\boldsymbol{\epsilon}_k - \boldsymbol{\epsilon}_\theta)^2 - \left(\frac{1}{K}\sum_{k=1}^K (\boldsymbol{\epsilon}_k - \boldsymbol{\epsilon}_\theta)\right)^2 \tag{46}
$$</p>
<p>ç¬¬äºŒé¡¹ï¼ˆå‡å€¼çš„å¹³æ–¹ï¼‰å¼•å…¥è´Ÿåå·®ï¼Œç‰¹åˆ«æ˜¯å½“$K$å°æ—¶ã€‚</p>
<h4 id="63-sn-dpm">6.3 SN-DPMçš„æ— åæ€§</h4>
<p>SN-DPMç›´æ¥ä¼°è®¡äºŒé˜¶çŸ©ï¼š</p>
<p>$$
\hat{m}_2 = \frac{1}{K}\sum_{k=1}^K (\boldsymbol{\epsilon}_k - \boldsymbol{\epsilon}_\theta)^2 \tag{47}
$$</p>
<p>è¿™æ˜¯$\mathbb{E}[(\boldsymbol{\epsilon} - \boldsymbol{\epsilon}_\theta)^2 | \boldsymbol{x}_t]$çš„æ— åä¼°è®¡ã€‚</p>
<p><strong>åœ¨å®Œç¾å‡å€¼å‡è®¾ä¸‹</strong>ï¼š</p>
<p>$$
\mathbb{E}[\boldsymbol{\epsilon} - \boldsymbol{\epsilon}_\theta | \boldsymbol{x}_t] = \mathbf{0} \Rightarrow \text{Var}[\boldsymbol{\epsilon} - \boldsymbol{\epsilon}_\theta] = \mathbb{E}[(\boldsymbol{\epsilon} - \boldsymbol{\epsilon}_\theta)^2] \tag{48}
$$</p>
<p>å› æ­¤SN-DPMåœ¨å®Œç¾å‡å€¼ä¸‹æ­£ç¡®ä¼°è®¡æ–¹å·®ã€‚</p>
<p><strong>å®šç†6.1</strong>ï¼ˆSNä¼˜äºNPRçš„æ¡ä»¶ï¼‰ï¼šå½“æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ï¼ŒSN-DPMä¼˜äºNPR-DPMï¼š</p>
<ol>
<li>å®Œç¾å‡å€¼å‡è®¾è¿‘ä¼¼æˆç«‹ï¼š$|\mathbb{E}[\boldsymbol{\epsilon} - \boldsymbol{\epsilon}<em>\theta | \boldsymbol{x}_t]| \ll \text{std}[\boldsymbol{\epsilon} - \boldsymbol{\epsilon}</em>\theta | \boldsymbol{x}_t]$</li>
<li>æ ·æœ¬é‡æœ‰é™ï¼š$K &lt; \infty$ï¼ˆå®é™…è®­ç»ƒä¸­æ€»æ˜¯æˆç«‹ï¼‰</li>
<li>ä¼˜åŒ–ç¨³å®šæ€§ä¼˜å…ˆï¼šæ— åä¼°è®¡æä¾›æ›´ç¨³å®šçš„æ¢¯åº¦ä¿¡å·</li>
</ol>
<h3 id="7">7. æ€»ç»“ä¸æ´å¯Ÿ</h3>
<h4 id="71">7.1 æ ¸å¿ƒè´¡çŒ®æ€»ç»“</h4>
<ol>
<li>
<p><strong>ä¸å®Œç¾å‡å€¼æ¡†æ¶</strong>ï¼š
   $$
   \mathbb{E}[\|\boldsymbol{x}_0 - \bar{\boldsymbol{\mu}}\|^2] = \text{Var}[\boldsymbol{x}_0|\boldsymbol{x}_t] + \|\text{bias}\|^2
   $$</p>
</li>
<li>
<p><strong>æœ€å¤§ä¼¼ç„¶æ–¹å·®ä¼°è®¡</strong>ï¼š
   $$
   \bar{\sigma}_t^2 = \frac{\bar{\beta}_t^2}{\bar{\alpha}_t^2 d}\mathbb{E}\left[\|\boldsymbol{\epsilon} - \boldsymbol{\epsilon}_\theta\|^2\right]
   $$</p>
</li>
<li>
<p><strong>æ¡ä»¶æ–¹å·®å­¦ä¹ </strong>ï¼šNPR-DPMï¼ˆæœ‰åï¼‰vs SN-DPMï¼ˆæ— åï¼‰</p>
</li>
<li>
<p><strong>ä¸¤é˜¶æ®µè®­ç»ƒ</strong>ï¼šåˆ†ç¦»å‡å€¼å’Œæ–¹å·®çš„å­¦ä¹ è¿‡ç¨‹</p>
</li>
</ol>
<h4 id="72">7.2 ç†è®ºä¸å®è·µçš„çŸ›ç›¾</h4>
<p><strong>çŸ›ç›¾</strong>ï¼šè®ºæ–‡æ ‡é¢˜å¼ºè°ƒ"Imperfect Mean"ï¼Œä½†å®éªŒæ˜¾ç¤º"Perfect Mean"å‡è®¾çš„SN-DPMæ›´ä¼˜ã€‚</p>
<p><strong>å¯èƒ½è§£é‡Š</strong>ï¼š</p>
<ol>
<li><strong>æ¨¡å‹å……åˆ†è®­ç»ƒ</strong>ï¼šç°ä»£æ‰©æ•£æ¨¡å‹è®­ç»ƒå……åˆ†ï¼Œ$\bar{\boldsymbol{\mu}}$å·²ç»å¾ˆå‡†ç¡®</li>
<li><strong>ç»Ÿè®¡ä¼°è®¡ç†è®º</strong>ï¼šæ— åä¼°è®¡çš„ä¼˜åŠ¿åœ¨æœ‰é™æ ·æœ¬ä¸‹æ˜¾è‘—</li>
<li><strong>ä¼˜åŒ–æ™¯è§‚</strong>ï¼šSN-DPMçš„æŸå¤±å‡½æ•°æ›´å¹³æ»‘ï¼Œæ›´æ˜“ä¼˜åŒ–</li>
</ol>
<h4 id="73">7.3 å¼€æ”¾é—®é¢˜</h4>
<ol>
<li>
<p><strong>ç†è®ºå·®è·</strong>ï¼šä¸ºä½•å®Œç¾å‡å€¼å‡è®¾åœ¨å®è·µä¸­å¦‚æ­¤æœ‰æ•ˆï¼Ÿæ˜¯å¦å­˜åœ¨æŸç§éšå¼æ­£åˆ™åŒ–ï¼Ÿ</p>
</li>
<li>
<p><strong>è´Ÿå¯¹æ•°ä¼¼ç„¶vs MSE</strong>ï¼šä¸ºä½•ä¸ç›´æ¥ç”¨NLLè®­ç»ƒæ–¹å·®ï¼ŸMSEæ˜¯å¦æœ‰ç‰¹æ®Šçš„å‡ ä½•æ„ä¹‰ï¼Ÿ</p>
</li>
<li>
<p><strong>ä½ç§©åæ–¹å·®</strong>ï¼šæ˜¯å¦å­˜åœ¨æœ‰æ•ˆçš„ä½ç§©åˆ†è§£æ–¹æ³•ï¼Œå¹³è¡¡è¡¨è¾¾èƒ½åŠ›å’Œè®¡ç®—æˆæœ¬ï¼Ÿ</p>
</li>
<li>
<p><strong>è‡ªé€‚åº”æ–¹å·®</strong>ï¼šèƒ½å¦è®¾è®¡æ•°æ®é©±åŠ¨çš„æ–¹æ³•ï¼Œè‡ªåŠ¨å†³å®šä½¿ç”¨æ ‡é‡ã€å¯¹è§’è¿˜æ˜¯ä½ç§©æ–¹å·®ï¼Ÿ</p>
</li>
</ol>
<h4 id="74">7.4 å®è·µå»ºè®®</h4>
<p><strong>æ¨èæ–¹æ¡ˆ</strong>ï¼š</p>
<ol>
<li><strong>æ ‡å‡†åº”ç”¨</strong>ï¼šä½¿ç”¨ä¸¤é˜¶æ®µè®­ç»ƒçš„SN-DPMï¼Œå¯¹è§’æ–¹å·®</li>
<li><strong>å¿«é€ŸåŸå‹</strong>ï¼šä½¿ç”¨Analytic-DPMçš„è§£æä¼°è®¡ï¼ˆæ— éœ€é¢å¤–è®­ç»ƒï¼‰</li>
<li><strong>é«˜è´¨é‡ç”Ÿæˆ</strong>ï¼šæ¡ä»¶æ–¹å·®$\bar{\boldsymbol{\sigma}}_t^2(\boldsymbol{x}_t)$ï¼Œä½†éœ€è¦æ›´å¤šè®¡ç®—èµ„æº</li>
</ol>
<p><strong>ä»£ç æ¡†æ¶</strong>ï¼ˆPyTorchä¼ªä»£ç ï¼‰ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># é˜¶æ®µ1ï¼šè®­ç»ƒå‡å€¼ç½‘ç»œ</span>
<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_epochs_stage1</span><span class="p">):</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="n">sample_data</span><span class="p">()</span>
    <span class="n">eps</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn_like</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
    <span class="n">xt</span> <span class="o">=</span> <span class="n">alpha_bar_t</span> <span class="o">*</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">beta_bar_t</span> <span class="o">*</span> <span class="n">eps</span>
    <span class="n">eps_pred</span> <span class="o">=</span> <span class="n">epsilon_theta</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">(</span><span class="n">eps_pred</span><span class="p">,</span> <span class="n">eps</span><span class="p">)</span>
    <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
    <span class="n">optimizer_stage1</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

<span class="c1"># é˜¶æ®µ2ï¼šè®­ç»ƒæ–¹å·®ç½‘ç»œï¼ˆSN-DPMï¼‰</span>
<span class="n">epsilon_theta</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>  <span class="c1"># å›ºå®šå‡å€¼ç½‘ç»œ</span>
<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_epochs_stage2</span><span class="p">):</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="n">sample_data</span><span class="p">()</span>
    <span class="n">eps</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn_like</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
    <span class="n">xt</span> <span class="o">=</span> <span class="n">alpha_bar_t</span> <span class="o">*</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">beta_bar_t</span> <span class="o">*</span> <span class="n">eps</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="n">eps_pred</span> <span class="o">=</span> <span class="n">epsilon_theta</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">target</span> <span class="o">=</span> <span class="p">(</span><span class="n">eps</span> <span class="o">-</span> <span class="n">eps_pred</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>  <span class="c1"># äºŒé˜¶çŸ©</span>
    <span class="n">var_pred</span> <span class="o">=</span> <span class="n">variance_network</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">(</span><span class="n">var_pred</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
    <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
    <span class="n">optimizer_stage2</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</code></pre></div>

<hr />
<p><strong>æœ€ç»ˆæ€è€ƒ</strong>ï¼šExtended-Analytic-DPMæ˜¯æ‰©æ•£æ¨¡å‹æ–¹å·®ä¼°è®¡çš„é‡è¦è¿›å±•ï¼Œå°½ç®¡æ ‡é¢˜ä¸å®éªŒç»“æœå­˜åœ¨å¾®å¦™çš„ä¸ä¸€è‡´ï¼Œä½†å…¶ä¸¤é˜¶æ®µè®­ç»ƒæ¡†æ¶å’Œæ¡ä»¶æ–¹å·®å»ºæ¨¡ä¸ºåç»­å·¥ä½œå¥ å®šäº†åŸºç¡€ã€‚å®è·µä¸­ï¼Œæ— åçš„SN-DPMä¸ä¸¤é˜¶æ®µè®­ç»ƒçš„ç»“åˆï¼Œæä¾›äº†ä¸€ä¸ªç¨³å®šä¸”æœ‰æ•ˆçš„æ–¹å·®å­¦ä¹ æ–¹æ¡ˆã€‚</p>
        </div>
    </div>
</body>
</html>