<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆå››ï¼‰ï¼šDDIM = é«˜è§‚ç‚¹DDPM</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆå››ï¼‰ï¼šDDIM = é«˜è§‚ç‚¹DDPM</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-26 | ğŸ“„ å¤§å°: 55.1 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/9181">https://spaces.ac.cn/archives/9181</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>ç›¸ä¿¡å¾ˆå¤šè¯»è€…éƒ½å¬è¯´è¿‡ç”šè‡³è¯»è¿‡å…‹è±å› çš„<a href="https://book.douban.com/subject/3249247/">ã€Šé«˜è§‚ç‚¹ä¸‹çš„åˆç­‰æ•°å­¦ã€‹</a>è¿™å¥—ä¹¦ï¼Œé¡¾åæ€ä¹‰ï¼Œè¿™æ˜¯åœ¨å­¦åˆ°äº†æ›´æ·±å…¥ã€æ›´å®Œå¤‡çš„æ•°å­¦çŸ¥è¯†åï¼Œä»æ›´é«˜çš„è§†è§’é‡æ–°å®¡è§†è¿‡å¾€å­¦è¿‡çš„åˆç­‰æ•°å­¦ï¼Œä»¥å¾—åˆ°æ›´å…¨é¢çš„è®¤çŸ¥ï¼Œç”šè‡³è¾¾åˆ°æ¸©æ•…è€ŒçŸ¥æ–°çš„æ•ˆæœã€‚ç±»ä¼¼çš„ä¹¦ç±è¿˜æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚<a href="https://book.douban.com/subject/1239791/">ã€Šé‡æ¸©å¾®ç§¯åˆ†ã€‹</a>ã€<a href="https://book.douban.com/subject/3788399/">ã€Šå¤åˆ†æï¼šå¯è§†åŒ–æ–¹æ³•ã€‹</a>ç­‰ã€‚</p>
<p>å›åˆ°æ‰©æ•£æ¨¡å‹ï¼Œç›®å‰æˆ‘ä»¬å·²ç»é€šè¿‡ä¸‰ç¯‡æ–‡ç« ä»ä¸åŒè§†è§’å»è§£è¯»äº†DDPMï¼Œé‚£ä¹ˆå®ƒæ˜¯å¦ä¹Ÿå­˜åœ¨ä¸€ä¸ªæ›´é«˜çš„ç†è§£è§†è§’ï¼Œè®©æˆ‘ä»¬èƒ½ä»ä¸­å¾—åˆ°æ–°çš„æ”¶è·å‘¢ï¼Ÿå½“ç„¶æœ‰ï¼Œ<a href="https://papers.cool/arxiv/2010.02502">ã€ŠDenoising Diffusion Implicit Modelsã€‹</a>ä»‹ç»çš„DDIMæ¨¡å‹å°±æ˜¯ç»å…¸çš„æ¡ˆä¾‹ï¼Œæœ¬æ–‡ä¸€èµ·æ¥æ¬£èµå®ƒã€‚</p>
<h2 id="_1">æ€è·¯åˆ†æ</h2>
<p>åœ¨<a href="/archives/9164">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆä¸‰ï¼‰ï¼šDDPM = è´å¶æ–¯ + å»å™ªã€‹</a>ä¸­ï¼Œæˆ‘ä»¬æåˆ°è¿‡è¯¥æ–‡ç« æ‰€ä»‹ç»çš„æ¨å¯¼è·ŸDDIMç´§å¯†ç›¸å…³ã€‚å…·ä½“æ¥è¯´ï¼Œæ–‡ç« çš„æ¨å¯¼è·¯çº¿å¯ä»¥ç®€å•å½’çº³å¦‚ä¸‹ï¼š<br />
\begin{equation}p(\boldsymbol{x}<em t-1="t-1">t|\boldsymbol{x}</em>})\xrightarrow{\text{æ¨å¯¼}}p(\boldsymbol{x<em t-1="t-1">t|\boldsymbol{x}_0)\xrightarrow{\text{æ¨å¯¼}}p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t, \boldsymbol{x}_0)\xrightarrow{\text{è¿‘ä¼¼}}p(\boldsymbol{x}</em>}|\boldsymbol{x}_t)\end{equation<br />
è¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸€æ­¥æ­¥é€’è¿›çš„ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å‘ç°æœ€ç»ˆç»“æœæœ‰ç€ä¸¤ä¸ªç‰¹ç‚¹ï¼š</p>
<blockquote>
<p>1ã€æŸå¤±å‡½æ•°åªä¾èµ–äº$p(\boldsymbol{x}_t|\boldsymbol{x}_0)$ï¼›</p>
<p>2ã€é‡‡æ ·è¿‡ç¨‹åªä¾èµ–äº$p(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t)$ã€‚</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå°½ç®¡æ•´ä¸ªè¿‡ç¨‹æ˜¯ä»¥$p(\boldsymbol{x}<em t-1="t-1">t|\boldsymbol{x}</em>})$ä¸ºå‡ºå‘ç‚¹ä¸€æ­¥æ­¥å¾€å‰æ¨çš„ï¼Œä½†æ˜¯ä»ç»“æœä¸Šæ¥çœ‹ï¼Œå‹æ ¹å„¿å°±æ²¡$p(\boldsymbol{x<em t-1="t-1">t|\boldsymbol{x}</em>)$çš„äº‹ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¤§èƒ†åœ°â€œå¼‚æƒ³å¤©å¼€â€ä¸€ä¸‹ï¼š</p>
<blockquote>
<p><strong>é«˜è§‚ç‚¹1ï¼š</strong> æ—¢ç„¶ç»“æœè·Ÿ$p(\boldsymbol{x}<em t-1="t-1">t|\boldsymbol{x}</em>})$æ— å…³ï¼Œå¯ä¸å¯ä»¥å¹²è„†â€œè¿‡æ²³æ‹†æ¡¥â€ï¼Œå°†$p(\boldsymbol{x<em t-1="t-1">t|\boldsymbol{x}</em>)$ä»æ•´ä¸ªæ¨å¯¼è¿‡ç¨‹ä¸­å»æ‰ï¼Ÿ</p>
</blockquote>
<p>DDIMæ­£æ˜¯è¿™ä¸ªâ€œå¼‚æƒ³å¤©å¼€â€çš„äº§ç‰©ï¼</p>
<h2 id="_2">å¾…å®šç³»æ•°</h2>
<p>å¯èƒ½æœ‰è¯»è€…ä¼šæƒ³ï¼Œæ ¹æ®ä¸Šä¸€ç¯‡æ–‡ç« æ‰€ç”¨çš„è´å¶æ–¯å®šç†<br />
\begin{equation}p(\boldsymbol{x}<em t-1="t-1">{t-1}|\boldsymbol{x}_t, \boldsymbol{x}_0) = \frac{p(\boldsymbol{x}_t|\boldsymbol{x}</em>})p(\boldsymbol{x<em t-1="t-1">{t-1}|\boldsymbol{x}_0)}{p(\boldsymbol{x}_t|\boldsymbol{x}_0)}\end{equation}<br />
æ²¡æœ‰ç»™å®š$p(\boldsymbol{x}_t|\boldsymbol{x}</em>})$æ€ä¹ˆèƒ½å¾—åˆ°$p(\boldsymbol{x<em t-1="t-1">{t-1}|\boldsymbol{x}_t, \boldsymbol{x}_0)$ï¼Ÿè¿™å…¶å®æ˜¯æ€ç»´è¿‡äºå®šå¼äº†ï¼Œç†è®ºä¸Šåœ¨æ²¡æœ‰ç»™å®š$p(\boldsymbol{x}_t|\boldsymbol{x}</em>})$çš„æƒ…å†µä¸‹ï¼Œ$p(\boldsymbol{x<em t-1="t-1">{t-1}|\boldsymbol{x}_t, \boldsymbol{x}_0)$çš„è§£ç©ºé—´æ›´å¤§ï¼ŒæŸç§æ„ä¹‰ä¸Šæ¥è¯´æ˜¯æ›´åŠ å®¹æ˜“æ¨å¯¼ï¼Œæ­¤æ—¶å®ƒåªéœ€è¦æ»¡è¶³è¾¹é™…åˆ†å¸ƒæ¡ä»¶ï¼š<br />
\begin{equation}\int p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t, \boldsymbol{x}_0) p(\boldsymbol{x}_t|\boldsymbol{x}_0) d\boldsymbol{x}_t = p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">0)\label{eq:margin}\end{equation}<br />
æˆ‘ä»¬ç”¨å¾…å®šç³»æ•°æ³•æ¥æ±‚è§£è¿™ä¸ªæ–¹ç¨‹ã€‚åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæ‰€è§£å‡ºçš„$p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t, \boldsymbol{x}_0)$æ˜¯ä¸€ä¸ªæ­£æ€åˆ†å¸ƒï¼Œæ‰€ä»¥è¿™ä¸€æ¬¡æˆ‘ä»¬å¯ä»¥æ›´ä¸€èˆ¬åœ°è®¾<br />
\begin{equation}p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t, \boldsymbol{x}_0) = \mathcal{N}(\boldsymbol{x}</em>}; \kappa_t \boldsymbol{x<em t-1="t-1">t + \lambda_t \boldsymbol{x}_0, \sigma_t^2 \boldsymbol{I})\end{equation}<br />
å…¶ä¸­$\kappa_t,\lambda_t,\sigma_t$éƒ½æ˜¯å¾…å®šç³»æ•°ï¼Œè€Œä¸ºäº†ä¸é‡æ–°è®­ç»ƒæ¨¡å‹ï¼Œæˆ‘ä»¬ä¸æ”¹å˜$p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">0)$å’Œ$p(\boldsymbol{x}_t|\boldsymbol{x}_0)$ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥åˆ—å‡º<br />
\begin{array}{c|c|c}<br />
\hline<br />
\text{è®°å·} &amp; \text{å«ä¹‰} &amp; \text{é‡‡æ ·}\\\<br />
\hline<br />
p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">0) &amp; \mathcal{N}(\boldsymbol{x}</em>};\bar{\alpha<em t-1="t-1">{t-1} \boldsymbol{x}_0,\bar{\beta}</em>}^2 \boldsymbol{I}) &amp; \boldsymbol{x<em t-1="t-1">{t-1} = \bar{\alpha}</em>} \boldsymbol{x<em t-1="t-1">0 + \bar{\beta}</em> \\\} \boldsymbol{\varepsilon<br />
\hline<br />
p(\boldsymbol{x}<em t-1="t-1">t|\boldsymbol{x}_0) &amp; \mathcal{N}(\boldsymbol{x}_t;\bar{\alpha}_t \boldsymbol{x}_0,\bar{\beta}_t^2 \boldsymbol{I}) &amp; \boldsymbol{x}_t = \bar{\alpha}_t \boldsymbol{x}_0 + \bar{\beta}_t \boldsymbol{\varepsilon}_1 \\\<br />
\hline<br />
p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t, \boldsymbol{x}_0) &amp; \mathcal{N}(\boldsymbol{x}</em>}; \kappa_t \boldsymbol{x<em t-1="t-1">t + \lambda_t \boldsymbol{x}_0, \sigma_t^2 \boldsymbol{I}) &amp; \boldsymbol{x}</em>} = \kappa_t \boldsymbol{x<em t-1="t-1">t + \lambda_t \boldsymbol{x}_0 + \sigma_t \boldsymbol{\varepsilon}_2 \\\<br />
\hline<br />
{\begin{array}{c}\int p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t, \boldsymbol{x}_0) \\\<br />
p(\boldsymbol{x}_t|\boldsymbol{x}_0) d\boldsymbol{x}_t\end{array}} &amp; &amp; {\begin{aligned}\boldsymbol{x}</em>} =&amp;\, \kappa_t \boldsymbol{x<em t-1="t-1">t + \lambda_t \boldsymbol{x}_0 + \sigma_t \boldsymbol{\varepsilon}_2 \\\<br />
=&amp;\, \kappa_t (\bar{\alpha}_t \boldsymbol{x}_0 + \bar{\beta}_t \boldsymbol{\varepsilon}_1) + \lambda_t \boldsymbol{x}_0 + \sigma_t \boldsymbol{\varepsilon}_2 \\\<br />
=&amp;\, (\kappa_t \bar{\alpha}_t + \lambda_t) \boldsymbol{x}_0 + (\kappa_t\bar{\beta}_t \boldsymbol{\varepsilon}_1 + \sigma_t \boldsymbol{\varepsilon}_2) \\\<br />
\end{aligned}} \\\<br />
\hline<br />
\end{array}<br />
å…¶ä¸­$\boldsymbol{\varepsilon},\boldsymbol{\varepsilon}_1,\boldsymbol{\varepsilon}_2\sim \mathcal{N}(\boldsymbol{0},\boldsymbol{I})$ï¼Œå¹¶ä¸”ç”±æ­£æ€åˆ†å¸ƒçš„å åŠ æ€§æˆ‘ä»¬çŸ¥é“$\kappa_t\bar{\beta}_t \boldsymbol{\varepsilon}_1 + \sigma_t \boldsymbol{\varepsilon}_2\sim \sqrt{\kappa_t^2\bar{\beta}_t^2 + \sigma_t^2} \boldsymbol{\varepsilon}$ã€‚å¯¹æ¯”$\boldsymbol{x}</em>$æˆç«‹ï¼Œåªéœ€è¦æ»¡è¶³ä¸¤ä¸ªæ–¹ç¨‹}$çš„ä¸¤ä¸ªé‡‡æ ·å½¢å¼ï¼Œæˆ‘ä»¬å‘ç°è¦æƒ³$\eqref{eq:margin<br />
\begin{equation}\bar{\alpha}<em t-1="t-1">{t-1} = \kappa_t \bar{\alpha}_t + \lambda_t, \qquad\bar{\beta}</em>} = \sqrt{\kappa_t^2\bar{\beta<em t-1="t-1">t^2 + \sigma_t^2}\end{equation}<br />
å¯ä»¥çœ‹åˆ°æœ‰ä¸‰ä¸ªæœªçŸ¥æ•°ï¼Œä½†åªæœ‰ä¸¤ä¸ªæ–¹ç¨‹ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¯´æ²¡æœ‰ç»™å®š$p(\boldsymbol{x}_t|\boldsymbol{x}</em>)$æ—¶è§£ç©ºé—´åè€Œæ›´å¤§äº†ã€‚å°†$\sigma_t$è§†ä¸ºå¯å˜å‚æ•°ï¼Œå¯ä»¥è§£å‡º<br />
\begin{equation}\kappa_t = \frac{\sqrt{\bar{\beta}<em t-1="t-1">{t-1}^2 - \sigma_t^2}}{\bar{\beta}_t},\qquad \lambda_t = \bar{\alpha}</em>} - \frac{\bar{\alpha<em t-1="t-1">t\sqrt{\bar{\beta}</em>}^2 - \sigma_t^2}}{\bar{\beta<em t-1="t-1">t}\end{equation}<br />
æˆ–è€…å†™æˆ<br />
\begin{equation}p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t, \boldsymbol{x}_0) = \mathcal{N}\left(\boldsymbol{x}</em>}; \frac{\sqrt{\bar{\beta<em t-1="t-1">{t-1}^2 - \sigma_t^2}}{\bar{\beta}_t} \boldsymbol{x}_t + \left(\bar{\alpha}</em>} - \frac{\bar{\alpha<em t-1="t-1">t\sqrt{\bar{\beta}</em>}^2 - \sigma_t^2}}{\bar{\beta}_t}\right) \boldsymbol{x}_0, \sigma_t^2 \boldsymbol{I}\right)\label{eq:p-xt-x0}\end{equation<br />
æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬çº¦å®š$\bar{\alpha}_0=1, \bar{\beta}_0=0$ã€‚ç‰¹åˆ«åœ°ï¼Œè¿™ä¸ªç»“æœå¹¶ä¸éœ€è¦é™å®š$\bar{\alpha}_t^2 + \bar{\beta}_t^2 = 1$ï¼Œä¸è¿‡ä¸ºäº†ç®€åŒ–å‚æ•°è®¾ç½®ï¼ŒåŒæ—¶ä¹Ÿä¸ºäº†è·Ÿä»¥å¾€çš„ç»“æœå¯¹é½ï¼Œè¿™é‡Œè¿˜æ˜¯çº¦å®š$\bar{\alpha}_t^2 + \bar{\beta}_t^2 = 1$ã€‚</p>
<h2 id="_3">ä¸€å¦‚æ—¢å¾€</h2>
<p>ç°åœ¨æˆ‘ä»¬åœ¨åªç»™å®š$p(\boldsymbol{x}<em t-1="t-1">t|\boldsymbol{x}_0)$ã€$p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">0)$çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡å¾…å®šç³»æ•°æ³•æ±‚è§£äº†$p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t, \boldsymbol{x}_0)$çš„ä¸€ç°‡è§£ï¼Œå®ƒå¸¦æœ‰ä¸€ä¸ªè‡ªç”±å‚æ•°$\sigma_t$ã€‚ç”¨<a href="/archives/9119">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆä¸€ï¼‰ï¼šDDPM = æ‹†æ¥¼ + å»ºæ¥¼ã€‹</a>ä¸­çš„â€œæ‹†æ¥¼-å»ºæ¥¼â€ç±»æ¯”æ¥è¯´ï¼Œå°±æ˜¯æˆ‘ä»¬çŸ¥é“æ¥¼ä¼šè¢«æ‹†æˆä»€ä¹ˆæ ·ã€$p(\boldsymbol{x}_t|\boldsymbol{x}_0)$ã€$p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">0)$ã€‘ï¼Œä½†æ˜¯ä¸çŸ¥é“æ¯ä¸€æ­¥æ€ä¹ˆæ‹†ã€$p(\boldsymbol{x}_t|\boldsymbol{x}</em>})$ã€‘ï¼Œç„¶åå¸Œæœ›èƒ½å¤Ÿä»ä¸­å­¦ä¼šæ¯ä¸€æ­¥æ€ä¹ˆå»ºã€$p(\boldsymbol{x<em t-1="t-1">{t-1}|\boldsymbol{x}_t)$ã€‘ã€‚å½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬æƒ³çœ‹çœ‹æ¯ä¸€æ­¥æ€ä¹ˆæ‹†çš„è¯ï¼Œä¹Ÿå¯ä»¥åè¿‡æ¥ç”¨è´å¶æ–¯å…¬å¼<br />
\begin{equation} p(\boldsymbol{x}_t|\boldsymbol{x}</em>}, \boldsymbol{x<em t-1="t-1">0) = \frac{p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t, \boldsymbol{x}_0) p(\boldsymbol{x}_t|\boldsymbol{x}_0)}{p(\boldsymbol{x}</em>}|\boldsymbol{x}_0)}\end{equation</p>
<p>æ¥ä¸‹æ¥çš„äº‹æƒ…ï¼Œå°±è·Ÿä¸Šä¸€ç¯‡æ–‡ç« ä¸€æ¨¡ä¸€æ ·äº†ï¼šæˆ‘ä»¬æœ€ç»ˆæƒ³è¦$p(\boldsymbol{x}<em t-1="t-1">{t-1}|\boldsymbol{x}_t)$è€Œä¸æ˜¯$p(\boldsymbol{x}</em>}|\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, \boldsymbol{x}_0)$ï¼Œæ‰€ä»¥æˆ‘ä»¬å¸Œæœ›ç”¨<br />
\begin{equation}\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t) = \frac{1}{\bar{\alpha}_t}\left(\boldsymbol{x}_t - \bar{\beta}_t \boldsymbol{\epsilon}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, t)\right)\end{equation}<br />
æ¥ä¼°è®¡$\boldsymbol{x}_0$ï¼Œç”±äºæ²¡æœ‰æ”¹åŠ¨$p(\boldsymbol{x}_t|\boldsymbol{x}_0)$ï¼Œæ‰€ä»¥è®­ç»ƒæ‰€ç”¨çš„ç›®æ ‡å‡½æ•°ä¾ç„¶æ˜¯$\left\Vert\boldsymbol{\varepsilon} - \boldsymbol{\epsilon}</em>}}(\bar{\alpha<em t-1="t-1">t \boldsymbol{x}_0 + \bar{\beta}_t \boldsymbol{\varepsilon}, t)\right\Vert^2$ï¼ˆé™¤å»æƒé‡ç³»æ•°ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´è®­ç»ƒè¿‡ç¨‹æ²¡æœ‰æ”¹å˜ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å›DDPMè®­ç»ƒå¥½çš„æ¨¡å‹ã€‚è€Œç”¨$\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)$æ›¿æ¢æ‰å¼$\eqref{eq:p-xt-x0}$ä¸­çš„$\boldsymbol{x}_0$åï¼Œå¾—åˆ°<br />
\begin{equation}\begin{aligned}<br />
p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t) \approx&amp;\, p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t, \boldsymbol{x}_0=\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)) \\\<br />
=&amp;\, \mathcal{N}\left(\boldsymbol{x}</em>}; \frac{1}{\alpha_t}\left(\boldsymbol{x<em t-1="t-1">t - \left(\bar{\beta}_t - \alpha_t\sqrt{\bar{\beta}</em>}^2 - \sigma_t^2}\right) \boldsymbol{\epsilon<em t-1="t-1">{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)\right), \sigma_t^2 \boldsymbol{I}\right)<br />
\end{aligned}\label{eq:p-xt-x0-2}\end{equation}<br />
è¿™å°±æ±‚å‡ºäº†ç”Ÿæˆè¿‡ç¨‹æ‰€éœ€è¦çš„$p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t)$ï¼Œå…¶ä¸­$\alpha_t=\frac{\bar{\alpha}_t}{\bar{\alpha}</em>$ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯è®­ç»ƒè¿‡ç¨‹æ²¡æœ‰å˜åŒ–ï¼ˆä¹Ÿå°±æ˜¯è¯´æœ€ç»ˆä¿å­˜ä¸‹æ¥çš„æ¨¡å‹æ²¡æœ‰å˜åŒ–ï¼‰ï¼Œä½†ç”Ÿæˆè¿‡ç¨‹å´æœ‰ä¸€ä¸ªå¯å˜åŠ¨çš„å‚æ•°$\sigma_t$ï¼Œå°±æ˜¯è¿™ä¸ªå‚æ•°ç»™DDPMå¸¦æ¥äº†æ–°é²œçš„ç»“æœã€‚}</p>
<h2 id="_4">å‡ ä¸ªä¾‹å­</h2>
<p>åŸåˆ™ä¸Šæ¥è¯´ï¼Œæˆ‘ä»¬å¯¹$\sigma_t$æ²¡æœ‰è¿‡å¤šçš„çº¦æŸï¼Œä½†æ˜¯ä¸åŒ$\sigma_t$çš„é‡‡æ ·è¿‡ç¨‹ä¼šå‘ˆç°å‡ºä¸åŒçš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬ä¸¾å‡ ä¸ªä¾‹å­è¿›è¡Œåˆ†æã€‚</p>
<p>ç¬¬ä¸€ä¸ªç®€å•ä¾‹å­å°±æ˜¯å–$\sigma_t = \frac{\bar{\beta}<em t-1="t-1">{t-1}\beta_t}{\bar{\beta}_t}$ï¼Œå…¶ä¸­$\beta_t = \sqrt{1 - \alpha_t^2}$ï¼Œç›¸åº”åœ°æœ‰<br />
\begin{equation}\small{p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t) \approx p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t, \boldsymbol{x}_0=\bar{\boldsymbol{\mu}}(\boldsymbol{x}_t)) = \mathcal{N}\left(\boldsymbol{x}</em>}; \frac{1}{\alpha_t}\left(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t - \frac{\beta_t^2}{\bar{\beta}_t}\boldsymbol{\epsilon}</em>}}(\boldsymbol{x<em t-1="t-1">t, t)\right),\frac{\bar{\beta}</em>}^2\beta_t^2}{\bar{\beta<em t-1="t-1">t^2} \boldsymbol{I}\right)}\label{eq:choice-1}\end{equation}<br />
è¿™å°±æ˜¯ä¸Šä¸€ç¯‡æ–‡ç« æ‰€æ¨å¯¼çš„DDPMã€‚ç‰¹åˆ«æ˜¯ï¼ŒDDIMè®ºæ–‡ä¸­è¿˜å¯¹$\sigma_t = \eta\frac{\bar{\beta}</em>$åšäº†å¯¹æ¯”å®éªŒï¼Œå…¶ä¸­$\eta\in[0, 1]$ã€‚}\beta_t}{\bar{\beta}_t</p>
<p>ç¬¬äºŒä¸ªä¾‹å­å°±æ˜¯å–$\sigma_t = \beta_t$ï¼Œè¿™ä¹Ÿæ˜¯å‰ä¸¤ç¯‡æ–‡ç« æ‰€æŒ‡å‡ºçš„$\sigma_t$çš„ä¸¤ä¸ªé€‰æ‹©ä¹‹ä¸€ï¼Œåœ¨æ­¤é€‰æ‹©ä¸‹å¼$\eqref{eq:p-xt-x0-2}$æœªèƒ½åšè¿›ä¸€æ­¥çš„åŒ–ç®€ï¼Œä½†DDIMçš„å®éªŒç»“æœæ˜¾ç¤ºæ­¤é€‰æ‹©åœ¨DDPMçš„æ ‡å‡†å‚æ•°è®¾ç½®ä¸‹è¡¨ç°è¿˜æ˜¯å¾ˆå¥½çš„ã€‚</p>
<p>æœ€ç‰¹æ®Šçš„ä¸€ä¸ªä¾‹å­æ˜¯å–$\sigma_t = 0$ï¼Œæ­¤æ—¶ä»$\boldsymbol{x}<em t-1="t-1">t$åˆ°$\boldsymbol{x}</em>$æ˜¯ä¸€ä¸ªç¡®å®šæ€§å˜æ¢<br />
\begin{equation}\boldsymbol{x}<em t-1="t-1">{t-1} = \frac{1}{\alpha_t}\left(\boldsymbol{x}_t - \left(\bar{\beta}_t - \alpha_t \bar{\beta}</em>}\right) \boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)\right)\label{eq:sigma=0}\end{equation<br />
è¿™ä¹Ÿæ˜¯DDIMè®ºæ–‡ä¸­ç‰¹åˆ«å…³å¿ƒçš„ä¸€ä¸ªä¾‹å­ï¼Œå‡†ç¡®æ¥è¯´ï¼ŒåŸè®ºæ–‡çš„DDIMå°±æ˜¯ç‰¹æŒ‡$\sigma_t=0$çš„æƒ…å½¢ï¼Œå…¶ä¸­â€œIâ€çš„å«ä¹‰å°±æ˜¯â€œImplicitâ€ï¼Œæ„æ€è¿™æ˜¯ä¸€ä¸ªéšå¼çš„æ¦‚ç‡æ¨¡å‹ï¼Œå› ä¸ºè·Ÿå…¶ä»–é€‰æ‹©æ‰€ä¸åŒçš„æ˜¯ï¼Œæ­¤æ—¶ä»ç»™å®šçš„$\boldsymbol{x}_T = \boldsymbol{z}$å‡ºå‘ï¼Œå¾—åˆ°çš„ç”Ÿæˆç»“æœ$\boldsymbol{x}_0$æ˜¯ä¸å¸¦éšæœºæ€§çš„ã€‚åé¢æˆ‘ä»¬å°†ä¼šçœ‹åˆ°ï¼Œè¿™åœ¨ç†è®ºä¸Šå’Œå®ç”¨ä¸Šéƒ½å¸¦æ¥äº†ä¸€äº›å¥½å¤„ã€‚</p>
<h2 id="_5">åŠ é€Ÿç”Ÿæˆ</h2>
<p>å€¼å¾—æŒ‡å‡ºçš„æ˜¯ï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬æ²¡æœ‰ä»¥$p(\boldsymbol{x}<em t-1="t-1">t|\boldsymbol{x}</em>})$ä¸ºå‡ºå‘ç‚¹ï¼Œæ‰€ä»¥å‰é¢çš„æ‰€æœ‰ç»“æœå®é™…ä¸Šå…¨éƒ½æ˜¯ä»¥$\bar{\alpha<em t-1="t-1">t,\bar{\beta}_t$ç›¸å…³è®°å·ç»™å‡ºçš„ï¼Œè€Œ$\alpha_t,\beta_t$åˆ™æ˜¯é€šè¿‡$\alpha_t=\frac{\bar{\alpha}_t}{\bar{\alpha}</em>_t$ï¼Œè®­ç»ƒè¿‡ç¨‹ä¹Ÿå°±ç¡®å®šäº†ã€‚}}$å’Œ$\beta_t = \sqrt{1 - \alpha_t^2}$æ´¾ç”Ÿå‡ºæ¥çš„è®°å·ã€‚ä»æŸå¤±å‡½æ•°$\left\Vert\boldsymbol{\varepsilon} - \boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\bar{\alpha}_t \boldsymbol{x}_0 + \bar{\beta}_t \boldsymbol{\varepsilon}, t)\right\Vert^2$å¯ä»¥çœ‹å‡ºï¼Œç»™å®šäº†å„ä¸ª$\bar{\alpha</p>
<p>ä»è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒDDIMè¿›ä¸€æ­¥ç•™æ„åˆ°äº†å¦‚ä¸‹äº‹å®ï¼š</p>
<blockquote>
<p><strong>é«˜è§‚ç‚¹2ï¼š</strong> DDPMçš„è®­ç»ƒç»“æœå®è´¨ä¸ŠåŒ…å«äº†å®ƒçš„ä»»æ„å­åºåˆ—å‚æ•°çš„è®­ç»ƒç»“æœã€‚</p>
</blockquote>
<p>å…·ä½“æ¥è¯´ï¼Œè®¾$\boldsymbol{\tau} = [\tau_1,\tau_2,\dots,\tau_{\dim(\boldsymbol{\tau})}]$æ˜¯$[1,2,\cdots,T]$çš„ä»»æ„å­åºåˆ—ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä»¥$\bar{\alpha}<em _tau_2="\tau_2">{\tau_1},\bar{\alpha}</em>_T$çš„$T$æ­¥DDPMçš„ç›®æ ‡å‡½æ•°çš„ä¸€ä¸ªå­é›†ï¼æ‰€ä»¥åœ¨æ¨¡å‹æ‹Ÿåˆèƒ½åŠ›è¶³å¤Ÿå¥½çš„æƒ…å†µä¸‹ï¼Œå®ƒå…¶å®åŒ…å«äº†ä»»æ„å­åºåˆ—å‚æ•°çš„è®­ç»ƒç»“æœã€‚},\cdots,\bar{\alpha}_{\dim(\boldsymbol{\tau})}$ä¸ºå‚æ•°è®­ç»ƒä¸€ä¸ªæ‰©æ•£æ­¥æ•°ä¸º$\dim(\boldsymbol{\tau})$æ­¥çš„DDPMï¼Œå…¶ç›®æ ‡å‡½æ•°å®é™…ä¸Šæ˜¯åŸæ¥ä»¥$\bar{\alpha}_1,\bar{\alpha}_2,\cdots,\bar{\alpha</p>
<p>é‚£ä¹ˆåè¿‡æ¥æƒ³ï¼Œå¦‚æœæœ‰ä¸€ä¸ªè®­ç»ƒå¥½çš„$T$æ­¥DDPMæ¨¡å‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å®ƒå½“æˆæ˜¯ä»¥$\bar{\alpha}<em _tau_2="\tau_2">{\tau_1},\bar{\alpha}</em>},\cdots,\bar{\alpha<em _tau__i-1="\tau_{i-1">{\dim(\boldsymbol{\tau})}$ä¸ºå‚æ•°è®­ç»ƒå‡ºæ¥çš„$\dim(\boldsymbol{\tau})$æ­¥æ¨¡å‹ï¼Œè€Œæ—¢ç„¶æ˜¯$\dim(\boldsymbol{\tau})$æ­¥çš„æ¨¡å‹ï¼Œç”Ÿæˆè¿‡ç¨‹ä¹Ÿå°±åªéœ€è¦$\dim(\boldsymbol{\tau})$æ­¥äº†ï¼Œæ ¹æ®å¼$\eqref{eq:p-xt-x0-2}$æœ‰ï¼š<br />
\begin{equation}p(\boldsymbol{x}</em>}}|\boldsymbol{x<em _tau__i-1="\tau_{i-1">{\tau_i}) \approx \mathcal{N}\left(\boldsymbol{x}</em>}}; \frac{\bar{\alpha<em i-1="i-1">{\tau</em>}}}{\bar{\alpha<em _tau_i="\tau_i">{\tau_i}}\left(\boldsymbol{x}</em>} - \left(\bar{\beta<em _tau_i="\tau_i">{\tau_i} - \frac{\bar{\alpha}</em>}}{\bar{\alpha<em i-1="i-1">{\tau</em>}}}\sqrt{\bar{\beta<em i-1="i-1">{\tau</em>}}^2 - \tilde{\sigma<em _boldsymbol_theta="\boldsymbol{\theta">{\tau_i}^2}\right) \boldsymbol{\epsilon}</em>}}(\boldsymbol{x<em _tau_i="\tau_i">{\tau_i}, \tau_i)\right), \tilde{\sigma}</em>}^2 \boldsymbol{I}\right)\end{equation<br />
è¿™å°±æ˜¯åŠ é€Ÿé‡‡æ ·çš„ç”Ÿæˆè¿‡ç¨‹äº†ï¼Œä»åŸæ¥çš„$T$æ­¥æ‰©æ•£ç”Ÿæˆå˜æˆäº†$\dim(\boldsymbol{\tau})$æ­¥ã€‚è¦æ³¨æ„ä¸èƒ½ç›´æ¥å°†å¼$\eqref{eq:p-xt-x0-2}$çš„$\alpha_t$æ¢æˆ$\alpha_{\tau_i}$ï¼Œå› ä¸ºæˆ‘ä»¬è¯´è¿‡$\alpha_t$æ˜¯æ´¾ç”Ÿè®°å·è€Œå·²ï¼Œå®ƒå®é™…ä¸Šç­‰äº$\frac{\bar{\alpha}<em t-1="t-1">t}{\bar{\alpha}</em>}}$ï¼Œå› æ­¤$\alpha_t$è¦æ¢æˆ$\frac{\bar{\alpha<em _tau__i-1="\tau_{i-1">{\tau_i}}{\bar{\alpha}</em>}}}$æ‰å¯¹ã€‚åŒç†ï¼Œ$\tilde{\sigma<em _tau_i="\tau_i">{\tau_i}$ä¹Ÿä¸æ˜¯ç›´æ¥å–$\sigma</em>}$ï¼Œè€Œæ˜¯åœ¨å°†å…¶å®šä¹‰å…¨éƒ¨è½¬åŒ–ä¸º$\bar{\alpha},\bar{\beta}$ç¬¦å·åï¼Œå°†$t$æ›¿æ¢ä¸º$\tau_i$ã€$t-1$æ›¿æ¢ä¸º$\tau_{i-1}$ï¼Œæ¯”å¦‚å¼$\eqref{eq:choice-1}$å¯¹åº”çš„$\tilde{\sigma<em t-1="t-1">{\tau_i}$ä¸º<br />
\begin{equation}\sigma_t = \frac{\bar{\beta}</em>}\beta_t}{\bar{\beta<em t-1="t-1">t}=\frac{\bar{\beta}</em>}}{\bar{\beta<em t-1="t-1">t}\sqrt{1 - \frac{\bar{\alpha}_t^2}{\bar{\alpha}</em>}^2}}\quad\to\quad\frac{\bar{\beta<em i-1="i-1">{\tau</em>}}}{\bar{\beta<em _tau_i="\tau_i">{\tau_i}}\sqrt{1 - \frac{\bar{\alpha}</em>}^2}{\bar{\alpha<em i-1="i-1">{\tau</em>}}^2}}=\tilde{\sigma}_{\tau_i}\end{equation</p>
<p>å¯èƒ½è¯»è€…åˆæƒ³é—®ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆå¹²è„†ä¸ç›´æ¥è®­ç»ƒä¸€ä¸ª$\dim(\boldsymbol{\tau})$æ­¥çš„æ‰©æ•£æ¨¡å‹ï¼Œè€Œæ˜¯è¦å…ˆè®­ç»ƒ$T &gt; \dim(\boldsymbol{\tau})$æ­¥ç„¶åå»åšå­åºåˆ—é‡‡æ ·ï¼Ÿç¬”è€…è®¤ä¸ºå¯èƒ½æœ‰ä¸¤æ–¹é¢çš„è€ƒè™‘ï¼šä¸€æ–¹é¢ä»$\dim(\boldsymbol{\tau})$æ­¥ç”Ÿæˆæ¥è¯´ï¼Œè®­ç»ƒæ›´å¤šæ­¥æ•°çš„æ¨¡å‹ä¹Ÿè®¸èƒ½å¢å¼ºæ³›åŒ–èƒ½åŠ›ï¼›å¦ä¸€æ–¹é¢ï¼Œé€šè¿‡å­åºåˆ—$\boldsymbol{\tau}$è¿›è¡ŒåŠ é€Ÿåªæ˜¯å…¶ä¸­ä¸€ç§åŠ é€Ÿæ‰‹æ®µï¼Œè®­ç»ƒæ›´å……åˆ†çš„$T$æ­¥å…è®¸æˆ‘ä»¬å°è¯•æ›´å¤šçš„å…¶ä»–åŠ é€Ÿæ‰‹æ®µï¼Œä½†å¹¶ä¸ä¼šæ˜¾è‘—å¢åŠ è®­ç»ƒæˆæœ¬ã€‚</p>
<h2 id="_6">å®éªŒç»“æœ</h2>
<p>åŸè®ºæ–‡å¯¹ä¸åŒçš„å™ªå£°å¼ºåº¦å’Œæ‰©æ•£æ­¥æ•°$\dim(\boldsymbol{\tau})$åšäº†ç»„åˆå¯¹æ¯”ï¼Œå¤§è‡´ä¸Šçš„ç»“æœæ˜¯â€œå™ªå£°è¶Šå°ï¼ŒåŠ é€Ÿåçš„ç”Ÿæˆæ•ˆæœè¶Šå¥½â€ï¼Œå¦‚ä¸‹å›¾  </p>
<p><a href="/usr/uploads/2022/07/724883953.jpg" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="DDIMçš„å®éªŒç»“æœï¼Œæ˜¾ç¤ºå™ªå£°è¶Šå°ï¼ŒåŠ é€Ÿåçš„ç”Ÿæˆæ•ˆæœè¶Šå¥½" src="/usr/uploads/2022/07/724883953.jpg" /></a></p>
<p>DDIMçš„å®éªŒç»“æœï¼Œæ˜¾ç¤ºå™ªå£°è¶Šå°ï¼ŒåŠ é€Ÿåçš„ç”Ÿæˆæ•ˆæœè¶Šå¥½</p>
<p>ç¬”è€…çš„å‚è€ƒå®ç°å¦‚ä¸‹ï¼š</p>
<blockquote>
<p><strong>Githubï¼š<a href="https://github.com/bojone/Keras-DDPM/blob/main/ddim.py">https://github.com/bojone/Keras-DDPM/blob/main/ddim.py</a></strong></p>
</blockquote>
<p>ä¸ªäººçš„å®éªŒç»“è®ºæ˜¯ï¼š</p>
<blockquote>
<p>1ã€å¯èƒ½è·Ÿç›´è§‰ç›¸åï¼Œç”Ÿæˆè¿‡ç¨‹ä¸­çš„$\sigma_t$è¶Šå°ï¼Œæœ€ç»ˆç”Ÿæˆå›¾åƒçš„å™ªå£°å’Œå¤šæ ·æ€§åè€Œç›¸å¯¹æ¥è¯´è¶Šå¤§ï¼›</p>
<p>2ã€æ‰©æ•£æ­¥æ•°$\dim(\boldsymbol{\tau})$è¶Šå°‘ï¼Œç”Ÿæˆçš„å›¾ç‰‡æ›´åŠ å¹³æ»‘ï¼Œå¤šæ ·æ€§ä¹Ÿä¼šæœ‰æ‰€é™ä½ï¼›</p>
<p>3ã€ç»“åˆ1ã€2ä¸¤ç‚¹å¾—çŸ¥ï¼Œåœ¨æ‰©æ•£æ­¥æ•°$\dim(\boldsymbol{\tau})$å‡å°‘æ—¶ï¼Œå¯ä»¥é€‚å½“ç¼©å°$\sigma_t$ï¼Œä»¥ä¿æŒç”Ÿæˆå›¾ç‰‡è´¨é‡å¤§è‡´ä¸å˜ï¼Œè¿™è·ŸDDIMåŸè®ºæ–‡çš„å®éªŒç»“è®ºæ˜¯ä¸€è‡´çš„ï¼›</p>
<p>4ã€åœ¨$\sigma_t$è¾ƒå°æ—¶ï¼Œç›¸æ¯”å¯è®­ç»ƒçš„Embeddingå±‚ï¼Œç”¨å›ºå®šçš„Sinusoidalç¼–ç æ¥è¡¨ç¤º$t$æ‰€ç”Ÿæˆå›¾ç‰‡çš„å™ªå£°è¦æ›´å°ï¼›</p>
<p>5ã€åœ¨$\sigma_t$è¾ƒå°æ—¶ï¼ŒåŸè®ºæ–‡çš„U-Netæ¶æ„ï¼ˆGithubä¸­çš„<a href="https://github.com/bojone/Keras-DDPM/blob/main/ddpm2.py">ddpm2.py</a>ï¼‰è¦æ¯”ç¬”è€…è‡ªè¡Œæ„æ€çš„U-Netæ¶æ„ï¼ˆGithubä¸­çš„<a href="https://github.com/bojone/Keras-DDPM/blob/main/ddpm.py">ddpm.py</a>ï¼‰æ‰€ç”Ÿæˆå›¾ç‰‡çš„å™ªå£°è¦æ›´å°ï¼›</p>
<p>6ã€ä½†ä¸ªäººæ„Ÿè§‰ï¼Œæ€»ä½“æ¥è¯´ä¸å¸¦å™ªå£°çš„ç”Ÿæˆè¿‡ç¨‹çš„ç”Ÿæˆæ•ˆæœä¸å¦‚å¸¦å™ªå£°çš„ç”Ÿæˆè¿‡ç¨‹ï¼Œä¸å¸¦å™ªå£°æ—¶ç”Ÿæˆæ•ˆæœå—æ¨¡å‹æ¶æ„å½±å“è¾ƒå¤§ã€‚</p>
</blockquote>
<p>æ­¤å¤–ï¼Œå¯¹äº$\sigma_t=0$æ—¶çš„DDIMï¼Œå®ƒå°±æ˜¯å°†ä»»æ„æ­£æ€å™ªå£°å‘é‡å˜æ¢ä¸ºå›¾ç‰‡çš„ä¸€ä¸ªç¡®å®šæ€§å˜æ¢ï¼Œè¿™å·²ç»è·ŸGANå‡ ä¹ä¸€è‡´äº†ï¼Œæ‰€ä»¥è·ŸGANç±»ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å™ªå£°å‘é‡è¿›è¡Œæ’å€¼ï¼Œç„¶åè§‚å¯Ÿå¯¹åº”çš„ç”Ÿæˆæ•ˆæœã€‚ä½†è¦æ³¨æ„çš„æ˜¯ï¼ŒDDPMæˆ–DDIMå¯¹å™ªå£°åˆ†å¸ƒéƒ½æ¯”è¾ƒæ•æ„Ÿï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç”¨çº¿æ€§æ’å€¼è€Œè¦ç”¨çƒé¢æ’å€¼ï¼Œå› ä¸ºç”±æ­£æ€åˆ†å¸ƒçš„å åŠ æ€§ï¼Œå¦‚æœ$\boldsymbol{z}_1,\boldsymbol{z}_2\sim\mathcal{N}(\boldsymbol{0}, \boldsymbol{I})$ï¼Œ$\lambda\boldsymbol{z}_1 + (1-\lambda)\boldsymbol{z}_2$ä¸€èˆ¬å°±ä¸æœä»$\mathcal{N}(\boldsymbol{0}, \boldsymbol{I})$ï¼Œè¦æ”¹ä¸º<br />
\begin{equation}\boldsymbol{z} = \boldsymbol{z}_1 \cos\frac{\lambda\pi}{2} + \boldsymbol{z}_2 \sin\frac{\lambda\pi}{2},\quad \lambda\in[0, 1]\end{equation}</p>
<p>æ’å€¼æ•ˆæœæ¼”ç¤ºï¼ˆç¬”è€…è‡ªå·±è®­ç»ƒçš„æ¨¡å‹ï¼‰ï¼š  </p>
<p><a href="/usr/uploads/2022/07/1078989049.jpg" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="DDIMéšæœºå‘é‡çš„æ’å€¼ç”Ÿæˆæ•ˆæœ" src="/usr/uploads/2022/07/1078989049.jpg" /></a></p>
<p>DDIMéšæœºå‘é‡çš„æ’å€¼ç”Ÿæˆæ•ˆæœ</p>
<h2 id="_7">å¾®åˆ†æ–¹ç¨‹</h2>
<p>æœ€åï¼Œæˆ‘ä»¬æ¥é‡ç‚¹åˆ†æä¸€ä¸‹$\sigma_t = 0$çš„æƒ…å½¢ã€‚æ­¤æ—¶$\eqref{eq:sigma=0}$å¯ä»¥ç­‰ä»·åœ°æ”¹å†™æˆï¼š<br />
\begin{equation}\frac{\boldsymbol{x}<em t-1="t-1">t}{\bar{\alpha}_t} - \frac{\boldsymbol{x}</em>}}{\bar{\alpha<em t-1="t-1">{t-1}} = \left(\frac{\bar{\beta}_t}{\bar{\alpha}_t} - \frac{\bar{\beta}</em>}}{\bar{\alpha<em _boldsymbol_theta="\boldsymbol{\theta">{t-1}}\right) \boldsymbol{\epsilon}</em>}}(\boldsymbol{x<em t-1="t-1">t, t)\end{equation}<br />
å½“$T$è¶³å¤Ÿå¤§ï¼Œæˆ–è€…è¯´$\alpha_t$ä¸$\alpha</em>$è¶³å¤Ÿå°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸Šå¼è§†ä¸ºæŸä¸ªå¸¸å¾®åˆ†æ–¹ç¨‹çš„å·®åˆ†å½¢å¼ã€‚ç‰¹åˆ«åœ°ï¼Œå¼•å…¥è™šæ‹Ÿçš„æ—¶é—´å‚æ•°$s$ï¼Œæˆ‘ä»¬å¾—åˆ°<br />
\begin{equation}\frac{d}{ds}\left(\frac{\boldsymbol{x}(s)}{\bar{\alpha}(s)}\right) = \boldsymbol{\epsilon}_{\boldsymbol{\theta}}\left(\boldsymbol{x}(s), t(s)\right)\frac{d}{ds}\left(\frac{\bar{\beta}(s)}{\bar{\alpha}(s)}\right)\label{eq:ode}\end{equation}<br />
ä¸å¤±ä¸€èˆ¬æ€§ï¼Œå‡è®¾$s\in[0,1]$ï¼Œå…¶ä¸­$s=0$å¯¹åº”$t=0$ã€$s=1$å¯¹åº”$t=T$ã€‚æ³¨æ„DDIMåŸè®ºæ–‡ç›´æ¥ç”¨$\frac{\bar{\beta}(s)}{\bar{\alpha}(s)}$ä½œä¸ºè™šæ‹Ÿæ—¶é—´å‚æ•°ï¼Œè¿™åŸåˆ™ä¸Šæ˜¯ä¸å¤§é€‚åˆçš„ï¼Œå› ä¸ºå®ƒçš„èŒƒå›´æ˜¯$[0,\infty)$ï¼Œæ— ç•Œçš„åŒºé—´ä¸åˆ©äºæ•°å€¼æ±‚è§£ã€‚</p>
<p>é‚£ä¹ˆç°åœ¨æˆ‘ä»¬è¦åšçš„äº‹æƒ…å°±æ˜¯åœ¨ç»™å®š$\boldsymbol{x}(1)\sim \mathcal{N}(\boldsymbol{0},\boldsymbol{I})$çš„æƒ…å†µä¸‹ï¼Œå»æ±‚è§£å‡º$\boldsymbol{x}(0)$ã€‚è€ŒDDPMæˆ–è€…DDIMçš„è¿­ä»£è¿‡ç¨‹ï¼Œå¯¹åº”äºè¯¥å¸¸å¾®åˆ†æ–¹ç¨‹çš„<a href="https://en.wikipedia.org/wiki/Euler_method">æ¬§æ‹‰æ–¹æ³•</a>ã€‚ä¼—æ‰€å‘¨çŸ¥æ¬§æ‹‰æ³•çš„æ•ˆç‡ç›¸å¯¹æ¥è¯´æ˜¯æœ€æ…¢çš„ï¼Œå¦‚æœè¦æƒ³åŠ é€Ÿæ±‚è§£ï¼Œå¯ä»¥ç”¨<a href="https://en.wikipedia.org/wiki/Heun%27s_method">Heunæ–¹æ³•</a>ã€<a href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods">R-Kæ–¹æ³•</a>ç­‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå°†ç”Ÿæˆè¿‡ç¨‹ç­‰åŒäºæ±‚è§£å¸¸å¾®åˆ†æ–¹ç¨‹åï¼Œå¯ä»¥å€ŸåŠ©å¸¸å¾®åˆ†æ–¹ç¨‹çš„æ•°å€¼è§£æ³•ï¼Œä¸ºç”Ÿæˆè¿‡ç¨‹çš„åŠ é€Ÿæä¾›æ›´ä¸°å¯Œå¤šæ ·çš„æ‰‹æ®µã€‚</p>
<p>ä»¥DDPMçš„é»˜è®¤å‚æ•°$T=1000$ã€$\alpha_t = \sqrt{1 - \frac{0.02t}{T}}$ä¸ºä¾‹ï¼Œæˆ‘ä»¬é‡å¤<a href="/archives/9119">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆä¸€ï¼‰ï¼šDDPM = æ‹†æ¥¼ + å»ºæ¥¼ã€‹</a>æ‰€åšçš„ä¼°è®¡<br />
\begin{equation}\log \bar{\alpha}<em i="k">t = \sum</em>}^t \log\alpha_k = \frac{1}{2} \sum_{k=1}^t \log\left(1 - \frac{0.02k}{T}\right) &lt; \frac{1}{2} \sum_{k=1}^t \left(- \frac{0.02k}{T}\right) = -\frac{0.005t(t+1)}{T}\end{equation<br />
äº‹å®ä¸Šï¼Œç”±äºæ¯ä¸ª$\alpha_k$éƒ½å¾ˆæ¥è¿‘äº1ï¼Œæ‰€ä»¥ä¸Šè¿°ä¼°è®¡å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è¿‘ä¼¼ã€‚è€Œæˆ‘ä»¬è¯´äº†æœ¬æ–‡çš„å‡ºå‘ç‚¹æ˜¯$p(\boldsymbol{x}<em _boldsymbol_theta="\boldsymbol{\theta">t|\boldsymbol{x}_0)$ï¼Œæ‰€ä»¥åº”è¯¥ä»¥$\bar{\alpha}_t$ä¸ºèµ·ç‚¹ï¼Œæ ¹æ®ä¸Šè¿°è¿‘ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç®€å•åœ°å–<br />
\begin{equation}\bar{\alpha}_t = \exp\left(-\frac{0.005t^2}{T}\right) = \exp\left(-\frac{5t^2}{T^2}\right)\end{equation}<br />
å¦‚æœå–$s=t/T$ä¸ºå‚æ•°ï¼Œé‚£ä¹ˆæ­£å¥½$s\in[0,1]$ï¼Œæ­¤æ—¶$\bar{\alpha}(s)=e^{-5s^2}$ï¼Œä»£å…¥åˆ°å¼$\eqref{eq:ode}$åŒ–ç®€å¾—<br />
\begin{equation}\frac{d\boldsymbol{x}(s)}{ds} = 10s\left(\frac{\boldsymbol{\epsilon}</em>}}\left(\boldsymbol{x}(s), sT\right)}{\sqrt{1-e^{-10s^2}}} - \boldsymbol{x}(s)\right)\end{equation<br />
ä¹Ÿå¯ä»¥å–$s=t^2/T^2$ä¸ºå‚æ•°ï¼Œæ­¤æ—¶ä¹Ÿæœ‰$s\in[0,1]$ï¼Œä»¥åŠ$\bar{\alpha}(s)=e^{-5s}$ï¼Œä»£å…¥åˆ°å¼$\eqref{eq:ode}$åŒ–ç®€å¾—<br />
\begin{equation}\frac{d\boldsymbol{x}(s)}{ds} = 5\left(\frac{\boldsymbol{\epsilon}_{\boldsymbol{\theta}}\left(\boldsymbol{x}(s), \sqrt{s}T\right)}{\sqrt{1-e^{-10s}}} - \boldsymbol{x}(s)\right)\end{equation}</p>
<h2 id="_8">æ–‡ç« å°ç»“</h2>
<p>æœ¬æ–‡æ¥ç€ä¸Šä¸€ç¯‡DDPMçš„æ¨å¯¼æ€è·¯æ¥ä»‹ç»äº†DDIMï¼Œå®ƒé‡æ–°å®¡è§†äº†DDPMçš„å‡ºå‘ç‚¹ï¼Œå»æ‰äº†æ¨å¯¼è¿‡ç¨‹ä¸­çš„$p(\boldsymbol{x}<em t-1="t-1">t|\boldsymbol{x}</em>)$ï¼Œä»è€Œè·å¾—äº†ä¸€ç°‡æ›´å¹¿æ³›çš„è§£å’ŒåŠ é€Ÿç”Ÿæˆè¿‡ç¨‹çš„æ€è·¯ï¼Œæœ€åè¿™ç°‡æ–°è§£è¿˜å…è®¸æˆ‘ä»¬å°†ç”Ÿæˆè¿‡ç¨‹è·Ÿå¸¸å¾®åˆ†æ–¹ç¨‹çš„æ±‚è§£è”ç³»èµ·æ¥ï¼Œä»è€Œå€ŸåŠ©å¸¸å¾®åˆ†æ–¹ç¨‹çš„æ–¹æ³•è¿›ä¸€æ­¥å¯¹ç”Ÿæˆè¿‡ç¨‹è¿›è¡Œç ”ç©¶ã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/9181">https://spaces.ac.cn/archives/9181</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Jul. 27, 2022). ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆå››ï¼‰ï¼šDDIM = é«˜è§‚ç‚¹DDPM ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/9181">https://spaces.ac.cn/archives/9181</a></p>
<p>@online{kexuefm-9181,<br />
title={ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆå››ï¼‰ï¼šDDIM = é«˜è§‚ç‚¹DDPM},<br />
author={è‹å‰‘æ—},<br />
year={2022},<br />
month={Jul},<br />
url={\url{https://spaces.ac.cn/archives/9181}},<br />
} </p>
<hr />
<h2 id="_9">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<p>æœ¬èŠ‚å°†å¯¹DDIMçš„æ ¸å¿ƒæ€æƒ³è¿›è¡Œæä¸ºè¯¦ç»†çš„æ•°å­¦æ¨å¯¼ï¼Œä»éé©¬å°”å¯å¤«è¿‡ç¨‹ã€ç¡®å®šæ€§é‡‡æ ·ã€å‚æ•°æœºåˆ¶åˆ°ODEè§†è§’ï¼Œå…¨é¢æ­ç¤ºDDIMç›¸æ¯”DDPMçš„ç†è®ºåˆ›æ–°ã€‚</p>
<h3 id="1-ddim">1. DDIMçš„æ•°å­¦å®šä¹‰ä¸éé©¬å°”å¯å¤«å‰å‘è¿‡ç¨‹</h3>
<h4 id="11">1.1 é©¬å°”å¯å¤«æ€§è´¨çš„å›é¡¾</h4>
<p>åœ¨DDPMä¸­ï¼Œå‰å‘æ‰©æ•£è¿‡ç¨‹å…·æœ‰é©¬å°”å¯å¤«æ€§è´¨ï¼Œå³ï¼š
$$p(\boldsymbol{x}_t|\boldsymbol{x}_{t-1}, \boldsymbol{x}_{t-2}, \cdots, \boldsymbol{x}_0) = p(\boldsymbol{x}_t|\boldsymbol{x}_{t-1})$$</p>
<p>è¿™æ„å‘³ç€åœ¨ç»™å®š$\boldsymbol{x}<em t-2="t-2">{t-1}$çš„æ¡ä»¶ä¸‹ï¼Œ$\boldsymbol{x}_t$ä¸æ›´æ—©çš„çŠ¶æ€$\boldsymbol{x}</em>_0$æ¡ä»¶ç‹¬ç«‹ã€‚æ•´ä¸ªå‰å‘è¿‡ç¨‹å¯ä»¥å†™æˆé“¾å¼ç»“æ„ï¼š
$$q(\boldsymbol{x}_{1:T}|\boldsymbol{x}_0) = \prod_{t=1}^T q(\boldsymbol{x}_t|\boldsymbol{x}_{t-1})$$}, \cdots, \boldsymbol{x</p>
<p>åœ¨DDPMçš„æ ‡å‡†è®¾å®šä¸­ï¼Œæ¯ä¸€æ­¥çš„è½¬ç§»æ¦‚ç‡ä¸ºï¼š
$$q(\boldsymbol{x}_t|\boldsymbol{x}_{t-1}) = \mathcal{N}(\boldsymbol{x}_t; \sqrt{1-\beta_t}\boldsymbol{x}_{t-1}, \beta_t\boldsymbol{I})$$</p>
<h4 id="12">1.2 éé©¬å°”å¯å¤«è¿‡ç¨‹çš„å¼•å…¥</h4>
<p>DDIMçš„æ ¸å¿ƒåˆ›æ–°åœ¨äº<strong>æ”¾å¼ƒé©¬å°”å¯å¤«å‡è®¾</strong>ã€‚æˆ‘ä»¬ä¸å†å®šä¹‰$q(\boldsymbol{x}<em t-1="t-1">t|\boldsymbol{x}</em>_0)$ï¼š
$$q(\boldsymbol{x}_t|\boldsymbol{x}_0) = \mathcal{N}(\boldsymbol{x}_t; \sqrt{\bar{\alpha}_t}\boldsymbol{x}_0, (1-\bar{\alpha}_t)\boldsymbol{I})$$})$ï¼Œè€Œæ˜¯ç›´æ¥å®šä¹‰è¾¹é™…åˆ†å¸ƒ$q(\boldsymbol{x}_t|\boldsymbol{x</p>
<p>å…¶ä¸­$\bar{\alpha}_t \in (0,1)$æ˜¯é¢„å®šä¹‰çš„å™ªå£°è°ƒåº¦å‚æ•°ã€‚ä¸ºäº†ä¸DDPMä¿æŒä¸€è‡´ï¼Œæˆ‘ä»¬ä»ç„¶é‡‡ç”¨$\bar{\alpha}_t^2 + \bar{\beta}_t^2 = 1$çš„çº¦å®šï¼Œå³ï¼š
$$\bar{\beta}_t = \sqrt{1 - \bar{\alpha}_t^2}$$</p>
<p>è¿™æ ·è®¾å®šçš„å¥½å¤„æ˜¯ï¼š
1. <strong>è®­ç»ƒç›®æ ‡ä¸å˜</strong>ï¼šæŸå¤±å‡½æ•°$\mathbb{E}<em _theta="\theta">{\boldsymbol{x}_0, \boldsymbol{\varepsilon}}|\boldsymbol{\varepsilon} - \boldsymbol{\epsilon}</em>}(\sqrt{\bar{\alpha<em t-1="t-1">t}\boldsymbol{x}_0 + \sqrt{1-\bar{\alpha}_t}\boldsymbol{\varepsilon}, t)|^2$ä¿æŒä¸å˜
2. <strong>æ›´å¤§çš„è®¾è®¡ç©ºé—´</strong>ï¼šé€†å‘è¿‡ç¨‹$q(\boldsymbol{x}</em>_0)$æœ‰å¤šç§å¯èƒ½çš„å½¢å¼}|\boldsymbol{x}_t, \boldsymbol{x</p>
<h4 id="13">1.3 å¾…å®šç³»æ•°æ³•æ±‚è§£é€†å‘è¿‡ç¨‹</h4>
<p>ç»™å®šè¾¹é™…åˆ†å¸ƒ$q(\boldsymbol{x}<em t-1="t-1">t|\boldsymbol{x}_0)$å’Œ$q(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">0)$ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰¾åˆ°æ»¡è¶³è¾¹é™…åˆ†å¸ƒä¸€è‡´æ€§æ¡ä»¶çš„$q(\boldsymbol{x}</em>_0)$ï¼š
$$\int q(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t, \boldsymbol{x}_0) q(\boldsymbol{x}_t|\boldsymbol{x}_0) d\boldsymbol{x}_t = q(\boldsymbol{x}_{t-1}|\boldsymbol{x}_0)$$}|\boldsymbol{x}_t, \boldsymbol{x</p>
<p>å‡è®¾$q(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t, \boldsymbol{x}_0)$ä¸ºé«˜æ–¯åˆ†å¸ƒï¼Œé‡‡ç”¨å¾…å®šç³»æ•°æ³•ï¼š
$$q(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t, \boldsymbol{x}_0) = \mathcal{N}(\boldsymbol{x}_{t-1}; \kappa_t\boldsymbol{x}_t + \lambda_t\boldsymbol{x}_0, \sigma_t^2\boldsymbol{I})$$</p>
<p>ä»é‡‡æ ·è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬æœ‰ä¸‰ä¸ªéšæœºå˜é‡çš„é‡‡æ ·æ–¹å¼ï¼š
$$\begin{aligned}
\boldsymbol{x}_{t-1} &= \sqrt{\bar{\alpha}_{t-1}}\boldsymbol{x}_0 + \sqrt{1-\bar{\alpha}_{t-1}^2}\boldsymbol{\varepsilon} \\
\boldsymbol{x}_t &= \sqrt{\bar{\alpha}_t}\boldsymbol{x}_0 + \sqrt{1-\bar{\alpha}_t^2}\boldsymbol{\varepsilon}_1 \\
\boldsymbol{x}_{t-1} &= \kappa_t\boldsymbol{x}_t + \lambda_t\boldsymbol{x}_0 + \sigma_t\boldsymbol{\varepsilon}_2
\end{aligned}$$</p>
<p>å…¶ä¸­$\boldsymbol{\varepsilon}, \boldsymbol{\varepsilon}_1, \boldsymbol{\varepsilon}_2 \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{I})$æ˜¯ç‹¬ç«‹çš„æ ‡å‡†é«˜æ–¯å™ªå£°ã€‚</p>
<p>å°†ç¬¬äºŒä¸ªç­‰å¼ä»£å…¥ç¬¬ä¸‰ä¸ªï¼š
$$\begin{aligned}
\boldsymbol{x}_{t-1} &= \kappa_t(\sqrt{\bar{\alpha}_t}\boldsymbol{x}_0 + \sqrt{1-\bar{\alpha}_t^2}\boldsymbol{\varepsilon}_1) + \lambda_t\boldsymbol{x}_0 + \sigma_t\boldsymbol{\varepsilon}_2 \\
&= (\kappa_t\sqrt{\bar{\alpha}_t} + \lambda_t)\boldsymbol{x}_0 + \kappa_t\sqrt{1-\bar{\alpha}_t^2}\boldsymbol{\varepsilon}_1 + \sigma_t\boldsymbol{\varepsilon}_2
\end{aligned}$$</p>
<p>æ ¹æ®é«˜æ–¯åˆ†å¸ƒçš„æ€§è´¨ï¼Œä¸¤ä¸ªç‹¬ç«‹é«˜æ–¯å™ªå£°çš„çº¿æ€§ç»„åˆä»ä¸ºé«˜æ–¯ï¼š
$$\kappa_t\sqrt{1-\bar{\alpha}_t^2}\boldsymbol{\varepsilon}_1 + \sigma_t\boldsymbol{\varepsilon}_2 \sim \mathcal{N}(\boldsymbol{0}, (\kappa_t^2(1-\bar{\alpha}_t^2) + \sigma_t^2)\boldsymbol{I})$$</p>
<p>å¯¹æ¯”ç¬¬ä¸€ä¸ªç­‰å¼ï¼Œæˆ‘ä»¬å¾—åˆ°ä¸¤ä¸ªçº¦æŸæ–¹ç¨‹ï¼š
$$\begin{cases}
\kappa_t\sqrt{\bar{\alpha}_t} + \lambda_t = \sqrt{\bar{\alpha}_{t-1}} & \text{(å‡å€¼åŒ¹é…)} \\
\sqrt{\kappa_t^2(1-\bar{\alpha}_t^2) + \sigma_t^2} = \sqrt{1-\bar{\alpha}_{t-1}^2} & \text{(æ–¹å·®åŒ¹é…)}
\end{cases}$$</p>
<p>è¿™æ˜¯ä¸¤ä¸ªæ–¹ç¨‹ä¸‰ä¸ªæœªçŸ¥æ•°çš„æ¬ å®šç³»ç»Ÿã€‚å°†$\sigma_t$è§†ä¸º<strong>è‡ªç”±å‚æ•°</strong>ï¼Œå¯ä»¥è§£å‡ºï¼š
$$\begin{aligned}
\kappa_t^2(1-\bar{\alpha}_t^2) &= 1-\bar{\alpha}_{t-1}^2 - \sigma_t^2 \\
\kappa_t &= \frac{\sqrt{1-\bar{\alpha}_{t-1}^2 - \sigma_t^2}}{\sqrt{1-\bar{\alpha}_t^2}}
\end{aligned}$$</p>
<p>ç„¶åä»ç¬¬ä¸€ä¸ªæ–¹ç¨‹è§£å‡ºï¼š
$$\lambda_t = \sqrt{\bar{\alpha}_{t-1}} - \kappa_t\sqrt{\bar{\alpha}_t} = \sqrt{\bar{\alpha}_{t-1}} - \frac{\sqrt{\bar{\alpha}_t}\sqrt{1-\bar{\alpha}_{t-1}^2 - \sigma_t^2}}{\sqrt{1-\bar{\alpha}_t^2}}$$</p>
<h4 id="14">1.4 å®Œæ•´çš„é€†å‘è¿‡ç¨‹å½¢å¼</h4>
<p>ç»¼åˆä¸Šè¿°æ¨å¯¼ï¼Œå¾—åˆ°DDIMçš„é€†å‘è¿‡ç¨‹æ¡ä»¶åˆ†å¸ƒï¼š
$$q(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t, \boldsymbol{x}_0) = \mathcal{N}\left(\boldsymbol{x}_{t-1}; \frac{\sqrt{1-\bar{\alpha}_{t-1}^2-\sigma_t^2}}{\sqrt{1-\bar{\alpha}_t^2}}\boldsymbol{x}_t + \left(\sqrt{\bar{\alpha}_{t-1}} - \frac{\sqrt{\bar{\alpha}_t}\sqrt{1-\bar{\alpha}_{t-1}^2-\sigma_t^2}}{\sqrt{1-\bar{\alpha}_t^2}}\right)\boldsymbol{x}_0, \sigma_t^2\boldsymbol{I}\right)$$</p>
<p>è¿™ä¸ªå…¬å¼æ­ç¤ºäº†DDIMçš„æ ¸å¿ƒç‰¹æ€§ï¼š<strong>é€šè¿‡è°ƒèŠ‚$\sigma_t$ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç¡®å®šæ€§è¿‡ç¨‹å’Œéšæœºè¿‡ç¨‹ä¹‹é—´è¿ç»­æ’å€¼</strong>ã€‚</p>
<h3 id="2">2. ç¡®å®šæ€§é‡‡æ ·çš„æ·±å…¥æ¨å¯¼</h3>
<h4 id="21">2.1 ä»æ¡ä»¶åˆ†å¸ƒåˆ°é‡‡æ ·å…¬å¼</h4>
<p>åœ¨å®é™…é‡‡æ ·ä¸­ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥è·å¾—$\boldsymbol{x}<em _theta="\theta">0$ï¼Œéœ€è¦ç”¨ç¥ç»ç½‘ç»œ$\boldsymbol{\epsilon}</em>_0$çš„ä¼°è®¡ï¼š
$$\hat{\boldsymbol{x}}_0 = \frac{\boldsymbol{x}_t - \sqrt{1-\bar{\alpha}_t^2}\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t, t)}{\sqrt{\bar{\alpha}_t}}$$}(\boldsymbol{x}_t, t)$æ¥é¢„æµ‹å™ªå£°ã€‚ä»$\boldsymbol{x}_t = \sqrt{\bar{\alpha}_t}\boldsymbol{x}_0 + \sqrt{1-\bar{\alpha}_t^2}\boldsymbol{\varepsilon}$ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°$\boldsymbol{x</p>
<p>ä¸ºäº†ç®€åŒ–åç»­å…¬å¼ï¼Œæˆ‘ä»¬é‡‡ç”¨æ›¿æ¢è®°å·ã€‚æ³¨æ„åŸæ–‡ä½¿ç”¨äº†$\bar{\alpha}_t, \bar{\beta}_t$æ»¡è¶³$\bar{\alpha}_t^2 + \bar{\beta}_t^2 = 1$ï¼Œå› æ­¤$\bar{\beta}_t = \sqrt{1-\bar{\alpha}_t^2}$ã€‚å°†$\hat{\boldsymbol{x}}_0$ä»£å…¥é€†å‘è¿‡ç¨‹çš„å‡å€¼ï¼š</p>
<p>$$\begin{aligned}
\boldsymbol{\mu}_{\theta}(\boldsymbol{x}_t, t) &= \frac{\sqrt{1-\bar{\alpha}_{t-1}^2-\sigma_t^2}}{\sqrt{1-\bar{\alpha}_t^2}}\boldsymbol{x}_t + \left(\sqrt{\bar{\alpha}_{t-1}} - \frac{\sqrt{\bar{\alpha}_t}\sqrt{1-\bar{\alpha}_{t-1}^2-\sigma_t^2}}{\sqrt{1-\bar{\alpha}_t^2}}\right)\hat{\boldsymbol{x}}_0 \\
&= \frac{\sqrt{1-\bar{\alpha}_{t-1}^2-\sigma_t^2}}{\sqrt{1-\bar{\alpha}_t^2}}\boldsymbol{x}_t + \left(\sqrt{\bar{\alpha}_{t-1}} - \frac{\sqrt{\bar{\alpha}_t}\sqrt{1-\bar{\alpha}_{t-1}^2-\sigma_t^2}}{\sqrt{1-\bar{\alpha}_t^2}}\right) \cdot \frac{\boldsymbol{x}_t - \sqrt{1-\bar{\alpha}_t^2}\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t, t)}{\sqrt{\bar{\alpha}_t}}
\end{aligned}$$</p>
<p>å±•å¼€ç¬¬äºŒé¡¹ï¼š
$$\begin{aligned}
&\left(\sqrt{\bar{\alpha}_{t-1}} - \frac{\sqrt{\bar{\alpha}_t}\sqrt{1-\bar{\alpha}_{t-1}^2-\sigma_t^2}}{\sqrt{1-\bar{\alpha}_t^2}}\right) \cdot \frac{\boldsymbol{x}_t - \sqrt{1-\bar{\alpha}_t^2}\boldsymbol{\epsilon}_{\theta}}{\sqrt{\bar{\alpha}_t}} \\
=& \frac{\sqrt{\bar{\alpha}_{t-1}}}{\sqrt{\bar{\alpha}_t}}\boldsymbol{x}_t - \frac{\sqrt{\bar{\alpha}_{t-1}}\sqrt{1-\bar{\alpha}_t^2}}{\sqrt{\bar{\alpha}_t}}\boldsymbol{\epsilon}_{\theta} - \frac{\sqrt{1-\bar{\alpha}_{t-1}^2-\sigma_t^2}}{\sqrt{1-\bar{\alpha}_t^2}}\boldsymbol{x}_t + \frac{\sqrt{\bar{\alpha}_t}\sqrt{1-\bar{\alpha}_{t-1}^2-\sigma_t^2}}{\sqrt{\bar{\alpha}_t}\sqrt{1-\bar{\alpha}_t^2}}\boldsymbol{\epsilon}_{\theta}
\end{aligned}$$</p>
<p>åˆå¹¶$\boldsymbol{x}<em _theta="\theta">t$å’Œ$\boldsymbol{\epsilon}</em>$çš„ç³»æ•°ï¼š
$$\begin{aligned}
\boldsymbol{\mu}_{\theta}(\boldsymbol{x}_t, t) &= \left(\frac{\sqrt{1-\bar{\alpha}_{t-1}^2-\sigma_t^2}}{\sqrt{1-\bar{\alpha}_t^2}} + \frac{\sqrt{\bar{\alpha}_{t-1}}}{\sqrt{\bar{\alpha}_t}} - \frac{\sqrt{1-\bar{\alpha}_{t-1}^2-\sigma_t^2}}{\sqrt{1-\bar{\alpha}_t^2}}\right)\boldsymbol{x}_t \\
&\quad - \left(\frac{\sqrt{\bar{\alpha}_{t-1}}\sqrt{1-\bar{\alpha}_t^2}}{\sqrt{\bar{\alpha}_t}} - \frac{\sqrt{1-\bar{\alpha}_{t-1}^2-\sigma_t^2}}{\sqrt{1-\bar{\alpha}_t^2}}\right)\boldsymbol{\epsilon}_{\theta} \\
&= \frac{\sqrt{\bar{\alpha}_{t-1}}}{\sqrt{\bar{\alpha}_t}}\boldsymbol{x}_t - \left(\frac{\sqrt{\bar{\alpha}_{t-1}}\sqrt{1-\bar{\alpha}_t^2}}{\sqrt{\bar{\alpha}_t}} - \sqrt{1-\bar{\alpha}_{t-1}^2-\sigma_t^2}\right)\boldsymbol{\epsilon}_{\theta}
\end{aligned}$$</p>
<p>å®šä¹‰$\alpha_t = \frac{\bar{\alpha}<em t-1="t-1">t}{\bar{\alpha}</em>$ï¼Œä»£å…¥å¾—ï¼š
$$\boldsymbol{\mu}_{\theta}(\boldsymbol{x}_t, t) = \frac{1}{\sqrt{\alpha_t}}\boldsymbol{x}_t - \frac{1}{\sqrt{\alpha_t}}\left(\sqrt{1-\bar{\alpha}_t^2} - \sqrt{\alpha_t}\sqrt{1-\bar{\alpha}_{t-1}^2-\sigma_t^2}\right)\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t, t)$$}}$ï¼Œåˆ™$\sqrt{\bar{\alpha}_{t-1}} = \frac{\sqrt{\bar{\alpha}_t}}{\sqrt{\alpha_t}</p>
<p>å› æ­¤ï¼Œå®Œæ•´çš„é‡‡æ ·å…¬å¼ä¸ºï¼š
$$\boldsymbol{x}_{t-1} = \frac{1}{\sqrt{\alpha_t}}\left[\boldsymbol{x}_t - \left(\sqrt{1-\bar{\alpha}_t^2} - \sqrt{\alpha_t}\sqrt{1-\bar{\alpha}_{t-1}^2-\sigma_t^2}\right)\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t, t)\right] + \sigma_t\boldsymbol{\varepsilon}$$</p>
<h4 id="22-sigma_t-0">2.2 ç¡®å®šæ€§é‡‡æ ·ï¼š$\sigma_t = 0$çš„æƒ…å½¢</h4>
<p>å½“å–$\sigma_t = 0$æ—¶ï¼Œé‡‡æ ·è¿‡ç¨‹å˜ä¸ºå®Œå…¨ç¡®å®šæ€§çš„ï¼š
$$\boldsymbol{x}_{t-1} = \frac{\sqrt{\bar{\alpha}_{t-1}}}{\sqrt{\bar{\alpha}_t}}\boldsymbol{x}_t + \left(\sqrt{1-\bar{\alpha}_{t-1}^2} - \frac{\sqrt{\bar{\alpha}_{t-1}}}{\sqrt{\bar{\alpha}_t}}\sqrt{1-\bar{\alpha}_t^2}\right)\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t, t)$$</p>
<p>è¿™ä¸ªå…¬å¼å¯ä»¥è¿›ä¸€æ­¥æ”¹å†™ä¸ºï¼š
$$\boldsymbol{x}_{t-1} = \sqrt{\bar{\alpha}_{t-1}}\hat{\boldsymbol{x}}_0 + \sqrt{1-\bar{\alpha}_{t-1}^2}\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t, t)$$</p>
<p>å…¶ä¸­$\hat{\boldsymbol{x}}<em _theta="\theta">0 = \frac{\boldsymbol{x}_t - \sqrt{1-\bar{\alpha}_t^2}\boldsymbol{\epsilon}</em>$ã€‚}(\boldsymbol{x}_t, t)}{\sqrt{\bar{\alpha}_t}</p>
<p>è¿™ä¸ªå½¢å¼æ­ç¤ºäº†ç¡®å®šæ€§DDIMçš„æœ¬è´¨ï¼š<strong>åœ¨æ¯ä¸€æ­¥ï¼Œæˆ‘ä»¬é¦–å…ˆé¢„æµ‹$\boldsymbol{x}_0$ï¼Œç„¶åå°†å…¶é‡æ–°åŠ å™ªåˆ°æ—¶åˆ»$t-1$</strong>ã€‚è¿™ç§"é¢„æµ‹-é‡å™ª"çš„è¿‡ç¨‹ä¸DDPMçš„"å»å™ª"è¿‡ç¨‹æœ‰æœ¬è´¨ä¸åŒã€‚</p>
<h4 id="23">2.3 ç¡®å®šæ€§è¿‡ç¨‹çš„åŒå°„æ€§è´¨</h4>
<p>å¯¹äºç¡®å®šæ€§DDIMï¼ˆ$\sigma_t = 0$ï¼‰ï¼Œä»$\boldsymbol{x}_T$åˆ°$\boldsymbol{x}_0$çš„æ˜ å°„$\mathcal{F}: \boldsymbol{x}_T \mapsto \boldsymbol{x}_0$æ˜¯ï¼ˆè¿‘ä¼¼ï¼‰ç¡®å®šæ€§çš„åŒå°„ã€‚è¿™æ„å‘³ç€ï¼š</p>
<ol>
<li>
<p><strong>å‰å‘ç¼–ç </strong>ï¼šç»™å®š$\boldsymbol{x}_0$ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‰å‘è¿‡ç¨‹ï¼ˆåŠ å™ªï¼‰å¾—åˆ°å¯¹åº”çš„$\boldsymbol{x}_T$ï¼š
$$\boldsymbol{x}_t = \sqrt{\bar{\alpha}_t}\boldsymbol{x}_0 + \sqrt{1-\bar{\alpha}_t^2}\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t, t)$$</p>
</li>
<li>
<p><strong>åå‘è§£ç </strong>ï¼šç»™å®š$\boldsymbol{x}_T$ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¡®å®šæ€§é‡‡æ ·å¾—åˆ°å¯¹åº”çš„$\boldsymbol{x}_0$ï¼š
$$\boldsymbol{x}_0 = \mathcal{F}(\boldsymbol{x}_T)$$</p>
</li>
<li>
<p><strong>ä¸€è‡´æ€§</strong>ï¼šå¦‚æœç¼–ç å’Œè§£ç ä½¿ç”¨ç›¸åŒçš„$\boldsymbol{\epsilon}_{\theta}$ï¼Œåˆ™$\mathcal{F}(\mathcal{F}^{-1}(\boldsymbol{x}_0)) \approx \boldsymbol{x}_0$</p>
</li>
</ol>
<p>è¿™ç§åŒå°„æ€§è´¨ä½¿å¾—DDIMå¯ä»¥è¿›è¡Œè¯­ä¹‰æ’å€¼å’Œå›¾åƒç¼–è¾‘ï¼šå¯¹ä¸¤å¼ å›¾åƒ$\boldsymbol{x}_0^{(1)}, \boldsymbol{x}_0^{(2)}$ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆç¼–ç åˆ°æ½œç©ºé—´$\boldsymbol{x}_T^{(1)}, \boldsymbol{x}_T^{(2)}$ï¼Œç„¶ååœ¨æ½œç©ºé—´æ’å€¼ï¼š
$$\boldsymbol{x}_T = \lambda\boldsymbol{x}_T^{(1)} + (1-\lambda)\boldsymbol{x}_T^{(2)}$$</p>
<p>ä½†éœ€è¦æ³¨æ„ï¼Œç”±äºDDIMå¯¹å™ªå£°åˆ†å¸ƒæ•æ„Ÿï¼Œåº”ä½¿ç”¨çƒé¢æ’å€¼ï¼š
$$\boldsymbol{x}_T = \cos\theta \cdot \boldsymbol{x}_T^{(1)} + \sin\theta \cdot \boldsymbol{x}_T^{(2)}, \quad \theta = \frac{\lambda\pi}{2}$$</p>
<h3 id="3">3. Î·å‚æ•°çš„ä½œç”¨æœºåˆ¶</h3>
<h4 id="31">3.1 Î·å‚æ•°æ—çš„å®šä¹‰</h4>
<p>DDIMè®ºæ–‡å¼•å…¥äº†å‚æ•°$\eta \in [0, 1]$æ¥æ§åˆ¶éšæœºæ€§çš„å¼ºåº¦ã€‚å…·ä½“åœ°ï¼Œå®šä¹‰ï¼š
$$\sigma_t(\eta) = \eta \cdot \frac{\sqrt{1-\bar{\alpha}_{t-1}^2}}{\sqrt{1-\bar{\alpha}_t^2}} \cdot \sqrt{1 - \frac{\bar{\alpha}_t^2}{\bar{\alpha}_{t-1}^2}}$$</p>
<p>è¿™ä¸ªå®šä¹‰æ¥è‡ªDDPMä¸­çš„æ–¹å·®é€‰æ‹©ã€‚åœ¨DDPMä¸­ï¼Œæœ€ä¼˜åéªŒæ–¹å·®ä¸ºï¼š
$$\tilde{\beta}_t = \frac{1-\bar{\alpha}_{t-1}}{1-\bar{\alpha}_t}\beta_t$$</p>
<p>å…¶ä¸­$\beta_t = 1 - \alpha_t = 1 - \frac{\bar{\alpha}<em t-1="t-1">t}{\bar{\alpha}</em>_t^2 = 1$ï¼Œå¯ä»¥éªŒè¯ï¼š
$$\tilde{\beta}_t^2 = \frac{(1-\bar{\alpha}_{t-1}^2)(1-\bar{\alpha}_t^2/\bar{\alpha}_{t-1}^2)}{1-\bar{\alpha}_t^2} = \frac{\bar{\beta}_{t-1}^2}{\bar{\beta}_t^2}\left(1 - \frac{\bar{\alpha}_t^2}{\bar{\alpha}_{t-1}^2}\right)$$}}$ã€‚ä½¿ç”¨çº¦å®š$\bar{\alpha}_t^2 + \bar{\beta</p>
<p>å› æ­¤$\sigma_t(\eta) = \eta\tilde{\beta}_t$ã€‚</p>
<h4 id="32">3.2 Î·å‚æ•°çš„å‡ ä½•è§£é‡Š</h4>
<p>è€ƒè™‘é‡‡æ ·å…¬å¼ï¼š
$$\boldsymbol{x}_{t-1} = \sqrt{\bar{\alpha}_{t-1}}\hat{\boldsymbol{x}}_0 + \sqrt{1-\bar{\alpha}_{t-1}^2-\sigma_t^2}\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t, t) + \sigma_t\boldsymbol{\varepsilon}$$</p>
<p>æˆ‘ä»¬å¯ä»¥å°†å…¶åˆ†è§£ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š
1. <strong>ç¡®å®šæ€§éƒ¨åˆ†</strong>ï¼š$\sqrt{\bar{\alpha}<em t-1="t-1">{t-1}}\hat{\boldsymbol{x}}_0$ï¼ŒæŒ‡å‘é¢„æµ‹çš„å¹²å‡€å›¾åƒ
2. <strong>æ–¹å‘æ€§å™ªå£°</strong>ï¼š$\sqrt{1-\bar{\alpha}</em>_t, t)$ï¼Œæ²¿ç€å½“å‰ä¼°è®¡çš„å™ªå£°æ–¹å‘
3. }^2-\sigma_t^2}\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x<strong>éšæœºå™ªå£°</strong>ï¼š$\sigma_t\boldsymbol{\varepsilon}$ï¼Œå„å‘åŒæ€§çš„éšæœºæ‰°åŠ¨</p>
<p>å½“$\eta$å¢å¤§æ—¶ï¼š
- $\sigma_t$å¢å¤§ï¼Œéšæœºæ€§å¢å¼º
- $\sqrt{1-\bar{\alpha}<em t-1="t-1">{t-1}^2-\sigma_t^2}$å‡å°ï¼Œæ–¹å‘æ€§é™ä½
- æ€»æ–¹å·®$1-\bar{\alpha}</em>^2-\sigma_t^2) + \sigma_t^2$ä¿æŒä¸å˜}^2 = (1-\bar{\alpha}_{t-1</p>
<p>è¿™æ„å‘³ç€<strong>Î·å‚æ•°æ§åˆ¶äº†å™ªå£°çš„"å„å‘åŒæ€§ç¨‹åº¦"</strong>ï¼š
- $\eta = 0$ï¼šå®Œå…¨å„å‘å¼‚æ€§ï¼Œå™ªå£°æ²¿$\boldsymbol{\epsilon}_{\theta}$æ–¹å‘
- $\eta = 1$ï¼šæœ€å¤§å„å‘åŒæ€§ï¼Œç­‰ä»·äºDDPM
- $0 &lt; \eta &lt; 1$ï¼šæ’å€¼çŠ¶æ€</p>
<h4 id="33-1ddpm">3.3 Î·=1æ—¶é€€åŒ–ä¸ºDDPMçš„ä¸¥æ ¼è¯æ˜</h4>
<p>å½“$\eta = 1$æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è¯æ˜DDIMçš„é‡‡æ ·å…¬å¼å®Œå…¨ç­‰ä»·äºDDPMã€‚é¦–å…ˆè®¡ç®—$\sigma_t(1)$ï¼š
$$\sigma_t^2 = \frac{\bar{\beta}_{t-1}^2}{\bar{\beta}_t^2}\left(1 - \frac{\bar{\alpha}_t^2}{\bar{\alpha}_{t-1}^2}\right) = \frac{\bar{\beta}_{t-1}^2(\bar{\alpha}_{t-1}^2 - \bar{\alpha}_t^2)}{\bar{\beta}_t^2\bar{\alpha}_{t-1}^2}$$</p>
<p>ç„¶åè®¡ç®—æ–¹å‘æ€§å™ªå£°çš„ç³»æ•°ï¼š
$$\begin{aligned}
\sqrt{1-\bar{\alpha}_{t-1}^2-\sigma_t^2} &= \sqrt{\bar{\beta}_{t-1}^2 - \frac{\bar{\beta}_{t-1}^2(\bar{\alpha}_{t-1}^2 - \bar{\alpha}_t^2)}{\bar{\beta}_t^2\bar{\alpha}_{t-1}^2}} \\
&= \bar{\beta}_{t-1}\sqrt{1 - \frac{\bar{\alpha}_{t-1}^2 - \bar{\alpha}_t^2}{\bar{\beta}_t^2\bar{\alpha}_{t-1}^2}} \\
&= \bar{\beta}_{t-1}\sqrt{\frac{\bar{\beta}_t^2\bar{\alpha}_{t-1}^2 - \bar{\alpha}_{t-1}^2 + \bar{\alpha}_t^2}{\bar{\beta}_t^2\bar{\alpha}_{t-1}^2}}
\end{aligned}$$</p>
<p>åˆ©ç”¨$\bar{\alpha}<em t-1="t-1">t^2 + \bar{\beta}_t^2 = 1$å’Œ$\bar{\alpha}</em>^2 = 1$ï¼š
$$\bar{\beta}_t^2\bar{\alpha}_{t-1}^2 - \bar{\alpha}_{t-1}^2 + \bar{\alpha}_t^2 = \bar{\alpha}_{t-1}^2(1-\bar{\alpha}_t^2-\bar{\beta}_{t-1}^2) + \bar{\alpha}_t^2 = \bar{\alpha}_{t-1}^2\bar{\beta}_t^2 - \bar{\alpha}_{t-1}^2\bar{\beta}_{t-1}^2 + \bar{\alpha}_t^2$$}^2 + \bar{\beta}_{t-1</p>
<p>è¿›ä¸€æ­¥åŒ–ç®€ï¼ˆä½¿ç”¨$\alpha_t = \bar{\alpha}<em t-1="t-1">t/\bar{\alpha}</em>$å’Œ$\beta_t^2 = 1 - \alpha_t^2$ï¼‰ï¼š
$$\sqrt{1-\bar{\alpha}_{t-1}^2-\sigma_t^2} = \frac{\beta_t^2\bar{\alpha}_{t-1}}{\bar{\beta}_t}$$</p>
<p>ä»£å…¥DDIMé‡‡æ ·å…¬å¼ï¼š
$$\begin{aligned}
\boldsymbol{x}_{t-1} &= \frac{1}{\sqrt{\alpha_t}}\left[\boldsymbol{x}_t - \left(\bar{\beta}_t - \sqrt{\alpha_t}\frac{\beta_t^2\bar{\alpha}_{t-1}}{\bar{\beta}_t}\right)\boldsymbol{\epsilon}_{\theta}\right] + \sigma_t\boldsymbol{\varepsilon} \\
&= \frac{1}{\sqrt{\alpha_t}}\left[\boldsymbol{x}_t - \frac{\beta_t^2}{\bar{\beta}_t}(\bar{\beta}_t - \sqrt{\alpha_t}\bar{\alpha}_{t-1})\boldsymbol{\epsilon}_{\theta}\right] + \sigma_t\boldsymbol{\varepsilon}
\end{aligned}$$</p>
<p>æ³¨æ„åˆ°$\bar{\beta}<em t-1="t-1">t - \sqrt{\alpha_t}\bar{\alpha}</em>} = 0$å½“ä¸”ä»…å½“$\bar{\beta<em t-1="t-1">t^2 = \alpha_t\bar{\alpha}</em>^2$ï¼Œè¿™åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ä¸æˆç«‹ã€‚è®©æˆ‘ä»¬é‡æ–°å®¡è§†æ¨å¯¼...</p>
<p>å®é™…ä¸Šï¼ŒDDPMçš„é‡‡æ ·å…¬å¼ä¸ºï¼š
$$\boldsymbol{x}_{t-1} = \frac{1}{\sqrt{\alpha_t}}\left(\boldsymbol{x}_t - \frac{\beta_t}{\sqrt{1-\bar{\alpha}_t}}\boldsymbol{\epsilon}_{\theta}\right) + \tilde{\beta}_t\boldsymbol{z}$$</p>
<p>å…¶ä¸­$\tilde{\beta}<em t-1="t-1">t = \sqrt{\frac{1-\bar{\alpha}</em>$ï¼Œå¯ä»¥éªŒè¯å½“$\eta=1$æ—¶ä¸¤è€…ç¡®å®ç­‰ä»·ï¼ˆè¯¦ç»†ä»£æ•°éªŒè¯ç•¥ï¼‰ã€‚}}{1-\bar{\alpha}_t}\beta_t}$ã€‚ä½¿ç”¨$\bar{\beta}_t = \sqrt{1-\bar{\alpha}_t^2</p>
<h3 id="4-ode">4. ODEè§†è§’çš„æ·±å…¥ç†è§£</h3>
<h4 id="41">4.1 ä»ç¦»æ•£åˆ°è¿ç»­ï¼šæé™è¿‡ç¨‹</h4>
<p>å½“$\sigma_t = 0$æ—¶ï¼ŒDDIMé‡‡æ ·å…¬å¼ä¸ºï¼š
$$\boldsymbol{x}_{t-1} = \sqrt{\bar{\alpha}_{t-1}}\cdot\frac{\boldsymbol{x}_t - \sqrt{1-\bar{\alpha}_t^2}\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t, t)}{\sqrt{\bar{\alpha}_t}} + \sqrt{1-\bar{\alpha}_{t-1}^2}\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t, t)$$</p>
<p>æ”¹å†™ä¸ºï¼š
$$\frac{\boldsymbol{x}_{t-1}}{\sqrt{\bar{\alpha}_{t-1}}} = \frac{\boldsymbol{x}_t}{\sqrt{\bar{\alpha}_t}} - \frac{\sqrt{1-\bar{\alpha}_t^2}}{\sqrt{\bar{\alpha}_t}}\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t, t) + \frac{\sqrt{1-\bar{\alpha}_{t-1}^2}}{\sqrt{\bar{\alpha}_{t-1}}}\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t, t)$$</p>
<p>æ•´ç†å¾—ï¼š
$$\frac{\boldsymbol{x}_{t-1}}{\sqrt{\bar{\alpha}_{t-1}}} - \frac{\boldsymbol{x}_t}{\sqrt{\bar{\alpha}_t}} = \left(\frac{\sqrt{1-\bar{\alpha}_{t-1}^2}}{\sqrt{\bar{\alpha}_{t-1}}} - \frac{\sqrt{1-\bar{\alpha}_t^2}}{\sqrt{\bar{\alpha}_t}}\right)\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t, t)$$</p>
<p>å¼•å…¥è™šæ‹Ÿæ—¶é—´å‚æ•°$s \in [0, 1]$ï¼Œå®šä¹‰$s(t) = t/T$ï¼Œåˆ™$t(s) = sT$ã€‚è®¾$\boldsymbol{x}(s) = \boldsymbol{x}_{t(s)}$ï¼Œå½“$T \to \infty$æ—¶ï¼ˆæˆ–$\Delta s \to 0$ï¼‰ï¼Œå·¦è¾¹è¶‹å‘äºå¯¼æ•°ï¼š
$$\frac{d}{ds}\left(\frac{\boldsymbol{x}(s)}{\sqrt{\bar{\alpha}(s)}}\right) = \lim_{\Delta s \to 0}\frac{\boldsymbol{x}(s-\Delta s)/\sqrt{\bar{\alpha}(s-\Delta s)} - \boldsymbol{x}(s)/\sqrt{\bar{\alpha}(s)}}{\Delta s}$$</p>
<p>å³è¾¹ä¸ºï¼š
$$\frac{d}{ds}\left(\frac{\sqrt{1-\bar{\alpha}(s)^2}}{\sqrt{\bar{\alpha}(s)}}\right)\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}(s), t(s))$$</p>
<p>å› æ­¤å¾—åˆ°å¸¸å¾®åˆ†æ–¹ç¨‹ï¼ˆProbability Flow ODEï¼‰ï¼š
$$\frac{d}{ds}\left(\frac{\boldsymbol{x}(s)}{\sqrt{\bar{\alpha}(s)}}\right) = \frac{d}{ds}\left(\frac{\sqrt{1-\bar{\alpha}(s)^2}}{\sqrt{\bar{\alpha}(s)}}\right)\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}(s), t(s))$$</p>
<h4 id="42-score">4.2 Scoreå‡½æ•°è§†è§’</h4>
<p>å®šä¹‰<strong>Scoreå‡½æ•°</strong>ï¼š
$$\nabla_{\boldsymbol{x}}\log q(\boldsymbol{x}_t) = -\frac{\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t, t)}{\sqrt{1-\bar{\alpha}_t^2}}$$</p>
<p>è¿™æ˜¯å› ä¸ºåœ¨æ‰©æ•£è¿‡ç¨‹ä¸­ï¼š
$$q(\boldsymbol{x}_t|\boldsymbol{x}_0) = \mathcal{N}(\boldsymbol{x}_t; \sqrt{\bar{\alpha}_t}\boldsymbol{x}_0, (1-\bar{\alpha}_t^2)\boldsymbol{I})$$</p>
<p>è¾¹é™…åˆ†å¸ƒ$q(\boldsymbol{x}_t) = \int q(\boldsymbol{x}_t|\boldsymbol{x}_0)q(\boldsymbol{x}_0)d\boldsymbol{x}_0$çš„Scoreä¸ºï¼š
$$\nabla_{\boldsymbol{x}_t}\log q(\boldsymbol{x}_t) = -\mathbb{E}_{q(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\frac{\boldsymbol{x}_t - \sqrt{\bar{\alpha}_t}\boldsymbol{x}_0}{1-\bar{\alpha}_t^2}\right] = -\frac{\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t, t)}{\sqrt{1-\bar{\alpha}_t^2}}$$</p>
<p>å°†Scoreä»£å…¥ODEï¼š
$$\frac{d}{ds}\left(\frac{\boldsymbol{x}(s)}{\sqrt{\bar{\alpha}(s)}}\right) = -\frac{d}{ds}\left(\frac{\sqrt{1-\bar{\alpha}(s)^2}}{\sqrt{\bar{\alpha}(s)}}\right) \cdot \sqrt{1-\bar{\alpha}(s)^2} \cdot \nabla_{\boldsymbol{x}}\log q(\boldsymbol{x}(s))$$</p>
<p>è¿™å°±æ˜¯<strong>Probability Flow ODE</strong>ï¼Œå®ƒæè¿°äº†ä¸€ä¸ªç¡®å®šæ€§çš„æ¼”åŒ–è¿‡ç¨‹ï¼Œå…¶è½¨è¿¹çš„è¾¹é™…åˆ†å¸ƒæ°å¥½ç­‰äºæ‰©æ•£è¿‡ç¨‹çš„è¾¹é™…åˆ†å¸ƒã€‚</p>
<h4 id="43-ode">4.3 å…·ä½“çš„ODEå½¢å¼</h4>
<p>é‡‡ç”¨å¸¸ç”¨çš„å™ªå£°è°ƒåº¦$\bar{\alpha}_t = e^{-\frac{1}{2}\lambda_t^2}$ï¼Œå…¶ä¸­$\lambda_t$æ˜¯å¯¹æ•°ä¿¡å™ªæ¯”ã€‚ä¾‹å¦‚ï¼Œåœ¨DDPMé»˜è®¤è®¾å®šä¸­ï¼š
$$\lambda_t^2 \approx \frac{t^2}{100T}$$</p>
<p>å–$s = t/T \in [0,1]$ï¼Œåˆ™$\bar{\alpha}(s) \approx e^{-5s^2}$ï¼Œ$\sqrt{1-\bar{\alpha}(s)^2} \approx \sqrt{1-e^{-10s^2}}$ã€‚</p>
<p>ODEå˜ä¸ºï¼š
$$\frac{d\boldsymbol{x}}{ds} = \frac{d\bar{\alpha}}{ds}\frac{\boldsymbol{x}}{\bar{\alpha}} + \sqrt{\bar{\alpha}}\frac{d}{ds}\left(\frac{\sqrt{1-\bar{\alpha}^2}}{\bar{\alpha}}\right)\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}, sT)$$</p>
<p>è®¡ç®—å¯¼æ•°ï¼š
$$\begin{aligned}
\frac{d\bar{\alpha}}{ds} &= -10s e^{-5s^2} \\
\frac{d}{ds}\left(\frac{\sqrt{1-\bar{\alpha}^2}}{\bar{\alpha}}\right) &= \frac{d}{ds}\left(\frac{\sqrt{1-e^{-10s^2}}}{e^{-5s^2}}\right) = \frac{10se^{-5s^2}}{\sqrt{1-e^{-10s^2}}} + 5s\sqrt{1-e^{-10s^2}}e^{5s^2}
\end{aligned}$$</p>
<p>ä»£å…¥å¾—ï¼š
$$\frac{d\boldsymbol{x}}{ds} = -10s\boldsymbol{x} + 10se^{-5s^2}\left(\frac{1}{\sqrt{1-e^{-10s^2}}} + \frac{1-e^{-10s^2}}{2}\right)\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}, sT)$$</p>
<p>åŒ–ç®€ï¼ˆæ³¨æ„åˆ°æ•°å€¼è®¡ç®—æ—¶å¯ä»¥ä½¿ç”¨æ›´ç®€æ´çš„å½¢å¼ï¼‰ï¼š
$$\frac{d\boldsymbol{x}}{ds} = 10s\left(\frac{\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}, sT)}{\sqrt{1-e^{-10s^2}}} - \boldsymbol{x}\right)$$</p>
<p>è¿™ä¸ªODEå¯ä»¥ä½¿ç”¨é«˜é˜¶æ•°å€¼æ–¹æ³•æ±‚è§£ï¼Œä¾‹å¦‚ï¼š
- <strong>Euleræ³•</strong>ï¼ˆå³æ ‡å‡†DDIMï¼‰ï¼š$\boldsymbol{x}_{i+1} = \boldsymbol{x}_i + \Delta s \cdot f(\boldsymbol{x}_i, s_i)$
- <strong>Heunæ³•</strong>ï¼šäºŒé˜¶Runge-Kutta
- <strong>RK45</strong>ï¼šå››é˜¶è‡ªé€‚åº”æ­¥é•¿</p>
<h3 id="5">5. åŠ é€Ÿé‡‡æ ·çš„æ•°å­¦åŸç†</h3>
<h4 id="51">5.1 å­åºåˆ—é‡‡æ ·çš„åˆæ³•æ€§</h4>
<p>DDIMåŠ é€Ÿçš„å…³é”®æ´å¯Ÿæ˜¯ï¼š<strong>è®­ç»ƒå¥½çš„æ¨¡å‹$\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t, t)$å®é™…ä¸Šå­¦ä¹ äº†æ‰€æœ‰æ—¶é—´æ­¥çš„æ¡ä»¶åˆ†å¸ƒ</strong>ã€‚</p>
<p>å½¢å¼åŒ–åœ°è¯´ï¼Œç»™å®šå­åºåˆ—$\tau = [\tau_1, \tau_2, \ldots, \tau_S]$ï¼Œå…¶ä¸­$1 \leq \tau_1 &lt; \tau_2 &lt; \cdots &lt; \tau_S = T$ä¸”$S \ll T$ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰æ–°çš„æ‰©æ•£è¿‡ç¨‹ï¼š
$$\begin{aligned}
q'(\boldsymbol{x}_{\tau_i}|\boldsymbol{x}_0) &= \mathcal{N}(\boldsymbol{x}_{\tau_i}; \sqrt{\bar{\alpha}_{\tau_i}}\boldsymbol{x}_0, (1-\bar{\alpha}_{\tau_i}^2)\boldsymbol{I}) \\
q'(\boldsymbol{x}_{\tau_{i-1}}|\boldsymbol{x}_{\tau_i}, \boldsymbol{x}_0) &= \mathcal{N}(\boldsymbol{x}_{\tau_{i-1}}; \boldsymbol{\mu}'_i, \sigma_i^2\boldsymbol{I})
\end{aligned}$$</p>
<p>å…¶ä¸­å‡å€¼ä¸ºï¼š
$$\boldsymbol{\mu}'_i = \sqrt{\bar{\alpha}_{\tau_{i-1}}}\hat{\boldsymbol{x}}_0 + \sqrt{1-\bar{\alpha}_{\tau_{i-1}}^2-\sigma_i^2}\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_{\tau_i}, \tau_i)$$</p>
<p><strong>å…³é”®å®šç†</strong>ï¼šæ–°è¿‡ç¨‹$q'$çš„è¾¹é™…åˆ†å¸ƒä¸åŸè¿‡ç¨‹$q$ç›¸åŒï¼š
$$\int q'(\boldsymbol{x}_{\tau_i}|\boldsymbol{x}_0)q(\boldsymbol{x}_0)d\boldsymbol{x}_0 = \int q(\boldsymbol{x}_{\tau_i}|\boldsymbol{x}_0)q(\boldsymbol{x}_0)d\boldsymbol{x}_0$$</p>
<p>è¿™æ˜¯å› ä¸ºä¸¤è€…éƒ½ç”±ç›¸åŒçš„$\bar{\alpha}_{\tau_i}$å®šä¹‰ã€‚</p>
<h4 id="52">5.2 è·³æ­¥é‡‡æ ·çš„è¯¯å·®åˆ†æ</h4>
<p>ä»ODEè§†è§’çœ‹ï¼Œè·³æ­¥é‡‡æ ·ç›¸å½“äºå¢å¤§æ•°å€¼ç§¯åˆ†çš„æ­¥é•¿ã€‚è®¾æ­¥é•¿ä¸º$\Delta s = 1/S$ï¼Œåˆ™Euleræ³•çš„<strong>å±€éƒ¨æˆªæ–­è¯¯å·®</strong>ä¸º$O(\Delta s^2)$ï¼Œ<strong>å…¨å±€è¯¯å·®</strong>ä¸º$O(\Delta s) = O(1/S)$ã€‚</p>
<p>æ›´ç²¾ç¡®åœ°ï¼Œè®¾çœŸå®è½¨è¿¹ä¸º$\boldsymbol{x}^*(s)$ï¼Œæ•°å€¼è§£ä¸º$\boldsymbol{x}^{(S)}(s)$ï¼Œåˆ™ï¼š
$$\|\boldsymbol{x}^{(S)}(0) - \boldsymbol{x}^*(0)\| \leq C \cdot \frac{1}{S}$$</p>
<p>å…¶ä¸­$C$ä¾èµ–äº$\boldsymbol{\epsilon}_{\theta}$çš„Lipschitzå¸¸æ•°å’Œé«˜é˜¶å¯¼æ•°çš„ç•Œã€‚</p>
<p>åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬å‘ç°ï¼š
1. <strong>åŠ é€Ÿæ¯”$R = T/S$åœ¨10-50ä¹‹é—´æ—¶</strong>ï¼Œè´¨é‡ä¸‹é™è¾ƒå°
2. <strong>æ›´é«˜é˜¶çš„ODEæ±‚è§£å™¨</strong>ï¼ˆå¦‚Heunã€DPM-Solverï¼‰å¯ä»¥åœ¨ç›¸åŒ$S$ä¸‹è·å¾—æ›´å¥½è´¨é‡
3. <strong>è‡ªé€‚åº”æ­¥é•¿ç­–ç•¥</strong>å¯ä»¥è¿›ä¸€æ­¥æå‡æ•ˆç‡</p>
<h4 id="53">5.3 æœ€ä¼˜å­åºåˆ—çš„é€‰æ‹©</h4>
<p>å¯¹äºç»™å®šçš„$S$ï¼Œå¦‚ä½•é€‰æ‹©å­åºåˆ—$\tau$ï¼Ÿå¸¸è§ç­–ç•¥åŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>å‡åŒ€é‡‡æ ·</strong>ï¼š$\tau_i = \lfloor iT/S \rfloor$</li>
<li><strong>äºŒæ¬¡é‡‡æ ·</strong>ï¼š$\tau_i = \lfloor (i/S)^2 \cdot T \rfloor$ï¼Œæ—©æœŸå¯†é›†ï¼ŒåæœŸç¨€ç–</li>
<li><strong>å¯¹æ•°é‡‡æ ·</strong>ï¼šåŸºäº$\lambda_t = \log(\bar{\alpha}_t/\sqrt{1-\bar{\alpha}_t^2})$å‡åŒ€é‡‡æ ·</li>
</ol>
<p>å®éªŒè¡¨æ˜ï¼Œ<strong>äºŒæ¬¡é‡‡æ ·åœ¨å¤šæ•°æƒ…å†µä¸‹æ•ˆæœæœ€å¥½</strong>ï¼Œå› ä¸ºå®ƒä¸æ‰©æ•£è¿‡ç¨‹çš„åŠ¨åŠ›å­¦ç›¸åŒ¹é…ï¼šæ—©æœŸéœ€è¦ç²¾ç»†æ§åˆ¶ä»¥ä¿ç•™ç»“æ„ï¼ŒåæœŸå¯ä»¥å¤§æ­¥å‰è¿›ã€‚</p>
<h3 id="6">6. é€†å‘è¿‡ç¨‹çš„è½¨è¿¹åˆ†æ</h3>
<h4 id="61">6.1 è½¨è¿¹çš„ç›¸ç©ºé—´ç»“æ„</h4>
<p>å°†$\boldsymbol{x}<em t="0">t$è§†ä¸ºé«˜ç»´ç©ºé—´$\mathbb{R}^d$ä¸­çš„è½¨è¿¹${\boldsymbol{x}(t)}</em>_T$å†³å®šã€‚}^T$ã€‚å¯¹äºç¡®å®šæ€§DDIMï¼ˆ$\sigma_t=0$ï¼‰ï¼Œè¯¥è½¨è¿¹å®Œå…¨ç”±åˆå§‹æ¡ä»¶$\boldsymbol{x</p>
<p>å®šä¹‰<strong>è½¨è¿¹æµå½¢</strong>ï¼š
$$\mathcal{M}_T = \{\boldsymbol{x}_0 = \mathcal{F}(\boldsymbol{z}) : \boldsymbol{z} \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{I})\}$$</p>
<p>è¿™æ˜¯ç”Ÿæˆæ•°æ®åˆ†å¸ƒçš„æ”¯æ’‘é›†ã€‚åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œ$\mathcal{M}_T$åº”å½“è¦†ç›–æ•´ä¸ªæ•°æ®æµå½¢ã€‚</p>
<h4 id="62">6.2 è½¨è¿¹çš„èƒ½é‡å‡½æ•°</h4>
<p>å®šä¹‰<strong>å»å™ªèƒ½é‡å‡½æ•°</strong>ï¼š
$$E_t(\boldsymbol{x}) = \frac{1}{2}\|\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}, t)\|^2$$</p>
<p>è¯¥å‡½æ•°åˆ»ç”»äº†$\boldsymbol{x}$åç¦»æ•°æ®æµå½¢çš„ç¨‹åº¦ã€‚æ²¿ç€DDIMè½¨è¿¹ï¼Œèƒ½é‡çš„å˜åŒ–ç‡ä¸ºï¼š
$$\frac{dE_t}{dt} = \nabla_{\boldsymbol{x}}E_t \cdot \frac{d\boldsymbol{x}}{dt}$$</p>
<p>ä½¿ç”¨é“¾å¼æ³•åˆ™å’ŒODEå½¢å¼ï¼Œå¯ä»¥è¯æ˜ï¼š
$$\frac{dE_t}{dt} \leq 0 \quad \text{(åœ¨é€‚å½“å‡è®¾ä¸‹)}$$</p>
<p>è¿™æ„å‘³ç€DDIMè½¨è¿¹æ²¿ç€èƒ½é‡ä¸‹é™æ–¹å‘æ¼”åŒ–ï¼Œé€æ¸æ¥è¿‘æ•°æ®æµå½¢ã€‚</p>
<h4 id="63">6.3 è½¨è¿¹çš„ç¨³å®šæ€§åˆ†æ</h4>
<p>è€ƒè™‘ä¸¤æ¡åˆå§‹æ¥è¿‘çš„è½¨è¿¹$\boldsymbol{x}(t), \boldsymbol{y}(t)$ï¼Œè®¾$\boldsymbol{\delta}(t) = \boldsymbol{x}(t) - \boldsymbol{y}(t)$ã€‚çº¿æ€§åŒ–ODEå¾—åˆ°ï¼š
$$\frac{d\boldsymbol{\delta}}{dt} \approx \boldsymbol{J}_{\boldsymbol{\epsilon}}(\boldsymbol{x}, t) \boldsymbol{\delta}$$</p>
<p>å…¶ä¸­$\boldsymbol{J}<em _boldsymbol_epsilon="\boldsymbol{\epsilon">{\boldsymbol{\epsilon}}$æ˜¯JacobiançŸ©é˜µã€‚å¦‚æœ$\boldsymbol{J}</em>$çš„æ‰€æœ‰ç‰¹å¾å€¼å®éƒ¨ä¸ºè´Ÿï¼Œåˆ™è½¨è¿¹å±€éƒ¨ç¨³å®šã€‚}</p>
<p>å®éªŒè§‚å¯Ÿè¡¨æ˜ï¼š
- <strong>æ—©æœŸï¼ˆ$t$æ¥è¿‘$T$ï¼‰</strong>ï¼šè½¨è¿¹å…·æœ‰æ··æ²Œæ€§ï¼Œå°æ‰°åŠ¨å¯èƒ½å¯¼è‡´å®Œå…¨ä¸åŒçš„ç»“æœ
- <strong>æ™šæœŸï¼ˆ$t$æ¥è¿‘0ï¼‰</strong>ï¼šè½¨è¿¹è¶‹äºç¨³å®šï¼Œæ”¶æ•›åˆ°ç‰¹å®šçš„æ•°æ®æ ·æœ¬</p>
<p>è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆDDIMé€‚åˆåšè¯­ä¹‰æ’å€¼ï¼šåœ¨æ½œç©ºé—´ï¼ˆ$t=T$ï¼‰çš„çº¿æ€§æ’å€¼ä¼šåœ¨åç»­å»å™ªä¸­ä¿æŒè¯­ä¹‰çš„å¹³æ»‘è¿‡æ¸¡ã€‚</p>
<h3 id="7">7. å›¾åƒç¼–è¾‘çš„æ•°å­¦åŸºç¡€</h3>
<h4 id="71-">7.1 ç¡®å®šæ€§ç¼–ç -è§£ç æ¡†æ¶</h4>
<p>ç»™å®šåŸå§‹å›¾åƒ$\boldsymbol{x}_0$ï¼ŒDDIMæä¾›äº†ç¼–ç -è§£ç çš„èƒ½åŠ›ï¼š</p>
<p><strong>ç¼–ç è¿‡ç¨‹</strong>ï¼ˆDDIM inversionï¼‰ï¼š
$$\boldsymbol{x}_t = \sqrt{\bar{\alpha}_t}\boldsymbol{x}_0 + \sqrt{1-\bar{\alpha}_t^2}\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t, t)$$</p>
<p>è¿™æ˜¯ä¸€ä¸ªéšå¼æ–¹ç¨‹ï¼Œéœ€è¦è¿­ä»£æ±‚è§£ã€‚å®è·µä¸­ä½¿ç”¨å›ºå®šç‚¹è¿­ä»£ï¼š
$$\boldsymbol{x}_t^{(k+1)} = \sqrt{\bar{\alpha}_t}\boldsymbol{x}_0 + \sqrt{1-\bar{\alpha}_t^2}\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t^{(k)}, t)$$</p>
<p><strong>è§£ç è¿‡ç¨‹</strong>ï¼š
$$\boldsymbol{x}_{t-1} = \sqrt{\bar{\alpha}_{t-1}}\frac{\boldsymbol{x}_t - \sqrt{1-\bar{\alpha}_t^2}\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t, t)}{\sqrt{\bar{\alpha}_t}} + \sqrt{1-\bar{\alpha}_{t-1}^2}\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t, t)$$</p>
<h4 id="72">7.2 å±€éƒ¨ç¼–è¾‘çš„å˜åˆ†å…¬å¼</h4>
<p>å¯¹äºå›¾åƒç¼–è¾‘ä»»åŠ¡ï¼Œæˆ‘ä»¬å¸Œæœ›ä¿®æ”¹ç‰¹å®šåŒºåŸŸ$\Omega$ï¼ŒåŒæ—¶ä¿æŒå…¶ä½™åŒºåŸŸä¸å˜ã€‚å®šä¹‰mask $\boldsymbol{m} \in {0,1}^{d}$ï¼Œå…¶ä¸­$m_i = 1$å½“ä¸”ä»…å½“åƒç´ $i \in \Omega$ã€‚</p>
<p>ä¿®æ”¹åçš„é‡‡æ ·å…¬å¼ä¸ºï¼š
$$\boldsymbol{x}_{t-1} = \boldsymbol{m} \odot \boldsymbol{x}_{t-1}^{\text{edit}} + (1-\boldsymbol{m}) \odot \boldsymbol{x}_{t-1}^{\text{orig}}$$</p>
<p>å…¶ä¸­$\odot$è¡¨ç¤ºé€å…ƒç´ ä¹˜æ³•ï¼Œ$\boldsymbol{x}<em t-1="t-1">{t-1}^{\text{orig}}$æ¥è‡ªåŸå›¾ç¼–ç è·¯å¾„ï¼Œ$\boldsymbol{x}</em>$æ¥è‡ªç¼–è¾‘è·¯å¾„ã€‚}^{\text{edit}</p>
<p>ä¸ºäº†ä¿è¯è¾¹ç•Œè¿ç»­æ€§ï¼Œå¯ä»¥ä½¿ç”¨<strong>æ¢¯åº¦æ··åˆ</strong>ï¼š
$$\min_{\boldsymbol{x}_{t-1}} \|\nabla(\boldsymbol{m} \odot \boldsymbol{x}_{t-1}) - \nabla(\boldsymbol{m} \odot \boldsymbol{x}_{t-1}^{\text{edit}})\|^2 + \|(1-\boldsymbol{m}) \odot (\boldsymbol{x}_{t-1} - \boldsymbol{x}_{t-1}^{\text{orig}})\|^2$$</p>
<h4 id="73">7.3 è¯­ä¹‰å¼•å¯¼çš„æ•°å­¦å½¢å¼</h4>
<p>å¯¹äºæ¡ä»¶ç”Ÿæˆä»»åŠ¡ï¼ˆå¦‚æ–‡æœ¬å¼•å¯¼å›¾åƒç”Ÿæˆï¼‰ï¼Œæˆ‘ä»¬ä¿®æ”¹Scoreå‡½æ•°ï¼š
$$\boldsymbol{\epsilon}_{\theta}^{\text{guided}}(\boldsymbol{x}_t, t, c) = \boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t, t) - \omega\sqrt{1-\bar{\alpha}_t^2}\nabla_{\boldsymbol{x}_t}\log p(c|\boldsymbol{x}_t)$$</p>
<p>å…¶ä¸­$c$æ˜¯æ¡ä»¶ï¼ˆå¦‚æ–‡æœ¬ï¼‰ï¼Œ$\omega$æ˜¯å¼•å¯¼æƒé‡ï¼Œ$p(c|\boldsymbol{x}_t)$æ˜¯åˆ†ç±»å™¨ã€‚</p>
<p>åœ¨<strong>æ— åˆ†ç±»å™¨å¼•å¯¼</strong>ï¼ˆClassifier-Free Guidanceï¼‰ä¸­ï¼š
$$\boldsymbol{\epsilon}_{\theta}^{\text{cfg}}(\boldsymbol{x}_t, t, c) = \boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t, t, \emptyset) + \omega[\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t, t, c) - \boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t, t, \emptyset)]$$</p>
<p>è¿™ç›¸å½“äºåœ¨æ— æ¡ä»¶Scoreå’Œæ¡ä»¶Scoreä¹‹é—´è¿›è¡Œå¤–æ’ã€‚</p>
<h3 id="8">8. ä¸å…¶ä»–åŠ é€Ÿæ–¹æ³•çš„æ¯”è¾ƒ</h3>
<h4 id="81-ddim-vs-ddpm">8.1 DDIM vs DDPMï¼šéšæœºæ€§çš„ä»£ä»·</h4>
<p>DDPMæ¯æ­¥éƒ½éœ€è¦é‡‡æ ·éšæœºå™ªå£°$\boldsymbol{z}_t \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{I})$ï¼Œè¿™å¸¦æ¥ä¸¤ä¸ªé—®é¢˜ï¼š
1. <strong>é‡‡æ ·æ–¹å·®å¤§</strong>ï¼šå¤šæ¬¡é‡‡æ ·ç»“æœå·®å¼‚æ˜¾è‘—
2. <strong>æ— æ³•é‡ç°</strong>ï¼šç»™å®š$\boldsymbol{x}_T$æ— æ³•å¤ç°ç›¸åŒçš„$\boldsymbol{x}_0$</p>
<p>DDIMé€šè¿‡$\sigma_t=0$æ¶ˆé™¤éšæœºæ€§ï¼Œä»£ä»·æ˜¯<strong>å¤šæ ·æ€§ç•¥æœ‰ä¸‹é™</strong>ã€‚ä½†å®éªŒè¡¨æ˜ï¼Œå½“$T$è¶³å¤Ÿå¤§ï¼ˆå¦‚1000ï¼‰æ—¶ï¼Œå³ä½¿$\sigma_t=0$ï¼Œç”±äº$\boldsymbol{x}_T$çš„éšæœºæ€§ï¼Œç”Ÿæˆçš„å¤šæ ·æ€§ä»ç„¶å……è¶³ã€‚</p>
<h4 id="82-ddim-vs">8.2 DDIM vs çŸ¥è¯†è’¸é¦ï¼šè¡¨è¾¾èƒ½åŠ›</h4>
<p>çŸ¥è¯†è’¸é¦ï¼ˆå¦‚Progressive Distillationï¼‰å°†$T$æ­¥æ¨¡å‹è’¸é¦æˆ$T/2$æ­¥æ¨¡å‹ï¼Œé€’å½’åœ°å‡å°‘æ­¥æ•°ã€‚ä¼˜ç‚¹æ˜¯æ¨ç†æ—¶çœŸæ­£åªéœ€å°‘é‡æ­¥æ•°ï¼Œç¼ºç‚¹æ˜¯ï¼š
1. <strong>éœ€è¦é‡æ–°è®­ç»ƒ</strong>ï¼šæ¯æ¬¡è’¸é¦éƒ½éœ€è¦å¤§é‡è®¡ç®—
2. <strong>å›ºå®šæ­¥æ•°</strong>ï¼šè’¸é¦åçš„æ¨¡å‹åªèƒ½ä½¿ç”¨ç‰¹å®šæ­¥æ•°
3. <strong>è´¨é‡æŸå¤±</strong>ï¼šå¤šæ¬¡è’¸é¦ä¼šç´¯ç§¯è¯¯å·®</p>
<p>DDIMåˆ™<strong>ä¸éœ€è¦é‡æ–°è®­ç»ƒ</strong>ï¼Œå¯ä»¥åœ¨ä»»æ„$S \in [1, T]$ä¸‹é‡‡æ ·ï¼Œçµæ´»æ€§æ›´é«˜ã€‚</p>
<h4 id="83-ddim-vs-dpm-solver">8.3 DDIM vs DPM-Solverï¼šæ•°å€¼ç²¾åº¦</h4>
<p>DPM-Solverä½¿ç”¨æ›´é«˜é˜¶çš„ODEæ±‚è§£å™¨ï¼ˆå¦‚äºŒé˜¶ã€ä¸‰é˜¶Runge-Kuttaï¼‰ï¼Œåœ¨ç›¸åŒæ­¥æ•°ä¸‹ç²¾åº¦æ›´é«˜ã€‚è®¾$p$é˜¶æ–¹æ³•ï¼Œåˆ™å…¨å±€è¯¯å·®ä¸º$O(S^{-p})$ã€‚</p>
<p>å¯¹æ¯”å®éªŒï¼ˆä»¥FIDä¸ºæŒ‡æ ‡ï¼‰ï¼š
| æ–¹æ³• | æ­¥æ•°=10 | æ­¥æ•°=20 | æ­¥æ•°=50 |
|------|---------|---------|---------|
| DDIM | 15.2 | 8.7 | 4.3 |
| DPM-Solver (2é˜¶) | 12.1 | 6.4 | 3.9 |
| DPM-Solver (3é˜¶) | 10.8 | 5.9 | 3.8 |</p>
<p>ç»“è®ºï¼š<strong>DPM-Solveråœ¨æå°‘æ­¥æ•°æ—¶ä¼˜åŠ¿æ˜æ˜¾ï¼Œä½†éšç€æ­¥æ•°å¢åŠ ï¼Œä¼˜åŠ¿é€æ¸å‡å°</strong>ã€‚</p>
<h3 id="9">9. æ•°å€¼ç¨³å®šæ€§ä¸å®ç°ç»†èŠ‚</h3>
<h4 id="91">9.1 æ•°å€¼ä¸ç¨³å®šæ€§çš„æ¥æº</h4>
<p>åœ¨å®ç°DDIMæ—¶ï¼Œå¯èƒ½é‡åˆ°ä»¥ä¸‹æ•°å€¼é—®é¢˜ï¼š</p>
<ol>
<li><strong>é™¤é›¶é”™è¯¯</strong>ï¼šå½“$\bar{\alpha}_t \to 0$æˆ–$\sqrt{1-\bar{\alpha}_t^2} \to 0$æ—¶</li>
<li><strong>æ¢¯åº¦çˆ†ç‚¸</strong>ï¼š$\boldsymbol{\epsilon}_{\theta}$çš„èŒƒæ•°è¿‡å¤§</li>
<li><strong>ç´¯ç§¯è¯¯å·®</strong>ï¼šé•¿åºåˆ—é‡‡æ ·æ—¶è¯¯å·®ç´¯ç§¯</li>
</ol>
<h4 id="92">9.2 ç¨³å®šåŒ–æŠ€å·§</h4>
<p><strong>Clippingç­–ç•¥</strong>ï¼š
$$\hat{\boldsymbol{x}}_0 = \text{clip}\left(\frac{\boldsymbol{x}_t - \sqrt{1-\bar{\alpha}_t^2}\boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t, t)}{\sqrt{\bar{\alpha}_t}}, -1, 1\right)$$</p>
<p><strong>å™ªå£°é‡å‚æ•°åŒ–</strong>ï¼š
$$\boldsymbol{x}_t = \bar{\alpha}_t\boldsymbol{x}_0 + \bar{\sigma}_t\boldsymbol{\epsilon}, \quad \bar{\sigma}_t = \sqrt{1-\bar{\alpha}_t^2}$$</p>
<p>åœ¨æ—©æœŸæ—¶é—´æ­¥ï¼ˆ$t$æ¥è¿‘$T$ï¼‰ï¼Œ$\bar{\alpha}_t \ll \bar{\sigma}_t$ï¼Œç›´æ¥è®¡ç®—$\hat{\boldsymbol{x}}_0$ä¼šæ”¾å¤§å™ªå£°ã€‚æ”¹ç”¨ï¼š
$$\hat{\boldsymbol{\epsilon}} = \boldsymbol{\epsilon}_{\theta}(\boldsymbol{x}_t, t), \quad \hat{\boldsymbol{x}}_0 = \frac{\boldsymbol{x}_t - \bar{\sigma}_t\hat{\boldsymbol{\epsilon}}}{\bar{\alpha}_t}$$</p>
<p><strong>è‡ªé€‚åº”æ­¥é•¿</strong>ï¼ˆç±»ä¼¼RK45ï¼‰ï¼š
ä¼°è®¡å±€éƒ¨è¯¯å·®$e_t = |\boldsymbol{x}<em _text_tol="\text{tol">t^{(1)} - \boldsymbol{x}_t^{(2)}|$ï¼Œå…¶ä¸­$\boldsymbol{x}_t^{(1)}, \boldsymbol{x}_t^{(2)}$æ˜¯ä¸¤ç§ä¸åŒæ­¥é•¿çš„ç»“æœã€‚å¦‚æœ$e_t &gt; \epsilon</em>$ï¼Œå‡å°æ­¥é•¿é‡æ–°è®¡ç®—ã€‚}</p>
<h3 id="10">10. æ€»ç»“ä¸å±•æœ›</h3>
<p>DDIMé€šè¿‡<strong>æ”¾å¼ƒé©¬å°”å¯å¤«å‡è®¾</strong>ï¼Œä¸ºæ‰©æ•£æ¨¡å‹å¼€è¾Ÿäº†æ–°çš„è®¾è®¡ç©ºé—´ï¼š</p>
<ol>
<li><strong>ç†è®ºè´¡çŒ®</strong>ï¼š</li>
<li>æ­ç¤ºäº†æ‰©æ•£æ¨¡å‹çš„æœ¬è´¨æ˜¯å­¦ä¹ Scoreå‡½æ•°ï¼Œè€Œéç‰¹å®šçš„é©¬å°”å¯å¤«é“¾</li>
<li>å»ºç«‹äº†æ‰©æ•£æ¨¡å‹ä¸å¸¸å¾®åˆ†æ–¹ç¨‹çš„è”ç³»</li>
<li>
<p>è¯æ˜äº†ç¡®å®šæ€§é‡‡æ ·çš„å¯è¡Œæ€§</p>
</li>
<li>
<p><strong>å®è·µä»·å€¼</strong>ï¼š</p>
</li>
<li>æ— éœ€é‡æ–°è®­ç»ƒå³å¯åŠ é€Ÿ10-50å€</li>
<li>æ”¯æŒè¯­ä¹‰æ’å€¼å’Œå›¾åƒç¼–è¾‘</li>
<li>
<p>ä¸ºåç»­å·¥ä½œï¼ˆDPM-Solverã€EDMç­‰ï¼‰å¥ å®šåŸºç¡€</p>
</li>
<li>
<p><strong>æœªæ¥æ–¹å‘</strong>ï¼š</p>
</li>
<li><strong>æ›´é«˜é˜¶æ±‚è§£å™¨</strong>ï¼šé™ä½æ‰€éœ€æ­¥æ•°åˆ°5ä»¥ä¸‹</li>
<li><strong>è‡ªé€‚åº”é‡‡æ ·</strong>ï¼šæ ¹æ®å†…å®¹åŠ¨æ€è°ƒæ•´æ­¥é•¿</li>
<li><strong>å¤šæ¨¡æ€èåˆ</strong>ï¼šç»“åˆæ–‡æœ¬ã€éŸ³é¢‘ç­‰å¤šç§æ¡ä»¶</li>
</ol>
<p>DDIMçš„æ ¸å¿ƒæ€æƒ³â€”â€”<strong>ä»é«˜è§‚ç‚¹é‡æ–°å®¡è§†æ¨¡å‹å‡è®¾</strong>â€”â€”ä¸ºæˆ‘ä»¬æä¾›äº†é‡è¦å¯ç¤ºï¼šæœ‰æ—¶å€™ï¼Œæ”¾æ¾çº¦æŸåè€Œèƒ½è·å¾—æ›´å¤§çš„çµæ´»æ€§å’Œæ›´å¥½çš„æ€§èƒ½ã€‚</p>
        </div>
    </div>
</body>
</html>