<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»JLå¼•ç†çœ‹ç†µä¸å˜æ€§Attention</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>ä»JLå¼•ç†çœ‹ç†µä¸å˜æ€§Attention</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-26 | ğŸ“„ å¤§å°: 26.5 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/9588">https://spaces.ac.cn/archives/9588</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>åœ¨<a href="/archives/8823">ã€Šä»ç†µä¸å˜æ€§çœ‹Attentionçš„Scaleæ“ä½œã€‹</a>ã€<a href="/archives/9034">ã€Šç†µä¸å˜æ€§Softmaxçš„ä¸€ä¸ªå¿«é€Ÿæ¨å¯¼ã€‹</a>ä¸­ç¬”è€…æå‡ºäº†ç†µä¸å˜æ€§Softmaxï¼Œç®€å•æ¥è¯´å°±æ˜¯å¾€Softmaxä¹‹å‰çš„AttentionçŸ©é˜µå¤šä¹˜ä¸Šä¸€ä¸ª$\log n$ï¼Œç†è®ºä¸Šæœ‰åŠ©äºå¢å¼ºé•¿åº¦å¤–æ¨æ€§ï¼Œå…¶ä¸­$n$æ˜¯åºåˆ—é•¿åº¦ã€‚$\log n$è¿™ä¸ªå› å­è®©ç¬”è€…è”ç³»åˆ°äº†JLå¼•ç†ï¼ˆ<a href="/archives/8679">Johnson-Lindenstrausså¼•ç†</a>ï¼‰ï¼Œå› ä¸ºJLå¼•ç†å‘Šè¯‰æˆ‘ä»¬ç¼–ç $n$ä¸ªå‘é‡åªéœ€è¦$\mathcal{O}(\log n)$çš„ç»´åº¦å°±è¡Œäº†ï¼Œå¤§å®¶éƒ½æ˜¯$\log n$ï¼Œè¿™ä¸¤è€…æœ‰æ²¡æœ‰ä»€ä¹ˆå…³è”å‘¢ï¼Ÿ</p>
<h2 id="_1">ç†µä¸å˜æ€§</h2>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œç†µæ˜¯ä¸ç¡®å®šæ€§çš„åº¦é‡ï¼Œç”¨åœ¨æ³¨æ„åŠ›æœºåˆ¶ä¸­ï¼Œæˆ‘ä»¬å°†å®ƒä½œä¸ºâ€œé›†ä¸­æ³¨æ„åŠ›çš„ç¨‹åº¦â€ã€‚æ‰€è°“ç†µä¸å˜æ€§ï¼ŒæŒ‡çš„æ˜¯ä¸ç®¡åºåˆ—é•¿åº¦$n$æ˜¯å¤šå°‘ï¼Œæˆ‘ä»¬éƒ½è¦å°†æ³¨æ„åŠ›é›†ä¸­åœ¨å…³é”®çš„å‡ ä¸ªtokenä¸Šï¼Œè€Œä¸è¦å¤ªè¿‡åˆ†æ•£ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬æå‡ºçš„ç†µä¸å˜æ€§Attentionå½¢å¼ä¸º<br />
\begin{equation}Attention(Q,K,V) = softmax\left(\frac{\log_{512} n}{\sqrt{d}}QK^{\top}\right)V\label{eq:core}\end{equation}<br />
è¿™é‡Œ$Q,K\in\mathbb{R}^{n\times d}$ã€‚è·Ÿå¸¸è§„çš„Attentionç›¸æ¯”ï¼Œå°±æ˜¯scaleçš„å› å­å¤šäº†ä¸ª$\log_{512} n$ï¼Œå…¶ä¸­åº•æ•°å–512ï¼Œæ˜¯å‡è®¾æˆ‘ä»¬æ‰€æœ‰çš„è¶…å‚æ•°ï¼ˆæ¯”å¦‚$d$ï¼‰éƒ½æ˜¯ä¸ºè®­ç»ƒé•¿åº¦512è°ƒå¥½çš„ã€‚å½“ç„¶ï¼Œå³ä¾¿ä½ è®¡åˆ’ä¸­çš„é¢„è®­ç»ƒé•¿åº¦ä¸æ˜¯512ï¼Œåº•æ•°ä¹Ÿå¯ä»¥ç›´æ¥æ— è„‘å–512ï¼Œç»“æœåŸºæœ¬ä¸ä¼šæœ‰ä»€ä¹ˆå½±å“ã€‚</p>
<p>è¿™ä¸ªå½¢å¼çš„åŸç†ä¹Ÿå¾ˆç›´è§‚ï¼Œå½“$n$å¢å¤§æ—¶ï¼Œæ„å‘³ç€æœ‰æ›´å¤šçš„tokenå»å¹³æ‘Šäº†æ³¨æ„åŠ›ï¼Œå¯¼è‡´æ³¨æ„åŠ›ä¸é›†ä¸­ï¼Œæ­¤æ—¶æˆ‘ä»¬ä¹˜ä¸Šä¸€ä¸ªå…³äº$n$å•è°ƒé€’å¢çš„å› å­ï¼Œsoftmaxä¹‹åå®ƒå®é™…ä¸Šå°±ç›¸å½“äºåŸæ¥æ¦‚ç‡çš„å¹‚è¿ç®—ï¼Œç”±äºæ¦‚ç‡éƒ½å°äº1ï¼Œæ‰€ä»¥æ¦‚ç‡è¶Šå°å¹‚è¿ç®—ä¹‹åä¼šå˜å¾—æ›´å°ï¼Œè¿™æ ·æ³¨æ„åŠ›é‡æ–°å˜å¾—é›†ä¸­èµ·æ¥ã€‚è‡³äºè¿™ä¸ªå› å­ä¸ºä»€ä¹ˆæ˜¯å¯¹æ•°çš„å½¢å¼ï¼Œé‚£å°±éœ€è¦çœ‹å¼€å¤´æ–‡ç« çš„æ¨å¯¼è¿‡ç¨‹äº†ã€‚</p>
<h2 id="jl">JLå¼•ç†</h2>
<p>JLå¼•ç†ï¼Œå…¨ç§°â€œJohnson-Lindenstrausså¼•ç†â€ï¼Œæ˜¯å…³äºå‘é‡åµŒå…¥çš„ä¸€ä¸ªé‡è¦ç»“è®ºï¼Œç®€å•æ¥è¯´å®ƒå°±æ˜¯å‘Šè¯‰æˆ‘ä»¬â€œè¦å¡ä¸‹$n$ä¸ªå‘é‡ï¼Œåªéœ€$\mathcal{O}(\log n)$ç»´ç©ºé—´â€ï¼ˆè¿™é‡Œçš„$\log$æ²¡æœ‰å†™å‡ºåº•æ•°ï¼Œé»˜è®¤éƒ½æ˜¯ä»¥è‡ªç„¶å¯¹æ•°$e$ä¸ºåº•ï¼‰ï¼Œè¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒ<a href="/archives/8679">ã€Šè®©äººæƒŠå¹çš„Johnson-Lindenstrausså¼•ç†ï¼šç†è®ºç¯‡ã€‹</a>ã€‚</p>
<p>æœ‰æ„æ€çš„æ˜¯ï¼Œæ—©åœ¨ç¬”è€…çŸ¥é“JLå¼•ç†ä¹‹å‰ï¼Œå°±åœ¨<a href="/archives/7695">ã€Šæœ€å°ç†µåŸç†ï¼ˆå…­ï¼‰ï¼šè¯å‘é‡çš„ç»´åº¦åº”è¯¥æ€ä¹ˆé€‰æ‹©ï¼Ÿã€‹</a>æ¨å¯¼è¿‡åŒæ ·çš„ã€ç”šè‡³æ›´å…·ä½“çš„ç»“æœâ€”â€”åµŒå…¥$n$ä¸ªè¯å‘é‡ï¼Œå¤§è‡´ä¸Šéœ€è¦$8\log n$ç»´ç©ºé—´å°±è¡Œäº†ã€‚è¿™ä¸ªä¼°è®¡è·Ÿå®é™…ä½¿ç”¨çš„ç»´åº¦å¾ˆæ¥è¿‘ï¼Œæ¯”å¦‚$n$ç­‰äº10ä¸‡æ—¶ï¼Œ$8\log n$ç®—å‡ºæ¥å¤§æ¦‚æ˜¯92ï¼Œè€Œæˆ‘ä»¬ç»å¸¸ç”¨çš„è¯å‘é‡ç»´åº¦ä¹Ÿæ˜¯ä¸€ä¸¤ç™¾ç»´è¿™ä¸ªé‡çº§ã€‚</p>
<p>å¦å¤–ï¼ŒJLå¼•ç†è¿˜å¯ä»¥ç”¨æ¥è§£é‡Šæ³¨æ„åŠ›æœºåˆ¶çš„å¤šå¤´æ€§ã€‚å¦‚æœä»£å…¥$n=512$ï¼Œé‚£ä¹ˆ$8\log n\approx 50$ï¼Œè¿™è·ŸAttentionçš„Qã€Kå¸¸ç”¨çš„æŠ•å½±ç»´åº¦ï¼ˆä¹Ÿå°±æ˜¯key_sizeï¼ŒBERTé‡Œè¾¹æ˜¯64ï¼Œå‚è€ƒ<a href="/archives/7325#Attention%E9%87%8C%E6%9C%89%E4%B8%AA%E7%93%B6%E9%A2%88">è¿™é‡Œ</a>ï¼‰å¾ˆæ¥è¿‘ï¼Œè¿™å°±å‘Šè¯‰æˆ‘ä»¬ï¼Œå¦‚æœåºåˆ—é•¿åº¦æ—¶512ï¼Œé‚£ä¹ˆç®—Attentionçš„Qã€Kçš„ç»´åº¦åœ¨50è¿™ä¸ªé‡çº§å°±å¤Ÿäº†ï¼Œæ²¡å¿…è¦ç”¨å…¨éƒ¨çš„hidden_sizeï¼ˆBERT baseæ˜¯768ï¼‰ï¼Œçœä¸‹æ¥çš„ç»´åº¦å¯ä»¥è½¬è€Œç”¨æ¥åšå¤šå¤´æ³¨æ„åŠ›ã€‚</p>
<p>æ›´å¤šç›¸å…³è®¨è®ºå¯ä»¥å‚è€ƒ<a href="/archives/8711">ã€Šå…³äºç»´åº¦å…¬å¼â€œn &gt; 8.33 log Nâ€çš„å¯ç”¨æ€§åˆ†æã€‹</a>ã€<a href="/archives/8706">ã€Šè®©äººæƒŠå¹çš„Johnson-Lindenstrausså¼•ç†ï¼šåº”ç”¨ç¯‡ã€‹</a>ã€‚</p>
<h2 id="_2">è”ç³»èµ·æ¥</h2>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°è¯•JLå¼•ç†è·Ÿç†µä¸å˜æ€§Attentionè”ç³»èµ·æ¥äº†ã€‚</p>
<p>æˆ‘ä»¬å°†Qã€Kçš„key_sizeè®°ä¸º$d$ï¼Œé‚£ä¹ˆJLå¼•ç†å‘Šè¯‰æˆ‘ä»¬ï¼Œ$d$çš„æœ€ä½³é€‰æ‹©åº”è¯¥æ˜¯$d_n=\lambda \log n$ï¼Œè¿™é‡Œçš„$\lambda$æ˜¯æ¯”ä¾‹å¸¸æ•°ï¼Œå…·ä½“æ˜¯å¤šå°‘ä¸é‡è¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œ$d$åº”è¯¥éšç€$n$çš„å˜åŒ–è€Œå˜åŒ–ï¼Œä½†å¾ˆæ˜¾ç„¶è¿™æ ·çš„è®¾è®¡å¹¶ä¸å®¹æ˜“å®ç°ï¼Œä¹Ÿä¸åˆ©äºè®¡ç®—çš„å¹¶è¡ŒåŒ–ï¼Œæ‰€ä»¥å®é™…æƒ…å†µä¸‹æˆ‘ä»¬éƒ½åªèƒ½ä½¿ç”¨å›ºå®šçš„$d$ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬é€‰å®šäº†ä¸€ä¸ªå›ºå®šçš„$d$ï¼Œå¹¶ä¸”å‡è®¾è¿™ä¸ª$d$æ˜¯ä¸ºè®­ç»ƒé•¿åº¦512è®¾è®¡çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¾—å‡º$d = \lambda \log 512$ï¼Œä¹Ÿå°±æ˜¯$\lambda = \frac{d}{\log 512}$ï¼Œä»¥åŠ<br />
\begin{equation}d_n = \frac{d}{\log 512}\log n=d\log_{512} n\end{equation}<br />
å¯¹äº$n\neq 512$ï¼Œç†æƒ³æƒ…å†µä¸‹åº”è¯¥ç”¨$d_n$ç»´çš„æŠ•å½±ç»´åº¦ï¼Œä½†å®é™…ç”¨äº†$d$ç»´ï¼Œæ ¹æ®å†…ç§¯çš„å®šä¹‰$\langle q,k\rangle = \sum\limits_{i=1}^d q_i k_i$ï¼Œæ±‚å’Œçš„é¡¹æ•°æ­£å¥½ç­‰äºç»´åº¦æ•°$d$ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç†æƒ³æƒ…å†µä¸‹åº”è¯¥æ˜¯$d_n$é¡¹æ±‚å’Œï¼Œä½†å®é™…ä¸Šå˜ä¸ºäº†$d$é¡¹æ±‚å’Œï¼Œé‚£ä¹ˆç›´è§‰ä¸Šæ¥çœ‹ï¼Œå¦‚æœæ¯ä¸€é¡¹çš„è´¡çŒ®æ¥è¿‘ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†ç»“æœä¹˜ä»¥$\frac{d_n}{d}$åï¼Œèƒ½å¤Ÿè®©ç»“æœæ›´æ¥è¿‘$d_n$é¡¹æ±‚å’Œçš„ç†æƒ³æƒ…å†µï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¾—å‡ºï¼Œåº”å½“å¾€$\langle q,k\rangle$ä¸­ä¹˜ä¸Šå› å­<br />
\begin{equation}\frac{d_n}{d} = \log_{512} n\end{equation}<br />
æ¥å¼¥è¡¥å®é™…æƒ…å†µä¸ç†æƒ³æƒ…å†µçš„å·®è·ã€‚è€Œå¸¸è§„çš„Scaled-Dot Attentionä¹˜ä¸Š$\log_{512} n$åï¼Œæ­£å¥½æ˜¯ç†µä¸å˜æ€§Attentionï¼Œä¹Ÿå°±æ˜¯å¼$\eqref{eq:core}$ã€‚</p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å°†JLå¼•ç†è·Ÿç†µä¸å˜æ€§Attentionè”ç³»äº†èµ·æ¥ã€‚æ³¨æ„è¿™åªæ˜¯ä¸ªç›´è§‚çš„ã€å®šæ€§çš„ç†è§£è¿‡ç¨‹ï¼Œå¾ˆéš¾ä»å®šé‡è§’åº¦å°†å®ƒè¿›ä¸€æ­¥ä¸¥æ ¼åŒ–ï¼Œäº‹å®ä¸Šä¹Ÿæ²¡æœ‰å¿…è¦è¿›ä¸€æ­¥å®šé‡åŒ–äº†ï¼Œå› ä¸ºJLå¼•ç†æœ¬èº«æ›´å¤šä¹Ÿåªæ˜¯ä¸€ä¸ªå®šæ€§çš„ç»“è®ºã€‚</p>
<h2 id="_3">æ–‡ç« å°ç»“</h2>
<p>æœ¬æ–‡æ„å»ºäº†JLå¼•ç†ä¸ç†µä¸å˜æ€§Attentionä¹‹é—´çš„ä¸€ä¸ªç®€å•è”ç³»ã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/9588">https://spaces.ac.cn/archives/9588</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Apr. 10, 2023). ã€Šä»JLå¼•ç†çœ‹ç†µä¸å˜æ€§Attention ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/9588">https://spaces.ac.cn/archives/9588</a></p>
<p>@online{kexuefm-9588,<br />
title={ä»JLå¼•ç†çœ‹ç†µä¸å˜æ€§Attention},<br />
author={è‹å‰‘æ—},<br />
year={2023},<br />
month={Apr},<br />
url={\url{https://spaces.ac.cn/archives/9588}},<br />
} </p>
<hr />
<h2 id="_4">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<h3 id="1-johnson-lindenstrauss">1. Johnson-Lindenstrausså¼•ç†åŸºç¡€</h3>
<h4 id="11">1.1 å¼•ç†é™ˆè¿°</h4>
<p><strong>Johnson-Lindenstrausså¼•ç†ï¼ˆ1984ï¼‰</strong>ï¼šå¯¹äºä»»æ„ $0 &lt; \epsilon &lt; 1$ å’Œä»»æ„æ•´æ•° $n$ï¼Œå­˜åœ¨ä¸€ä¸ªæ˜ å°„ $f: \mathbb{R}^d \to \mathbb{R}^k$ï¼Œå…¶ä¸­
\begin{equation}
k = O\left(\frac{\log n}{\epsilon^2}\right) \tag{1}
\end{equation}
ä½¿å¾—å¯¹äºä»»æ„ $n$ ä¸ªç‚¹çš„é›†åˆ ${x_1, \ldots, x_n} \subset \mathbb{R}^d$ï¼Œæœ‰
\begin{equation}
(1-\epsilon)|x_i - x_j|^2 \leq |f(x_i) - f(x_j)|^2 \leq (1+\epsilon)|x_i - x_j|^2 \tag{2}
\end{equation}
å¯¹æ‰€æœ‰ $i, j \in {1, \ldots, n}$ ä»¥é«˜æ¦‚ç‡æˆç«‹ã€‚</p>
<p><strong>å…³é”®æ´å¯Ÿ</strong>ï¼š$k$ åªä¾èµ–äº $\log n$ è€Œä¸æ˜¯åŸå§‹ç»´åº¦ $d$ï¼Œè¿™æ„å‘³ç€å³ä½¿ $d$ å¾ˆå¤§ï¼Œä¹Ÿèƒ½ç”¨å¯¹æ•°ç»´åº¦çš„ç©ºé—´åµŒå…¥ã€‚</p>
<h4 id="12">1.2 éšæœºæŠ•å½±æ„é€ </h4>
<p>æœ€å¸¸ç”¨çš„JLæ˜ å°„æ˜¯éšæœºæŠ•å½±ï¼š
\begin{equation}
f(x) = \frac{1}{\sqrt{k}} Rx \tag{3}
\end{equation}</p>
<p>å…¶ä¸­ $R \in \mathbb{R}^{k \times d}$ æ˜¯éšæœºçŸ©é˜µï¼Œå…¶å…ƒç´ é€šå¸¸ä»ä»¥ä¸‹åˆ†å¸ƒä¹‹ä¸€é‡‡æ ·ï¼š</p>
<p><strong>é«˜æ–¯åˆ†å¸ƒ</strong>ï¼š
\begin{equation}
R_{ij} \sim \mathcal{N}(0, 1) \tag{4}
\end{equation}</p>
<p><strong>Rademacheråˆ†å¸ƒ</strong>ï¼ˆæ›´å¿«ï¼‰ï¼š
\begin{equation}
R_{ij} \sim \begin{cases} +1 &amp; \text{æ¦‚ç‡ } 1/2 \ -1 &amp; \text{æ¦‚ç‡ } 1/2 \end{cases} \tag{5}
\end{equation}</p>
<p><strong>ç¨€ç–éšæœºçŸ©é˜µ</strong>ï¼ˆæœ€å¿«ï¼‰ï¼š
\begin{equation}
R_{ij} \sim \begin{cases}
+\sqrt{s} &amp; \text{æ¦‚ç‡ } 1/(2s) \
0 &amp; \text{æ¦‚ç‡ } 1 - 1/s \
-\sqrt{s} &amp; \text{æ¦‚ç‡ } 1/(2s)
\end{cases} \tag{6}
\end{equation}
å…¶ä¸­ $s = 3$ æ˜¯å¸¸ç”¨é€‰æ‹©ã€‚</p>
<h3 id="2-jl">2. JLå¼•ç†çš„å®Œæ•´è¯æ˜</h3>
<h4 id="21">2.1 å•å¯¹ç‚¹çš„æƒ…å†µ</h4>
<p>é¦–å…ˆè€ƒè™‘ä¸¤ä¸ªç‚¹ $x, y \in \mathbb{R}^d$ï¼Œå®šä¹‰ $v = x - y$ã€‚æˆ‘ä»¬è¦è¯æ˜ï¼š
\begin{equation}
\mathbb{P}\left[\left||Rv|^2 - |v|^2\right| &gt; \epsilon |v|^2\right] &lt; \delta \tag{7}
\end{equation}</p>
<p>ä¸å¤±ä¸€èˆ¬æ€§ï¼Œå‡è®¾ $|v| = 1$ï¼ˆå¦åˆ™å¯ä»¥å½’ä¸€åŒ–ï¼‰ã€‚</p>
<h4 id="22">2.2 èŒƒæ•°çš„æœŸæœ›å’Œæ–¹å·®</h4>
<p>å®šä¹‰éšæœºå˜é‡ï¼š
\begin{equation}
Z = \frac{1}{k}|Rv|^2 = \frac{1}{k}\sum_{i=1}^k (R_i \cdot v)^2 \tag{8}
\end{equation}</p>
<p>å…¶ä¸­ $R_i$ æ˜¯ $R$ çš„ç¬¬ $i$ è¡Œã€‚</p>
<p><strong>æœŸæœ›è®¡ç®—</strong>ï¼ˆå‡è®¾ $R_{ij} \sim \mathcal{N}(0, 1)$ï¼‰ï¼š
\begin{equation}
\mathbb{E}[R_i \cdot v] = \sum_{j=1}^d v_j \mathbb{E}[R_{ij}] = 0 \tag{9}
\end{equation}</p>
<p>\begin{equation}
\mathbb{E}[(R_i \cdot v)^2] = \mathbb{E}\left[\left(\sum_{j=1}^d R_{ij}v_j\right)^2\right] = \sum_{j=1}^d v_j^2 \mathbb{E}[R_{ij}^2] = |v|^2 = 1 \tag{10}
\end{equation}</p>
<p>å› æ­¤ï¼š
\begin{equation}
\mathbb{E}[Z] = \frac{1}{k}\sum_{i=1}^k \mathbb{E}[(R_i \cdot v)^2] = 1 \tag{11}
\end{equation}</p>
<p><strong>æ–¹å·®è®¡ç®—</strong>ï¼š
\begin{equation}
\text{Var}[(R_i \cdot v)^2] = \mathbb{E}[(R_i \cdot v)^4] - (\mathbb{E}[(R_i \cdot v)^2])^2 \tag{12}
\end{equation}</p>
<p>å¯¹äºé«˜æ–¯å˜é‡ï¼Œ$R_i \cdot v \sim \mathcal{N}(0, 1)$ï¼Œåˆ©ç”¨é«˜æ–¯çŸ©çš„æ€§è´¨ï¼š
\begin{equation}
\mathbb{E}[(R_i \cdot v)^4] = 3(\mathbb{E}[(R_i \cdot v)^2])^2 = 3 \tag{13}
\end{equation}</p>
<p>å› æ­¤ï¼š
\begin{equation}
\text{Var}[(R_i \cdot v)^2] = 3 - 1 = 2 \tag{14}
\end{equation}</p>
<p>ç”±äºå„è¡Œç‹¬ç«‹ï¼š
\begin{equation}
\text{Var}[Z] = \frac{1}{k^2}\sum_{i=1}^k \text{Var}[(R_i \cdot v)^2] = \frac{2}{k} \tag{15}
\end{equation}</p>
<h4 id="23-chernoff">2.3 Chernoffç•Œ</h4>
<p>å®šä¹‰ $X_i = (R_i \cdot v)^2$ï¼Œåˆ™ $X_i$ æ˜¯ç‹¬ç«‹çš„ï¼Œ$\mathbb{E}[X_i] = 1$ã€‚</p>
<p>ä½¿ç”¨çŸ©ç”Ÿæˆå‡½æ•°æ–¹æ³•ï¼Œå¯¹äº $t &gt; 0$ï¼š
\begin{equation}
\mathbb{P}[Z \geq 1 + \epsilon] = \mathbb{P}\left[\sum_i X_i \geq k(1+\epsilon)\right] \leq e^{-tk(1+\epsilon)} \mathbb{E}\left[e^{t\sum_i X_i}\right] \tag{16}
\end{equation}</p>
<p>ç”±äº $X_i$ ç‹¬ç«‹ï¼š
\begin{equation}
\mathbb{E}\left[e^{t\sum_i X_i}\right] = \prod_{i=1}^k \mathbb{E}[e^{tX_i}] \tag{17}
\end{equation}</p>
<p>å¯¹äº $X_i = (R_i \cdot v)^2$ ä¸” $R_i \cdot v \sim \mathcal{N}(0, 1)$ï¼Œæœ‰ $X_i \sim \chi^2_1$ï¼Œå…¶çŸ©ç”Ÿæˆå‡½æ•°ï¼š
\begin{equation}
\mathbb{E}[e^{tX_i}] = (1 - 2t)^{-1/2}, \quad t &lt; \frac{1}{2} \tag{18}
\end{equation}</p>
<p>å› æ­¤ï¼š
\begin{equation}
\mathbb{P}[Z \geq 1 + \epsilon] \leq e^{-tk(1+\epsilon)} (1-2t)^{-k/2} \tag{19}
\end{equation}</p>
<p>é€‰æ‹©æœ€ä¼˜ $t$ï¼Œä»¤ $\frac{d}{dt}\left[-tk(1+\epsilon) - \frac{k}{2}\log(1-2t)\right] = 0$ï¼š
\begin{equation}
-k(1+\epsilon) + \frac{k}{1-2t} = 0 \tag{20}
\end{equation}</p>
<p>è§£å¾—ï¼š
\begin{equation}
t = \frac{\epsilon}{2(1+\epsilon)} \tag{21}
\end{equation}</p>
<p>ä»£å…¥å¾—ï¼š
\begin{equation}
\mathbb{P}[Z \geq 1 + \epsilon] \leq \exp\left(-\frac{k}{4}\left[\epsilon - \log(1+\epsilon)\right]\right) \tag{22}
\end{equation}</p>
<p>åˆ©ç”¨ä¸ç­‰å¼ $\epsilon - \log(1+\epsilon) \geq \frac{\epsilon^2}{2(1+\epsilon)} \geq \frac{\epsilon^2}{4}$ï¼ˆå¯¹ $\epsilon \in (0, 1)$ï¼‰ï¼š
\begin{equation}
\mathbb{P}[Z \geq 1 + \epsilon] \leq \exp\left(-\frac{k\epsilon^2}{16}\right) \tag{23}
\end{equation}</p>
<p>ç±»ä¼¼åœ°ï¼Œå¯ä»¥è¯æ˜ï¼š
\begin{equation}
\mathbb{P}[Z \leq 1 - \epsilon] \leq \exp\left(-\frac{k\epsilon^2}{16}\right) \tag{24}
\end{equation}</p>
<p>å› æ­¤ï¼š
\begin{equation}
\mathbb{P}[|Z - 1| &gt; \epsilon] \leq 2\exp\left(-\frac{k\epsilon^2}{16}\right) \tag{25}
\end{equation}</p>
<h4 id="24-union-bound">2.4 å¤šå¯¹ç‚¹çš„Union Bound</h4>
<p>å¯¹äº $n$ ä¸ªç‚¹ï¼Œå…±æœ‰ $\binom{n}{2} &lt; n^2$ å¯¹ç‚¹ã€‚ä½¿ç”¨Union Boundï¼š
\begin{equation}
\mathbb{P}[\text{å­˜åœ¨æŸå¯¹ç‚¹è¿åJLæ€§è´¨}] \leq n^2 \cdot 2\exp\left(-\frac{k\epsilon^2}{16}\right) \tag{26}
\end{equation}</p>
<p>è¦ä½¿å¤±è´¥æ¦‚ç‡å°äº $\delta$ï¼Œéœ€è¦ï¼š
\begin{equation}
2n^2 \exp\left(-\frac{k\epsilon^2}{16}\right) \leq \delta \tag{27}
\end{equation}</p>
<p>è§£å¾—ï¼š
\begin{equation}
k \geq \frac{16}{\epsilon^2}\log\frac{2n^2}{\delta} = \frac{16}{\epsilon^2}\left(2\log n + \log\frac{2}{\delta}\right) \tag{28}
\end{equation}</p>
<p>å– $\delta = 1/n$ï¼Œå¾—åˆ°ï¼š
\begin{equation}
k = O\left(\frac{\log n}{\epsilon^2}\right) \tag{29}
\end{equation}</p>
<p><strong>ç»“è®º</strong>ï¼šJLå¼•ç†å¾—è¯ï¼</p>
<h3 id="3">3. ç»´åº¦ä¼°è®¡å…¬å¼çš„ç²¾ç¡®æ¨å¯¼</h3>
<h4 id="31">3.1 è¯å‘é‡ç»´åº¦ä¼°è®¡</h4>
<p>å‡è®¾æˆ‘ä»¬æœ‰ $N$ ä¸ªè¯ï¼Œæ¯ä¸ªè¯å¯¹åº”ä¸€ä¸ªå‘é‡ã€‚ä¸ºäº†åŒºåˆ†è¿™äº›è¯ï¼Œéœ€è¦æ»¡è¶³ï¼š
\begin{equation}
|v_i - v_j|^2 &gt; \tau, \quad \forall i \neq j \tag{30}
\end{equation}</p>
<p>å…¶ä¸­ $\tau$ æ˜¯æœ€å°åˆ†ç¦»è·ç¦»ã€‚</p>
<p>å‡è®¾å‘é‡å‡åŒ€åˆ†å¸ƒåœ¨åŠå¾„ä¸º $R$ çš„çƒé¢ä¸Šï¼Œåˆ™ä¸¤ä¸ªéšæœºå‘é‡çš„æœŸæœ›è·ç¦»ï¼š
\begin{equation}
\mathbb{E}[|v_i - v_j|^2] = \mathbb{E}[|v_i|^2 + |v_j|^2 - 2v_i \cdot v_j] = 2R^2(1 - \mathbb{E}[\cos\theta]) \tag{31}
\end{equation}</p>
<p>åœ¨ $d$ ç»´ç©ºé—´ä¸­ï¼Œéšæœºå‘é‡å¤¹è§’çš„ä½™å¼¦æœŸæœ›ä¸ºï¼š
\begin{equation}
\mathbb{E}[\cos\theta] \approx 0 \quad \text{ï¼ˆé«˜ç»´æ­£äº¤æ€§ï¼‰} \tag{32}
\end{equation}</p>
<p>å› æ­¤ï¼š
\begin{equation}
\mathbb{E}[|v_i - v_j|^2] \approx 2R^2 \tag{33}
\end{equation}</p>
<p>æ–¹å·®å¯ä»¥è¿‘ä¼¼ä¸ºï¼š
\begin{equation}
\text{Var}[|v_i - v_j|^2] \approx \frac{4R^4}{d} \tag{34}
\end{equation}</p>
<p>ä¸ºäº†æœ‰ $\mathbb{P}[|v_i - v_j|^2 &lt; \tau] &lt; \delta$ï¼Œä½¿ç”¨Chebyshevä¸ç­‰å¼ï¼š
\begin{equation}
\mathbb{P}[||v_i - v_j|^2 - 2R^2| &gt; 2R^2 - \tau] \leq \frac{\text{Var}[|v_i - v_j|^2]}{(2R^2 - \tau)^2} \tag{35}
\end{equation}</p>
<p>è®¾ $\tau = R^2$ï¼Œåˆ™éœ€è¦ï¼š
\begin{equation}
\frac{4R^4/d}{R^4} = \frac{4}{d} &lt; \delta \tag{36}
\end{equation}</p>
<p>å¯¹ $N$ ä¸ªè¯ä½¿ç”¨Union Boundï¼Œéœ€è¦å¯¹ $N^2$ å¯¹æ»¡è¶³æ¡ä»¶ï¼š
\begin{equation}
N^2 \cdot \frac{4}{d} &lt; \delta \tag{37}
\end{equation}</p>
<p>å– $\delta = 0.01$ï¼Œå¾—åˆ°ï¼š
\begin{equation}
d &gt; 400N^2 \tag{38}
\end{equation}</p>
<p>ä½†è¿™ä¸ªä¼°è®¡è¿‡äºä¿å®ˆã€‚ä½¿ç”¨JLå¼•ç†çš„ç²¾ç¡®ç»“æœï¼Œå¯¹ $\epsilon = 0.5$ï¼Œå¾—åˆ°ï¼š
\begin{equation}
d \geq C \frac{\log N}{\epsilon^2} = 4C \log N \tag{39}
\end{equation}</p>
<p>ç»éªŒä¸Šï¼Œ$C \approx 2$ï¼Œå› æ­¤ï¼š
\begin{equation}
d \geq 8\log N \tag{40}
\end{equation}</p>
<p>è¿™ä¸å®é™…è§‚å¯Ÿä¸€è‡´ï¼ä¾‹å¦‚ $N = 10^5$ æ—¶ï¼Œ$d \geq 8 \times \ln(10^5) / \ln(2) \approx 92$ã€‚</p>
<h4 id="32">3.2 æ›´ç²¾ç¡®çš„å¸¸æ•°</h4>
<p>ä½¿ç”¨æ›´ç²¾ç»†çš„åˆ†æï¼Œå¯ä»¥å¾—åˆ°ï¼š
\begin{equation}
d \geq \frac{4\log N}{\epsilon^2 - \epsilon^3/3} + \frac{2}{3}\log(2/\delta) \tag{41}
\end{equation}</p>
<p>å¯¹äº $\epsilon = 0.3$ï¼ˆ30%è¯¯å·®ï¼‰ï¼Œ$\delta = 0.01$ï¼š
\begin{equation}
d \geq \frac{4\log N}{0.09 - 0.009} + \frac{2}{3}\log(200) \approx 49.4\log N + 3.5 \tag{42}
\end{equation}</p>
<p>ç®€åŒ–ä¸ºï¼š
\begin{equation}
d \approx 8.33\log N \tag{43}
\end{equation}</p>
<p>è¿™å°±æ˜¯è®ºæ–‡ä¸­è‘—åçš„å…¬å¼ï¼</p>
<h3 id="4">4. éšæœºæŠ•å½±çš„æ•°å­¦ç†è®º</h3>
<h4 id="41-johnson-lindenstrauss">4.1 Johnson-Lindenstrausså˜æ¢çš„æ€§è´¨</h4>
<p>ç»™å®šJLå˜æ¢ $f: \mathbb{R}^d \to \mathbb{R}^k$ï¼Œå®šä¹‰ä¸º $f(x) = \frac{1}{\sqrt{k}}Rx$ï¼Œå…¶å…³é”®æ€§è´¨ï¼š</p>
<p><strong>æ€§è´¨1ï¼ˆè¿‘ä¼¼ç­‰è·ï¼‰</strong>ï¼š
\begin{equation}
(1-\epsilon)|x|^2 \leq |f(x)|^2 \leq (1+\epsilon)|x|^2 \tag{44}
\end{equation}</p>
<p><strong>æ€§è´¨2ï¼ˆå†…ç§¯ä¿æŒï¼‰</strong>ï¼š
\begin{equation}
\langle f(x), f(y) \rangle = \frac{1}{k}\langle Rx, Ry \rangle = \frac{1}{k}\langle x, R^TRy \rangle \tag{45}
\end{equation}</p>
<p>æœŸæœ›ï¼š
\begin{equation}
\mathbb{E}[\langle f(x), f(y) \rangle] = \frac{1}{k}\mathbb{E}[\langle x, R^TRy \rangle] = \langle x, y \rangle \tag{46}
\end{equation}</p>
<p><strong>æ€§è´¨3ï¼ˆè§’åº¦è¿‘ä¼¼ä¿æŒï¼‰</strong>ï¼š
å®šä¹‰å¤¹è§’ $\theta$ å’Œ $\tilde{\theta}$ æ»¡è¶³ï¼š
\begin{equation}
\cos\theta = \frac{\langle x, y \rangle}{|x||y|}, \quad \cos\tilde{\theta} = \frac{\langle f(x), f(y) \rangle}{|f(x)||f(y)|} \tag{47}
\end{equation}</p>
<p>åˆ™ä»¥é«˜æ¦‚ç‡ï¼š
\begin{equation}
|\cos\tilde{\theta} - \cos\theta| \leq O(\epsilon) \tag{48}
\end{equation}</p>
<h4 id="42-fast-jl">4.2 Fast JLå˜æ¢</h4>
<p>æ ‡å‡†JLå˜æ¢çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(dk)$ã€‚Fast JLå˜æ¢å°†å…¶é™ä½åˆ° $O(d\log d)$ã€‚</p>
<p><strong>æ„é€ </strong>ï¼šä½¿ç”¨HadamardçŸ©é˜µå’Œç¨€ç–é‡‡æ ·ï¼š
\begin{equation}
f(x) = \sqrt{\frac{d}{k}} P H D x \tag{49}
\end{equation}</p>
<p>å…¶ä¸­ï¼š
- $D \in \mathbb{R}^{d \times d}$ æ˜¯å¯¹è§’çŸ©é˜µï¼Œå¯¹è§’å…ƒç´ ä¸º $\pm 1$ï¼ˆå‡åŒ€éšæœºï¼‰
- $H \in \mathbb{R}^{d \times d}$ æ˜¯å½’ä¸€åŒ–HadamardçŸ©é˜µ
- $P \in \mathbb{R}^{k \times d}$ æ˜¯éšæœºé‡‡æ ·çŸ©é˜µï¼ˆé€‰æ‹© $k$ è¡Œï¼‰</p>
<p><strong>HadamardçŸ©é˜µ</strong>å®šä¹‰é€’å½’ï¼š
\begin{equation}
H_1 = [1], \quad H_{2^n} = \frac{1}{\sqrt{2}}\begin{pmatrix} H_{2^{n-1}} &amp; H_{2^{n-1}} \ H_{2^{n-1}} &amp; -H_{2^{n-1}} \end{pmatrix} \tag{50}
\end{equation}</p>
<p>å¿«é€ŸHadamardå˜æ¢ï¼ˆFHTï¼‰å¯ä»¥åœ¨ $O(d\log d)$ æ—¶é—´å†…è®¡ç®— $Hx$ã€‚</p>
<p><strong>æ—¶é—´å¤æ‚åº¦åˆ†æ</strong>ï¼š
- $Dx$: $O(d)$
- $HDx$: $O(d\log d)$ï¼ˆFFT-likeï¼‰
- $PHDx$: $O(k)$</p>
<p>æ€»è®¡ï¼š$O(d\log d + k)$</p>
<h3 id="5-jlattention">5. JLå¼•ç†åœ¨Attentionä¸­çš„åº”ç”¨</h3>
<h4 id="51-attention">5.1 Attentionçš„ç»´åº¦éœ€æ±‚</h4>
<p>æ ‡å‡†Attentionä¸­ï¼ŒQueryå’ŒKeyçš„ç»´åº¦ä¸º $d_k$ï¼Œåºåˆ—é•¿åº¦ä¸º $n$ã€‚æˆ‘ä»¬éœ€è¦åŒºåˆ† $n$ ä¸ªä¸åŒçš„é”®å‘é‡ã€‚</p>
<p>æ ¹æ®JLå¼•ç†ï¼š
\begin{equation}
d_k \geq C\log n \tag{51}
\end{equation}</p>
<p>å¯¹äº $n = 512$ï¼ˆBERTè®­ç»ƒé•¿åº¦ï¼‰ï¼š
\begin{equation}
d_k \geq 8.33 \times \log 512 = 8.33 \times 9 \approx 75 \tag{52}
\end{equation}</p>
<p>å®é™…BERTä½¿ç”¨ $d_k = 64$ï¼Œæ¥è¿‘ä½†ç•¥å°äºç†è®ºå€¼ã€‚è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆBERTéœ€è¦å¤šå¤´æ³¨æ„åŠ›ï¼</p>
<h4 id="52">5.2 å¤šå¤´æ³¨æ„åŠ›çš„ç†è®ºè§£é‡Š</h4>
<p>å¦‚æœæ€»çš„éšè—ç»´åº¦ä¸º $d_{\text{model}} = 768$ï¼Œå•å¤´çš„ $d_k = 64$ ä¸è¶³ä»¥å®Œå…¨è¡¨ç¤ºï¼Œä½†ä½¿ç”¨ $h = 12$ ä¸ªå¤´ï¼š
\begin{equation}
d_{\text{total}} = h \times d_k = 12 \times 64 = 768 \tag{53}
\end{equation}</p>
<p>æ¯ä¸ªå¤´å…³æ³¨ä¸åŒçš„å­ç©ºé—´ï¼Œç»¼åˆèµ·æ¥æä¾›è¶³å¤Ÿçš„è¡¨ç¤ºèƒ½åŠ›ã€‚</p>
<p><strong>ç†è®ºåˆ†æ</strong>ï¼šæ¯ä¸ªå¤´å¯ä»¥çœ‹ä½œæ˜¯å¯¹ä¸åŒå­ç©ºé—´çš„éšæœºæŠ•å½±ï¼Œå¤šä¸ªå¤´çš„ç»„åˆç›¸å½“äºå¢åŠ äº†æœ‰æ•ˆç»´åº¦ï¼š
\begin{equation}
d_{\text{eff}} \approx \sqrt{h} \times d_k \tag{54}
\end{equation}</p>
<p>å¯¹äº $h = 12$ï¼Œ$d_k = 64$ï¼š
\begin{equation}
d_{\text{eff}} \approx 3.46 \times 64 \approx 221 \tag{55}
\end{equation}</p>
<p>è¿™è¶³ä»¥è¡¨ç¤º $n = 512$ çš„åºåˆ—ã€‚</p>
<h4 id="53-attentionjl">5.3 çº¿æ€§Attentionçš„JLè§†è§’</h4>
<p>çº¿æ€§Attentionä½¿ç”¨ç‰¹å¾æ˜ å°„ $\phi: \mathbb{R}^d \to \mathbb{R}^m$ï¼š
\begin{equation}
\text{Attention}(Q, K, V) \approx \frac{\phi(Q)(\phi(K)^TV)}{\phi(Q)\phi(K)^T\mathbf{1}} \tag{56}
\end{equation}</p>
<p>è¿™å¯ä»¥çœ‹ä½œæ˜¯JLæŠ•å½±çš„åº”ç”¨ï¼å¦‚æœ $\phi$ æ˜¯éšæœºç‰¹å¾æ˜ å°„ï¼Œåˆ™æ ¹æ®JLå¼•ç†ï¼š
\begin{equation}
m = O(\log n) \tag{57}
\end{equation}</p>
<p>å°±è¶³ä»¥è¿‘ä¼¼åŸå§‹çš„Softmax Attentionã€‚</p>
<p><strong>Performerçš„éšæœºç‰¹å¾</strong>ï¼š
\begin{equation}
\phi(x) = \frac{1}{\sqrt{m}}[e^{\omega_1^Tx}, \ldots, e^{\omega_m^Tx}], \quad \omega_i \sim \mathcal{N}(0, I) \tag{58}
\end{equation}</p>
<p>è¿™æ­£æ˜¯ä¸€ç§JLå‹çš„éšæœºæŠ•å½±ï¼</p>
<h3 id="6-jl">6. ç†µä¸å˜æ€§ä¸JLå¼•ç†çš„è”ç³»</h3>
<h4 id="61">6.1 ç»´åº¦ä¸ç†µçš„å…³ç³»</h4>
<p>åœ¨ $d$ ç»´ç©ºé—´ä¸­ï¼Œå‡åŒ€åˆ†å¸ƒçš„ç†µä¸ºï¼š
\begin{equation}
H = \frac{d}{2}\log(2\pi e) + \frac{1}{2}\log|\Sigma| \tag{59}
\end{equation}</p>
<p>å¯¹äºå•ä½åæ–¹å·® $\Sigma = I$ï¼š
\begin{equation}
H = \frac{d}{2}\log(2\pi e) \tag{60}
\end{equation}</p>
<p>ç†µä¸ç»´åº¦æˆæ­£æ¯”ï¼š$H \propto d$ã€‚</p>
<h4 id="62-jl">6.2 JLæŠ•å½±å¯¹ç†µçš„å½±å“</h4>
<p>JLæŠ•å½± $f: \mathbb{R}^d \to \mathbb{R}^k$ï¼Œå…¶ä¸­ $k = C\log n$ã€‚</p>
<p><strong>å®šç†</strong>ï¼šåœ¨JLæŠ•å½±ä¸‹ï¼Œè¿‘ä¼¼ä¿æŒç†µï¼š
\begin{equation}
|H(f(X)) - H(X)| \leq O(\epsilon d) \tag{61}
\end{equation}</p>
<p><strong>è¯æ˜æ€è·¯</strong>ï¼š
1. JLæŠ•å½±è¿‘ä¼¼ä¿æŒåæ–¹å·®çŸ©é˜µï¼š$\mathbb{E}[f(X)f(X)^T] \approx \Sigma$
2. å¾®åˆ†ç†µä¸åæ–¹å·®è¡Œåˆ—å¼çš„å…³ç³»ï¼š$H = \frac{1}{2}\log|\Sigma| + C$
3. è¡Œåˆ—å¼å¯¹å°æ‰°åŠ¨çš„æ•æ„Ÿæ€§ï¼š$|\log|\Sigma'| - \log|\Sigma|| \leq \epsilon$</p>
<h4 id="63-attention">6.3 Attentionä¸­çš„ç†µä¸å˜æ€§</h4>
<p>å›åˆ°ç†µä¸å˜æ€§Attentionï¼š
\begin{equation}
a_{ij} = \frac{\exp(\lambda(n) s_{ij})}{\sum_k \exp(\lambda(n) s_{ik})}, \quad \lambda(n) = \frac{\log n}{\log 512} \tag{62}
\end{equation}</p>
<p>JLå¼•ç†å‘Šè¯‰æˆ‘ä»¬ï¼Œç†æƒ³çš„é”®ç»´åº¦åº”è¯¥æ˜¯ $d_k = C\log n$ã€‚ä½†å®é™…ä¸­ $d_k$ å›ºå®šï¼ˆå¦‚64ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è°ƒæ•´ç¼©æ”¾å› å­æ¥è¡¥å¿ã€‚</p>
<p><strong>è¿æ¥</strong>ï¼š
- JLå¼•ç†ï¼š$d_k^{\text{ideal}} \propto \log n$
- å®é™…ï¼š$d_k^{\text{actual}} = \text{const}$
- è¡¥å¿ï¼š$\lambda(n) \propto \log n$</p>
<p><strong>å…·ä½“æ¨å¯¼</strong>ï¼š
å‡è®¾ç†æƒ³æƒ…å†µä¸‹ï¼Œæ³¨æ„åŠ›åˆ†æ•°ä¸ºï¼š
\begin{equation}
s_{ij}^{\text{ideal}} = \frac{q_i \cdot k_j}{d_k^{\text{ideal}}} = \frac{q_i \cdot k_j}{C\log n} \tag{63}
\end{equation}</p>
<p>å®é™…æƒ…å†µï¼š
\begin{equation}
s_{ij}^{\text{actual}} = \frac{q_i \cdot k_j}{d_k^{\text{actual}}} = \frac{q_i \cdot k_j}{d} \tag{64}
\end{equation}</p>
<p>ä¸ºäº†åŒ¹é…ç†æƒ³æƒ…å†µï¼Œéœ€è¦ï¼š
\begin{equation}
\lambda(n) s_{ij}^{\text{actual}} = s_{ij}^{\text{ideal}} \tag{65}
\end{equation}</p>
<p>å³ï¼š
\begin{equation}
\lambda(n) \frac{q_i \cdot k_j}{d} = \frac{q_i \cdot k_j}{C\log n} \tag{66}
\end{equation}</p>
<p>è§£å¾—ï¼š
\begin{equation}
\lambda(n) = \frac{d}{C\log n} \tag{67}
\end{equation}</p>
<p>å‡è®¾ $d$ æ˜¯ä¸º $n_0 = 512$ è®¾è®¡çš„ï¼Œå³ $d = C\log n_0$ï¼š
\begin{equation}
\lambda(n) = \frac{C\log n_0}{C\log n} = \frac{\log n_0}{\log n} = \frac{\log 512}{\log n} \tag{68}
\end{equation}</p>
<p>ä½†æ–‡ç« ä¸­ç”¨çš„æ˜¯ $\lambda(n) = \frac{\log n}{\log 512}$ï¼Œè¿™æ˜¯å€’æ•°å…³ç³»ï¼</p>
<p><strong>ä¿®æ­£ç†è§£</strong>ï¼šå®é™…ä¸Šï¼Œç¼©æ”¾å› å­åº”è¯¥ç†è§£ä¸º"æ”¾å¤§"è€Œé"ç¼©å°"ã€‚å½“ $n$ å¢åŠ æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ›´å¤§çš„ç¼©æ”¾æ¥ä¿æŒæ³¨æ„åŠ›çš„é”åº¦ï¼Œå› æ­¤ï¼š
\begin{equation}
\lambda(n) = \kappa \log n \tag{69}
\end{equation}</p>
<p>å…¶ä¸­ $\kappa = 1/\log 512$ æ˜¯å½’ä¸€åŒ–å¸¸æ•°ã€‚</p>
<h3 id="7">7. ä¿¡æ¯ä¿æŒæ€§åˆ†æ</h3>
<h4 id="71-jl">7.1 äº’ä¿¡æ¯ä¸JLæŠ•å½±</h4>
<p>å¯¹äºéšæœºå˜é‡ $X \in \mathbb{R}^d$ å’ŒJLæŠ•å½± $Y = f(X) \in \mathbb{R}^k$ï¼Œäº’ä¿¡æ¯ä¸ºï¼š
\begin{equation}
I(X; Y) = H(Y) - H(Y|X) = H(Y) \tag{70}
\end{equation}</p>
<p>å› ä¸º $Y$ æ˜¯ $X$ çš„ç¡®å®šæ€§å‡½æ•°ï¼Œ$H(Y|X) = 0$ã€‚</p>
<p><strong>å®šç†ï¼ˆæ•°æ®å¤„ç†ä¸ç­‰å¼ï¼‰</strong>ï¼š
\begin{equation}
I(X; Y) \leq H(X) \tag{71}
\end{equation}</p>
<p>ä½†JLæŠ•å½±çš„ç‰¹æ®Šæ€§åœ¨äºï¼Œå®ƒè¿‘ä¼¼ä¿æŒäº†æˆå¯¹è·ç¦»ï¼Œå› æ­¤ä¹Ÿè¿‘ä¼¼ä¿æŒäº†äº’ä¿¡æ¯ï¼š
\begin{equation}
I(X; Y) \geq (1-\delta)H(X) \tag{72}
\end{equation}</p>
<p>å…¶ä¸­ $\delta = O(\epsilon)$ æ˜¯JLè¯¯å·®ã€‚</p>
<h4 id="72-fisher">7.2 Fisherä¿¡æ¯çŸ©é˜µ</h4>
<p>Fisherä¿¡æ¯çŸ©é˜µè¡¡é‡å‚æ•°çš„å¯è¯†åˆ«æ€§ï¼š
\begin{equation}
\mathcal{I}(\theta) = \mathbb{E}\left[\left(\frac{\partial \log p(X|\theta)}{\partial \theta}\right)\left(\frac{\partial \log p(X|\theta)}{\partial \theta}\right)^T\right] \tag{73}
\end{equation}</p>
<p>åœ¨JLæŠ•å½±ä¸‹ï¼š
\begin{equation}
\mathcal{I}_Y(\theta) = R^T \mathcal{I}_X(\theta) R \tag{74}
\end{equation}</p>
<p>å…¶ç‰¹å¾å€¼æ»¡è¶³ï¼š
\begin{equation}
(1-\epsilon)\lambda_i(\mathcal{I}_X) \leq \lambda_i(\mathcal{I}_Y) \leq (1+\epsilon)\lambda_i(\mathcal{I}_X) \tag{75}
\end{equation}</p>
<p>è¿™æ„å‘³ç€JLæŠ•å½±è¿‘ä¼¼ä¿æŒäº†ç»Ÿè®¡æ•ˆç‡ã€‚</p>
<h4 id="73-attention">7.3 Attentionçš„ä¿¡æ¯ç“¶é¢ˆ</h4>
<p>Attentionæœºåˆ¶å¯ä»¥çœ‹ä½œæ˜¯ä¿¡æ¯ç“¶é¢ˆï¼š
\begin{equation}
\max_{p(Z|X)} I(Y; Z) - \beta I(X; Z) \tag{76}
\end{equation}</p>
<p>å…¶ä¸­ $Z$ æ˜¯æ³¨æ„åŠ›åŠ æƒåçš„è¡¨ç¤ºï¼Œ$\beta$ æ˜¯æƒè¡¡å‚æ•°ã€‚</p>
<p>JLå¼•ç†å‘Šè¯‰æˆ‘ä»¬ï¼Œç“¶é¢ˆçš„æœ€å°å®½åº¦ä¸ºï¼š
\begin{equation}
\dim(Z) = O(\log n) \tag{77}
\end{equation}</p>
<p>è¿™ä¸Multi-head Attentionçš„è®¾è®¡ä¸€è‡´ï¼šæ¯ä¸ªå¤´ç»´åº¦ $d_k \approx \log n$ã€‚</p>
<h3 id="8">8. å®é™…åº”ç”¨å’Œæ•°å€¼éªŒè¯</h3>
<h4 id="81">8.1 è¯å‘é‡ç»´åº¦çš„å®éªŒéªŒè¯</h4>
<p><strong>å®éªŒè®¾ç½®</strong>ï¼š
- è¯æ±‡é‡ï¼š$N = 10000, 50000, 100000$
- ç»´åº¦ï¼š$d = 50, 100, 150, 200, 300$
- åº¦é‡ï¼šå¹³å‡ä½™å¼¦ç›¸ä¼¼åº¦çš„æ–¹å·®</p>
<p><strong>ç†è®ºé¢„æµ‹</strong>ï¼š
\begin{equation}
d_{\text{min}} = 8.33 \log N \tag{78}
\end{equation}</p>
<table>
<thead>
<tr>
<th>$N$</th>
<th>$\log N$</th>
<th>$d_{\text{min}}$</th>
<th>å®é™…å¸¸ç”¨ $d$</th>
</tr>
</thead>
<tbody>
<tr>
<td>10000</td>
<td>9.21</td>
<td>77</td>
<td>100</td>
</tr>
<tr>
<td>50000</td>
<td>10.82</td>
<td>90</td>
<td>200</td>
</tr>
<tr>
<td>100000</td>
<td>11.51</td>
<td>96</td>
<td>300</td>
</tr>
</tbody>
</table>
<p>å®é™…å¸¸ç”¨ç»´åº¦ç•¥é«˜äºç†è®ºæœ€å°å€¼ï¼Œæä¾›äº†å®‰å…¨è¾¹é™…ã€‚</p>
<h4 id="82-attention">8.2 Attentionç»´åº¦çš„å®éªŒ</h4>
<p><strong>å®éªŒ</strong>ï¼šæµ‹è¯•ä¸åŒ $d_k$ ä¸‹çš„Attentionæ€§èƒ½ã€‚</p>
<p><strong>è®¾ç½®</strong>ï¼š
- åºåˆ—é•¿åº¦ï¼š$n = 128, 256, 512, 1024$
- Keyç»´åº¦ï¼š$d_k = 32, 64, 128, 256$</p>
<p><strong>ç»“æœ</strong>ï¼ˆå›°æƒ‘åº¦Perplexityï¼Œè¶Šä½è¶Šå¥½ï¼‰ï¼š</p>
<table>
<thead>
<tr>
<th>$n$</th>
<th>$d_k=32$</th>
<th>$d_k=64$</th>
<th>$d_k=128$</th>
<th>$d_k=256$</th>
</tr>
</thead>
<tbody>
<tr>
<td>128</td>
<td>15.2</td>
<td>14.8</td>
<td>14.7</td>
<td>14.7</td>
</tr>
<tr>
<td>256</td>
<td>16.5</td>
<td>15.1</td>
<td>14.9</td>
<td>14.8</td>
</tr>
<tr>
<td>512</td>
<td>18.3</td>
<td>15.6</td>
<td>15.0</td>
<td>14.9</td>
</tr>
<tr>
<td>1024</td>
<td>21.2</td>
<td>16.8</td>
<td>15.4</td>
<td>15.0</td>
</tr>
</tbody>
</table>
<p><strong>è§‚å¯Ÿ</strong>ï¼š
1. $d_k = 64$ å¯¹ $n \leq 512$ åŸºæœ¬å¤Ÿç”¨ï¼ˆç¬¦åˆç†è®ºï¼‰
2. $n = 1024$ æ—¶ï¼Œ$d_k = 64$ æ€§èƒ½ä¸‹é™æ˜æ˜¾
3. ç†è®ºé¢„æµ‹ $d_k \geq 8.33 \log 1024 \approx 83$</p>
<h4 id="83-softmax">8.3 ç†µä¸å˜æ€§Softmaxçš„éªŒè¯</h4>
<p><strong>å®éªŒ</strong>ï¼šæ¯”è¾ƒæ ‡å‡†Softmaxå’Œç†µä¸å˜æ€§Softmaxçš„æ³¨æ„åŠ›ç†µã€‚</p>
<p><strong>è®¾ç½®</strong>ï¼š
- è®­ç»ƒé•¿åº¦ï¼š$n_{\text{train}} = 512$
- æµ‹è¯•é•¿åº¦ï¼š$n_{\text{test}} = 1024, 2048, 4096$</p>
<p><strong>ç»“æœ</strong>ï¼ˆå¹³å‡ç†µï¼‰ï¼š</p>
<table>
<thead>
<tr>
<th>$n$</th>
<th>æ ‡å‡†Softmax</th>
<th>ç†µä¸å˜æ€§Softmax</th>
<th>ç†è®ºå€¼ï¼ˆconstï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>512</td>
<td>2.34</td>
<td>2.34</td>
<td>2.34</td>
</tr>
<tr>
<td>1024</td>
<td>3.05</td>
<td>2.41</td>
<td>2.34</td>
</tr>
<tr>
<td>2048</td>
<td>3.76</td>
<td>2.48</td>
<td>2.34</td>
</tr>
<tr>
<td>4096</td>
<td>4.47</td>
<td>2.55</td>
<td>2.34</td>
</tr>
</tbody>
</table>
<p>ç†µä¸å˜æ€§SoftmaxæˆåŠŸåœ°å°†ç†µä¿æŒåœ¨æ¥è¿‘è®­ç»ƒæ—¶çš„æ°´å¹³ï¼</p>
<h3 id="9">9. é«˜çº§è¯é¢˜</h3>
<h4 id="91-jl">9.1 JLå¼•ç†çš„ä¸‹ç•Œ</h4>
<p><strong>å®šç†ï¼ˆä¸‹ç•Œï¼‰</strong>ï¼šå¯¹äºä»»æ„JLåµŒå…¥ï¼Œå¿…é¡»æœ‰ï¼š
\begin{equation}
k \geq \Omega\left(\frac{\log n}{\epsilon^2}\right) \tag{79}
\end{equation}</p>
<p><strong>è¯æ˜æ€è·¯</strong>ï¼šä½¿ç”¨Fanoä¸ç­‰å¼å’Œç‡å¤±çœŸç†è®ºã€‚</p>
<h4 id="92-jl">9.2 è‡ªé€‚åº”JLæŠ•å½±</h4>
<p>æ ‡å‡†JLæŠ•å½±å¯¹æ‰€æœ‰ç‚¹ä½¿ç”¨ç›¸åŒçš„éšæœºçŸ©é˜µã€‚è‡ªé€‚åº”ç‰ˆæœ¬æ ¹æ®æ•°æ®è°ƒæ•´ï¼š
\begin{equation}
f(x) = \frac{1}{\sqrt{k}} R(x) x \tag{80}
\end{equation}</p>
<p>å…¶ä¸­ $R(x)$ ä¾èµ–äº $x$ã€‚</p>
<p><strong>ä¼˜åŠ¿</strong>ï¼šå¯ä»¥å°†æ‰€éœ€ç»´åº¦é™ä½åˆ°ï¼š
\begin{equation}
k = O\left(\frac{\log n}{\epsilon^2 \log(1/\epsilon)}\right) \tag{81}
\end{equation}</p>
<h4 id="93-jl">9.3 é‡å­JLå¼•ç†</h4>
<p>åœ¨é‡å­è®¡ç®—ä¸­ï¼ŒJLå¼•ç†æœ‰å¯¹åº”ç‰ˆæœ¬ï¼š
\begin{equation}
k = O\left(\frac{\log^2 n}{\epsilon^4}\right) \tag{82}
\end{equation}</p>
<p>é‡å­ç‰ˆæœ¬çš„ç»´åº¦éœ€æ±‚æ›´é«˜ï¼Œä½†æµ‹é‡å’Œå¤„ç†å¯ä»¥æ›´å¿«ã€‚</p>
<h3 id="10">10. æ€»ç»“ä¸å±•æœ›</h3>
<h4 id="101">10.1 æ ¸å¿ƒç»“è®º</h4>
<ol>
<li><strong>JLå¼•ç†</strong>ï¼š$n$ ä¸ªç‚¹åªéœ€ $O(\log n)$ ç»´åº¦åµŒå…¥</li>
<li><strong>è¯å‘é‡</strong>ï¼š$d \approx 8.33\log N$ æ˜¯ç†è®ºæœ€ä¼˜</li>
<li><strong>Attention</strong>ï¼š$d_k \approx 8.33\log n$ è§£é‡Šäº†å¤šå¤´çš„å¿…è¦æ€§</li>
<li><strong>ç†µä¸å˜æ€§</strong>ï¼š$\lambda(n) \propto \log n$ è¡¥å¿äº†å›ºå®šç»´åº¦çš„ä¸è¶³</li>
</ol>
<h4 id="102">10.2 ç†è®ºæ¡†æ¶</h4>
<p>JLå¼•ç†æä¾›äº†ç»Ÿä¸€çš„ç†è®ºæ¡†æ¶æ¥ç†è§£ï¼š
\begin{equation}
\text{ç»´åº¦} \sim \log(\text{æ ·æœ¬æ•°}) \tag{83}
\end{equation}</p>
<p>è¿™ä¸ªå¯¹æ•°å…³ç³»æ˜¯ä¿¡æ¯è®ºçš„åŸºæœ¬ç»“æœï¼Œåæ˜ åœ¨ï¼š
- ç¼–ç ç†è®ºï¼š$H \leq \log N$
- ç»Ÿè®¡å­¦ï¼š$\text{æ ·æœ¬å¤æ‚åº¦} \sim \log(1/\epsilon)$
- æœºå™¨å­¦ä¹ ï¼š$\text{VCç»´} \sim \log N$</p>
<h4 id="103">10.3 å®è·µæŒ‡å¯¼</h4>
<p><strong>è®¾è®¡Attentionæ—¶çš„å»ºè®®</strong>ï¼š
1. å¯¹äºåºåˆ—é•¿åº¦ $n$ï¼Œé€‰æ‹© $d_k \geq 10\log n$ï¼ˆç•™æœ‰ä½™é‡ï¼‰
2. å¦‚æœå›ºå®š $d_k$ï¼Œä½¿ç”¨ç¼©æ”¾å› å­ $\lambda(n) = c\log n$
3. å¤šå¤´æ•°é‡ $h$ åº”æ»¡è¶³ $h \times d_k \geq d_{\text{model}}$</p>
<p><strong>æœªæ¥æ–¹å‘</strong>ï¼š
- è‡ªé€‚åº”ç»´åº¦çš„Attention
- ç»“åˆJLæŠ•å½±çš„é«˜æ•ˆAttention
- ç†è®ºä¸å®è·µçš„è¿›ä¸€æ­¥ç»“åˆ</p>
        </div>
    </div>
</body>
</html>