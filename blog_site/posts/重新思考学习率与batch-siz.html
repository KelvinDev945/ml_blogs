<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡æ–°æ€è€ƒå­¦ä¹ ç‡ä¸Batch Siz...</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>é‡æ–°æ€è€ƒå­¦ä¹ ç‡ä¸Batch Siz...</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-26 | ğŸ“„ å¤§å°: 33.0 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/11301">https://spaces.ac.cn/archives/11301</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>æˆ‘ä»¬åœ¨<a href="/archives/11280">ã€Šé‡æ–°æ€è€ƒå­¦ä¹ ç‡ä¸Batch Sizeï¼ˆäºŒï¼‰ï¼šå¹³å‡åœºã€‹</a>ä¸­æåˆ°ï¼Œå…³æ³¨SignSGDçš„åŸå› ä¹‹ä¸€æ˜¯æˆ‘ä»¬é€šå¸¸å°†å®ƒä½œä¸ºAdamçš„ç†è®ºè¿‘ä¼¼ï¼Œè¿™æ˜¯Adamåšç†è®ºåˆ†ææ—¶å¸¸ç”¨çš„ç®€åŒ–ç­–ç•¥ã€‚é™¤äº†åˆ†æå­¦ä¹ ç‡çš„åœºæ™¯å¤–ï¼Œåœ¨<a href="/archives/10001">ã€Šé…ç½®ä¸åŒçš„å­¦ä¹ ç‡ï¼ŒLoRAè¿˜èƒ½å†æ¶¨ä¸€ç‚¹ï¼Ÿã€‹</a>ã€<a href="/archives/10770">ã€Šåˆæ¢MuPï¼šè¶…å‚æ•°çš„è·¨æ¨¡å‹å°ºåº¦è¿ç§»è§„å¾‹ã€‹</a>ç­‰åœ°æ–¹æˆ‘ä»¬ä¹Ÿç”¨äº†è¿™ä¸ªç®€åŒ–ã€‚</p>
<p>ç„¶è€Œï¼ŒSignSGDçœŸæ˜¯Adamçš„è‰¯å¥½è¿‘ä¼¼å—ï¼Ÿä¸€ä¸ªæ˜æ˜¾å·®å¼‚æ˜¯SignSGDçš„Update RMSæ€»æ˜¯1ï¼Œè€ŒAdamå¹¶éå¦‚æ­¤ã€‚ç¬”è€…å‘ç°ï¼Œå¯¼è‡´è¿™ä¸€å·®å¼‚çš„æ ¸å¿ƒåŸå› æ˜¯åŠ¨é‡ï¼Œå®ƒæ™®éå­˜åœ¨äºAdamã€Lionã€Muonç­‰ä¼˜åŒ–å™¨ä¸­ã€‚æ‰€ä»¥ï¼Œæœ¬æ–‡æˆ‘ä»¬æ¥è€ƒå¯ŸåŠ¨é‡â€”â€”æ›´å¹¿ä¹‰åœ°è¯´æ˜¯EMAâ€”â€”çš„å½±å“ã€‚</p>
<h2 id="_1">é—®é¢˜åˆ†æ</h2>
<p>ä»Adamçš„è§†è§’çœ‹ï¼ŒSignSGDå¯¹åº”$\beta_1=\beta_2=0$è¿™ä¸ªç‰¹ä¾‹ï¼Œæˆ–è€…å¯¹åº”äºAdamçš„ç¬¬ä¸€æ­¥æ›´æ–°é‡ï¼ˆä¸ç®¡$\beta_1,\beta_2$å¦‚ä½•ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è®¤ä¸ºå®ƒè·ŸAdamè‚¯å®šæœ‰ä¸€äº›å…±æ€§ï¼Œèƒ½å¤Ÿæ•æ‰åˆ°ä¸€äº›é€šç”¨çš„è§„å¾‹ã€‚</p>
<p>ä½†æ˜¯ï¼Œå®ƒä»¬ä¹‹é—´ä¹Ÿæœ‰ä¸€äº›æ˜æ˜¾çš„å·®å¼‚ã€‚æ¯”è¾ƒå…¸å‹çš„å°±æ˜¯Update RMSçš„å·®å¼‚ï¼ŒSignSGDæ€»æ˜¯1ï¼Œä½†Adamå¾€å¾€æ˜æ˜¾å°äº1ï¼›è¿˜æœ‰ï¼ŒAdamçœ‹ä¸Šå»æ›´è´´è¿‘SGDï¼Œå®ƒæ›´åƒæ˜¯SignSGDå’ŒSGDçš„ä¸€ä¸ªä¸­é—´ç‰ˆæœ¬ã€‚ä¸€å¼€å§‹ï¼Œç¬”è€…ä»¥ä¸ºè¿™æ˜¯Adamåˆ†æ¯ä¸­çš„$\epsilon$å¯¼è‡´çš„å·®å¼‚ï¼Œæ‰€ä»¥åœ¨<a href="/archives/10563">ã€ŠAdamçš„epsilonå¦‚ä½•å½±å“å­¦ä¹ ç‡çš„Scaling Lawï¼Ÿã€‹</a>è¿˜ç‰¹æ„è®¡ç®—äº†å¸¦$\epsilon$çš„SoftSignSGDã€‚</p>
<p>åæ¥ï¼Œæˆ‘ä»¬åœ¨<a href="/archives/11267">ã€Šä¸ºä»€ä¹ˆAdamçš„Update RMSæ˜¯0.2ï¼Ÿã€‹</a>ä»æ¨¡æ‹Ÿå’Œç†è®ºä¸¤æ–¹é¢ä¼°è®¡äº†Adamçš„Update RMSï¼Œå…¶å®å¹³å‡åœºè¿‘ä¼¼çš„ä¼°è®¡ç»“æœä¸º$\sqrt{\frac{1-\beta_1}{1+\beta_1}}$ï¼Œå¹¶ä¸”éªŒè¯äº†å®ƒè·Ÿæ¨¡æ‹Ÿç»“æœå’Œå®é™…å®éªŒéƒ½å¾ˆå»åˆã€‚è¿™ä¸ªç»“æœæ˜¾å¼åœ°ä¾èµ–äº$\beta_1$ï¼Œæ‰€ä»¥å¾ˆæ˜æ˜¾ï¼Œå®ƒå°†æˆ‘ä»¬çš„æ€è€ƒæ–¹å‘å¼•å‘åŠ¨é‡ã€‚</p>
<p>è¿™å°±æœ‰äº†ä¸‹é¢çš„åˆ†æè¿‡ç¨‹ã€‚ç»¼ä¸‹æ‰€è¿°ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®è®¤ï¼Œ$\epsilon$çš„è§’è‰²ç¡®å®æ˜¯æ¬¡è¦çš„ï¼ŒçœŸæ­£çš„ä¸»è§’å…¶å®æ˜¯åŠ¨é‡â€”â€”å®ƒæ˜¯æ¢¯åº¦çš„â€œæ»‘åŠ¨å¹³å‡â€â€”â€”è¿™ä¹Ÿæ­£æ˜¯æœ¬æ–‡çš„ä¸»è§’â€œEMAï¼ˆExponential Moving Averageï¼‰â€ã€‚</p>
<h2 id="_2">æ¢¯åº¦ä¸‹é™</h2>
<p>ä¸ºäº†åˆ†æEMAå¸¦æ¥çš„å˜æ•°ï¼Œæˆ‘ä»¬ä»SGDMå…¥æ‰‹ï¼Œä¹Ÿå°±æ˜¯å¸¦åŠ¨é‡çš„SGDï¼Œå®é™…ä¸Šæˆ‘ä»¬åœ¨ç”¨SGDçš„æ—¶å€™æå°‘æƒ…å†µæ˜¯ä¸åŠ åŠ¨é‡çš„ï¼š<br />
\begin{equation}\begin{aligned}<br />
&amp;\boldsymbol{m}<em t-1="t-1">t = \beta_1 \boldsymbol{m}</em>} + \left(1 - \beta_1\right) \boldsymbol{g<em t-1="t-1">t \\\[4pt]<br />
&amp;\boldsymbol{w}_t = \boldsymbol{w}</em>} - \eta_t \boldsymbol{m<em B_t="B,t">t<br />
\end{aligned}\end{equation}<br />
å®é™…ä½¿ç”¨ä¸­ï¼Œ$\boldsymbol{g}_t$æ›¿æ¢ä¸º$\tilde{\boldsymbol{g}}</em>}$ï¼Œå®ƒæ˜¯ä¸€ä¸ªéšæœºå˜é‡ï¼Œå‡å€¼ä¸º$\boldsymbol{g<em B_t="B,t">t$ï¼Œåæ–¹å·®çŸ©é˜µä¸º$\boldsymbol{\Sigma}_t/B$ï¼Œè¿™äº›åŸºæœ¬è®¾ç½®è·Ÿ<a href="/archives/11260">ã€Šé‡æ–°æ€è€ƒå­¦ä¹ ç‡ä¸Batch Sizeï¼ˆä¸€ï¼‰ï¼šç°çŠ¶ã€‹</a>æ˜¯ä¸€æ ·çš„ã€‚è¿™é‡Œçš„å™ªå£°ï¼Œæ˜¯ç”±éšæœºé‡‡æ ·ä¸åŒçš„Batchå¼•èµ·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆç†åœ°å‡è®¾ï¼Œä¸åŒ$t$ä¹‹é—´çš„$\tilde{\boldsymbol{g}}</em>$æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚</p>
<p>æˆ‘ä»¬çš„ä»»åŠ¡ï¼Œæ˜¯è®¡ç®—<br />
\begin{equation}\newcommand{tr}{\mathop{\text{tr}}}\eta^* \approx \frac{\mathbb{E}[\tilde{\boldsymbol{\varphi}}<em s="1">B]^{\top}\boldsymbol{g}}{\tr(\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B\tilde{\boldsymbol{\varphi}}_B^{\top}]\boldsymbol{H})}\label{eq:eta-opt}\end{equation}<br />
ç›¸å…³æ¨å¯¼åœ¨å‰é¢å‡ ç¯‡æ–‡ç« å·²ç»ç»™å‡ºï¼Œè¿™é‡Œå°±ä¸å†é‡å¤ã€‚å¯¹äºSGDMæ¥è¯´$\tilde{\boldsymbol{\varphi}}_B = \boldsymbol{m}_t$ï¼Œå®ƒå¯ä»¥å±•å¼€æˆ<br />
\begin{equation}\boldsymbol{m}_t = (1 - \beta_1)\sum\limits</em>}^t \beta_1^{t-s}\tilde{\boldsymbol{g}}_{B,s}\end{equation</p>
<h2 id="_3">æ”¾å¤§æ‰¹é‡</h2>
<p>ç°åœ¨å¯ä»¥è®¡ç®—<br />
\begin{equation}\mathbb{E}[\boldsymbol{m}<em s="1">t] = (1 - \beta_1)\sum</em>}^t \beta_1^{t-s}\mathbb{E}[\tilde{\boldsymbol{g}<em s="1">{B,s}] = (1 - \beta_1)\sum</em>}^t \beta_1^{t-s}\boldsymbol{g<em s="1">s\end{equation}<br />
æˆ‘ä»¬è¿›ä¸€æ­¥å‡è®¾å½“æ¨¡å‹è®­ç»ƒè¿›å…¥â€œæ­£è½¨â€åï¼Œæ¢¯åº¦æ˜¯ç¼“å˜çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨å½“å‰æ¢¯åº¦$\boldsymbol{g}_t$è¿‘ä¼¼$\boldsymbol{g}_s$ï¼Œå¾—åˆ°<br />
\begin{equation}\mathbb{E}[\boldsymbol{m}_t] = (1 - \beta_1)\sum</em>}^t \beta_1^{t-s}\boldsymbol{g<em s="1">t = (1 - \beta_1^t) \boldsymbol{g}_t \approx \boldsymbol{g}_t \qquad (t\to\infty)\end{equation}<br />
è‡³äº$\mathbb{E}[\boldsymbol{m}_t \boldsymbol{m}_t^{\top}]$ï¼Œæˆ‘ä»¬åˆ©ç”¨æ’ç­‰å¼$\mathbb{E}[\boldsymbol{m}_t \boldsymbol{m}_t^{\top}] = \mathbb{E}[\boldsymbol{m}_t] \mathbb{E}[\boldsymbol{m}_t]^{\top} + \mathbb{C}\text{ov}[\boldsymbol{m}_t,\boldsymbol{m}_t]$ï¼Œç„¶ååˆ©ç”¨æ–¹å·®çš„å¯åŠ æ€§å¾—åˆ°ï¼š<br />
\begin{equation}\mathbb{C}\text{ov}[\boldsymbol{m}_t,\boldsymbol{m}_t] = (1 - \beta_1)^2\sum</em>}^t \beta_1^{2(t-s)}\boldsymbol{\Sigma<em s="1">s/B\end{equation}<br />
ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬å‡è®¾åæ–¹å·®çŸ©é˜µçš„ç¼“å˜æ€§ï¼Œé‚£ä¹ˆ<br />
\begin{equation}\mathbb{C}\text{ov}[\boldsymbol{m}_t] \approx (1 - \beta_1)^2\sum</em>}^t \beta_1^{2(t-s)}\boldsymbol{\Sigma<em _max="\max">t/B = (1 - \beta_1)^2\frac{1-\beta_1^{2t}}{1-\beta_1^2}\boldsymbol{\Sigma}_t/B = \frac{1 - \beta_1}{1 + \beta_1}\boldsymbol{\Sigma}_t/B \qquad (t\to\infty)\end{equation}<br />
ä»£å…¥å¼$\eqref{eq:eta-opt}$å¾—<br />
\begin{equation}\eta^* \approx \frac{\eta</em>}}{1 + \frac{1 - \beta_1}{1 + \beta_1}\mathcal{B<em _max="\max">{\text{noise}}/B},\qquad \eta</em>} = \frac{\boldsymbol{g}^{\top}\boldsymbol{g}}{\boldsymbol{g}^{\top}\boldsymbol{H}\boldsymbol{g}},\quad\mathcal{B}_{\text{noise}} = \frac{\tr(\boldsymbol{\Sigma}\boldsymbol{H})}{\boldsymbol{g}^{\top}\boldsymbol{H}\boldsymbol{g}}\end{equation<br />
ä»è¿™ä¸ªç»“æœå¯ä»¥çœ‹å‡ºï¼ŒåŠ¨é‡æœºåˆ¶çš„å¼•å…¥ï¼Œç›¸å½“äºæŠŠSGDçš„Batch Sizeæ”¾å¤§åˆ°äº†$\frac{1 + \beta_1}{1 - \beta_1}$å€ã€‚æŒ‰ç…§ç¬”è€…çš„ç†è§£ï¼ŒåŠ¨é‡å°±æ˜¯é€šè¿‡å¯¹ä¼˜åŒ–è½¨è¿¹ä¸Šçš„æ¢¯åº¦åšEMAæ¥ä½æˆæœ¬åœ°æ¶ˆé™¤æ¢¯åº¦å™ªå£°ï¼Œæ‰€ä»¥è¿™ä¸ªç»“æœè¿™è·Ÿç¬”è€…æ‰€ç†è§£çš„åŠ¨é‡æ„ä¹‰æ˜¯ç›¸ç¬¦çš„ã€‚</p>
<h2 id="_4">ç¬¦å·åŠ¨é‡</h2>
<p>è¿›ä¸€æ­¥åœ°ï¼Œæˆ‘ä»¬è€ƒè™‘SignSGDMï¼Œå®ƒå¯ä»¥è§†ä½œ<a href="/archives/9473">Lion</a>çš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œä¹Ÿå°±æ˜¯SGDMå¤šåŠ äº†ä¸ª$\newcommand{sign}{\mathop{\text{sign}}}\sign$ï¼š<br />
\begin{equation}\begin{aligned}<br />
&amp;\boldsymbol{m}<em t-1="t-1">t = \beta_1 \boldsymbol{m}</em>} + \left(1 - \beta_1\right) \boldsymbol{g<em t-1="t-1">t \\\[4pt]<br />
&amp;\boldsymbol{w}_t = \boldsymbol{w}</em>} - \eta_t \sign(\boldsymbol{m<em B_t="B,t">t)<br />
\end{aligned}\end{equation}<br />
å®é™…è®­ç»ƒä¸­$\boldsymbol{g}_t$åŒæ ·æ›¿æ¢ä¸º$\tilde{\boldsymbol{g}}</em>}$ã€‚å¯¹SignSGDMæ¥è¯´$\tilde{\boldsymbol{\varphi}<em _text_simple="\text{simple">B = \sign(\boldsymbol{m}_t)$ï¼Œé‚£ä¹ˆæ ¹æ®å¹³å‡åœºè¿‘ä¼¼å¾—<br />
\begin{equation}\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B] = \mathbb{E}\bigg[\frac{\boldsymbol{m}_t}{\sqrt{\boldsymbol{m}_t^2}}\bigg]\approx \frac{\mathbb{E}[\boldsymbol{m}_t]}{\sqrt{\mathbb{E}[\boldsymbol{m}_t^2]}}\end{equation}<br />
å…¶ä¸­å‘é‡ä¹˜æ³•é»˜è®¤æ˜¯Hadamardç§¯ã€‚åˆ†å­$\mathbb{E}[\boldsymbol{m}_t]$æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚å·²ç»ç®—äº†ï¼Œåˆ†æ¯$\mathbb{E}[\boldsymbol{m}_t^2]$å…¶å®ç­‰äº$\newcommand{diag}{\mathop{\text{diag}}}\diag(\mathbb{E}[\boldsymbol{m}_t \boldsymbol{m}_t^{\top}])$ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ä»£å…¥ä¸Šä¸€èŠ‚çš„ç»“æœï¼Œå¾—åˆ°<br />
\begin{equation}\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B] \approx \frac{\boldsymbol{g}_t}{\sqrt{\boldsymbol{g}_t^2 + \frac{1 - \beta_1}{1 + \beta_1}\boldsymbol{\sigma}_t^2/B}} = \frac{\sign(\boldsymbol{g}_t)}{\sqrt{1 + \frac{1 - \beta_1}{1 + \beta_1}(\boldsymbol{\sigma}_t^2/\boldsymbol{g}_t^2)/B}} \approx \frac{\sign(\boldsymbol{g}_t)}{\sqrt{1 + \frac{1 - \beta_1}{1 + \beta_1} \mathcal{B}</em>}}/B}}\end{equation<br />
å…¶ä¸­$\boldsymbol{\sigma}<em _text_simple="\text{simple">t^2 = \diag(\boldsymbol{\Sigma}_t), \mathcal{B}</em>$å€ã€‚}} = \tr(\boldsymbol{\Sigma}_t)/\boldsymbol{g}_t^{\top}\boldsymbol{g}_t$ã€‚ä¸Šå¼ç›¸å½“äºSignSGDçš„$B$æ¢æˆäº†$\frac{1 + \beta_1}{1 - \beta_1}B$ï¼Œå¦‚æœæˆ‘ä»¬è¿›ä¸€æ­¥è®¡ç®—$\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B\tilde{\boldsymbol{\varphi}}_B^{\top}]$å°±ä¼šå‘ç°ç»“è®ºä¹Ÿæ˜¯å¦‚æ­¤ã€‚æ‰€ä»¥ï¼Œè·ŸSGDMä¸€æ ·ï¼ŒåŠ¨é‡ç›¸å½“äºæŠŠSignSGDçš„Batch Sizeæ”¾å¤§åˆ°äº†$\frac{1 + \beta_1}{1 - \beta_1</p>
<p>åœ¨<a href="/archives/11285">ã€Šé‡æ–°æ€è€ƒå­¦ä¹ ç‡ä¸Batch Sizeï¼ˆä¸‰ï¼‰ï¼šMuonã€‹</a>ä¸­æˆ‘ä»¬è®¡ç®—è¿‡Muonçš„å­¦ä¹ ç‡è§„å¾‹ï¼Œå‘ç°å®ƒè·ŸSignSGDä¸€è‡´ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ–­è¨€ï¼ŒåŠ¨é‡åœ¨Muonä¸­çš„ä½œç”¨è·ŸSignSGDMä¸€æ ·ï¼Œéƒ½çº¦ç­‰äºå°†Batch Sizeæ”¾å¤§æˆ$\frac{1 + \beta_1}{1 - \beta_1}$å€ã€‚</p>
<h2 id="_5">åŒé‡æ»‘åŠ¨</h2>
<p>æœ€åæˆ‘ä»¬æ¥çœ‹Adamï¼š<br />
\begin{equation}\begin{aligned}<br />
&amp;\boldsymbol{m}<em t-1="t-1">t = \beta_1 \boldsymbol{m}</em>} + \left(1 - \beta_1\right) \boldsymbol{g<em t-1="t-1">t\\\<br />
&amp;\boldsymbol{v}_t = \beta_2 \boldsymbol{v}</em>} + \left(1 - \beta_2\right) \boldsymbol{g<em t-1="t-1">t^2\\\<br />
&amp;\hat{\boldsymbol{m}}_t = \boldsymbol{m}_t\left/\left(1 - \beta_1^t\right)\right.\\\<br />
&amp;\hat{\boldsymbol{v}}_t = \boldsymbol{v}_t\left/\left(1 - \beta_2^t\right)\right.\\\<br />
&amp;\boldsymbol{\theta}_t = \boldsymbol{\theta}</em>} - \eta_t \hat{\boldsymbol{m}<em B_t="B,t">t\left/\left(\sqrt{\hat{\boldsymbol{v}}_t} + \epsilon\right)\right.<br />
\end{aligned}\end{equation}<br />
å®é™…è®­ç»ƒä¸­$\boldsymbol{g}_t$æ›¿æ¢ä¸º$\tilde{\boldsymbol{g}}</em>_t$ã€‚}$ã€‚æˆ‘ä»¬è€ƒè™‘çš„éƒ½æ˜¯è®­ç»ƒå·²ç»è¿›å…¥â€œæ­£è½¨â€çš„çŠ¶æ€ï¼Œå³$t\to\infty$ï¼Œæ‰€ä»¥ä¸åŒºåˆ†$\boldsymbol{m}_t$å’Œ$\hat{\boldsymbol{m}}_t$ã€$\boldsymbol{v}_t$å’Œ$\hat{\boldsymbol{v}}_t$ï¼ŒåŒæ—¶æˆ‘ä»¬èšç„¦äºEMAçš„ä½œç”¨ï¼Œæ‰€ä»¥è®¾$\epsilon = 0$ã€‚é‚£ä¹ˆå¯¹äºAdamæ¥è¯´æœ‰$\tilde{\boldsymbol{\varphi}}_B=\boldsymbol{m}_t/\sqrt{\boldsymbol{v}_t}$ï¼Œå®ƒè·ŸSignSGDMçš„åŒºåˆ«ï¼Œå°±æ˜¯åˆ†æ¯çš„$\boldsymbol{m}_t^2$æ¢æˆäº†å¦ä¸€ä¸ªEMAçš„ç»Ÿè®¡é‡$\boldsymbol{v</p>
<p>ç”±å¹³å‡åœºè¿‘ä¼¼å¾—<br />
\begin{equation}\mathbb{E}[\tilde{\boldsymbol{\varphi}}<em s="1">B] = \mathbb{E}\bigg[\frac{\boldsymbol{m}_t}{\sqrt{\boldsymbol{v}_t}}\bigg]\approx \frac{\mathbb{E}[\boldsymbol{m}_t]}{\sqrt{\mathbb{E}[\boldsymbol{v}_t]}}\end{equation}<br />
$\mathbb{E}[\boldsymbol{m}_t]$æˆ‘ä»¬å·²ç»ç®—è¿‡ï¼Œåªéœ€ç®—$\mathbb{E}[\boldsymbol{v}_t]$ï¼š<br />
\begin{equation}\mathbb{E}[\boldsymbol{v}_t] = (1 - \beta_2)\sum</em>}^t \beta_2^{t-s}\mathbb{E}[\tilde{\boldsymbol{g}<em s="1">{B,s}^2] = (1 - \beta_2)\sum</em>}^t \beta_2^{t-s}(\boldsymbol{g<em _text_simple="\text{simple">s^2 + \boldsymbol{\sigma}_s^2/B)\approx \boldsymbol{g}_t^2 + \boldsymbol{\sigma}_t^2/B\end{equation}<br />
è·Ÿå‰é¢ä¸€æ ·ï¼Œæœ€åä¸€ä¸ªçº¦ç­‰å·å‡è®¾äº†æ¢¯åº¦å’Œæ–¹å·®çš„ç¼“å˜æ€§ï¼Œä»¥åŠ$t\to\infty$ã€‚äºæ˜¯æˆ‘ä»¬æœ‰<br />
\begin{equation}\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B] \approx \frac{\boldsymbol{g}_t}{\sqrt{\boldsymbol{g}_t^2 + \boldsymbol{\sigma}_t^2/B}} \approx \frac{\sign(\boldsymbol{g}_t)}{\sqrt{1 + \mathcal{B}</em>}}/B}}\end{equation<br />
è¿™ä¸ªç»“æœå€’æ˜¯è·ŸSignSGDç›¸åŒï¼Œæ‰€ä»¥å•ä»ä¸€é˜¶çŸ©çœ‹ï¼ŒSignSGDä½œä¸ºAdamçš„è¿‘ä¼¼æ˜¯åˆç†çš„ã€‚ä½†æˆ‘ä»¬è¿˜æœ‰äºŒé˜¶çŸ©$\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B \tilde{\boldsymbol{\varphi}}_B^{\top}]$ï¼Œåœ¨åˆ†é‡ç‹¬ç«‹çš„å‡è®¾ä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦ç®—$\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B^2]$ï¼š<br />
\begin{equation}\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B^2] = \mathbb{E}\bigg[\frac{\boldsymbol{m}_t^2}{\boldsymbol{v}_t}\bigg]\approx \frac{\mathbb{E}[\boldsymbol{m}_t^2]}{\mathbb{E}[\boldsymbol{v}_t]} \approx \frac{\boldsymbol{g}_t^2 + \frac{1 - \beta_1}{1 + \beta_1}\boldsymbol{\sigma}_t^2/B}{\boldsymbol{g}_t^2 + \boldsymbol{\sigma}_t^2/B}\label{eq:u2-adam}\end{equation}</p>
<h2 id="_6">ä¸¤ä¸ªç‰¹ä¾‹</h2>
<p>æˆ‘ä»¬è§‚å¯Ÿä¸¤ä¸ªç‰¹ä¾‹ã€‚é¦–å…ˆæ˜¯$\beta_1=0$ï¼Œè¿™æ—¶å€™åˆ†å­åˆ†æ¯ç›¸åŒï¼Œ$\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B^2]$æ˜¯å…¨1å‘é‡ï¼Œè·ŸSignSGDä¸€è‡´ã€‚æ‰€ä»¥è¯´ï¼ŒSignSGDæ˜¯$\beta_1=0$çš„Adamâ€”â€”ä¹Ÿå°±æ˜¯<a href="https://www.cs.toronto.edu/~tijmen/csc321/slides/lecture_slides_lec6.pdf">RMSProp</a>â€”â€”çš„è‰¯å¥½è¿‘ä¼¼ï¼Œå½“$\beta_1$å¢å¤§æ—¶ï¼Œè¿‘ä¼¼ç¨‹åº¦å¼€å§‹å˜å·®ã€‚</p>
<p>å½“$\beta_1=1$æ—¶ï¼Œæˆ‘ä»¬æœ‰<br />
\begin{equation}\mathbb{E}[\tilde{\boldsymbol{\varphi}}<em _text_simple="\text{simple">B^2] \approx \frac{\boldsymbol{g}_t^2}{\boldsymbol{g}_t^2 + \boldsymbol{\sigma}_t^2/B}\approx \mathbb{E}[\tilde{\boldsymbol{\varphi}}_B]^2\end{equation}<br />
ç”±æ­¤å¾—åˆ°$\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B \tilde{\boldsymbol{\varphi}}_B^{\top}] \approx \mathbb{E}[\tilde{\boldsymbol{\varphi}}_B] \mathbb{E}[\tilde{\boldsymbol{\varphi}}_B]^{\top}$ï¼Œä»£å…¥åˆ°å¼$\eqref{eq:eta-opt}$å¾—<br />
\begin{equation}\eta^* \approx \frac{\Vert \boldsymbol{g}\Vert_1 \sqrt{1 + \mathcal{B}</em>}}/B}}{\sign(\boldsymbol{g})^{\top} \boldsymbol{H} \sign(\boldsymbol{g})}\end{equation<br />
æ³¨æ„ï¼Œå®ƒæ˜¯å…³äº$B$çš„å•è°ƒé€’å‡å‡½æ•°ï¼Œå³å½“Batch Sizeå¢å¤§æ—¶å­¦ä¹ ç‡åº”è¯¥å‡å°ã€‚ç”±æ­¤æˆ‘ä»¬å¯ä»¥æ¨æµ‹ï¼ŒAdamçš„$\beta_1$çš„å¢å¤§ï¼Œå°†ä¼šåŠ é€Ÿâ€œ<a href="/archives/11280#%E5%8F%8D%E5%B8%B8%E7%8E%B0%E8%B1%A1">Surgeç°è±¡</a>â€çš„å‡ºç°ã€‚</p>
<p>è¿™ä¸ªç»“è®ºçœ‹ä¼¼æœ‰ç‚¹è´¹è§£ï¼Œä½†å…¶å®æ¢ä¸ªè§’åº¦å°±å®¹æ˜“ç†è§£äº†ã€‚â€œSurgeç°è±¡â€æŒ‡å½“Batch Sizeè¶…è¿‡æŸä¸ªé˜ˆå€¼åï¼Œæœ€ä¼˜å­¦ä¹ ç‡éšç€Batch Sizeçš„å¢å¤§è€Œå‡å°‘ï¼Œè€Œå‰é¢SGDMã€SignSGDMçš„ç»“æœéƒ½è¡¨æ˜ï¼ŒåŠ¨é‡çš„å¼•å…¥çº¦ç­‰äºå°†Batch Sizeæ‰©å¤§åˆ°$\frac{1 + \beta_1}{1 - \beta_1} &gt; 1$å€ï¼Œè¿™è‡ªç„¶å¢åŠ äº†è¶…è¿‡é˜ˆå€¼çš„å¯èƒ½æ€§ã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œâ€œéšç€$\beta_1$çš„å¢å¤§ï¼Œâ€˜Surgeç°è±¡â€™å°†æ›´å®¹æ˜“å‡ºç°â€çš„ç»“è®ºï¼Œå³ä¾¿å¯¹äºSignSGDMä¹Ÿæ˜¯æˆç«‹çš„ã€‚è€ŒAdamç›¸æ¯”SignSGDMæœ‰ä¸€äº›æ–°çš„ç‰¹æ€§ï¼Œä½†â€œåŠ¨é‡æœºåˆ¶çº¦ç­‰äºæ”¾å¤§Batch Sizeâ€è¿™ä¸€ç‚¹å§‹ç»ˆæ˜¯æˆç«‹çš„ï¼Œæ‰€ä»¥å‡ºç°åŒæ ·çš„ç»“è®ºå°±ä¸éš¾ç†è§£äº†ã€‚</p>
<h2 id="_7">ä¸€èˆ¬åˆ†æ</h2>
<p>æˆ‘ä»¬æ”¹å†™ä¸€ä¸‹å¼$\eqref{eq:u2-adam}$ï¼š<br />
\begin{equation}\mathbb{E}[\tilde{\boldsymbol{\varphi}}<em i_i="i,i">B^2] \approx \frac{\boldsymbol{g}_t^2 + \frac{1 - \beta_1}{1 + \beta_1}\boldsymbol{\sigma}_t^2/B}{\boldsymbol{g}_t^2 + \boldsymbol{\sigma}_t^2/B} = \frac{2\beta_1}{1+\beta_1}\frac{\boldsymbol{g}_t^2}{\boldsymbol{g}_t^2 + \boldsymbol{\sigma}_t^2/B} + \frac{1 - \beta_1}{1 + \beta_1} \approx \frac{2\beta_1}{1+\beta_1}\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B]^2 + \frac{1 - \beta_1}{1 + \beta_1}\end{equation}<br />
ç”±æ­¤æˆ‘ä»¬å¯ä»¥å†™å‡º<br />
\begin{equation}\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B \tilde{\boldsymbol{\varphi}}_B^{\top}] \approx \mathbb{E}[\tilde{\boldsymbol{\varphi}}_B] \mathbb{E}[\tilde{\boldsymbol{\varphi}}_B]^{\top} + \frac{1 - \beta_1}{1 + \beta_1}\diag\left(1 - \mathbb{E}[\tilde{\boldsymbol{\varphi}}_B]^2\right)\end{equation}<br />
é‚£ä¹ˆ<br />
\begin{equation}\eta^<em> \approx \frac{\sum_i |g_i|}{\frac{1}{\beta}\frac{1 - \beta_1}{1 + \beta_1}\sum_i H_{i,i} + \beta\left(\sum_{i,j} H_{i,j}\sign(g_i g_j) - \frac{1 - \beta_1}{1 + \beta_1}\sum_i H_{i,i}\right)}\end{equation}<br />
è¿™é‡Œæ²¡æœ‰ä¸‹æ ‡çš„$\beta$ç­‰äº$(1 + \mathcal{B}_{\text{simple}}/B)^{-1/2}$ï¼Œä¸ä»”ç»†çœ‹çš„è¯å¯èƒ½ä¼šè·Ÿ$\beta_1,\beta_2$æ··æ·†ï¼Œç¬”è€…è¡¨ç¤ºå¾ˆæŠ±æ­‰ï¼Œå› ä¸ºè¿™æ˜¯å‰ä¸¤ç¯‡æ–‡ç« çš„è®°å·ï¼Œè¿™é‡Œåªå¥½æ²¿ç”¨äº†ã€‚è·ŸSignSGDä¸åŒçš„æ˜¯ï¼ŒSignSGDå¦‚æœå‡è®¾HessiançŸ©é˜µæ˜¯å¯¹è§’é˜µï¼Œé‚£ä¹ˆå°±ä¸ä¼šå‡ºç°Surgeç°è±¡ï¼Œä½†ä¸Šå¼å³ä¾¿æ˜¯åœ¨å¯¹è§’Hessianå‡è®¾ä¸‹ä¾ç„¶å‡ºç°Surgeç°è±¡ï¼Œæ­¤æ—¶ï¼š<br />
\begin{equation}\eta^</em> \approx \frac{\sum_i |g_i|}{\left(\frac{1}{\beta}\frac{1 - \beta_1}{1 + \beta_1} + \beta\frac{2\beta_1}{1 + \beta_1}\right)\sum_i H</em>}}\end{equation<br />
ç”±å‡å€¼ä¸ç­‰å¼çŸ¥ä¸Šå¼åœ¨$\beta^<em>=\sqrt{\frac{1-\beta_1}{2\beta_1}}$å¤„å–åˆ°æœ€å¤§å€¼ï¼Œä½†è¦æ³¨æ„æ ¹æ®$\beta$å®šä¹‰ï¼Œå®ƒæ˜¯$\in(0,1)$çš„ï¼Œæ‰€ä»¥è¿˜è¦åˆ¤æ–­$\beta^</em>\in(0,1)$ï¼Œå³$\beta_1 &gt; 1/3$ï¼Œä¸æ»¡è¶³è¿™ä¸ªæ¡ä»¶æ—¶æœ€å¤§å€¼ä¾ç„¶åœ¨$\beta=1$å–åˆ°ï¼Œæ­¤æ—¶æ²¡æœ‰Surgeç°è±¡ã€‚åä¹‹ï¼Œå½“$\beta_1 &gt; 1/3$ä¸”$\beta &gt; \beta^*$ï¼ˆå³$B &gt; \frac{1-\beta_1}{3\beta_1-1}\mathcal{B}_{\text{simple}}$ï¼‰æ—¶ï¼Œå­¦ä¹ ç‡åº”è¯¥éšç€Batch Sizeçš„å¢åŠ è€Œå‡å°ã€‚</p>
<p>è¿™ä¸ªç»“è®ºå¯ä»¥åˆæ­¥è§£é‡Šä¸ºå•¥Muonèƒ½æ”¯æŒæ›´å¤§Batch Sizeã€‚ç”±<a href="/archives/11285">ã€Šé‡æ–°æ€è€ƒå­¦ä¹ ç‡ä¸Batch Sizeï¼ˆä¸‰ï¼‰ï¼šMuonã€‹</a>å¯çŸ¥ï¼ŒMuonçš„è¡¨ç°è·ŸSignSGDMç±»ä¼¼ï¼Œåœ¨ç‰¹å®šHessianç»“æ„å‡è®¾ä¸‹å®ƒä¸ä¼šå‡ºç°Surgeç°è±¡ï¼Œè¿™æ„å‘³ç€å¢å¤§Batch Sizeæ€»å¯ä»¥æé«˜å­¦ä¹ æ•ˆç‡ï¼Œå°½ç®¡ç›¸å¯¹æ”¶ç›Šä¼šè¶Šæ¥è¶Šå°ã€‚</p>
<p>ç›¸åï¼ŒAdamåœ¨å¸¸ç”¨è®¾ç½®ï¼ˆå¦‚$\beta_1=0.9$ï¼‰ä¸‹ï¼Œå“ªæ€•å‡è®¾Hessianæ˜¯å¯¹è§’é˜µä¹Ÿä¼šå‡ºç°Surgeç°è±¡ï¼Œè¿™æ„å‘³ç€Batch Sizeè¶…è¿‡ä¸€å®šå€¼åï¼Œå­¦ä¹ æ•ˆç‡å°±ä¸‹é™äº†ã€‚</p>
<h2 id="_8">æ–‡ç« å°ç»“</h2>
<p>æœ¬æ–‡åˆæ­¥åˆ†æäº†ä¼˜åŒ–å™¨çš„EMAæœºåˆ¶å¯¹å­¦ä¹ ç‡ä¸Batch Sizeçš„å°ºåº¦å®šå¾‹çš„å½±å“ï¼Œç¡®è®¤äº†EMAç‰¹åˆ«æ˜¯åŠ¨é‡æœºåˆ¶çš„å¼•å…¥ä¼šç¨å¾®æ”¹å˜å°ºåº¦å®šå¾‹ï¼Œè€ŒAdamè¿™ç§å¸¦æœ‰åŒé‡EMAè¿ç®—çš„ä¼˜åŒ–å™¨ï¼Œåˆ™ä¼šå‘ˆç°å‡ºä¸€äº›è·ŸSignSGDä¸åŒçš„æ–°ç‰¹æ€§ã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/11301">https://spaces.ac.cn/archives/11301</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Sep. 22, 2025). ã€Šé‡æ–°æ€è€ƒå­¦ä¹ ç‡ä¸Batch Sizeï¼ˆå››ï¼‰ï¼šEMA ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/11301">https://spaces.ac.cn/archives/11301</a></p>
<p>@online{kexuefm-11301,<br />
title={é‡æ–°æ€è€ƒå­¦ä¹ ç‡ä¸Batch Sizeï¼ˆå››ï¼‰ï¼šEMA},<br />
author={è‹å‰‘æ—},<br />
year={2025},<br />
month={Sep},<br />
url={\url{https://spaces.ac.cn/archives/11301}},<br />
} </p>
<hr />
<h2 id="_9">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<h3 id="1">1. çº¿æ€§ç¼©æ”¾è§„åˆ™çš„ç†è®ºåŸºç¡€</h3>
<h4 id="11">1.1 å™ªå£°å°ºåº¦ç†è®º</h4>
<p>è€ƒè™‘mini-batchæ¢¯åº¦ä¼°è®¡:
\begin{equation}\tilde{\boldsymbol{g}}<em i="1">B = \frac{1}{B}\sum</em>}^B \nabla L(\boldsymbol{x}_i; \boldsymbol{\theta})\tag{1}\end{equation</p>
<p><strong>æœŸæœ›</strong>: $\mathbb{E}[\tilde{\boldsymbol{g}}<em _boldsymbol_x="\boldsymbol{x">B] = \boldsymbol{g}$,å…¶ä¸­$\boldsymbol{g} = \mathbb{E}</em>)]$}}[\nabla L(\boldsymbol{x}; \boldsymbol{\theta</p>
<p><strong>æ–¹å·®</strong>: ç”±ä¸­å¿ƒæé™å®šç†,
\begin{equation}\text{Cov}[\tilde{\boldsymbol{g}}_B] = \frac{\boldsymbol{\Sigma}}{B}\tag{2}\end{equation}</p>
<p>å…¶ä¸­$\boldsymbol{\Sigma} = \mathbb{E}[(\nabla L - \boldsymbol{g})(\nabla L - \boldsymbol{g})^{\top}]$æ˜¯å•æ ·æœ¬æ¢¯åº¦çš„åæ–¹å·®çŸ©é˜µã€‚</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>: Batch sizeè¶Šå¤§,æ¢¯åº¦ä¼°è®¡çš„æ–¹å·®è¶Šå°,å™ªå£°æŒ‰$1/\sqrt{B}$è¡°å‡ã€‚</p>
<h4 id="12-sgdsde">1.2 SGDçš„ç¦»æ•£åŒ–SDEè¿‘ä¼¼</h4>
<p>å°†SGDè§†ä¸ºéšæœºå¾®åˆ†æ–¹ç¨‹(SDE)çš„ç¦»æ•£åŒ–:
\begin{equation}d\boldsymbol{\theta} = -\boldsymbol{g}(\boldsymbol{\theta})dt + \sqrt{2\eta\boldsymbol{\Sigma}/B}d\boldsymbol{W}\tag{3}\end{equation}</p>
<p>å…¶ä¸­$d\boldsymbol{W}$æ˜¯Wienerè¿‡ç¨‹(å¸ƒæœ—è¿åŠ¨)ã€‚</p>
<p><strong>ç¦»æ•£åŒ–</strong>:
\begin{equation}\boldsymbol{\theta}<em B_t="B,t">{t+1} = \boldsymbol{\theta}_t - \eta\tilde{\boldsymbol{g}}</em>}\tag{4}\end{equation</p>
<p>å¯¹åº”äºEuler-Maruyamaç¦»æ•£åŒ–,æ—¶é—´æ­¥é•¿$dt = \eta$ã€‚</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>: SGDåœ¨å‚æ•°ç©ºé—´çš„è½¨è¿¹ç±»ä¼¼äºå¸¦æ¼‚ç§»é¡¹çš„å¸ƒæœ—è¿åŠ¨,å™ªå£°å¼ºåº¦ç”±$\eta/B$å†³å®šã€‚</p>
<h4 id="13">1.3 å¹³è¡¡ç‚¹åˆ†æ</h4>
<p>åœ¨å¹³è¡¡æ€é™„è¿‘,æŸå¤±å‡½æ•°å¯ä»¥äºŒæ¬¡è¿‘ä¼¼:
\begin{equation}L(\boldsymbol{\theta}) \approx L(\boldsymbol{\theta}^<em>) + \frac{1}{2}(\boldsymbol{\theta} - \boldsymbol{\theta}^</em>)^{\top}\boldsymbol{H}(\boldsymbol{\theta} - \boldsymbol{\theta}^*)\tag{5}\end{equation}</p>
<p>å…¶ä¸­$\boldsymbol{H}$æ˜¯HessiançŸ©é˜µã€‚</p>
<p><strong>å¹³è¡¡åˆ†å¸ƒ</strong>: å½“$\eta$è¶³å¤Ÿå°,SDE(3)çš„å¹³è¡¡åˆ†å¸ƒæ˜¯Gibbsåˆ†å¸ƒ:
\begin{equation}p(\boldsymbol{\theta}) \propto \exp\left(-\frac{B}{\eta}L(\boldsymbol{\theta})\right)\tag{6}\end{equation}</p>
<p><strong>æ¸©åº¦</strong>: å®šä¹‰æœ‰æ•ˆæ¸©åº¦$T = \eta/B$,åˆ™:
\begin{equation}p(\boldsymbol{\theta}) \propto \exp\left(-\frac{L(\boldsymbol{\theta})}{T}\right)\tag{7}\end{equation}</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>: $\eta/B$å†³å®šäº†SGDæ¢ç´¢å‚æ•°ç©ºé—´çš„"æ¸©åº¦"ã€‚ç›¸åŒæ¸©åº¦ä¸‹,SGDæ”¶æ•›åˆ°ç›¸ä¼¼çš„è§£ã€‚</p>
<h4 id="14">1.4 çº¿æ€§ç¼©æ”¾è§„åˆ™çš„æ¨å¯¼</h4>
<p>è‹¥å¸Œæœ›ä¿æŒç›¸åŒçš„å¹³è¡¡åˆ†å¸ƒ,å½“$B \to kB$æ—¶,éœ€è¦:
\begin{equation}\frac{\eta'}{kB} = \frac{\eta}{B} \Rightarrow \eta' = k\eta\tag{8}\end{equation}</p>
<p><strong>å®šç†1</strong>(çº¿æ€§ç¼©æ”¾è§„åˆ™): è‹¥Batch sizeä»$B$å¢åŠ åˆ°$kB$,ä¸ºä¿æŒç›¸åŒçš„æ”¶æ•›è¡Œä¸º,å­¦ä¹ ç‡åº”ä»$\eta$å¢åŠ åˆ°$k\eta$ã€‚</p>
<p><strong>é€‚ç”¨èŒƒå›´</strong>: è¯¥è§„åˆ™åœ¨ä»¥ä¸‹æ¡ä»¶ä¸‹æˆç«‹:
1. $B$è¶³å¤Ÿå¤§,CLTæˆç«‹
2. $\eta$è¶³å¤Ÿå°,SDEè¿‘ä¼¼æœ‰æ•ˆ
3. è®­ç»ƒæœªè¿›å…¥å¼ºå™ªå£°ä¸»å¯¼çš„regime</p>
<h3 id="2-batch-size">2. ä¸´ç•ŒBatch Sizeç†è®º</h3>
<h4 id="21">2.1 å™ªå£°å°ºåº¦ä¸æ¢¯åº¦å°ºåº¦çš„æ¯”è¾ƒ</h4>
<p>å®šä¹‰<strong>å™ªå£°å°ºåº¦</strong>(noise scale):
\begin{equation}\mathcal{B}_{noise} = \frac{\text{tr}(\boldsymbol{\Sigma}\boldsymbol{H})}{\boldsymbol{g}^{\top}\boldsymbol{H}\boldsymbol{g}}\tag{9}\end{equation}</p>
<p><strong>ç‰©ç†æ„ä¹‰</strong>: å™ªå£°åœ¨Hessianåº¦é‡ä¸‹ä¸æ¢¯åº¦çš„ç›¸å¯¹å¼ºåº¦ã€‚</p>
<h4 id="22-batch-size">2.2 ä¸´ç•ŒBatch Sizeçš„å®šä¹‰</h4>
<p><strong>å®šä¹‰</strong>: ä¸´ç•Œbatch size $B_c$æ˜¯ä½¿æ¢¯åº¦å™ªå£°ä¸æ¢¯åº¦ä¿¡å·ç›¸å½“çš„batch size:
\begin{equation}B_c = \mathcal{B}_{noise} = \frac{\text{tr}(\boldsymbol{\Sigma}\boldsymbol{H})}{\boldsymbol{g}^{\top}\boldsymbol{H}\boldsymbol{g}}\tag{10}\end{equation}</p>
<p><strong>ç®€åŒ–ç‰ˆæœ¬</strong>: è‹¥å‡è®¾$\boldsymbol{\Sigma} \propto \boldsymbol{g}\boldsymbol{g}^{\top}$(Assumption åœ¨è®­ç»ƒåˆæœŸè¿‘ä¼¼æˆç«‹):
\begin{equation}B_c^{simple} = \frac{\text{tr}(\boldsymbol{\Sigma})}{\boldsymbol{g}^{\top}\boldsymbol{g}} = \frac{\text{tr}(\boldsymbol{\Sigma})}{|\boldsymbol{g}|^2}\tag{11}\end{equation}</p>
<h4 id="23-batch-size">2.3 æœ€ä¼˜å­¦ä¹ ç‡ä¸Batch Sizeçš„å…³ç³»</h4>
<p>åŸºäºäºŒé˜¶Taylorå±•å¼€,æœ€ä¼˜å­¦ä¹ ç‡ä¸º:
\begin{equation}\eta^* \approx \frac{\eta_{max}}{1 + \mathcal{B}_{noise}/B}\tag{12}\end{equation}</p>
<p>å…¶ä¸­$\eta_{max} = \frac{\boldsymbol{g}^{\top}\boldsymbol{g}}{\boldsymbol{g}^{\top}\boldsymbol{H}\boldsymbol{g}}$æ˜¯æ— å™ªå£°æƒ…å†µä¸‹çš„æœ€ä¼˜å­¦ä¹ ç‡ã€‚</p>
<p><strong>åˆ†æ</strong>:
- <strong>å°batch regime</strong> ($B \ll B_c$): $\eta^<em> \approx \frac{\eta_{max}B}{\mathcal{B}_{noise}}$,å­¦ä¹ ç‡çº¿æ€§ç¼©æ”¾
- </em><em>å¤§batch regime</em><em> ($B \gg B_c$): $\eta^</em> \approx \eta_{max}$,å­¦ä¹ ç‡é¥±å’Œ</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>: å½“$B &gt; B_c$æ—¶,ç»§ç»­å¢å¤§batch sizeçš„è¾¹é™…æ”¶ç›Šé€’å‡,è¿™å°±æ˜¯"surgeç°è±¡"çš„æ ¹æºã€‚</p>
<h4 id="24">2.4 è®­ç»ƒæ—¶é—´åˆ†æ</h4>
<p><strong>æ¯æ­¥è®¡ç®—æˆæœ¬</strong>: æ­£æ¯”äº$B$
<strong>æ”¶æ•›æ­¥æ•°</strong>: åæ¯”äº$\eta^*$</p>
<p><strong>æ€»è®¡ç®—æˆæœ¬</strong>:
\begin{equation}Cost \propto \frac{B}{\eta^*} \approx \begin{cases}
\text{const}, &amp; B \ll B_c \
B/\eta_{max}, &amp; B \gg B_c
\end{cases}\tag{13}\end{equation}</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>: åœ¨$B &lt; B_c$æ—¶,å¢å¤§batch sizeå¯ä»¥ä¿æŒæ€»æˆæœ¬ä¸å˜(çº¿æ€§ç¼©æ”¾);è¶…è¿‡$B_c$å,æ€»æˆæœ¬çº¿æ€§å¢åŠ ã€‚</p>
<h3 id="3">3. åŠ¨é‡æœºåˆ¶çš„å½±å“</h3>
<h4 id="31-sgdmbatch-size">3.1 SGDMçš„ç­‰æ•ˆBatch Size</h4>
<p>ä»ä¸»æ–‡æ¡£å¼(54)-(57),åŠ¨é‡çš„EMAæœºåˆ¶ç›¸å½“äºå¯¹ä¼˜åŒ–è½¨è¿¹ä¸Šçš„æ¢¯åº¦åšå¹³å‡:
\begin{equation}\boldsymbol{m}<em s="1">t = (1-\beta_1)\sum</em>}^t \beta_1^{t-s}\tilde{\boldsymbol{g}}_{B,s}\tag{14}\end{equation</p>
<p><strong>æœ‰æ•ˆæ ·æœ¬æ•°</strong>: è€ƒè™‘EMAçš„æœ‰æ•ˆçª—å£é•¿åº¦:
\begin{equation}T_{eff} = \sum_{s=0}^{\infty}\beta_1^s = \frac{1}{1-\beta_1}\tag{15}\end{equation}</p>
<p><strong>ç­‰æ•ˆbatch size</strong>:
\begin{equation}B_{eff} = B \cdot \frac{1+\beta_1}{1-\beta_1}\tag{16}\end{equation}</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>: åŠ¨é‡é€šè¿‡æ—¶é—´ç»´åº¦çš„å¹³å‡,å°†æœ‰æ•ˆbatch sizeæ”¾å¤§äº†$\frac{1+\beta_1}{1-\beta_1}$å€ã€‚</p>
<h4 id="32-adamema">3.2 Adamçš„åŒé‡EMA</h4>
<p>AdamåŒæ—¶å¯¹ä¸€é˜¶å’ŒäºŒé˜¶çŸ©è¿›è¡ŒEMA:
\begin{equation}\boldsymbol{m}<em t-1="t-1">t = \beta_1\boldsymbol{m}</em>} + (1-\beta_1)\tilde{\boldsymbol{g}<em t-1="t-1">t, \quad \boldsymbol{v}_t = \beta_2\boldsymbol{v}</em>} + (1-\beta_2)\tilde{\boldsymbol{g}}_t^2\tag{17}\end{equation</p>
<p><strong>æ›´æ–°æ–¹å‘</strong>: $\tilde{\boldsymbol{\varphi}}_B = \boldsymbol{m}_t/\sqrt{\boldsymbol{v}_t}$</p>
<p>ä»ä¸»æ–‡æ¡£å¼(91):
\begin{equation}\mathbb{E}[\tilde{\boldsymbol{\varphi}}_B] \approx \frac{\boldsymbol{g}}{\sqrt{\boldsymbol{g}^2 + \boldsymbol{\sigma}^2/B}}\tag{18}\end{equation}</p>
<p><strong>ä¸´ç•Œbatch sizeè°ƒæ•´</strong>: Adamçš„$B_c$æ¯”SGDå°,å› ä¸ºäºŒé˜¶çŸ©çš„å½’ä¸€åŒ–å‰Šå¼±äº†å™ªå£°å½±å“ã€‚</p>
<h3 id="4-scaling-law">4. ä¸åŒä¼˜åŒ–å™¨çš„Scaling Law</h3>
<h4 id="41-sgd">4.1 SGDçš„ç¼©æ”¾è§„å¾‹</h4>
<p><strong>æœ€ä¼˜å­¦ä¹ ç‡</strong>:
\begin{equation}\eta_{SGD}^* = \frac{2}{L + \mu} \cdot \frac{1}{1 + B_c/B}\tag{19}\end{equation}</p>
<p>å…¶ä¸­$L$æ˜¯å…‰æ»‘å¸¸æ•°,$\mu$æ˜¯å¼ºå‡¸å¸¸æ•°ã€‚</p>
<p><strong>ç¼©æ”¾è¡Œä¸º</strong>:
- $B \ll B_c$: $\eta^<em> \propto B$(çº¿æ€§)
- $B \gg B_c$: $\eta^</em> = \text{const}$(é¥±å’Œ)</p>
<h4 id="42-adam">4.2 Adamçš„ç¼©æ”¾è§„å¾‹</h4>
<p>ä»ä¸»æ–‡æ¡£å¼(102),Adamåœ¨$\beta_1 &gt; 1/3$æ—¶ä¼šå‡ºç°surgeç°è±¡ã€‚</p>
<p><strong>æœ€ä¼˜å­¦ä¹ ç‡</strong>(å¯¹è§’Hessianå‡è®¾):
\begin{equation}\eta_{Adam}^* \propto \frac{1}{\frac{1}{\beta(B)}\frac{1-\beta_1}{1+\beta_1} + \beta(B)\frac{2\beta_1}{1+\beta_1}}\tag{20}\end{equation}</p>
<p>å…¶ä¸­$\beta(B) = (1 + B_c^{simple}/B)^{-1/2}$ã€‚</p>
<p><strong>ä¸´ç•Œç‚¹</strong>: $B_c^{Adam} = \frac{1-\beta_1}{3\beta_1-1}B_c^{simple}$(å½“$\beta_1 &gt; 1/3$)</p>
<h4 id="43-muon">4.3 Muonçš„ç¼©æ”¾è§„å¾‹</h4>
<p>Muonä½¿ç”¨çŸ©é˜µç¬¦å·å‡½æ•°,æ›´æ–°æ–¹å‘æ¥è¿‘SignSGD+Momentumã€‚</p>
<p>ä»ä¸»æ–‡æ¡£åˆ†æ,Muonåœ¨ç‰¹å®šHessianç»“æ„ä¸‹ä¸ä¼šå‡ºç°surgeç°è±¡:
\begin{equation}\eta_{Muon}^* \approx \eta_{max}^{sign} \cdot f(B, B_{eff})\tag{21}\end{equation}</p>
<p>å…¶ä¸­$B_{eff} = B \cdot \frac{1+\beta_1}{1-\beta_1}$,$f$æ˜¯å¹³æ»‘é€’å¢å‡½æ•°ã€‚</p>
<p><strong>ä¼˜åŠ¿</strong>: æ”¯æŒæ›´å¤§batch sizeè€Œä¸ç‰ºç‰²æ•ˆç‡ã€‚</p>
<h3 id="5-warmup">5. Warmupä¸å­¦ä¹ ç‡è°ƒåº¦</h3>
<h4 id="51-warmup">5.1 Warmupçš„å¿…è¦æ€§</h4>
<p><strong>è®­ç»ƒåˆæœŸçš„ç‰¹ç‚¹</strong>:
1. æ¢¯åº¦èŒƒæ•°$|\boldsymbol{g}|$å¾ˆå¤§
2. Hessianç‰¹å¾å€¼ä¸ç¨³å®š
3. $B_c$å¯èƒ½å¾ˆå¤§</p>
<p><strong>å¤§å­¦ä¹ ç‡çš„é£é™©</strong>:
\begin{equation}|\boldsymbol{\theta}_{t+1} - \boldsymbol{\theta}_t| = \eta|\tilde{\boldsymbol{g}}_B| \approx \eta|\boldsymbol{g}|\tag{22}\end{equation}</p>
<p>è‹¥$\eta$è¿‡å¤§,ä¸€æ­¥æ›´æ–°å¯èƒ½è·¨è¶Šå¤šä¸ªå±€éƒ¨æœ€ä¼˜,å¯¼è‡´ä¸ç¨³å®šã€‚</p>
<h4 id="52-warmup">5.2 çº¿æ€§Warmup</h4>
<p><strong>ç­–ç•¥</strong>:
\begin{equation}\eta_t = \begin{cases}
\eta_{max} \cdot \frac{t}{T_{warmup}}, &amp; t \leq T_{warmup}\
\eta_{max}, &amp; t &gt; T_{warmup}
\end{cases}\tag{23}\end{equation}</p>
<p><strong>ç†è®ºè§£é‡Š</strong>: æ¸è¿›å¢å¤§å­¦ä¹ ç‡,è®©æ¨¡å‹é€æ­¥é€‚åº”å¤§æ­¥é•¿æ›´æ–°ã€‚</p>
<p><strong>Warmupé•¿åº¦</strong>: å…¸å‹è®¾ç½®$T_{warmup} = 0.05 \sim 0.1 \times T_{total}$</p>
<h4 id="53">5.3 æ‰¹é‡å¤§å°çš„åŠ¨æ€è°ƒæ•´</h4>
<p><strong>æ¸è¿›å¢å¤§Batch Size</strong>:
\begin{equation}B_t = \min(B_{max}, B_0 \cdot 2^{\lfloor t/T_B \rfloor})\tag{24}\end{equation}</p>
<p><strong>ä¼˜ç‚¹</strong>:
1. è®­ç»ƒåˆæœŸ:å°batch,é«˜éšæœºæ€§,æ¢ç´¢å¹¿
2. è®­ç»ƒåæœŸ:å¤§batch,ä½å™ªå£°,æ”¶æ•›å¿«</p>
<p><strong>ä¸å­¦ä¹ ç‡çš„åè°ƒ</strong>: å¯ä»¥åŒæ—¶è°ƒæ•´:
\begin{equation}\eta_t = \eta_0 \cdot \sqrt{B_t/B_0}\tag{25}\end{equation}</p>
<p>ä½¿ç”¨å¹³æ–¹æ ¹ç¼©æ”¾è€Œéçº¿æ€§ç¼©æ”¾,ä»‹äºä¸¤ç§æç«¯ä¹‹é—´ã€‚</p>
<h3 id="6-gap">6. æ³›åŒ–æ€§Gapåˆ†æ</h3>
<h4 id="61-sharp-vs-flat-minima">6.1 Sharp vs Flat Minima</h4>
<p><strong>å®šä¹‰</strong>: æŸå¤±å‡½æ•°åœ¨æœ€å°å€¼é™„è¿‘çš„Hessian:
- <strong>Sharp minimum</strong>: $\lambda_{max}(\boldsymbol{H}^<em>)$å¤§,æŸå¤±å¯¹å‚æ•°æ•æ„Ÿ
- </em><em>Flat minimum</em><em>: $\lambda_{max}(\boldsymbol{H}^</em>)$å°,æŸå¤±å¯¹å‚æ•°ä¸æ•æ„Ÿ</p>
<p><strong>æ³›åŒ–èƒ½åŠ›</strong>: Flat minimaé€šå¸¸æ³›åŒ–æ›´å¥½(PAC-Bayesç†è®ºæ”¯æŒ)ã€‚</p>
<h4 id="62-sgd">6.2 SGDçš„éšå¼æ­£åˆ™åŒ–</h4>
<p>ä»å¼(7),SGDå€¾å‘äºæ”¶æ•›åˆ°æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„$\boldsymbol{\theta}^<em>$:
\begin{equation}\nabla L(\boldsymbol{\theta}^</em>) = 0, \quad \text{ä¸”} \quad \lambda_{max}(\boldsymbol{H}^*) \lesssim \frac{B}{\eta}\tag{26}\end{equation}</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>: è¾ƒå°çš„$\eta/B$(ä½æ¸©åº¦)åå¥½flatter minimaã€‚</p>
<h4 id="63-large-batchgap">6.3 Large Batchçš„æ³›åŒ–Gap</h4>
<p><strong>ç°è±¡</strong>: å¤§batchè®­ç»ƒçš„æ¨¡å‹æµ‹è¯•è¯¯å·®é€šå¸¸æ›´é«˜ã€‚</p>
<p><strong>ç†è®ºè§£é‡Š</strong>:
1. <strong>é«˜æ¸©åº¦</strong>: å¤§$B$éœ€è¦å¤§$\eta$,å¯¼è‡´$\eta/B$æœªå¿…å‡å°
2. <strong>æ¢ç´¢ä¸è¶³</strong>: å¤§batchå™ªå£°å°,éš¾ä»¥é€ƒç¦»sharp minima
3. <strong>æœ‰æ•ˆè¿­ä»£æ•°å°‘</strong>: ç›¸åŒepochä¸‹,å¤§batchçš„æ›´æ–°æ¬¡æ•°å°‘</p>
<p><strong>ç¼“è§£æ–¹æ³•</strong>:
- å»¶é•¿è®­ç»ƒ(æ›´å¤šepoch)
- é™ä½å­¦ä¹ ç‡(ç‰ºç‰²é€Ÿåº¦)
- Ghost Batch Normalization
- ä½¿ç”¨æ›´å¥½çš„ä¼˜åŒ–å™¨(å¦‚Muon)</p>
<h3 id="7-scaling">7. åˆ†å¸ƒå¼è®­ç»ƒçš„Scaling</h3>
<h4 id="71">7.1 æ•°æ®å¹¶è¡Œ</h4>
<p><strong>åŸºæœ¬è®¾ç½®</strong>: $N$ä¸ªworker,æ¯ä¸ªè®¡ç®—$B_{local}$æ ·æœ¬:
\begin{equation}B_{global} = N \cdot B_{local}\tag{27}\end{equation}</p>
<p><strong>æ¢¯åº¦èšåˆ</strong>:
\begin{equation}\tilde{\boldsymbol{g}}<em i="1">{global} = \frac{1}{N}\sum</em>}^N \tilde{\boldsymbol{g}}_{i,local}\tag{28}\end{equation</p>
<p><strong>å­¦ä¹ ç‡ç¼©æ”¾</strong>: æ ¹æ®çº¿æ€§è§„åˆ™,$\eta_{global} = N \cdot \eta_{base}$</p>
<h4 id="72">7.2 é€šä¿¡å¼€é”€</h4>
<p><strong>æ¯æ­¥é€šä¿¡é‡</strong>: $\mathcal{O}(d)$,å…¶ä¸­$d$æ˜¯å‚æ•°ç»´åº¦</p>
<p><strong>All-Reduceå¤æ‚åº¦</strong>: $\mathcal{O}(\log N)$ä½¿ç”¨tree-basedç®—æ³•</p>
<p><strong>é€šä¿¡/è®¡ç®—æ¯”</strong>:
\begin{equation}R = \frac{T_{comm}}{T_{comp}} = \frac{c \cdot d}{B_{local} \cdot n_{samples}}\tag{29}\end{equation}</p>
<p>å…¶ä¸­$c$æ˜¯é€šä¿¡å¸¸æ•°ã€‚</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>: å¢å¤§$B_{local}$å¯ä»¥å‡å°‘é€šä¿¡å¼€é”€,ä½†éœ€æƒè¡¡æ³›åŒ–æ€§èƒ½ã€‚</p>
<h4 id="73-larslamb">7.3 LARS/LAMBä¼˜åŒ–å™¨</h4>
<p><strong>Layer-wise Adaptive Rate Scaling (LARS)</strong>:
\begin{equation}\eta_l = \eta_{global} \cdot \frac{|\boldsymbol{W}<em _boldsymbol_W="\boldsymbol{W">l|}{|\nabla</em>}_l}L| + \lambda|\boldsymbol{W}_l|}\tag{30}\end{equation</p>
<p>ä¸ºæ¯å±‚è‡ªé€‚åº”è°ƒæ•´å­¦ä¹ ç‡,å…è®¸æ›´æ¿€è¿›çš„å…¨å±€å­¦ä¹ ç‡ç¼©æ”¾ã€‚</p>
<p><strong>LAMB</strong>(Layer-wise Adaptive Moments for Batch training):
\begin{equation}\eta_l = \eta_{global} \cdot \frac{|\boldsymbol{W}_l|}{|\boldsymbol{m}_l/\sqrt{\boldsymbol{v}_l}|}\tag{31}\end{equation}</p>
<p>ç»“åˆAdamçš„è‡ªé€‚åº”çŸ©ä¼°è®¡å’ŒLARSçš„å±‚çº§ç¼©æ”¾ã€‚</p>
<p><strong>åº”ç”¨</strong>: æˆåŠŸå°†BERTè®­ç»ƒæ‰©å±•åˆ°batch size 32kã€‚</p>
<h3 id="8">8. å®éªŒéªŒè¯ä¸æ¡ˆä¾‹ç ”ç©¶</h3>
<h4 id="81-imagenet">8.1 ImageNetåˆ†ç±»</h4>
<p><strong>å®éªŒè®¾ç½®</strong>: ResNet-50,åˆå§‹å­¦ä¹ ç‡$\eta_0 = 0.1$,batch size $B_0 = 256$</p>
<p><strong>ç¼©æ”¾å®éªŒ</strong>:
| Batch Size | å­¦ä¹ ç‡ | Top-1å‡†ç¡®ç‡ | è®­ç»ƒæ—¶é—´ |
|-----------|-------|-----------|---------|
| 256 | 0.1 | 76.2% | 100% |
| 512 | 0.2 | 76.1% | 55% |
| 1024 | 0.4 | 75.9% | 32% |
| 2048 | 0.8 | 75.5% | 20% |
| 8192 | 2.4 | 74.8% | 8% |</p>
<p><strong>è§‚å¯Ÿ</strong>:
- $B \leq 1024$:çº¿æ€§ç¼©æ”¾æœ‰æ•ˆ,å‡†ç¡®ç‡å‡ ä¹æ— æŸ
- $B &gt; 2048$:å‡ºç°æ³›åŒ–gap,éœ€è¦ç‰¹æ®ŠæŠ€å·§(warmupã€LARSç­‰)</p>
<h4 id="82-gpt-3">8.2 GPT-3è®­ç»ƒ</h4>
<p><strong>å‚æ•°</strong>: 175Bå‚æ•°,300B tokens</p>
<p><strong>Batch Sizeç­–ç•¥</strong>: åŠ¨æ€å¢å¤§
- å‰10%è®­ç»ƒ: $B = 0.5M$ tokens
- ä¸­æœŸ: $B = 2M$ tokens
- åæœŸ: $B = 3.2M$ tokens</p>
<p><strong>å­¦ä¹ ç‡</strong>: éšbatch sizeè°ƒæ•´,ä½¿ç”¨cosine decay</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>: å¤§æ¨¡å‹æœ‰æ›´å¤§çš„$B_c$,å¯ä»¥ä½¿ç”¨æ›´å¤§batch sizeã€‚</p>
<h4 id="83-clipsimclr">8.3 å¯¹æ¯”å­¦ä¹ (CLIP/SimCLR)</h4>
<p><strong>ç‰¹æ®Šæ€§</strong>: éœ€è¦å¤§batchæ¥æ„å»ºè´Ÿæ ·æœ¬å¯¹</p>
<p><strong>SimCLR</strong>: æœ€ä½³æ€§èƒ½åœ¨$B = 4096 \sim 8192$</p>
<p><strong>è§£é‡Š</strong>: å¯¹æ¯”æŸå¤±çš„$B_c$ä¸batch sizeæ­£ç›¸å…³:
\begin{equation}B_c^{contrast} \propto B^{contrast}\tag{32}\end{equation}</p>
<p>å› ä¸ºå¢å¤§batchåŒæ—¶å¢åŠ äº†æœ‰æ•ˆè´Ÿæ ·æœ¬æ•°ã€‚</p>
<h3 id="9">9. å®è·µå»ºè®®æ€»ç»“</h3>
<h4 id="91">9.1 å­¦ä¹ ç‡é€‰æ‹©æµç¨‹</h4>
<p><strong>æ­¥éª¤1</strong>: ç¡®å®šåŸºå‡†å­¦ä¹ ç‡
- å°batch($B = 32 \sim 128$)ä¸‹grid search
- æ‰¾åˆ°æœ€ä½³$\eta_{base}$</p>
<p><strong>æ­¥éª¤2</strong>: ä¼°è®¡ä¸´ç•Œbatch size
- ç›‘æ§è®­ç»ƒè¿‡ç¨‹ä¸­çš„æ¢¯åº¦ç»Ÿè®¡é‡
- ä¼°ç®—$B_c \approx \text{tr}(\boldsymbol{\Sigma})/|\boldsymbol{g}|^2$</p>
<p><strong>æ­¥éª¤3</strong>: åº”ç”¨ç¼©æ”¾è§„åˆ™
- è‹¥$B \leq B_c$:ä½¿ç”¨çº¿æ€§ç¼©æ”¾$\eta = \eta_{base} \cdot (B/B_{base})$
- è‹¥$B &gt; B_c$:ä½¿ç”¨æ¬¡çº¿æ€§ç¼©æ”¾$\eta = \eta_{base} \cdot \sqrt{B/B_{base}}$</p>
<p><strong>æ­¥éª¤4</strong>: è°ƒä¼˜
- æ·»åŠ warmup(é•¿åº¦$\sim 5\%$è®­ç»ƒæ­¥æ•°)
- ç›‘æ§éªŒè¯é›†æ€§èƒ½,å¿…è¦æ—¶é™ä½å­¦ä¹ ç‡</p>
<h4 id="92">9.2 ä¸åŒä¼˜åŒ–å™¨çš„æ¨èè®¾ç½®</h4>
<p><strong>SGD+Momentum</strong>:
- $\beta_1 = 0.9$(æ ‡å‡†)
- å­¦ä¹ ç‡:ä¸¥æ ¼éµå¾ªçº¿æ€§ç¼©æ”¾(åœ¨$B &lt; B_c$æ—¶)
- é€‚åˆ:CNNåˆ†ç±»ä»»åŠ¡</p>
<p><strong>Adam/AdamW</strong>:
- $\beta_1 = 0.9, \beta_2 = 0.999$(æ ‡å‡†)
- å­¦ä¹ ç‡:å¯¹batch sizeä¸å¤ªæ•æ„Ÿ,ä½†$B$è¿‡å¤§ä»ä¼šæœ‰gap
- é€‚åˆ:Transformeræ¨¡å‹ã€åˆæ­¥å®éªŒ</p>
<p><strong>LARS/LAMB</strong>:
- åœ¨Adam/SGDåŸºç¡€ä¸ŠåŠ layer-wiseç¼©æ”¾
- å…è®¸$B$æ‰©å±•åˆ°$10k \sim 32k$
- é€‚åˆ:åˆ†å¸ƒå¼è®­ç»ƒã€å¤§æ¨¡å‹</p>
<p><strong>Muon</strong>:
- ç±»ä¼¼SignSGD+Momentum
- æ”¯æŒå¤§batch size,surgeç°è±¡è¾ƒè½»
- é€‚åˆ:éœ€è¦é«˜throughputçš„åœºæ™¯</p>
<h4 id="93-checklist">9.3 è°ƒè¯•Checklist</h4>
<p><strong>ç—‡çŠ¶1</strong>: æŸå¤±ä¸ä¸‹é™
- æ£€æŸ¥å­¦ä¹ ç‡æ˜¯å¦è¿‡å°
- éªŒè¯æ¢¯åº¦æ˜¯å¦æ­£ç¡®è®¡ç®—
- å°è¯•é™ä½batch size</p>
<p><strong>ç—‡çŠ¶2</strong>: æŸå¤±éœ‡è¡/NaN
- å­¦ä¹ ç‡è¿‡å¤§,é™ä½10x
- æ·»åŠ gradient clipping
- æ£€æŸ¥æ•°æ®é¢„å¤„ç†</p>
<p><strong>ç—‡çŠ¶3</strong>: è®­ç»ƒæ…¢ä½†æœ€ç»ˆæ€§èƒ½å¥½
- å¯ä»¥å¢å¤§batch sizeå’Œå­¦ä¹ ç‡
- ä½¿ç”¨æ›´æ¿€è¿›çš„å­¦ä¹ ç‡è°ƒåº¦</p>
<p><strong>ç—‡çŠ¶4</strong>: è®­ç»ƒå¿«ä½†æ³›åŒ–å·®(large batch gap)
- å»¶é•¿è®­ç»ƒæ—¶é—´
- é™ä½å­¦ä¹ ç‡
- è€ƒè™‘Ghost Batch Normalization
- å°è¯•æ›´å°çš„batch size</p>
<h3 id="10">10. ç†è®ºå‰æ²¿ä¸å¼€æ”¾é—®é¢˜</h3>
<h4 id="101-scaling-law">10.1 éå‡¸ä¼˜åŒ–çš„Scaling Law</h4>
<p><strong>ç°çŠ¶</strong>: å¤§éƒ¨åˆ†ç†è®ºåŸºäºå‡¸/å¼ºå‡¸å‡è®¾</p>
<p><strong>æŒ‘æˆ˜</strong>: æ·±åº¦ç¥ç»ç½‘ç»œé«˜åº¦éå‡¸
- å¤šä¸ªå±€éƒ¨æœ€ä¼˜
- éç‚¹ä¼—å¤š
- Hessianè°±ä¸ç¨³å®š</p>
<p><strong>è¿›å±•</strong>:
- ç¥ç»æ­£åˆ‡æ ¸(NTK)ç†è®º:åœ¨æ— é™å®½åº¦æé™ä¸‹,ç½‘ç»œè¿‘ä¼¼çº¿æ€§
- Polyak-Åojasiewiczæ¡ä»¶:æŸäº›éå‡¸å‡½æ•°æ»¡è¶³,ä¿è¯æ”¶æ•›</p>
<h4 id="102-sharpness-aware-minimization-sam">10.2 Sharpness-Aware Minimization (SAM)</h4>
<p><strong>æ€æƒ³</strong>: æ˜¾å¼å¯»æ‰¾flat minima
\begin{equation}\min_{\boldsymbol{\theta}} \max_{|\boldsymbol{\epsilon}| \leq \rho} L(\boldsymbol{\theta} + \boldsymbol{\epsilon})\tag{33}\end{equation}</p>
<p><strong>ä¸batch sizeçš„å…³ç³»</strong>: SAMå¯èƒ½æ”¹å˜$B_c$,éœ€è¦é‡æ–°ç ”ç©¶scaling law</p>
<h4 id="103-adaptive-batch-size">10.3 Adaptive Batch Size</h4>
<p><strong>é—®é¢˜</strong>: èƒ½å¦åŠ¨æ€è°ƒæ•´batch sizeä»¥æœ€å¤§åŒ–æ•ˆç‡?</p>
<p><strong>æ–¹æ¡ˆ</strong>:
- åŸºäºæ¢¯åº¦æ–¹å·®ä¼°è®¡$B_c$
- åœ¨çº¿è°ƒæ•´$B_t$ä½¿å…¶å§‹ç»ˆ $\approx B_c$</p>
<p><strong>æŒ‘æˆ˜</strong>: éœ€è¦é«˜æ•ˆä¼°è®¡$B_c$,é¿å…è¿‡å¤§å¼€é”€</p>
<h4 id="104-meta-learning-scaling">10.4 Meta-Learning Scaling</h4>
<p><strong>é—®é¢˜</strong>: Few-shot learningä¸­batch sizeå¦‚ä½•å½±å“å…ƒå­¦ä¹ ?</p>
<p><strong>ç‰¹æ®Šæ€§</strong>:
- Inner loopå’Œouter loopæœ‰ä¸åŒçš„batch size
- Support setå’Œquery setçš„å¹³è¡¡</p>
<p><strong>å¼€æ”¾é—®é¢˜</strong>: Scaling lawåœ¨MAMLç­‰ç®—æ³•ä¸­å¦‚ä½•ä½“ç°?</p>
<h3 id="11_1">11. å…¨æ–‡æ€»ç»“</h3>
<p>æœ¬æ–‡æ·±å…¥åˆ†æäº†å­¦ä¹ ç‡ä¸batch sizeçš„å…³ç³»,ä¸»è¦ç»“è®º:</p>
<p><strong>æ ¸å¿ƒåŸç†</strong>:
1. <strong>çº¿æ€§ç¼©æ”¾è§„åˆ™</strong>: $B \to kB \Rightarrow \eta \to k\eta$(åœ¨$B &lt; B_c$æ—¶)
2. <strong>ä¸´ç•Œbatch size</strong>: $B_c = \text{tr}(\boldsymbol{\Sigma}\boldsymbol{H})/(\boldsymbol{g}^{\top}\boldsymbol{H}\boldsymbol{g})$
3. <strong>Surgeç°è±¡</strong>: $B &gt; B_c$æ—¶,å¢å¤§batch sizeè¾¹é™…æ”¶ç›Šé€’å‡</p>
<p><strong>ä¼˜åŒ–å™¨ç‰¹æ€§</strong>:
- SGD: ä¸¥æ ¼éµå¾ªçº¿æ€§ç¼©æ”¾
- Adam: $\beta_1 &gt; 1/3$æ—¶æœ‰surgeç°è±¡
- Muon: æ”¯æŒæ›´å¤§batch size</p>
<p><strong>å®è·µæŒ‡å—</strong>:
- ä½¿ç”¨warmupç¼“è§£è®­ç»ƒåˆæœŸä¸ç¨³å®š
- ç›‘æ§æ¢¯åº¦ç»Ÿè®¡é‡ä¼°è®¡$B_c$
- å¤§batchè®­ç»ƒéœ€è¦ç‰¹æ®ŠæŠ€å·§(LARS/LAMB)</p>
<p><strong>æœªæ¥æ–¹å‘</strong>:
- éå‡¸æƒ…å†µçš„ç²¾ç¡®ç†è®º
- è‡ªé€‚åº”batch sizeç®—æ³•
- Sharpness-awareä¼˜åŒ–çš„scaling</p>
        </div>
    </div>
</body>
</html>