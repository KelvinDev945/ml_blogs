<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šæ ‡ç­¾â€œSoftmax+äº¤å‰ç†µâ€çš„è½¯æ ‡ç­¾ç‰ˆæœ¬</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>å¤šæ ‡ç­¾â€œSoftmax+äº¤å‰ç†µâ€çš„è½¯æ ‡ç­¾ç‰ˆæœ¬</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-26 | ğŸ“„ å¤§å°: 30.3 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/9064">https://spaces.ac.cn/archives/9064</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p><strong>ï¼ˆæ³¨ï¼šæœ¬æ–‡çš„ç›¸å…³å†…å®¹å·²æ•´ç†æˆè®ºæ–‡<a href="https://papers.cool/arxiv/2208.02955">ã€ŠZLPR: A Novel Loss for Multi-label Classificationã€‹</a>ï¼Œå¦‚éœ€å¼•ç”¨å¯ä»¥ç›´æ¥å¼•ç”¨è‹±æ–‡è®ºæ–‡ï¼Œè°¢è°¢ã€‚ï¼‰</strong></p>
<p>åœ¨<a href="/archives/7359">ã€Šå°†â€œSoftmax+äº¤å‰ç†µâ€æ¨å¹¿åˆ°å¤šæ ‡ç­¾åˆ†ç±»é—®é¢˜ã€‹</a>ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªç”¨äºå¤šæ ‡ç­¾åˆ†ç±»çš„æŸå¤±å‡½æ•°ï¼š<br />
\begin{equation}\log \left(1 + \sum\limits_{i\in\Omega_{neg}} e^{s_i}\right) + \log \left(1 + \sum\limits_{j\in\Omega_{pos}} e^{-s_j}\right)\label{eq:original}\end{equation}<br />
è¿™ä¸ªæŸå¤±å‡½æ•°æœ‰ç€å•æ ‡ç­¾åˆ†ç±»ä¸­â€œSoftmax+äº¤å‰ç†µâ€çš„ä¼˜ç‚¹ï¼Œå³ä¾¿åœ¨æ­£è´Ÿç±»ä¸å¹³è¡¡çš„ä¾ç„¶èƒ½å¤Ÿæœ‰æ•ˆå·¥ä½œã€‚ä½†ä»è¿™ä¸ªæŸå¤±å‡½æ•°çš„å½¢å¼æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®ƒåªé€‚ç”¨äºâ€œç¡¬æ ‡ç­¾â€ï¼Œè¿™å°±æ„å‘³ç€label smoothingã€<a href="/archives/5693">mixup</a>ç­‰æŠ€å·§å°±æ²¡æ³•ç”¨äº†ã€‚æœ¬æ–‡åˆ™å°è¯•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæå‡ºä¸Šè¿°æŸå¤±å‡½æ•°çš„ä¸€ä¸ªè½¯æ ‡ç­¾ç‰ˆæœ¬ã€‚</p>
<h2 id="_1">å·§å¦™è”ç³»</h2>
<p>å¤šæ ‡ç­¾åˆ†ç±»çš„ç»å…¸æ–¹æ¡ˆå°±æ˜¯è½¬åŒ–ä¸ºå¤šä¸ªäºŒåˆ†ç±»é—®é¢˜ï¼Œå³æ¯ä¸ªç±»åˆ«ç”¨sigmoidå‡½æ•°$\sigma(x)=1/(1+e^{-x})$æ¿€æ´»ï¼Œç„¶åå„è‡ªç”¨äºŒåˆ†ç±»äº¤å‰ç†µæŸå¤±ã€‚å½“æ­£è´Ÿç±»åˆ«æå…¶ä¸å¹³è¡¡æ—¶ï¼Œè¿™ç§åšæ³•çš„è¡¨ç°é€šå¸¸ä¼šæ¯”è¾ƒç³Ÿç³•ï¼Œè€Œç›¸æ¯”ä¹‹ä¸‹æŸå¤±$\eqref{eq:original}$é€šå¸¸æ˜¯ä¸€ä¸ªæ›´ä¼˜çš„é€‰æ‹©ã€‚</p>
<p>åœ¨ä¹‹å‰æ–‡ç« çš„è¯„è®ºåŒºä¸­ï¼Œè¯»è€… <a href="/archives/7359/comment-page-2#comment-14196">@wu.yan</a> æ­ç¤ºäº†å¤šä¸ªâ€œsigmoid+äºŒåˆ†ç±»äº¤å‰ç†µâ€ä¸å¼$\eqref{eq:original}$çš„ä¸€ä¸ªå·§å¦™çš„è”ç³»ï¼šå¤šä¸ªâ€œsigmoid+äºŒåˆ†ç±»äº¤å‰ç†µâ€å¯ä»¥é€‚å½“åœ°æ”¹å†™æˆ<br />
\begin{equation}\begin{aligned}<br />
&amp;\,-\sum_{j\in\Omega_{pos}}\log\sigma(s_j)-\sum_{i\in\Omega_{neg}}\log(1-\sigma(s_i))\\\<br />
=&amp;\,\log\prod_{j\in\Omega_{pos}}(1+e^{-s_j})+\log\prod_{i\in\Omega_{neg}}(1+e^{s_i})\\\<br />
=&amp;\,\log\left(1+\sum_{j\in\Omega_{pos}}e^{-s_j}+\cdots\right)+\log\left(1+\sum_{i\in\Omega_{neg}}e^{s_i}+\cdots\right)<br />
\end{aligned}\label{eq:link}\end{equation}<br />
å¯¹æ¯”å¼$\eqref{eq:original}$ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å¼$\eqref{eq:original}$æ­£å¥½æ˜¯ä¸Šè¿°å¤šä¸ªâ€œsigmoid+äºŒåˆ†ç±»äº¤å‰ç†µâ€çš„æŸå¤±å»æ‰äº†$\cdots$æ‰€è¡¨ç¤ºçš„é«˜é˜¶é¡¹ï¼åœ¨æ­£è´Ÿç±»åˆ«ä¸å¹³è¡¡æ—¶ï¼Œè¿™äº›é«˜é˜¶é¡¹å æ®äº†è¿‡é«˜çš„æƒé‡ï¼ŒåŠ å‰§äº†ä¸å¹³è¡¡é—®é¢˜ï¼Œä»è€Œæ•ˆæœä¸ä½³ï¼›ç›¸åï¼Œå»æ‰è¿™äº›é«˜é˜¶é¡¹åï¼Œå¹¶æ²¡æœ‰æ”¹å˜æŸå¤±å‡½æ•°çš„ä½œç”¨ï¼ˆå¸Œæœ›æ­£ç±»å¾—åˆ†å¤§äº0ã€è´Ÿç±»å¾—åˆ†å°äº0ï¼‰ï¼ŒåŒæ—¶å› ä¸ºæ‹¬å·å†…çš„æ±‚å’Œæ•°è·Ÿç±»åˆ«æ•°æ˜¯çº¿æ€§å…³ç³»ï¼Œå› æ­¤æ­£è´Ÿç±»å„è‡ªçš„æŸå¤±å·®è·ä¸ä¼šå¤ªå¤§ã€‚</p>
<h2 id="_2">å½¢å¼çŒœæµ‹</h2>
<p>è¿™ä¸ªå·§å¦™è”ç³»å‘Šè¯‰æˆ‘ä»¬ï¼Œè¦å¯»æ‰¾å¼$\eqref{eq:original}$çš„è½¯æ ‡ç­¾ç‰ˆæœ¬ï¼Œå¯ä»¥å°è¯•ä»å¤šä¸ªâ€œsigmoid+äºŒåˆ†ç±»äº¤å‰ç†µâ€çš„è½¯æ ‡ç­¾ç‰ˆæœ¬å‡ºå‘ï¼Œç„¶åå°è¯•å»æ‰é«˜é˜¶é¡¹ã€‚æ‰€è°“è½¯æ ‡ç­¾ï¼ŒæŒ‡çš„æ˜¯æ ‡ç­¾ä¸å†æ˜¯0æˆ–1ï¼Œè€Œæ˜¯0ï½1ä¹‹é—´çš„ä»»æ„å®æ•°éƒ½æœ‰å¯èƒ½ï¼Œè¡¨ç¤ºå±äºè¯¥ç±»çš„å¯èƒ½æ€§ã€‚è€Œå¯¹äºäºŒåˆ†ç±»äº¤å‰ç†µï¼Œå®ƒçš„è½¯æ ‡ç­¾ç‰ˆæœ¬å¾ˆç®€å•ï¼š<br />
\begin{equation}-t\log\sigma(s)-(1-t)\log(1-\sigma(s))\end{equation}<br />
è¿™é‡Œ$t$å°±æ˜¯è½¯æ ‡ç­¾ï¼Œè€Œ$s$å°±æ˜¯å¯¹åº”çš„æ‰“åˆ†ã€‚æ¨¡ä»¿è¿‡ç¨‹$\eqref{eq:link}$ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°<br />
\begin{equation}\begin{aligned}<br />
&amp;\,-\sum_i t_i\log\sigma(s_i)-\sum_i (1-t_i)\log(1-\sigma(s_i))\\\<br />
=&amp;\,\log\prod_i(1+e^{-s_i})^{t_i}+\log\prod_i (1+e^{s_i})^{1-t_i}\\\<br />
=&amp;\,\log\prod_i(1+t_i e^{-s_i} + \cdots)+\log\prod_i (1+(1-t_i)e^{s_i}+\cdots)\\\<br />
=&amp;\,\log\left(1+\sum_i t_i e^{-s_i}+\cdots\right)+\log\left(1+\sum_i(1-t_i)e^{s_i}+\cdots\right)<br />
\end{aligned}\end{equation}<br />
å¦‚æœå»æ‰é«˜é˜¶é¡¹ï¼Œé‚£ä¹ˆå°±å¾—åˆ°<br />
\begin{equation}\log\left(1+\sum_i t_i e^{-s_i}\right)+\log\left(1+\sum_i(1-t_i)e^{s_i}\right)\label{eq:soft}\end{equation}<br />
å®ƒå°±æ˜¯å¼$\eqref{eq:original}$çš„è½¯æ ‡ç­¾ç‰ˆæœ¬çš„å€™é€‰å½¢å¼ï¼Œå¯ä»¥å‘ç°å½“$t_i\in\{0,1\}$æ—¶ï¼Œæ­£å¥½æ˜¯é€€åŒ–ä¸ºå¼$\eqref{eq:original}$çš„ã€‚</p>
<h2 id="_3">è¯æ˜ç»“æœ</h2>
<p>å°±ç›®å‰æ¥è¯´ï¼Œå¼$\eqref{eq:soft}$é¡¶å¤šæ˜¯ä¸€ä¸ªâ€œå€™é€‰â€å½¢å¼ï¼Œè¦å°†å®ƒâ€œè½¬æ­£â€ï¼Œæˆ‘ä»¬éœ€è¦è¯æ˜åœ¨$t_i$ä¸º0ï½1æµ®ç‚¹æ•°æ—¶ï¼Œå¼$\eqref{eq:soft}$èƒ½å­¦å‡ºæœ‰æ„ä¹‰çš„ç»“æœã€‚æ‰€è°“æœ‰æ„ä¹‰ï¼ŒæŒ‡çš„æ˜¯ç†è®ºä¸Šèƒ½å¤Ÿé€šè¿‡$s_i$æ¥é‡æ„$t_i$çš„ä¿¡æ¯ï¼ˆ$s_i$æ˜¯æ¨¡å‹é¢„æµ‹ç»“æœï¼Œ$t_i$æ˜¯ç»™å®šæ ‡ç­¾ï¼Œæ‰€ä»¥$s_i$èƒ½é‡æ„$t_i$æ˜¯æœºå™¨å­¦ä¹ çš„ç›®æ ‡ï¼‰ã€‚</p>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬è®°å¼$\eqref{eq:soft}$ä¸º$l$ï¼Œå¹¶æ±‚$s_i$çš„åå¯¼æ•°ï¼š<br />
\begin{equation}\frac{\partial l}{\partial s_i} = \frac{-t_i e^{-s_i}}{1+\sum\limits_i t_i e^{-s_i}}+\frac{(1-t_i)e^{s_i}}{1+\sum\limits_i(1-t_i)e^{s_i}}\end{equation}<br />
æˆ‘ä»¬çŸ¥é“$l$çš„æœ€å°å€¼å‡ºç°åœ¨æ‰€æœ‰$\frac{\partial l}{\partial s_i}$éƒ½ç­‰äº0æ—¶ï¼Œç›´æ¥å»è§£æ–¹ç¨‹ç»„$\frac{\partial l}{\partial s_i}=0$å¹¶ä¸å®¹æ˜“ï¼Œä½†ç¬”è€…ç•™æ„åˆ°ä¸€ä¸ªç¥å¥‡çš„â€œå·§åˆâ€ï¼šå½“$t_i e^{-s_i}=(1-t_i)e^{s_i}$æ—¶ï¼Œæ¯ä¸ª$\frac{\partial l}{\partial s_i}$è‡ªåŠ¨åœ°ç­‰äº0ï¼æ‰€ä»¥$t_i e^{-s_i}=(1-t_i)e^{s_i}$åº”è¯¥å°±æ˜¯$l$çš„æœ€ä¼˜è§£äº†ï¼Œè§£å¾—<br />
\begin{equation}t_i = \frac{1}{1+e^{-2s_i}}=\sigma(2s_i)\end{equation}<br />
è¿™æ˜¯ä¸€ä¸ªå¾ˆæ¼‚äº®çš„ç»“æœï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬å‡ ä¸ªä¿¡æ¯ï¼š</p>
<blockquote>
<p>1ã€å¼$\eqref{eq:soft}$ç¡®å®æ˜¯å¼$\eqref{eq:original}$åˆç†çš„è½¯æ ‡ç­¾æ¨å¹¿ï¼Œå®ƒèƒ½é€šè¿‡$s_i$å®Œå…¨é‡å»º$t_i$çš„ä¿¡æ¯ï¼Œå…¶å½¢å¼ä¹Ÿåˆšå¥½ä¸sigmoidç›¸å…³ï¼›</p>
<p>2ã€å¦‚æœæˆ‘ä»¬è¦å°†ç»“æœè¾“å‡ºä¸º0ï½1çš„æ¦‚ç‡å€¼ï¼Œé‚£ä¹ˆæ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯$\sigma(2s_i)$è€Œä¸æ˜¯ç›´è§‰ä¸­çš„$\sigma(s_i)$ï¼›</p>
<p>3ã€æ—¢ç„¶æœ€åçš„æ¦‚ç‡å…¬å¼ä¹Ÿå…·æœ‰sigmoidçš„å½¢å¼ï¼Œé‚£ä¹ˆåè¿‡æ¥æƒ³ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºæˆ‘ä»¬ä¾æ—§è¿˜æ˜¯åœ¨å­¦ä¹ å¤šä¸ªsigmoidæ¿€æ´»çš„äºŒåˆ†ç±»é—®é¢˜ï¼Œåªä¸è¿‡æŸå¤±å‡½æ•°æ¢æˆäº†å¼$\eqref{eq:soft}$ã€‚</p>
</blockquote>
<h2 id="_4">å®ç°æŠ€å·§</h2>
<p>å¼$\eqref{eq:soft}$çš„å®ç°å¯ä»¥å‚è€ƒbert4kerasçš„ä»£ç <a href="https://github.com/bojone/bert4keras/blob/5f5d493fe7be9ff2bd0e303e78ed945d386ed8fd/bert4keras/backend.py#L331">multilabel_categorical_crossentropy</a>ï¼Œå…¶ä¸­æœ‰ä¸ªå°ç»†èŠ‚å€¼å¾—è·Ÿå¤§å®¶ä¸€èµ·äº¤æµä¸€ä¸‹ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å°†å¼$\eqref{eq:soft}$å¯ä»¥ç­‰ä»·åœ°æ”¹å†™æˆ<br />
\begin{equation}\log\left(1+\sum_i e^{-s_i + \log t_i}\right)+\log\left(1+\sum_i e^{s_i + \log (1-t_i)}\right)\label{eq:soft-log}\end{equation}<br />
æ‰€ä»¥çœ‹ä¸Šå»ï¼Œåªéœ€è¦å°†$\log t_i$åŠ åˆ°$-s_i$ã€å°†$\log(1-t_i)$åŠ åˆ°$s_i$ä¸Šï¼Œè¡¥é›¶ååšå¸¸è§„çš„$\text{logsumexp}$å³å¯ã€‚ä½†å®é™…ä¸Šï¼Œ$t_i$æ˜¯æœ‰å¯èƒ½å–åˆ°$0$æˆ–$1$çš„ï¼Œå¯¹åº”çš„$\log t_i$æˆ–$\log(1-t_i)$å°±æ˜¯è´Ÿæ— ç©·ï¼Œè€Œæ¡†æ¶æ— æ³•ç›´æ¥å¤„ç†è´Ÿæ— ç©·ï¼Œå› æ­¤é€šå¸¸åœ¨$\log$ä¹‹å‰éœ€è¦clipä¸€ä¸‹ï¼Œå³é€‰å®š$\epsilon &gt; 0$åå®šä¹‰<br />
\begin{equation}\text{clip}(t)=\left\{\begin{aligned}&amp;\epsilon, &amp;t &lt; \epsilon \\\<br />
&amp;t, &amp;\epsilon\leq t\leq 1-\epsilon\\\<br />
&amp;1-\epsilon, &amp;t &gt; 1-\epsilon\end{aligned}\right.\end{equation}</p>
<p>ä½†è¿™æ ·ä¸€clipï¼Œé—®é¢˜å°±æ¥äº†ã€‚ç”±äº$\epsilon$ä¸æ˜¯çœŸçš„æ— ç©·å°ï¼Œæ¯”å¦‚$\epsilon=10^{-7}$ï¼Œé‚£ä¹ˆ$\log\epsilon$å¤§çº¦æ˜¯$-16$å·¦å³ï¼›è€ŒåƒGlobalPointerè¿™æ ·çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬ä¼šæå‰æŠŠä¸åˆç†çš„$s_i$ç»™maskæ‰ï¼Œæ–¹å¼æ˜¯å°†å¯¹åº”çš„$s_i$ç½®ä¸ºä¸€ä¸ªç»å¯¹å€¼å¾ˆå¤§çš„è´Ÿæ•°ï¼Œæ¯”å¦‚$-10^7$ï¼›ç„¶è€Œæˆ‘ä»¬å†çœ‹å¼$\eqref{eq:soft-log}$ï¼Œç¬¬ä¸€é¡¹çš„æ±‚å’Œå¯¹è±¡æ˜¯$e^{-s_i + \log t_i}$ï¼Œæ‰€ä»¥$-10^7$å°±ä¼šå˜æˆ$10^7$ï¼Œå¦‚æœ$t_i$æ²¡æœ‰clipï¼Œé‚£ä¹ˆç†è®ºä¸Š$\log t_i$æ˜¯$\log 0 = -\infty$ï¼Œå¯ä»¥æŠŠ$-s_i + \log t_i$é‡æ–°å˜å›è´Ÿæ— ç©·ï¼Œä½†åˆšæ‰æˆ‘ä»¬å·²ç»çœ‹åˆ°è¿›è¡Œäº†clipä¹‹åçš„$\log t_i$é¡¶å¤šå°±æ˜¯$-16$ï¼Œè¿œè¿œæ¯”ä¸ä¸Š$-s_i$çš„$10^7$ï¼Œæ‰€ä»¥$-s_i + \log t_i$ä¾ç„¶æ˜¯ä¸€ä¸ªå¤§æ­£æ•°ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¸æ­¢è¦å¯¹$t_i$è¿›è¡Œclipï¼Œæˆ‘ä»¬è¿˜è¦æ‰¾å‡ºåŸæœ¬å°äº$\epsilon$çš„$t_i$ï¼Œæ‰‹åŠ¨å°†å¯¹åº”çš„$-s_i$ç½®ä¸ºç»å¯¹å€¼å¾ˆå¤§çš„è´Ÿæ•°ï¼ŒåŒæ ·è¿˜è¦æ‰¾å‡ºå¤§äº$1-\epsilon$çš„$t_i$ï¼Œå°†å¯¹åº”çš„$s_i$ç½®ä¸ºç»å¯¹å€¼å¾ˆå¤§çš„è´Ÿæ•°ï¼Œè¿™æ ·åšå°±æ˜¯å°†å°äº$\epsilon$çš„æŒ‰ç…§ç»å¯¹ç­‰äº0é¢å¤–å¤„ç†ï¼Œå°†å¤§äº$1-\epsilon$çš„æŒ‰ç…§ç»å¯¹ç­‰äº1å¤„ç†ã€‚</p>
<h2 id="_5">æ–‡ç« å°ç»“</h2>
<p>æœ¬æ–‡ä¸»è¦å°†ç¬”è€…ä¹‹å‰æå‡ºçš„å¤šæ ‡ç­¾â€œSoftmax+äº¤å‰ç†µâ€æ¨å¹¿åˆ°è½¯æ ‡ç­¾åœºæ™¯ï¼Œæœ‰äº†å¯¹åº”çš„è½¯æ ‡ç­¾ç‰ˆæœ¬åï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å®ƒä¸label smoothingã€<a href="/archives/5693">mixup</a>ç­‰æŠ€å·§ç»“åˆèµ·æ¥äº†ï¼ŒåƒGlobalPointerç­‰åˆå¯ä»¥å¤šä¸€ä¸ªç‚¼ä¸¹æ–¹å‘ã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/9064">https://spaces.ac.cn/archives/9064</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (May. 07, 2022). ã€Šå¤šæ ‡ç­¾â€œSoftmax+äº¤å‰ç†µâ€çš„è½¯æ ‡ç­¾ç‰ˆæœ¬ ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/9064">https://spaces.ac.cn/archives/9064</a></p>
<p>@online{kexuefm-9064,<br />
title={å¤šæ ‡ç­¾â€œSoftmax+äº¤å‰ç†µâ€çš„è½¯æ ‡ç­¾ç‰ˆæœ¬},<br />
author={è‹å‰‘æ—},<br />
year={2022},<br />
month={May},<br />
url={\url{https://spaces.ac.cn/archives/9064}},<br />
} </p>
<hr />
<h2 id="_6">è¯¦ç»†æ•°å­¦æ¨å¯¼ä¸ç†è®ºåˆ†æ</h2>
<h3 id="1">1. å¤šæ ‡ç­¾åˆ†ç±»çš„åŸºç¡€ç†è®º</h3>
<p><strong>é—®é¢˜è®¾å®š</strong>ï¼šç»™å®šè¾“å…¥$x$ï¼Œé¢„æµ‹å¤šä¸ªæ ‡ç­¾çš„æ¦‚ç‡åˆ†å¸ƒã€‚</p>
<p>å¯¹äºç¬¬$i$ä¸ªæ ‡ç­¾ï¼Œæ¨¡å‹è¾“å‡ºscore $s_i\in\mathbb{R}$ã€‚ä¼ ç»Ÿæ–¹æ³•ä½¿ç”¨sigmoidæ¿€æ´»ï¼š
\begin{equation}
p_i = \sigma(s_i) = \frac{1}{1 + e^{-s_i}} \tag{1}
\end{equation}</p>
<p><strong>ä¼ ç»Ÿå¤šæ ‡ç­¾æŸå¤±</strong>ï¼ˆå¤šä¸ªç‹¬ç«‹çš„äºŒåˆ†ç±»äº¤å‰ç†µï¼‰ï¼š
\begin{equation}
\mathcal{L}<em j_in_Omega__text_pos="j\in\Omega_{\text{pos">{\text{BCE}} = -\sum</em>
\end{equation}}}} \log\sigma(s_j) - \sum_{i\in\Omega_{\text{neg}}} \log(1-\sigma(s_i)) \tag{2</p>
<p>å…¶ä¸­$\Omega_{\text{pos}}$æ˜¯æ­£ç±»é›†åˆï¼Œ$\Omega_{\text{neg}}$æ˜¯è´Ÿç±»é›†åˆã€‚</p>
<h3 id="2-bcesoftmax">2. ä»BCEåˆ°å¤šæ ‡ç­¾SoftmaxæŸå¤±çš„è½¬æ¢</h3>
<p><strong>å±•å¼€sigmoidå‡½æ•°</strong>ï¼š
\begin{equation}
\sigma(s) = \frac{1}{1+e^{-s}} = \frac{e^s}{1+e^s}, \quad 1-\sigma(s) = \frac{1}{1+e^s} \tag{3}
\end{equation}</p>
<p><strong>å°†BCEæŸå¤±æ”¹å†™</strong>ï¼š
\begin{equation}
\begin{aligned}
\mathcal{L}<em j_in_Omega__text_pos="j\in\Omega_{\text{pos">{\text{BCE}} &amp;= -\sum</em> \
&amp;= \sum_{j\in\Omega_{\text{pos}}} \log(1+e^{-s_j}) + \sum_{i\in\Omega_{\text{neg}}} \log(1+e^{s_i})
\end{aligned} \tag{4}
\end{equation}}}} \log\frac{1}{1+e^{-s_j}} - \sum_{i\in\Omega_{\text{neg}}} \log\frac{1}{1+e^{s_i}</p>
<p><strong>åˆ©ç”¨å¯¹æ•°æ€§è´¨</strong> $\log\prod_i a_i = \sum_i \log a_i$ï¼š
\begin{equation}
\mathcal{L}<em j_in_Omega__text_pos="j\in\Omega_{\text{pos">{\text{BCE}} = \log\prod</em>
\end{equation}}}}(1+e^{-s_j}) + \log\prod_{i\in\Omega_{\text{neg}}}(1+e^{s_i}) \tag{5</p>
<p><strong>å±•å¼€ä¹˜ç§¯</strong>ï¼ˆå…³é”®æ­¥éª¤ï¼‰ï¼š</p>
<p>å¯¹äºæ­£ç±»é¡¹ï¼š
\begin{equation}
\prod_{j\in\Omega_{\text{pos}}}(1+e^{-s_j}) = 1 + \sum_{j\in\Omega_{\text{pos}}} e^{-s_j} + \sum_{j_1&lt;j_2} e^{-s_{j_1}-s_{j_2}} + \cdots \tag{6}
\end{equation}</p>
<p>è¿™åŒ…å«äº†$2^{|\Omega_{\text{pos}}|}$é¡¹ï¼ç±»ä¼¼åœ°ï¼Œå¯¹äºè´Ÿç±»é¡¹ä¹Ÿæœ‰$2^{|\Omega_{\text{neg}}|}$é¡¹ã€‚</p>
<p><strong>å…³é”®è§‚å¯Ÿ</strong>ï¼šå½“æ­£è´Ÿç±»æä¸å¹³è¡¡æ—¶ï¼ˆå¦‚$|\Omega_{\text{pos}}| \ll |\Omega_{\text{neg}}|$ï¼‰ï¼Œè´Ÿç±»çš„é«˜é˜¶é¡¹ï¼š
\begin{equation}
\sum_{i_1&lt;i_2&lt;\cdots&lt;i_k} e^{s_{i_1}+s_{i_2}+\cdots+s_{i_k}} \tag{7}
\end{equation}
ä¼šå æ®ä¸»å¯¼åœ°ä½ï¼Œå¯¼è‡´ä¼˜åŒ–å›°éš¾ã€‚</p>
<p><strong>å¤šæ ‡ç­¾SoftmaxæŸå¤±</strong>ï¼ˆåªä¿ç•™ä¸€é˜¶é¡¹ï¼‰ï¼š
\begin{equation}
\mathcal{L}<em i_in_Omega__text_neg="i\in\Omega_{\text{neg">{\text{ML-Softmax}} = \log\left(1 + \sum</em>
\end{equation}}}} e^{s_i}\right) + \log\left(1 + \sum_{j\in\Omega_{\text{pos}}} e^{-s_j}\right) \tag{8</p>
<p>è¿™æ­£æ˜¯åŸæ–‡çš„å¼(1)ï¼</p>
<h3 id="3">3. è½¯æ ‡ç­¾ç‰ˆæœ¬çš„æ¨å¯¼</h3>
<p><strong>è½¯æ ‡ç­¾çš„åŠ¨æœº</strong>ï¼š
- ç¡¬æ ‡ç­¾ï¼š$t_i \in {0, 1}$
- è½¯æ ‡ç­¾ï¼š$t_i \in [0, 1]$ï¼Œè¡¨ç¤ºå±äºè¯¥ç±»çš„ç½®ä¿¡åº¦</p>
<p><strong>äºŒåˆ†ç±»äº¤å‰ç†µçš„è½¯æ ‡ç­¾ç‰ˆæœ¬</strong>ï¼š
\begin{equation}
\mathcal{L}_{\text{soft-BCE}}(s, t) = -t\log\sigma(s) - (1-t)\log(1-\sigma(s)) \tag{9}
\end{equation}</p>
<p><strong>æ¨å¹¿åˆ°å¤šæ ‡ç­¾</strong>ï¼ˆæ¯ä¸ªæ ‡ç­¾æœ‰è½¯æ ‡ç­¾$t_i\in[0,1]$ï¼‰ï¼š
\begin{equation}
\mathcal{L} = -\sum_i t_i\log\sigma(s_i) - \sum_i (1-t_i)\log(1-\sigma(s_i)) \tag{10}
\end{equation}</p>
<p><strong>æ”¹å†™ä¸ºå¯¹æ•°å½¢å¼</strong>ï¼š
\begin{equation}
\mathcal{L} = \sum_i t_i\log(1+e^{-s_i}) + \sum_i (1-t_i)\log(1+e^{s_i}) \tag{11}
\end{equation}</p>
<p><strong>è½¬æ¢ä¸ºä¹˜ç§¯å½¢å¼</strong>ï¼š
\begin{equation}
\mathcal{L} = \log\prod_i (1+e^{-s_i})^{t_i} + \log\prod_i (1+e^{s_i})^{1-t_i} \tag{12}
\end{equation}</p>
<p><strong>äºŒé¡¹å¼å±•å¼€</strong>ï¼ˆå…³é”®æ­¥éª¤ï¼‰ï¼š</p>
<p>å¯¹äº$(1+x)^t$ï¼Œå½“$t\in(0,1)$æ—¶ï¼Œä½¿ç”¨äºŒé¡¹å¼å®šç†çš„æ¨å¹¿ï¼š
\begin{equation}
(1+x)^t = 1 + tx + \frac{t(t-1)}{2!}x^2 + \frac{t(t-1)(t-2)}{3!}x^3 + \cdots \tag{13}
\end{equation}</p>
<p>å› æ­¤ï¼š
\begin{equation}
(1+e^{-s_i})^{t_i} = 1 + t_i e^{-s_i} + \frac{t_i(t_i-1)}{2}e^{-2s_i} + \cdots \tag{14}
\end{equation}</p>
<p><strong>ä¹˜ç§¯å±•å¼€</strong>ï¼š
\begin{equation}
\prod_i (1+t_i e^{-s_i} + \cdots) = 1 + \sum_i t_i e^{-s_i} + \text{(é«˜é˜¶é¡¹)} \tag{15}
\end{equation}</p>
<p>é«˜é˜¶é¡¹åŒ…æ‹¬ï¼š
- äºŒé˜¶é¡¹ï¼š$\sum_{i&lt;j} t_i t_j e^{-s_i-s_j}$ï¼Œ$\sum_i \frac{t_i(t_i-1)}{2}e^{-2s_i}$
- æ›´é«˜é˜¶é¡¹...</p>
<p><strong>è½¯æ ‡ç­¾å¤šæ ‡ç­¾SoftmaxæŸå¤±</strong>ï¼ˆåªä¿ç•™ä¸€é˜¶é¡¹ï¼‰ï¼š
\begin{equation}
\boxed{\mathcal{L}_{\text{soft}} = \log\left(1 + \sum_i t_i e^{-s_i}\right) + \log\left(1 + \sum_i (1-t_i)e^{s_i}\right)} \tag{16}
\end{equation}</p>
<p>è¿™æ­£æ˜¯åŸæ–‡çš„å¼(7)ï¼</p>
<p><strong>éªŒè¯</strong>ï¼šå½“$t_i\in{0,1}$æ—¶ï¼š
- è‹¥$t_i=1$ï¼šç¬¬ä¸€é¡¹åŒ…å«$e^{-s_i}$ï¼Œç¬¬äºŒé¡¹ä¸å«$e^{s_i}$
- è‹¥$t_i=0$ï¼šç¬¬ä¸€é¡¹ä¸å«$e^{-s_i}$ï¼Œç¬¬äºŒé¡¹åŒ…å«$e^{s_i}$</p>
<p>æ°å¥½é€€åŒ–ä¸ºå¼(8)ï¼</p>
<h3 id="4-2s_i">4. æœ€ä¼˜è§£çš„æ¨å¯¼ï¼šÏƒ(2s_i)å…¬å¼</h3>
<p><strong>æŸå¤±å‡½æ•°çš„æ¢¯åº¦</strong>ï¼š</p>
<p>å¯¹$s_i$æ±‚åå¯¼ï¼š
\begin{equation}
\begin{aligned}
\frac{\partial \mathcal{L}_{\text{soft}}}{\partial s_i} &amp;= \frac{\partial}{\partial s_i}\left[\log\left(1 + \sum_j t_j e^{-s_j}\right) + \log\left(1 + \sum_j (1-t_j)e^{s_j}\right)\right] \
&amp;= \frac{-t_i e^{-s_i}}{1 + \sum_j t_j e^{-s_j}} + \frac{(1-t_i)e^{s_i}}{1 + \sum_j (1-t_j)e^{s_j}}
\end{aligned} \tag{17}
\end{equation}</p>
<p><strong>æœ€ä¼˜æ¡ä»¶</strong>ï¼š$\frac{\partial \mathcal{L}_{\text{soft}}}{\partial s_i} = 0$ å¯¹æ‰€æœ‰$i$æˆç«‹ã€‚</p>
<p>å³ï¼š
\begin{equation}
\frac{t_i e^{-s_i}}{1 + \sum_j t_j e^{-s_j}} = \frac{(1-t_i)e^{s_i}}{1 + \sum_j (1-t_j)e^{s_j}} \tag{18}
\end{equation}</p>
<p><strong>å…³é”®è§‚å¯Ÿ</strong>ï¼šæ³¨æ„åˆ°å¦‚æœå¯¹æ‰€æœ‰$i$éƒ½æœ‰ï¼š
\begin{equation}
t_i e^{-s_i} = (1-t_i)e^{s_i} \tag{19}
\end{equation}</p>
<p>é‚£ä¹ˆï¼š
\begin{equation}
\sum_j t_j e^{-s_j} = \sum_j (1-t_j)e^{s_j} \tag{20}
\end{equation}</p>
<p>ä»£å…¥å¼(18)çš„å·¦å³ä¸¤è¾¹ï¼Œè‡ªåŠ¨æ»¡è¶³ï¼</p>
<p><strong>æ±‚è§£å¼(19)</strong>ï¼š
\begin{equation}
\begin{aligned}
t_i e^{-s_i} &amp;= (1-t_i)e^{s_i} \
t_i &amp;= (1-t_i)e^{2s_i} \
\frac{t_i}{1-t_i} &amp;= e^{2s_i} \
e^{2s_i} &amp;= \frac{t_i}{1-t_i}
\end{aligned} \tag{21}
\end{equation}</p>
<p><strong>åè§£$t_i$</strong>ï¼š
\begin{equation}
\begin{aligned}
e^{2s_i}(1-t_i) &amp;= t_i \
e^{2s_i} - e^{2s_i}t_i &amp;= t_i \
e^{2s_i} &amp;= t_i(1 + e^{2s_i}) \
t_i &amp;= \frac{e^{2s_i}}{1 + e^{2s_i}}
\end{aligned} \tag{22}
\end{equation}</p>
<p><strong>æœ€ç»ˆç»“æœ</strong>ï¼š
\begin{equation}
\boxed{t_i = \sigma(2s_i) = \frac{1}{1 + e^{-2s_i}}} \tag{23}
\end{equation}</p>
<p>è¿™æ˜¯ä¸€ä¸ªéå¸¸ä¼˜é›…çš„ç»“æœï¼</p>
<h3 id="5-2s_i">5. Ïƒ(2s_i)çš„æ·±å±‚ç†è§£</h3>
<p><strong>ä¸ºä»€ä¹ˆæ˜¯2å€ï¼Ÿ</strong></p>
<p>ä»å¼(21)å¯ä»¥çœ‹å‡ºï¼š
\begin{equation}
\log\frac{t_i}{1-t_i} = 2s_i \tag{24}
\end{equation}</p>
<p>å·¦è¾¹æ˜¯<strong>logitå‡½æ•°</strong>ï¼ˆsigmoidçš„åå‡½æ•°ï¼‰ï¼š
\begin{equation}
\text{logit}(t_i) = \log\frac{t_i}{1-t_i} \tag{25}
\end{equation}</p>
<p>å› æ­¤ï¼š
\begin{equation}
s_i = \frac{1}{2}\text{logit}(t_i) \tag{26}
\end{equation}</p>
<p><strong>å‡ ä½•è§£é‡Š</strong>ï¼š
- åœ¨logitç©ºé—´ä¸­ï¼Œ$s_i$æ˜¯$t_i$çš„logitå€¼çš„ä¸€åŠ
- åœ¨æ¦‚ç‡ç©ºé—´ä¸­ï¼Œéœ€è¦å°†$s_i$æ”¾å¤§2å€æ‰èƒ½è¿˜åŸ$t_i$</p>
<p><strong>å¯¹ç§°æ€§åˆ†æ</strong>ï¼š</p>
<p>æ³¨æ„åˆ°å¼(19)å…·æœ‰å¯¹ç§°æ€§ï¼š
\begin{equation}
t_i e^{-s_i} = (1-t_i)e^{s_i} \tag{27}
\end{equation}</p>
<p>å¯ä»¥æ”¹å†™ä¸ºï¼š
\begin{equation}
\frac{t_i}{1-t_i} = e^{2s_i} \tag{28}
\end{equation}</p>
<p>è¿™è¯´æ˜<strong>odds ratio</strong>ï¼ˆèµ”ç‡ï¼‰ç­‰äº$e^{2s_i}$ã€‚</p>
<h3 id="6">6. æ¢¯åº¦çš„è¯¦ç»†åˆ†æ</h3>
<p><strong>æŸå¤±å‡½æ•°çš„HessiançŸ©é˜µ</strong>ï¼š</p>
<p>äºŒé˜¶å¯¼æ•°ï¼š
\begin{equation}
\frac{\partial^2 \mathcal{L}<em i="i" j_neq="j\neq">{\text{soft}}}{\partial s_i^2} = \frac{t_i e^{-s_i}(1+\sum</em>
\end{equation}} t_j e^{-s_j})}{(1+\sum_j t_j e^{-s_j})^2} + \frac{(1-t_i)e^{s_i}(1+\sum_{j\neq i}(1-t_j)e^{s_j})}{(1+\sum_j(1-t_j)e^{s_j})^2} \tag{29</p>
<p>æ³¨æ„åˆ°ï¼š
\begin{equation}
\frac{\partial^2 \mathcal{L}_{\text{soft}}}{\partial s_i^2} &gt; 0 \tag{30}
\end{equation}</p>
<p>è¯´æ˜æŸå¤±å‡½æ•°æ˜¯<strong>å‡¸å‡½æ•°</strong>ï¼</p>
<p><strong>äº¤å‰å¯¼æ•°</strong>ï¼ˆ$i\neq j$ï¼‰ï¼š
\begin{equation}
\frac{\partial^2 \mathcal{L}_{\text{soft}}}{\partial s_i \partial s_j} = \frac{t_i t_j e^{-s_i-s_j}}{(1+\sum_k t_k e^{-s_k})^2} - \frac{(1-t_i)(1-t_j)e^{s_i+s_j}}{(1+\sum_k(1-t_k)e^{s_k})^2} \tag{31}
\end{equation}</p>
<p><strong>æœ€ä¼˜ç‚¹å¤„çš„Hessian</strong>ï¼ˆåœ¨$t_i = \sigma(2s_i)$å¤„ï¼‰ï¼š</p>
<p>åˆ©ç”¨å¼(20)ï¼Œè®°$Z = 1 + \sum_j t_j e^{-s_j} = 1 + \sum_j (1-t_j)e^{s_j}$ï¼Œåˆ™ï¼š
\begin{equation}
\frac{\partial^2 \mathcal{L}<em _text_opt="\text{opt">{\text{soft}}}{\partial s_i^2}\bigg|</em>
\end{equation}}} = \frac{t_i e^{-s_i}(Z-t_i e^{-s_i})}{Z^2} + \frac{(1-t_i)e^{s_i}(Z-(1-t_i)e^{s_i})}{Z^2} \tag{32</p>
<p>åˆ©ç”¨$t_i e^{-s_i} = (1-t_i)e^{s_i}$ï¼Œè®°$w_i = t_i e^{-s_i}$ï¼Œåˆ™ï¼š
\begin{equation}
\frac{\partial^2 \mathcal{L}<em _text_opt="\text{opt">{\text{soft}}}{\partial s_i^2}\bigg|</em>
\end{equation}}} = \frac{2w_i(Z-w_i)}{Z^2} = \frac{2w_i}{Z} - \frac{2w_i^2}{Z^2} \tag{33</p>
<p>è¿™ä¿è¯äº†æœ€ä¼˜ç‚¹æ˜¯<strong>å±€éƒ¨æå°å€¼</strong>ã€‚</p>
<h3 id="7">7. ä¸çŸ¥è¯†è’¸é¦çš„è”ç³»</h3>
<p><strong>çŸ¥è¯†è’¸é¦å›é¡¾</strong>ï¼š</p>
<p>åœ¨çŸ¥è¯†è’¸é¦ä¸­ï¼Œæ•™å¸ˆæ¨¡å‹è¾“å‡ºè½¯æ ‡ç­¾$t_i^{\text{teacher}}$ï¼Œå­¦ç”Ÿæ¨¡å‹å­¦ä¹ è¿™äº›è½¯æ ‡ç­¾ã€‚</p>
<p><strong>æ¸©åº¦ç¼©æ”¾</strong>ï¼š</p>
<p>å¯¹äºå•æ ‡ç­¾åˆ†ç±»ï¼Œæ•™å¸ˆçš„è½¯æ ‡ç­¾é€šå¸¸å®šä¹‰ä¸ºï¼š
\begin{equation}
t_i^{\text{teacher}} = \frac{e^{z_i/T}}{\sum_j e^{z_j/T}} \tag{34}
\end{equation}</p>
<p>å…¶ä¸­$T$æ˜¯æ¸©åº¦å‚æ•°ï¼Œ$z_i$æ˜¯æ•™å¸ˆçš„logitsã€‚</p>
<p><strong>Dark Knowledge</strong>ï¼š</p>
<p>æ¸©åº¦$T&gt;1$æ—¶ï¼Œè½¯æ ‡ç­¾æ›´åŠ "å¹³æ»‘"ï¼ŒåŒ…å«äº†ç±»åˆ«é—´çš„ç›¸ä¼¼æ€§ä¿¡æ¯ã€‚è¿™è¢«ç§°ä¸º<strong>æš—çŸ¥è¯†</strong>ï¼ˆDark Knowledgeï¼‰ã€‚</p>
<p><strong>ä¸æˆ‘ä»¬çš„å…¬å¼çš„å¯¹æ¯”</strong>ï¼š</p>
<p>åœ¨æˆ‘ä»¬çš„å¤šæ ‡ç­¾è®¾å®šä¸­ï¼Œè½¯æ ‡ç­¾$t_i$ç›´æ¥ç»™å®šï¼Œå­¦ç”Ÿæ¨¡å‹å­¦ä¹ $s_i$ä½¿å¾—$\sigma(2s_i) \approx t_i$ã€‚</p>
<p>è¿™ç›¸å½“äº<strong>éšå¼çš„æ¸©åº¦å‚æ•°$T=0.5$</strong>ï¼š
\begin{equation}
t_i = \sigma\left(\frac{s_i}{0.5}\right) = \sigma(2s_i) \tag{35}
\end{equation}</p>
<p><strong>ä¸ºä»€ä¹ˆæ˜¯0.5è€Œä¸æ˜¯1ï¼Ÿ</strong></p>
<p>å› ä¸ºåœ¨å¤šæ ‡ç­¾è®¾å®šä¸­ï¼Œæ¯ä¸ªç±»åˆ«æ˜¯ç‹¬ç«‹çš„äºŒåˆ†ç±»ï¼Œä¸éœ€è¦åƒå•æ ‡ç­¾é‚£æ ·åœ¨ç±»åˆ«é—´è¿›è¡Œå½’ä¸€åŒ–ã€‚å› å­2æ¥è‡ªäºå¼(19)çš„å¯¹ç§°æ€§æ¡ä»¶ã€‚</p>
<h3 id="8">8. æ•°å€¼ç¨³å®šæ€§åˆ†æ</h3>
<p><strong>æ•°å€¼æº¢å‡ºé—®é¢˜</strong>ï¼š</p>
<p>å½“$s_i$å¾ˆå¤§æ—¶ï¼š
- $e^{s_i}$ä¼šæº¢å‡ºï¼ˆè¶…è¿‡æµ®ç‚¹æ•°ä¸Šé™ï¼‰
- $e^{-s_i}$ä¼šä¸‹æº¢ï¼ˆæ¥è¿‘0ï¼‰</p>
<p><strong>LogSumExpæŠ€å·§</strong>ï¼š</p>
<p>å¯¹äº$\log(1 + \sum_i e^{x_i})$ï¼Œä½¿ç”¨ï¼š
\begin{equation}
\log\left(1 + \sum_i e^{x_i}\right) = \log\left(e^{x_{\max}}\left(e^{-x_{\max}} + \sum_i e^{x_i - x_{\max}}\right)\right) = x_{\max} + \log\left(e^{-x_{\max}} + \sum_i e^{x_i - x_{\max}}\right) \tag{36}
\end{equation}</p>
<p>å…¶ä¸­$x_{\max} = \max_i x_i$ã€‚</p>
<p><strong>åº”ç”¨åˆ°æˆ‘ä»¬çš„æŸå¤±</strong>ï¼š</p>
<p>ç¬¬ä¸€é¡¹ï¼š
\begin{equation}
\log\left(1 + \sum_i t_i e^{-s_i}\right) = \log\left(1 + \sum_i e^{\log t_i - s_i}\right) \tag{37}
\end{equation}</p>
<p>è®°$x_i = \log t_i - s_i$ï¼Œåº”ç”¨LogSumExpã€‚</p>
<p><strong>å¤„ç†$t_i=0$æˆ–$t_i=1$çš„æƒ…å†µ</strong>ï¼š</p>
<p>å½“$t_i=0$æ—¶ï¼Œ$\log t_i = -\infty$ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†ï¼š
- åœ¨ç¬¬ä¸€é¡¹ä¸­ï¼Œç›´æ¥æ’é™¤$t_i=0$çš„é¡¹
- åœ¨ç¬¬äºŒé¡¹ä¸­ï¼Œ$1-t_i=1$ï¼Œä¿ç•™$e^{s_i}$é¡¹</p>
<p>å½“$t_i=1$æ—¶ï¼Œ$\log(1-t_i) = -\infty$ï¼š
- åœ¨ç¬¬ä¸€é¡¹ä¸­ï¼Œä¿ç•™$e^{-s_i}$é¡¹
- åœ¨ç¬¬äºŒé¡¹ä¸­ï¼Œç›´æ¥æ’é™¤$t_i=1$çš„é¡¹</p>
<p><strong>Clipæ“ä½œ</strong>ï¼š</p>
<p>å®è·µä¸­ï¼Œè®¾ç½®$\epsilon = 10^{-7}$ï¼š
\begin{equation}
t_i' = \begin{cases}
\epsilon, &amp; t_i &lt; \epsilon \
t_i, &amp; \epsilon \leq t_i \leq 1-\epsilon \
1-\epsilon, &amp; t_i &gt; 1-\epsilon
\end{cases} \tag{38}
\end{equation}</p>
<p>ä½†éœ€è¦é¢å¤–å¤„ç†maskï¼Œå¦‚åŸæ–‡æ‰€è¿°ã€‚</p>
<h3 id="9">9. å®ç°ç»†èŠ‚</h3>
<p><strong>æ”¹å†™ä¸ºç­‰ä»·å½¢å¼</strong>ï¼š</p>
<p>\begin{equation}
\mathcal{L}_{\text{soft}} = \log\left(1 + \sum_i e^{-s_i + \log t_i}\right) + \log\left(1 + \sum_i e^{s_i + \log(1-t_i)}\right) \tag{39}
\end{equation}</p>
<p><strong>å¤„ç†mask</strong>ï¼š</p>
<p>å¯¹äºè¢«maskçš„ä½ç½®ï¼ˆ$s_i = -\infty$ï¼‰ï¼š
1. è‹¥$t_i &lt; \epsilon$ï¼šæ‰‹åŠ¨å°†$-s_i$ç½®ä¸ºå¤§è´Ÿæ•°
2. è‹¥$t_i &gt; 1-\epsilon$ï¼šæ‰‹åŠ¨å°†$s_i$ç½®ä¸ºå¤§è´Ÿæ•°</p>
<p><strong>ä¼ªä»£ç </strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">multilabel_categorical_crossentropy_soft</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    y_true: è½¯æ ‡ç­¾ï¼Œshape [batch_size, num_labels]</span>
<span class="sd">    y_pred: logitsï¼Œshape [batch_size, num_labels]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Clip soft labels</span>
    <span class="n">y_true</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">clip_by_value</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">)</span>

    <span class="c1"># ç¬¬ä¸€é¡¹ï¼šlog(1 + sum(t_i * exp(-s_i)))</span>
    <span class="c1"># ç­‰ä»·äºï¼šlog(1 + sum(exp(log(t_i) - s_i)))</span>
    <span class="n">neg_logits</span> <span class="o">=</span> <span class="o">-</span><span class="n">y_pred</span> <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>
    <span class="c1"># å¯¹äº t_i &lt; epsilon çš„ä½ç½®ï¼Œæ‰‹åŠ¨mask</span>
    <span class="n">mask_neg</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">y_true</span> <span class="o">&lt;</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">neg_logits</span> <span class="o">=</span> <span class="n">neg_logits</span> <span class="o">-</span> <span class="n">mask_neg</span> <span class="o">*</span> <span class="mf">1e12</span>
    <span class="n">loss1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_logsumexp</span><span class="p">(</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">tf</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">neg_logits</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">1</span><span class="p">]),</span> <span class="n">neg_logits</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>

    <span class="c1"># ç¬¬äºŒé¡¹ï¼šlog(1 + sum((1-t_i) * exp(s_i)))</span>
    <span class="n">pos_logits</span> <span class="o">=</span> <span class="n">y_pred</span> <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y_true</span><span class="p">)</span>
    <span class="c1"># å¯¹äº t_i &gt; 1-epsilon çš„ä½ç½®ï¼Œæ‰‹åŠ¨mask</span>
    <span class="n">mask_pos</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">y_true</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">pos_logits</span> <span class="o">=</span> <span class="n">pos_logits</span> <span class="o">-</span> <span class="n">mask_pos</span> <span class="o">*</span> <span class="mf">1e12</span>
    <span class="n">loss2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_logsumexp</span><span class="p">(</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">tf</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">pos_logits</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">1</span><span class="p">]),</span> <span class="n">pos_logits</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">loss1</span> <span class="o">+</span> <span class="n">loss2</span>
</code></pre></div>

<h3 id="10-mixuplabel-smoothing">10. ä¸Mixupå’ŒLabel Smoothingçš„ç»“åˆ</h3>
<p><strong>Label Smoothing</strong>ï¼š</p>
<p>å¯¹äºç¡¬æ ‡ç­¾$y_i\in{0,1}$ï¼Œlabel smoothingå®šä¹‰è½¯æ ‡ç­¾ä¸ºï¼š
\begin{equation}
t_i = (1-\alpha)y_i + \alpha \cdot \frac{1}{2} = \begin{cases}
\alpha/2, &amp; y_i = 0 \
1 - \alpha/2, &amp; y_i = 1
\end{cases} \tag{40}
\end{equation}</p>
<p>å…¶ä¸­$\alpha\in(0,1)$æ˜¯å¹³æ»‘ç³»æ•°ï¼ˆä¾‹å¦‚$\alpha=0.1$ï¼‰ã€‚</p>
<p><strong>Mixup</strong>ï¼š</p>
<p>å¯¹äºä¸¤ä¸ªæ ·æœ¬$(x_1, y_1)$å’Œ$(x_2, y_2)$ï¼Œmixupç”Ÿæˆæ–°æ ·æœ¬ï¼š
\begin{equation}
\tilde{x} = \lambda x_1 + (1-\lambda)x_2, \quad \tilde{y} = \lambda y_1 + (1-\lambda)y_2 \tag{41}
\end{equation}</p>
<p>å…¶ä¸­$\lambda \sim \text{Beta}(\alpha, \alpha)$ã€‚</p>
<p><strong>ä¸æˆ‘ä»¬çš„æŸå¤±ç»“åˆ</strong>ï¼š</p>
<p>ç”Ÿæˆçš„è½¯æ ‡ç­¾$\tilde{y}<em _text_soft="\text{soft">i \in [0, 1]$å¯ä»¥ç›´æ¥ç”¨äºæˆ‘ä»¬çš„æŸå¤±å‡½æ•°$\mathcal{L}</em>$ï¼}</p>
<p>è¿™æ˜¯ç¡¬æ ‡ç­¾ç‰ˆæœ¬ï¼ˆå¼8ï¼‰æ— æ³•åšåˆ°çš„ã€‚</p>
<h3 id="11">11. ç†è®ºæ€§è´¨æ€»ç»“</h3>
<p><strong>æ€§è´¨1ï¼šå‡¸æ€§</strong>
\begin{equation}
\mathcal{L}_{\text{soft}}(s) \text{ æ˜¯ } s \text{ çš„å‡¸å‡½æ•°} \tag{42}
\end{equation}</p>
<p>è¯æ˜ï¼šHessiançŸ©é˜µåŠæ­£å®šï¼ˆè§å¼29-33ï¼‰ã€‚</p>
<p><strong>æ€§è´¨2ï¼šå¯è¿˜åŸæ€§</strong>
\begin{equation}
t_i = \sigma(2s_i^<em>) \quad \text{å…¶ä¸­ } s^</em> = \arg\min_s \mathcal{L}_{\text{soft}}(s) \tag{43}
\end{equation}</p>
<p>è¯æ˜ï¼šè§å¼(23)ã€‚</p>
<p><strong>æ€§è´¨3ï¼šé€€åŒ–æ€§</strong>
\begin{equation}
t_i \in {0,1} \Rightarrow \mathcal{L}<em _text_ML-Softmax="\text{ML-Softmax">{\text{soft}} = \mathcal{L}</em>
\end{equation}}} \tag{44</p>
<p>è¯æ˜ï¼šç›´æ¥éªŒè¯ã€‚</p>
<p><strong>æ€§è´¨4ï¼šæ¢¯åº¦æœ‰ç•Œæ€§</strong></p>
<p>å¯¹äº$t_i\in[\epsilon, 1-\epsilon]$å’Œæœ‰ç•Œçš„$s_i$ï¼š
\begin{equation}
\left|\frac{\partial \mathcal{L}_{\text{soft}}}{\partial s_i}\right| \leq C \tag{45}
\end{equation}</p>
<p>å…¶ä¸­$C$æ˜¯å¸¸æ•°ï¼Œè¿™ä¿è¯äº†æ¢¯åº¦ä¸ä¼šçˆ†ç‚¸ã€‚</p>
<h3 id="12-globalpointer">12. GlobalPointerä¸­çš„åº”ç”¨</h3>
<p><strong>GlobalPointerèƒŒæ™¯</strong>ï¼š</p>
<p>åœ¨å‘½åå®ä½“è¯†åˆ«ä¸­ï¼ŒGlobalPointerå°†å®ä½“è¯†åˆ«å»ºæ¨¡ä¸º"é€‰æ‹©å¤´å°¾ä½ç½®å¯¹"çš„å¤šæ ‡ç­¾åˆ†ç±»é—®é¢˜ã€‚</p>
<p><strong>æ‰“åˆ†å‡½æ•°</strong>ï¼š</p>
<p>å¯¹äºä½ç½®å¯¹$(i,j)$ï¼Œå®šä¹‰æ‰“åˆ†ï¼š
\begin{equation}
s_{ij} = \boldsymbol{q}_i^{\top} \boldsymbol{k}_j \tag{46}
\end{equation}</p>
<p><strong>Maskå¤„ç†</strong>ï¼š</p>
<p>å¯¹äºæ— æ•ˆçš„ä½ç½®å¯¹ï¼ˆå¦‚$i&gt;j$ï¼‰ï¼Œè®¾ç½®$s_{ij} = -\infty$ï¼ˆå®é™…ä¸­ç”¨$-10^7$ï¼‰ã€‚</p>
<p><strong>è½¯æ ‡ç­¾åœºæ™¯</strong>ï¼š</p>
<p>åœ¨éƒ¨åˆ†æ ‡æ³¨ã€è¿œç¨‹ç›‘ç£ç­‰åœºæ™¯ä¸‹ï¼Œæ ‡ç­¾å¯èƒ½æ˜¯ä¸ç¡®å®šçš„ï¼Œå¯ä»¥ç”¨è½¯æ ‡ç­¾$t_{ij}\in(0,1)$è¡¨ç¤ºç½®ä¿¡åº¦ã€‚</p>
<p>ä½¿ç”¨æˆ‘ä»¬çš„æŸå¤±ï¼š
\begin{equation}
\mathcal{L} = \log\left(1 + \sum_{(i,j)} t_{ij} e^{-s_{ij}}\right) + \log\left(1 + \sum_{(i,j)} (1-t_{ij})e^{s_{ij}}\right) \tag{47}
\end{equation}</p>
<p><strong>é¢„æµ‹</strong>ï¼š</p>
<p>è®­ç»ƒåï¼Œå¯¹äºä½ç½®å¯¹$(i,j)$ï¼Œé¢„æµ‹æ¦‚ç‡ä¸ºï¼š
\begin{equation}
p_{ij} = \sigma(2s_{ij}) = \frac{1}{1 + e^{-2s_{ij}}} \tag{48}
\end{equation}</p>
<h3 id="13-focal-loss">13. ä¸Focal Lossçš„å¯¹æ¯”</h3>
<p><strong>Focal Losså›é¡¾</strong>ï¼š</p>
<p>Focal Lossç”¨äºå¤„ç†ç±»åˆ«ä¸å¹³è¡¡ï¼Œå®šä¹‰ä¸ºï¼š
\begin{equation}
\mathcal{L}_{\text{focal}} = -\alpha_t (1-p_t)^\gamma \log p_t \tag{49}
\end{equation}</p>
<p>å…¶ä¸­$p_t$æ˜¯çœŸå®ç±»åˆ«çš„é¢„æµ‹æ¦‚ç‡ï¼Œ$\gamma&gt;0$æ˜¯èšç„¦å‚æ•°ã€‚</p>
<p><strong>å¯¹æ¯”åˆ†æ</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>å¤„ç†ä¸å¹³è¡¡çš„æ–¹å¼</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>Focal Loss</td>
<td>é™ä½æ˜“åˆ†æ ·æœ¬çš„æƒé‡</td>
<td>å•æ ‡ç­¾åˆ†ç±»ï¼Œç›®æ ‡æ£€æµ‹</td>
</tr>
<tr>
<td>æˆ‘ä»¬çš„æ–¹æ³•</td>
<td>å»æ‰é«˜é˜¶é¡¹ï¼Œçº¿æ€§åŒ–æ±‚å’Œ</td>
<td>å¤šæ ‡ç­¾åˆ†ç±»</td>
</tr>
</tbody>
</table>
<p><strong>èƒ½å¦ç»“åˆï¼Ÿ</strong></p>
<p>ç†è®ºä¸Šå¯ä»¥ï¼Œå®šä¹‰ï¼š
\begin{equation}
\mathcal{L}_{\text{soft-focal}} = (1-p_i)^\gamma \left[\log\left(1 + \sum_i t_i e^{-s_i}\right) + \log\left(1 + \sum_i (1-t_i)e^{s_i}\right)\right] \tag{50}
\end{equation}</p>
<p>å…¶ä¸­$p_i = \sigma(2s_i)$ã€‚ä½†è¿™éœ€è¦æ›´å¤šå®éªŒéªŒè¯ã€‚</p>
<h3 id="14">14. è®¡ç®—å¤æ‚åº¦åˆ†æ</h3>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š</p>
<p>å¯¹äº$n$ä¸ªæ ‡ç­¾ï¼š
- å‰å‘ä¼ æ’­ï¼š$O(n)$ï¼ˆä¸¤æ¬¡æ±‚å’Œï¼‰
- åå‘ä¼ æ’­ï¼š$O(n)$ï¼ˆæ¢¯åº¦è®¡ç®—ï¼‰</p>
<p>ä¸æ ‡å‡†BCEç›¸åŒï¼</p>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š</p>
<p>éœ€è¦å­˜å‚¨ï¼š
- $s_i$ï¼š$O(n)$
- $t_i$ï¼š$O(n)$
- ä¸­é—´ç»“æœï¼ˆä¸¤ä¸ªæ±‚å’Œï¼‰ï¼š$O(1)$</p>
<p>æ€»è®¡ï¼š$O(n)$</p>
<p><strong>ä¸ç¡¬æ ‡ç­¾ç‰ˆæœ¬å¯¹æ¯”</strong>ï¼š</p>
<p>å®Œå…¨ç›¸åŒçš„å¤æ‚åº¦ï¼è½¯æ ‡ç­¾ç‰ˆæœ¬æ²¡æœ‰å¼•å…¥é¢å¤–å¼€é”€ã€‚</p>
<h3 id="15">15. å®éªŒå»ºè®®</h3>
<p><strong>è¶…å‚æ•°é€‰æ‹©</strong>ï¼š</p>
<ol>
<li><strong>Clipé˜ˆå€¼$\epsilon$</strong>ï¼šå»ºè®®$\epsilon \in [10^{-8}, 10^{-6}]$</li>
<li><strong>å­¦ä¹ ç‡</strong>ï¼šä¸BCEç›¸ä¼¼ï¼Œå»ºè®®ä»$10^{-4}$å¼€å§‹</li>
<li><strong>è½¯æ ‡ç­¾ç”Ÿæˆ</strong>ï¼š</li>
<li>Label smoothing: $\alpha \in [0.05, 0.2]$</li>
<li>Mixup: $\alpha \in [0.2, 0.4]$ï¼ˆBetaåˆ†å¸ƒå‚æ•°ï¼‰</li>
</ol>
<p><strong>è°ƒè¯•æŠ€å·§</strong>ï¼š</p>
<ol>
<li><strong>æ£€æŸ¥æ¢¯åº¦</strong>ï¼šç¡®ä¿æ¢¯åº¦ä¸ä¸ºNaN</li>
<li><strong>ç›‘æ§æŸå¤±</strong>ï¼šæŸå¤±åº”è¯¥å•è°ƒä¸‹é™</li>
<li><strong>éªŒè¯$\sigma(2s_i)$</strong>ï¼šåœ¨éªŒè¯é›†ä¸Šï¼Œæ£€æŸ¥$\sigma(2s_i) \approx t_i$æ˜¯å¦æˆç«‹</li>
</ol>
<p><strong>æ¶ˆèå®éªŒ</strong>ï¼š</p>
<p>å¯¹æ¯”ä»¥ä¸‹å˜ä½“ï¼š
1. ç¡¬æ ‡ç­¾ + BCE
2. ç¡¬æ ‡ç­¾ + æˆ‘ä»¬çš„æŸå¤±ï¼ˆå¼8ï¼‰
3. è½¯æ ‡ç­¾ + BCE
4. è½¯æ ‡ç­¾ + æˆ‘ä»¬çš„æŸå¤±ï¼ˆå¼16ï¼‰</p>
<h3 id="16">16. ä¿¡æ¯è®ºè§†è§’</h3>
<p><strong>äº’ä¿¡æ¯æœ€å¤§åŒ–</strong>ï¼š</p>
<p>æˆ‘ä»¬çš„æŸå¤±å¯ä»¥ç†è§£ä¸ºæœ€å¤§åŒ–æ ‡ç­¾$T$å’Œé¢„æµ‹$S$ä¹‹é—´çš„äº’ä¿¡æ¯ï¼š
\begin{equation}
I(T; S) = H(T) - H(T|S) \tag{51}
\end{equation}</p>
<p>å…¶ä¸­$H(T|S)$æ˜¯æ¡ä»¶ç†µã€‚</p>
<p><strong>KLæ•£åº¦è§£é‡Š</strong>ï¼š</p>
<p>æœ€å°åŒ–æˆ‘ä»¬çš„æŸå¤±ç­‰ä»·äºæœ€å°åŒ–çœŸå®åˆ†å¸ƒ$q(t)$å’Œæ¨¡å‹åˆ†å¸ƒ$p(t|s)$ä¹‹é—´çš„KLæ•£åº¦ï¼š
\begin{equation}
\mathbb{E}<em _text_soft="\text{soft">{(s,t)\sim\mathcal{D}}[\mathcal{L}</em>
\end{equation}}}(s, t)] \approx \text{KL}(q(t) | p(t|s)) + \text{const} \tag{52</p>
<p><strong>ç†µçš„åˆ†è§£</strong>ï¼š</p>
<p>å¯¹äºäºŒåˆ†ç±»ï¼Œç†µå¯ä»¥åˆ†è§£ä¸ºï¼š
\begin{equation}
H(t) = -t\log t - (1-t)\log(1-t) \tag{53}
\end{equation}</p>
<p>è¿™æ˜¯BCEçš„"ç›®æ ‡ç†µ"ï¼Œæˆ‘ä»¬çš„æŸå¤±é€šè¿‡å¼(16)çš„ç»“æ„éšå«åœ°ä¼˜åŒ–è¿™ä¸ªç›®æ ‡ã€‚</p>
<h3 id="17">17. æ¦‚ç‡è®ºè§†è§’</h3>
<p><strong>æœ€å¤§ä¼¼ç„¶ä¼°è®¡</strong>ï¼š</p>
<p>æˆ‘ä»¬çš„æŸå¤±å¯ä»¥ç†è§£ä¸ºè´Ÿå¯¹æ•°ä¼¼ç„¶ï¼š
\begin{equation}
\mathcal{L}_{\text{soft}} = -\log p(t|s; \theta) \tag{54}
\end{equation}</p>
<p>å…¶ä¸­$\theta$æ˜¯æ¨¡å‹å‚æ•°ã€‚</p>
<p><strong>è´å¶æ–¯è§£é‡Š</strong>ï¼š</p>
<p>å¦‚æœæˆ‘ä»¬å¯¹$t_i$æœ‰å…ˆéªŒåˆ†å¸ƒ$p(t_i)$ï¼Œé‚£ä¹ˆåéªŒåˆ†å¸ƒä¸ºï¼š
\begin{equation}
p(t_i | s_i) \propto p(s_i | t_i) p(t_i) \tag{55}
\end{equation}</p>
<p>åœ¨å‡åŒ€å…ˆéªŒä¸‹ï¼ŒMAPä¼°è®¡ç­‰ä»·äºMLEã€‚</p>
<p><strong>ç”Ÿæˆæ¨¡å‹è§†è§’</strong>ï¼š</p>
<p>å¯ä»¥å°†å¤šæ ‡ç­¾åˆ†ç±»è§†ä¸ºç”Ÿæˆæ¨¡å‹ï¼š
\begin{equation}
p(t, s) = p(s)p(t|s) = p(t)p(s|t) \tag{56}
\end{equation}</p>
<p>æˆ‘ä»¬çš„æŸå¤±ä¼˜åŒ–$p(t|s)$ï¼Œè€ŒçŸ¥è¯†è’¸é¦å¯ä»¥ç†è§£ä¸ºç”¨æ•™å¸ˆçš„$p(t)$ä½œä¸ºå…ˆéªŒã€‚</p>
<h3 id="18">18. å‡ ä½•è§£é‡Š</h3>
<p><strong>Logitç©ºé—´</strong>ï¼š</p>
<p>åœ¨logitç©ºé—´ä¸­ï¼Œ$s_i$å’Œ$\text{logit}(t_i)$çš„å…³ç³»ä¸ºï¼š
\begin{equation}
s_i = \frac{1}{2}\text{logit}(t_i) \tag{57}
\end{equation}</p>
<p>è¿™æ˜¯ä¸€ä¸ª<strong>çº¿æ€§å…³ç³»</strong>ï¼Œæ¯”ä¾‹ç³»æ•°ä¸º1/2ã€‚</p>
<p><strong>æ¦‚ç‡å•çº¯å½¢</strong>ï¼š</p>
<p>åœ¨$n$ç»´æ¦‚ç‡å•çº¯å½¢$\Delta^n = {t \in \mathbb{R}^n : t_i \geq 0, \sum_i t_i = 1}$ä¸Šï¼Œæˆ‘ä»¬çš„æŸå¤±å®šä¹‰äº†ä¸€ä¸ª<strong>Bregmanæ•£åº¦</strong>ã€‚</p>
<p><strong>æµå½¢ç»“æ„</strong>ï¼š</p>
<p>$\sigma(2s)$å®šä¹‰äº†ä»$\mathbb{R}^n$ï¼ˆscoreç©ºé—´ï¼‰åˆ°$(0,1)^n$ï¼ˆæ¦‚ç‡ç©ºé—´ï¼‰çš„å¾®åˆ†åŒèƒšã€‚</p>
<h3 id="19">19. ä¸å…¶ä»–å¤šæ ‡ç­¾æŸå¤±çš„å¯¹æ¯”</h3>
<p><strong>Asymmetric Loss</strong>ï¼ˆASLï¼‰ï¼š
\begin{equation}
\mathcal{L}<em i_in_Omega__text_pos="i\in\Omega_{\text{pos">{\text{ASL}} = -\sum</em>
\end{equation}}}} (1-p_i)^{\gamma_+} \log p_i - \sum_{i\in\Omega_{\text{neg}}} p_i^{\gamma_-} \log(1-p_i) \tag{58</p>
<p><strong>Circle Loss</strong>ï¼š
\begin{equation}
\mathcal{L}<em i_in_Omega__text_neg="i\in\Omega_{\text{neg">{\text{Circle}} = \log\left[1 + \sum</em>
\end{equation}}}} e^{\gamma(s_i - \Delta_n)}\right] + \log\left[1 + \sum_{j\in\Omega_{\text{pos}}} e^{\gamma(\Delta_p - s_j)}\right] \tag{59</p>
<p><strong>å¯¹æ¯”è¡¨</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>æŸå¤±å‡½æ•°</th>
<th>è½¯æ ‡ç­¾æ”¯æŒ</th>
<th>ç†è®ºä¿è¯</th>
<th>è®¡ç®—å¤æ‚åº¦</th>
</tr>
</thead>
<tbody>
<tr>
<td>BCE</td>
<td>æ˜¯</td>
<td>Fisherä¸€è‡´æ€§</td>
<td>O(n)</td>
</tr>
<tr>
<td>æˆ‘ä»¬çš„ç¡¬æ ‡ç­¾ç‰ˆæœ¬</td>
<td>å¦</td>
<td>å‡¸æ€§</td>
<td>O(n)</td>
</tr>
<tr>
<td>æˆ‘ä»¬çš„è½¯æ ‡ç­¾ç‰ˆæœ¬</td>
<td>æ˜¯</td>
<td>å‡¸æ€§ + å¯è¿˜åŸæ€§</td>
<td>O(n)</td>
</tr>
<tr>
<td>ASL</td>
<td>éƒ¨åˆ†</td>
<td>ç»éªŒæœ‰æ•ˆ</td>
<td>O(n)</td>
</tr>
<tr>
<td>Circle Loss</td>
<td>å¦</td>
<td>å‡ ä½•æ„ä¹‰</td>
<td>O(n)</td>
</tr>
</tbody>
</table>
<h3 id="20">20. å¼€æ”¾é—®é¢˜ä¸æœªæ¥æ–¹å‘</h3>
<p><strong>é—®é¢˜1</strong>ï¼šèƒ½å¦ä¸ºå¼(16)æ‰¾åˆ°æ›´ç´§çš„ç†è®ºç•Œï¼Ÿ</p>
<p>ç›®å‰æˆ‘ä»¬åªçŸ¥é“å®ƒæ˜¯å‡¸çš„ï¼Œä½†å…·ä½“çš„æ”¶æ•›é€Ÿåº¦å¦‚ä½•ï¼Ÿ</p>
<p><strong>é—®é¢˜2</strong>ï¼š$\sigma(2s_i)$çš„å› å­2æ˜¯å¦æœ€ä¼˜ï¼Ÿ</p>
<p>èƒ½å¦æ¨å¹¿åˆ°$\sigma(\beta s_i)$ï¼Œå…¶ä¸­$\beta$æ˜¯å¯å­¦ä¹ çš„å‚æ•°ï¼Ÿ</p>
<p><strong>é—®é¢˜3</strong>ï¼šå¦‚ä½•æ‰©å±•åˆ°æœ‰åºå¤šæ ‡ç­¾åˆ†ç±»ï¼Ÿ</p>
<p>å½“æ ‡ç­¾ä¹‹é—´æœ‰ä¾èµ–å…³ç³»æ—¶ï¼Œå¦‚ä½•ä¿®æ”¹æˆ‘ä»¬çš„æŸå¤±ï¼Ÿ</p>
<p><strong>é—®é¢˜4</strong>ï¼šä¸å¯¹æ¯”å­¦ä¹ çš„ç»“åˆï¼Ÿ</p>
<p>èƒ½å¦å°†æˆ‘ä»¬çš„æŸå¤±ä¸å¯¹æ¯”å­¦ä¹ æ¡†æ¶ç»“åˆï¼Œç”¨äºè¡¨ç¤ºå­¦ä¹ ï¼Ÿ</p>
<p><strong>æœªæ¥æ–¹å‘</strong>ï¼š
1. è‡ªé€‚åº”æ¸©åº¦å‚æ•°
2. å±‚æ¬¡åŒ–å¤šæ ‡ç­¾åˆ†ç±»
3. é•¿å°¾åˆ†å¸ƒä¸‹çš„æ”¹è¿›
4. ç†è®ºæ”¶æ•›æ€§åˆ†æ
5. ä¸å…ƒå­¦ä¹ çš„ç»“åˆ</p>
<hr />
<h2 id="_7">å‚è€ƒæ–‡çŒ®</h2>
<ol>
<li>Lin et al., "Focal Loss for Dense Object Detection", ICCV 2017</li>
<li>Zhang et al., "Generalized Cross Entropy Loss for Training Deep Neural Networks with Noisy Labels", NeurIPS 2018</li>
<li>Sun et al., "Circle Loss: A Unified Perspective of Pair Similarity Optimization", CVPR 2020</li>
<li>Ridnik et al., "Asymmetric Loss For Multi-Label Classification", ICCV 2021</li>
<li>Hinton et al., "Distilling the Knowledge in a Neural Network", NIPS 2014 Workshop</li>
</ol>
<h2 id="_8">æ€»ç»“</h2>
<p>æœ¬æ–‡è¯¦ç»†æ¨å¯¼äº†å¤šæ ‡ç­¾Softmaxäº¤å‰ç†µçš„è½¯æ ‡ç­¾ç‰ˆæœ¬ï¼Œå…³é”®è´¡çŒ®åŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>ç†è®ºæ¨å¯¼</strong>ï¼šä»BCEå‡ºå‘ï¼Œé€šè¿‡å»é™¤é«˜é˜¶é¡¹å¾—åˆ°è½¯æ ‡ç­¾ç‰ˆæœ¬</li>
<li><strong>æœ€ä¼˜è§£</strong>ï¼šè¯æ˜äº†$t_i = \sigma(2s_i)$çš„ä¼˜é›…ç»“æœ</li>
<li><strong>å®ç°ç»†èŠ‚</strong>ï¼šå¤„ç†æ•°å€¼ç¨³å®šæ€§å’Œmaskçš„æŠ€å·§</li>
<li><strong>å¤šè§’åº¦ç†è§£</strong>ï¼šä¿¡æ¯è®ºã€æ¦‚ç‡è®ºã€å‡ ä½•ç­‰è§†è§’</li>
<li><strong>å®è·µæŒ‡å¯¼</strong>ï¼šè¶…å‚æ•°é€‰æ‹©ã€è°ƒè¯•æŠ€å·§ã€åº”ç”¨åœºæ™¯</li>
</ol>
<p>è¿™ä¸ªæŸå¤±å‡½æ•°å°†å¤šæ ‡ç­¾åˆ†ç±»æ¨å‘äº†è½¯æ ‡ç­¾æ—¶ä»£ï¼Œä¸ºlabel smoothingã€mixupç­‰æŠ€æœ¯åœ¨å¤šæ ‡ç­¾åœºæ™¯çš„åº”ç”¨é“ºå¹³äº†é“è·¯ã€‚</p>
        </div>
    </div>
</body>
</html>