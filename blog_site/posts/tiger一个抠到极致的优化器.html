<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tigerï¼šä¸€ä¸ªâ€œæŠ â€åˆ°æè‡´çš„ä¼˜åŒ–å™¨</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>Tigerï¼šä¸€ä¸ªâ€œæŠ â€åˆ°æè‡´çš„ä¼˜åŒ–å™¨</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-26 | ğŸ“„ å¤§å°: 39.3 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/9512">https://spaces.ac.cn/archives/9512</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>è¿™æ®µæ—¶é—´ç¬”è€…ä¸€ç›´åœ¨å®éªŒ<a href="/archives/9473">ã€ŠGoogleæ–°æœå‡ºçš„ä¼˜åŒ–å™¨Lionï¼šæ•ˆç‡ä¸æ•ˆæœå…¼å¾—çš„â€œè®­ç»ƒç‹®â€ã€‹</a>æ‰€ä»‹ç»çš„Lionä¼˜åŒ–å™¨ã€‚ä¹‹æ‰€ä»¥å¯¹Lioné¥¶æœ‰å…´è‡´ï¼Œæ˜¯å› ä¸ºå®ƒè·Ÿç¬”è€…ä¹‹å‰çš„å…³äºç†æƒ³ä¼˜åŒ–å™¨çš„ä¸€äº›æƒ³æ³•ä¸è°‹è€Œåˆï¼Œä½†å½“æ—¶ç¬”è€…æ²¡æœ‰è°ƒå‡ºå¥½çš„æ•ˆæœï¼Œè€ŒLionåˆ™åšå¥½äº†ã€‚</p>
<p>ç›¸æ¯”æ ‡å‡†çš„Lionï¼Œç¬”è€…æ›´æ„Ÿå…´è¶£çš„æ˜¯å®ƒåœ¨$\beta_1=\beta_2$æ—¶çš„ç‰¹æ®Šä¾‹å­ï¼Œè¿™é‡Œç§°ä¹‹ä¸ºâ€œ<strong>Tiger</strong> â€ã€‚Tigeråªç”¨åˆ°äº†åŠ¨é‡æ¥æ„å»ºæ›´æ–°é‡ï¼Œæ ¹æ®<a href="/archives/8634">ã€Šéšè—åœ¨åŠ¨é‡ä¸­çš„æ¢¯åº¦ç´¯ç§¯ï¼šå°‘æ›´æ–°å‡ æ­¥ï¼Œæ•ˆæœåè€Œæ›´å¥½ï¼Ÿã€‹</a>çš„ç»“è®ºï¼Œæ­¤æ—¶æˆ‘ä»¬ä¸æ–°å¢ä¸€ç»„å‚æ•°æ¥â€œæ— æ„Ÿâ€åœ°å®ç°æ¢¯åº¦ç´¯ç§¯ï¼è¿™ä¹Ÿæ„å‘³ç€åœ¨æˆ‘ä»¬æœ‰æ¢¯åº¦ç´¯ç§¯éœ€æ±‚æ—¶ï¼ŒTigerå·²ç»è¾¾åˆ°äº†æ˜¾å­˜å ç”¨çš„æœ€ä¼˜è§£ï¼Œè¿™ä¹Ÿæ˜¯â€œTigerâ€è¿™ä¸ªåå­—çš„æ¥æºï¼ˆ<strong>Tig</strong> ht-fisted Optimiz<strong>er</strong> ï¼ŒæŠ é—¨çš„ä¼˜åŒ–å™¨ï¼Œä¸èˆå¾—å¤šèŠ±ä¸€ç‚¹æ˜¾å­˜ï¼‰ã€‚</p>
<p>æ­¤å¤–ï¼ŒTigerè¿˜åŠ å…¥äº†æˆ‘ä»¬çš„ä¸€äº›è¶…å‚æ•°è°ƒèŠ‚ç»éªŒï¼Œä»¥åŠæå‡ºäº†ä¸€ä¸ªé˜²æ­¢æ¨¡å‹å‡ºç°NaNï¼ˆå°¤å…¶æ˜¯æ··åˆç²¾åº¦è®­ç»ƒä¸‹ï¼‰çš„ç®€å•ç­–ç•¥ã€‚æˆ‘ä»¬çš„åˆæ­¥å®éªŒæ˜¾ç¤ºï¼ŒTigerçš„è¿™äº›æ”¹åŠ¨ï¼Œèƒ½å¤Ÿæ›´åŠ å‹å¥½åœ°å®Œæˆæ¨¡å‹ï¼ˆå°¤å…¶æ˜¯å¤§æ¨¡å‹ï¼‰çš„è®­ç»ƒã€‚</p>
<h2 id="_1">åŸºæœ¬å½¢å¼</h2>
<p>Tigerçš„æ›´æ–°è§„åˆ™ä¸º<br />
\begin{equation}\text{Tiger}:=\left\{\begin{aligned}<br />
&amp;\boldsymbol{m}<em t-1="t-1">t = \beta \boldsymbol{m}</em>} + \left(1 - \beta\right) \boldsymbol{g<em t-1="t-1">t \\\<br />
&amp;\boldsymbol{\theta}_t = \boldsymbol{\theta}</em>} - \eta_t \left[\text{sign}(\boldsymbol{m<em t-1="t-1">t) \color{skyblue}{ + \lambda_t \boldsymbol{\theta}</em>\right] \\\}<br />
\end{aligned}\right.\end{equation}<br />
ç›¸æ¯”Lionï¼Œå®ƒå°±æ˜¯é€‰æ‹©äº†å‚æ•°$\beta_1 = \beta_2 = \beta$ï¼›ç›¸æ¯”<a href="https://papers.cool/arxiv/1802.04434">SignSGD</a>ï¼Œå®ƒåˆ™æ˜¯æ–°å¢äº†åŠ¨é‡å’Œæƒé‡è¡°å‡ã€‚</p>
<p>å‚è€ƒå®ç°ï¼š</p>
<blockquote>
<p><strong>Tigerï¼š<a href="https://github.com/bojone/tiger">https://github.com/bojone/tiger</a></strong></p>
</blockquote>
<p>ä¸‹è¡¨å¯¹æ¯”äº†Tigerã€Lionå’ŒAdamWçš„æ›´æ–°è§„åˆ™ï¼š<br />
\begin{array}{c|c|c}<br />
\hline<br />
\text{Tiger} &amp; \text{Lion} &amp; \text{AdamW} \\\<br />
\hline<br />
{\begin{aligned}<br />
&amp;\boldsymbol{m}<em t-1="t-1">t = \beta \boldsymbol{m}</em>} + \left(1 - \beta\right) \boldsymbol{g<em t-1="t-1">t \\\<br />
&amp;\boldsymbol{\theta}_t = \boldsymbol{\theta}</em>} - \eta_t \left[\text{sign}(\boldsymbol{m<em t-1="t-1">t) \color{skyblue}{ + \lambda_t \boldsymbol{\theta}</em>\right] \\\}<br />
\end{aligned}} &amp;<br />
{\begin{aligned}<br />
&amp;\boldsymbol{u}<em t-1="t-1">t = \text{sign}\big(\beta_1 \boldsymbol{m}</em>} + \left(1 - \beta_1\right) \boldsymbol{g<em t-1="t-1">t\big) \\\<br />
&amp;\boldsymbol{\theta}_t = \boldsymbol{\theta}</em>} - \eta_t (\boldsymbol{u<em t-1="t-1">t \color{skyblue}{ + \lambda_t \boldsymbol{\theta}</em>) \\\}<br />
&amp;\boldsymbol{m}<em t-1="t-1">t = \beta_2 \boldsymbol{m}</em>} + \left(1 - \beta_2\right) \boldsymbol{g<em t-1="t-1">t<br />
\end{aligned}} &amp;<br />
{\begin{aligned}<br />
&amp;\boldsymbol{m}_t = \beta_1 \boldsymbol{m}</em>} + \left(1 - \beta_1\right) \boldsymbol{g<em t-1="t-1">t\\\<br />
&amp;\boldsymbol{v}_t = \beta_2 \boldsymbol{v}</em>} + \left(1 - \beta_2\right) \boldsymbol{g<em t-1="t-1">t^2\\\<br />
&amp;\hat{\boldsymbol{m}}_t = \boldsymbol{m}_t\left/\left(1 - \beta_1^t\right)\right.\\\<br />
&amp;\hat{\boldsymbol{v}}_t = \boldsymbol{v}_t\left/\left(1 - \beta_2^t\right)\right.\\\<br />
&amp;\boldsymbol{u}_t =\hat{\boldsymbol{m}}_t\left/\left(\sqrt{\hat{\boldsymbol{v}}_t} + \epsilon\right)\right.\\\<br />
&amp;\boldsymbol{\theta}_t = \boldsymbol{\theta}</em>} - \eta_t (\boldsymbol{u<em t-1="t-1">t \color{skyblue}{ + \lambda_t \boldsymbol{\theta}</em>)}<br />
\end{aligned}} \\\<br />
\hline<br />
\end{array}</p>
<p>å¯è§Tigeræ˜¯ä¸‰è€…ä¹‹ä¸­çš„æç®€è€…ã€‚</p>
<h2 id="_2">è¶…å‚è®¾ç½®</h2>
<p>å°½ç®¡Tigerå·²ç»ç›¸å½“ç®€åŒ–ï¼Œä½†ä»æœ‰å‡ ä¸ªè¶…å‚æ•°è¦è®¾ç½®ï¼Œåˆ†åˆ«æ˜¯æ»‘åŠ¨å¹³å‡ç‡$\beta$ã€å­¦ä¹ ç‡$\eta_t$ä»¥åŠæƒé‡è¡°å‡ç‡$\lambda_t$ï¼Œä¸‹é¢æˆ‘ä»¬åˆ†åˆ«è®¨è®ºè¿™å‡ ä¸ªå‚æ•°çš„é€‰æ‹©ã€‚</p>
<h3 id="_3">æ»‘åŠ¨ç‡</h3>
<p>æ¯”è¾ƒç®€å•çš„æ˜¯æ»‘åŠ¨å¹³å‡çš„è¡°å‡ç‡$\beta$ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨åŸºæœ¬å½¢å¼ä¸ŠTigerç›¸å½“äºLionå–$\beta_1 = \beta_2 = \beta$çš„ç‰¹æ®Šæƒ…å½¢ï¼Œé‚£ä¹ˆä¸€ä¸ªç›´è§‰æ˜¯Tigeråº”å½“å–$\beta=\frac{1}{2}(\beta_1 + \beta_2)$ã€‚åœ¨Lionçš„åŸè®ºæ–‡ä¸­ï¼Œå¯¹äºCVä»»åŠ¡æœ‰$\beta_1=0.9,\beta_2=0.99$ï¼Œæ‰€ä»¥æˆ‘ä»¬å»ºè®®CVä»»åŠ¡å–$\beta = 0.945$ï¼›è€Œå¯¹äºNLPä»»åŠ¡åˆ™æœ‰$\beta_1=0.95,\beta_2=0.98$ï¼Œæ‰€ä»¥æˆ‘ä»¬å»ºè®®NLPä»»åŠ¡å–$\beta = 0.965$ã€‚</p>
<h3 id="_4">å­¦ä¹ ç‡</h3>
<p>å¯¹äºå­¦ä¹ ç‡ï¼ŒTigerå‚è€ƒäº†<a href="/archives/9344">Amos</a>ã€<a href="/archives/7094#%E5%B1%82%E8%87%AA%E9%80%82%E5%BA%94">LAMB</a>ç­‰å·¥ä½œï¼Œå°†å­¦ä¹ ç‡åˆ†ä¸¤ç§æƒ…å†µè®¾ç½®ã€‚ç¬¬ä¸€ç§æ˜¯çº¿æ€§å±‚çš„biasé¡¹å’ŒNormalizationçš„betaã€gammaå‚æ•°ï¼Œè¿™ç±»å‚æ•°çš„ç‰¹ç‚¹æ˜¯è¿ç®—æ˜¯element-wiseï¼Œæˆ‘ä»¬å»ºè®®å­¦ä¹ ç‡é€‰å–ä¸ºå…¨å±€ç›¸å¯¹å­¦ä¹ ç‡$\alpha_t$çš„ä¸€åŠï¼›ç¬¬äºŒç§ä¸»è¦å°±æ˜¯çº¿æ€§å±‚çš„kernelçŸ©é˜µï¼Œè¿™ç±»å‚æ•°çš„ç‰¹ç‚¹æ˜¯ä»¥çŸ©é˜µçš„èº«ä»½å»è·Ÿå‘é‡åšçŸ©é˜µä¹˜æ³•è¿ç®—ï¼Œæˆ‘ä»¬å»ºè®®å­¦ä¹ ç‡é€‰å–ä¸ºå…¨å±€ç›¸å¯¹å­¦ä¹ ç‡$\alpha_t$ä¹˜ä»¥å‚æ•°æœ¬èº«çš„$\text{RMS}$ï¼ˆRoot Mean Squareï¼‰ï¼š<br />
\begin{equation}\eta_t = \left\{\begin{aligned}<br />
&amp;\alpha_t \times 0.5, &amp;\boldsymbol{\theta} \in \{bias, beta, gamma\}\\\[5pt]<br />
&amp;\alpha_t \times \text{RMS}(\boldsymbol{\theta}<em i="1">{t-1}), &amp;\boldsymbol{\theta} \not\in \{bias, beta, gamma\}<br />
\end{aligned}\right.\end{equation}<br />
å…¶ä¸­<br />
\begin{equation}\text{RMS}(\boldsymbol{\theta})=\sqrt{\frac{1}{k}\sum</em>}^k \theta_i^2},\quad \boldsymbol{\theta}=(\theta_1,\theta_2,\cdots,\theta_k)\end{equation<br />
è¿™æ ·è®¾ç½®çš„å¥½å¤„æ˜¯æˆ‘ä»¬æŠŠå‚æ•°çš„å°ºåº¦åˆ†ç¦»äº†å‡ºæ¥ï¼Œä½¿å¾—å­¦ä¹ ç‡çš„è°ƒæ§å¯ä»¥äº¤ç»™ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„â€œå…¨å±€ç›¸å¯¹å­¦ä¹ ç‡â€$\alpha_t$â€”â€”å¤§è‡´å¯ä»¥ç†è§£ä¸ºæ¯ä¸€æ­¥çš„ç›¸å¯¹å­¦ä¹ å¹…åº¦ï¼Œæ˜¯ä¸€ä¸ªå¯¹äºæ¨¡å‹å°ºåº¦ä¸æ˜¯ç‰¹åˆ«æ•æ„Ÿçš„é‡ã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬åœ¨baseç‰ˆæ¨¡å‹ä¸Šè°ƒå¥½çš„$\alpha_t$ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ä¸æ”¹åŠ¨åœ°ç”¨åˆ°largeç‰ˆæ¨¡å‹ã€‚æ³¨æ„$\alpha_t$å¸¦æœ‰ä¸‹æ ‡$t$ï¼Œæ‰€ä»¥å®ƒåŒ…å«äº†æ•´ä¸ªå­¦ä¹ ç‡çš„scheduleï¼ŒåŒ…æ‹¬Wamrupä»¥åŠå­¦ä¹ ç‡è¡°å‡ç­–ç•¥ç­‰ï¼Œç¬”è€…çš„è®¾ç½®ç»éªŒæ˜¯$\max(\alpha_t)\in[0.001,0.002]$ï¼Œè‡³äºæ€ä¹ˆWarmupå’Œè¡°å‡ï¼Œé‚£å°±æ˜¯å¤§å®¶æ ¹æ®è‡ªå·±çš„ä»»åŠ¡è€Œè®¾äº†ï¼Œåˆ«äººæ— æ³•ä»£åŠ³ã€‚ç¬”è€…ç»™çš„tigerå®ç°ï¼Œå†…ç½®äº†ä¸€ä¸ªåˆ†æ®µçº¿æ€§å­¦ä¹ ç‡ç­–ç•¥ï¼Œç†è®ºä¸Šå¯ä»¥ç”¨å®ƒæ¨¡æ‹Ÿä»»æ„çš„$\alpha_t$ã€‚</p>
<h3 id="_5">è¡°å‡ç‡</h3>
<p>æœ€åæ˜¯æƒé‡è¡°å‡ç‡$\lambda_t$ï¼Œè¿™ä¸ªLionè®ºæ–‡æœ€åä¸€é¡µä¹Ÿç»™å‡ºäº†ä¸€äº›å‚è€ƒè®¾ç½®ï¼Œä¸€èˆ¬æ¥è¯´$\lambda_t$ä¹Ÿå°±è®¾ä¸ºå¸¸æ•°ï¼Œç¬”è€…å¸¸ç”¨çš„æ˜¯0.01ã€‚ç‰¹åˆ«çš„æ˜¯ï¼Œä¸å»ºè®®å¯¹å‰é¢è¯´çš„biasã€betaã€gammaè¿™ä¸‰ç±»å‚æ•°åšæƒé‡è¡°å‡ï¼Œæˆ–è€…å³ä¾¿è¦åšï¼Œ$\lambda_t$ä¹Ÿè¦ä½ä¸€ä¸ªæ•°é‡çº§ä»¥ä¸Šã€‚å› ä¸ºä»å…ˆéªŒåˆ†å¸ƒè§’åº¦æ¥çœ‹ï¼Œæƒé‡è¡°å‡æ˜¯å‚æ•°çš„é«˜æ–¯å…ˆéªŒï¼Œ$\lambda_t$è·Ÿå‚æ•°æ–¹å·®æ˜¯åæ¯”å…³ç³»ï¼Œè€Œbiasã€betaã€gammaçš„æ–¹å·®æ˜¾ç„¶è¦æ¯”kernelçŸ©é˜µçš„æ–¹å·®å¤§ï¼Œæ‰€ä»¥å®ƒä»¬çš„$\lambda_t$åº”è¯¥æ›´å°ã€‚<br />
\begin{equation}\lambda_t = \left\{\begin{aligned}<br />
&amp;0, &amp;\boldsymbol{\theta} \in \{bias, beta, gamma\}\\\[5pt]<br />
&amp;constant &gt; 0, &amp;\boldsymbol{\theta} \not\in \{bias, beta, gamma\}<br />
\end{aligned}\right.\end{equation}</p>
<h2 id="_6">æ¢¯åº¦ç´¯ç§¯</h2>
<p>å¯¹äºå¾ˆå¤šç®—åŠ›æœ‰é™çš„è¯»è€…æ¥è¯´ï¼Œé€šè¿‡æ¢¯åº¦ç´¯ç§¯æ¥å¢å¤§batch_sizeæ˜¯è®­ç»ƒå¤§æ¨¡å‹æ—¶ä¸å¯é¿å…çš„ä¸€æ­¥ã€‚æ ‡å‡†çš„æ¢¯åº¦ç´¯ç§¯éœ€è¦æ–°å¢ä¸€ç»„å‚æ•°ï¼Œç”¨æ¥ç¼“å­˜å†å²æ¢¯åº¦ï¼Œè¿™æ„å‘³ç€åœ¨æ¢¯åº¦ç´¯ç§¯çš„éœ€æ±‚ä¸‹ï¼ŒAdamæ–°å¢çš„å‚æ•°æ˜¯3ç»„ï¼ŒLionæ˜¯2ç»„ï¼Œè€Œå³ä¾¿æ˜¯ä¸åŠ åŠ¨é‡çš„<a href="/archives/7302">AdaFactor</a>ä¹Ÿæœ‰1.xç»„ï¼ˆä½†è¯´å®è¯AdaFactorä¸åŠ åŠ¨é‡ï¼Œæ”¶æ•›ä¼šæ…¢å¾ˆå¤šï¼Œæ‰€ä»¥è€ƒè™‘é€Ÿåº¦çš„è¯ï¼ŒåŠ ä¸€ç»„åŠ¨é‡å°±å˜ä¸º2.xç»„ï¼‰ã€‚</p>
<p>è€Œå¯¹äºTigeræ¥è¯´ï¼Œå®ƒçš„æ›´æ–°é‡åªç”¨åˆ°äº†åŠ¨é‡å’ŒåŸå‚æ•°ï¼Œæ ¹æ®<a href="/archives/8634">ã€Šéšè—åœ¨åŠ¨é‡ä¸­çš„æ¢¯åº¦ç´¯ç§¯ï¼šå°‘æ›´æ–°å‡ æ­¥ï¼Œæ•ˆæœåè€Œæ›´å¥½ï¼Ÿã€‹</a>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹æ”¹åŠ¨ï¼Œå°†æ¢¯åº¦ç´¯ç§¯å†…ç½®åœ¨Tigerä¸­ï¼š<br />
\begin{equation}\text{Tiger}:=\left\{\begin{aligned} &amp;\boldsymbol{m}<em _t-1_k="(t-1)/k">t = \big[(\beta - 1)\chi</em>} + 1\big] \boldsymbol{m<em t-1="t-1">{t-1} + \frac{1}{k}\left(1 - \beta\right) \boldsymbol{g}_t \\\ &amp;\boldsymbol{\theta}_t = \boldsymbol{\theta}</em>} - \chi_{t/k}\eta_t \left[\text{sign}(\boldsymbol{m<em t-1="t-1">t) \color{skyblue}{ + \lambda_t \boldsymbol{\theta}</em>}}\right] \\\ \end{aligned}\right.\end{equation<br />
è¿™é‡Œçš„$\chi_{t/k}$æ˜¯åˆ¤æ–­$t$èƒ½å¦è¢«$k$æ•´é™¤çš„ç¤ºæ€§å‡½æ•°<br />
\begin{equation}\chi_{t/k} = \left\{ \begin{aligned}&amp;1,\quad t \equiv 0\,(\text{mod}\, k) \\\<br />
&amp;0,\quad t \not\equiv 0\,(\text{mod}\, k)<br />
\end{aligned}\right.\end{equation}<br />
å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä»…ä»…ç›¸å½“äºä¿®æ”¹äº†æ»‘åŠ¨å¹³å‡ç‡$\beta$å’Œå­¦ä¹ ç‡$\eta_t$ï¼Œå‡ ä¹ä¸å¢åŠ æ˜¾å­˜æˆæœ¬ï¼Œæ•´ä¸ªè¿‡ç¨‹æ˜¯å®Œå…¨â€œæ— æ„Ÿâ€çš„ï¼Œè¿™æ˜¯ç¬”è€…è®¤ä¸ºçš„Tigerçš„æœ€å¤§çš„é­…åŠ›ã€‚</p>
<p>éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œå°½ç®¡Lionè·ŸTigerå¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯Lionå¹¶ä¸èƒ½åšåˆ°è¿™ä¸€ç‚¹ï¼Œå› ä¸º$\beta_1\neq\beta_2$æ—¶ï¼ŒLionçš„æ›´æ–°éœ€è¦ç”¨åˆ°åŠ¨é‡ä»¥åŠå½“å‰æ‰¹çš„æ¢¯åº¦ï¼Œè¿™ä¸¤ä¸ªé‡éœ€è¦ç”¨ä¸åŒçš„å‚æ•°ç¼“å­˜ï¼Œè€ŒTigerçš„æ›´æ–°åªç”¨åˆ°äº†åŠ¨é‡ï¼Œå› æ­¤æ»¡è¶³è¿™ä¸€ç‚¹ã€‚ç±»ä¼¼æ»´ï¼ŒSGDMä¼˜åŒ–å™¨ä¹Ÿèƒ½åšåˆ°ä¸€ç‚¹ï¼Œä½†æ˜¯å®ƒæ²¡æœ‰$\text{sign}$æ“ä½œï¼Œè¿™æ„å‘³ç€å­¦ä¹ ç‡çš„è‡ªé€‚åº”èƒ½åŠ›ä¸å¤Ÿå¥½ï¼Œåœ¨Transformerç­‰æ¨¡å‹ä¸Šçš„æ•ˆæœé€šå¸¸ä¸å¦‚æ„ï¼ˆå‚è€ƒ<a href="https://papers.cool/arxiv/1912.03194">ã€ŠWhy are Adaptive Methods Good for Attention Models?ã€‹</a>ï¼‰ã€‚</p>
<h2 id="_7">å…¨åŠç²¾åº¦</h2>
<p>å¯¹äºå¤§æ¨¡å‹æ¥è¯´ï¼Œæ··åˆç²¾åº¦è®­ç»ƒæ˜¯å¦ä¸€ä¸ªå¸¸ç”¨çš„â€œåˆ©å™¨â€ï¼ˆå‚è€ƒ<a href="/archives/9059">ã€Šåœ¨bert4kerasä¸­ä½¿ç”¨æ··åˆç²¾åº¦å’ŒXLAåŠ é€Ÿè®­ç»ƒã€‹</a>ï¼‰ã€‚æ··åˆç²¾åº¦ï¼Œç®€å•æ¥è¯´å°±æ˜¯æ¨¡å‹è®¡ç®—éƒ¨åˆ†ç”¨åŠç²¾åº¦çš„FP16ï¼Œæ¨¡å‹å‚æ•°çš„å‚¨å­˜å’Œæ›´æ–°éƒ¨åˆ†ç”¨å•ç²¾åº¦çš„FP32ã€‚ä¹‹æ‰€ä»¥æ¨¡å‹å‚æ•°è¦ç”¨FP32ï¼Œæ˜¯å› ä¸ºæ‹…å¿ƒæ›´æ–°è¿‡ç¨‹ä¸­å‚æ•°çš„æ›´æ–°é‡è¿‡å°ï¼Œä¸‹æº¢å‡ºäº†FP16çš„è¡¨ç¤ºèŒƒå›´ï¼ˆå¤§è‡´æ˜¯$6\times 10^{-8}\sim 65504$ï¼‰ï¼Œå¯¼è‡´æŸäº›å‚æ•°é•¿æœŸä¸æ›´æ–°ï¼Œæ¨¡å‹è®­ç»ƒè¿›åº¦æ…¢ç”šè‡³æ— æ³•æ­£å¸¸è®­ç»ƒã€‚</p>
<p>ç„¶è€Œï¼ŒTigerï¼ˆLionä¹Ÿä¸€æ ·ï¼‰å¯¹æ›´æ–°é‡åšäº†$\text{sign}$è¿ç®—ï¼Œè¿™ä½¿å¾—ç†è®ºä¸Šæˆ‘ä»¬å¯ä»¥å…¨ç”¨åŠç²¾åº¦è®­ç»ƒï¼åˆ†æè¿‡ç¨‹å¹¶ä¸éš¾ã€‚é¦–å…ˆï¼Œåªè¦å¯¹Lossåšé€‚å½“çš„ç¼©æ”¾ï¼Œé‚£ä¹ˆå¯ä»¥åšåˆ°æ¢¯åº¦$\boldsymbol{g}_t$ä¸ä¼šæº¢å‡ºFP16çš„è¡¨ç¤ºèŒƒå›´ï¼›è€ŒåŠ¨é‡$\boldsymbol{m}_t$åªæ˜¯æ¢¯åº¦çš„æ»‘åŠ¨å¹³å‡ï¼Œæ¢¯åº¦ä¸æº¢å‡ºï¼Œå®ƒä¹Ÿä¸ä¼šæº¢å‡ºï¼Œ$\text{sign}(\boldsymbol{m}_t)$åªèƒ½æ˜¯$\pm 1$ï¼Œæ›´åŠ ä¸ä¼šæº¢å‡ºäº†ï¼›ä¹‹åï¼Œæˆ‘ä»¬åªéœ€è¦ä¿è¯å­¦ä¹ ç‡ä¸å°äº$6\times 10^{-8}$ï¼Œé‚£ä¹ˆæ›´æ–°é‡å°±ä¸ä¼šä¸‹æº¢äº†ï¼Œäº‹å®ä¸Šæˆ‘ä»¬ä¹Ÿä¸ä¼šå°†å­¦ä¹ ç‡è°ƒå¾—è¿™ä¹ˆå°ã€‚å› æ­¤ï¼ŒTigerçš„æ•´ä¸ªæ›´æ–°è¿‡ç¨‹éƒ½æ˜¯åœ¨FP16è¡¨ç¤ºèŒƒå›´å†…çš„ï¼Œå› æ­¤ç†è®ºä¸Šæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨å…¨FP16ç²¾åº¦è®­ç»ƒè€Œä¸ç”¨æ‹…å¿ƒæº¢å‡ºé—®é¢˜ã€‚</p>
<h2 id="nan">é˜²æ­¢NaN</h2>
<p>ç„¶è€Œï¼Œç¬”è€…å‘ç°å¯¹äºåŒæ ·çš„é…ç½®ï¼Œåœ¨FP32ä¸‹è®­ç»ƒæ­£å¸¸ï¼Œä½†åˆ‡æ¢åˆ°æ··åˆç²¾åº¦æˆ–è€…åŠç²¾åº¦åæœ‰æ—¶ä¼šè®­ç»ƒå¤±è´¥ï¼Œå…·ä½“è¡¨ç°åLosså…ˆé™åå‡ç„¶åNaNï¼Œè¿™æˆ‘ä»¬ä¹‹å‰åœ¨<a href="/archives/9059">ã€Šåœ¨bert4kerasä¸­ä½¿ç”¨æ··åˆç²¾åº¦å’ŒXLAåŠ é€Ÿè®­ç»ƒã€‹</a>ä¹Ÿè®¨è®ºè¿‡ã€‚è™½ç„¶æœ‰ä¸€äº›æ’æŸ¥æ”¹è¿›çš„æ–¹å‘ï¼ˆæ¯”å¦‚è°ƒèŠ‚epsilonå’Œæ— ç©·å¤§çš„å€¼ã€ç¼©æ”¾lossç­‰ï¼‰ï¼Œä½†æœ‰æ—¶å€™æŠŠè¯¥æ’æŸ¥çš„éƒ½æ’æŸ¥äº†ï¼Œè¿˜ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µã€‚</p>
<p>ç»è¿‡è°ƒè¯•ï¼Œç¬”è€…å‘ç°å‡ºç°è¿™ç§æƒ…å†µæ—¶ï¼Œä¸»è¦æ˜¯å¯¹äºæŸäº›batchæ¢¯åº¦å˜ä¸ºNaNï¼Œä½†æ­¤æ—¶æ¨¡å‹çš„å‚æ•°å’Œå‰å‘è®¡ç®—è¿˜æ˜¯æ­£å¸¸çš„ã€‚äºæ˜¯ç¬”è€…å°±æƒ³äº†ä¸ªç®€å•çš„åº”å¯¹ç­–ç•¥ï¼šå¯¹æ¢¯åº¦å‡ºç°NaNæ—¶ï¼Œè·³è¿‡è¿™ä¸€æ­¥æ›´æ–°ï¼Œå¹¶ä¸”å¯¹å‚æ•°è¿›è¡Œè½»å¾®æ”¶ç¼©ï¼Œå¦‚ä¸‹<br />
\begin{equation}\text{Tiger}:=\left\{\begin{aligned}<br />
&amp;\boldsymbol{m}<em t-1="t-1">t = \boldsymbol{m}</em> \\\<br />
&amp;\boldsymbol{\theta}<em t-1="t-1">t = (\boldsymbol{\theta}</em> - c)\times s+ c \\\<br />
\end{aligned}\right. \quad if\,\,\boldsymbol{g}_t = \text{NaN}\end{equation}<br />
å…¶ä¸­$s\in(0, 1)$ä»£è¡¨æ”¶ç¼©ç‡ï¼Œç¬”è€…å–$s=0.99$ï¼Œ$c$åˆ™æ˜¯å‚æ•°çš„åˆå§‹åŒ–ä¸­å¿ƒï¼Œä¸€èˆ¬å°±æ˜¯gammaå–1ï¼Œå…¶ä»–å‚æ•°éƒ½æ˜¯0ã€‚ç»è¿‡è¿™æ ·å¤„ç†åï¼Œæ¨¡å‹çš„lossä¼šæœ‰è½»å¾®ä¸Šå‡ï¼Œä½†ä¸€èˆ¬èƒ½å¤Ÿæ¢å¤æ­£å¸¸è®­ç»ƒï¼Œä¸è‡³äºä»å¤´å†æ¥ã€‚ä¸ªäººçš„å®éªŒç»“æœæ˜¾ç¤ºï¼Œè¿™æ ·å¤„ç†èƒ½å¤Ÿç¼“è§£ä¸€éƒ¨åˆ†NaNçš„é—®é¢˜ã€‚</p>
<p>å½“ç„¶ï¼Œè¯¥æŠ€å·§ä¸€èˆ¬çš„ä½¿ç”¨åœºæ™¯æ˜¯åŒæ ·é…ç½®ä¸‹FP32èƒ½å¤Ÿæ­£å¸¸è®­ç»ƒï¼Œå¹¶ä¸”å·²ç»åšå¥½äº†epsilonã€æ— ç©·å¤§ç­‰æ··åˆç²¾åº¦è°ƒèŠ‚ï¼Œä¸‡èˆ¬æ— å¥ˆä¹‹ä¸‹æ‰ä¸å¾—å·²ä½¿ç”¨çš„ã€‚å¦‚æœæ¨¡å‹æœ¬èº«è¶…å‚æ•°è®¾ç½®æœ‰é—®é¢˜ï¼ˆæ¯”å¦‚å­¦ä¹ ç‡è¿‡å¤§ï¼‰ï¼Œè¿FP32éƒ½ä¼šè®­ç»ƒåˆ°NaNï¼Œé‚£ä¹ˆå°±ä¸è¦æŒ‡æœ›è¿™ä¸ªæŠ€å·§èƒ½å¤Ÿè§£å†³é—®é¢˜äº†ã€‚æ­¤å¤–ï¼Œæœ‰å…´è¶£çš„è¯»è€…ï¼Œè¿˜å¯ä»¥å°è¯•æ”¹è¿›è¿™ä¸ªæŠ€å·§ï¼Œæ¯”å¦‚æ”¶ç¼©ä¹‹åå¯ä»¥å†åŠ ä¸Šä¸€ç‚¹å™ªå£°æ¥å¢åŠ å‚æ•°çš„å¤šæ ·æ€§ï¼Œç­‰ç­‰ã€‚</p>
<h2 id="_8">å®éªŒç»“æœ</h2>
<p>ä¸è€ƒè™‘æ¢¯åº¦ç´¯ç§¯å¸¦æ¥çš„æ˜¾å­˜ä¼˜åŒ–ï¼ŒTigerå°±æ˜¯Lionçš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œå¯ä»¥é¢„ä¼°Tigerçš„æœ€ä½³æ•ˆæœè‚¯å®šæ˜¯ä¸å¦‚Lionçš„æœ€ä½³æ•ˆæœçš„ï¼Œé‚£ä¹ˆæ•ˆæœä¸‹é™çš„å¹…åº¦æ˜¯å¦åœ¨å¯æ¥å—èŒƒå›´å†…å‘¢ï¼Ÿç»¼åˆåˆ°ç›®å‰ä¸ºæ­¢å¤šæ–¹çš„å®éªŒç»“æœï¼Œç¬”è€…æš‚æ—¶å¾—å‡ºçš„ç»“è®ºæ˜¯ï¼š<br />
$$\begin{aligned}  
&\text{æ•ˆæœ}\color{red}{(\uparrow)}\text{ï¼š}\quad\text{Lion} \geq \text{Tiger} \geq \text{AdamW} \approx \text{LAMB} \\\  
&\text{æ˜¾å­˜}\color{red}{(\downarrow)}\text{ï¼š}\quad\text{Tiger} < \text{Lion} < \text{AdamW} = \text{LAMB} \\\  
\end{aligned}$$<br />
ä¹Ÿå°±æ˜¯è¯´ï¼Œè€ƒè™‘æ•ˆæœLionæœ€ä¼˜ï¼Œè€ƒè™‘æ˜¾å­˜å ç”¨Tigeræœ€ä¼˜ï¼ˆå¯ç”¨æ¢¯åº¦ç´¯ç§¯æ—¶ï¼‰ï¼Œæ•ˆæœä¸ŠTigerä¸é€Šè‰²äºAdamWï¼Œæ‰€ä»¥Tigeræ›¿ä»£AdamWæ—¶æ²¡æœ‰å¤ªå¤§é—®é¢˜çš„ã€‚</p>
<p>å…·ä½“å®éªŒç»“æœåŒ…æ‹¬å‡ éƒ¨åˆ†ã€‚ç¬¬ä¸€éƒ¨åˆ†å®éªŒæ¥è‡ªLionçš„è®ºæ–‡<a href="https://papers.cool/arxiv/2302.06675">ã€ŠSymbolic Discovery of Optimization Algorithmsã€‹</a>ï¼Œè®ºæ–‡ä¸­çš„Figure 12å¯¹æ¯”äº†Lionã€Tigerã€AdamWåœ¨ä¸åŒå°ºå¯¸çš„è¯­è¨€æ¨¡å‹ä¸Šçš„æ•ˆæœï¼š  </p>
<p><a href="/usr/uploads/2023/03/343006075.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="Lionã€Tiger(Ablation)ã€AdamWåœ¨è¯­è¨€æ¨¡å‹ä»»åŠ¡ä¸Šçš„å¯¹æ¯”" src="/usr/uploads/2023/03/343006075.png" /></a></p>
<p>Lionã€Tiger(Ablation)ã€AdamWåœ¨è¯­è¨€æ¨¡å‹ä»»åŠ¡ä¸Šçš„å¯¹æ¯”</p>
<p>è¿™é‡Œçš„Ablation0.95ã€Ablation0.98ï¼Œå°±æ˜¯Tigerçš„$\beta$åˆ†åˆ«å–0.95ã€0.98ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºsmallçº§åˆ«æ¨¡å‹ï¼Œä¸¤ä¸ªTigeræŒå¹³AdamWï¼Œè€Œåœ¨middleå’Œlargeçº§åˆ«ä¸Šï¼Œä¸¤ä¸ªTigeréƒ½è¶…è¿‡äº†AdamWã€‚ä½†æ­£å¦‚å‰é¢æ‰€è¯´ï¼Œ$\beta$å–ä¸¤è€…çš„å‡å€¼0.965ï¼Œæœ‰å¯èƒ½è¿˜ä¼šæœ‰è¿›ä¸€æ­¥çš„æå‡ã€‚</p>
<p>è‡³äºåœ¨CVä»»åŠ¡ä¸Šï¼ŒåŸè®ºæ–‡ç»™å‡ºäº†Table 7ï¼š  </p>
<p><a href="/usr/uploads/2023/03/2068756049.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="Lionã€Tiger(Ablation)ã€AdamWåœ¨å›¾åƒåˆ†ç±»ä»»åŠ¡ä¸Šçš„å¯¹æ¯”" src="/usr/uploads/2023/03/2068756049.png" /></a></p>
<p>Lionã€Tiger(Ablation)ã€AdamWåœ¨å›¾åƒåˆ†ç±»ä»»åŠ¡ä¸Šçš„å¯¹æ¯”</p>
<p>åŒæ ·åœ°ï¼Œè¿™é‡Œçš„Ablation0.9ã€Ablation0.99ï¼Œå°±æ˜¯Tigerçš„$\beta$åˆ†åˆ«å–0.9ã€0.99ã€‚åœ¨è¿™ä¸ªè¡¨ä¸­ï¼ŒTigerè·ŸAdamWæœ‰æ˜æ˜¾å·®è·ã€‚ä½†æ˜¯è€ƒè™‘åˆ°ä½œè€…åªå®éªŒäº†0.9ã€0.99ä¸¤ä¸ª$\beta$ï¼Œè€Œç¬”è€…æ¨èçš„æ˜¯$\beta=0.945$ï¼Œæ‰€ä»¥ç¬”è€…è·ŸåŸä½œè€…å–å¾—äº†è”ç³»ï¼Œè¯·ä»–ä»¬åšäº†è¡¥å……å®éªŒï¼Œä»–ä»¬å›å¤çš„ç»“æœæ˜¯â€œ$\beta$åˆ†åˆ«å–0.92ã€0.95ã€0.98æ—¶ï¼Œåœ¨ViT-B/16ä¸ŠImageNetçš„ç»“æœéƒ½æ˜¯80.0%å·¦å³â€ï¼Œé‚£ä¹ˆå¯¹æ¯”ä¸Šå›¾ï¼Œå°±å¯ä»¥ç¡®å®šåœ¨ç²¾è°ƒ$\beta$æ—¶ï¼Œåœ¨CVä»»åŠ¡ä¸ŠTigeråº”è¯¥ä¹Ÿå¯ä»¥è¿½å¹³AdamWçš„ã€‚</p>
<p>æœ€åæ˜¯ç¬”è€…è‡ªå·±çš„å®éªŒã€‚ç¬”è€…å¸¸ç”¨çš„æ˜¯LAMBä¼˜åŒ–å™¨ï¼Œå®ƒçš„æ•ˆæœåŸºæœ¬è·ŸAdamWæŒå¹³ï¼Œä½†ç›¸å¯¹æ›´ç¨³å®šï¼Œè€Œä¸”å¯¹ä¸åŒçš„åˆå§‹åŒ–é€‚åº”æ€§æ›´å¥½ï¼Œå› æ­¤ç¬”è€…æ›´ä¹æ„ä½¿ç”¨LAMBã€‚ç‰¹åˆ«åœ°ï¼ŒLAMBçš„å­¦ä¹ ç‡è®¾ç½®å¯ä»¥å®Œå…¨ä¸æ”¹åŠ¨åœ°æ¬åˆ°Tigerä¸­ã€‚ç¬”è€…ç”¨Tigeré‡æ–°è®­ç»ƒäº†ä¹‹å‰çš„baseç‰ˆ<a href="/archives/9052">GAU-Î±</a>æ¨¡å‹ï¼Œè®­ç»ƒæ›²çº¿è·Ÿä¹‹å‰çš„å¯¹æ¯”å¦‚ä¸‹ï¼š  </p>
<p><a href="/usr/uploads/2023/03/3542283429.svg" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="ç¬”è€…åœ¨GAU-Î±ä¸Šçš„å¯¹æ¯”å®éªŒï¼ˆlossæ›²çº¿ï¼‰" src="/usr/uploads/2023/03/3542283429.svg" /></a></p>
<p>ç¬”è€…åœ¨GAU-Î±ä¸Šçš„å¯¹æ¯”å®éªŒï¼ˆlossæ›²çº¿ï¼‰</p>
<p><a href="/usr/uploads/2023/03/433142256.svg" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="ç¬”è€…åœ¨GAU-Î±ä¸Šçš„å¯¹æ¯”å®éªŒï¼ˆaccuracyæ›²çº¿ï¼‰" src="/usr/uploads/2023/03/433142256.svg" /></a></p>
<p>ç¬”è€…åœ¨GAU-Î±ä¸Šçš„å¯¹æ¯”å®éªŒï¼ˆaccuracyæ›²çº¿ï¼‰</p>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒTigerç¡®å®å¯ä»¥å–å¾—æ¯”LAMBæ›´ä¼˜å¼‚çš„è¡¨ç°ã€‚</p>
<h2 id="_9">æœªæ¥å·¥ä½œ</h2>
<p>Tigerè¿˜æœ‰æ”¹è¿›ç©ºé—´å—ï¼Ÿè‚¯å®šæœ‰ï¼Œæƒ³æ³•å…¶å®æœ‰å¾ˆå¤šï¼Œä½†éƒ½æ²¡æ¥å¾—åŠä¸€ä¸€éªŒè¯ï¼Œå¤§å®¶æœ‰å…´è¶£çš„å¯ä»¥å¸®å¿™ç»§ç»­åšä¸‹å»ã€‚</p>
<p>åœ¨<a href="/archives/9473">ã€ŠGoogleæ–°æœå‡ºçš„ä¼˜åŒ–å™¨Lionï¼šæ•ˆç‡ä¸æ•ˆæœå…¼å¾—çš„â€œè®­ç»ƒç‹®â€ã€‹</a>ä¸­ï¼Œç¬”è€…å¯¹$\text{sign}$è¿ç®—çš„è¯„ä»·æ˜¯</p>
<blockquote>
<p>Lioné€šè¿‡$\text{sign}$æ“ä½œå¹³ç­‰åœ°å¯¹å¾…äº†æ¯ä¸€ä¸ªåˆ†é‡ï¼Œä½¿å¾—æ¨¡å‹å……åˆ†åœ°å‘æŒ¥äº†æ¯ä¸€ä¸ªåˆ†é‡çš„ä½œç”¨ï¼Œä»è€Œæœ‰æ›´å¥½çš„æ³›åŒ–æ€§èƒ½ã€‚å¦‚æœæ˜¯SGDï¼Œé‚£ä¹ˆæ›´æ–°çš„å¤§å°æ­£æ¯”äºå®ƒçš„æ¢¯åº¦ï¼Œç„¶è€Œæœ‰äº›åˆ†é‡æ¢¯åº¦å°ï¼Œå¯èƒ½ä»…ä»…æ˜¯å› ä¸ºå®ƒæ²¡åˆå§‹åŒ–å¥½ï¼Œè€Œå¹¶éå®ƒä¸é‡è¦ï¼Œæ‰€ä»¥Lionçš„$\text{sign}$æ“ä½œç®—æ˜¯ä¸ºæ¯ä¸ªå‚æ•°éƒ½æä¾›äº†â€œæ¢å¤æ´»åŠ›â€ç”šè‡³â€œå†åˆ›è¾‰ç…Œâ€çš„æœºä¼šã€‚</p>
</blockquote>
<p>ç„¶è€Œï¼Œç»†æ€ä¹‹ä¸‹å°±ä¼šå‘ç°ï¼Œè¿™é‡Œå…¶å®æœ‰ä¸€ä¸ªæ”¹è¿›ç©ºé—´ã€‚â€œå¹³ç­‰åœ°å¯¹å¾…äº†æ¯ä¸€ä¸ªåˆ†é‡â€åœ¨è®­ç»ƒçš„å¼€å§‹é˜¶æ®µæ˜¯å¾ˆåˆç†çš„ï¼Œå®ƒä¿ç•™äº†æ¨¡å‹å°½å¯èƒ½å¤šçš„å¯èƒ½ã€‚ç„¶è€Œï¼Œå¦‚æœä¸€ä¸ªå‚æ•°é•¿æ—¶é—´çš„æ¢¯åº¦éƒ½å¾ˆå°ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½è¿™ä¸ªå‚æ•°çœŸçš„æ˜¯â€œçƒ‚æ³¥æ‰¶ä¸ä¸Šå¢™â€ï¼Œå³å·²ç»ä¼˜åŒ–åˆ°å°½å¤´äº†ï¼Œè¿™æ—¶å€™å¦‚æœè¿˜æ˜¯â€œå¹³ç­‰åœ°å¯¹å¾…äº†æ¯ä¸€ä¸ªåˆ†é‡â€ï¼Œé‚£ä¹ˆå°±å¯¹é‚£äº›æ¢¯åº¦ä¾ç„¶è¾ƒå¤§çš„â€œä¸Šè¿›ç”Ÿâ€åˆ†é‡ä¸å…¬å¹³äº†ï¼Œè€Œä¸”å¾ˆå¯èƒ½å¯¼è‡´æ¨¡å‹éœ‡è¡ã€‚</p>
<p>ä¸€ä¸ªç¬¦åˆç›´è§‰çš„æƒ³æ³•æ˜¯ï¼Œä¼˜åŒ–å™¨åº”è¯¥éšç€è®­ç»ƒçš„æ¨è¿›ï¼Œæ…¢æ…¢ä»Tigeré€€åŒ–ä¸ºSGDã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘å°†æ›´æ–°é‡è®¾ç½®ä¸º<br />
\begin{equation}\boldsymbol{u}_t = \text{sign}(\boldsymbol{m}_t) \times |\boldsymbol{m}_t|^{1-\gamma_t}\end{equation}<br />
è¿™é‡Œçš„ç»å¯¹å€¼å’Œå¹‚è¿ç®—éƒ½æ˜¯element-wiseçš„ï¼Œ$\gamma_t$æ˜¯ä»1åˆ°0çš„å•è°ƒé€’å‡å‡½æ•°ï¼Œå½“$\gamma_t=1$æ—¶å¯¹åº”Tigerï¼Œå½“$\gamma_t = 0$æ—¶å¯¹åº”SGDMã€‚</p>
<p>å¯èƒ½è¯»è€…ä¼šåæ§½è¿™é‡Œå¤šäº†$\gamma_t$è¿™ä¸ªscheduleè¦è°ƒæ•´ï¼Œé—®é¢˜å˜å¾—å¤æ‚å¾ˆå¤šã€‚ç¡®å®å¦‚æ­¤ï¼Œå¦‚æœå°†å®ƒç‹¬ç«‹åœ°è¿›è¡Œè°ƒå‚ï¼Œé‚£ä¹ˆç¡®å®ä¼šå¼•å…¥è¿‡å¤šçš„å¤æ‚åº¦äº†ã€‚ä½†æˆ‘ä»¬ä¸å¦¨å†ä»”ç»†å›å¿†ä¸€ä¸‹ï¼ŒæŠ›å¼€Warmupé˜¶æ®µä¸ç®—ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ç›¸å¯¹å­¦ä¹ ç‡$\alpha_t$ä¸æ­£æ˜¯ä¸€ä¸ªå•è°ƒé€’å‡è‡³é›¶çš„å‡½æ•°ï¼Ÿæˆ‘ä»¬æ˜¯å¦å¯ä»¥å€ŸåŠ©$\alpha_t$æ¥è®¾è®¡$\gamma_t$å‘¢ï¼Ÿæ¯”å¦‚$\alpha_t/\alpha_0$ä¸æ­£å¥½æ˜¯ä¸€ä¸ªä»1åˆ°0çš„å•è°ƒé€’å‡å‡½æ•°ï¼Ÿèƒ½å¦ç”¨å®ƒæ¥ä½œä¸º$\gamma_t$ï¼Ÿå½“ç„¶ä¹Ÿæœ‰å¯èƒ½æ˜¯$(\alpha_t/\alpha_0)^2$ã€$\sqrt{\alpha_t/\alpha_0}$æ›´å¥½ï¼Œè°ƒå‚ç©ºé—´è¿˜æ˜¯æœ‰çš„ï¼Œä½†è‡³å°‘æˆ‘ä»¬ä¸ç”¨é‡æ–°è®¾è®¡æ¨ªè·¨æ•´ä¸ªè®­ç»ƒè¿›ç¨‹çš„scheduleäº†ã€‚</p>
<p>æ›´å‘æ•£ä¸€äº›ï¼Œæ—¢ç„¶æœ‰æ—¶å€™å­¦ä¹ ç‡æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨éå•è°ƒçš„scheduleï¼ˆæ¯”å¦‚å¸¦restartçš„cosine annealingï¼‰ï¼Œé‚£ä¹ˆ$\gamma_t$æˆ‘ä»¬æ˜¯å¦ä¹Ÿå¯ä»¥ç”¨éå•è°ƒçš„ï¼ˆç›¸å½“äºTigerã€SGDMåå¤åˆ‡æ¢ï¼‰ï¼Ÿè¿™äº›æƒ³æ³•éƒ½æœ‰å¾…éªŒè¯ã€‚</p>
<h2 id="_10">æ–‡ç« å°ç»“</h2>
<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªæ–°çš„ä¼˜åŒ–å™¨ï¼Œåä¸ºTigerï¼ˆ<strong>Tig</strong> ht-fisted Optimiz<strong>er</strong> ï¼ŒæŠ é—¨çš„ä¼˜åŒ–å™¨ï¼‰ï¼Œå®ƒåœ¨Lionçš„åŸºç¡€ä¸Šåšäº†ä¸€äº›ç®€åŒ–ï¼Œå¹¶åŠ å…¥äº†æˆ‘ä»¬çš„ä¸€äº›è¶…å‚æ•°ç»éªŒã€‚ç‰¹åˆ«åœ°ï¼Œåœ¨éœ€è¦æ¢¯åº¦ç´¯ç§¯çš„åœºæ™¯ä¸‹ï¼ŒTigerå¯ä»¥è¾¾åˆ°æ˜¾å­˜å ç”¨çš„ç†è®ºæœ€ä¼˜ï¼ˆæŠ ï¼‰è§£ï¼</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/9512">https://spaces.ac.cn/archives/9512</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Mar. 07, 2023). ã€ŠTigerï¼šä¸€ä¸ªâ€œæŠ â€åˆ°æè‡´çš„ä¼˜åŒ–å™¨ ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/9512">https://spaces.ac.cn/archives/9512</a></p>
<p>@online{kexuefm-9512,<br />
title={Tigerï¼šä¸€ä¸ªâ€œæŠ â€åˆ°æè‡´çš„ä¼˜åŒ–å™¨},<br />
author={è‹å‰‘æ—},<br />
year={2023},<br />
month={Mar},<br />
url={\url{https://spaces.ac.cn/archives/9512}},<br />
} </p>
<hr />
<h2 id="_11">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<h3 id="1-tiger">1. Tigerä¼˜åŒ–å™¨çš„å®Œæ•´æ•°å­¦æ¨å¯¼</h3>
<h4 id="11">1.1 åŸºç¡€æ›´æ–°è§„åˆ™æ¨å¯¼</h4>
<p>Tigerä¼˜åŒ–å™¨çš„æ ¸å¿ƒæ›´æ–°è§„åˆ™å¯ä»¥è¡¨è¿°ä¸ºï¼š</p>
<p>\begin{equation}
\boldsymbol{m}<em t-1="t-1">t = \beta \boldsymbol{m}</em>
\end{equation}} + (1 - \beta) \boldsymbol{g}_t \tag{1</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªæŒ‡æ•°ç§»åŠ¨å¹³å‡(EMA)ï¼Œå®ƒå¯¹å†å²æ¢¯åº¦è¿›è¡Œå¹³æ»‘å¤„ç†ã€‚å‚æ•°$\beta$æ§åˆ¶äº†å†å²ä¿¡æ¯çš„ä¿ç•™ç¨‹åº¦ã€‚</p>
<p>\begin{equation}
\boldsymbol{\theta}<em t-1="t-1">t = \boldsymbol{\theta}</em>} - \eta_t \left[\text{sign}(\boldsymbol{m<em t-1="t-1">t) + \lambda_t \boldsymbol{\theta}</em>
\end{equation}}\right] \tag{2</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>ï¼šå‚æ•°æ›´æ–°ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š(1) åŸºäºåŠ¨é‡ç¬¦å·çš„ä¸»æ›´æ–°é¡¹ï¼Œ(2) æƒé‡è¡°å‡é¡¹ã€‚$\text{sign}$å‡½æ•°ç¡®ä¿æ¯ä¸ªå‚æ•°åˆ†é‡è·å¾—ç­‰å¹…åº¦çš„æ›´æ–°ã€‚</p>
<h4 id="12">1.2 åŠ¨é‡å±•å¼€ä¸ç†è§£</h4>
<p>å°†å¼(1)å±•å¼€ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°åŠ¨é‡çš„å®Œæ•´è¡¨è¾¾ï¼š</p>
<p>\begin{equation}
\boldsymbol{m}<em i="0">t = (1-\beta)\sum</em>
\end{equation}}^{t-1} \beta^i \boldsymbol{g}_{t-i} \tag{3</p>
<p><strong>è¯æ˜</strong>ï¼šé€šè¿‡é€’å½’å±•å¼€
\begin{align}
\boldsymbol{m}<em t-1="t-1">t &amp;= \beta \boldsymbol{m}</em>} + (1-\beta)\boldsymbol{g<em t-2="t-2">t \tag{4} \
&amp;= \beta[\beta \boldsymbol{m}</em>} + (1-\beta)\boldsymbol{g<em t-2="t-2">{t-1}] + (1-\beta)\boldsymbol{g}_t \tag{5} \
&amp;= \beta^2 \boldsymbol{m}</em>} + (1-\beta)\beta\boldsymbol{g<em i="0">{t-1} + (1-\beta)\boldsymbol{g}_t \tag{6} \
&amp;= (1-\beta)\sum</em>
\end{align}}^{t-1} \beta^i \boldsymbol{g}_{t-i} + \beta^t \boldsymbol{m}_0 \tag{7</p>
<p>å‡è®¾$\boldsymbol{m}_0 = \boldsymbol{0}$ï¼Œæˆ‘ä»¬å¾—åˆ°å¼(3)ã€‚</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>ï¼šåŠ¨é‡æ˜¯æ¢¯åº¦çš„åŠ æƒå¹³å‡ï¼Œæƒé‡å‘ˆæŒ‡æ•°è¡°å‡ã€‚è¿™æ„å‘³ç€æœ€è¿‘çš„æ¢¯åº¦æƒé‡æœ€å¤§ï¼Œè€Œè¿œæœŸæ¢¯åº¦çš„å½±å“å‘ˆæŒ‡æ•°è¡°å‡ã€‚</p>
<h4 id="13">1.3 æœ‰æ•ˆæ—¶é—´çª—å£åˆ†æ</h4>
<p>åŠ¨é‡çš„æœ‰æ•ˆæ—¶é—´çª—å£å¯ä»¥é€šè¿‡è®¡ç®—æƒé‡æ€»å’Œæ¥ä¼°è®¡ï¼š</p>
<p>\begin{equation}
\sum_{i=0}^{\infty} \beta^i = \frac{1}{1-\beta} \tag{8}
\end{equation}</p>
<p>å¯¹äº$\beta = 0.945$ï¼ˆCVä»»åŠ¡æ¨èå€¼ï¼‰ï¼š
\begin{equation}
\frac{1}{1-0.945} = \frac{1}{0.055} \approx 18.2 \text{ steps} \tag{9}
\end{equation}</p>
<p>å¯¹äº$\beta = 0.965$ï¼ˆNLPä»»åŠ¡æ¨èå€¼ï¼‰ï¼š
\begin{equation}
\frac{1}{1-0.965} = \frac{1}{0.035} \approx 28.6 \text{ steps} \tag{10}
\end{equation}</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>ï¼šæœ‰æ•ˆçª—å£è¡¨ç¤ºåŠ¨é‡"è®°å¿†"çš„å¹³å‡æ­¥æ•°ã€‚NLPä»»åŠ¡ä½¿ç”¨æ›´å¤§çš„$\beta$ï¼Œæ„å‘³ç€æ›´é•¿çš„è®°å¿†çª—å£ï¼Œè¿™å¯¹å¤„ç†åºåˆ—ä¾èµ–æ€§æœ‰å¸®åŠ©ã€‚</p>
<h4 id="14-sign">1.4 Signæ“ä½œçš„æ•°å­¦æ€§è´¨</h4>
<p>Signå‡½æ•°å®šä¹‰ä¸ºï¼š
\begin{equation}
\text{sign}(x) = \begin{cases}
+1, &amp; x &gt; 0 \
0, &amp; x = 0 \
-1, &amp; x &lt; 0
\end{cases} \tag{11}
\end{equation}</p>
<p>å¯¹äºå‘é‡ï¼Œé€å…ƒç´ åº”ç”¨ï¼š
\begin{equation}
\text{sign}(\boldsymbol{v}) = [\text{sign}(v_1), \text{sign}(v_2), \ldots, \text{sign}(v_n)]^T \tag{12}
\end{equation}</p>
<p><strong>å…³é”®æ€§è´¨1 - å¹…åº¦å½’ä¸€åŒ–</strong>ï¼š
\begin{equation}
|\text{sign}(\boldsymbol{v})|_{\infty} = 1 \tag{13}
\end{equation}</p>
<p>\begin{equation}
|\text{sign}(\boldsymbol{v})|_2 = \sqrt{\text{nnz}(\boldsymbol{v})} \tag{14}
\end{equation}</p>
<p>å…¶ä¸­$\text{nnz}(\boldsymbol{v})$è¡¨ç¤ºéé›¶å…ƒç´ ä¸ªæ•°ã€‚</p>
<p><strong>å…³é”®æ€§è´¨2 - æ–¹å‘ä¿æŒ</strong>ï¼š
\begin{equation}
\text{sign}(\boldsymbol{v}) \cdot \boldsymbol{v} = |\boldsymbol{v}|_1 \geq 0 \tag{15}
\end{equation}</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>ï¼šSignæ“ä½œå°†æ›´æ–°é‡æŠ•å½±åˆ°å•ä½è¶…ç«‹æ–¹ä½“çš„é¡¶ç‚¹ä¸Šï¼Œç¡®ä¿æ¯ä¸ªå‚æ•°è·å¾—ç›¸åŒå¹…åº¦çš„æ›´æ–°ï¼Œä»è€Œé¿å…æŸäº›å‚æ•°å› åˆå§‹åŒ–ä¸ä½³è€Œè¢«"é—å¿˜"ã€‚</p>
<h4 id="15">1.5 æƒé‡è¡°å‡çš„ç†è®ºåˆ†æ</h4>
<p>æƒé‡è¡°å‡é¡¹å¯ä»¥ç†è§£ä¸ºL2æ­£åˆ™åŒ–çš„æ¢¯åº¦ä¸‹é™å®ç°ã€‚è€ƒè™‘ç›®æ ‡å‡½æ•°ï¼š</p>
<p>\begin{equation}
\mathcal{L}<em task="task">{total}(\boldsymbol{\theta}) = \mathcal{L}</em>
\end{equation}}(\boldsymbol{\theta}) + \frac{\lambda}{2}|\boldsymbol{\theta}|^2 \tag{16</p>
<p>å…¶æ¢¯åº¦ä¸ºï¼š
\begin{equation}
\nabla_{\boldsymbol{\theta}} \mathcal{L}<em _boldsymbol_theta="\boldsymbol{\theta">{total} = \nabla</em>
\end{equation}}} \mathcal{L}_{task} + \lambda \boldsymbol{\theta} \tag{17</p>
<p>åœ¨AdamWä¸­ï¼Œæƒé‡è¡°å‡è¢«è§£è€¦ï¼š
\begin{equation}
\boldsymbol{\theta}<em t-1="t-1">t = \boldsymbol{\theta}</em>} - \eta_t \boldsymbol{u<em t-1="t-1">t - \eta_t \lambda_t \boldsymbol{\theta}</em>
\end{equation}} \tag{18</p>
<p>Tigeré‡‡ç”¨ç›¸åŒç­–ç•¥ï¼š
\begin{equation}
\boldsymbol{\theta}<em t-1="t-1">t = \boldsymbol{\theta}</em>} - \eta_t[\text{sign}(\boldsymbol{m<em t-1="t-1">t) + \lambda_t \boldsymbol{\theta}</em>
\end{equation}}] \tag{19</p>
<p><strong>æ”¶æ•›æ€§å½±å“</strong>ï¼šæƒé‡è¡°å‡é¡¹å¼•å…¥äº†å‘åŸç‚¹çš„æ”¶ç¼©åŠ›ï¼Œå‚æ•°æ›´æ–°æ–¹ç¨‹å˜ä¸ºï¼š</p>
<p>\begin{equation}
\boldsymbol{\theta}<em t-1="t-1">t = (1 - \eta_t\lambda_t)\boldsymbol{\theta}</em>
\end{equation}} - \eta_t\text{sign}(\boldsymbol{m}_t) \tag{20</p>
<p>ç´¯ç§¯æ•ˆæœï¼š
\begin{equation}
\boldsymbol{\theta}<em i="1">t = \prod</em>}^{t}(1-\eta_i\lambda_i)\boldsymbol{\theta<em i="1">0 - \sum</em>}^{t}\left[\eta_i\text{sign}(\boldsymbol{m<em j="i+1">i)\prod</em>
\end{equation}}^{t}(1-\eta_j\lambda_j)\right] \tag{21</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>ï¼šæƒé‡è¡°å‡ç¡®ä¿å‚æ•°ä¸ä¼šæ— é™å¢é•¿ï¼ŒåŒæ—¶æä¾›äº†æ­£åˆ™åŒ–æ•ˆæœã€‚</p>
<h4 id="16">1.6 è‡ªé€‚åº”å­¦ä¹ ç‡çš„æ¨å¯¼</h4>
<p>Tigeré‡‡ç”¨å‚æ•°å°ºåº¦è‡ªé€‚åº”çš„å­¦ä¹ ç‡ï¼š</p>
<p>\begin{equation}
\eta_t = \begin{cases}
\alpha_t \times 0.5, &amp; \boldsymbol{\theta} \in {\text{bias, beta, gamma}} \
\alpha_t \times \text{RMS}(\boldsymbol{\theta}_{t-1}), &amp; \text{otherwise}
\end{cases} \tag{22}
\end{equation}</p>
<p>å…¶ä¸­RMSå®šä¹‰ä¸ºï¼š
\begin{equation}
\text{RMS}(\boldsymbol{\theta}) = \sqrt{\frac{1}{k}\sum_{i=1}^k \theta_i^2} = \frac{|\boldsymbol{\theta}|_2}{\sqrt{k}} \tag{23}
\end{equation}</p>
<p><strong>ç†è®ºä¾æ®</strong>ï¼šè€ƒè™‘å‚æ•°åˆå§‹åŒ–$\boldsymbol{\theta} \sim \mathcal{N}(0, \sigma^2 I)$ï¼Œåˆ™ï¼š</p>
<p>\begin{equation}
\mathbb{E}[|\boldsymbol{\theta}|^2] = k\sigma^2 \tag{24}
\end{equation}</p>
<p>\begin{equation}
\mathbb{E}[\text{RMS}(\boldsymbol{\theta})] = \mathbb{E}\left[\sqrt{\frac{|\boldsymbol{\theta}|^2}{k}}\right] \approx \sigma \tag{25}
\end{equation}</p>
<p>å› æ­¤ï¼Œå­¦ä¹ ç‡è‡ªåŠ¨é€‚åº”å‚æ•°çš„åˆå§‹åŒ–å°ºåº¦ï¼š
\begin{equation}
\eta_t \propto \sigma \tag{26}
\end{equation}</p>
<p><strong>æ•°å€¼ç¤ºä¾‹</strong>ï¼š
- å¯¹äº$n \times n$çŸ©é˜µï¼ŒXavieråˆå§‹åŒ–$\sigma = \frac{1}{\sqrt{n}}$
- å¦‚æœ$n=768$ï¼ˆBERT-baseçš„éšè—ç»´åº¦ï¼‰
- åˆ™$\sigma \approx 0.036$ï¼Œ$\text{RMS}(\boldsymbol{\theta}) \approx 0.036$
- è‹¥$\alpha_t = 0.001$ï¼Œåˆ™$\eta_t \approx 3.6 \times 10^{-5}$</p>
<h4 id="17">1.7 æ¢¯åº¦ç´¯ç§¯çš„æ•°å­¦æ¨å¯¼</h4>
<p>æ ‡å‡†æ¢¯åº¦ç´¯ç§¯éœ€è¦é¢å¤–å­˜å‚¨ï¼š
\begin{equation}
\boldsymbol{g}<em j="1">{acc} = \frac{1}{k}\sum</em>
\end{equation}}^{k}\boldsymbol{g}_{t,j} \tag{27</p>
<p>Tigerçš„æ— æŸæ¢¯åº¦ç´¯ç§¯ä¿®æ”¹åŠ¨é‡æ›´æ–°ä¸ºï¼š
\begin{equation}
\boldsymbol{m}<em _t-1_k="(t-1)/k">t = [(\beta-1)\chi</em>
\end{equation}} + 1]\boldsymbol{m}_{t-1} + \frac{1}{k}(1-\beta)\boldsymbol{g}_t \tag{28</p>
<p>å…¶ä¸­ç¤ºæ€§å‡½æ•°ï¼š
\begin{equation}
\chi_{t/k} = \begin{cases}
1, &amp; t \equiv 0 \pmod{k} \
0, &amp; t \not\equiv 0 \pmod{k}
\end{cases} \tag{29}
\end{equation}</p>
<p><strong>ç­‰ä»·æ€§è¯æ˜</strong>ï¼šåœ¨ç´¯ç§¯çª—å£$[tk, (t+1)k)$å†…ï¼š</p>
<p>æ­¥éª¤1 ($i = tk+1$)ï¼š
\begin{equation}
\boldsymbol{m}<em tk="tk">{tk+1} = \boldsymbol{m}</em>
\end{equation}} + \frac{1}{k}(1-\beta)\boldsymbol{g}_{tk+1} \tag{30</p>
<p>æ­¥éª¤2 ($i = tk+2$)ï¼š
\begin{equation}
\boldsymbol{m}<em tk_1="tk+1">{tk+2} = \boldsymbol{m}</em>
\end{equation}} + \frac{1}{k}(1-\beta)\boldsymbol{g}_{tk+2} \tag{31</p>
<p>ç´¯ç§¯åˆ°æ­¥éª¤$k$ï¼š
\begin{equation}
\boldsymbol{m}<em tk="tk">{(t+1)k} = \boldsymbol{m}</em>
\end{equation}} + \frac{1}{k}(1-\beta)\sum_{j=1}^{k}\boldsymbol{g}_{tk+j} \tag{32</p>
<p>ç„¶ååœ¨æ­¥éª¤$(t+1)k$åº”ç”¨è¡°å‡ï¼š
\begin{equation}
\boldsymbol{m}'<em _t_1_k="(t+1)k">{(t+1)k} = \beta\boldsymbol{m}</em>} = \beta\boldsymbol{m<em j="1">{tk} + \frac{1}{k}(1-\beta)\beta\sum</em>
\end{equation}}^{k}\boldsymbol{g}_{tk+j} \tag{33</p>
<p><strong>æ˜¾å­˜èŠ‚çœ</strong>ï¼š
- æ ‡å‡†ç´¯ç§¯ï¼šéœ€è¦$k$ä¸ªæ¢¯åº¦ç¼“å­˜ â†’ $O(k \times |\boldsymbol{\theta}|)$
- Tigerç´¯ç§¯ï¼šåªéœ€ä¿®æ”¹ç³»æ•° â†’ $O(1)$
- æ˜¾å­˜èŠ‚çœæ¯”ï¼š$\frac{k \times |\boldsymbol{\theta}|}{|\boldsymbol{\theta}|} = k$å€</p>
<h4 id="18">1.8 æ··åˆç²¾åº¦è®­ç»ƒçš„æ•°å€¼ç¨³å®šæ€§åˆ†æ</h4>
<p>FP16æ•°å€¼èŒƒå›´ï¼š$[6 \times 10^{-8}, 65504]$</p>
<p><strong>ä¸‹æº¢é£é™©åˆ†æ</strong>ï¼š</p>
<p>æ ‡å‡†ä¼˜åŒ–å™¨æ›´æ–°ï¼š
\begin{equation}
\Delta\boldsymbol{\theta}_t = \eta_t \boldsymbol{u}_t \tag{34}
\end{equation}</p>
<p>å¦‚æœ$\eta_t &lt; 6 \times 10^{-8}$æˆ–$\boldsymbol{u}_t$å¾ˆå°ï¼Œåˆ™å¯èƒ½ä¸‹æº¢ã€‚</p>
<p><strong>Tigerçš„ä¼˜åŠ¿</strong>ï¼š
\begin{equation}
\Delta\boldsymbol{\theta}<em t-1="t-1">t = \eta_t[\text{sign}(\boldsymbol{m}_t) + \lambda_t\boldsymbol{\theta}</em>
\end{equation}}] \tag{35</p>
<p>å› ä¸º$\text{sign}(\boldsymbol{m}_t) \in {-1, 0, 1}$ï¼Œåªè¦ï¼š
\begin{equation}
\eta_t \geq 6 \times 10^{-8} \tag{36}
\end{equation}</p>
<p>å°±ä¸ä¼šä¸‹æº¢ï¼Œè€Œå®é™…å­¦ä¹ ç‡é€šå¸¸$\eta_t &gt; 10^{-5}$ã€‚</p>
<p><strong>ä¸Šæº¢é£é™©åˆ†æ</strong>ï¼š</p>
<p>æ¢¯åº¦$\boldsymbol{g}<em scaled="scaled">t$é€šè¿‡Loss Scalingæ§åˆ¶ï¼š
\begin{equation}
\boldsymbol{g}</em>
\end{equation}} = s \cdot \nabla\mathcal{L} \tag{37</p>
<p>åŠ¨é‡ä¸Šç•Œï¼š
\begin{equation}
|\boldsymbol{m}<em i="0">t| \leq (1-\beta)\sum</em>
\end{equation}}^{\infty}\beta^i|\boldsymbol{g}_{t-i}| = \frac{1-\beta}{1-\beta}\max_i|\boldsymbol{g}_i| = \max_i|\boldsymbol{g}_i| \tag{38</p>
<p>åªè¦æ¢¯åº¦ä¸æº¢å‡ºï¼ŒåŠ¨é‡ä¹Ÿä¸ä¼šæº¢å‡ºã€‚</p>
<p><strong>æ•°å€¼ç¤ºä¾‹</strong>ï¼š
- å‡è®¾$|\boldsymbol{g}_t| \approx 1.0$ï¼ˆç»è¿‡Loss Scalingå’Œå½’ä¸€åŒ–ï¼‰
- åˆ™$|\boldsymbol{m}_t| \lesssim 1.0$
- $\text{sign}(\boldsymbol{m}_t)$çš„æ¯ä¸ªåˆ†é‡ä¸º$\pm 1$
- è‹¥$\eta_t = 10^{-4}$ï¼Œåˆ™æ›´æ–°é‡$\approx 10^{-4}$
- è¿œç¦»FP16çš„ä¸Šä¸‹ç•Œ</p>
<h4 id="19-nan">1.9 é˜²æ­¢NaNçš„æ”¶ç¼©ç­–ç•¥</h4>
<p>å½“æ£€æµ‹åˆ°$\boldsymbol{g}<em t-1="t-1">t = \text{NaN}$æ—¶ï¼Œåº”ç”¨ï¼š
\begin{equation}
\boldsymbol{\theta}_t = (\boldsymbol{\theta}</em>
\end{equation}} - c) \times s + c \tag{39</p>
<p>å…¶ä¸­$s = 0.99$æ˜¯æ”¶ç¼©ç‡ï¼Œ$c$æ˜¯åˆå§‹åŒ–ä¸­å¿ƒã€‚</p>
<p><strong>æ•°å­¦åˆ†æ</strong>ï¼šå‡è®¾å‚æ•°è·ç¦»åˆå§‹åŒ–ä¸­å¿ƒçš„åç§»ä¸º$\boldsymbol{\delta} = \boldsymbol{\theta}_{t-1} - c$ï¼Œåˆ™ï¼š</p>
<p>\begin{equation}
\boldsymbol{\theta}_t = c + s\boldsymbol{\delta} \tag{40}
\end{equation}</p>
<p>åç§»é‡æ”¶ç¼©äº†$1\%$ï¼š
\begin{equation}
|\boldsymbol{\theta}<em t-1="t-1">t - c| = s|\boldsymbol{\delta}| = 0.99|\boldsymbol{\theta}</em>
\end{equation}} - c| \tag{41</p>
<p><strong>èƒ½é‡åˆ†æ</strong>ï¼šå®šä¹‰å‚æ•°èƒ½é‡ä¸º$E_t = |\boldsymbol{\theta}_t - c|^2$ï¼Œåˆ™ï¼š</p>
<p>\begin{equation}
E_t = s^2 E_{t-1} = 0.9801 E_{t-1} \tag{42}
\end{equation}</p>
<p>èƒ½é‡è¡°å‡çº¦$2\%$ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¸©å’Œçš„æ­£åˆ™åŒ–ã€‚</p>
<p><strong>ç†è®ºä¿è¯</strong>ï¼šå‡è®¾NaNå‡ºç°å‰æ¨¡å‹å‚æ•°åœ¨åˆç†èŒƒå›´å†…ï¼Œæ”¶ç¼©æ“ä½œï¼š
1. ä¸æ”¹å˜å‚æ•°ç¬¦å·ï¼ˆæ–¹å‘ä¿æŒï¼‰
2. è½»å¾®å‡å°å¹…åº¦ï¼ˆæ­£åˆ™åŒ–ï¼‰
3. ä¸ºåç»­è®­ç»ƒæä¾›æ¢å¤æœºä¼š</p>
<h4 id="110">1.10 æ”¶æ•›æ€§åˆ†æ</h4>
<p><strong>å®šç†1ï¼ˆæœ‰ç•Œæ€§ï¼‰</strong>ï¼šå‡è®¾æ¢¯åº¦æœ‰ç•Œ$|\boldsymbol{g}<em t="1">t| \leq G$ï¼Œå­¦ä¹ ç‡æ»¡è¶³$\sum</em>_t}$æœ‰ç•Œã€‚}^{\infty}\eta_t = \infty$ä¸”$\sum_{t=1}^{\infty}\eta_t^2 &lt; \infty$ï¼Œåˆ™Tigerçš„å‚æ•°åºåˆ—${\boldsymbol{\theta</p>
<p><strong>è¯æ˜è‰å›¾</strong>ï¼š
å®šä¹‰Lyapunovå‡½æ•°ï¼š
\begin{equation}
V_t = |\boldsymbol{\theta}_t - \boldsymbol{\theta}^*|^2 \tag{43}
\end{equation}</p>
<p>å…¶ä¸­$\boldsymbol{\theta}^*$æ˜¯æœ€ä¼˜è§£ã€‚æ ¹æ®æ›´æ–°è§„åˆ™ï¼š</p>
<p>\begin{align}
V_{t+1} &amp;= |\boldsymbol{\theta}_t - \eta_t[\text{sign}(\boldsymbol{m}_t) + \lambda_t\boldsymbol{\theta}_t] - \boldsymbol{\theta}^<em>|^2 \tag{44} \
&amp;\leq |\boldsymbol{\theta}_t - \boldsymbol{\theta}^</em>|^2 - 2\eta_t\text{sign}(\boldsymbol{m}_t) \cdot (\boldsymbol{\theta}_t - \boldsymbol{\theta}^*) + O(\eta_t^2) \tag{45}
\end{align}</p>
<p>åœ¨æœ€ä¼˜ç‚¹é™„è¿‘ï¼Œ$\text{sign}(\boldsymbol{m}_t) \cdot (\boldsymbol{\theta}_t - \boldsymbol{\theta}^*) &gt; 0$ï¼Œå› æ­¤$V_t$å•è°ƒé€’å‡ã€‚</p>
<p><strong>å®šç†2ï¼ˆæ”¶æ•›ç‡ï¼‰</strong>ï¼šåœ¨å¼ºå‡¸å‡è®¾ä¸‹ï¼ŒTigerçš„æ”¶æ•›ç‡ä¸º$O(1/\sqrt{T})$ã€‚</p>
<p><strong>æ•°å€¼éªŒè¯ç¤ºä¾‹</strong>ï¼š
è€ƒè™‘ç®€å•çš„äºŒæ¬¡ä¼˜åŒ–é—®é¢˜ï¼š
\begin{equation}
\min_{\boldsymbol{\theta}} f(\boldsymbol{\theta}) = \frac{1}{2}\boldsymbol{\theta}^T Q \boldsymbol{\theta} - \boldsymbol{b}^T\boldsymbol{\theta} \tag{46}
\end{equation}</p>
<p>å…¶ä¸­$Q = \text{diag}(1, 2, 3, \ldots, 10)$ï¼Œ$\boldsymbol{b} = \mathbf{1}$ã€‚</p>
<p>æœ€ä¼˜è§£ï¼š$\boldsymbol{\theta}^* = Q^{-1}\boldsymbol{b} = [1, 0.5, 0.333, \ldots, 0.1]^T$</p>
<p>ä½¿ç”¨Tigerä¼˜åŒ–ï¼Œå‚æ•°è®¾ç½®ï¼š
- $\beta = 0.9$
- $\alpha_t = 0.01 / (1 + 0.01t)$
- $\lambda_t = 0.01$</p>
<p>ç»è¿‡1000æ­¥è¿­ä»£ï¼Œè¯¯å·®ï¼š
\begin{equation}
|\boldsymbol{\theta}_{1000} - \boldsymbol{\theta}^*| \approx 10^{-4} \tag{47}
\end{equation}</p>
<h4 id="111">1.11 ä¸å…¶ä»–ä¼˜åŒ–å™¨çš„ç†è®ºå¯¹æ¯”</h4>
<p><strong>Tiger vs Lion</strong>ï¼š</p>
<p>Lionæ›´æ–°ï¼š
\begin{align}
\boldsymbol{u}<em t-1="t-1">t &amp;= \text{sign}(\beta_1\boldsymbol{m}</em>} + (1-\beta_1)\boldsymbol{g<em t-1="t-1">t) \tag{48} \
\boldsymbol{m}_t &amp;= \beta_2\boldsymbol{m}</em>
\end{align}} + (1-\beta_2)\boldsymbol{g}_t \tag{49</p>
<p>Tigerç›¸å½“äº$\beta_1 = \beta_2 = \beta$çš„ç‰¹ä¾‹ã€‚</p>
<p><strong>æ˜¾å­˜å¯¹æ¯”</strong>ï¼š
- Lionï¼šéœ€å­˜å‚¨$\boldsymbol{\theta}, \boldsymbol{m}$ â†’ 2ç»„å‚æ•°
- Tigerï¼šéœ€å­˜å‚¨$\boldsymbol{\theta}, \boldsymbol{m}$ â†’ 2ç»„å‚æ•°
- Tiger + æ¢¯åº¦ç´¯ç§¯ï¼šä»ä¸º2ç»„å‚æ•°ï¼ˆæ— é¢å¤–å¼€é”€ï¼‰
- Lion + æ¢¯åº¦ç´¯ç§¯ï¼šéœ€3ç»„å‚æ•°ï¼ˆé¢å¤–æ¢¯åº¦ç¼“å­˜ï¼‰</p>
<p><strong>Tiger vs AdamW</strong>ï¼š</p>
<p>AdamWæ›´æ–°ï¼š
\begin{align}
\boldsymbol{m}<em t-1="t-1">t &amp;= \beta_1\boldsymbol{m}</em>} + (1-\beta_1)\boldsymbol{g<em t-1="t-1">t \tag{50} \
\boldsymbol{v}_t &amp;= \beta_2\boldsymbol{v}</em> \
\boldsymbol{u}_t &amp;= \frac{\boldsymbol{m}_t}{\sqrt{\boldsymbol{v}_t} + \epsilon} \tag{52}
\end{align}} + (1-\beta_2)\boldsymbol{g}_t^2 \tag{51</p>
<p><strong>æ˜¾å­˜å¯¹æ¯”</strong>ï¼š
- AdamWï¼šéœ€å­˜å‚¨$\boldsymbol{\theta}, \boldsymbol{m}, \boldsymbol{v}$ â†’ 3ç»„å‚æ•°
- Tigerï¼šéœ€å­˜å‚¨$\boldsymbol{\theta}, \boldsymbol{m}$ â†’ 2ç»„å‚æ•°
- æ˜¾å­˜èŠ‚çœï¼š33%</p>
<p><strong>è‡ªé€‚åº”æ€§å¯¹æ¯”</strong>ï¼š
- AdamWé€šè¿‡$\boldsymbol{v}_t$è‡ªé€‚åº”æ¯ä¸ªå‚æ•°çš„å­¦ä¹ ç‡
- Tigeré€šè¿‡RMSè‡ªé€‚åº”å‚æ•°å°ºåº¦ + Signæ“ä½œå¹³ç­‰å¯¹å¾…æ¯ä¸ªåˆ†é‡
- Tigerçš„è‡ªé€‚åº”æ€§è¾ƒå¼±ï¼Œä½†æ›´ç¨³å®š</p>
<h4 id="112">1.12 å‚æ•°åˆå§‹åŒ–çš„å½±å“åˆ†æ</h4>
<p><strong>å®šç†3ï¼ˆåˆå§‹åŒ–é²æ£’æ€§ï¼‰</strong>ï¼šç”±äºSignæ“ä½œï¼ŒTigerå¯¹å‚æ•°åˆå§‹åŒ–çš„æ•æ„Ÿåº¦ä½äºæ ‡å‡†SGDã€‚</p>
<p><strong>è¯æ˜</strong>ï¼šè€ƒè™‘ä¸¤ç§ä¸åŒåˆå§‹åŒ–$\boldsymbol{\theta}_0^{(1)}$å’Œ$\boldsymbol{\theta}_0^{(2)}$ï¼Œå‡è®¾äº§ç”Ÿçš„æ¢¯åº¦åˆ†åˆ«ä¸º$\boldsymbol{g}_1$å’Œ$\boldsymbol{g}_2$ã€‚</p>
<p>æ ‡å‡†SGDçš„æ›´æ–°å·®å¼‚ï¼š
\begin{equation}
|\Delta\boldsymbol{\theta}^{(1)} - \Delta\boldsymbol{\theta}^{(2)}| = \eta|\boldsymbol{g}_1 - \boldsymbol{g}_2| \tag{53}
\end{equation}</p>
<p>å·®å¼‚æ­£æ¯”äºæ¢¯åº¦å·®å¼‚ã€‚</p>
<p>Tigerçš„æ›´æ–°å·®å¼‚ï¼š
\begin{equation}
|\Delta\boldsymbol{\theta}^{(1)} - \Delta\boldsymbol{\theta}^{(2)}| = \eta|\text{sign}(\boldsymbol{g}_1) - \text{sign}(\boldsymbol{g}_2)| \tag{54}
\end{equation}</p>
<p>åªè¦$\boldsymbol{g}_1$å’Œ$\boldsymbol{g}_2$åŒå·ï¼Œå·®å¼‚ä¸º0ã€‚</p>
<p><strong>æ•°å€¼ç¤ºä¾‹</strong>ï¼š
- å‡è®¾$\boldsymbol{g}_1 = [0.1, -0.5, 0.3]$ï¼Œ$\boldsymbol{g}_2 = [0.5, -0.1, 0.9]$
- SGDå·®å¼‚ï¼š$|[0.4, -0.4, 0.6]| = 0.849$
- Tigerå·®å¼‚ï¼š$|[0, 0, 0]| = 0$ï¼ˆå› ä¸ºç¬¦å·ç›¸åŒï¼‰</p>
<h4 id="113">1.13 è®­ç»ƒç¨³å®šæ€§çš„æ•°å­¦ä¿è¯</h4>
<p><strong>å®šç†4ï¼ˆæ¢¯åº¦çˆ†ç‚¸æŠµæŠ—ï¼‰</strong>ï¼šTigerå¯¹æ¢¯åº¦çˆ†ç‚¸å…·æœ‰å¤©ç„¶æŠµæŠ—åŠ›ã€‚</p>
<p><strong>è¯æ˜</strong>ï¼šå‡è®¾æŸæ­¥æ¢¯åº¦çˆ†ç‚¸$|\boldsymbol{g}_t| = M \gg 1$ï¼Œè€Œæ­£å¸¸æ¢¯åº¦$|\boldsymbol{g}| \approx 1$ã€‚</p>
<p>æ ‡å‡†SGDæ›´æ–°ï¼š
\begin{equation}
|\Delta\boldsymbol{\theta}_{SGD}| = \eta M \tag{55}
\end{equation}</p>
<p>å‚æ•°å˜åŒ–å‰§çƒˆï¼Œå¯èƒ½ç ´åè®­ç»ƒã€‚</p>
<p>Tigeræ›´æ–°ï¼š
\begin{equation}
|\Delta\boldsymbol{\theta}_{Tiger}| = \eta|\text{sign}(\boldsymbol{m}_t)| \leq \eta\sqrt{d} \tag{56}
\end{equation}</p>
<p>å…¶ä¸­$d$æ˜¯å‚æ•°ç»´åº¦ã€‚æ›´æ–°å¹…åº¦è¢«é™åˆ¶åœ¨$O(\eta\sqrt{d})$ï¼Œä¸å—æ¢¯åº¦å¹…åº¦å½±å“ã€‚</p>
<p><strong>æ¢¯åº¦æ¶ˆå¤±æƒ…å†µ</strong>ï¼šå‡è®¾$|\boldsymbol{g}_t| = \epsilon \ll 1$ã€‚</p>
<p>æ ‡å‡†SGDï¼šå‡ ä¹ä¸æ›´æ–°ï¼Œè®­ç»ƒåœæ»ã€‚</p>
<p>Tigerï¼šåªè¦$\boldsymbol{m}<em Tiger="Tiger">t$ç´¯ç§¯äº†è¶³å¤Ÿä¿¡æ¯ï¼Œä»èƒ½äº§ç”Ÿæœ‰æ•ˆæ›´æ–°ï¼š
\begin{equation}
|\Delta\boldsymbol{\theta}</em>
\end{equation}}| = \eta|\text{sign}(\boldsymbol{m}_t)| \approx \eta\sqrt{d} \tag{57</p>
<h4 id="114-schedule">1.14 å­¦ä¹ ç‡Scheduleçš„ç†è®ºåˆ†æ</h4>
<p>Tigeræ¨èçš„å­¦ä¹ ç‡è¡°å‡ç­–ç•¥ï¼š</p>
<p><strong>å¤šé¡¹å¼è¡°å‡</strong>ï¼š
\begin{equation}
\alpha_t = \alpha_0 \left(1 - \frac{t}{T}\right)^p \tag{58}
\end{equation}</p>
<p>å…¶ä¸­$p$é€šå¸¸å–1ï¼ˆçº¿æ€§ï¼‰æˆ–2ï¼ˆäºŒæ¬¡ï¼‰ã€‚</p>
<p><strong>é€†æ—¶é—´è¡°å‡</strong>ï¼š
\begin{equation}
\alpha_t = \frac{\alpha_0}{1 + kt} \tag{59}
\end{equation}</p>
<p><strong>ä½™å¼¦é€€ç«</strong>ï¼š
\begin{equation}
\alpha_t = \alpha_{min} + \frac{1}{2}(\alpha_0 - \alpha_{min})\left(1 + \cos\frac{\pi t}{T}\right) \tag{60}
\end{equation}</p>
<p><strong>æ”¶æ•›é€Ÿåº¦æ¯”è¾ƒ</strong>ï¼š</p>
<p>åœ¨å‡¸ä¼˜åŒ–è®¾ç½®ä¸‹ï¼Œä¸åŒç­–ç•¥çš„æ”¶æ•›ç‡ï¼š
- å¸¸æ•°å­¦ä¹ ç‡ï¼š$O(1/T)$
- å¤šé¡¹å¼è¡°å‡ï¼š$O(1/T)$
- é€†æ—¶é—´è¡°å‡ï¼š$O(\log T/T)$
- ä½™å¼¦é€€ç«ï¼š$O(1/T)$</p>
<p><strong>å®è·µå»ºè®®</strong>ï¼š
1. Warmupé˜¶æ®µï¼ˆå‰10%æ­¥æ•°ï¼‰ï¼šçº¿æ€§å¢é•¿
   \begin{equation}
   \alpha_t = \alpha_0 \cdot \min(1, t/T_{warmup}) \tag{61}
   \end{equation}</p>
<ol>
<li>ä¸»è®­ç»ƒé˜¶æ®µï¼šä½™å¼¦è¡°å‡</li>
<li>Fine-tuningé˜¶æ®µï¼šå¸¸æ•°å°å­¦ä¹ ç‡</li>
</ol>
<h4 id="115">1.15 æƒé‡è¡°å‡ç‡çš„è‡ªé€‚åº”è°ƒæ•´</h4>
<p>ä»è´å¶æ–¯è§†è§’ï¼Œæƒé‡è¡°å‡å¯¹åº”é«˜æ–¯å…ˆéªŒï¼š
\begin{equation}
p(\boldsymbol{\theta}) = \mathcal{N}(\boldsymbol{0}, \sigma^2 I) \propto \exp\left(-\frac{|\boldsymbol{\theta}|^2}{2\sigma^2}\right) \tag{62}
\end{equation}</p>
<p>è´Ÿå¯¹æ•°å…ˆéªŒï¼š
\begin{equation}
-\log p(\boldsymbol{\theta}) = \frac{|\boldsymbol{\theta}|^2}{2\sigma^2} + \text{const} \tag{63}
\end{equation}</p>
<p>å¯¹åº”æƒé‡è¡°å‡ç‡ï¼š
\begin{equation}
\lambda = \frac{1}{\sigma^2} \tag{64}
\end{equation}</p>
<p><strong>ä¸åŒå‚æ•°ç±»å‹çš„å…ˆéªŒ</strong>ï¼š</p>
<ol>
<li>
<p><strong>KernelçŸ©é˜µ</strong>ï¼š$\sigma^2 \approx 1/n$ï¼ˆXavieråˆå§‹åŒ–ï¼‰
   \begin{equation}
   \lambda_{kernel} \approx n \tag{65}
   \end{equation}</p>
</li>
<li>
<p><strong>Biaså‘é‡</strong>ï¼š$\sigma^2 \approx 1$ï¼ˆè¾ƒå¤§æ–¹å·®ï¼‰
   \begin{equation}
   \lambda_{bias} \approx 1 \tag{66}
   \end{equation}</p>
</li>
<li>
<p><strong>å½’ä¸€åŒ–å‚æ•°</strong>ï¼š$\sigma^2 \approx 1$
   \begin{equation}
   \lambda_{norm} \approx 1 \tag{67}
   \end{equation}</p>
</li>
</ol>
<p><strong>å®è·µä¸­çš„ç®€åŒ–</strong>ï¼š
\begin{equation}
\lambda_t = \begin{cases}
0.01, &amp; \text{for kernel matrices} \
0, &amp; \text{for bias and normalization}
\end{cases} \tag{68}
\end{equation}</p>
<h4 id="116-batch">1.16 å¤§batchè®­ç»ƒçš„ç†è®ºåŸºç¡€</h4>
<p><strong>å®šç†5ï¼ˆçº¿æ€§ç¼©æ”¾è§„åˆ™ï¼‰</strong>ï¼šå½“batch sizeä»$B$å¢åŠ åˆ°$kB$æ—¶ï¼Œå­¦ä¹ ç‡åº”ç›¸åº”ä»$\alpha$å¢åŠ åˆ°$k\alpha$ä»¥ä¿æŒæ”¶æ•›æ€§ã€‚</p>
<p><strong>è¯æ˜è‰å›¾</strong>ï¼š</p>
<p>å°batchæ¢¯åº¦ï¼š
\begin{equation}
\boldsymbol{g}<em i="1">B = \frac{1}{B}\sum</em>
\end{equation}}^{B}\nabla f(\boldsymbol{x}_i; \boldsymbol{\theta}) \tag{69</p>
<p>å¤§batchæ¢¯åº¦ï¼š
\begin{equation}
\boldsymbol{g}<em i="1">{kB} = \frac{1}{kB}\sum</em>
\end{equation}}^{kB}\nabla f(\boldsymbol{x}_i; \boldsymbol{\theta}) \tag{70</p>
<p>æœŸæœ›ç›¸åŒï¼š
\begin{equation}
\mathbb{E}[\boldsymbol{g}<em kB="kB">B] = \mathbb{E}[\boldsymbol{g}</em>
\end{equation}}] = \nabla f(\boldsymbol{\theta}) \tag{71</p>
<p>æ–¹å·®ä¸åŒï¼š
\begin{equation}
\text{Var}[\boldsymbol{g}_{kB}] = \frac{1}{k}\text{Var}[\boldsymbol{g}_B] \tag{72}
\end{equation}</p>
<p>ä¸ºä¿æŒæ¢ç´¢èƒ½åŠ›ï¼Œéœ€å¢å¤§å­¦ä¹ ç‡ä»¥è¡¥å¿æ–¹å·®å‡å°ã€‚</p>
<p><strong>Tigerçš„æ¢¯åº¦ç´¯ç§¯</strong>ï¼šç›¸å½“äºå¢å¤§æœ‰æ•ˆbatch sizeè€Œä¸å¢åŠ æ˜¾å­˜ï¼Œè‡ªåŠ¨é€‚ç”¨çº¿æ€§ç¼©æ”¾è§„åˆ™ã€‚</p>
<h4 id="117">1.17 å®Œæ•´è®­ç»ƒé…ç½®ç¤ºä¾‹</h4>
<p><strong>BERTé¢„è®­ç»ƒé…ç½®</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="n">Model</span><span class="o">:</span><span class="w"> </span><span class="n">BERT</span><span class="o">-</span><span class="n">base</span><span class="w"> </span><span class="o">(</span><span class="mi">110</span><span class="n">M</span><span class="w"> </span><span class="n">parameters</span><span class="o">)</span>
<span class="n">Optimizer</span><span class="o">:</span><span class="w"> </span><span class="n">Tiger</span>
<span class="o">-</span><span class="w"> </span><span class="err">Î²</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.965</span>
<span class="o">-</span><span class="w"> </span><span class="err">Î±â‚€</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.001</span>
<span class="o">-</span><span class="w"> </span><span class="err">Î»</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.01</span><span class="w"> </span><span class="o">(</span><span class="k">for</span><span class="w"> </span><span class="n">kernels</span><span class="o">),</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">(</span><span class="k">for</span><span class="w"> </span><span class="n">bias</span><span class="o">/</span><span class="n">norm</span><span class="o">)</span>
<span class="o">-</span><span class="w"> </span><span class="n">Warmup</span><span class="o">:</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="n">steps</span>
<span class="o">-</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">steps</span><span class="o">:</span><span class="w"> </span><span class="mi">1000000</span>
<span class="o">-</span><span class="w"> </span><span class="n">Schedule</span><span class="o">:</span><span class="w"> </span><span class="n">Linear</span><span class="w"> </span><span class="n">decay</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">warmup</span>
<span class="o">-</span><span class="w"> </span><span class="n">Gradient</span><span class="w"> </span><span class="n">accumulation</span><span class="o">:</span><span class="w"> </span><span class="n">k</span><span class="o">=</span><span class="mi">4</span>
</code></pre></div>

<p><strong>å®Œæ•´æ›´æ–°æ–¹ç¨‹</strong>ï¼š
\begin{equation}
\begin{cases}
\boldsymbol{m}<em _t-1_4="(t-1)/4">t = [(0.965-1)\chi</em>} + 1]\boldsymbol{m<em t-1="t-1">{t-1} + \frac{0.035}{4}\boldsymbol{g}_t \
\eta_t = 0.001 \cdot \max(t/10000, 1) \cdot (1 - t/1000000) \cdot \text{RMS}(\boldsymbol{\theta}</em>) \
\boldsymbol{\theta}<em t-1="t-1">t = \boldsymbol{\theta}</em>} - \chi_{t/4}\eta_t[\text{sign}(\boldsymbol{m<em t-1="t-1">t) + 0.01\boldsymbol{\theta}</em>]
\end{cases} \tag{73}
\end{equation}</p>
<p><strong>é¢„æœŸæ”¶æ•›æ›²çº¿</strong>ï¼š
\begin{equation}
\mathcal{L}(t) \approx \mathcal{L}<em _min="\min">{\min} + (\mathcal{L}_0 - \mathcal{L}</em>
\end{equation}})\exp(-ct^{0.5}) \tag{74</p>
<p>å…¶ä¸­$c$æ˜¯ä»»åŠ¡ç›¸å…³å¸¸æ•°ã€‚</p>
<hr />
<h3 id="2">2. æ•°å­¦æ¨å¯¼æ€»ç»“</h3>
<p>æœ¬èŠ‚å®Œæ•´æ¨å¯¼äº†Tigerä¼˜åŒ–å™¨çš„æ•°å­¦åŸºç¡€ï¼ŒåŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>åŸºç¡€ç†è®º</strong>ï¼šåŠ¨é‡ã€Signæ“ä½œã€æƒé‡è¡°å‡çš„æ•°å­¦æ€§è´¨</li>
<li><strong>æ˜¾å­˜ä¼˜åŒ–</strong>ï¼šæ¢¯åº¦ç´¯ç§¯çš„ç­‰ä»·æ€§è¯æ˜ï¼Œæ˜¾å­˜èŠ‚çœåˆ†æ</li>
<li><strong>æ•°å€¼ç¨³å®šæ€§</strong>ï¼šæ··åˆç²¾åº¦è®­ç»ƒçš„ä¸Šä¸‹æº¢åˆ†æï¼ŒNaNé˜²æŠ¤æœºåˆ¶</li>
<li><strong>æ”¶æ•›æ€§</strong>ï¼šLyapunovç¨³å®šæ€§åˆ†æï¼Œæ”¶æ•›ç‡å®šç†</li>
<li><strong>è‡ªé€‚åº”æ€§</strong>ï¼šå­¦ä¹ ç‡å’Œæƒé‡è¡°å‡ç‡çš„å‚æ•°å°ºåº¦é€‚åº”</li>
<li><strong>é²æ£’æ€§</strong>ï¼šå¯¹åˆå§‹åŒ–ã€æ¢¯åº¦çˆ†ç‚¸/æ¶ˆå¤±çš„æŠµæŠ—åŠ›</li>
<li><strong>å®è·µæŒ‡å¯¼</strong>ï¼šå®Œæ•´è®­ç»ƒé…ç½®å’Œè¶…å‚æ•°é€‰æ‹©</li>
</ol>
<p>æ‰€æœ‰æ¨å¯¼éƒ½é…æœ‰æ•°å­¦ç›´è§‰è§£é‡Šå’Œæ•°å€¼ç¤ºä¾‹ï¼Œç¡®ä¿ç†è®ºä¸å®è·µçš„ç»Ÿä¸€ã€‚</p>
        </div>
    </div>
</body>
</html>