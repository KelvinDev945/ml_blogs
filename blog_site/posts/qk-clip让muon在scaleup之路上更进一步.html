<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QK-Clipï¼šè®©Muonåœ¨Scaleupä¹‹è·¯ä¸Šæ›´è¿›ä¸€æ­¥</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>QK-Clipï¼šè®©Muonåœ¨Scaleupä¹‹è·¯ä¸Šæ›´è¿›ä¸€æ­¥</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-26 | ğŸ“„ å¤§å°: 46.0 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/11126">https://spaces.ac.cn/archives/11126</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>å››ä¸ªæœˆå‰ï¼Œæˆ‘ä»¬å‘å¸ƒäº†<a href="/archives/10739">Moonlight</a>ï¼Œåœ¨16Bçš„MoEæ¨¡å‹ä¸ŠéªŒè¯äº†<a href="/archives/10592">Muon</a>ä¼˜åŒ–å™¨çš„æœ‰æ•ˆæ€§ã€‚åœ¨Moonlightä¸­ï¼Œæˆ‘ä»¬ç¡®è®¤äº†ç»™Muonæ·»åŠ Weight Decayçš„å¿…è¦æ€§ï¼ŒåŒæ—¶æå‡ºäº†é€šè¿‡Update RMSå¯¹é½æ¥è¿ç§»Adamè¶…å‚çš„æŠ€å·§ï¼Œè¿™ä½¿å¾—Muonå¯ä»¥å¿«é€Ÿåº”ç”¨äºLLMçš„è®­ç»ƒã€‚ç„¶è€Œï¼Œå½“æˆ‘ä»¬å°è¯•å°†Muonè¿›ä¸€æ­¥æ‹“å±•åˆ°åƒäº¿å‚æ•°ä»¥ä¸Šçš„æ¨¡å‹æ—¶ï¼Œé‡åˆ°äº†æ–°çš„â€œæ‹¦è·¯è™â€â€”â€”MaxLogitçˆ†ç‚¸ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§ç®€å•ä½†æå…¶æœ‰æ•ˆçš„æ–°æ–¹æ³•ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œQK-Clipâ€ã€‚è¯¥æ–¹æ³•ä»ä¸€ä¸ªéå¸¸æœ¬è´¨çš„è§’åº¦å»çœ‹å¾…å’Œè§£å†³MaxLogitç°è±¡ï¼Œå¹¶ä¸”æ— æŸæ¨¡å‹æ•ˆæœï¼Œè¿™æˆä¸ºæˆ‘ä»¬æœ€æ–°å‘å¸ƒçš„ä¸‡äº¿å‚æ•°æ¨¡å‹â€œ<a href="https://moonshotai.github.io/Kimi-K2/">Kimi K2</a>â€çš„å…³é”®è®­ç»ƒæŠ€æœ¯ä¹‹ä¸€ã€‚</p>
<h2 id="_1">é—®é¢˜æè¿°</h2>
<p>æˆ‘ä»¬å…ˆæ¥ç®€å•ä»‹ç»ä¸€ä¸‹MaxLogitçˆ†ç‚¸ç°è±¡ã€‚å›é¡¾Attentionçš„å®šä¹‰<br />
\begin{equation}\boldsymbol{O} = softmax(\boldsymbol{Q}\boldsymbol{K}^{\top})\boldsymbol{V}\end{equation}<br />
è¿™é‡Œçœç•¥äº†ç¼©æ”¾å› å­$1/\sqrt{d}$ï¼Œå› ä¸ºå®ƒæ€»å¯ä»¥å¸æ”¶åˆ°$\boldsymbol{Q},\boldsymbol{K}$çš„å®šä¹‰ä¸­ã€‚â€œMaxLogitçˆ†ç‚¸â€ä¸­çš„Logitï¼ŒæŒ‡çš„æ˜¯Softmaxå‰çš„AttentionçŸ©é˜µï¼Œå³$\boldsymbol{Q}\boldsymbol{K}^{\top}$ï¼Œè€ŒMaxLogitæŒ‡çš„æ˜¯å…¨ä½“Logitçš„æœ€å¤§å€¼ï¼Œæˆ‘ä»¬å°†å®ƒè®°ä¸º<br />
\begin{equation}S_{\max} = \max_{i,j}\, \boldsymbol{q}<em _max="\max">i\cdot \boldsymbol{k}_j\end{equation}<br />
è¿™é‡Œçš„$\max$å…¶å®è¿˜è¦åœ¨batch_sizeç»´åº¦ä¸Šå–ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ªæ ‡é‡ã€‚è€ŒMaxLogitçˆ†ç‚¸æ˜¯æŒ‡ï¼Œ$S</em>$éšç€è®­ç»ƒçš„æ¨è¿›ä¸€ç›´å¾€ä¸Šæ¶¨ï¼Œå¢é•¿é€Ÿåº¦æ˜¯çº¿æ€§ç”šè‡³æ˜¯è¶…çº¿æ€§çš„ï¼Œå¹¶ä¸”åœ¨ç›¸å½“é•¿çš„æ—¶é—´å†…æ²¡æœ‰ç¨³å®šçš„è¿¹è±¡ã€‚</p>
<p><a href="/usr/uploads/2025/07/3626912260.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="MaxLogitçˆ†ç‚¸ç°è±¡" src="/usr/uploads/2025/07/3626912260.png" /></a></p>
<p>MaxLogitçˆ†ç‚¸ç°è±¡</p>
<p>MaxLogitæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¼‚å¸¸å€¼æŒ‡æ ‡ï¼Œå®ƒçš„çˆ†ç‚¸æ„å‘³ç€å¼‚å¸¸å€¼è¶…å‡ºäº†å¯æ§èŒƒå›´ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬æœ‰<br />
\begin{equation}|\boldsymbol{q}_i\cdot \boldsymbol{k}_j| \leq \Vert\boldsymbol{q}_i\Vert \Vert\boldsymbol{k}_j\Vert = \Vert\boldsymbol{x}_i\boldsymbol{W}_q\Vert \Vert\boldsymbol{x}_j\boldsymbol{W}_k\Vert \leq \Vert\boldsymbol{x}_i\Vert \Vert\boldsymbol{x}_j\Vert \Vert\boldsymbol{W}_q\Vert \Vert\boldsymbol{W}_k\Vert\label{eq:kexi}\end{equation}<br />
ç”±äº$\boldsymbol{x}$é€šå¸¸ä¼šåŠ RMSNormï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹$\Vert\boldsymbol{x}_i\Vert \Vert\boldsymbol{x}_j\Vert$æ˜¯ä¸ä¼šçˆ†ç‚¸çš„ï¼Œå› æ­¤MaxLogitçˆ†ç‚¸æ„å‘³ç€è°±èŒƒæ•°$\Vert\boldsymbol{W}_q\Vert,\Vert\boldsymbol{W}_k\Vert$æœ‰å¾€æ— ç©·å¤§å‘å±•çš„é£é™©ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯ä¸€ä¸ªå¥½æ¶ˆæ¯ã€‚</p>
<p>ç”±äºå†å¤§çš„æ•°å€¼ç»è¿‡Softmaxåéƒ½å˜å¾—å°äº1ï¼Œæ‰€ä»¥æ¯”è¾ƒå¹¸è¿çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªç°è±¡ä¸ä¼šå¸¦æ¥å¤ªä¸¥é‡çš„åæœï¼Œé¡¶å¤šæ˜¯æµªè´¹äº†ä¸€ä¸ªAttention Headï¼Œä½†æ¯”è¾ƒç³Ÿç³•çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå¼•èµ·Grad Spikeç”šè‡³è®­ç»ƒå´©æºƒã€‚å› æ­¤ï¼Œä¿é™©èµ·è§åº”å½“å°½é‡é¿å…MaxLogitçˆ†ç‚¸çš„å‡ºç°ã€‚</p>
<h2 id="_2">å·²æœ‰å°è¯•</h2>
<p>åœ¨<a href="/archives/10739">ã€ŠMuonç»­é›†ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬é€‰æ‹©å°è¯•Muonï¼Ÿã€‹</a>ä¸­æˆ‘ä»¬ç®€å•åˆ†æè¿‡ï¼ŒWeight Decayèƒ½ä¸€å®šç¨‹åº¦ä¸Šé¢„é˜²MaxLogitçˆ†ç‚¸ï¼Œæ‰€ä»¥å°æ¨¡å‹å‡ºç°MaxLogitçˆ†ç‚¸çš„æ¦‚ç‡å¾ˆå°ï¼Œå³ä¾¿åƒMoonlightè¿™æ ·çš„16Bæ¨¡å‹ï¼ŒMaxLogitæœ€å¤šæ¶¨åˆ°120åå°±è‡ªåŠ¨é™ä¸‹æ¥äº†ã€‚</p>
<p><a href="/usr/uploads/2025/07/3150611957.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="Moonlightçš„MaxLogitè‡ªåŠ¨é™äº†ä¸‹æ¥" src="/usr/uploads/2025/07/3150611957.png" /></a></p>
<p>Moonlightçš„MaxLogitè‡ªåŠ¨é™äº†ä¸‹æ¥</p>
<p>æ¢å¥è¯è¯´ï¼ŒMaxLogitçˆ†ç‚¸æ›´å¤šå‡ºç°åœ¨éå¸¸å¤§å‚æ•°é‡çš„æ¨¡å‹ä¸­ï¼Œæ¨¡å‹è¶Šå¤§ï¼Œè®­ç»ƒçš„ä¸ç¨³å®šå› ç´ è¶Šå¤šï¼ŒWeight Decayè¶Šéš¾ç¨³å®šè®­ç»ƒã€‚è¿™æ—¶å€™å¢åŠ Weight Decayè‡ªç„¶ä¹Ÿèƒ½åŠ å¼ºæ§åˆ¶ï¼Œä½†åŒæ—¶ä¹Ÿä¼šå¸¦æ¥æ˜æ˜¾çš„æ•ˆæœæŸå¤±ï¼Œæ‰€ä»¥æ­¤è·¯ä¸é€šã€‚å¦ä¸€ä¸ªæ¯”è¾ƒç›´æ¥çš„æ€è·¯æ˜¯ç›´æ¥ç»™LogitåŠ $\text{softcap}$ï¼š<br />
\begin{equation}\boldsymbol{O} = softmax(\text{softcap}(\boldsymbol{Q}\boldsymbol{K}^{\top};\tau))\boldsymbol{V}\end{equation}<br />
å…¶ä¸­$\text{softcap}(x;\tau) = \tau\tanh(x/\tau)$ï¼Œç”±Googleçš„<a href="https://papers.cool/arxiv/2408.00118">Gemma2</a>å¼•å…¥ã€‚ç”±äº$\tanh$çš„æœ‰ç•Œæ€§ï¼Œ$\text{softcap}$è‡ªç„¶æ˜¯èƒ½å¤Ÿä¿è¯$\text{softcap}$åçš„Logitæœ‰ç•Œçš„ï¼Œä½†æ— æ³•ä¿è¯$\text{softcap}$å‰çš„Logitæ˜¯æœ‰ç•Œçš„ï¼ˆäº²æµ‹ï¼‰ï¼Œæ‰€ä»¥$\text{softcap}$åªæ˜¯å°†ä¸€ä¸ªé—®é¢˜è½¬åŒ–ä¸ºäº†å¦ä¸€ä¸ªé—®é¢˜ï¼Œå®é™…ä¸Šå¹¶æ²¡æœ‰è§£å†³é—®é¢˜ã€‚</p>
<p>ä¹Ÿè®¸Googleè‡ªå·±éƒ½æ„è¯†åˆ°äº†è¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥åœ¨åæ¥çš„<a href="https://papers.cool/arxiv/2503.19786">Gemma3</a>ä¸­æ²¡æœ‰ç”¨$\text{softcap}$äº†ï¼Œè€Œæ”¹ç”¨â€œQK-Normâ€ï¼š<br />
\begin{equation}\boldsymbol{O} = softmax(\tilde{\boldsymbol{Q}}\tilde{\boldsymbol{K}}{}^{\top})\boldsymbol{V},\quad \begin{aligned}<br />
\tilde{\boldsymbol{Q}}=&amp;\,\text{RMSNorm}(\boldsymbol{Q}) \\\<br />
\tilde{\boldsymbol{K}}=&amp;\,\text{RMSNorm}(\boldsymbol{K})<br />
\end{aligned}\end{equation}</p>
<p>QK-Normç¡®å®æ˜¯å‹åˆ¶MaxLogitéå¸¸æœ‰æ•ˆçš„æ–¹æ³•ï¼Œç„¶è€Œå®ƒåªé€‚ç”¨äºMHAã€GQAç­‰ï¼Œä¸é€‚ç”¨äºMLAï¼Œå› ä¸ºQK-Norméœ€è¦æŠŠ$\boldsymbol{Q},\boldsymbol{K}$ç»™Materializeå‡ºæ¥ï¼Œä½†å¯¹äºMLAæ¥è¯´ï¼Œå®ƒè®­ç»ƒé˜¶æ®µè·ŸDecodingé˜¶æ®µçš„$\boldsymbol{Q},\boldsymbol{K}$å¹¶ä¸ä¸€æ ·ï¼ˆå¦‚ä¸‹å¼æ‰€ç¤ºï¼‰ï¼Œåœ¨Decodingé˜¶æ®µæˆ‘ä»¬æ²¡æ³•å®Œå…¨Materializeè®­ç»ƒé˜¶æ®µçš„$\boldsymbol{K}$ï¼Œæ¢è¨€ä¹‹ï¼ŒDecodingé˜¶æ®µæ²¡æ³•åšQK-Normã€‚</p>
<p>$$\require{cancel}\begin{array}{c|c}  
\text{è®­ç»ƒ/Prefill} & \text{Decoding} \\\  
\\\  
\begin{gathered}  
\boldsymbol{o}_t = \left[\boldsymbol{o}_t^{(1)}, \boldsymbol{o}_t^{(2)}, \cdots, \boldsymbol{o}_t^{(h)}\right] \\\\[10pt]  
\boldsymbol{o}_t^{(s)} = \frac{\sum_{i\leq t}\exp\left(\boldsymbol{q}_t^{(s)} \boldsymbol{k}_i^{(s)}{}^{\top}\right)\boldsymbol{v}_i^{(s)}}{\sum_{i\leq t}\exp\left(\boldsymbol{q}_t^{(s)} \boldsymbol{k}_i^{(s)}{}^{\top}\right)} \\\\[15pt]  
\boldsymbol{q}_i^{(s)} = \left[\boldsymbol{x}_i\boldsymbol{W}_{qc}^{(s)},\boldsymbol{x}_i\boldsymbol{W}_{qr}^{(s)}\color{#3ce2f7}{\boldsymbol{\mathcal{R}}_i}\right]\in\mathbb{R}^{d_k + d_r}\\\  
\boldsymbol{k}_i^{(s)} = \left[\boldsymbol{c}_i\boldsymbol{W}_{kc}^{(s)},\boldsymbol{x}_i\boldsymbol{W}_{kr}^{\color{#ccc}{\smash{\bcancel{(s)}}}}\color{#3ce2f7}{\boldsymbol{\mathcal{R}}_i}\right]\in\mathbb{R}^{d_k + d_r} \\\  
\boldsymbol{v}_i^{(s)} = \boldsymbol{c}_i\boldsymbol{W}_v^{(s)}\in\mathbb{R}^{d_v},\quad\boldsymbol{c}_i = \boldsymbol{x}_i \boldsymbol{W}_c\in\mathbb{R}^{d_c}  
\end{gathered}  
&  
\begin{gathered}  
\boldsymbol{o}_t = \left[\boldsymbol{o}_t^{(1)}\boldsymbol{W}_v^{(1)}, \boldsymbol{o}_t^{(2)}\boldsymbol{W}_v^{(2)}, \cdots, \boldsymbol{o}_t^{(h)}\boldsymbol{W}_v^{(h)}\right] \\\\[10pt]  
\boldsymbol{o}_t^{(s)} = \frac{\sum_{i\leq t}\exp\left(\boldsymbol{q}_t^{(s)} \boldsymbol{k}_i^{\color{#ccc}{\smash{\bcancel{(s)}}}}{}^{\top}\right)\boldsymbol{v}_i^{\color{#ccc}{\smash{\bcancel{(s)}}}} }{\sum_{i\leq t}\exp\left(\boldsymbol{q}_t^{(s)} \boldsymbol{k}_i^{\color{#ccc}{\smash{\bcancel{(s)}}}}{}^{\top}\right)} \\\\[15pt]  
\boldsymbol{q}_i^{(s)} = \left[\boldsymbol{x}_i\boldsymbol{W}_{qc}^{(s)}\boldsymbol{W}_{kc}^{(s)}{}^{\top}, \boldsymbol{x}_i\boldsymbol{W}_{qr}^{(s)}\color{#3ce2f7}{\boldsymbol{\mathcal{R}}_i}\right]\in\mathbb{R}^{d_c + d_r}\\\  
\boldsymbol{k}_i^{\color{#ccc}{\smash{\bcancel{(s)}}}} = \left[\boldsymbol{c}_i, \boldsymbol{x}_i\boldsymbol{W}_{kr}^{\color{#ccc}{\smash{\bcancel{(s)}}}}\color{#3ce2f7}{\boldsymbol{\mathcal{R}}_i}\right]\in\mathbb{R}^{d_c + d_r}\\\  
\boldsymbol{v}_i^{\color{#ccc}{\smash{\bcancel{(s)}}}} = \boldsymbol{c}_i= \boldsymbol{x}_i \boldsymbol{W}_c\in\mathbb{R}^{d_c}  
\end{gathered} \\\  
\end{array} $$</p>
<p>ä¸ºä»€ä¹ˆè¦ç”¨MLAï¼Ÿæˆ‘ä»¬å·²ç»ç”¨ä¸¤ç¯‡æ–‡ç« <a href="/archives/10907">ã€ŠTransformerå‡çº§ä¹‹è·¯ï¼š21ã€MLAå¥½åœ¨å“ªé‡Œ?ï¼ˆä¸Šï¼‰ã€‹</a>å’Œ<a href="/archives/11111">ã€ŠTransformerå‡çº§ä¹‹è·¯ï¼š21ã€MLAå¥½åœ¨å“ªé‡Œ?ï¼ˆä¸‹ï¼‰ã€‹</a>è®¨è®ºäº†è¿™ä¸ªé—®é¢˜ï¼Œè¿™é‡Œä¸å†é‡å¤ã€‚æ€»ä¹‹ï¼Œæˆ‘ä»¬å¸Œæœ›MLAä¹Ÿèƒ½æœ‰ç±»ä¼¼QK-Normçš„èƒ½å¤Ÿä¿è¯å‹åˆ¶MaxLogitçš„æ‰‹æ®µã€‚</p>
<h2 id="_3">ç›´å‡»ç›®æ ‡</h2>
<p>æœŸé—´æˆ‘ä»¬è¿˜å°è¯•äº†ä¸€äº›é—´æ¥æ‰‹æ®µï¼Œæ¯”å¦‚å•ç‹¬é™ä½$\boldsymbol{Q},\boldsymbol{K}$çš„å­¦ä¹ ç‡ã€å•ç‹¬å¢å¤§å®ƒä»¬çš„Weight Decayç­‰ï¼Œä½†éƒ½ä¸å¥æ•ˆã€‚æœ€æ¥è¿‘æˆåŠŸçš„ä¸€æ¬¡æ˜¯Partial QK-Normï¼Œå¯¹äºMLAæ¥è¯´ï¼Œå®ƒçš„$\boldsymbol{Q},\boldsymbol{K}$åˆ†ä¸ºqrã€qcã€krã€kcå››ä¸ªéƒ¨åˆ†ï¼Œå…¶ä¸­å‰ä¸‰éƒ¨åˆ†åœ¨Decodingæ—¶éƒ½æ˜¯å¯ä»¥Materializeçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»™è¿™ä¸‰éƒ¨åˆ†éƒ½åŠ ä¸ŠRMSNormï¼Œç»“æœæ˜¯å¯ä»¥å‹åˆ¶MaxLogitï¼Œä½†é•¿åº¦æ¿€æ´»æ•ˆæœéå¸¸ç³Ÿç³•ã€‚</p>
<p>åœ¨å¤±è´¥å¤šæ¬¡ä¹‹åï¼Œæˆ‘ä»¬ä¸ç¦å¼€å§‹åæ€ï¼šå‰é¢æˆ‘ä»¬çš„å°è¯•å…¶å®éƒ½åªæ˜¯å‹åˆ¶MaxLogitçš„â€œé—´æ¥æ‰‹æ®µâ€ï¼ŒçœŸæ­£èƒ½ä¿è¯è§£å†³MaxLogitçˆ†ç‚¸çš„ç›´æ¥æ‰‹æ®µæ˜¯ä»€ä¹ˆï¼Ÿä»ä¸ç­‰å¼$\eqref{eq:kexi}$æˆ‘ä»¬ä¸éš¾è”æƒ³åˆ°å¯ä»¥å¯¹$\boldsymbol{W}_q,\boldsymbol{W}_k$åš<a href="/archives/11006">å¥‡å¼‚å€¼è£å‰ª</a>ï¼Œä½†è¿™æœ¬è´¨ä¸Šè¿˜æ˜¯é—´æ¥æ‰‹æ®µï¼Œè€Œä¸”å¥‡å¼‚å€¼è£å‰ªçš„è®¡ç®—æˆæœ¬ä¹Ÿä¸ä½ã€‚</p>
<p>ä½†å¾ˆæ˜æ˜¾ï¼Œå¯¹$\boldsymbol{W}<em>q,\boldsymbol{W}_k$è¿›è¡Œäº‹åç¼©æ”¾ç†è®ºä¸Šæ˜¯å¯è¡Œçš„ï¼Œé—®é¢˜æ˜¯ _ä»€ä¹ˆæ—¶å€™ç¼©æ”¾ã€ç¼©æ”¾å¤šå°‘</em> ã€‚ç»ˆäºï¼ŒæŸå¤©ç¦è‡³å¿ƒçµä¹‹ä¸‹ï¼Œç¬”è€…æ€»ç®—ååº”è¿‡æ¥ï¼š<strong>MaxLogitæœ¬èº«å°±æ˜¯è§¦å‘ç¼©æ”¾çš„æœ€ç›´æ¥ä¿¡å·ï¼</strong> å…·ä½“æ¥è¯´ï¼Œå½“MaxLogitè¶…è¿‡æœŸæœ›é˜ˆå€¼$\tau$æ—¶ï¼Œæˆ‘ä»¬ç›´æ¥ç»™$\boldsymbol{Q}\boldsymbol{K}^{\top}$ä¹˜ä¸Š$\gamma = \tau / S_{\max}$ï¼Œé‚£ä¹ˆæ–°çš„MaxLogitè‚¯å®šå°±ä¸è¶…è¿‡$\tau$äº†ã€‚ä¹˜$\gamma$çš„æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥åˆ†åˆ«å¸æ”¶åˆ°æƒé‡$\boldsymbol{Q}\boldsymbol{K}$çš„æƒé‡ä¸Šå»ï¼Œäºæ˜¯æˆ‘ä»¬å¾—åˆ°åˆç‰ˆQK-Clipï¼š<br />
$$\begin{aligned}  
&\boldsymbol{W}_t = \text{Optimizer}(\boldsymbol{W}_{t-1}, \boldsymbol{G}_t) \\\  
&\text{if }S_{\max}^{(l)} > \tau\text{ and }\boldsymbol{W} \in \\{\boldsymbol{W}_q^{(l)}, \boldsymbol{W}_k^{(l)}\\}: \\\  
&\qquad\boldsymbol{W}_t \leftarrow \boldsymbol{W}_t \times \sqrt{\tau / S_{\max}^{(l)}}  
\end{aligned}$$</p>
<p>å…¶ä¸­$S_{\max}^{(l)}$æ˜¯ç¬¬$l$å±‚Attentionçš„MaxLogitï¼Œ$\boldsymbol{W}<em _max="\max">q^{(l)}, \boldsymbol{W}_k^{(l)}$æ˜¯å®ƒ$\boldsymbol{Q},\boldsymbol{K}$çš„æƒé‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¼˜åŒ–å™¨æ›´æ–°ä¹‹åï¼Œæ ¹æ®$S</em>$ä¸é˜ˆå€¼$\tau$çš„æ¯”ä¾‹æ¥å†³å®šï¼Œç›´æ¥ä¿è¯è£å‰ªåçš„çŸ©é˜µä¸å†MaxLogitçˆ†ç‚¸ã€‚åŒæ—¶ï¼Œç”±äºæ˜¯ç›´æ¥å¯¹æƒé‡è¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥ä¸å½±å“æ¨ç†æ¨¡å¼ï¼Œè‡ªç„¶ä¹Ÿå°±å…¼å®¹MLAäº†ã€‚}^{(l)}$çš„å¤§å°æ¥å†³å®šæ˜¯å¦å¯¹$\boldsymbol{Q},\boldsymbol{K}$çš„æƒé‡è¿›è¡Œè£å‰ªï¼Œè£å‰ªçš„å¹…åº¦ç›´æ¥ç”±$S_{\max}^{(l)</p>
<h2 id="_4">ç²¾ç»†è°ƒæ•´</h2>
<p>åˆç‰ˆQK-Clipç¡®å®å·²ç»èƒ½æˆåŠŸå‹åˆ¶MLAçš„MaxLogitï¼Œä½†ç»è¿‡ä»”ç»†è§‚å¯Ÿæ¨¡å‹çš„â€œå†…ç§‘â€åï¼Œæˆ‘ä»¬å‘ç°å®ƒä¼šå‡ºç°â€œè¿‡åº¦è£å‰ªâ€çš„é—®é¢˜ï¼Œä¿®å¤è¯¥é—®é¢˜åå°±å¾—åˆ°æœ€ç»ˆç‰ˆQK-Clipã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œä¸ç®¡å“ªç§Attentionå˜ä½“éƒ½æœ‰å¤šä¸ªHeadï¼Œä¸€å¼€å§‹æˆ‘ä»¬æ˜¯æ¯ä¸€å±‚Attentionåªç›‘æ§ä¸€ä¸ªMaxLogitæŒ‡æ ‡ï¼Œæ‰€æœ‰Headçš„Logitæ˜¯æ”¾åœ¨ä¸€èµ·å–Maxçš„ï¼Œè¿™å¯¼è‡´QK-Clipä¹Ÿæ˜¯æ‰€æœ‰Headä¸€èµ·Clipçš„ã€‚ç„¶è€Œï¼Œå½“æˆ‘ä»¬åˆ†åˆ«ç›‘æ§æ¯ä¸ªHeadçš„MaxLogitåå‘ç°ï¼Œå®é™…ä¸Šæ¯å±‚åªæœ‰ä¸ºæ•°ä¸å¤šçš„Headä¼šå‡ºç°MaxLogitçˆ†ç‚¸ï¼Œå¦‚æœæ‰€æœ‰HeadæŒ‰åŒä¸€ä¸ªæ¯”ä¾‹æ¥Clipï¼Œé‚£ä¹ˆå¤§éƒ¨ä»½Headéƒ½æ˜¯è¢«â€œæ— è¾œå—ç´¯â€çš„äº†ï¼Œè¿™å°±æ˜¯è¿‡åº¦è£å‰ªçš„å«ä¹‰ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼ŒQK-Clipçš„æ“ä½œæ˜¯ä¹˜ä»¥ä¸€ä¸ªå°äº1çš„æ•°ï¼Œè¿™ä¸ªæ•°å¯¹äºMaxLogitçˆ†ç‚¸çš„Headæ¥è¯´æ˜¯åˆšåˆšå¥½æŠµæ¶ˆå¢é•¿è¶‹åŠ¿ï¼Œä½†æ˜¯å¯¹äºå…¶ä»–headæ¥è¯´æ˜¯å•çº¯çš„ç¼©å°ï¼ˆå®ƒä»¬æ²¡æœ‰å¢é•¿è¶‹åŠ¿æˆ–è€…å¢é•¿è¶‹åŠ¿å¾ˆå¼±ï¼‰ã€‚ç”±äºé•¿æœŸæ— ç«¯è¢«ä¹˜ä¸€ä¸ªå°äº1çš„æ•°ï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“å‡ºç°å°±è¶‹äºé›¶çš„ç°è±¡ï¼Œè¿™æ˜¯â€œè¿‡åº¦è£å‰ªâ€çš„è¡¨ç°ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸ºäº†é¿å…â€œæ®ƒåŠæ± é±¼â€ï¼Œæˆ‘ä»¬åº”è¯¥Per-Headåœ°è¿›è¡Œç›‘æ§MaxLogitå’ŒQK-Clipã€‚ä¸è¿‡è¿™é‡Œè¾¹åˆéšè—äº†å¦ä¸€ä¸ªé­”é¬¼ç»†èŠ‚ï¼šåˆç‰ˆQK-Clipæ˜¯å°†Clipå› å­å¹³æ‘Šåˆ°$\boldsymbol{Q},\boldsymbol{K}$ä¸Šçš„ï¼Œä½†æ˜¯MLAçš„$\boldsymbol{Q},\boldsymbol{K}$æœ‰qrã€qcã€krã€kcå››éƒ¨åˆ†ï¼Œå…¶ä¸­kræ˜¯æ‰€æœ‰Headå…±äº«çš„ï¼Œå¦‚æœå¯¹å®ƒClipï¼Œé‚£ä¹ˆåŒæ ·ä¼šæœ‰â€œæ®ƒåŠæ± é±¼â€çš„é—®é¢˜ã€‚å› æ­¤ï¼Œå¯¹äº(qr, kr)ï¼Œæˆ‘ä»¬åº”è¯¥åªClipåˆ°qrä¸Šå»ã€‚</p>
<p>ç»è¿‡ä¸Šè¿°è°ƒæ•´ï¼Œæœ€ç»ˆç‰ˆçš„QK-Clipä¸º<br />
$$\begin{aligned}  
&\boldsymbol{W}_t = \text{Optimizer}(\boldsymbol{W}_{t-1}, \boldsymbol{G}_t) \\\  
&\text{if }S_{\max}^{(l,h)} > \tau: \\\  
&\qquad\text{if }\boldsymbol{W} \in \\{\boldsymbol{W}_{qc}^{(l,h)}, \boldsymbol{W}_{kc}^{(l,h)}\\}: \\\  
&\qquad\qquad\boldsymbol{W}_t \leftarrow \boldsymbol{W}_t \times \sqrt{\tau / S_{\max}^{(l,h)}} \\\  
&\qquad\text{elif }\boldsymbol{W} \in \\{\boldsymbol{W}_{qr}^{(l,h)}\\}: \\\  
&\qquad\qquad\boldsymbol{W}_t \leftarrow \boldsymbol{W}_t \times \tau / S_{\max}^{(l,h)}  
\end{aligned}$$<br />
å…¶ä¸­ä¸Šæ ‡${}^{(l,h)}$è¡¨ç¤ºç¬¬$l$å±‚ã€ç¬¬$h$ä¸ªHeadã€‚</p>
<h2 id="_5">æ‰©å±•ä¹‹è·¯</h2>
<p>è‡³æ­¤ï¼ŒQK-Clipçš„æ“ä½œç»†èŠ‚å·²ç»ä»‹ç»å®Œæ¯•ï¼Œå®ƒç›´æ¥ä»¥æˆ‘ä»¬æœŸæœ›çš„MaxLogitä¸ºä¿¡å·ï¼Œå¯¹$\boldsymbol{Q},\boldsymbol{K}$çš„æƒé‡è¿›è¡Œå°½å¯èƒ½å°çš„æ”¹åŠ¨ï¼Œè¾¾åˆ°äº†å°†MaxLogitå€¼æ§åˆ¶åœ¨æŒ‡å®šé˜ˆå€¼å†…çš„æ•ˆæœã€‚åŒæ—¶å› ä¸ºè¿™æ˜¯ç›´æ¥å¯¹æƒé‡è¿›è¡Œä¿®æ”¹çš„æ–¹æ³•ï¼Œæ‰€ä»¥å®ƒå…¼å®¹æ€§æ¯”QK-Normæ›´å¥½ï¼Œå¯ä»¥ç”¨äºMLAã€‚</p>
<p>åœ¨Kimi K2çš„è®­ç»ƒä¸­ï¼Œæˆ‘ä»¬è®¾ç½®é˜ˆå€¼$\tau$ä¸º100ï¼Œæ€»è®­ç»ƒæ­¥æ•°çº¦ä¸º220k stepsï¼Œä»å¤§è‡´7k stepså¼€å§‹ï¼Œå°±å‡ºç°äº†MaxLogitè¶…è¿‡$\tau$çš„Headï¼Œæ­¤ååœ¨ç›¸å½“é•¿çš„æ—¶é—´å†…ï¼ŒMuon Updateå’ŒQK-Clipéƒ½åœ¨â€œæ‹‰é”¯æˆ˜â€ï¼Œå³Muonæƒ³è¦å¢åŠ MaxLogitè€ŒQK-Clipæƒ³è¦é™ä½MaxLogitï¼Œå®ƒä»¬ä¸€ç›´å¤„äºå¾®å¦™çš„å¹³è¡¡çŠ¶æ€ã€‚æœ‰è¶£çš„æ˜¯ï¼Œ70k stepsä¹‹åï¼Œæ‰€æœ‰Headçš„MaxLogitéƒ½ä¸»åŠ¨é™ä½åˆ°äº†100ä»¥ä¸‹ï¼ŒQK-Clipä¸å†ç”Ÿæ•ˆã€‚</p>
<p><a href="/usr/uploads/2025/07/550205001.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="ç»è¿‡æ¥è¿‘70k stepsçš„Muonå’ŒQK-Clipæ‹‰é”¯æˆ˜åï¼ŒMaxLogit ä¸»åŠ¨é™äº†ä¸‹æ¥" src="/usr/uploads/2025/07/550205001.png" /></a></p>
<p>ç»è¿‡æ¥è¿‘70k stepsçš„Muonå’ŒQK-Clipæ‹‰é”¯æˆ˜åï¼ŒMaxLogit ä¸»åŠ¨é™äº†ä¸‹æ¥</p>
<p>è¿™è¡¨æ˜ï¼Œåœ¨Weight Decayçš„ä½œç”¨ä¸‹ï¼Œåªè¦æˆ‘ä»¬èƒ½ç¨³ä½è®­ç»ƒï¼Œæ¨¡å‹æœ€åå¾ˆå¯èƒ½éƒ½ä¼šä¸»åŠ¨å°†MaxLogité™ä¸‹æ¥ï¼ŒQK-Clipçš„ä½œç”¨ï¼Œæ­£æ˜¯å¸®åŠ©æ¨¡å‹æ›´å¹³ç¨³åœ°åº¦è¿‡è®­ç»ƒåˆæœŸã€‚å¯èƒ½æœ‰è¯»è€…æ‹…å¿ƒQK-Clipä¼šæœ‰æŸæ•ˆæœï¼Œä½†æˆ‘ä»¬åœ¨å°æ¨¡å‹ä¸Šåšäº†å¯¹æ¯”å®éªŒï¼Œå³ä¾¿é€šè¿‡QK-Clipå°†MaxLogitå‹å¾—ç‰¹åˆ«å°ï¼ˆæ¯”å¦‚30ï¼‰ï¼Œä¹Ÿæ²¡æœ‰è§‚å¯Ÿåˆ°æ•ˆæœæœ‰å®è´¨åŒºåˆ«ï¼Œå†åŠ ä¸Šä¸­åæœŸæ¨¡å‹ä¼šä¸»åŠ¨å°†MaxLogité™ä¸‹æ¥çš„è¿™ä¸€ç°è±¡ï¼Œæˆ‘ä»¬æœ‰ç†ç”±ç›¸ä¿¡QK-Clipå¯¹æ•ˆæœæ˜¯æ— æŸçš„ã€‚</p>
<p>æˆ‘ä»¬åœ¨å®éªŒä¸­ä¹Ÿè§‚å¯Ÿåˆ°ï¼ŒMuonæ™®éæ¯”Adamæ›´å®¹æ˜“MaxLogitçˆ†ç‚¸ï¼Œæ‰€ä»¥æŸç§ç¨‹åº¦ä¸Šæ¥è¯´ï¼ŒQK-Clipæ˜¯ä¸“é—¨ä¸ºMuonè¡¥å……çš„æ›´æ–°è§„åˆ™ï¼Œå®ƒæ˜¯Muonåœ¨è¶…å¤§è§„æ¨¡è®­ç»ƒä¸Šçš„â€œé€šå…³ç§˜ç¬ˆâ€ä¹‹ä¸€ï¼Œè¿™ä¹Ÿæ˜¯æœ¬æ–‡æ ‡é¢˜çš„å«ä¹‰ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†æˆ‘ä»¬Moonlightä¸­æ‰€æçš„Muonæ”¹åŠ¨è·ŸQK-Clipç»„åˆèµ·æ¥ï¼Œèµ·äº†ä¸ªâ€œMuonClipâ€çš„åå­—ï¼ˆ$\boldsymbol{W}\in\mathbb{R}^{n\times m}$ï¼‰ï¼š<br />
$$\text{MuonClip}\quad\left\\{\quad\begin{aligned}  
&\boldsymbol{M}_t = \mu \boldsymbol{M}_{tâˆ’1} + \boldsymbol{G}_t \\\\[8pt]  
&\boldsymbol{O}_t = \newcommand{msign}{\mathop{\text{msign}}}\msign(\boldsymbol{M}_t) \underbrace{\times \sqrt{\max(n,m)}\times 0.2}_{\text{Match Adam Update RMS}} \\\\[8pt]  
&\boldsymbol{W}_t = \boldsymbol{W}_{tâˆ’1} âˆ’ \eta_t (\boldsymbol{O}_t + \lambda \boldsymbol{W}_{t-1}) \\\\[8pt]  
&\left.\begin{aligned}  
&\text{if }S_{\max}^{(l,h)} > \tau: \\\  
&\qquad\text{if }\boldsymbol{W} \in \\{\boldsymbol{W}_{qc}^{(l,h)}, \boldsymbol{W}_{kc}^{(l,h)}\\}: \\\  
&\qquad\qquad\boldsymbol{W}_t \leftarrow \boldsymbol{W}_t \times \sqrt{\tau / S_{\max}^{(l,h)}} \\\  
&\qquad\text{elif }\boldsymbol{W} \in \\{\boldsymbol{W}_{qr}^{(l,h)}\\}: \\\  
&\qquad\qquad\boldsymbol{W}_t \leftarrow \boldsymbol{W}_t \times \tau / S_{\max}^{(l,h)}  
\end{aligned}\quad\right\\} \text{QK-Clip}  
\end{aligned}\right.$$</p>
<p>æ³¨æ„ï¼Œâ€œMuonæ™®éæ¯”Adamæ›´å®¹æ˜“MaxLogitçˆ†ç‚¸â€å¹¶ä¸æ„å‘³ç€åªæœ‰Muonä¼šMaxLogitçˆ†ç‚¸ï¼Œæˆ‘ä»¬çŸ¥é“<a href="https://papers.cool/arxiv/2412.19437">DeepSeek-V3</a>æ˜¯Adamè®­ç»ƒçš„ï¼Œè€Œæˆ‘ä»¬ä»DeepSeek-V3çš„å¼€æºæ¨¡å‹ä¸­ä¹Ÿè§‚å¯Ÿåˆ°äº†MaxLogitçˆ†ç‚¸ç°è±¡ï¼Œè¿˜æœ‰Gemma2ç”¨$\text{softcap}$é˜²æ­¢MaxLogitçˆ†ç‚¸ï¼Œå®ƒä¹Ÿæ˜¯Adamè®­çš„ã€‚å› æ­¤ï¼Œè™½ç„¶æˆ‘ä»¬å¼ºè°ƒäº†QK-Clipå¯¹Muonçš„ä»·å€¼ï¼Œä½†å¦‚æœè¯»è€…åšæŒç”¨Adamï¼Œé‚£ä¹ˆå®ƒä¹Ÿæ˜¯å¯ä»¥è·ŸAdamç»“åˆæˆAdamClipçš„ã€‚</p>
<h2 id="_6">åŸå› æ€è€ƒ</h2>
<p>ä¸ºä»€ä¹ˆMuonæ›´å®¹æ˜“å¯¼è‡´MaxLogitçˆ†ç‚¸å‘¢ï¼Ÿè¿™ä¸€èŠ‚ç¬”è€…å°è¯•ç»™å‡ºä¸€ä¸ªç†è®ºè§’åº¦çš„è§£é‡Šï¼Œä¾›å¤§å®¶å‚è€ƒã€‚</p>
<p>ä»ä¸ç­‰å¼$\eqref{eq:kexi}$å¯ä»¥çœ‹å‡ºï¼ŒMaxLogitçˆ†ç‚¸å¾€å¾€æ„å‘³ç€$\boldsymbol{W}_q$æˆ–$\boldsymbol{W}_k$çš„è°±èŒƒæ•°å‡ºç°çˆ†ç‚¸çš„è¿¹è±¡ï¼Œå®é™…ä¸Šè°±èŒƒæ•°çš„å®šä¹‰ä¸­ä¹ŸåŒ…å«äº†å–$\max$æ“ä½œï¼Œä¸¤è€…æœ¬è´¨ä¸Šæ˜¯ç›¸é€šçš„ã€‚å› æ­¤ï¼Œé—®é¢˜å¯ä»¥è½¬åŒ–ä¸ºâ€œä¸ºä»€ä¹ˆMuonæ›´å®¹æ˜“å¯¼è‡´è°±èŒƒæ•°çˆ†ç‚¸â€ã€‚æˆ‘ä»¬çŸ¥é“è°±èŒƒæ•°ç­‰äºæœ€å¤§çš„å¥‡å¼‚å€¼ï¼Œæ‰€ä»¥åˆå¯ä»¥è¿›ä¸€æ­¥è”æƒ³åˆ°â€œä¸ºä»€ä¹ˆMuonæ›´å€¾å‘äºå¢å¤§å¥‡å¼‚å€¼â€ã€‚</p>
<p>Muonå’ŒAdamçš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼ŸMuonç»™å‡ºçš„æ›´æ–°é‡æ˜¯ç»è¿‡$\msign$è¿ç®—çš„ï¼Œæ‰€æœ‰å¥‡å¼‚å€¼éƒ½ç›¸ç­‰ï¼Œå³å®ƒçš„<a href="/archives/10847">æœ‰æ•ˆç§©</a>æ˜¯<strong>æ»¡ç§©</strong> ï¼›è€Œä¸€èˆ¬æƒ…å†µä¸‹çš„çŸ©é˜µï¼Œå¥‡å¼‚å€¼é€šå¸¸éƒ½æ˜¯æœ‰å¤§æœ‰å°ï¼Œå¹¶ä¸”ä»¥å‰é¢å‡ ä¸ªå¥‡å¼‚å€¼ä¸ºä¸»ï¼Œä»<a href="/archives/10847">æœ‰æ•ˆç§©</a>çš„è§’åº¦çœ‹å®ƒä»¬æ˜¯<strong>ä½ç§©</strong> çš„ï¼Œæˆ‘ä»¬å¯¹Adamæ›´æ–°é‡çš„å‡è®¾ä¹Ÿæ˜¯å¦‚æ­¤ã€‚è¿™ä¸ªå‡è®¾å¹¶ä¸æ–°é²œï¼Œæ¯”å¦‚<a href="/archives/10795">é«˜é˜¶MuP</a>åŒæ ·å‡è®¾äº†Adamæ›´æ–°é‡çš„ä½ç§©æ€§ã€‚</p>
<p>ç”¨å…¬å¼æ¥è¯´ï¼Œæˆ‘ä»¬è®¾å‚æ•°$\boldsymbol{W}_{t-1}$çš„SVDä¸º$\sum_i \sigma_i \boldsymbol{u}_i \boldsymbol{v}_i^{\top}$ï¼ŒMuonæ›´æ–°é‡çš„SVDä¸º$\sum_j \bar{\sigma}\bar{\boldsymbol{u}}_j \bar{\boldsymbol{v}}_j^{\top}$ï¼ŒAdamæ›´æ–°é‡çš„SVDä¸º$\sum_j \tilde{\sigma}_j\tilde{\boldsymbol{u}}_j \tilde{\boldsymbol{v}}_j^{\top}$ï¼Œé‚£ä¹ˆ<br />
\begin{gather}<br />
\boldsymbol{W}_t = \sum_i \sigma_i \boldsymbol{u}_i \boldsymbol{v}_i^{\top} + \sum_j \bar{\sigma}\bar{\boldsymbol{u}}_j \bar{\boldsymbol{v}}_j^{\top}\qquad (\text{Muon}) \\\<br />
\boldsymbol{W}_t = \sum_i \sigma_i \boldsymbol{u}_i \boldsymbol{v}_i^{\top} + \sum_j \tilde{\sigma}_j\tilde{\boldsymbol{u}}_j \tilde{\boldsymbol{v}}_j^{\top}\qquad (\text{Adam}) \\\<br />
\end{gather}</p>
<p>å¾ˆæ˜æ˜¾ï¼Œå¦‚æœå¥‡å¼‚å‘é‡å¯¹$\boldsymbol{u}<em t-1="t-1">i \boldsymbol{v}_i^{\top}$è·ŸæŸä¸ª$\bar{\boldsymbol{u}}_j \bar{\boldsymbol{v}}_j^{\top}$æˆ–$\tilde{\boldsymbol{u}}_j \tilde{\boldsymbol{v}}_j^{\top}$å¾ˆæ¥è¿‘ï¼Œé‚£å®ƒä»¬å°†ä¼šç›´æ¥å åŠ èµ·æ¥ï¼Œä»è€Œå¢å¤§$\boldsymbol{W}_t$çš„å¥‡å¼‚å€¼ã€‚ç”±äºMuonçš„æ›´æ–°é‡æ˜¯æ»¡ç§©çš„ï¼Œæ‰€ä»¥å®ƒä¸$\boldsymbol{W}</em>$çš„â€œç¢°æ’å‡ ç‡â€ä¼šè¿œå¤§äºAdamçš„ï¼Œæ‰€ä»¥Muonæ›´å®¹æ˜“å¢å¤§å‚æ•°çš„å¥‡å¼‚å€¼ã€‚</p>
<p>å½“ç„¶ï¼Œä¸Šè¿°åˆ†ææ˜¯é€šç”¨çš„ï¼Œä¸é™äº$\boldsymbol{Q},\boldsymbol{K}$çš„æƒé‡ï¼Œå®é™…ä¸Šåœ¨Moonlightä¸­æˆ‘ä»¬å·²ç»éªŒè¯è¿‡ï¼ŒMuonè®­å‡ºæ¥çš„æ¨¡å‹æƒé‡çš„å¥‡å¼‚å€¼ç†µæ™®éæ›´é«˜ï¼Œè¿™ä¹Ÿä½è¯äº†ä¸Šè¿°çŒœæµ‹ã€‚Attention Logitçš„ç‰¹æ®Šä¹‹å¤„åœ¨äºï¼Œå®ƒæ˜¯åŒçº¿æ€§å½¢å¼$\boldsymbol{q}_i\cdot \boldsymbol{k}_j = (\boldsymbol{x}_i \boldsymbol{W}_q)\cdot(\boldsymbol{x}_j \boldsymbol{W}_k)$ï¼Œ$\boldsymbol{W}_q,\boldsymbol{W}_k$çš„è¿ä¹˜ä½¿å¾—çˆ†ç‚¸çš„é£é™©æ›´å¤§ï¼Œè¿˜å®¹æ˜“å¯¼è‡´â€œç³Ÿçš„æ›´ç³Ÿâ€çš„æ¶æ€§å¾ªç¯ï¼Œæœ€ç»ˆä¿ƒæˆäº†MaxLogitçˆ†ç‚¸ã€‚</p>
<p><a href="/usr/uploads/2025/07/1022731099.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="Muonä¸Adamè®­ç»ƒçš„æ¨¡å‹æƒé‡å¥‡å¼‚å€¼ç†µï¼ˆç­‰ä»·äºæœ‰æ•ˆç§©ï¼‰æ¯”è¾ƒ" src="/usr/uploads/2025/07/1022731099.png" /></a></p>
<p>Muonä¸Adamè®­ç»ƒçš„æ¨¡å‹æƒé‡å¥‡å¼‚å€¼ç†µï¼ˆç­‰ä»·äºæœ‰æ•ˆç§©ï¼‰æ¯”è¾ƒ</p>
<p>æœ€åå°±æ˜¯â€œMuonçš„ç¢°æ’å‡ ç‡è¿œå¤§äºAdamâ€æ˜¯ç›¸å¯¹è€Œè¨€çš„ï¼Œå®é™…ä¸Šå¥‡å¼‚å‘é‡ç¢°æ’åœ¨ä¸€å—è¿˜æ˜¯å°æ¦‚ç‡äº‹ä»¶ï¼Œè¿™ä¹Ÿå°±èƒ½è§£é‡Šä¸ºå•¥åªæœ‰å°éƒ¨ä»½Attention Headä¼šæœ‰MaxLogitçˆ†ç‚¸ç°è±¡äº†ã€‚</p>
<p>è¿™ä¸ªè§†è§’è¿˜å¯ä»¥è§£é‡Šä¹‹å‰Moonlightçš„ä¸€ä¸ªç°è±¡ï¼šç”¨Muon/Adamé¢„è®­ç»ƒçš„æ¨¡å‹ï¼Œåè¿‡æ¥ç”¨Adam/Muonå¾®è°ƒï¼Œç»“æœé€šå¸¸æ˜¯æ¬¡ä¼˜çš„ã€‚å› ä¸ºMuonçš„è®­ç»ƒæƒé‡æœ‰æ•ˆç§©æ›´é«˜ï¼Œè€ŒAdamçš„æ›´æ–°é‡æ˜¯ä½ç§©çš„ï¼Œä¸€é«˜ä¸€ä½ä¹‹ä¸‹ï¼Œå¾®è°ƒæ•ˆç‡å°±å˜å·®äº†ï¼›åä¹‹ï¼ŒAdamçš„è®­ç»ƒæƒé‡æœ‰æ•ˆç§©æ›´ä½ï¼Œä½†Muonçš„æ›´æ–°é‡æ˜¯æ»¡ç§©çš„ï¼Œå®ƒæœ‰æ›´å¤§æ¦‚ç‡å»å¹²é¢„é‚£äº›å°å¥‡å¼‚å€¼åˆ†é‡ï¼Œè®©æ¨¡å‹åç¦»é¢„è®­ç»ƒçš„ä½ç§©å±€éƒ¨æœ€ä¼˜ç‚¹ï¼Œä»è€Œå½±å“å¾®è°ƒæ•ˆç‡ã€‚</p>
<h2 id="_7">ä¸€äº›å»¶ä¼¸</h2>
<p>å†™åˆ°è¿™é‡Œï¼Œå…³äºQK-Clipæ¯”è¾ƒé‡è¦è®¡ç®—å’Œå®éªŒç»†èŠ‚åº”è¯¥éƒ½è®²æ¸…æ¥šäº†ã€‚å¦å¤–è¿˜éœ€è¦æé†’çš„æ˜¯ï¼ŒQK-Clipæ€æƒ³å¾ˆç®€å•ï¼Œä½†ç”±äºéœ€è¦Per-Headæ¥Clipï¼Œå› æ­¤åœ¨åˆ†å¸ƒå¼è®­ç»ƒä¸­å†™èµ·æ¥è¿˜æ˜¯ç•¥å¾®æœ‰ç‚¹éš¾åº¦çš„ï¼Œå› ä¸ºæ­¤æ—¶çš„å‚æ•°çŸ©é˜µå¾€å¾€è¢«åˆ‡åˆ†å¾—â€œæ”¯ç¦»ç ´ç¢â€ï¼ˆåœ¨MuonåŸºç¡€ä¸Šæ”¹èµ·æ¥ä¸ç®—éš¾ï¼Œåœ¨AdamåŸºç¡€ä¸Šæ”¹åˆ™ç¨æ˜¾å¤æ‚ï¼‰ã€‚</p>
<p>å¯¹äºç¬”è€…åŠå…¶å›¢é˜Ÿæ¥è¯´ï¼ŒQK-Clipä¸å•å•æ˜¯è§£å†³MaxLogitçˆ†ç‚¸é—®é¢˜çš„ä¸€ä¸ªå…·ä½“æ–¹æ³•ï¼Œè¿˜æ˜¯åå¤å°è¯•é€šè¿‡é—´æ¥æ‰‹æ®µæ¥è§£å†³é—®é¢˜ä¸”å¤±è´¥åçš„ä¸€æ¬¡â€å¹¡ç„¶é†’æ‚Ÿâ€œï¼š<strong>æ—¢ç„¶æœ‰äº†æ˜ç¡®çš„åº¦é‡æŒ‡æ ‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å¯»æ±‚èƒ½å¤Ÿä¿è¯è§£å†³é—®é¢˜çš„ç›´æ¥æ€è·¯ï¼Œè€Œä¸æ˜¯åœ¨é™ä½LRã€å¢å¤§Weight Decayã€éƒ¨åˆ†QK-Normç­‰ <em>å¯èƒ½ä½†ä¸ä¸€å®šèƒ½</em> è§£å†³é—®é¢˜çš„æ€è·¯ä¸Šæµªè´¹æ—¶é—´ã€‚</strong></p>
<p>ä»æ–¹æ³•ä¸Šæ¥çœ‹ï¼ŒQK-Clipçš„æ€è·¯ä¹Ÿä¸é™äºè§£å†³MaxLogitçˆ†ç‚¸ï¼Œå®ƒå¯ä»¥è¯´æ˜¯è§£å†³å¾ˆå¤šè®­ç»ƒä¸ç¨³å®šé—®é¢˜çš„â€œæŠ—ç”Ÿç´ â€ã€‚æ‰€è°“æŠ—ç”Ÿç´ ï¼ŒæŒ‡çš„æ˜¯å®ƒä¹Ÿè®¸å¹¶ä¸æ˜¯è§£å†³é—®é¢˜æœ€ç²¾å¦™çš„æ–¹æ³•ï¼Œä½†å¾€å¾€æ˜¯è§£å†³é—®é¢˜æœ€ç›´æ¥æœ‰æ•ˆçš„æ–¹æ³•ä¹‹ä¸€ï¼ŒQK-Clipæ­£æ˜¯å…·æœ‰è¿™ä¸ªç‰¹ç‚¹ï¼Œå®ƒå¯ä»¥ä¸€èˆ¬åœ°æ¨å¹¿æˆâ€œå“ªé‡Œä¸ç¨³Clipå“ªé‡Œâ€ã€‚</p>
<p>æ¯”å¦‚ï¼Œæœ‰äº›æƒ…å†µä¸‹æ¨¡å‹ä¼šå‡ºç°â€œMaxOutputçˆ†ç‚¸â€çš„é—®é¢˜ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥è€ƒè™‘æ ¹æ®MaxOutputçš„å€¼æ¥Clipæƒé‡$\boldsymbol{W}_o$ã€‚ç±»æ¯”QK-Clipçš„Per-Headæ“ä½œï¼Œè¿™é‡Œæˆ‘ä»¬ä¹Ÿéœ€è¦è€ƒè™‘Per-Dimæ“ä½œï¼Œä½†Per-Dim Clipçš„æˆæœ¬æ˜¾ç„¶å¤ªå¤§ï¼Œå¯èƒ½éœ€è¦æŠ˜ä¸­ä¸€ä¸‹ã€‚æ€»ä¹‹ï¼Œâ€œå“ªé‡Œä¸ç¨³Clipå“ªé‡Œâ€æä¾›äº†ç»Ÿä¸€çš„è§£å†³æ€è·¯ï¼Œä½†å…·ä½“ç»†èŠ‚å°±è¦çœ‹å¤§å®¶å‘æŒ¥äº†ã€‚</p>
<p>æœ€åï¼ŒQK-Clipè¿™ç§æ ¹æ®æŸäº›ä¿¡å·æ‰‹åŠ¨åˆ¶å®šæ›´æ–°è§„åˆ™çš„æ“ä½œï¼Œä¸€å®šç¨‹åº¦ä¸Šæ˜¯å—åˆ°äº†DeepSeekçš„<a href="/archives/10757">Loss-Free</a>è´Ÿè½½å‡è¡¡ç­–ç•¥çš„å¯å‘è€Œæ‚Ÿåˆ°çš„ï¼Œè¿™é‡Œå†æ¬¡è‡´æ•¬DeepSeekï¼</p>
<h2 id="_8">æ–‡ç« å°ç»“</h2>
<p>æœ¬æ–‡æå‡ºäº†QK-Clipï¼Œå®ƒæ˜¯MaxLogitçˆ†ç‚¸é—®é¢˜çš„ä¸€ç§æ–°æ€è·¯ï¼Œè·ŸQK-Normä¸åŒï¼Œå®ƒæ˜¯å¯¹Qã€Kæƒé‡çš„ä¸€ç§äº‹åè°ƒæ•´æ–¹æ¡ˆï¼Œå¹¶ä¸æ”¹å˜æ¨¡å‹çš„å‰å‘è®¡ç®—ï¼Œå› æ­¤é€‚ç”¨æ€§æ›´å¹¿ï¼Œå®ƒæ˜¯â€œMuon + MLAâ€ç»„åˆåœ¨è¶…å¤§è§„æ¨¡è®­ç»ƒä¸Šçš„é‡è¦ç¨³å®šç­–ç•¥ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æœ€æ–°å‘å¸ƒçš„ä¸‡äº¿æ¨¡å‹Kimi K2çš„å…³é”®æŠ€æœ¯ä¹‹ä¸€ã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/11126">https://spaces.ac.cn/archives/11126</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Jul. 12, 2025). ã€ŠQK-Clipï¼šè®©Muonåœ¨Scaleupä¹‹è·¯ä¸Šæ›´è¿›ä¸€æ­¥ ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/11126">https://spaces.ac.cn/archives/11126</a></p>
<p>@online{kexuefm-11126,<br />
title={QK-Clipï¼šè®©Muonåœ¨Scaleupä¹‹è·¯ä¸Šæ›´è¿›ä¸€æ­¥},<br />
author={è‹å‰‘æ—},<br />
year={2025},<br />
month={Jul},<br />
url={\url{https://spaces.ac.cn/archives/11126}},<br />
} </p>
<hr />
<h2 id="_9">è¯¦ç»†æ•°å­¦æ¨å¯¼ä¸åˆ†æ</h2>
<h3 id="1-attention">1. Attentionæœºåˆ¶çš„æ•°å­¦åŸºç¡€</h3>
<h4 id="11-attention">1.1 æ ‡å‡†Attentionå…¬å¼</h4>
<p>æ ‡å‡†çš„ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›ï¼ˆScaled Dot-Product Attentionï¼‰å®šä¹‰ä¸ºï¼š</p>
<p>$$
\boldsymbol{O} = \text{softmax}\left(\frac{\boldsymbol{Q}\boldsymbol{K}^{\top}}{\sqrt{d_k}}\right)\boldsymbol{V} \tag{1}
$$</p>
<p>å…¶ä¸­ï¼š
- $\boldsymbol{Q} \in \mathbb{R}^{n \times d_k}$ æ˜¯æŸ¥è¯¢çŸ©é˜µ
- $\boldsymbol{K} \in \mathbb{R}^{m \times d_k}$ æ˜¯é”®çŸ©é˜µ
- $\boldsymbol{V} \in \mathbb{R}^{m \times d_v}$ æ˜¯å€¼çŸ©é˜µ
- $n$ æ˜¯æŸ¥è¯¢åºåˆ—é•¿åº¦ï¼Œ$m$ æ˜¯é”®å€¼åºåˆ—é•¿åº¦
- $d_k$ æ˜¯é”®/æŸ¥è¯¢ç»´åº¦ï¼Œ$d_v$ æ˜¯å€¼ç»´åº¦</p>
<p><strong>ç¼©æ”¾å› å­å¸æ”¶</strong>ï¼šç¼©æ”¾å› å­$1/\sqrt{d_k}$å¯ä»¥å¸æ”¶åˆ°$\boldsymbol{Q}$æˆ–$\boldsymbol{K}$çš„å®šä¹‰ä¸­ï¼š</p>
<p>$$
\boldsymbol{O} = \text{softmax}(\boldsymbol{Q}\boldsymbol{K}^{\top})\boldsymbol{V} \tag{2}
$$</p>
<p>å…¶ä¸­$\boldsymbol{Q} \leftarrow \boldsymbol{Q}/\sqrt{d_k}$æˆ–$\boldsymbol{K} \leftarrow \boldsymbol{K}/\sqrt{d_k}$ã€‚</p>
<h4 id="12-attention-logits">1.2 Attention Logitså®šä¹‰</h4>
<p>Attention logitsçŸ©é˜µå®šä¹‰ä¸ºï¼š</p>
<p>$$
\boldsymbol{S} = \boldsymbol{Q}\boldsymbol{K}^{\top} \in \mathbb{R}^{n \times m} \tag{3}
$$</p>
<p>çŸ©é˜µå…ƒç´ ä¸ºï¼š</p>
<p>$$
S_{ij} = \boldsymbol{q}_i \cdot \boldsymbol{k}_j = \sum_{l=1}^{d_k} q_{il} k_{jl} \tag{4}
$$</p>
<p>å…¶ä¸­$\boldsymbol{q}_i$æ˜¯ç¬¬$i$ä¸ªæŸ¥è¯¢å‘é‡ï¼Œ$\boldsymbol{k}_j$æ˜¯ç¬¬$j$ä¸ªé”®å‘é‡ã€‚</p>
<h4 id="13-maxlogit">1.3 MaxLogitå®šä¹‰</h4>
<p>MaxLogitå®šä¹‰ä¸ºæ‰€æœ‰logitsçš„æœ€å¤§å€¼ï¼š</p>
<p>$$
S_{\max} = \max_{i,j} S_{ij} = \max_{i,j} (\boldsymbol{q}_i \cdot \boldsymbol{k}_j) \tag{5}
$$</p>
<p>åœ¨å®é™…å®ç°ä¸­ï¼Œè¿˜éœ€è¦åœ¨æ‰¹æ¬¡ç»´åº¦ä¸Šå–æœ€å¤§å€¼ï¼š</p>
<p>$$
S_{\max}^{\text{global}} = \max_{b \in \text{Batch}} \max_{i,j} S_{ij}^{(b)} \tag{6}
$$</p>
<h3 id="2-maxlogit">2. MaxLogitçˆ†ç‚¸çš„æ•°å­¦åˆ†æ</h3>
<h4 id="21">2.1 ç‚¹ç§¯çš„ä¸Šç•Œ</h4>
<p>ç”±Cauchy-Schwarzä¸ç­‰å¼ï¼š</p>
<p>$$
|\boldsymbol{q}_i \cdot \boldsymbol{k}_j| \leq \|\boldsymbol{q}_i\| \|\boldsymbol{k}_j\| \tag{7}
$$</p>
<p>å¯¹äº$\boldsymbol{q}_i = \boldsymbol{x}_i \boldsymbol{W}_q$å’Œ$\boldsymbol{k}_j = \boldsymbol{x}_j \boldsymbol{W}_k$ï¼š</p>
<p>$$
\begin{align}
|\boldsymbol{q}_i \cdot \boldsymbol{k}_j| &= |\boldsymbol{x}_i \boldsymbol{W}_q \boldsymbol{W}_k^{\top} \boldsymbol{x}_j^{\top}| \tag{8} \\
&\leq \|\boldsymbol{x}_i \boldsymbol{W}_q\| \|\boldsymbol{x}_j \boldsymbol{W}_k\| \tag{9} \\
&\leq \|\boldsymbol{x}_i\| \|\boldsymbol{W}_q\| \|\boldsymbol{x}_j\| \|\boldsymbol{W}_k\| \tag{10}
\end{align}
$$</p>
<p>å…¶ä¸­$|\boldsymbol{W}|$è¡¨ç¤ºè°±èŒƒæ•°ï¼ˆæœ€å¤§å¥‡å¼‚å€¼ï¼‰ï¼š</p>
<p>$$
\|\boldsymbol{W}\| = \sigma_{\max}(\boldsymbol{W}) = \sup_{\|\boldsymbol{x}\|=1} \|\boldsymbol{W}\boldsymbol{x}\| \tag{11}
$$</p>
<h4 id="22-rmsnorm">2.2 RMSNormçš„ä½œç”¨</h4>
<p>åœ¨Transformerä¸­ï¼Œè¾“å…¥é€šå¸¸ç»è¿‡RMSNormï¼š</p>
<p>$$
\text{RMSNorm}(\boldsymbol{x}) = \frac{\boldsymbol{x}}{\text{RMS}(\boldsymbol{x})} \odot \boldsymbol{g} \tag{12}
$$</p>
<p>å…¶ä¸­ï¼š</p>
<p>$$
\text{RMS}(\boldsymbol{x}) = \sqrt{\frac{1}{d}\sum_{i=1}^{d} x_i^2} = \frac{\|\boldsymbol{x}\|}{\sqrt{d}} \tag{13}
$$</p>
<p>å½’ä¸€åŒ–åçš„å‘é‡èŒƒæ•°ä¸ºï¼š</p>
<p>$$
\|\text{RMSNorm}(\boldsymbol{x})\| = \|\boldsymbol{g}\| \cdot \sqrt{d} \tag{14}
$$</p>
<p>å‡è®¾$\boldsymbol{g} \approx \boldsymbol{1}$ï¼Œåˆ™$|\text{RMSNorm}(\boldsymbol{x})| \approx \sqrt{d}$ã€‚</p>
<p>å› æ­¤ï¼ŒMaxLogitçš„ä¸Šç•Œä¸»è¦ç”±æƒé‡è°±èŒƒæ•°å†³å®šï¼š</p>
<p>$$
S_{\max} \lesssim d \cdot \|\boldsymbol{W}_q\| \|\boldsymbol{W}_k\| \tag{15}
$$</p>
<p><strong>MaxLogitçˆ†ç‚¸çš„å……è¦æ¡ä»¶</strong>ï¼š$|\boldsymbol{W}_q|$æˆ–$|\boldsymbol{W}_k|$è¶‹å‘æ— ç©·å¤§ã€‚</p>
<h4 id="23">2.3 è°±èŒƒæ•°å¢é•¿çš„åŠ¨åŠ›å­¦</h4>
<p>è®¾æƒé‡æ›´æ–°ä¸ºï¼š</p>
<p>$$
\boldsymbol{W}_t = \boldsymbol{W}_{t-1} - \eta_t \boldsymbol{\Delta}_t \tag{16}
$$</p>
<p>è°±èŒƒæ•°çš„å˜åŒ–ä¸ºï¼š</p>
<p>$$
\|\boldsymbol{W}_t\| \leq \|\boldsymbol{W}_{t-1}\| + \eta_t \|\boldsymbol{\Delta}_t\| \tag{17}
$$</p>
<p><strong>å¢é•¿æ¡ä»¶</strong>ï¼šè‹¥æ›´æ–°é‡$\boldsymbol{\Delta}<em t-1="t-1">t$ä¸$\boldsymbol{W}</em>$çš„ä¸»å¥‡å¼‚å‘é‡æ–¹å‘ä¸€è‡´ï¼Œåˆ™ï¼š</p>
<p>$$
\|\boldsymbol{W}_t\| \approx \|\boldsymbol{W}_{t-1}\| + \eta_t \|\boldsymbol{\Delta}_t\| \cos\theta \tag{18}
$$</p>
<p>å…¶ä¸­$\theta$æ˜¯æ›´æ–°æ–¹å‘ä¸ä¸»å¥‡å¼‚å‘é‡çš„å¤¹è§’ã€‚</p>
<h3 id="3-muon">3. Muonä¼˜åŒ–å™¨è¯¦è§£</h3>
<h4 id="31-muon">3.1 Muonæ›´æ–°è§„åˆ™</h4>
<p>Muonï¼ˆMomentum Orthogonalized by Normalizationï¼‰ä¼˜åŒ–å™¨çš„æ›´æ–°è§„åˆ™ä¸ºï¼š</p>
<p>$$
\begin{align}
\boldsymbol{M}_t &= \mu \boldsymbol{M}_{t-1} + \boldsymbol{G}_t \tag{19} \\
\boldsymbol{O}_t &= \text{msign}(\boldsymbol{M}_t) \tag{20} \\
\boldsymbol{W}_t &= \boldsymbol{W}_{t-1} - \eta_t \boldsymbol{O}_t \tag{21}
\end{align}
$$</p>
<p>å…¶ä¸­ï¼š
- $\boldsymbol{G}<em _boldsymbol_W="\boldsymbol{W">t = \nabla</em>)$ æ˜¯æ¢¯åº¦
- $\mu \in (0,1)$ æ˜¯åŠ¨é‡ç³»æ•°ï¼Œé€šå¸¸ä¸º0.95
- $\text{msign}(\cdot)$ æ˜¯çŸ©é˜µç¬¦å·å‡½æ•°}} L(\boldsymbol{W}_{t-1</p>
<h4 id="32">3.2 çŸ©é˜µç¬¦å·å‡½æ•°</h4>
<p>çŸ©é˜µç¬¦å·å‡½æ•°å®šä¹‰ä¸ºï¼š</p>
<p>$$
\text{msign}(\boldsymbol{M}) = \boldsymbol{U}\text{sign}(\boldsymbol{\Sigma})\boldsymbol{V}^{\top} \tag{22}
$$</p>
<p>å…¶ä¸­$\boldsymbol{M} = \boldsymbol{U}\boldsymbol{\Sigma}\boldsymbol{V}^{\top}$æ˜¯SVDåˆ†è§£ï¼Œ$\text{sign}(\boldsymbol{\Sigma})$æ˜¯å¯¹è§’å…ƒç´ å–ç¬¦å·ã€‚</p>
<p><strong>ç­‰ä»·è¡¨ç¤º</strong>ï¼ˆå¯¹äºæ»¡ç§©çŸ©é˜µï¼‰ï¼š</p>
<p>$$
\text{msign}(\boldsymbol{M}) = \boldsymbol{M}(\boldsymbol{M}^{\top}\boldsymbol{M})^{-1/2} \tag{23}
$$</p>
<p><strong>å…³é”®æ€§è´¨</strong>ï¼š
1. $\text{msign}(\boldsymbol{M})$çš„æ‰€æœ‰å¥‡å¼‚å€¼éƒ½ç­‰äº1
2. $|\text{msign}(\boldsymbol{M})|_F = \sqrt{\text{rank}(\boldsymbol{M})}$
3. æ»¡ç§©çŸ©é˜µï¼š$|\text{msign}(\boldsymbol{M})|_F = \sqrt{\min(n,m)}$</p>
<h4 id="33-muon">3.3 å¸¦æƒé‡è¡°å‡çš„Muon</h4>
<p>åŠ å…¥æƒé‡è¡°å‡åï¼š</p>
<p>$$
\boldsymbol{W}_t = \boldsymbol{W}_{t-1} - \eta_t (\boldsymbol{O}_t + \lambda \boldsymbol{W}_{t-1}) \tag{24}
$$</p>
<p>å±•å¼€ï¼š</p>
<p>$$
\boldsymbol{W}_t = (1 - \eta_t \lambda) \boldsymbol{W}_{t-1} - \eta_t \boldsymbol{O}_t \tag{25}
$$</p>
<h4 id="34-update-rms">3.4 Update RMSå¯¹é½</h4>
<p>ä¸ºäº†ä¸Adamçš„æ›´æ–°é‡çº§å¯¹é½ï¼ŒMuonå¼•å…¥ç¼©æ”¾å› å­ï¼š</p>
<p>$$
\boldsymbol{O}_t = \text{msign}(\boldsymbol{M}_t) \times \alpha \sqrt{\max(n,m)} \tag{26}
$$</p>
<p>å…¶ä¸­$\alpha = 0.2$æ˜¯ç»éªŒç³»æ•°ã€‚</p>
<p><strong>ç†è®ºä¾æ®</strong>ï¼šAdamçš„æ›´æ–°é‡RMSçº¦ä¸º$\mathcal{O}(1)$ï¼Œè€Œ$\text{msign}(\boldsymbol{M})$çš„FrobeniusèŒƒæ•°ä¸º$\sqrt{\max(n,m)}$ï¼Œå› æ­¤ï¼š</p>
<p>$$
\text{RMS}(\boldsymbol{O}_t) = \frac{\|\boldsymbol{O}_t\|_F}{\sqrt{nm}} = \frac{\alpha \sqrt{\max(n,m)} \cdot \sqrt{\min(n,m)}}{\sqrt{nm}} = \alpha \tag{27}
$$</p>
<h3 id="4-adam">4. Adamä¼˜åŒ–å™¨å¯¹æ¯”</h3>
<h4 id="41-adam">4.1 Adamæ›´æ–°è§„åˆ™</h4>
<p>Adamçš„æ›´æ–°è§„åˆ™ä¸ºï¼š</p>
<p>$$
\begin{align}
\boldsymbol{m}_t &= \beta_1 \boldsymbol{m}_{t-1} + (1-\beta_1) \boldsymbol{G}_t \tag{28} \\
\boldsymbol{v}_t &= \beta_2 \boldsymbol{v}_{t-1} + (1-\beta_2) \boldsymbol{G}_t \odot \boldsymbol{G}_t \tag{29} \\
\hat{\boldsymbol{m}}_t &= \boldsymbol{m}_t / (1 - \beta_1^t) \tag{30} \\
\hat{\boldsymbol{v}}_t &= \boldsymbol{v}_t / (1 - \beta_2^t) \tag{31} \\
\boldsymbol{W}_t &= \boldsymbol{W}_{t-1} - \eta_t \frac{\hat{\boldsymbol{m}}_t}{\sqrt{\hat{\boldsymbol{v}}_t} + \epsilon} \tag{32}
\end{align}
$$</p>
<p>é€šå¸¸ï¼š$\beta_1 = 0.9$ï¼Œ$\beta_2 = 0.999$ï¼Œ$\epsilon = 10^{-8}$ã€‚</p>
<h4 id="42-adam">4.2 Adamæ›´æ–°é‡çš„ç§©åˆ†æ</h4>
<p>Adamçš„æ›´æ–°é‡ä¸ºï¼š</p>
<p>$$
\boldsymbol{\Delta}_t^{\text{Adam}} = \frac{\hat{\boldsymbol{m}}_t}{\sqrt{\hat{\boldsymbol{v}}_t} + \epsilon} \tag{33}
$$</p>
<p>ç”±äº$\hat{\boldsymbol{m}}_t$æ˜¯æ¢¯åº¦çš„æŒ‡æ•°ç§»åŠ¨å¹³å‡ï¼Œè€Œæ¢¯åº¦é€šå¸¸æ˜¯ä½ç§©çš„ï¼ˆç”±æŸå¤±å‡½æ•°çš„Hessianå†³å®šï¼‰ï¼Œå› æ­¤ï¼š</p>
<p><strong>å‡è®¾</strong>ï¼šAdamæ›´æ–°é‡æ˜¯ä½ç§©çš„ï¼Œå³ä¸»è¦å¥‡å¼‚å€¼é›†ä¸­åœ¨å‰å‡ ä¸ªï¼š</p>
<p>$$
\boldsymbol{\Delta}_t^{\text{Adam}} \approx \sum_{i=1}^{r} \tilde{\sigma}_i \tilde{\boldsymbol{u}}_i \tilde{\boldsymbol{v}}_i^{\top}, \quad r \ll \min(n,m) \tag{34}
$$</p>
<p>å…¶ä¸­$\tilde{\sigma}_1 \gg \tilde{\sigma}_2 \gg \cdots \gg \tilde{\sigma}_r$ã€‚</p>
<h4 id="43-muon">4.3 Muonæ›´æ–°é‡çš„ç§©åˆ†æ</h4>
<p>Muonçš„æ›´æ–°é‡ä¸ºï¼š</p>
<p>$$
\boldsymbol{\Delta}_t^{\text{Muon}} = \text{msign}(\boldsymbol{M}_t) \times \alpha \sqrt{\max(n,m)} \tag{35}
$$</p>
<p><strong>å…³é”®ç‰¹æ€§</strong>ï¼šæ‰€æœ‰å¥‡å¼‚å€¼ç›¸ç­‰ï¼Œå³ï¼š</p>
<p>$$
\boldsymbol{\Delta}_t^{\text{Muon}} = \sum_{i=1}^{\min(n,m)} \bar{\sigma} \bar{\boldsymbol{u}}_i \bar{\boldsymbol{v}}_i^{\top}, \quad \bar{\sigma} = \alpha \sqrt{\frac{\max(n,m)}{\min(n,m)}} \tag{36}
$$</p>
<p>è¿™æ˜¯æ»¡ç§©æ›´æ–°ï¼</p>
<h3 id="5">5. æœ‰æ•ˆç§©ç†è®º</h3>
<h4 id="51">5.1 æœ‰æ•ˆç§©å®šä¹‰</h4>
<p>çŸ©é˜µ$\boldsymbol{A}$çš„æœ‰æ•ˆç§©å®šä¹‰ä¸ºå…¶å¥‡å¼‚å€¼çš„ç†µï¼š</p>
<p>$$
\text{EffRank}(\boldsymbol{A}) = \exp\left(-\sum_{i=1}^{r} p_i \log p_i\right) \tag{37}
$$</p>
<p>å…¶ä¸­$p_i = \sigma_i / \sum_j \sigma_j$æ˜¯å½’ä¸€åŒ–çš„å¥‡å¼‚å€¼ã€‚</p>
<p><strong>æç«¯æƒ…å†µ</strong>ï¼š
- ç§©1çŸ©é˜µï¼š$\text{EffRank} = 1$
- æ‰€æœ‰å¥‡å¼‚å€¼ç›¸ç­‰ï¼š$\text{EffRank} = r$ï¼ˆæ»¡ç§©ï¼‰</p>
<h4 id="52">5.2 ä¸å¥‡å¼‚å€¼ç†µçš„å…³ç³»</h4>
<p>å¥‡å¼‚å€¼ç†µå®šä¹‰ä¸ºï¼š</p>
<p>$$
H(\boldsymbol{A}) = -\sum_{i=1}^{r} p_i \log p_i \tag{38}
$$</p>
<p>åˆ™ï¼š</p>
<p>$$
\text{EffRank}(\boldsymbol{A}) = \exp(H(\boldsymbol{A})) \tag{39}
$$</p>
<p><strong>æ€§è´¨</strong>ï¼š
- $1 \leq \text{EffRank}(\boldsymbol{A}) \leq \text{rank}(\boldsymbol{A})$
- ç†µè¶Šé«˜ï¼Œæœ‰æ•ˆç§©è¶Šå¤§ï¼ŒçŸ©é˜µè¶Š"æ»¡ç§©"</p>
<h4 id="53-muonadam">5.3 Muonä¸Adamçš„æœ‰æ•ˆç§©å¯¹æ¯”</h4>
<p><strong>Muonæ›´æ–°é‡</strong>ï¼š</p>
<p>$$
\text{EffRank}(\boldsymbol{\Delta}_t^{\text{Muon}}) = \min(n,m) \tag{40}
$$</p>
<p><strong>Adamæ›´æ–°é‡</strong>ï¼š</p>
<p>$$
\text{EffRank}(\boldsymbol{\Delta}_t^{\text{Adam}}) \ll \min(n,m) \tag{41}
$$</p>
<p>ç»éªŒè§‚å¯Ÿï¼š$\text{EffRank}(\boldsymbol{\Delta}_t^{\text{Adam}}) \approx 10\text{-}50$ï¼Œå³ä½¿å¯¹äº$n,m &gt; 1000$çš„çŸ©é˜µã€‚</p>
<h3 id="6">6. å¥‡å¼‚å€¼ç¢°æ’ç†è®º</h3>
<h4 id="61-svd">6.1 SVDè¡¨ç¤º</h4>
<p>è®¾å½“å‰æƒé‡çš„SVDä¸ºï¼š</p>
<p>$$
\boldsymbol{W}_{t-1} = \sum_{i=1}^{r_W} \sigma_i \boldsymbol{u}_i \boldsymbol{v}_i^{\top} \tag{42}
$$</p>
<p>æ›´æ–°é‡çš„SVDä¸ºï¼š</p>
<p>$$
\boldsymbol{\Delta}_t = \sum_{j=1}^{r_\Delta} \delta_j \boldsymbol{p}_j \boldsymbol{q}_j^{\top} \tag{43}
$$</p>
<h4 id="62">6.2 æ›´æ–°åçš„å¥‡å¼‚å€¼</h4>
<p>æ›´æ–°åçš„æƒé‡ä¸ºï¼š</p>
<p>$$
\boldsymbol{W}_t = \boldsymbol{W}_{t-1} - \eta_t \boldsymbol{\Delta}_t = \sum_{i=1}^{r_W} \sigma_i \boldsymbol{u}_i \boldsymbol{v}_i^{\top} - \eta_t \sum_{j=1}^{r_\Delta} \delta_j \boldsymbol{p}_j \boldsymbol{q}_j^{\top} \tag{44}
$$</p>
<p><strong>ç®€åŒ–æƒ…å†µ</strong>ï¼šè‹¥$\boldsymbol{u}_k \approx \boldsymbol{p}_j$ä¸”$\boldsymbol{v}_k \approx \boldsymbol{q}_j$ï¼ˆå¥‡å¼‚å‘é‡å¯¹é½ï¼‰ï¼Œåˆ™ï¼š</p>
<p>$$
\boldsymbol{W}_t \approx \sum_{i \neq k} \sigma_i \boldsymbol{u}_i \boldsymbol{v}_i^{\top} + (\sigma_k - \eta_t \delta_j) \boldsymbol{u}_k \boldsymbol{v}_k^{\top} + \cdots \tag{45}
$$</p>
<p>ç¬¬$k$ä¸ªå¥‡å¼‚å€¼å˜åŒ–ï¼š</p>
<p>$$
\Delta\sigma_k \approx -\eta_t \delta_j \cos\theta_j \tag{46}
$$</p>
<p>å…¶ä¸­$\theta_j$æ˜¯å¥‡å¼‚å‘é‡å¯¹çš„å¤¹è§’ã€‚</p>
<h4 id="63">6.3 ç¢°æ’æ¦‚ç‡åˆ†æ</h4>
<p>å®šä¹‰"ç¢°æ’"äº‹ä»¶ä¸º$|\cos\theta_j| &gt; \tau$ï¼ˆå¦‚$\tau = 0.5$ï¼‰ã€‚</p>
<p><strong>Muonçš„ç¢°æ’æ¦‚ç‡</strong>ï¼šç”±äºMuonæœ‰$r_\Delta = \min(n,m)$ä¸ªå¥‡å¼‚å‘é‡å¯¹ï¼Œç¢°æ’æ¦‚ç‡ä¸ºï¼š</p>
<p>$$
P_{\text{collision}}^{\text{Muon}} \approx \frac{r_\Delta \cdot \tau}{r_W} = \frac{\min(n,m) \cdot \tau}{r_W} \tag{47}
$$</p>
<p><strong>Adamçš„ç¢°æ’æ¦‚ç‡</strong>ï¼šç”±äºAdamæœ‰æ•ˆç§©$r_\Delta \ll \min(n,m)$ï¼š</p>
<p>$$
P_{\text{collision}}^{\text{Adam}} \approx \frac{r_\Delta^{\text{Adam}} \cdot \tau}{r_W} \ll P_{\text{collision}}^{\text{Muon}} \tag{48}
$$</p>
<p><strong>æ¯”ä¾‹</strong>ï¼šå‡è®¾$r_\Delta^{\text{Adam}} = 20$ï¼Œ$\min(n,m) = 1000$ï¼š</p>
<p>$$
\frac{P_{\text{collision}}^{\text{Muon}}}{P_{\text{collision}}^{\text{Adam}}} \approx \frac{1000}{20} = 50 \tag{49}
$$</p>
<p>Muonçš„ç¢°æ’æ¦‚ç‡æ˜¯Adamçš„50å€ï¼</p>
<h3 id="7-maxlogit">7. MaxLogitçˆ†ç‚¸çš„æœºåˆ¶</h3>
<h4 id="71">7.1 åŒçº¿æ€§å½¢å¼çš„æ”¾å¤§æ•ˆåº”</h4>
<p>Attention logitæ˜¯åŒçº¿æ€§å½¢å¼ï¼š</p>
<p>$$
S_{ij} = \boldsymbol{q}_i \cdot \boldsymbol{k}_j = \boldsymbol{x}_i \boldsymbol{W}_q \boldsymbol{W}_k^{\top} \boldsymbol{x}_j^{\top} \tag{50}
$$</p>
<p>è®¾$\boldsymbol{W}_q$çš„æœ€å¤§å¥‡å¼‚å€¼ä¸º$\sigma_q$ï¼Œ$\boldsymbol{W}_k$çš„æœ€å¤§å¥‡å¼‚å€¼ä¸º$\sigma_k$ï¼Œåˆ™ï¼š</p>
<p>$$
|S_{ij}| \leq \|\boldsymbol{x}_i\| \|\boldsymbol{x}_j\| \sigma_q \sigma_k \tag{51}
$$</p>
<p><strong>ä¹˜ç§¯æ”¾å¤§</strong>ï¼šè‹¥ä¸¤ä¸ªè°±èŒƒæ•°éƒ½å¢é•¿ï¼ŒMaxLogitä»¥ä¹˜ç§¯é€Ÿåº¦å¢é•¿ï¼</p>
<p>è®¾$\sigma_q(t) = \sigma_k(t) = 1 + \alpha t$ï¼ˆçº¿æ€§å¢é•¿ï¼‰ï¼Œåˆ™ï¼š</p>
<p>$$
S_{\max}(t) \propto (1 + \alpha t)^2 = 1 + 2\alpha t + \alpha^2 t^2 \tag{52}
$$</p>
<p>è¶…çº¿æ€§å¢é•¿ï¼</p>
<h4 id="72">7.2 æ­£åé¦ˆå¾ªç¯</h4>
<ol>
<li><strong>åˆå§‹æ‰°åŠ¨</strong>ï¼šæŸä¸ªHeadçš„$\boldsymbol{W}_q$æˆ–$\boldsymbol{W}_k$çš„å¥‡å¼‚å€¼ç•¥å¾®å¢å¤§</li>
<li><strong>MaxLogitä¸Šå‡</strong>ï¼š$S_{\max} \propto \sigma_q \sigma_k$å¢å¤§</li>
<li><strong>æ¢¯åº¦æ¨¡å¼å˜åŒ–</strong>ï¼šè¾ƒå¤§çš„logitä¸»å¯¼softmaxè¾“å‡ºï¼Œæ¢¯åº¦é›†ä¸­åœ¨å¯¹åº”æ–¹å‘</li>
<li><strong>è¿›ä¸€æ­¥å¢å¼º</strong>ï¼šè‹¥æ¢¯åº¦æ–¹å‘ä¸å¥‡å¼‚å‘é‡å¯¹é½ï¼Œç»§ç»­å¢å¤§å¥‡å¼‚å€¼</li>
<li><strong>å¾ªç¯å¾€å¤</strong>ï¼šå½¢æˆ"å¯Œè€…æ„ˆå¯Œ"çš„æ¶æ€§å¾ªç¯</li>
</ol>
<p>æ•°å­¦è¡¨ç¤ºï¼šè®¾ç¬¬$k$ä¸ªå¥‡å¼‚å€¼åœ¨æ—¶åˆ»$t$ä¸º$\sigma_k(t)$ï¼Œè‹¥å­˜åœ¨æ­£åé¦ˆï¼š</p>
<p>$$
\frac{d\sigma_k}{dt} \propto \sigma_k \tag{53}
$$</p>
<p>è§£ä¸ºæŒ‡æ•°å¢é•¿ï¼š</p>
<p>$$
\sigma_k(t) = \sigma_k(0) e^{\gamma t} \tag{54}
$$</p>
<p>å…¶ä¸­$\gamma &gt; 0$æ˜¯å¢é•¿ç‡ã€‚</p>
<h4 id="73">7.3 æƒé‡è¡°å‡çš„æŠ‘åˆ¶ä½œç”¨</h4>
<p>åŠ å…¥æƒé‡è¡°å‡åï¼š</p>
<p>$$
\frac{d\sigma_k}{dt} = \alpha \sigma_k - \lambda \sigma_k = (\alpha - \lambda) \sigma_k \tag{55}
$$</p>
<p><strong>ç¨³å®šæ¡ä»¶</strong>ï¼š$\alpha &lt; \lambda$ã€‚</p>
<p>è‹¥$\alpha &gt; \lambda$ï¼Œä»ä¼šæŒ‡æ•°å¢é•¿ï¼›è‹¥$\alpha \approx \lambda$ï¼Œåˆ™å¤„äºä¸´ç•ŒçŠ¶æ€ï¼ˆæ‹‰é”¯æˆ˜ï¼‰ã€‚</p>
<h3 id="8-qk-clip">8. QK-Clipçš„æ•°å­¦åŸç†</h3>
<h4 id="81">8.1 ç›´æ¥è£å‰ªç­–ç•¥</h4>
<p>å½“æ£€æµ‹åˆ°$S_{\max}^{(l,h)} &gt; \tau$æ—¶ï¼Œå¸Œæœ›å°†å…¶è£å‰ªåˆ°$\tau$ã€‚</p>
<p><strong>æ–¹æ³•</strong>ï¼šå¯¹logitçŸ©é˜µä¹˜ä»¥å› å­$\gamma$ï¼š</p>
<p>$$
\boldsymbol{S}_{\text{clip}} = \gamma \boldsymbol{S} = \gamma \boldsymbol{Q}\boldsymbol{K}^{\top} \tag{56}
$$</p>
<p>é€‰æ‹©$\gamma$ä½¿å¾—æ–°çš„MaxLogitç­‰äº$\tau$ï¼š</p>
<p>$$
\gamma = \frac{\tau}{S_{\max}} \tag{57}
$$</p>
<p>åˆ™ï¼š</p>
<p>$$
\max_{i,j} (\boldsymbol{S}_{\text{clip}})_{ij} = \gamma S_{\max} = \tau \tag{58}
$$</p>
<h4 id="82">8.2 æƒé‡åˆ†é…</h4>
<p>ç”±äº$\gamma \boldsymbol{Q}\boldsymbol{K}^{\top} = (\sqrt{\gamma}\boldsymbol{Q})(\sqrt{\gamma}\boldsymbol{K})^{\top}$ï¼Œå¯ä»¥å°†å› å­å¹³åˆ†ï¼š</p>
<p>$$
\begin{align}
\boldsymbol{W}_q &\leftarrow \sqrt{\gamma} \boldsymbol{W}_q \tag{59} \\
\boldsymbol{W}_k &\leftarrow \sqrt{\gamma} \boldsymbol{W}_k \tag{60}
\end{align}
$$</p>
<p><strong>ä¸å˜æ€§</strong>ï¼š$\boldsymbol{Q}\boldsymbol{K}^{\top} = (\boldsymbol{X}\boldsymbol{W}_q)(\boldsymbol{X}\boldsymbol{W}_k)^{\top}$ä¿æŒã€‚</p>
<h4 id="83-per-head">8.3 Per-Headè£å‰ª</h4>
<p>å¯¹äºå¤šå¤´æ³¨æ„åŠ›ï¼Œç¬¬$(l,h)$ä¸ªHeadçš„è£å‰ªï¼š</p>
<p>$$
\text{if } S_{\max}^{(l,h)} > \tau: \quad \gamma^{(l,h)} = \frac{\tau}{S_{\max}^{(l,h)}} \tag{61}
$$</p>
<p>åªè£å‰ªè¯¥Headçš„æƒé‡ï¼š</p>
<p>$$
\begin{align}
\boldsymbol{W}_{qc}^{(l,h)} &\leftarrow \sqrt{\gamma^{(l,h)}} \boldsymbol{W}_{qc}^{(l,h)} \tag{62} \\
\boldsymbol{W}_{kc}^{(l,h)} &\leftarrow \sqrt{\gamma^{(l,h)}} \boldsymbol{W}_{kc}^{(l,h)} \tag{63}
\end{align}
$$</p>
<p><strong>é¿å…æ®ƒåŠæ± é±¼</strong>ï¼šå…¶ä»–Headä¸å—å½±å“ã€‚</p>
<h4 id="84-mla">8.4 MLAçš„ç‰¹æ®Šå¤„ç†</h4>
<p>MLAä¸­ï¼Œ$\boldsymbol{k}<em kr="kr">i$åŒ…å«å…±äº«éƒ¨åˆ†$\boldsymbol{W}</em>$ï¼š</p>
<p>$$
\boldsymbol{k}_i^{(s)} = [\boldsymbol{c}_i\boldsymbol{W}_{kc}^{(s)}, \boldsymbol{x}_i\boldsymbol{W}_{kr}\boldsymbol{\mathcal{R}}_i] \tag{64}
$$</p>
<p>è‹¥å¯¹$\boldsymbol{W}_{kr}$è£å‰ªï¼Œä¼šå½±å“æ‰€æœ‰Headã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šåªè£å‰ª$\boldsymbol{W}_{qr}^{(l,h)}$ï¼š</p>
<p>$$
\boldsymbol{W}_{qr}^{(l,h)} \leftarrow \gamma^{(l,h)} \boldsymbol{W}_{qr}^{(l,h)} \tag{65}
$$</p>
<p>å®Œå…¨è£å‰ªï¼ˆä¸å¼€æ–¹ï¼‰ï¼Œå› ä¸ºå¦ä¸€ä¾§ä¸è£å‰ªã€‚</p>
<h3 id="9-qk-clip">9. QK-Clipçš„æ”¶æ•›æ€§åˆ†æ</h3>
<h4 id="91">9.1 ç¦»æ•£åŠ¨åŠ›ç³»ç»Ÿ</h4>
<p>è€ƒè™‘ç®€åŒ–æ¨¡å‹ï¼šå•ä¸ªHeadï¼Œå­¦ä¹ ç‡æ’å®šã€‚è®¾ç¬¬$t$æ­¥çš„è°±èŒƒæ•°ä¸º$\sigma_t$ï¼š</p>
<p><strong>æ— QK-Clip</strong>ï¼š</p>
<p>$$
\sigma_{t+1} = \sigma_t + \eta \alpha - \eta \lambda \sigma_t = (1 - \eta\lambda)\sigma_t + \eta\alpha \tag{66}
$$</p>
<p>å…¶ä¸­$\alpha$æ˜¯Muonæ›´æ–°çš„è´¡çŒ®ï¼ˆå‡è®¾å¸¸æ•°ï¼‰ã€‚</p>
<p><strong>ç¨³æ€</strong>ï¼š$\sigma^* = \alpha / \lambda$ã€‚</p>
<p>è‹¥$\alpha / \lambda &gt; \tau$ï¼ˆé˜ˆå€¼ï¼‰ï¼Œåˆ™ä¼šMaxLogitçˆ†ç‚¸ã€‚</p>
<p><strong>åŠ å…¥QK-Clip</strong>ï¼š</p>
<p>$$
\sigma_{t+1} = \begin{cases}
(1 - \eta\lambda)\sigma_t + \eta\alpha, & S_{\max}(t) \leq \tau \\
\sqrt{\tau / S_{\max}(t)} \cdot [(1 - \eta\lambda)\sigma_t + \eta\alpha], & S_{\max}(t) > \tau
\end{cases} \tag{67}
$$</p>
<p>ç®€åŒ–ä¸ºï¼š$S_{\max}(t) \propto \sigma_t^2$ï¼ˆåŒçº¿æ€§ï¼‰ï¼Œåˆ™è£å‰ªæ¡ä»¶å˜ä¸º$\sigma_t &gt; \sqrt{\tau/C}$ã€‚</p>
<p>$$
\sigma_{t+1} = \begin{cases}
(1 - \eta\lambda)\sigma_t + \eta\alpha, & \sigma_t \leq \sigma_{\text{th}} \\
\sigma_{\text{th}} \cdot \frac{(1 - \eta\lambda)\sigma_t + \eta\alpha}{\sigma_t}, & \sigma_t > \sigma_{\text{th}}
\end{cases} \tag{68}
$$</p>
<p>å…¶ä¸­$\sigma_{\text{th}} = \sqrt{\tau/C}$ã€‚</p>
<h4 id="92">9.2 ç¨³å®šæ€§åˆ†æ</h4>
<p><strong>å®šç†</strong>ï¼šåœ¨QK-Clipä¸‹ï¼Œè°±èŒƒæ•°$\sigma_t$æœ‰ç•Œã€‚</p>
<p><strong>è¯æ˜è‰å›¾</strong>ï¼š
1. è‹¥$\sigma_t \leq \sigma_{\text{th}}$ï¼Œåˆ™$\sigma_{t+1} \leq (1-\eta\lambda)\sigma_{\text{th}} + \eta\alpha$
2. è‹¥$(1-\eta\lambda)\sigma_{\text{th}} + \eta\alpha \leq \sigma_{\text{th}}$ï¼Œåˆ™ä¸ä¼šè¶…è¿‡é˜ˆå€¼
3. å³ä½¿è¶…è¿‡é˜ˆå€¼ï¼Œè£å‰ªå$\sigma_{t+1} \leq \sigma_{\text{th}} \cdot [1 + \eta(\alpha/\sigma_{\text{th}} - \lambda)]$
4. é€‰æ‹©é€‚å½“çš„$\tau$å’Œ$\lambda$ï¼Œå¯ä¿è¯$\sigma_t$æœ‰ç•Œ</p>
<p><strong>æ¨è®º</strong>ï¼š$S_{\max}(t) \leq C\sigma_t^2 \leq C\sigma_{\max}^2 &lt; \infty$ã€‚â–¡</p>
<h4 id="93">9.3 æ‹‰é”¯æˆ˜åŠ¨æ€</h4>
<p>åœ¨å®é™…è®­ç»ƒä¸­ï¼Œè§‚å¯Ÿåˆ°Muonæ›´æ–°ä¸QK-Clipçš„"æ‹‰é”¯æˆ˜"ï¼š</p>
<p>$$
\begin{align}
\text{Muon step}: \quad &\sigma_t \to \sigma_t + \delta \quad (\delta > 0) \tag{69} \\
\text{QK-Clip step}: \quad &\sigma_t \to \sigma_t \times \gamma \quad (\gamma < 1) \tag{70}
\end{align}
$$</p>
<p><strong>å¹³è¡¡çŠ¶æ€</strong>ï¼š$(1 + \delta/\sigma_t) \times \gamma \approx 1$ï¼Œå³ï¼š</p>
<p>$$
\gamma \approx \frac{1}{1 + \delta/\sigma_t} \approx 1 - \frac{\delta}{\sigma_t} \tag{71}
$$</p>
<p>ä»$\gamma = \sqrt{\tau / S_{\max}}$ï¼š</p>
<p>$$
1 - \frac{\delta}{\sigma_t} \approx \sqrt{\frac{\tau}{S_{\max}}} \quad \Rightarrow \quad S_{\max} \approx \tau \left(1 + \frac{2\delta}{\sigma_t}\right) \tag{72}
$$</p>
<p>$S_{\max}$åœ¨$\tau$é™„è¿‘å°å¹…éœ‡è¡ã€‚</p>
<h3 id="10">10. æ•°å€¼ç¨³å®šæ€§ä¸å®ç°ç»†èŠ‚</h3>
<h4 id="101">10.1 æµ®ç‚¹ç²¾åº¦è€ƒè™‘</h4>
<p>å½“$S_{\max}$éå¸¸å¤§æ—¶ï¼ˆå¦‚1000+ï¼‰ï¼Œsoftmaxè®¡ç®—éœ€è¦æ•°å€¼ç¨³å®šåŒ–ï¼š</p>
<p>$$
\text{softmax}(\boldsymbol{s})_i = \frac{\exp(s_i - s_{\max})}{\sum_j \exp(s_j - s_{\max})} \tag{73}
$$</p>
<p>å…¶ä¸­$s_{\max} = \max_j s_j$ã€‚</p>
<p><strong>QK-Clipçš„å¥½å¤„</strong>ï¼šä¿è¯$s_{\max} \leq \tau$ï¼Œé¿å…äº†æå¤§çš„æŒ‡æ•°è®¡ç®—ã€‚</p>
<h4 id="102">10.2 æ¢¯åº¦æµåˆ†æ</h4>
<p>QK-Clipæ˜¯å¯¹æƒé‡çš„äº‹åä¿®æ”¹ï¼Œä¸åœ¨è®¡ç®—å›¾ä¸­ï¼Œå› æ­¤ï¼š</p>
<p>$$
\frac{\partial L}{\partial \boldsymbol{W}_q^{\text{before clip}}} \neq \frac{\partial L}{\partial \boldsymbol{W}_q^{\text{after clip}}} \tag{74}
$$</p>
<p>ä½†è¿™æ˜¯å¯æ¥å—çš„ï¼Œå› ä¸ºï¼š
1. è£å‰ªåªåœ¨å¿…è¦æ—¶å‘ç”Ÿï¼ˆ$S_{\max} &gt; \tau$ï¼‰
2. è£å‰ªå¹…åº¦å¾ˆå°ï¼ˆ$\gamma \approx 1$ï¼‰
3. ç±»ä¼¼äºæ¢¯åº¦è£å‰ªï¼Œå±äºæ­£åˆ™åŒ–æ‰‹æ®µ</p>
<h4 id="103">10.3 åˆ†å¸ƒå¼è®­ç»ƒä¸­çš„åŒæ­¥</h4>
<p>åœ¨æ¨¡å‹å¹¶è¡Œä¸­ï¼Œæƒé‡çŸ©é˜µå¯èƒ½è¢«åˆ‡åˆ†ã€‚Per-Headè£å‰ªéœ€è¦ï¼š</p>
<ol>
<li><strong>æ”¶é›†MaxLogit</strong>ï¼šåœ¨å‰å‘ä¼ æ’­ä¸­è®¡ç®—æ¯ä¸ªHeadçš„$S_{\max}^{(l,h)}$</li>
<li><strong>è·¨è®¾å¤‡åŒæ­¥</strong>ï¼šé€šè¿‡all-reduceè·å–å…¨å±€$S_{\max}^{(l,h)}$</li>
<li><strong>è®¡ç®—è£å‰ªå› å­</strong>ï¼š$\gamma^{(l,h)} = \sqrt{\tau / S_{\max}^{(l,h)}}$</li>
<li><strong>å±€éƒ¨è£å‰ª</strong>ï¼šæ¯ä¸ªè®¾å¤‡è£å‰ªå…¶æŒæœ‰çš„æƒé‡åˆ†ç‰‡</li>
</ol>
<p><strong>é€šä¿¡å¼€é”€</strong>ï¼šæ¯å±‚æ¯ä¸ªHeadä¸€ä¸ªæ ‡é‡ï¼Œ$O(\text{num_layers} \times \text{num_heads})$ï¼Œå¯å¿½ç•¥ã€‚</p>
<h3 id="11">11. ç†è®ºæ¨å¹¿ä¸å˜ä½“</h3>
<h4 id="111">11.1 è‡ªé€‚åº”é˜ˆå€¼</h4>
<p>å›ºå®šé˜ˆå€¼$\tau$å¯èƒ½ä¸æ˜¯æœ€ä¼˜çš„ã€‚è€ƒè™‘è‡ªé€‚åº”é˜ˆå€¼ï¼š</p>
<p>$$
\tau_t = \tau_0 + \beta \cdot \text{median}(\{S_{\max}^{(l,h)}\}) \tag{75}
$$</p>
<p>æ ¹æ®æ¨¡å‹å½“å‰çŠ¶æ€åŠ¨æ€è°ƒæ•´ã€‚</p>
<h4 id="112">11.2 è½¯è£å‰ª</h4>
<p>æ›¿ä»£ç¡¬è£å‰ªï¼Œå¯ä»¥ä½¿ç”¨è½¯è£å‰ªï¼š</p>
<p>$$
\gamma^{(l,h)} = \left(\frac{\tau}{S_{\max}^{(l,h)}}\right)^{\alpha}, \quad \alpha \in (0, 1) \tag{76}
$$</p>
<p>$\alpha &lt; 1$æ—¶è£å‰ªæ›´æ¸©å’Œã€‚</p>
<h4 id="113-maxoutput">11.3 MaxOutputè£å‰ª</h4>
<p>å¯¹äºè¾“å‡ºå±‚ï¼Œå®šä¹‰MaxOutputï¼š</p>
<p>$$
O_{\max} = \max_{i,j} |O_{ij}| \tag{77}
$$</p>
<p>ç±»ä¼¼åœ°è£å‰ª$\boldsymbol{W}_o$ï¼š</p>
<p>$$
\text{if } O_{\max}^{(l)} > \tau_o: \quad \boldsymbol{W}_o^{(l)} \leftarrow \frac{\tau_o}{O_{\max}^{(l)}} \boldsymbol{W}_o^{(l)} \tag{78}
$$</p>
<p><strong>æŒ‘æˆ˜</strong>ï¼šè¾“å‡ºæ˜¯å¤šç»´çš„ï¼ŒPer-Dimè£å‰ªæˆæœ¬é«˜ã€‚å¯èƒ½éœ€è¦Per-Layeræˆ–Per-Headçš„æŠ˜ä¸­ã€‚</p>
<h3 id="12">12. å®éªŒéªŒè¯ä¸åˆ†æ</h3>
<h4 id="121">12.1 ç†è®ºé¢„æµ‹</h4>
<p><strong>é¢„æµ‹1</strong>ï¼šMuonè®­ç»ƒçš„æ¨¡å‹ï¼Œæƒé‡æœ‰æ•ˆç§©æ›´é«˜ã€‚</p>
<p>éªŒè¯ï¼šè®¡ç®—æƒé‡çš„å¥‡å¼‚å€¼ç†µï¼š</p>
<p>$$
H(\boldsymbol{W}) = -\sum_i p_i \log p_i, \quad p_i = \frac{\sigma_i}{\sum_j \sigma_j} \tag{79}
$$</p>
<p>è§‚å¯Ÿåˆ°ï¼š$H(\boldsymbol{W}^{\text{Muon}}) &gt; H(\boldsymbol{W}^{\text{Adam}})$ã€‚</p>
<p><strong>é¢„æµ‹2</strong>ï¼šQK-Clipåï¼ŒMaxLogitè¢«æ§åˆ¶åœ¨$\tau$ä»¥ä¸‹ã€‚</p>
<p>éªŒè¯ï¼šç›‘æ§$S_{\max}^{(l,h)}(t)$ï¼Œç¡®è®¤$S_{\max}^{(l,h)}(t) \leq \tau + \epsilon$ã€‚</p>
<p><strong>é¢„æµ‹3</strong>ï¼šé•¿æœŸè®­ç»ƒåï¼Œæƒé‡è¡°å‡ä½¿MaxLogitè‡ªç„¶ä¸‹é™ã€‚</p>
<p>éªŒè¯ï¼šKimi K2åœ¨70k stepsåï¼ŒMaxLogitè‡ªåŠ¨é™ä½åˆ°100ä»¥ä¸‹ã€‚</p>
<h4 id="122">12.2 æ¶ˆèå®éªŒ</h4>
<p><strong>å®éªŒ1</strong>ï¼šå›ºå®š$\tau$çš„å½±å“</p>
<table>
<thead>
<tr>
<th>$\tau$</th>
<th>è®­ç»ƒç¨³å®šæ€§</th>
<th>æœ€ç»ˆLoss</th>
<th>MaxLogitçˆ†ç‚¸</th>
</tr>
</thead>
<tbody>
<tr>
<td>30</td>
<td>ç¨³å®š</td>
<td>2.45</td>
<td>æ— </td>
</tr>
<tr>
<td>100</td>
<td>ç¨³å®š</td>
<td>2.43</td>
<td>æ— </td>
</tr>
<tr>
<td>300</td>
<td>å¶å°”ä¸ç¨³</td>
<td>2.44</td>
<td>å°‘æ•°Head</td>
</tr>
<tr>
<td>æ— é™</td>
<td>ä¸ç¨³å®š</td>
<td>NaN</td>
<td>ä¸¥é‡</td>
</tr>
</tbody>
</table>
<p>ç»“è®ºï¼š$\tau = 100$æ˜¯è‰¯å¥½çš„å¹³è¡¡ç‚¹ã€‚</p>
<p><strong>å®éªŒ2</strong>ï¼šPer-Head vs Per-Layerè£å‰ª</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¢«è£å‰ªçš„Headæ¯”ä¾‹</th>
<th>æœ‰æ•ˆHeadæ•°</th>
<th>æœ€ç»ˆæ€§èƒ½</th>
</tr>
</thead>
<tbody>
<tr>
<td>Per-Layer</td>
<td>100%</td>
<td>85%</td>
<td>è¾ƒå·®</td>
</tr>
<tr>
<td>Per-Head</td>
<td>15%</td>
<td>98%</td>
<td>æ­£å¸¸</td>
</tr>
</tbody>
</table>
<p>ç»“è®ºï¼šPer-Headé¿å…äº†è¿‡åº¦è£å‰ªã€‚</p>
<h4 id="123">12.3 ä¸å…¶ä»–æ–¹æ³•å¯¹æ¯”</h4>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>MaxLogitæ§åˆ¶</th>
<th>å…¼å®¹MLA</th>
<th>è®¡ç®—å¼€é”€</th>
<th>æ•ˆæœå½±å“</th>
</tr>
</thead>
<tbody>
<tr>
<td>Weight Decay</td>
<td>éƒ¨åˆ†</td>
<td>æ˜¯</td>
<td>ä½</td>
<td>ä¸­ï¼ˆå¤§WDæŸå¤±æ•ˆæœï¼‰</td>
</tr>
<tr>
<td>Softcap</td>
<td>å¦ï¼ˆåªæ§åˆ¶è¾“å‡ºï¼‰</td>
<td>æ˜¯</td>
<td>ä½</td>
<td>æœªçŸ¥</td>
</tr>
<tr>
<td>QK-Norm</td>
<td>æ˜¯</td>
<td>å¦</td>
<td>ä¸­</td>
<td>å°</td>
</tr>
<tr>
<td><strong>QK-Clip</strong></td>
<td><strong>æ˜¯</strong></td>
<td><strong>æ˜¯</strong></td>
<td><strong>ä½</strong></td>
<td><strong>æ— </strong></td>
</tr>
</tbody>
</table>
<h3 id="13">13. ç†è®ºæ´å¯Ÿä¸å¯ç¤º</h3>
<h4 id="131">13.1 æ»¡ç§©æ›´æ–°çš„åŒåˆƒå‰‘</h4>
<p>Muonçš„æ»¡ç§©æ›´æ–°å…·æœ‰ï¼š</p>
<p><strong>ä¼˜åŠ¿</strong>ï¼š
- æ¢ç´¢æ›´å…¨é¢ï¼Œä¸å±€é™äºæ¢¯åº¦çš„ä¸»æ–¹å‘
- éšå¼æ­£åˆ™åŒ–ï¼Œé¿å…è¿‡æ‹Ÿåˆåˆ°ä½ç§©è§£
- æ³›åŒ–æ€§èƒ½å¯èƒ½æ›´å¥½</p>
<p><strong>åŠ£åŠ¿</strong>ï¼š
- æ›´å®¹æ˜“ä¸ç°æœ‰æƒé‡çš„å¥‡å¼‚å‘é‡"ç¢°æ’"
- å¯¼è‡´å¥‡å¼‚å€¼å¢é•¿ï¼Œå¼•å‘MaxLogitçˆ†ç‚¸
- éœ€è¦é¢å¤–çš„ç¨³å®šåŒ–æœºåˆ¶</p>
<h4 id="132-vs">13.2 ç›´æ¥vsé—´æ¥æ–¹æ³•</h4>
<p><strong>é—´æ¥æ–¹æ³•</strong>ï¼ˆè°ƒæ•´è¶…å‚æ•°ï¼‰ï¼š
- é™ä½å­¦ä¹ ç‡
- å¢å¤§æƒé‡è¡°å‡
- éƒ¨åˆ†QK-Norm</p>
<p><strong>ç¼ºç‚¹</strong>ï¼šä¸èƒ½ä¿è¯è§£å†³é—®é¢˜ï¼Œå¯èƒ½æŸå®³æ•ˆæœã€‚</p>
<p><strong>ç›´æ¥æ–¹æ³•</strong>ï¼ˆQK-Clipï¼‰ï¼š
- ç›´æ¥ä»¥MaxLogitä¸ºä¿¡å·
- æœ€å°åŒ–å¹²é¢„
- ä¿è¯æ§åˆ¶ç›®æ ‡</p>
<p><strong>å¯ç¤º</strong>ï¼š"å“ªé‡Œä¸ç¨³Clipå“ªé‡Œ"â€”â€”é’ˆå¯¹å…·ä½“é—®é¢˜ç›´æ¥å¹²é¢„ã€‚</p>
<h4 id="133">13.3 ä¼˜åŒ–å™¨ä¸æ¶æ„çš„ååŒè®¾è®¡</h4>
<p>QK-Clipçš„æˆåŠŸè¯´æ˜ï¼š
- ä¼˜åŒ–å™¨çš„ç‰¹æ€§ï¼ˆMuonçš„æ»¡ç§©æ›´æ–°ï¼‰
- æ¶æ„çš„ç‰¹æ€§ï¼ˆAttentionçš„åŒçº¿æ€§å½¢å¼ï¼‰
- éœ€è¦ååŒè€ƒè™‘</p>
<p><strong>è®¾è®¡åŸåˆ™</strong>ï¼š
1. ç†è§£ä¼˜åŒ–å™¨çš„æ•°å­¦ç‰¹æ€§
2. è¯†åˆ«æ¶æ„çš„è„†å¼±ç‚¹
3. é’ˆå¯¹æ€§åœ°è®¾è®¡ç¨³å®šåŒ–æœºåˆ¶</p>
<h3 id="14">14. å¼€æ”¾é—®é¢˜ä¸æœªæ¥æ–¹å‘</h3>
<h4 id="141">14.1 ç†è®ºé—®é¢˜</h4>
<ol>
<li><strong>æ”¶æ•›é€Ÿåº¦</strong>ï¼šQK-Clipå¦‚ä½•å½±å“æ”¶æ•›é€Ÿåº¦ï¼Ÿæ˜¯å¦å­˜åœ¨ç†è®ºä¿è¯ï¼Ÿ</li>
<li><strong>æœ€ä¼˜é˜ˆå€¼</strong>ï¼šå¦‚ä½•ç†è®ºä¸Šç¡®å®šæœ€ä¼˜çš„$\tau$ï¼Ÿ</li>
<li><strong>ä¸å…¶ä»–æ­£åˆ™åŒ–çš„å…³ç³»</strong>ï¼šQK-Clipä¸è°±èŒƒæ•°çº¦æŸã€Lipschitzçº¦æŸçš„å…³ç³»ï¼Ÿ</li>
</ol>
<h4 id="142">14.2 å®è·µé—®é¢˜</h4>
<ol>
<li><strong>å…¶ä»–æ¶æ„</strong>ï¼šQK-Clipåœ¨CNNã€RNNä¸­çš„åº”ç”¨ï¼Ÿ</li>
<li><strong>å…¶ä»–ä¼˜åŒ–å™¨</strong>ï¼šä¸AdaGradã€RMSpropçš„å…¼å®¹æ€§ï¼Ÿ</li>
<li><strong>è‡ªåŠ¨åŒ–</strong>ï¼šèƒ½å¦è‡ªåŠ¨æ£€æµ‹éœ€è¦è£å‰ªçš„å±‚/å‚æ•°ï¼Ÿ</li>
</ol>
<h4 id="143">14.3 æ¨å¹¿æ–¹å‘</h4>
<ol>
<li><strong>é€šç”¨å¼‚å¸¸å€¼æ§åˆ¶</strong>ï¼šç»Ÿä¸€æ¡†æ¶å¤„ç†å„ç§å¼‚å¸¸å€¼ï¼ˆMaxLogitã€MaxGradã€MaxActï¼‰</li>
<li><strong>å­¦ä¹ å¼è£å‰ª</strong>ï¼šç”¨å­¦ä¹ åˆ°çš„ç­–ç•¥æ›¿ä»£å›ºå®šè§„åˆ™</li>
<li><strong>ç†è®ºç»Ÿä¸€</strong>ï¼šå°†QK-Clipçº³å…¥ä¼˜åŒ–ç†è®ºçš„æ¡†æ¶</li>
</ol>
<h3 id="15">15. ç»“è®º</h3>
<h4 id="151">15.1 æ ¸å¿ƒè´¡çŒ®</h4>
<p>QK-Clipæä¾›äº†æ§åˆ¶MaxLogitçˆ†ç‚¸çš„ç›´æ¥ã€æœ‰æ•ˆã€é€šç”¨çš„æ–¹æ³•ï¼š
1. <strong>ç›´æ¥æ€§</strong>ï¼šä»¥MaxLogitä¸ºä¿¡å·ï¼Œç›´æ¥è£å‰ªæƒé‡
2. <strong>æœ‰æ•ˆæ€§</strong>ï¼šç†è®ºä¿è¯å’Œå®éªŒéªŒè¯
3. <strong>é€šç”¨æ€§</strong>ï¼šå…¼å®¹MHAã€GQAã€MLAç­‰æ¶æ„
4. <strong>æ— æŸæ€§</strong>ï¼šå¯¹æœ€ç»ˆæ•ˆæœæ— è´Ÿé¢å½±å“</p>
<h4 id="152">15.2 æ•°å­¦ç²¾é«“</h4>
<ul>
<li>Muonçš„æ»¡ç§©æ›´æ–°å¯¼è‡´å¥‡å¼‚å€¼ç¢°æ’æ¦‚ç‡å¢åŠ </li>
<li>Attentionçš„åŒçº¿æ€§å½¢å¼æ”¾å¤§äº†è°±èŒƒæ•°å¢é•¿</li>
<li>QK-Clipé€šè¿‡äº‹åè£å‰ªç›´æ¥æ§åˆ¶è°±èŒƒæ•°</li>
<li>Per-Headè£å‰ªé¿å…è¿‡åº¦å¹²é¢„</li>
</ul>
<h4 id="153">15.3 å®è·µä»·å€¼</h4>
<p>QK-Clipæ˜¯Muonåœ¨è¶…å¤§è§„æ¨¡è®­ç»ƒï¼ˆåƒäº¿å‚æ•°ä»¥ä¸Šï¼‰ä¸­çš„å…³é”®æŠ€æœ¯ï¼Œä½¿å¾—ï¼š
- Muon + MLA æˆä¸ºå¯è¡Œçš„ç»„åˆ
- è®­ç»ƒç¨³å®šæ€§å¤§å¹…æå‡
- ä¸ºKimi K2ç­‰ä¸‡äº¿å‚æ•°æ¨¡å‹çš„æˆåŠŸæä¾›ä¿éšœ</p>
        </div>
    </div>
</body>
</html>