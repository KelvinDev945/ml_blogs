<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muonç»­é›†ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬é€‰æ‹©å°è¯•Muonï¼Ÿ</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>Muonç»­é›†ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬é€‰æ‹©å°è¯•Muonï¼Ÿ</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-26 | ğŸ“„ å¤§å°: 49.1 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/10739">https://spaces.ac.cn/archives/10739</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>æœ¬æ–‡è§£è¯»ä¸€ä¸‹æˆ‘ä»¬æœ€æ–°çš„æŠ€æœ¯æŠ¥å‘Š<a href="https://papers.cool/arxiv/2502.16982">ã€ŠMuon is Scalable for LLM Trainingã€‹</a>ï¼Œé‡Œè¾¹åˆ†äº«äº†æˆ‘ä»¬ä¹‹å‰åœ¨<a href="/archives/10592">ã€ŠMuonä¼˜åŒ–å™¨èµæï¼šä»å‘é‡åˆ°çŸ©é˜µçš„æœ¬è´¨è·¨è¶Šã€‹</a>ä»‹ç»è¿‡çš„Muonä¼˜åŒ–å™¨çš„ä¸€æ¬¡è¾ƒå¤§è§„æ¨¡çš„å®è·µï¼Œå¹¶å¼€æºäº†ç›¸åº”çš„æ¨¡å‹ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œ<a href="https://github.com/MoonshotAI/Moonlight">Moonlight</a>â€ï¼Œç›®å‰æ˜¯ä¸€ä¸ª3B/16Bçš„MoEæ¨¡å‹ï¼‰ã€‚æˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªæ¯”è¾ƒæƒŠäººçš„ç»“è®ºï¼šåœ¨æˆ‘ä»¬çš„å®éªŒè®¾ç½®ä¸‹ï¼ŒMuonç›¸æ¯”Adamèƒ½å¤Ÿè¾¾åˆ°å°†è¿‘2å€çš„è®­ç»ƒæ•ˆç‡ã€‚</p>
<p><a href="/usr/uploads/2025/02/1300601661.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="Muonçš„Scaling LawåŠMoonlightçš„MMLUè¡¨ç°" src="/usr/uploads/2025/02/1300601661.png" /></a></p>
<p>Muonçš„Scaling LawåŠMoonlightçš„MMLUè¡¨ç°</p>
<p>ä¼˜åŒ–å™¨çš„å·¥ä½œè¯´å¤šä¸å¤šï¼Œä½†è¯´å°‘ä¹Ÿä¸å°‘ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¼šé€‰æ‹©Muonæ¥ä½œä¸ºæ–°çš„å°è¯•æ–¹å‘å‘¢ï¼Ÿå·²ç»è°ƒå¥½è¶…å‚çš„Adamä¼˜åŒ–å™¨ï¼Œæ€ä¹ˆå¿«é€Ÿåˆ‡æ¢åˆ°Muonä¸Šè¿›è¡Œå°è¯•å‘¢ï¼Ÿæ¨¡å‹Scaleä¸Šå»ä¹‹åï¼ŒMuonä¸Adamçš„æ€§èƒ½æ•ˆæœå·®å¼‚å¦‚ä½•ï¼Ÿæ¥ä¸‹æ¥å°†åˆ†äº«æˆ‘ä»¬çš„æ€è€ƒè¿‡ç¨‹ã€‚</p>
<h2 id="_1">ä¼˜åŒ–åŸç†</h2>
<p>å…³äºä¼˜åŒ–å™¨ï¼Œå…¶å®ç¬”è€…ä¹‹å‰åœ¨<a href="/archives/10592">ã€ŠMuonä¼˜åŒ–å™¨èµæï¼šä»å‘é‡åˆ°çŸ©é˜µçš„æœ¬è´¨è·¨è¶Šã€‹</a>æ—¶å°±æœ‰è¿‡æµ…è¯„ï¼Œå¤šæ•°ä¼˜åŒ–å™¨æ”¹è¿›å®é™…ä¸Šéƒ½åªæ˜¯ä¸€äº›å°è¡¥ä¸ï¼Œä¸èƒ½è¯´æ¯«æ— ä»·å€¼ï¼Œä½†ç»ˆç©¶æ²¡èƒ½ç»™äººä¸€ç§æ·±åˆ»å’ŒæƒŠè‰³çš„æ„Ÿè§‰ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦ä»æ›´è´´è¿‘æœ¬è´¨çš„åŸç†å‡ºå‘ï¼Œæ¥æ€è€ƒä»€ä¹ˆæ‰æ˜¯å¥½çš„ä¼˜åŒ–å™¨ã€‚ç›´è§‚æ¥æƒ³ï¼Œç†æƒ³çš„ä¼˜åŒ–å™¨åº”å½“æœ‰ä¸¤ä¸ªç‰¹æ€§ï¼š<strong>ç¨³</strong> å’Œ<strong>å¿«</strong> ã€‚å…·ä½“æ¥è¯´ï¼Œç†æƒ³çš„ä¼˜åŒ–å™¨æ¯ä¸€æ­¥çš„æ›´æ–°åº”è¯¥æ»¡è¶³ä¸¤ç‚¹ï¼š1ã€å¯¹æ¨¡å‹æ‰°åŠ¨å°½å¯èƒ½å°ï¼›2ã€å¯¹Lossè´¡çŒ®å°½å¯èƒ½å¤§ã€‚è¯´æ›´ç›´æ¥ç‚¹ï¼Œå°±æ˜¯æˆ‘ä»¬ä¸å¸Œæœ›å¤§æ”¹æ¨¡å‹ï¼ˆç¨³ï¼‰ï¼Œä½†å¸Œæœ›å¤§é™Lossï¼ˆå¿«ï¼‰ï¼Œå…¸å‹çš„â€œæ—¢è¦...åˆè¦...â€ã€‚</p>
<p>æ€ä¹ˆå°†è¿™ä¸¤ä¸ªç‰¹æ€§è½¬åŒ–ä¸ºæ•°å­¦è¯­è¨€å‘¢ï¼Ÿ<strong>ç¨³</strong> æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºå¯¹æ›´æ–°é‡çš„ä¸€ä¸ªçº¦æŸï¼Œè€Œ<strong>å¿«</strong> åˆ™å¯ä»¥ç†è§£ä¸ºå¯»æ‰¾è®©æŸå¤±å‡½æ•°ä¸‹é™æœ€å¿«çš„æ›´æ–°é‡ï¼Œæ‰€ä»¥è¿™å¯ä»¥è½¬åŒ–ä¸ºä¸€ä¸ªçº¦æŸä¼˜åŒ–é—®é¢˜ã€‚ç”¨å›å‰æ–‡çš„è®°å·ï¼Œå¯¹äºçŸ©é˜µå‚æ•°$\boldsymbol{W}\in\mathbb{R}^{n\times m}$ï¼Œå…¶æ¢¯åº¦ä¸º$\boldsymbol{G}\in\mathbb{R}^{n\times m}$ï¼Œå½“å‚æ•°ç”±$\boldsymbol{W}$å˜æˆ$\boldsymbol{W}+\Delta\boldsymbol{W}$æ—¶ï¼ŒæŸå¤±å‡½æ•°çš„å˜åŒ–é‡ä¸º<br />
\begin{equation}\text{Tr}(\boldsymbol{G}^{\top}\Delta\boldsymbol{W})\end{equation}<br />
é‚£ä¹ˆåœ¨<strong>ç¨³</strong> çš„å‰æä¸‹å¯»æ‰¾<strong>å¿«</strong> çš„æ›´æ–°é‡ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¡¨ç¤ºä¸º<br />
\begin{equation}\mathop{\text{argmin}}_{\Delta\boldsymbol{W}}\text{Tr}(\boldsymbol{G}^{\top}\Delta\boldsymbol{W})\quad\text{s.t.}\quad \rho(\Delta\boldsymbol{W})\leq \eta\label{eq:least-action}\end{equation}<br />
è¿™é‡Œ$\rho(\Delta\boldsymbol{W})\geq 0$æ˜¯<strong>ç¨³</strong> çš„æŸä¸ªæŒ‡æ ‡ï¼Œè¶Šå°è¡¨ç¤ºè¶Šç¨³ï¼Œè€Œ$\eta$æ˜¯æŸä¸ªå°äº1çš„å¸¸æ•°ï¼Œè¡¨ç¤ºæˆ‘ä»¬å¯¹<strong>ç¨³</strong> çš„è¦æ±‚ï¼Œåé¢æˆ‘ä»¬ä¼šçœ‹åˆ°å®ƒå®é™…ä¸Šå°±æ˜¯ä¼˜åŒ–å™¨çš„å­¦ä¹ ç‡ã€‚å¦‚æœè¯»è€…ä¸ä»‹æ„ï¼Œæˆ‘ä»¬å¯ä»¥æ¨¡ä»¿ç†è®ºç‰©ç†çš„æ¦‚å¿µï¼Œç§°ä¸Šè¿°åŸç†ä¸ºä¼˜åŒ–å™¨çš„â€œ<strong>æœ€å°ä½œç”¨é‡åŸç†ï¼ˆLeast Action Principleï¼‰</strong> â€ã€‚</p>
<h2 id="_2">çŸ©é˜µèŒƒæ•°</h2>
<p>å¼$\eqref{eq:least-action}$å”¯ä¸€ä¸ç¡®å®šçš„å°±æ˜¯<strong>ç¨³</strong> çš„åº¦é‡$\rho(\Delta\boldsymbol{W})$ï¼Œé€‰å®š$\rho(\Delta\boldsymbol{W})$åå°±å¯ä»¥æŠŠ$\Delta\boldsymbol{W}$æ˜ç¡®æ±‚è§£å‡ºæ¥ï¼ˆè‡³å°‘ç†è®ºä¸Šæ²¡é—®é¢˜ï¼‰ã€‚æŸç§ç¨‹åº¦ä¸Šæ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºä¸åŒä¼˜åŒ–å™¨çš„æœ¬è´¨å·®å¼‚å°±æ˜¯å®ƒä»¬å¯¹<strong>ç¨³</strong> çš„å®šä¹‰ä¸ä¸€æ ·ã€‚</p>
<p>å¾ˆå¤šè¯»è€…åœ¨åˆšå­¦ä¹ SGDæ—¶æƒ³å¿…éƒ½çœ‹åˆ°è¿‡ç±»ä¼¼â€œæ¢¯åº¦åæ–¹å‘æ˜¯å‡½æ•°å€¼å±€éƒ¨ä¸‹é™æœ€å¿«çš„æ–¹å‘â€çš„è¯´æ³•ï¼Œæ”¾åˆ°è¿™é‡Œçš„æ¡†æ¶æ¥çœ‹ï¼Œå®ƒå…¶å®å°±æ˜¯æŠŠ<strong>ç¨³</strong> çš„åº¦é‡é€‰æ‹©ä¸ºçŸ©é˜µçš„$F$èŒƒæ•°$\Vert\Delta\boldsymbol{W}\Vert_F$ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œâ€œä¸‹é™æœ€å¿«çš„æ–¹å‘â€å¹¶ä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œé€‰å®šåº¦é‡åæ‰èƒ½æŠŠå®ƒç¡®å®šä¸‹æ¥ï¼Œæ¢ä¸€ä¸ªèŒƒæ•°å°±ä¸ä¸€å®šæ˜¯æ¢¯åº¦åæ–¹å‘äº†ã€‚</p>
<p>æ¥ä¸‹æ¥çš„é—®é¢˜è‡ªç„¶æ˜¯ä»€ä¹ˆèŒƒæ•°æ‰èƒ½æœ€æ°å½“åœ°åº¦é‡<strong>ç¨³</strong> ï¼Ÿå¦‚æœæˆ‘ä»¬åŠ äº†å¼ºçº¦æŸï¼Œé‚£ä¹ˆç¨³åˆ™ç¨³çŸ£ï¼Œä½†ä¼˜åŒ–å™¨ä¸¾æ­¥ç»´è‰°ï¼Œåªèƒ½æ”¶æ•›åˆ°æ¬¡ä¼˜è§£ï¼›ç›¸åå¦‚æœå‡å¼±çº¦æŸï¼Œé‚£ä¹ˆä¼˜åŒ–å™¨æ”¾é£è‡ªæˆ‘ï¼Œé‚£ä¹ˆè®­ç»ƒè¿›ç¨‹å°†ä¼šæåº¦ä¸å¯æ§ã€‚æ‰€ä»¥ï¼Œæœ€ç†æƒ³çš„æƒ…å†µå°±èƒ½æ‰¾åˆ°<strong>ç¨³</strong> çš„æœ€ç²¾å‡†æŒ‡æ ‡ã€‚è€ƒè™‘åˆ°ç¥ç»ç½‘ç»œä»¥çŸ©é˜µä¹˜æ³•ä¸ºä¸»ï¼Œæˆ‘ä»¬ä»¥$\boldsymbol{y}=\boldsymbol{x}\boldsymbol{W}$ä¸ºä¾‹ï¼Œæœ‰<br />
\begin{equation}\Vert\Delta \boldsymbol{y}\Vert = \Vert\boldsymbol{x}(\boldsymbol{W} + \Delta\boldsymbol{W}) - \boldsymbol{x}\boldsymbol{W}\Vert = \Vert\boldsymbol{x} \Delta\boldsymbol{W}\Vert\leq \rho(\Delta\boldsymbol{W}) \Vert\boldsymbol{x}\Vert\end{equation}<br />
ä¸Šå¼çš„æ„æ€æ˜¯ï¼Œå½“å‚æ•°ç”±$\boldsymbol{W}$å˜æˆ$\boldsymbol{W}+\Delta\boldsymbol{W}$æ—¶ï¼Œæ¨¡å‹è¾“å‡ºå˜åŒ–é‡ä¸º$\Delta\boldsymbol{y}$ï¼Œæˆ‘ä»¬å¯„æœ›äºè¿™ä¸ªå˜åŒ–é‡çš„æ¨¡é•¿èƒ½å¤Ÿè¢«$\Vert\boldsymbol{x}\Vert$ä»¥åŠ$\Delta\boldsymbol{W}$ç›¸å…³çš„ä¸€ä¸ªå‡½æ•°$\rho(\Delta\boldsymbol{W})$æ§åˆ¶ï¼Œæˆ‘ä»¬å°±ç”¨è¿™ä¸ªå‡½æ•°ä½œä¸º<strong>ç¨³</strong> çš„æŒ‡æ ‡ã€‚ä»çº¿æ€§ä»£æ•°æˆ‘ä»¬çŸ¥é“ï¼Œ$\rho(\Delta\boldsymbol{W})$çš„æœ€å‡†ç¡®å€¼å°±æ˜¯$\Delta\boldsymbol{W}$çš„è°±èŒƒæ•°$\Vert\Delta\boldsymbol{W}\Vert_2$ï¼Œä»£å…¥å¼$\eqref{eq:least-action}$å¾—åˆ°<br />
\begin{equation}\mathop{\text{argmin}}<em _:_:r_="[:,:r]">{\Delta\boldsymbol{W}}\text{Tr}(\boldsymbol{G}^{\top}\Delta\boldsymbol{W})\quad\text{s.t.}\quad \Vert\Delta\boldsymbol{W}\Vert_2\leq \eta\end{equation}<br />
è¿™ä¸ªä¼˜åŒ–é—®é¢˜æ±‚è§£å‡ºæ¥å°±æ˜¯$\beta=0$çš„Muonï¼š<br />
\begin{equation}\Delta\boldsymbol{W} = -\eta\, \text{msign}(\boldsymbol{G}) = -\eta\,\boldsymbol{U}</em>}\boldsymbol{V}_{[:,:r]}^{\top}, \quad \boldsymbol{U},\boldsymbol{\Sigma},\boldsymbol{V}^{\top} = \mathop{\text{SVD}}(\boldsymbol{G})\end{equation<br />
å½“$\beta &gt; 0$æ—¶ï¼Œ$\boldsymbol{G}$æ¢æˆåŠ¨é‡$\boldsymbol{M}$ï¼Œ$\boldsymbol{M}$å¯ä»¥çœ‹ä½œæ˜¯å¯¹æ¢¯åº¦æ›´å¹³æ»‘çš„ä¼°è®¡ï¼Œæ‰€ä»¥ä¾ç„¶å¯ä»¥ç†è§£ä¸ºä¸Šå¼çš„ç»“è®ºï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¾—å‡ºâ€œMuonå°±æ˜¯è°±èŒƒæ•°ä¸‹çš„æœ€é€Ÿä¸‹é™â€çš„è¯´æ³•ï¼Œè‡³äºNewton-schulzè¿­ä»£ä¹‹ç±»çš„ï¼Œåˆ™æ˜¯è®¡ç®—ä¸Šçš„è¿‘ä¼¼ï¼Œè¿™é‡Œå°±ä¸ç»†è¯´ã€‚è¯¦ç»†æ¨å¯¼æˆ‘ä»¬åœ¨<a href="/archives/10592">ã€ŠMuonä¼˜åŒ–å™¨èµæï¼šä»å‘é‡åˆ°çŸ©é˜µçš„æœ¬è´¨è·¨è¶Šã€‹</a>å·²ç»ç»™å‡ºï¼Œä¹Ÿä¸å†é‡å¤ã€‚</p>
<h2 id="_3">æƒé‡è¡°å‡</h2>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å›ç­”ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆé€‰æ‹©å°è¯•Muonï¼Ÿå› ä¸ºè·ŸSGDä¸€æ ·ï¼ŒMuonç»™å‡ºçš„åŒæ ·æ˜¯ä¸‹é™æœ€å¿«çš„æ–¹å‘ï¼Œä½†å®ƒçš„è°±èŒƒæ•°çº¦æŸæ¯”SGDçš„$F$èŒƒæ•°æ›´ä¸ºç²¾å‡†ï¼Œæ‰€ä»¥æœ‰æ›´ä½³çš„æ½œåŠ›ã€‚å¦ä¸€æ–¹é¢ï¼Œä»â€œä¸ºä¸åŒçš„å‚æ•°é€‰æ‹©æœ€æ°å½“çš„çº¦æŸâ€è§’åº¦æ¥æ”¹è¿›ä¼˜åŒ–å™¨ï¼Œçœ‹èµ·æ¥ä¹Ÿæ¯”å„ç§è¡¥ä¸å¼ä¿®æ”¹æ›´ä¸ºæœ¬è´¨ã€‚</p>
<p>å½“ç„¶ï¼Œæ½œåŠ›ä¸æ„å‘³ç€å®åŠ›ï¼Œåœ¨æ›´å¤§å°ºå¯¸çš„æ¨¡å‹ä¸ŠéªŒè¯Muonå­˜åœ¨ä¸€äº›â€œé™·é˜±â€ã€‚é¦–å…ˆç™»åœºçš„æ˜¯Weight Decayé—®é¢˜ï¼Œå°½ç®¡æˆ‘ä»¬åœ¨<a href="/archives/10592">ã€ŠMuonä¼˜åŒ–å™¨èµæï¼šä»å‘é‡åˆ°çŸ©é˜µçš„æœ¬è´¨è·¨è¶Šã€‹</a>ä»‹ç»Muonçš„æ—¶å€™å¸¦ä¸Šäº†Weight Decayï¼Œä½†å®é™…ä¸Šä½œè€…æå‡ºMuonæ—¶æ˜¯æ²¡æœ‰çš„ï¼Œè€Œæˆ‘ä»¬ä¸€å¼€å§‹ä¹ŸæŒ‰ç…§å®˜æ–¹ç‰ˆæœ¬æ¥å®ç°ï¼Œç»“æœå‘ç°Muonå‰æœŸæ”¶æ•›æ˜¯å¿«ï¼Œä½†å¾ˆå¿«å°±è¢«Adamè¿½ä¸Šäº†ï¼Œè€Œä¸”å„ç§â€œå†…ç§‘â€è¿˜æœ‰å´©æºƒçš„è‹—å¤´ã€‚</p>
<p>æˆ‘ä»¬å¾ˆå¿«æ„è¯†åˆ°è¿™å¯èƒ½æ˜¯Weight Decayçš„é—®é¢˜ï¼Œäºæ˜¯è¡¥ä¸ŠWeight Decayï¼š<br />
\begin{equation}\Delta\boldsymbol{W} = -\eta\, [\text{msign}(\boldsymbol{M})+ \lambda \boldsymbol{W}]\end{equation}<br />
ç»§ç»­å®éªŒï¼Œæœä¸å…¶ç„¶ï¼Œè¿™æ—¶å€™Muonä¸€ç›´ä¿æŒé¢†å…ˆäºAdamï¼Œå¦‚è®ºæ–‡Figure 2æ‰€ç¤ºï¼š  </p>
<p><a href="/usr/uploads/2025/02/3675708776.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="æœ‰æ— Weight Decayçš„æ•ˆæœæ¯”è¾ƒ" src="/usr/uploads/2025/02/3675708776.png" /></a></p>
<p>æœ‰æ— Weight Decayçš„æ•ˆæœæ¯”è¾ƒ</p>
<p>Weight Decayèµ·åˆ°ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿäº‹ååˆ†ææ¥çœ‹ï¼Œå¯èƒ½æ¯”è¾ƒå…³é”®çš„åœ°æ–¹æ˜¯èƒ½å¤Ÿè®©å‚æ•°èŒƒæ•°ä¿æŒæœ‰ç•Œï¼š<br />
\begin{equation}\begin{aligned}<br />
\Vert\boldsymbol{W}<em t-1="t-1">t\Vert =&amp;\, \Vert\boldsymbol{W}</em>} - \eta_t (\boldsymbol{\Phi<em t-1="t-1">t + \lambda \boldsymbol{W}</em>)\Vert \\\[5pt]<br />
=&amp;\, \Vert(1 - \eta_t \lambda)\boldsymbol{W}<em t-1="t-1">{t-1} - \eta_t \lambda (\boldsymbol{\Phi}_t/\lambda)\Vert \\\[5pt]<br />
\leq &amp;\,(1 - \eta_t \lambda)\Vert\boldsymbol{W}</em>}\Vert + \eta_t \lambda \Vert\boldsymbol{\Phi<em t-1="t-1">t/\lambda\Vert \\\[5pt]<br />
\leq &amp;\,\max(\Vert\boldsymbol{W}</em>}\Vert,\Vert\boldsymbol{\Phi<em t-1="t-1">t/\lambda\Vert) \\\[5pt]<br />
\end{aligned}\end{equation}<br />
è¿™é‡Œçš„$\Vert\cdot\Vert$æ˜¯ä»»æ„ä¸€ç§çŸ©é˜µèŒƒæ•°ï¼Œå³ä¸Šè¿°ä¸ç­‰å¼å¯¹äºä»»æ„çŸ©é˜µèŒƒæ•°éƒ½æ˜¯æˆç«‹çš„ï¼Œ$\boldsymbol{\Phi}_t$æ˜¯ä¼˜åŒ–å™¨ç»™å‡ºçš„æ›´æ–°å‘é‡ï¼Œå¯¹Muonæ¥è¯´æ˜¯$\text{msign}(\boldsymbol{M})$ï¼Œå½“æˆ‘ä»¬å–è°±èŒƒæ•°æ—¶ï¼Œæœ‰$\Vert\text{msign}(\boldsymbol{M})\Vert_2 = 1$ï¼Œæ‰€ä»¥å¯¹äºMuonæ¥è¯´æœ‰<br />
\begin{equation}<br />
\Vert\boldsymbol{W}_t\Vert_2 \leq \max(\Vert\boldsymbol{W}</em>}\Vert_2,1/\lambda)\leq\cdots \leq \max(\Vert\boldsymbol{W}_0\Vert_2,1/\lambda)\end{equation<br />
è¿™ä¿è¯äº†æ¨¡å‹â€œå†…ç§‘â€çš„å¥åº·ï¼Œå› ä¸º$\Vert\boldsymbol{x}\boldsymbol{W}\Vert\leq \Vert\boldsymbol{x}\Vert\Vert\boldsymbol{W}\Vert_2$ï¼Œ$\Vert\boldsymbol{W}\Vert_2$è¢«æ§åˆ¶ä½äº†ï¼Œæ„å‘³ç€$\Vert\boldsymbol{x}\boldsymbol{W}\Vert$ä¹Ÿè¢«æ§åˆ¶ä½äº†ï¼Œå°±ä¸ä¼šæœ‰çˆ†ç‚¸çš„é£é™©ï¼Œè¿™å¯¹äºAttention Logitsçˆ†ç‚¸ç­‰é—®é¢˜ä¹Ÿå°¤å…¶é‡è¦ã€‚å½“ç„¶è¿™ä¸ªä¸Šç•Œåœ¨å¤šæ•°æƒ…å†µä¸‹è¿˜æ˜¯ç›¸å½“å®½æ¾çš„ï¼Œå®é™…ä¸­å‚æ•°çš„è°±èŒƒæ•°å¤šæ•°ä¼šæ˜æ˜¾å°äºè¿™ä¸ªä¸Šç•Œï¼Œè¿™ä¸ªä¸ç­‰å…³ç³»åªæ˜¯ç®€å•æ˜¾ç¤ºWeight Decayæœ‰æ§åˆ¶èŒƒæ•°çš„æ€§è´¨å­˜åœ¨ã€‚</p>
<h2 id="rms">RMSå¯¹é½</h2>
<p>å½“æˆ‘ä»¬å†³å®šå»å°è¯•æ–°çš„ä¼˜åŒ–å™¨æ—¶ï¼Œä¸€ä¸ªæ¯”è¾ƒå¤´ç–¼çš„é—®é¢˜æ˜¯å¦‚ä½•å¿«é€Ÿæ‰¾åˆ°æ¥è¿‘æœ€ä¼˜çš„è¶…å‚æ•°ï¼Œæ¯”å¦‚Muonè‡³å°‘æœ‰å­¦ä¹ ç‡$\eta_t$å’Œè¡°å‡ç‡$\lambda$ä¸¤ä¸ªè¶…å‚æ•°ã€‚ç½‘æ ¼æœç´¢è‡ªç„¶æ˜¯å¯ä»¥ï¼Œä½†æ¯”è¾ƒè´¹æ—¶è´¹åŠ›ï¼Œè¿™é‡Œæˆ‘ä»¬æå‡ºUpdate RMSå¯¹é½çš„è¶…å‚è¿ç§»æ€è·¯ï¼Œå¯ä»¥å°†Adamè°ƒå¥½çš„è¶…å‚æ•°ç”¨åˆ°å…¶ä»–ä¼˜åŒ–å™¨ä¸Šã€‚</p>
<p>é¦–å…ˆï¼Œå¯¹äºä¸€ä¸ªçŸ©é˜µ$\boldsymbol{W}\in\mathbb{R}^{n\times m}$ï¼Œå®ƒçš„RMSï¼ˆRoot Mean Squareï¼‰å®šä¹‰ä¸º<br />
\begin{equation}\text{RMS}(\boldsymbol{W}) = \frac{\Vert \boldsymbol{W}\Vert_F}{\sqrt{nm}} = \sqrt{\frac{1}{nm}\sum_{i=1}^n\sum_{j=1}^m W_{i,j}^2}\end{equation}<br />
ç®€å•æ¥è¯´ï¼ŒRMSåº¦é‡äº†çŸ©é˜µæ¯ä¸ªå…ƒç´ çš„å¹³å‡å¤§å°ã€‚æˆ‘ä»¬è§‚å¯Ÿåˆ°Adamæ›´æ–°é‡çš„RMSæ˜¯æ¯”è¾ƒç¨³å®šçš„ï¼Œé€šå¸¸åœ¨0.2ï½0.4ä¹‹é—´ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ<a href="/archives/10542">ç†è®ºåˆ†æ</a>å¸¸ç”¨SignSGDä½œä¸ºAdamè¿‘ä¼¼ã€‚åŸºäºæ­¤ï¼Œæˆ‘ä»¬å»ºè®®é€šè¿‡RMS Normå°†æ–°ä¼˜åŒ–å™¨çš„Update RMSå¯¹é½åˆ°0.2ï¼š<br />
\begin{gather}<br />
\boldsymbol{W}<em t-1="t-1">t =\boldsymbol{W}</em>} - \eta_t (\boldsymbol{\Phi<em t-1="t-1">t + \lambda \boldsymbol{W}</em>) \\\[6pt]<br />
\downarrow \notag\\\[6pt]<br />
\boldsymbol{W}<em t-1="t-1">t = \boldsymbol{W}</em>} - \eta_t (0.2\, \boldsymbol{\Phi<em t-1="t-1">t/\text{RMS}(\boldsymbol{\Phi}_t) + \lambda \boldsymbol{W}</em>)<br />
\end{gather}<br />
è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¤ç”¨Adamçš„$\eta_t$å’Œ$\lambda$ï¼Œä»¥è¾¾åˆ°æ¯æ­¥å¯¹å‚æ•°çš„æ›´æ–°å¹…åº¦å¤§è‡´ç›¸åŒçš„æ•ˆæœã€‚å®è·µè¡¨æ˜ï¼Œé€šè¿‡è¿™ä¸ªç®€å•ç­–ç•¥ä»Adamè¿ç§»åˆ°Muonï¼Œå°±èƒ½è®­å‡ºæ˜æ˜¾ä¼˜äºAdamçš„æ•ˆæœï¼Œæ¥è¿‘è¿›ä¸€æ­¥å¯¹Muonè¶…å‚è¿›è¡Œç²¾æœç´¢çš„ç»“æœã€‚ç‰¹åˆ«åœ°ï¼ŒMuonçš„$\text{RMS}(\boldsymbol{\Phi}<em _:_:r_="[:,:r]">t)=\text{RMS}(\boldsymbol{U}</em>}\boldsymbol{V<em i="1">{[:,:r]}^{\top})$è¿˜å¯ä»¥è§£æåœ°ç®—å‡ºæ¥ï¼š<br />
\begin{equation}nm\,\text{RMS}(\boldsymbol{\Phi}_t)^2 = \sum</em>}^n\sum_{j=1}^m \sum_{k=1}^r U_{i,k}^2V_{k,j}^2 = \sum_{k=1}^r\left(\sum_{i=1}^n U_{i,k}^2\right)\left(\sum_{j=1}^m V_{k,j}^2\right) = \sum_{k=1}^r 1 = r\end{equation<br />
å³$\text{RMS}(\boldsymbol{\Phi}<em t-1="t-1">t) = \sqrt{r/nm}$ï¼Œå®è·µä¸­ä¸€ä¸ªçŸ©é˜µä¸¥æ ¼ä½ç§©çš„æ¦‚ç‡æ¯”è¾ƒå°ï¼Œå› æ­¤å¯ä»¥è®¤ä¸º$r = \min(n,m)$ï¼Œä»è€Œæœ‰$\text{RMS}(\boldsymbol{\Phi}_t) = \sqrt{1/\max(n,m)}$ã€‚æ‰€ä»¥æˆ‘ä»¬æœ€ç»ˆæ²¡æœ‰ç”¨RMS Normè€Œæ˜¯ç”¨ç­‰ä»·çš„è§£æç‰ˆæœ¬ï¼š<br />
\begin{equation}\boldsymbol{W}_t = \boldsymbol{W}</em>} - \eta_t (0.2\, \boldsymbol{\Phi<em t-1="t-1">t\,\sqrt{\max(n,m)} + \lambda \boldsymbol{W}</em>})\end{equation<br />
æœ€åçš„è¿™ä¸ªå¼å­ï¼Œè¡¨æ˜äº†åœ¨Muonä¸­ä¸é€‚å®œæ‰€æœ‰å‚æ•°ä½¿ç”¨åŒä¸€ä¸ªå­¦ä¹ ç‡ã€‚æ¯”å¦‚Moonlightæ˜¯ä¸€ä¸ªMoEæ¨¡å‹ï¼Œæœ‰ä¸å°‘çŸ©é˜µå‚æ•°çš„å½¢çŠ¶éƒ½åç¦»æ–¹é˜µï¼Œ$\max(n,m)$è·¨åº¦æ¯”è¾ƒå¤§ï¼Œå¦‚æœç”¨å•ä¸€å­¦ä¹ ç‡ï¼Œå¿…ç„¶ä¼šå¯¼è‡´æŸäº›å‚æ•°å­¦ä¹ è¿‡å¿«/è¿‡æ…¢çš„ä¸åŒæ­¥é—®é¢˜ï¼Œä»è€Œå½±å“æœ€ç»ˆæ•ˆæœã€‚</p>
<h2 id="_4">å®éªŒåˆ†æ</h2>
<p>æˆ‘ä»¬åœ¨2.4B/16Bè¿™ä¸ªå°ºå¯¸çš„MoEä¸Šï¼Œå¯¹Adamå’ŒMuonåšäº†æ¯”è¾ƒå……åˆ†çš„å¯¹æ¯”ï¼Œå‘ç°Muonåœ¨æ”¶æ•›é€Ÿåº¦å’Œæœ€ç»ˆæ•ˆæœä¸Šéƒ½æœ‰æ˜æ˜¾çš„ä¼˜åŠ¿ã€‚è¯¦ç»†çš„æ¯”è¾ƒç»“æœå»ºè®®å¤§å®¶å»çœ‹åŸè®ºæ–‡ï¼Œè¿™é‡Œä»…æˆªå–éƒ¨åˆ†åˆ†äº«ã€‚</p>
<blockquote>
<p><strong>Github:<a href="https://github.com/MoonshotAI/Moonlight">https://github.com/MoonshotAI/Moonlight</a></strong></p>
</blockquote>
<p>é¦–å…ˆæ˜¯ä¸€ä¸ªç›¸å¯¹å®¢è§‚çš„å¯¹ç…§è¡¨æ ¼ï¼ŒåŒ…æ‹¬æˆ‘ä»¬è‡ªå·±æ§åˆ¶å˜é‡è®­ç»ƒçš„Muonå’ŒAdamçš„å¯¹æ¯”ï¼Œä»¥åŠä¸å¤–ç•Œï¼ˆDeepSeekï¼‰ç”¨Adamè®­ç»ƒçš„åŒæ ·æ¶æ„çš„æ¨¡å‹å¯¹æ¯”ï¼ˆä¸ºäº†ä¾¿äºå¯¹æ¯”ï¼ŒMoonlightçš„æ¶æ„è·ŸDSV3-Smallå®Œå…¨ä¸€è‡´ï¼‰ï¼Œæ˜¾ç¤ºå‡ºMuonçš„ç‹¬ç‰¹ä¼˜åŠ¿ï¼š  </p>
<p><a href="/usr/uploads/2025/02/2528279021.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="Muonï¼ˆMoonlightï¼‰ vs Adamï¼ˆMoonlight-A å’ŒDSV3-smallï¼‰çš„æ¯”è¾ƒ" src="/usr/uploads/2025/02/2528279021.png" /></a></p>
<p>Muonï¼ˆMoonlightï¼‰ vs Adamï¼ˆMoonlight-A å’ŒDSV3-smallï¼‰çš„æ¯”è¾ƒ</p>
<p>Muonè®­ç»ƒå‡ºæ¥çš„æ¨¡å‹æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿæ—¢ç„¶å‰é¢æˆ‘ä»¬è¯´Muonæ˜¯è°±èŒƒæ•°ä¸‹çš„æœ€é€Ÿä¸‹é™ï¼Œè°±èŒƒæ•°æ˜¯æœ€å¤§çš„å¥‡å¼‚å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬æƒ³åˆ°äº†ç›‘æ§å’Œåˆ†æå¥‡å¼‚å€¼ã€‚æœç„¶ï¼Œæˆ‘ä»¬å‘ç°äº†ä¸€äº›æœ‰è¶£çš„ä¿¡å·ï¼ŒMuonè®­å‡ºæ¥çš„å‚æ•°ï¼Œå¥‡å¼‚å€¼åˆ†å¸ƒç›¸å¯¹æ›´å‡åŒ€ä¸€äº›ï¼Œæˆ‘ä»¬ä½¿ç”¨å¥‡å¼‚å€¼ç†µæ¥å®šé‡æè¿°è¿™ä¸ªç°è±¡ï¼š<br />
\begin{equation}H(\boldsymbol{\sigma}) = -\frac{1}{\log n}\sum_{i=1}^n \frac{\sigma_i^2}{\sum_{j=1}^n\sigma_j^2}\log \frac{\sigma_i^2}{\sum_{j=1}^n\sigma_j^2}\end{equation}<br />
è¿™é‡Œ$\boldsymbol{\sigma}=(\sigma_1,\sigma_2,\cdots,\sigma_n)$æ˜¯æŸä¸ªå‚æ•°çš„å…¨ä½“å¥‡å¼‚å€¼ã€‚Muonè®­å‡ºæ¥çš„å‚æ•°ç†µæ›´å¤§ï¼Œå³å¥‡å¼‚å€¼åˆ†å¸ƒæ›´å‡åŒ€ï¼Œæ„å‘³ç€è¿™ä¸ªå‚æ•°è¶Šä¸å®¹æ˜“å‹ç¼©ï¼Œè¿™è¯´æ˜Muonæ›´å……åˆ†å‘æŒ¥äº†å‚æ•°çš„æ½œèƒ½ï¼š  </p>
<p><a href="/usr/uploads/2025/02/3782823216.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="Muonè®­ç»ƒå‡ºæ¥çš„æƒé‡å¥‡å¼‚å€¼ç†µæ›´é«˜" src="/usr/uploads/2025/02/3782823216.png" /></a></p>
<p>Muonè®­ç»ƒå‡ºæ¥çš„æƒé‡å¥‡å¼‚å€¼ç†µæ›´é«˜</p>
<p>è¿˜æœ‰ä¸€ä¸ªæœ‰è¶£çš„å‘ç°æ˜¯å½“æˆ‘ä»¬å°†Muonç”¨äºå¾®è°ƒï¼ˆSFTï¼‰æ—¶ï¼Œå¯èƒ½ä¼šå› ä¸ºé¢„è®­ç»ƒæ²¡ç”¨Muonè€Œå¾—åˆ°æ¬¡ä¼˜è§£ã€‚å…·ä½“æ¥è¯´ï¼Œå¦‚æœé¢„è®­ç»ƒå’Œå¾®è°ƒéƒ½ç”¨Muonï¼Œé‚£ä¹ˆè¡¨ç°æ˜¯æœ€å¥½çš„ï¼Œä½†å¦‚æœæ˜¯å¦å¤–ä¸‰ç§ç»„åˆï¼ˆAdam+Muonã€Muon+Adamã€Adam+Adamï¼‰ï¼Œå…¶æ•ˆæœä¼˜åŠ£æ²¡æœ‰å‘ˆç°äºæ˜æ˜¾çš„è§„å¾‹ã€‚  </p>
<p><a href="/usr/uploads/2025/02/2697758072.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="é¢„è®­ç»ƒ/å¾®è°ƒåˆ†åˆ«ç”¨Muon/Adamçš„ç»„åˆæµ‹è¯•" src="/usr/uploads/2025/02/2697758072.png" /></a></p>
<p>é¢„è®­ç»ƒ/å¾®è°ƒåˆ†åˆ«ç”¨Muon/Adamçš„ç»„åˆæµ‹è¯•</p>
<p><a href="/usr/uploads/2025/02/3565677851.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="åœ¨å¼€æºæ¨¡å‹ä¸Šç”¨Muon/Adamå¾®è°ƒçš„å°è¯•" src="/usr/uploads/2025/02/3565677851.png" /></a></p>
<p>åœ¨å¼€æºæ¨¡å‹ä¸Šç”¨Muon/Adamå¾®è°ƒçš„å°è¯•</p>
<p>è¿™ä¸ªç°è±¡è¡¨æ˜å­˜åœ¨ä¸€äº›ç‰¹æ®Šçš„åˆå§‹åŒ–å¯¹Muonä¸åˆ©ï¼Œå½“ç„¶åè¿‡æ¥ä¹Ÿå¯èƒ½å­˜åœ¨ä¸€äº›åˆå§‹åŒ–å¯¹Muonæ›´æœ‰åˆ©ï¼Œæ›´åº•å±‚çš„åŸç†æˆ‘ä»¬è¿˜åœ¨æ¢ç´¢ä¸­ã€‚</p>
<h2 id="_5">æ‹“å±•æ€è€ƒ</h2>
<p>æ€»çš„æ¥è¯´ï¼Œåœ¨æˆ‘ä»¬çš„å®éªŒé‡Œï¼ŒMuonçš„è¡¨ç°è·ŸAdamç›¸æ¯”æ˜¾å¾—éå¸¸æœ‰ç«äº‰åŠ›ã€‚ä½œä¸ºä¸€ä¸ªå½¢å¼ä¸Šè·ŸAdamå·®å¼‚è¾ƒå¤§çš„æ–°ä¼˜åŒ–å™¨ï¼ŒMuonçš„è¿™ä¸ªè¡¨ç°å…¶å®ä¸å•å•æ˜¯â€œå¯åœˆå¯ç‚¹â€äº†ï¼Œè¿˜è¡¨æ˜å®ƒå¯èƒ½æ•æ‰åˆ°äº†ä¸€äº›æœ¬è´¨çš„ç‰¹æ€§ã€‚</p>
<p>æ­¤å‰ï¼Œç¤¾åŒºæµä¼ ç€ä¸€ä¸ªè§‚ç‚¹ï¼šAdamä¹‹æ‰€ä»¥è¡¨ç°å¥½ï¼Œæ˜¯å› ä¸ºä¸»æµçš„æ¨¡å‹æ¶æ„æ”¹è¿›éƒ½åœ¨â€œè¿‡æ‹Ÿåˆâ€Adamã€‚è¿™ä¸ªè§‚ç‚¹æœ€æ—©åº”è¯¥å‡ºè‡ª<a href="https://parameterfree.com/2020/12/06/neural-network-maybe-evolved-to-make-adam-the-best-optimizer/">ã€ŠNeural Networks (Maybe) Evolved to Make Adam The Best Optimizerã€‹</a>ï¼Œçœ‹ä¸Šå»æœ‰ç‚¹è’è°¬ï¼Œä½†å®é™…ä¸Šæ„è•´æ·±é•¿ã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œå½“æˆ‘ä»¬å°è¯•æ”¹è¿›æ¨¡å‹åï¼Œå°±ä¼šæ‹¿Adamè®­ä¸€éçœ‹æ•ˆæœï¼Œæ•ˆæœå¥½å°±ä¿ç•™ï¼Œå¦åˆ™æ”¾å¼ƒã€‚å¯è¿™ä¸ªæ•ˆæœå¥½ï¼Œç©¶ç«Ÿæ˜¯å› ä¸ºå®ƒæœ¬è´¨æ›´ä½³ï¼Œè¿˜æ˜¯å› ä¸ºå®ƒæ›´åŒ¹é…Adamäº†å‘¢ï¼Ÿ</p>
<p>è¿™å°±æœ‰ç‚¹è€äººå¯»å‘³äº†ã€‚å½“ç„¶ä¸è¯´å…¨éƒ¨ï¼Œè‚¯å®šè‡³å°‘æœ‰ä¸€éƒ¨ä»½å·¥ä½œï¼Œæ˜¯å› ä¸ºå®ƒè·ŸAdamæ›´é…è€Œè¡¨ç°å‡ºæ›´å¥½çš„æ•ˆæœï¼Œæ‰€ä»¥ä¹…è€Œä¹…ä¹‹ï¼Œæ¨¡å‹æ¶æ„å°±ä¼šæœç€ä¸€ä¸ªæœ‰åˆ©äºAdamçš„æ–¹å‘æ¼”è¿›ã€‚åœ¨è¿™ä¸ªèƒŒæ™¯ä¸‹ï¼Œä¸€ä¸ªè·ŸAdamæ˜¾è‘—ä¸åŒçš„ä¼˜åŒ–å™¨è¿˜èƒ½â€œå‡ºåœˆâ€ï¼Œå°±å°¤å…¶å€¼å¾—å…³æ³¨å’Œæ€è€ƒäº†ã€‚æ³¨æ„ç¬”è€…å’Œæ‰€åœ¨å…¬å¸éƒ½ä¸å±Muonæå‡ºè€…ï¼Œæ‰€ä»¥è¿™ç•ªè¨€è®ºçº¯å±â€œè‚ºè…‘ä¹‹è¨€â€ï¼Œå¹¶ä¸å­˜åœ¨è‡ªå–è‡ªå¤¸çš„æ„æ€ã€‚</p>
<p>æ¥ä¸‹æ¥Muonè¿˜æœ‰ä»€ä¹ˆå·¥ä½œå¯åšå‘¢ï¼Ÿå…¶å®åº”è¯¥è¿˜æœ‰ä¸å°‘ã€‚æ¯”å¦‚ä¸Šé¢æåˆ°çš„â€œAdamé¢„è®­ç»ƒ+Muonå¾®è°ƒâ€æ•ˆæœä¸ä½³é—®é¢˜ï¼Œè¿›ä¸€æ­¥åˆ†æè¿˜æ˜¯æœ‰å¿…è¦å’Œæœ‰ä»·å€¼çš„ï¼Œæ¯•ç«Ÿç°åœ¨å¤§å®¶å¼€æºçš„æ¨¡å‹æƒé‡åŸºæœ¬éƒ½æ˜¯Adamè®­çš„ï¼Œå¦‚æœMuonå¾®è°ƒä¸è¡Œï¼Œå¿…ç„¶ä¹Ÿå½±å“å®ƒçš„æ™®åŠã€‚å½“ç„¶äº†ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å€Ÿç€è¿™ä¸ªå¥‘æœºè¿›ä¸€æ­¥æ·±åŒ–å¯¹Muonç†è§£ï¼ˆé¢å‘Bugå­¦ä¹ ï¼‰ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªæ¨å¹¿çš„æ€è€ƒï¼Œå°±æ˜¯MuonåŸºäºè°±èŒƒæ•°ï¼Œè°±èŒƒæ•°æ˜¯æœ€å¤§å¥‡å¼‚å€¼ï¼Œäº‹å®ä¸ŠåŸºäºå¥‡å¼‚å€¼æˆ‘ä»¬è¿˜å¯ä»¥æ„é€ ä¸€ç³»åˆ—èŒƒæ•°ï¼Œå¦‚<a href="https://en.wikipedia.org/wiki/Schatten_norm">SchattenèŒƒæ•°</a>ï¼Œå°†å®ƒæ¨å¹¿åˆ°è¿™ç§æ›´å¹¿ä¹‰çš„èŒƒæ•°ç„¶åè¿›è¡Œè°ƒå‚ï¼Œç†è®ºä¸Šè¿˜æœ‰æœºä¼šå–å¾—æ›´å¥½çš„æ•ˆæœã€‚æ­¤å¤–ï¼ŒMoonlightå‘å¸ƒåï¼Œè¿˜æœ‰ä¸€äº›è¯»è€…é—®åˆ°Muonä¸‹<a href="https://papers.cool/arxiv/2203.03466">ÂµPï¼ˆmaximal update parametrizationï¼‰</a>å¦‚ä½•è®¾è®¡ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªäºŸå¾…è§£å†³çš„é—®é¢˜ã€‚</p>
<h2 id="_6">æ–‡ç« å°ç»“</h2>
<p>æœ¬æ–‡ä»‹ç»äº†æˆ‘ä»¬åœ¨Muonä¼˜åŒ–å™¨ä¸Šçš„ä¸€æ¬¡è¾ƒå¤§è§„æ¨¡å®è·µï¼ˆMoonlightï¼‰ï¼Œå¹¶åˆ†äº«äº†æˆ‘ä»¬å¯¹Muonä¼˜åŒ–å™¨çš„æœ€æ–°æ€è€ƒã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/10739">https://spaces.ac.cn/archives/10739</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Feb. 27, 2025). ã€ŠMuonç»­é›†ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬é€‰æ‹©å°è¯•Muonï¼Ÿ ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/10739">https://spaces.ac.cn/archives/10739</a></p>
<p>@online{kexuefm-10739,<br />
title={Muonç»­é›†ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬é€‰æ‹©å°è¯•Muonï¼Ÿ},<br />
author={è‹å‰‘æ—},<br />
year={2025},<br />
month={Feb},<br />
url={\url{https://spaces.ac.cn/archives/10739}},<br />
} </p>
<hr />
<h2 id="_7">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<p>æœ¬èŠ‚æä¾›æ–‡ç« ä¸­æ ¸å¿ƒæ¦‚å¿µçš„è¯¦ç»†æ•°å­¦æ¨å¯¼ï¼Œä»ä¼˜åŒ–ç†è®ºã€çº¿æ€§ä»£æ•°å’Œå®éªŒåˆ†æä¸‰ä¸ªè§’åº¦æ·±å…¥ç†è§£Muonä¼˜åŒ–å™¨çš„è®¾è®¡åŸç†ã€‚</p>
<h3 id="1-adam">1. Adamä¼˜åŒ–å™¨çš„å°ºåº¦ä¸ä¸€è‡´æ€§åˆ†æ</h3>
<h4 id="11-adam">1.1 Adamçš„æ›´æ–°è§„åˆ™å›é¡¾</h4>
<p>Adamä¼˜åŒ–å™¨å¯¹å‚æ•°$\boldsymbol{W} \in \mathbb{R}^{n \times m}$çš„æ›´æ–°è§„åˆ™ä¸ºï¼š</p>
<p>$$
\begin{equation}
\begin{aligned}
\boldsymbol{m}_t &= \beta_1 \boldsymbol{m}_{t-1} + (1-\beta_1) \boldsymbol{G}_t \\
\boldsymbol{v}_t &= \beta_2 \boldsymbol{v}_{t-1} + (1-\beta_2) \boldsymbol{G}_t \odot \boldsymbol{G}_t \\
\hat{\boldsymbol{m}}_t &= \frac{\boldsymbol{m}_t}{1-\beta_1^t} \\
\hat{\boldsymbol{v}}_t &= \frac{\boldsymbol{v}_t}{1-\beta_2^t} \\
\boldsymbol{W}_{t+1} &= \boldsymbol{W}_t - \alpha_t \frac{\hat{\boldsymbol{m}}_t}{\sqrt{\hat{\boldsymbol{v}}_t} + \epsilon}
\end{aligned}
\end{equation}
$$</p>
<p>å…¶ä¸­$\boldsymbol{G}_t$æ˜¯æ¢¯åº¦ï¼Œ$\odot$è¡¨ç¤ºé€å…ƒç´ ä¹˜æ³•ï¼ˆHadamardç§¯ï¼‰ï¼Œ$\sqrt{\cdot}$å’Œé™¤æ³•ä¹Ÿéƒ½æ˜¯é€å…ƒç´ æ“ä½œã€‚</p>
<h4 id="12">1.2 å‚æ•°ç»´åº¦çš„å°ºåº¦é—®é¢˜</h4>
<p>è€ƒè™‘ä¸¤ä¸ªä¸åŒå½¢çŠ¶çš„æƒé‡çŸ©é˜µï¼š
- $\boldsymbol{W}_1 \in \mathbb{R}^{1024 \times 1024}$ï¼ˆéšè—å±‚ï¼‰
- $\boldsymbol{W}_2 \in \mathbb{R}^{1024 \times 32000}$ï¼ˆè¾“å‡ºå±‚ï¼‰</p>
<p>å¯¹äºAdamï¼Œæ¯ä¸ªå‚æ•°å…ƒç´ çš„æ›´æ–°é‡çº¦ä¸ºï¼š</p>
<p>$$
\Delta W_{ij} \approx \alpha \frac{m_{ij}}{\sqrt{v_{ij}} + \epsilon} \approx \alpha \cdot \text{sign}(G_{ij})
$$</p>
<p>å½“æ¢¯åº¦ç¨³å®šåï¼Œ$\sqrt{v_{ij}}$è¿‘ä¼¼ä¸º$|m_{ij}|$ï¼Œå› æ­¤Adamçš„æ›´æ–°è¿‘ä¼¼äºSignSGDã€‚è¿™æ„å‘³ç€æ¯ä¸ªå…ƒç´ çš„æ›´æ–°å¹…åº¦ç›¸ä¼¼ï¼Œä½†å¯¹æ•´ä¸ªçŸ©é˜µçš„å½±å“å´ä¸åŒã€‚</p>
<p>å®šä¹‰çŸ©é˜µæ›´æ–°çš„æœ‰æ•ˆå°ºåº¦ä¸ºFrobeniusèŒƒæ•°ï¼š</p>
<p>$$
\Vert \Delta \boldsymbol{W}_1 \Vert_F \approx \alpha \sqrt{\sum_{i,j} 1} = \alpha \sqrt{1024 \times 1024} = 1024\alpha
$$</p>
<p>$$
\Vert \Delta \boldsymbol{W}_2 \Vert_F \approx \alpha \sqrt{1024 \times 32000} \approx 5702\alpha
$$</p>
<p>å¯è§ï¼Œå°½ç®¡ä½¿ç”¨ç›¸åŒçš„å­¦ä¹ ç‡$\alpha$ï¼Œä½†$\boldsymbol{W}_2$çš„æ›´æ–°å¹…åº¦æ˜¯$\boldsymbol{W}_1$çš„çº¦5.6å€ï¼</p>
<h4 id="13">1.3 è¾“å‡ºæ‰°åŠ¨çš„ä¸ä¸€è‡´æ€§</h4>
<p>æ›´ä¸¥é‡çš„é—®é¢˜åœ¨äºå¯¹è¾“å‡ºçš„å½±å“ã€‚è€ƒè™‘å‰å‘ä¼ æ’­$\boldsymbol{y} = \boldsymbol{x} \boldsymbol{W}$ï¼Œå½“$\boldsymbol{W} \to \boldsymbol{W} + \Delta \boldsymbol{W}$æ—¶ï¼š</p>
<p>$$
\Vert \Delta \boldsymbol{y} \Vert = \Vert \boldsymbol{x} \Delta \boldsymbol{W} \Vert
$$</p>
<p>å¯¹äºAdamçš„æ›´æ–°ï¼Œå‡è®¾$\Vert \boldsymbol{x} \Vert = 1$ï¼ˆç»è¿‡Layer Normåçš„å…¸å‹æƒ…å†µï¼‰ï¼š</p>
<p>$$
\Vert \Delta \boldsymbol{y} \Vert \leq \Vert \boldsymbol{x} \Vert \cdot \Vert \Delta \boldsymbol{W} \Vert_2
$$</p>
<p>è¿™é‡Œå…³é”®æ˜¯è°±èŒƒæ•°$\Vert \Delta \boldsymbol{W} \Vert_2$ï¼ˆçŸ©é˜µçš„æœ€å¤§å¥‡å¼‚å€¼ï¼‰ã€‚å¯¹äºAdamçš„é€å…ƒç´ æ›´æ–°ï¼š</p>
<p>$$
\Vert \Delta \boldsymbol{W} \Vert_2 \leq \Vert \Delta \boldsymbol{W} \Vert_F = O(\alpha \sqrt{nm})
$$</p>
<p>ä½†è¿™ä¸ªä¸Šç•Œéå¸¸æ¾å¼›ï¼å®é™…ä¸Šï¼Œå½“$\Delta \boldsymbol{W}$çš„å…ƒç´ æ˜¯ç‹¬ç«‹åŒåˆ†å¸ƒçš„éšæœºå˜é‡æ—¶ï¼Œç”±éšæœºçŸ©é˜µç†è®ºï¼š</p>
<p>$$
\Vert \Delta \boldsymbol{W} \Vert_2 \approx \alpha \sqrt{\max(n,m)}
$$</p>
<p>è¿™æ¯”$F$èŒƒæ•°çš„å°ºåº¦$\alpha\sqrt{nm}$è¦å°ï¼Œä½†ä»ç„¶ä¾èµ–äºçŸ©é˜µç»´åº¦ã€‚æ›´é‡è¦çš„æ˜¯ï¼ŒAdamæ— æ³•ç›´æ¥æ§åˆ¶è¿™ä¸ªé‡ï¼Œå¯¼è‡´ä¸åŒå½¢çŠ¶çŸ©é˜µçš„è¾“å‡ºæ‰°åŠ¨ä¸å¯æ§ã€‚</p>
<h3 id="2">2. æ¢¯åº¦çš„çŸ©é˜µç»“æ„æ·±åº¦åˆ†æ</h3>
<h4 id="21">2.1 å¥‡å¼‚å€¼åˆ†è§£çš„æ„ä¹‰</h4>
<p>å¯¹æ¢¯åº¦çŸ©é˜µ$\boldsymbol{G} \in \mathbb{R}^{n \times m}$è¿›è¡Œå¥‡å¼‚å€¼åˆ†è§£ï¼ˆSVDï¼‰ï¼š</p>
<p>$$
\boldsymbol{G} = \boldsymbol{U} \boldsymbol{\Sigma} \boldsymbol{V}^{\top} = \sum_{i=1}^r \sigma_i \boldsymbol{u}_i \boldsymbol{v}_i^{\top}
$$</p>
<p>å…¶ä¸­ï¼š
- $\boldsymbol{U} = [\boldsymbol{u}_1, \ldots, \boldsymbol{u}_n] \in \mathbb{R}^{n \times n}$ï¼Œ$\boldsymbol{U}^{\top}\boldsymbol{U} = \boldsymbol{I}$
- $\boldsymbol{V} = [\boldsymbol{v}_1, \ldots, \boldsymbol{v}_m] \in \mathbb{R}^{m \times m}$ï¼Œ$\boldsymbol{V}^{\top}\boldsymbol{V} = \boldsymbol{I}$
- $\boldsymbol{\Sigma} = \text{diag}(\sigma_1, \ldots, \sigma_r)$ï¼Œ$\sigma_1 \geq \sigma_2 \geq \cdots \geq \sigma_r &gt; 0$
- $r = \text{rank}(\boldsymbol{G}) \leq \min(n,m)$</p>
<p>è¿™ä¸ªåˆ†è§£çš„å‡ ä½•æ„ä¹‰ï¼š
1. $\boldsymbol{u}_i$æ˜¯è¾“å…¥ç©ºé—´çš„æ­£äº¤åŸº
2. $\boldsymbol{v}_i$æ˜¯è¾“å‡ºç©ºé—´çš„æ­£äº¤åŸº
3. $\sigma_i$æ˜¯ç¬¬$i$ä¸ªä¸»æ–¹å‘çš„é‡è¦æ€§æƒé‡</p>
<h4 id="22">2.2 æ¢¯åº¦çš„ç§©ç»“æ„</h4>
<p>åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œæ¢¯åº¦çŸ©é˜µé€šå¸¸å…·æœ‰ä½ç§©æˆ–è¿‘ä¼¼ä½ç§©ç»“æ„ã€‚è€ƒè™‘åå‘ä¼ æ’­ï¼š</p>
<p>$$
\boldsymbol{G} = \frac{\partial \mathcal{L}}{\partial \boldsymbol{W}} = \boldsymbol{x}^{\top} \frac{\partial \mathcal{L}}{\partial \boldsymbol{y}}
$$</p>
<p>å¯¹äºå•ä¸ªæ ·æœ¬ï¼Œ$\boldsymbol{x} \in \mathbb{R}^{n \times 1}$å’Œ$\frac{\partial \mathcal{L}}{\partial \boldsymbol{y}} \in \mathbb{R}^{m \times 1}$éƒ½æ˜¯å‘é‡ï¼Œå› æ­¤ï¼š</p>
<p>$$
\text{rank}(\boldsymbol{G}) = 1
$$</p>
<p>å¯¹äºæ‰¹é‡å¤§å°ä¸º$B$çš„mini-batchï¼š</p>
<p>$$
\boldsymbol{G} = \frac{1}{B} \sum_{i=1}^B \boldsymbol{x}_i^{\top} \frac{\partial \mathcal{L}_i}{\partial \boldsymbol{y}_i}
$$</p>
<p>ç†è®ºä¸Š$\text{rank}(\boldsymbol{G}) \leq \min(B, n, m)$ï¼Œå®é™…ä¸­ç”±äºæ ·æœ¬ç›¸å…³æ€§ï¼Œæœ‰æ•ˆç§©å¾€å¾€è¿œå°äºæ‰¹é‡å¤§å°ã€‚</p>
<h4 id="23">2.3 å¥‡å¼‚å€¼çš„è¡°å‡è§„å¾‹</h4>
<p>å®éªŒè§‚å¯Ÿè¡¨æ˜ï¼Œç¥ç»ç½‘ç»œæ¢¯åº¦çš„å¥‡å¼‚å€¼é€šå¸¸å‘ˆç°å¿«é€Ÿè¡°å‡ï¼š</p>
<p>$$
\sigma_i \approx \sigma_1 \cdot i^{-\alpha}, \quad \alpha \in [1, 2]
$$</p>
<p>è¿™æ„å‘³ç€å‰å‡ ä¸ªå¥‡å¼‚å€¼åŒ…å«äº†æ¢¯åº¦çš„ä¸»è¦ä¿¡æ¯ã€‚å®šä¹‰æœ‰æ•ˆç§©ï¼š</p>
<p>$$
r_{\text{eff}} = \frac{(\sum_{i=1}^r \sigma_i)^2}{\sum_{i=1}^r \sigma_i^2}
$$</p>
<p>é€šå¸¸$r_{\text{eff}} \ll r = \min(n,m)$ï¼Œè¿™ä¸ºä½ç§©è¿‘ä¼¼æä¾›äº†ç†è®ºåŸºç¡€ã€‚</p>
<h3 id="3">3. è°±èŒƒæ•°çº¦æŸçš„æœ€ä¼˜æ€§ç†è®º</h3>
<h4 id="31">3.1 ä»æ‰°åŠ¨åˆ†æåˆ°è°±èŒƒæ•°</h4>
<p>æˆ‘ä»¬è¦æ‰¾åˆ°ä¸€ä¸ªèŒƒæ•°$\rho(\cdot)$ï¼Œä½¿å¾—ï¼š</p>
<p>$$
\Vert \boldsymbol{x} \boldsymbol{W} \Vert \leq \rho(\boldsymbol{W}) \Vert \boldsymbol{x} \Vert, \quad \forall \boldsymbol{x}
$$</p>
<p>ä¸”è¿™ä¸ªç•Œæ˜¯ç´§çš„ï¼ˆtightï¼‰ã€‚æ ¹æ®è¯±å¯¼èŒƒæ•°çš„å®šä¹‰ï¼š</p>
<p>$$
\Vert \boldsymbol{W} \Vert_2 = \sup_{\boldsymbol{x} \neq 0} \frac{\Vert \boldsymbol{W} \boldsymbol{x} \Vert_2}{\Vert \boldsymbol{x} \Vert_2}
$$</p>
<p>ç”±çŸ©é˜µç†è®ºï¼Œè°±èŒƒæ•°ç­‰äºæœ€å¤§å¥‡å¼‚å€¼ï¼š</p>
<p>$$
\Vert \boldsymbol{W} \Vert_2 = \sigma_1(\boldsymbol{W}) = \sigma_{\max}(\boldsymbol{W})
$$</p>
<p><strong>å®šç†1ï¼ˆè°±èŒƒæ•°çš„ç´§æ€§ï¼‰</strong>ï¼šå¯¹ä»»æ„çŸ©é˜µ$\boldsymbol{W} \in \mathbb{R}^{n \times m}$å’Œå‘é‡$\boldsymbol{x} \in \mathbb{R}^{n}$ï¼š</p>
<p>$$
\Vert \boldsymbol{W} \boldsymbol{x} \Vert_2 \leq \Vert \boldsymbol{W} \Vert_2 \Vert \boldsymbol{x} \Vert_2
$$</p>
<p>ä¸”ç­‰å·æˆç«‹å½“ä¸”ä»…å½“$\boldsymbol{x} \propto \boldsymbol{v}_1$ï¼ˆæœ€å¤§å¥‡å¼‚å€¼å¯¹åº”çš„å³å¥‡å¼‚å‘é‡ï¼‰ã€‚</p>
<p><strong>è¯æ˜</strong>ï¼šè®¾$\boldsymbol{W} = \sum_{i=1}^r \sigma_i \boldsymbol{u}_i \boldsymbol{v}_i^{\top}$ï¼Œåˆ™ï¼š</p>
<p>$$
\begin{aligned}
\Vert \boldsymbol{W} \boldsymbol{x} \Vert_2^2 &= \left\Vert \sum_{i=1}^r \sigma_i \boldsymbol{u}_i \boldsymbol{v}_i^{\top} \boldsymbol{x} \right\Vert_2^2 \\
&= \sum_{i=1}^r \sigma_i^2 (\boldsymbol{v}_i^{\top} \boldsymbol{x})^2 \quad \text{(å› ä¸º}\boldsymbol{u}_i\text{æ­£äº¤)} \\
&\leq \sigma_1^2 \sum_{i=1}^r (\boldsymbol{v}_i^{\top} \boldsymbol{x})^2 \\
&\leq \sigma_1^2 \sum_{i=1}^m (\boldsymbol{v}_i^{\top} \boldsymbol{x})^2 \\
&= \sigma_1^2 \Vert \boldsymbol{x} \Vert_2^2 \quad \text{(Parsevalæ’ç­‰å¼)}
\end{aligned}
$$</p>
<p>å› æ­¤$\Vert \boldsymbol{W} \boldsymbol{x} \Vert_2 \leq \sigma_1 \Vert \boldsymbol{x} \Vert_2 = \Vert \boldsymbol{W} \Vert_2 \Vert \boldsymbol{x} \Vert_2$ã€‚â–¡</p>
<h4 id="32-frobenius">3.2 ä¸FrobeniusèŒƒæ•°çš„æ¯”è¾ƒ</h4>
<p>FrobeniusèŒƒæ•°å®šä¹‰ä¸ºï¼š</p>
<p>$$
\Vert \boldsymbol{W} \Vert_F = \sqrt{\sum_{i=1}^n \sum_{j=1}^m W_{ij}^2} = \sqrt{\sum_{i=1}^r \sigma_i^2}
$$</p>
<p>å®¹æ˜“éªŒè¯ï¼š</p>
<p>$$
\Vert \boldsymbol{W} \Vert_2 = \sigma_1 \leq \sqrt{\sum_{i=1}^r \sigma_i^2} = \Vert \boldsymbol{W} \Vert_F
$$</p>
<p>ç­‰å·æˆç«‹å½“ä¸”ä»…å½“$\boldsymbol{W}$æ˜¯ç§©1çŸ©é˜µã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼š</p>
<p>$$
\Vert \boldsymbol{W} \Vert_2 \leq \Vert \boldsymbol{W} \Vert_F \leq \sqrt{r} \Vert \boldsymbol{W} \Vert_2
$$</p>
<p>è¿™è¯´æ˜$F$èŒƒæ•°å¯èƒ½é«˜ä¼°çŸ©é˜µå¯¹å‘é‡çš„ä½œç”¨è¾¾$\sqrt{r}$å€ï¼å¯¹äºæ»¡ç§©çŸ©é˜µï¼Œ$r = \min(n,m)$å¯èƒ½éå¸¸å¤§ã€‚</p>
<p><strong>ä¾‹å­</strong>ï¼šè€ƒè™‘å•ä½çŸ©é˜µ$\boldsymbol{I}_n \in \mathbb{R}^{n \times n}$ï¼š
- $\Vert \boldsymbol{I}_n \Vert_2 = 1$
- $\Vert \boldsymbol{I}_n \Vert_F = \sqrt{n}$</p>
<p>å¯¹ä»»æ„$\Vert \boldsymbol{x} \Vert_2 = 1$ï¼Œæœ‰$\Vert \boldsymbol{I}_n \boldsymbol{x} \Vert_2 = 1$ï¼Œä¸è°±èŒƒæ•°ä¸€è‡´ï¼Œä½†$F$èŒƒæ•°ç»™å‡ºäº†$\sqrt{n}$çš„æ¾å¼›ç•Œã€‚</p>
<h4 id="33">3.3 è°±èŒƒæ•°çº¦æŸä¸‹çš„æœ€ä¼˜æ›´æ–°æ–¹å‘</h4>
<p><strong>å®šç†2ï¼ˆæœ€é€Ÿä¸‹é™æ–¹å‘ï¼‰</strong>ï¼šè€ƒè™‘ä¼˜åŒ–é—®é¢˜ï¼š</p>
<p>$$
\min_{\Delta \boldsymbol{W}} \text{Tr}(\boldsymbol{G}^{\top} \Delta \boldsymbol{W}) \quad \text{s.t.} \quad \Vert \Delta \boldsymbol{W} \Vert_2 \leq \eta
$$</p>
<p>å…¶æœ€ä¼˜è§£ä¸ºï¼š</p>
<p>$$
\Delta \boldsymbol{W}^* = -\eta \boldsymbol{u}_1 \boldsymbol{v}_1^{\top}
$$</p>
<p>å…¶ä¸­$\boldsymbol{u}_1, \boldsymbol{v}_1$æ˜¯$\boldsymbol{G}$çš„æœ€å¤§å¥‡å¼‚å€¼å¯¹åº”çš„å·¦å³å¥‡å¼‚å‘é‡ã€‚</p>
<p><strong>è¯æ˜</strong>ï¼šä½¿ç”¨æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•ï¼Œæ„é€ æ‹‰æ ¼æœ—æ—¥å‡½æ•°ï¼š</p>
<p>$$
\mathcal{L}(\Delta \boldsymbol{W}, \lambda) = \text{Tr}(\boldsymbol{G}^{\top} \Delta \boldsymbol{W}) + \lambda(\Vert \Delta \boldsymbol{W} \Vert_2 - \eta)
$$</p>
<p>çº¦æŸæ¡ä»¶$\Vert \Delta \boldsymbol{W} \Vert_2 \leq \eta$åœ¨æœ€ä¼˜è§£å¤„å¿…ç„¶å–ç­‰å·ï¼ˆå¦åˆ™å¯ä»¥å¢å¤§$\Vert \Delta \boldsymbol{W} \Vert$è¿›ä¸€æ­¥å‡å°ç›®æ ‡ï¼‰ï¼Œå› æ­¤ç­‰ä»·äºï¼š</p>
<p>$$
\max_{\Vert \Delta \boldsymbol{W} \Vert_2 = \eta} -\text{Tr}(\boldsymbol{G}^{\top} \Delta \boldsymbol{W})
$$</p>
<p>åˆ©ç”¨von Neumannè¿¹ä¸ç­‰å¼ï¼šå¯¹ä»»æ„çŸ©é˜µ$\boldsymbol{A}, \boldsymbol{B}$ï¼Œ</p>
<p>$$
\text{Tr}(\boldsymbol{A}^{\top} \boldsymbol{B}) \leq \sum_{i=1}^r \sigma_i(\boldsymbol{A}) \sigma_i(\boldsymbol{B})
$$</p>
<p>å…¶ä¸­$\sigma_i$æŒ‰é™åºæ’åˆ—ã€‚ç­‰å·æˆç«‹å½“ä¸”ä»…å½“$\boldsymbol{A}$å’Œ$\boldsymbol{B}$å…±äº«ç›¸åŒçš„å¥‡å¼‚å‘é‡ã€‚</p>
<p>å¯¹äº$\Vert \Delta \boldsymbol{W} \Vert_2 = \eta$ï¼Œå³$\sigma_1(\Delta \boldsymbol{W}) = \eta$ï¼Œ$\sigma_i(\Delta \boldsymbol{W}) = 0$ for $i \geq 2$ï¼ˆç§©1çŸ©é˜µï¼‰ï¼Œå› æ­¤ï¼š</p>
<p>$$
\text{Tr}(\boldsymbol{G}^{\top} \Delta \boldsymbol{W}) \leq \eta \sigma_1(\boldsymbol{G})
$$</p>
<p>ç­‰å·æˆç«‹å½“$\Delta \boldsymbol{W} = -\eta \boldsymbol{u}_1 \boldsymbol{v}_1^{\top}$ã€‚â–¡</p>
<h3 id="4-muon">4. Muonä¼˜åŒ–å™¨çš„å®Œæ•´æ¨å¯¼</h3>
<h4 id="41">4.1 å¸¦åŠ¨é‡çš„è°±èŒƒæ•°çº¦æŸä¼˜åŒ–</h4>
<p>å®é™…ä¸­æˆ‘ä»¬ä½¿ç”¨åŠ¨é‡$\boldsymbol{M}_t$è€Œéç›´æ¥çš„æ¢¯åº¦$\boldsymbol{G}_t$ï¼š</p>
<p>$$
\boldsymbol{M}_t = \beta \boldsymbol{M}_{t-1} + (1-\beta) \boldsymbol{G}_t
$$</p>
<p>åŠ¨é‡å¯ä»¥å¹³æ»‘æ¢¯åº¦ä¼°è®¡ï¼Œå‡å°‘å™ªå£°å½±å“ã€‚ä¼˜åŒ–é—®é¢˜å˜ä¸ºï¼š</p>
<p>$$
\min_{\Delta \boldsymbol{W}} \text{Tr}(\boldsymbol{M}_t^{\top} \Delta \boldsymbol{W}) \quad \text{s.t.} \quad \Vert \Delta \boldsymbol{W} \Vert_2 \leq \eta
$$</p>
<p>æ ¹æ®å®šç†2ï¼Œè§£ä¸ºï¼š</p>
<p>$$
\Delta \boldsymbol{W}_t = -\eta \boldsymbol{u}_1^{(t)} (\boldsymbol{v}_1^{(t)})^{\top}
$$</p>
<p>å…¶ä¸­$\boldsymbol{u}_1^{(t)}, \boldsymbol{v}_1^{(t)}$æ˜¯$\boldsymbol{M}_t$çš„ä¸»å¥‡å¼‚å‘é‡ã€‚</p>
<p>å®šä¹‰çŸ©é˜µç¬¦å·å‡½æ•°ï¼ˆmatrix signï¼‰ï¼š</p>
<p>$$
\text{msign}(\boldsymbol{M}) = \boldsymbol{U}_{:r} \boldsymbol{V}_{:r}^{\top}
$$</p>
<p>å…¶ä¸­$\boldsymbol{U}<em r="r">{:r}$å–$\boldsymbol{U}$çš„å‰$r$åˆ—ï¼Œ$\boldsymbol{V}</em>)$æ—¶ï¼Œè¿™ç»™å‡ºç§©ä¿æŒçš„ç¬¦å·ï¼›å®é™…ä¸­å–$r=1$ç»™å‡ºä¸»æ–¹å‘ã€‚}$å–$\boldsymbol{V}$çš„å‰$r$åˆ—ã€‚å½“$r=\text{rank}(\boldsymbol{M</p>
<p>å› æ­¤Muonçš„æ›´æ–°ä¸ºï¼š</p>
<p>$$
\boldsymbol{W}_{t+1} = \boldsymbol{W}_t - \eta_t \text{msign}(\boldsymbol{M}_t)
$$</p>
<h4 id="42">4.2 åŠ å…¥æƒé‡è¡°å‡çš„ç†è®º</h4>
<p>æƒé‡è¡°å‡ï¼ˆWeight Decayï¼‰å¯ä»¥ä»$L2$æ­£åˆ™åŒ–å¯¼å‡ºã€‚è€ƒè™‘æ­£åˆ™åŒ–æŸå¤±ï¼š</p>
<p>$$
\mathcal{L}_{\text{reg}} = \mathcal{L} + \frac{\lambda}{2} \Vert \boldsymbol{W} \Vert_F^2
$$</p>
<p>æ¢¯åº¦å˜ä¸ºï¼š</p>
<p>$$
\nabla_{\boldsymbol{W}} \mathcal{L}_{\text{reg}} = \boldsymbol{G} + \lambda \boldsymbol{W}
$$</p>
<p>å› æ­¤ä¼˜åŒ–é—®é¢˜å˜ä¸ºï¼š</p>
<p>$$
\min_{\Delta \boldsymbol{W}} \text{Tr}((\boldsymbol{M}_t + \lambda \boldsymbol{W}_t)^{\top} \Delta \boldsymbol{W}) \quad \text{s.t.} \quad \Vert \Delta \boldsymbol{W} \Vert_2 \leq \eta
$$</p>
<p>ä½†æ˜¯$\boldsymbol{M}_t + \lambda \boldsymbol{W}_t$çš„å¥‡å¼‚å€¼åˆ†è§£å¤æ‚åº¦é«˜ï¼ŒMuoné‡‡ç”¨è§£è€¦æƒé‡è¡°å‡ï¼ˆdecoupled weight decayï¼‰ï¼š</p>
<p>$$
\boldsymbol{W}_{t+1} = \boldsymbol{W}_t - \eta_t [\text{msign}(\boldsymbol{M}_t) + \lambda \boldsymbol{W}_t]
$$</p>
<p>è¿™ç­‰ä»·äºï¼š</p>
<p>$$
\boldsymbol{W}_{t+1} = (1 - \eta_t \lambda) \boldsymbol{W}_t - \eta_t \text{msign}(\boldsymbol{M}_t)
$$</p>
<h4 id="43">4.3 æƒé‡è¡°å‡çš„è°±èŒƒæ•°æ§åˆ¶</h4>
<p><strong>å®šç†3ï¼ˆè°±èŒƒæ•°æœ‰ç•Œæ€§ï¼‰</strong>ï¼šåœ¨Muonæ›´æ–°è§„åˆ™ä¸‹ï¼Œæƒé‡çš„è°±èŒƒæ•°æ»¡è¶³ï¼š</p>
<p>$$
\Vert \boldsymbol{W}_t \Vert_2 \leq \max\left(\Vert \boldsymbol{W}_0 \Vert_2, \frac{1}{\lambda}\right)
$$</p>
<p><strong>è¯æ˜</strong>ï¼šç”±äº$\Vert \text{msign}(\boldsymbol{M}_t) \Vert_2 = 1$ï¼ˆç§©1å•ä½çŸ©é˜µï¼‰ï¼Œæˆ‘ä»¬æœ‰ï¼š</p>
<p>$$
\begin{aligned}
\Vert \boldsymbol{W}_{t+1} \Vert_2 &= \Vert (1-\eta_t\lambda)\boldsymbol{W}_t - \eta_t \text{msign}(\boldsymbol{M}_t) \Vert_2 \\
&\leq (1-\eta_t\lambda) \Vert \boldsymbol{W}_t \Vert_2 + \eta_t \\
&= (1-\eta_t\lambda) \Vert \boldsymbol{W}_t \Vert_2 + \eta_t\lambda \cdot \frac{1}{\lambda}
\end{aligned}
$$</p>
<p>ä»¤$a_t = \Vert \boldsymbol{W}_t \Vert_2$ï¼Œ$c = 1/\lambda$ï¼Œåˆ™ï¼š</p>
<p>$$
a_{t+1} \leq (1-\eta_t\lambda) a_t + \eta_t\lambda c
$$</p>
<p>è¿™æ˜¯ä¸€ä¸ªåŠ æƒå¹³å‡ï¼Œå› æ­¤ï¼š</p>
<p>$$
a_{t+1} \leq \max(a_t, c) \leq \max(a_0, c)
$$</p>
<p>å½’çº³å¯å¾—ç»“è®ºã€‚â–¡</p>
<p>è¿™ä¸ªç•Œè¯´æ˜æƒé‡ä¸ä¼šæ— é™å¢é•¿ï¼Œä¿è¯äº†è®­ç»ƒçš„ç¨³å®šæ€§ã€‚</p>
<h3 id="5">5. ä¼˜åŒ–å™¨çš„å®šé‡æ¯”è¾ƒ</h3>
<h4 id="51">5.1 å„ä¼˜åŒ–å™¨çš„æ›´æ–°å…¬å¼ç»Ÿä¸€è¡¨ç¤º</h4>
<p>ä¸ºäº†å…¬å¹³æ¯”è¾ƒï¼Œæˆ‘ä»¬å°†å„ä¼˜åŒ–å™¨è¡¨ç¤ºä¸ºç»Ÿä¸€å½¢å¼ï¼š</p>
<p>$$
\boldsymbol{W}_{t+1} = \boldsymbol{W}_t - \eta_t \boldsymbol{\Phi}_t(\boldsymbol{G}_t, \boldsymbol{W}_t)
$$</p>
<p>å…¶ä¸­$\boldsymbol{\Phi}_t$æ˜¯ä¼˜åŒ–å™¨ç‰¹å®šçš„æ›´æ–°ç®—å­ã€‚</p>
<table>
<thead>
<tr>
<th>ä¼˜åŒ–å™¨</th>
<th>$\boldsymbol{\Phi}_t$</th>
<th>é¢„æ¡ä»¶å™¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>SGD</td>
<td>$\boldsymbol{G}_t$</td>
<td>$\boldsymbol{I}$</td>
</tr>
<tr>
<td>Momentum SGD</td>
<td>$\boldsymbol{M}<em t-1="t-1">t = \beta \boldsymbol{M}</em>_t$} + (1-\beta)\boldsymbol{G</td>
<td>$\boldsymbol{I}$</td>
</tr>
<tr>
<td>Adam</td>
<td>$\frac{\hat{\boldsymbol{m}}_t}{\sqrt{\hat{\boldsymbol{v}}_t} + \epsilon}$</td>
<td>$\text{diag}(\frac{1}{\sqrt{\hat{\boldsymbol{v}}_t}+\epsilon})$</td>
</tr>
<tr>
<td>AdamW</td>
<td>$\frac{\hat{\boldsymbol{m}}_t}{\sqrt{\hat{\boldsymbol{v}}_t} + \epsilon} + \lambda \boldsymbol{W}_t$</td>
<td>$\text{diag}(\frac{1}{\sqrt{\hat{\boldsymbol{v}}_t}+\epsilon})$</td>
</tr>
<tr>
<td>Lion</td>
<td>$\text{sign}(\boldsymbol{m}_t)$</td>
<td>$\boldsymbol{I}$</td>
</tr>
<tr>
<td>Muon</td>
<td>$\text{msign}(\boldsymbol{M}_t) + \lambda \boldsymbol{W}_t$</td>
<td>è°±æŠ•å½±</td>
</tr>
</tbody>
</table>
<h4 id="52">5.2 æ›´æ–°æ–¹å‘çš„æœ‰æ•ˆæ€§åº¦é‡</h4>
<p>å®šä¹‰æ›´æ–°æ–¹å‘ä¸æ¢¯åº¦çš„å¯¹é½åº¦ï¼š</p>
<p>$$
\text{alignment}_t = \frac{\text{Tr}(\boldsymbol{G}_t^{\top} \boldsymbol{\Phi}_t)}{\Vert \boldsymbol{G}_t \Vert_F \Vert \boldsymbol{\Phi}_t \Vert_F}
$$</p>
<p>è¿™æ˜¯çŸ©é˜µçš„ä½™å¼¦ç›¸ä¼¼åº¦ï¼Œå–å€¼èŒƒå›´$[-1, 1]$ã€‚</p>
<p><strong>SGD</strong>ï¼š$\text{alignment}_t = 1$ï¼ˆå®Œç¾å¯¹é½ï¼‰</p>
<p><strong>Adam</strong>ï¼šç”±äºé€å…ƒç´ å½’ä¸€åŒ–ï¼Œ$\text{alignment}_t \approx \frac{\Vert \text{sign}(\boldsymbol{G}_t) \Vert_F}{\Vert \boldsymbol{G}_t \Vert_F \cdot \sqrt{nm}}$</p>
<p>å½“æ¢¯åº¦å…ƒç´ ç¬¦å·éšæœºæ—¶ï¼Œ$\text{alignment}_t \approx \frac{1}{\sqrt{nm}}$ï¼ˆå¾ˆå°ï¼‰</p>
<p><strong>Muon</strong>ï¼š</p>
<p>$$
\begin{aligned}
\text{alignment}_t &= \frac{\text{Tr}(\boldsymbol{G}_t^{\top} \boldsymbol{u}_1 \boldsymbol{v}_1^{\top})}{\Vert \boldsymbol{G}_t \Vert_F} \\
&= \frac{\boldsymbol{v}_1^{\top} \boldsymbol{G}_t^{\top} \boldsymbol{u}_1}{\Vert \boldsymbol{G}_t \Vert_F} \\
&= \frac{\sigma_1(\boldsymbol{G}_t)}{\sqrt{\sum_i \sigma_i^2(\boldsymbol{G}_t)}}
\end{aligned}
$$</p>
<p>å½“$\sigma_1 \gg \sigma_{2,3,\ldots}$æ—¶ï¼ˆæ¢¯åº¦ä½ç§©ï¼‰ï¼Œ$\text{alignment}_t \approx 1$ï¼ˆé«˜å¯¹é½ï¼‰ã€‚</p>
<h4 id="53">5.3 æ”¶æ•›é€Ÿç‡çš„ç†è®ºåˆ†æ</h4>
<p>è€ƒè™‘å¼ºå‡¸å‡½æ•°$f(\boldsymbol{W})$ï¼Œæ»¡è¶³$\mu \boldsymbol{I} \preceq \nabla^2 f \preceq L \boldsymbol{I}$ï¼Œæ¡ä»¶æ•°$\kappa = L/\mu$ã€‚</p>
<p><strong>SGD</strong>ï¼šæ”¶æ•›é€Ÿç‡ä¸º$O(\kappa \log(1/\epsilon))$æ¬¡è¿­ä»£è¾¾åˆ°$\epsilon$ç²¾åº¦ã€‚</p>
<p><strong>é¢„æ¡ä»¶æ¢¯åº¦ä¸‹é™</strong>ï¼šè‹¥é¢„æ¡ä»¶å™¨$\boldsymbol{P}$ä½¿å¾—$\boldsymbol{P}^{-1/2} \nabla^2 f \boldsymbol{P}^{-1/2} \approx \boldsymbol{I}$ï¼Œåˆ™æ”¶æ•›é€Ÿç‡ä¸º$O(\log(1/\epsilon))$ï¼ˆæ¡ä»¶æ•°æ¥è¿‘1ï¼‰ã€‚</p>
<p><strong>Muonçš„éšå¼é¢„æ¡ä»¶</strong>ï¼šè°±èŒƒæ•°çº¦æŸç›¸å½“äºåœ¨æ¯æ­¥å°†æ›´æ–°æŠ•å½±åˆ°å•ä½çƒã€‚å¯¹äºäºŒæ¬¡å‡½æ•°ï¼š</p>
<p>$$
f(\boldsymbol{W}) = \frac{1}{2} \text{Tr}(\boldsymbol{W}^{\top} \boldsymbol{H} \boldsymbol{W}) - \text{Tr}(\boldsymbol{B}^{\top} \boldsymbol{W})
$$</p>
<p>æ¢¯åº¦ä¸º$\boldsymbol{G} = \boldsymbol{H} \boldsymbol{W} - \boldsymbol{B}$ã€‚Muonæ›´æ–°ï¼š</p>
<p>$$
\Delta \boldsymbol{W} = -\eta \boldsymbol{u}_1(\boldsymbol{G}) \boldsymbol{v}_1(\boldsymbol{G})^{\top}
$$</p>
<p>è¿™è‡ªåŠ¨é€‰æ‹©äº†Hessian $\boldsymbol{H}$çš„ä¸»æ–¹å‘ï¼Œç±»ä¼¼äºpower iterationï¼Œå› æ­¤å¯¹ä¸»ç‰¹å¾å€¼æ–¹å‘æ”¶æ•›å¾ˆå¿«ã€‚</p>
<h3 id="6">6. å‚æ•°ç©ºé—´çš„é»æ›¼å‡ ä½•è§†è§’</h3>
<h4 id="61-fisher">6.1 è‡ªç„¶æ¢¯åº¦ä¸Fisherä¿¡æ¯çŸ©é˜µ</h4>
<p>åœ¨ç»Ÿè®¡æµå½¢ä¸Šï¼Œå‚æ•°çš„çœŸå®è·ç¦»ç”±Fisherä¿¡æ¯çŸ©é˜µ$\boldsymbol{F}$åº¦é‡ï¼š</p>
<p>$$
ds^2 = d\boldsymbol{\theta}^{\top} \boldsymbol{F} d\boldsymbol{\theta}
$$</p>
<p>è‡ªç„¶æ¢¯åº¦å®šä¹‰ä¸ºï¼š</p>
<p>$$
\tilde{\nabla} f = \boldsymbol{F}^{-1} \nabla f
$$</p>
<p>å®ƒç»™å‡ºäº†åœ¨å‚æ•°æµå½¢ä¸Šçš„æœ€é€Ÿä¸‹é™æ–¹å‘ã€‚</p>
<h4 id="62-muon">6.2 Muonä¸è‡ªç„¶æ¢¯åº¦çš„è”ç³»</h4>
<p>å¯¹äºçŸ©é˜µå‚æ•°ï¼ŒFisherä¿¡æ¯çŸ©é˜µå…·æœ‰Kroneckerç§¯ç»“æ„ï¼š</p>
<p>$$
\boldsymbol{F} = \boldsymbol{A} \otimes \boldsymbol{B}
$$</p>
<p>å…¶ä¸­$\boldsymbol{A} \in \mathbb{R}^{n \times n}$ï¼Œ$\boldsymbol{B} \in \mathbb{R}^{m \times m}$ã€‚å®Œæ•´è®¡ç®—$\boldsymbol{F}^{-1}$éœ€è¦$O((nm)^3)$ï¼Œä¸å¯è¡Œã€‚</p>
<p>K-FACï¼ˆKronecker-Factored Approximate Curvatureï¼‰è¿‘ä¼¼ï¼š</p>
<p>$$
\boldsymbol{F}^{-1} \approx \boldsymbol{A}^{-1} \otimes \boldsymbol{B}^{-1}
$$</p>
<p>è‡ªç„¶æ¢¯åº¦ä¸ºï¼š</p>
<p>$$
\tilde{\boldsymbol{G}} = \boldsymbol{A}^{-1} \boldsymbol{G} \boldsymbol{B}^{-1}
$$</p>
<p>Muonçš„msignå¯ä»¥çœ‹ä½œå¦ä¸€ç§å‡ ä½•è¿‘ä¼¼ï¼šä¸ä¼°è®¡å®Œæ•´çš„åº¦é‡å¼ é‡ï¼Œè€Œæ˜¯<strong>åœ¨è°±èŒƒæ•°è¯±å¯¼çš„å‡ ä½•ä¸‹ä¼˜åŒ–</strong>ã€‚</p>
<h4 id="63">6.3 çŸ©é˜µæµå½¢ä¸Šçš„æµ‹åœ°çº¿</h4>
<p>è€ƒè™‘å›ºå®šç§©$r$çš„çŸ©é˜µæµå½¢$\mathcal{M}_r = {\boldsymbol{W} : \text{rank}(\boldsymbol{W}) = r}$ã€‚è¿™æ˜¯ä¸€ä¸ªéå‡¸æµå½¢ï¼Œç»´åº¦ä¸º$r(n+m-r)$ã€‚</p>
<p>åœ¨$\mathcal{M}_r$ä¸Šçš„åˆ‡ç©ºé—´ä¸ºï¼š</p>
<p>$$
T_{\boldsymbol{W}} \mathcal{M}_r = \{\boldsymbol{U} \boldsymbol{X}^{\top} + \boldsymbol{Y} \boldsymbol{V}^{\top} : \boldsymbol{X} \in \mathbb{R}^{m \times r}, \boldsymbol{Y} \in \mathbb{R}^{n \times r}\}
$$</p>
<p>å…¶ä¸­$\boldsymbol{W} = \boldsymbol{U} \boldsymbol{\Sigma} \boldsymbol{V}^{\top}$æ˜¯SVDåˆ†è§£ã€‚</p>
<p>Muonçš„æ›´æ–°$\boldsymbol{u}_1 \boldsymbol{v}_1^{\top}$æ­£æ˜¯ç§©1æµå½¢$\mathcal{M}_1$ä¸Šçš„ä¸€ä¸ªå…ƒç´ ï¼Œè¿™å¯ä»¥çœ‹ä½œåœ¨ä½ç»´æµå½¢ä¸Šä¼˜åŒ–çš„ç­–ç•¥ã€‚</p>
<h3 id="7">7. é¢„æ¡ä»¶å™¨çš„è°±ç†è®ºåˆ†æ</h3>
<h4 id="71-adam">7.1 Adamçš„é¢„æ¡ä»¶å™¨</h4>
<p>Adamçš„é¢„æ¡ä»¶å™¨ä¸ºå¯¹è§’çŸ©é˜µï¼š</p>
<p>$$
\boldsymbol{P}_{\text{Adam}} = \text{diag}\left(\frac{1}{\sqrt{v_{11}}+\epsilon}, \ldots, \frac{1}{\sqrt{v_{nm}}+\epsilon}\right)
$$</p>
<p>å…¶æ¡ä»¶æ•°ä¸ºï¼š</p>
<p>$$
\kappa(\boldsymbol{P}_{\text{Adam}}) = \frac{\max_i (\sqrt{v_i}+\epsilon)}{\min_i (\sqrt{v_i}+\epsilon)}
$$</p>
<p>å½“ä¸åŒå‚æ•°çš„æ¢¯åº¦æ–¹å·®å·®å¼‚å¾ˆå¤§æ—¶ï¼Œ$\kappa$å¯èƒ½å¾ˆå¤§ã€‚</p>
<h4 id="72-muon">7.2 Muonçš„éšå¼é¢„æ¡ä»¶</h4>
<p>Muoné€šè¿‡è°±æŠ•å½±å®ç°äº†ä¸€ç§éçº¿æ€§é¢„æ¡ä»¶ã€‚è€ƒè™‘æ¢¯åº¦$\boldsymbol{G}$çš„æ¡ä»¶æ•°ï¼š</p>
<p>$$
\kappa(\boldsymbol{G}) = \frac{\sigma_1(\boldsymbol{G})}{\sigma_r(\boldsymbol{G})}
$$</p>
<p>msignæ“ä½œåï¼š</p>
<p>$$
\kappa(\text{msign}(\boldsymbol{G})) = \frac{1}{1} = 1
$$</p>
<p>å®Œç¾æ¡ä»¶ï¼è¿™æ˜¯å› ä¸ºmsignå°†æ‰€æœ‰å¥‡å¼‚å€¼å½’ä¸€åŒ–ä¸º1ã€‚</p>
<h4 id="73-hessian">7.3 Hessianè°±ä¸æ”¶æ•›æ€§</h4>
<p>å¯¹äºç›®æ ‡å‡½æ•°$f(\boldsymbol{W})$ï¼ŒHessiançŸ©é˜µçš„è°±åˆ†å¸ƒå½±å“æ”¶æ•›é€Ÿåº¦ã€‚è®¾Hessiançš„ç‰¹å¾å€¼ä¸º$\lambda_1 \geq \lambda_2 \geq \cdots \geq \lambda_d &gt; 0$ã€‚</p>
<p><strong>å®šç†4ï¼ˆé¢„æ¡ä»¶æ•ˆæœï¼‰</strong>ï¼šè‹¥é¢„æ¡ä»¶å™¨$\boldsymbol{P}$ä½¿å¾—$\boldsymbol{P} \boldsymbol{H}$çš„è°±èšé›†åœ¨$[a, b]$ï¼Œåˆ™é¢„æ¡ä»¶æ¢¯åº¦ä¸‹é™çš„æ”¶æ•›é€Ÿç‡ä¾èµ–äº$\kappa' = b/a$è€Œé$\kappa = \lambda_1/\lambda_d$ã€‚</p>
<p>Adamè¯•å›¾é€šè¿‡é€å…ƒç´ å½’ä¸€åŒ–å®ç°è¿™ä¸€ç‚¹ï¼Œä½†åªåˆ©ç”¨äº†å¯¹è§’ä¿¡æ¯ã€‚Muoné€šè¿‡è°±æŠ•å½±ï¼Œéšå¼åœ°è€ƒè™‘äº†æ¢¯åº¦çš„ä¸»æ¨¡å¼ï¼Œå¯èƒ½æ›´å¥½åœ°é¢„æ¡ä»¶äº†Hessiançš„ä¸»ç‰¹å¾ç©ºé—´ã€‚</p>
<h3 id="8">8. å¤§æ¨¡å‹è®­ç»ƒçš„å°ºåº¦å®šå¾‹</h3>
<h4 id="81-scaling-law">8.1 Scaling Lawçš„åŸºæœ¬å½¢å¼</h4>
<p>æ ¹æ®Kaplanç­‰äººçš„ç ”ç©¶ï¼Œæ¨¡å‹æ€§èƒ½ï¼ˆå¦‚äº¤å‰ç†µæŸå¤±$L$ï¼‰ä¸æ¨¡å‹å‚æ•°é‡$N$ã€æ•°æ®é‡$D$ã€è®¡ç®—é‡$C$çš„å…³ç³»ä¸ºï¼š</p>
<p>$$
L(N, D, C) \approx \left(\frac{N_c}{N}\right)^{\alpha_N} + \left(\frac{D_c}{D}\right)^{\alpha_D} + \left(\frac{C_c}{C}\right)^{\alpha_C}
$$</p>
<p>å…¶ä¸­$N_c, D_c, C_c$æ˜¯ç‰¹å¾å°ºåº¦ï¼Œ$\alpha_N, \alpha_D, \alpha_C$æ˜¯å¹‚å¾‹æŒ‡æ•°ï¼ˆå®éªŒæµ‹å¾—çº¦ä¸º0.076, 0.095, 0.050ï¼‰ã€‚</p>
<h4 id="82">8.2 ä¼˜åŒ–å™¨æ•ˆç‡ä¸ç­‰æ•ˆè®¡ç®—é‡</h4>
<p>ä¸åŒä¼˜åŒ–å™¨è¾¾åˆ°ç›¸åŒæŸå¤±æ‰€éœ€çš„æ­¥æ•°ä¸åŒã€‚å®šä¹‰ä¼˜åŒ–å™¨æ•ˆç‡å› å­$\gamma$ï¼š</p>
<p>$$
C_{\text{Muon}} = \gamma \cdot C_{\text{Adam}}
$$</p>
<p>æ ¹æ®æ–‡ç« ä¸­çš„å®éªŒï¼ŒMuonè¾¾åˆ°ç›¸åŒæ€§èƒ½çº¦éœ€Adamçš„50%æ­¥æ•°ï¼Œå³$\gamma \approx 0.5$ã€‚</p>
<p>ä»£å…¥Scaling Lawï¼š</p>
<p>$$
L_{\text{Muon}}(C) \approx L_{\text{Adam}}(2C)
$$</p>
<p>è¿™æ„å‘³ç€åœ¨ç›¸åŒè®¡ç®—é¢„ç®—ä¸‹ï¼ŒMuonèƒ½è¾¾åˆ°è®­ç»ƒæ›´å¤§æ¨¡å‹æ‰€å¯¹åº”çš„æ€§èƒ½ã€‚</p>
<h4 id="83">8.3 å‚æ•°æ•ˆç‡çš„ç†è®ºè§£é‡Š</h4>
<p>Muonè®­ç»ƒçš„æ¨¡å‹å¥‡å¼‚å€¼ç†µæ›´é«˜ï¼Œæ„å‘³ç€å‚æ•°åˆ©ç”¨æ›´å……åˆ†ã€‚å®šä¹‰å‚æ•°æœ‰æ•ˆæ€§ï¼š</p>
<p>$$
\text{Efficiency} = \frac{\text{Model Capacity}}{\text{Parameter Count}}
$$</p>
<p>ç”¨å¥‡å¼‚å€¼ç†µè¡¡é‡å®¹é‡ï¼š</p>
<p>$$
\text{Capacity} = \exp\left(\frac{1}{L}\sum_{\ell=1}^L H(\boldsymbol{\sigma}^{(\ell)})\right)
$$</p>
<p>å…¶ä¸­$L$æ˜¯å±‚æ•°ï¼Œ$H(\boldsymbol{\sigma}^{(\ell)})$æ˜¯ç¬¬$\ell$å±‚çš„å¥‡å¼‚å€¼ç†µã€‚</p>
<p>Muoné€šè¿‡è°±çº¦æŸé¼“åŠ±å‚æ•°ç©ºé—´çš„å‡åŒ€åˆ©ç”¨ï¼Œæé«˜äº†è¿™ä¸ªæ•ˆç‡æŒ‡æ ‡ã€‚</p>
<h3 id="9">9. è®¡ç®—å¤æ‚åº¦ä¸å†…å­˜æ•ˆç‡åˆ†æ</h3>
<h4 id="91">9.1 å„ä¼˜åŒ–å™¨çš„è®¡ç®—å¤æ‚åº¦</h4>
<p>å¯¹äºçŸ©é˜µ$\boldsymbol{W} \in \mathbb{R}^{n \times m}$ï¼š</p>
<table>
<thead>
<tr>
<th>ä¼˜åŒ–å™¨</th>
<th>æ—¶é—´å¤æ‚åº¦</th>
<th>ç©ºé—´å¤æ‚åº¦ï¼ˆçŠ¶æ€ï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>SGD</td>
<td>$O(1)$</td>
<td>$O(nm)$ï¼ˆå‚æ•°ï¼‰</td>
</tr>
<tr>
<td>Momentum</td>
<td>$O(nm)$</td>
<td>$2 \times O(nm)$</td>
</tr>
<tr>
<td>Adam</td>
<td>$O(nm)$</td>
<td>$3 \times O(nm)$ï¼ˆ$m, v, W$ï¼‰</td>
</tr>
<tr>
<td>Muonï¼ˆå®Œæ•´SVDï¼‰</td>
<td>$O(nm\min(n,m))$</td>
<td>$2 \times O(nm)$</td>
</tr>
<tr>
<td>Muonï¼ˆNewton-Schulzï¼‰</td>
<td>$O(nm)$</td>
<td>$2 \times O(nm)$</td>
</tr>
</tbody>
</table>
<h4 id="92-newton-schulz">9.2 Newton-Schulzè¿­ä»£çš„æ¨å¯¼</h4>
<p>å®Œæ•´SVDè®¡ç®—$\text{msign}(\boldsymbol{M})$éœ€è¦$O(nm\min(n,m))$ï¼Œä¸å¯æ¥å—ã€‚Newton-Schulzè¿­ä»£æä¾›äº†$O(nm)$çš„è¿‘ä¼¼æ–¹æ³•ã€‚</p>
<p>è®¾$\boldsymbol{M} = \boldsymbol{U} \boldsymbol{\Sigma} \boldsymbol{V}^{\top}$ï¼Œæˆ‘ä»¬è¦è®¡ç®—ï¼š</p>
<p>$$
\text{msign}(\boldsymbol{M}) = \boldsymbol{U} \boldsymbol{V}^{\top} = \boldsymbol{M} (\boldsymbol{M}^{\top} \boldsymbol{M})^{-1/2}
$$</p>
<p>å®šä¹‰$\boldsymbol{A} = \boldsymbol{M}^{\top} \boldsymbol{M} / \Vert \boldsymbol{M} \Vert_F^2$ï¼Œåˆ™$\boldsymbol{A}$çš„ç‰¹å¾å€¼åœ¨$(0, 1]$å†…ã€‚</p>
<p>Newton-Schulzè¿­ä»£è®¡ç®—$\boldsymbol{A}^{-1/2}$ï¼š</p>
<p>$$
\boldsymbol{X}_0 = \boldsymbol{I}, \quad \boldsymbol{X}_{k+1} = \frac{1}{2} \boldsymbol{X}_k (3\boldsymbol{I} - \boldsymbol{A} \boldsymbol{X}_k^2)
$$</p>
<p><strong>å®šç†5ï¼ˆNewton-Schulzæ”¶æ•›æ€§ï¼‰</strong>ï¼šè‹¥$\boldsymbol{A}$çš„ç‰¹å¾å€¼åœ¨$(0, 2)$å†…ï¼Œåˆ™$\boldsymbol{X}_k \to \boldsymbol{A}^{-1/2}$ï¼Œä¸”æ”¶æ•›é€Ÿåº¦ä¸ºä¸‰æ¬¡ï¼š</p>
<p>$$
\Vert \boldsymbol{X}_k \boldsymbol{A}^{1/2} - \boldsymbol{I} \Vert \leq C \cdot \delta^{3^k}
$$</p>
<p>å…¶ä¸­$\delta = \Vert \boldsymbol{X}_0 \boldsymbol{A}^{1/2} - \boldsymbol{I} \Vert &lt; 1$ã€‚</p>
<p>é€šå¸¸5-7æ¬¡è¿­ä»£å³å¯è¾¾åˆ°æœºå™¨ç²¾åº¦ã€‚æ¯æ¬¡è¿­ä»£éœ€è¦ä¸¤æ¬¡çŸ©é˜µä¹˜æ³•ï¼Œå¤æ‚åº¦$O(m^3)$ï¼ˆå¯¹$\boldsymbol{A} \in \mathbb{R}^{m \times m}$ï¼‰ã€‚</p>
<p>ä½†æˆ‘ä»¬ä¸éœ€è¦æ˜¾å¼è®¡ç®—$\boldsymbol{A}^{-1/2}$ï¼Œè€Œæ˜¯ç›´æ¥è¿­ä»£ï¼š</p>
<p>$$
\boldsymbol{Z}_0 = \boldsymbol{M} / \Vert \boldsymbol{M} \Vert_F, \quad \boldsymbol{Z}_{k+1} = \frac{3}{2}\boldsymbol{Z}_k - \frac{1}{2}\boldsymbol{Z}_k \boldsymbol{Z}_k^{\top} \boldsymbol{Z}_k
$$</p>
<p>æ­¤æ—¶æ¯æ¬¡è¿­ä»£æ˜¯$O(nm^2)$æˆ–$O(n^2 m)$ï¼ˆå–å†³äº$n, m$å¤§å°ï¼‰ï¼Œä»æ¯”å®Œæ•´SVDå¿«ã€‚</p>
<h4 id="93">9.3 å†…å­˜ä¼˜åŒ–æŠ€å·§</h4>
<p>åœ¨å®ç°ä¸­ï¼Œå¯ä»¥é¿å…å­˜å‚¨å®Œæ•´çš„åŠ¨é‡$\boldsymbol{M}$ï¼Œè€Œæ˜¯å­˜å‚¨å…¶ä½ç§©åˆ†è§£ï¼š</p>
<p>$$
\boldsymbol{M}_t \approx \boldsymbol{U}_k \boldsymbol{\Sigma}_k \boldsymbol{V}_k^{\top}
$$</p>
<p>åªä¿ç•™å‰$k$ä¸ªå¥‡å¼‚å€¼ï¼ˆå¦‚$k=100$ï¼‰ï¼Œå†…å­˜ä»$O(nm)$é™è‡³$O(k(n+m))$ã€‚</p>
<p>å¯¹äºå¤§å‹çŸ©é˜µï¼ˆå¦‚$10000 \times 10000$ï¼‰ï¼Œè¿™å¯ä»¥èŠ‚çœæ•°ç™¾å€å†…å­˜ã€‚</p>
<h3 id="10">10. å®éªŒç°è±¡çš„æ·±åº¦ç†è®ºè§£é‡Š</h3>
<h4 id="101-muon">10.1 Muonæ”¶æ•›æ›´å¿«çš„åŸå› </h4>
<p>å®éªŒæ˜¾ç¤ºMuonçº¦2å€å¿«äºAdamã€‚ä»ä¼˜åŒ–è½¨è¿¹åˆ†æï¼š</p>
<p><strong>æŸå¤±ä¸‹é™ç‡</strong>ï¼šç¬¬$t$æ­¥çš„æŸå¤±ä¸‹é™ä¸ºï¼š</p>
<p>$$
\Delta L_t = L_t - L_{t+1} \approx -\text{Tr}(\boldsymbol{G}_t^{\top} \Delta \boldsymbol{W}_t)
$$</p>
<p><strong>Adam</strong>ï¼š</p>
<p>$$
\Delta L_t^{\text{Adam}} \approx \eta \sum_{ij} \frac{G_{ij}^2}{\sqrt{v_{ij}}} \approx \eta \cdot O(\sqrt{nm})
$$</p>
<p>ï¼ˆå‡è®¾$G_{ij}$å’Œ$v_{ij}$åŒå°ºåº¦ï¼‰</p>
<p><strong>Muon</strong>ï¼š</p>
<p>$$
\Delta L_t^{\text{Muon}} = \eta \text{Tr}(\boldsymbol{G}_t^{\top} \boldsymbol{u}_1 \boldsymbol{v}_1^{\top}) = \eta \sigma_1(\boldsymbol{G}_t)
$$</p>
<p>å½“æ¢¯åº¦ä½ç§©ï¼ˆ$\sigma_1 \gg \sigma_{2,\ldots}$ï¼‰æ—¶ï¼Œ$\sigma_1 \approx \Vert \boldsymbol{G} \Vert_F$ï¼Œå› æ­¤ï¼š</p>
<p>$$
\frac{\Delta L_t^{\text{Muon}}}{\Delta L_t^{\text{Adam}}} \approx \frac{\Vert \boldsymbol{G} \Vert_F}{\sqrt{nm}} = \text{RMS}(\boldsymbol{G}) \sqrt{nm}
$$</p>
<p>å¯¹äºå…¸å‹å€¼$\text{RMS}(\boldsymbol{G}) \sim 10^{-3}$ï¼Œ$nm \sim 10^6$ï¼Œæ¯”å€¼çº¦ä¸º1-10ï¼Œä¸å®éªŒè§‚å¯Ÿä¸€è‡´ï¼</p>
<h4 id="102">10.2 å¥‡å¼‚å€¼ç†µå¢åŠ çš„æ„ä¹‰</h4>
<p>æ–‡ç« è§‚å¯Ÿåˆ°Muonè®­ç»ƒçš„æ¨¡å‹$H(\boldsymbol{\sigma})$æ›´é«˜ã€‚è¿™æ„å‘³ç€ä»€ä¹ˆï¼Ÿ</p>
<p><strong>ä¿¡æ¯è®ºè§†è§’</strong>ï¼šå¥‡å¼‚å€¼ç†µè¡¡é‡çŸ©é˜µçš„"ä¿¡æ¯å®¹é‡"ã€‚è®¾$p_i = \sigma_i^2 / \sum_j \sigma_j^2$ï¼Œåˆ™ï¼š</p>
<p>$$
H = -\sum_i p_i \log p_i
$$</p>
<p>æœ€å¤§ç†µï¼ˆ$H=\log r$ï¼‰å½“æ‰€æœ‰$p_i$ç›¸ç­‰ï¼Œå³æ‰€æœ‰å¥‡å¼‚å€¼ç›¸ç­‰ã€‚æ­¤æ—¶çŸ©é˜µåœ¨æ‰€æœ‰æ–¹å‘ä¸Š"å¹³ç­‰"åœ°ä¼ æ’­ä¿¡æ¯ã€‚</p>
<p><strong>ä½ç§©vsæ»¡ç§©</strong>ï¼š
- ä½ç§©çŸ©é˜µï¼ˆå°‘æ•°å¤§å¥‡å¼‚å€¼ï¼‰ï¼š$H$å°ï¼Œä¿¡æ¯é›†ä¸­åœ¨å°‘æ•°æ¨¡å¼
- æ»¡ç§©çŸ©é˜µï¼ˆå¥‡å¼‚å€¼å‡åŒ€ï¼‰ï¼š$H$å¤§ï¼Œä¿¡æ¯åˆ†æ•£åœ¨æ‰€æœ‰æ¨¡å¼</p>
<p>Muoné¼“åŠ±$H$å¢å¤§ï¼Œæ„å‘³ç€æ¨¡å‹å­¦ä¼šäº†åˆ©ç”¨æ›´å¤šçš„å‚æ•°è‡ªç”±åº¦ï¼Œè€Œéä»…ä¾èµ–å°‘æ•°ä¸»æ¨¡å¼ã€‚</p>
<p><strong>æ³›åŒ–èƒ½åŠ›</strong>ï¼šæ ¹æ®å­¦ä¹ ç†è®ºï¼Œæ›´é«˜çš„$H$å¯¹åº”æ›´ä½çš„"æœ‰æ•ˆå‚æ•°æ•°é‡"ï¼ˆeffective parameterï¼‰çš„ä¼°è®¡ï¼š</p>
<p>$$
N_{\text{eff}} = \exp(H) \cdot r
$$</p>
<p>è¿™ä¸éšå¼æ­£åˆ™åŒ–ç›¸å…³ï¼Œå¯èƒ½è§£é‡ŠMuonçš„æ³›åŒ–ä¼˜åŠ¿ã€‚</p>
<h4 id="103-">10.3 é¢„è®­ç»ƒ-å¾®è°ƒå…¼å®¹æ€§é—®é¢˜</h4>
<p>å®éªŒå‘ç°Adamé¢„è®­ç»ƒ+Muonå¾®è°ƒæ•ˆæœä¸ä½³ã€‚å¯èƒ½çš„è§£é‡Šï¼š</p>
<p><strong>Hessianè°±çš„é€‚é…</strong>ï¼šä¸åŒä¼˜åŒ–å™¨ä¼šå¯¼è‡´ä¸åŒçš„Hessianè°±ç»“æ„ã€‚Adamå€¾å‘äºå¹³æ»‘å„å‘å¼‚æ€§ï¼ˆå› ä¸ºé€å…ƒç´ å½’ä¸€åŒ–ï¼‰ï¼Œè€ŒMuonä¿ç•™ä¸»æ–¹å‘çš„å„å‘å¼‚æ€§ã€‚</p>
<p>è®¾Adamè®­ç»ƒåçš„Hessianåœ¨æŸä¸ªå±€éƒ¨æœ€ä¼˜ç‚¹$\boldsymbol{W}^*$é™„è¿‘ï¼š</p>
<p>$$
\boldsymbol{H}_{\text{Adam}} \approx \text{diag}(\lambda_1, \ldots, \lambda_{nm})
$$</p>
<p>ï¼ˆè¿‘ä¼¼å¯¹è§’ï¼‰</p>
<p>è€ŒMuonæœŸæœ›çš„Hessianï¼š</p>
<p>$$
\boldsymbol{H}_{\text{Muon}} \approx \sum_{i=1}^k \lambda_i \boldsymbol{u}_i \boldsymbol{u}_i^{\top}
$$</p>
<p>ï¼ˆä½ç§©+æ‰°åŠ¨ï¼‰</p>
<p>ä¸¤è€…ç»“æ„ä¸åŒ¹é…ï¼Œå¯¼è‡´Muonåœ¨Adamçš„æœ€ä¼˜ç‚¹é™„è¿‘éš¾ä»¥æ‰¾åˆ°å¥½çš„ä¸‹é™æ–¹å‘ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šå¯èƒ½éœ€è¦ä¸€ä¸ª"è¿‡æ¸¡æœŸ"ï¼Œåœ¨å¾®è°ƒå¼€å§‹æ—¶ä½¿ç”¨è¾ƒå°çš„å­¦ä¹ ç‡è®©Muoné€‚åº”å½“å‰å‚æ•°ç©ºé—´çš„å‡ ä½•ã€‚</p>
<h4 id="104-rms">10.4 RMSå¯¹é½çš„ç†è®ºåŸºç¡€</h4>
<p>æ–‡ç« æå‡ºçš„RMSå¯¹é½ç­–ç•¥ï¼š</p>
<p>$$
\boldsymbol{\Phi}_{\text{norm}} = 0.2 \cdot \frac{\boldsymbol{\Phi}}{\text{RMS}(\boldsymbol{\Phi})}
$$</p>
<p>ä¸ºä»€ä¹ˆé€‰æ‹©0.2ï¼Ÿ</p>
<p><strong>ç»éªŒè§‚å¯Ÿ</strong>ï¼šAdamçš„æ›´æ–°RMSé€šå¸¸åœ¨0.2-0.4ã€‚è¿™å¯ä»¥ä»ä»¥ä¸‹è§’åº¦ç†è§£ï¼š</p>
<p>å‡è®¾æ¢¯åº¦å…ƒç´ $G_{ij} \sim \mathcal{N}(0, \sigma^2)$ï¼ŒAdamæ›´æ–°ï¼š</p>
<p>$$
\Delta W_{ij} \approx \alpha \text{sign}(G_{ij})
$$</p>
<p>åˆ™ï¼š</p>
<p>$$
\text{RMS}(\Delta \boldsymbol{W}) = \alpha
$$</p>
<p>å…¸å‹å­¦ä¹ ç‡$\alpha \in [10^{-4}, 10^{-3}]$çœ‹èµ·æ¥ä¸å¯¹â€¦â€¦å®é™…ä¸Šè¦è€ƒè™‘RMSPropçš„ç¼©æ”¾ï¼š</p>
<p>$$
\text{RMS}(\Delta \boldsymbol{W}) = \alpha \cdot \text{RMS}\left(\frac{1}{\sqrt{v}}\right) \approx \frac{\alpha}{\text{RMS}(\sqrt{v})}
$$</p>
<p>å½“$v \sim \sigma^2$æ—¶ï¼Œè¿™ä¸ªæ¯”ä¾‹çº¦ä¸º$10^{-4} / 10^{-3} \sim 0.1$...</p>
<p>å®é™…ä¸Š0.2æ˜¯ç»éªŒå€¼ï¼Œå¯èƒ½ä¾èµ–äºå…·ä½“çš„ç½‘ç»œç»“æ„å’Œåˆå§‹åŒ–ã€‚</p>
<h4 id="105">10.5 ä¸åŒçŸ©é˜µå½¢çŠ¶çš„å­¦ä¹ ç‡è°ƒæ•´</h4>
<p>æ–‡ç« æŒ‡å‡ºï¼š</p>
<p>$$
\text{RMS}(\text{msign}(\boldsymbol{M})) = \sqrt{\frac{\min(n,m)}{nm}} = \frac{1}{\sqrt{\max(n,m)}}
$$</p>
<p>å› æ­¤æœ‰æ•ˆå­¦ä¹ ç‡åº”è¯¥æ˜¯ï¼š</p>
<p>$$
\eta_{\text{eff}} = \eta \cdot \sqrt{\max(n,m)}
$$</p>
<p><strong>å‡ ä½•è§£é‡Š</strong>ï¼šå¯¹äº$n \ll m$çš„"ç˜¦é«˜"çŸ©é˜µï¼Œ$\text{msign}(\boldsymbol{M})$çš„å…ƒç´ RMSå¾ˆå°ï¼Œéœ€è¦æ”¾å¤§å­¦ä¹ ç‡ä»¥ä¿æŒä¸æ–¹é˜µç›¸åŒçš„æ›´æ–°å¹…åº¦ã€‚</p>
<p><strong>ä¾‹å­</strong>ï¼š
- $\boldsymbol{W}<em _text_eff="\text{eff">1 \in \mathbb{R}^{1024 \times 1024}$ï¼š$\eta</em> = \eta \cdot 32$
- $\boldsymbol{W}}<em _text_eff="\text{eff">2 \in \mathbb{R}^{1024 \times 32000}$ï¼š$\eta</em> = \eta \cdot 179$}</p>
<p>ä¸¤è€…ç›¸å·®çº¦5.6å€ï¼Œæ­£æ˜¯$\sqrt{32000/1024} \approx 5.6$ã€‚</p>
<h3 id="11">11. æ‰©å±•ç†è®ºä¸æœªæ¥æ–¹å‘</h3>
<h4 id="111-schatten">11.1 SchattenèŒƒæ•°æ—</h4>
<p>Schatten-$p$èŒƒæ•°å®šä¹‰ä¸ºï¼š</p>
<p>$$
\Vert \boldsymbol{W} \Vert_p = \left(\sum_{i=1}^r \sigma_i^p\right)^{1/p}
$$</p>
<p>ç‰¹ä¾‹ï¼š
- $p=1$ï¼šæ ¸èŒƒæ•°ï¼ˆnuclear normï¼‰
- $p=2$ï¼šFrobeniusèŒƒæ•°
- $p=\infty$ï¼šè°±èŒƒæ•°</p>
<p>å¯¹åº”çš„ä¼˜åŒ–é—®é¢˜ï¼š</p>
<p>$$
\min_{\Delta \boldsymbol{W}} \text{Tr}(\boldsymbol{G}^{\top} \Delta \boldsymbol{W}) \quad \text{s.t.} \quad \Vert \Delta \boldsymbol{W} \Vert_p \leq \eta
$$</p>
<p><strong>$p=1$ï¼ˆæ ¸èŒƒæ•°ï¼‰</strong>ï¼šè§£ä¸ºä½ç§©çŸ©é˜µï¼Œç›¸å½“äºç¨€ç–æ­£åˆ™åŒ–ï¼ˆåœ¨å¥‡å¼‚å€¼ä¸Šï¼‰</p>
<p><strong>$p=2$ï¼ˆFrobeniusï¼‰</strong>ï¼šè§£ä¸º$\Delta \boldsymbol{W} = -\eta \boldsymbol{G} / \Vert \boldsymbol{G} \Vert_F$ï¼ˆæ ‡å‡†SGDï¼‰</p>
<p><strong>$p=\infty$ï¼ˆè°±èŒƒæ•°ï¼‰</strong>ï¼šè§£ä¸º$\Delta \boldsymbol{W} = -\eta \boldsymbol{u}_1 \boldsymbol{v}_1^{\top}$ï¼ˆMuonï¼‰</p>
<p>ä¸­é—´çš„$p \in (1, \infty)$å¯èƒ½æä¾›æ›´å¥½çš„trade-offï¼Œå€¼å¾—æ¢ç´¢ï¼</p>
<h4 id="112-p-maximal-update-parametrizationmuon">11.2 ÂµP (Maximal Update Parametrization)ä¸Muon</h4>
<p>ÂµPæ˜¯ä¸€ç§å‚æ•°åŒ–æ–¹æ¡ˆï¼Œä½¿å¾—è¶…å‚æ•°åœ¨ä¸åŒæ¨¡å‹å°ºåº¦ä¸‹å¯è¿ç§»ã€‚æ ¸å¿ƒæ€æƒ³ï¼š</p>
<p>ä¸åŒå±‚çš„å­¦ä¹ ç‡åº”è¯¥æŒ‰ç…§å…¶å®½åº¦ç¼©æ”¾ï¼š</p>
<p>$$
\eta_{\ell} = \frac{\eta_{\text{base}}}{w_{\ell}}
$$</p>
<p>å…¶ä¸­$w_{\ell}$æ˜¯ç¬¬$\ell$å±‚çš„å®½åº¦ã€‚</p>
<p>å¯¹äºMuonï¼Œç”±äºå·²ç»æœ‰$\sqrt{\max(n,m)}$çš„è‡ªé€‚åº”ï¼ŒÂµPçš„è®¾è®¡éœ€è¦é‡æ–°è€ƒè™‘ï¼š</p>
<p>$$
\eta_{\ell}^{\text{Muon}} = \eta_{\text{base}} \cdot \frac{\sqrt{\max(n_{\ell}, m_{\ell})}}{w_{\text{base}}}
$$</p>
<p>è¿™æ˜¯ä¸€ä¸ªå¼€æ”¾é—®é¢˜ï¼Œéœ€è¦å®éªŒéªŒè¯ã€‚</p>
<h4 id="113">11.3 åˆ†å¸ƒå¼è®­ç»ƒçš„è€ƒè™‘</h4>
<p>åœ¨æ•°æ®å¹¶è¡Œä¸­ï¼Œæ¢¯åº¦éœ€è¦all-reduceï¼š</p>
<p>$$
\boldsymbol{G} = \frac{1}{K} \sum_{k=1}^K \boldsymbol{G}_k
$$</p>
<p>å¯¹äºAdamï¼Œall-reduceåç›´æ¥åº”ç”¨é€å…ƒç´ æ“ä½œï¼Œé€šä¿¡é‡$O(nm)$ã€‚</p>
<p>å¯¹äºMuonï¼Œéœ€è¦å¯¹all-reduceåçš„$\boldsymbol{G}$åšSVDï¼Œé€šä¿¡é‡ç›¸åŒï¼Œä½†è®¡ç®—é›†ä¸­åœ¨ä¸»èŠ‚ç‚¹ï¼Œå¯èƒ½æˆä¸ºç“¶é¢ˆã€‚</p>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆ</strong>ï¼šæ¯ä¸ªèŠ‚ç‚¹ç‹¬ç«‹è®¡ç®—$\boldsymbol{G}_k$çš„SVDï¼Œç„¶åå¹³å‡å¥‡å¼‚å‘é‡ï¼š</p>
<p>$$
\boldsymbol{u} = \frac{1}{K} \sum_{k=1}^K \boldsymbol{u}_k, \quad \boldsymbol{v} = \frac{1}{K} \sum_{k=1}^K \boldsymbol{v}_k
$$</p>
<p>å†æ­£äº¤åŒ–ã€‚è¿™éœ€è¦ç†è®ºåˆ†æå…¶è¿‘ä¼¼è¯¯å·®ã€‚</p>
<h3 id="12_1">12. æ€»ç»“ä¸æ´å¯Ÿ</h3>
<p>æœ¬æ¨å¯¼ä»ä¼˜åŒ–ç†è®ºçš„ç¬¬ä¸€åŸç†å‡ºå‘ï¼Œå®Œæ•´åœ°è§£é‡Šäº†Muonä¼˜åŒ–å™¨çš„è®¾è®¡åŠ¨æœºå’Œç†è®ºåŸºç¡€ï¼š</p>
<ol>
<li>
<p><strong>æœ€å°ä½œç”¨é‡åŸç†</strong>ï¼šä¼˜åŒ–å™¨æœ¬è´¨ä¸Šæ˜¯åœ¨"ç¨³"ï¼ˆå°æ‰°åŠ¨ï¼‰å’Œ"å¿«"ï¼ˆå¤§é™æŸå¤±ï¼‰ä¹‹é—´æƒè¡¡ï¼Œä¸åŒçš„"ç¨³"åº¦é‡å¯¼è‡´ä¸åŒçš„ä¼˜åŒ–å™¨ã€‚</p>
</li>
<li>
<p><strong>è°±èŒƒæ•°çš„æœ€ä¼˜æ€§</strong>ï¼šå¯¹äºçŸ©é˜µå‚æ•°ï¼Œè°±èŒƒæ•°æ˜¯æ§åˆ¶è¾“å‡ºæ‰°åŠ¨çš„æœ€ç´§ç•Œï¼Œè¿™æ˜¯Muonç›¸æ¯”SGDï¼ˆ$F$èŒƒæ•°ï¼‰çš„ç†è®ºä¼˜åŠ¿ã€‚</p>
</li>
<li>
<p><strong>msignçš„å‡ ä½•æ„ä¹‰</strong>ï¼šå®ƒæ˜¯è°±èŒƒæ•°çƒä¸Šçš„æœ€é€Ÿä¸‹é™æ–¹å‘ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æ¢¯åº¦çš„ç§©1æœ€ä½³è¿‘ä¼¼ï¼Œä½“ç°äº†ä½ç§©ç»“æ„çš„åˆ©ç”¨ã€‚</p>
</li>
<li>
<p><strong>ä¸Adamçš„æ ¹æœ¬å·®å¼‚</strong>ï¼šAdamæ˜¯é€å…ƒç´ çš„è‡ªé€‚åº”ï¼Œå¿½ç•¥äº†å‚æ•°çŸ©é˜µçš„æ•´ä½“ç»“æ„ï¼›Muonæ˜¯æ•´ä½“çš„è°±æŠ•å½±ï¼Œå……åˆ†åˆ©ç”¨äº†çŸ©é˜µçš„å‡ ä½•ã€‚</p>
</li>
<li>
<p><strong>å®éªŒç°è±¡çš„ç†è®ºè§£é‡Š</strong>ï¼š</p>
</li>
<li>æ”¶æ•›æ›´å¿«ï¼šå› ä¸ºæ›´å¥½åœ°å¯¹é½äº†æ¢¯åº¦çš„ä¸»æ–¹å‘</li>
<li>å¥‡å¼‚å€¼ç†µæ›´é«˜ï¼šå› ä¸ºè°±çº¦æŸé¼“åŠ±å‚æ•°çš„å‡åŒ€åˆ©ç”¨</li>
<li>
<p>å¾®è°ƒå…¼å®¹æ€§é—®é¢˜ï¼šå› ä¸ºHessianè°±ç»“æ„çš„ä¸åŒ¹é…</p>
</li>
<li>
<p><strong>æœªæ¥æ–¹å‘</strong>ï¼šSchattenèŒƒæ•°æ—ã€ÂµPé€‚é…ã€åˆ†å¸ƒå¼ä¼˜åŒ–ç­‰éƒ½æ˜¯å€¼å¾—æ¢ç´¢çš„ç†è®ºå’Œå®è·µé—®é¢˜ã€‚</p>
</li>
</ol>
<p>è¿™äº›æ¨å¯¼ä¸ä»…åŠ æ·±äº†å¯¹Muonçš„ç†è§£ï¼Œä¹Ÿä¸ºè®¾è®¡æ–°çš„ä¼˜åŒ–å™¨æä¾›äº†ç†è®ºæŒ‡å¯¼ï¼š<strong>ä»å‚æ•°çš„å†…åœ¨å‡ ä½•ç»“æ„å‡ºå‘ï¼Œè€Œéç®€å•çš„é€å…ƒç´ æ“ä½œ</strong>ã€‚</p>
        </div>
    </div>
</body>
</html>