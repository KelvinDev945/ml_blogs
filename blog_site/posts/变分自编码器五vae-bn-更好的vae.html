<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å˜åˆ†è‡ªç¼–ç å™¨ï¼ˆäº”ï¼‰ï¼šVAE + BN = æ›´å¥½çš„VAE</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>å˜åˆ†è‡ªç¼–ç å™¨ï¼ˆäº”ï¼‰ï¼šVAE + BN = æ›´å¥½çš„VAE</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-12-31 | ğŸ“„ å¤§å°: 12.6 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/7381">https://spaces.ac.cn/archives/7381</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>æœ¬æ–‡æˆ‘ä»¬ç»§ç»­ä¹‹å‰çš„<a href="/search/%E5%8F%98%E5%88%86%E8%87%AA%E7%BC%96%E7%A0%81%E5%99%A8/">å˜åˆ†è‡ªç¼–ç å™¨ç³»åˆ—</a>ï¼Œåˆ†æä¸€ä¸‹å¦‚ä½•é˜²æ­¢NLPä¸­çš„VAEæ¨¡å‹å‡ºç°â€œKLæ•£åº¦æ¶ˆå¤±ï¼ˆKL Vanishingï¼‰â€ç°è±¡ã€‚æœ¬æ–‡å—åˆ°å‚è€ƒæ–‡çŒ®æ˜¯ACL 2020çš„è®ºæ–‡<a href="https://papers.cool/arxiv/2004.12585">ã€ŠA Batch Normalized Inference Network Keeps the KL Vanishing Awayã€‹</a>çš„å¯å‘ï¼Œå¹¶è‡ªè¡Œåšäº†è¿›ä¸€æ­¥çš„å®Œå–„ã€‚</p>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæœ¬æ–‡æœ€åå¾—åˆ°çš„æ–¹æ¡ˆè¿˜æ˜¯é¢‡ä¸ºç®€æ´çš„â€”â€”<strong>åªéœ€å¾€ç¼–ç è¾“å‡ºåŠ å…¥BNï¼ˆBatch Normalizationï¼‰ï¼Œç„¶ååŠ ä¸ªç®€å•çš„scale</strong> â€”â€”ä½†ç¡®å®å¾ˆæœ‰æ•ˆï¼Œå› æ­¤å€¼å¾—æ­£åœ¨ç ”ç©¶ç›¸å…³é—®é¢˜çš„è¯»è€…ä¸€è¯•ã€‚åŒæ—¶ï¼Œç›¸å…³ç»“è®ºä¹Ÿé€‚ç”¨äºä¸€èˆ¬çš„VAEæ¨¡å‹ï¼ˆåŒ…æ‹¬CVçš„ï¼‰ï¼Œå¦‚æœæŒ‰ç…§ç¬”è€…çš„çœ‹æ³•ï¼Œå®ƒç”šè‡³å¯ä»¥ä½œä¸ºVAEæ¨¡å‹çš„â€œæ ‡é…â€ã€‚</p>
<p>æœ€åï¼Œè¦æé†’è¯»è€…è¿™ç®—æ˜¯ä¸€ç¯‡VAEçš„è¿›é˜¶è®ºæ–‡ï¼Œæ‰€ä»¥è¯·è¯»è€…å¯¹VAEæœ‰ä¸€å®šäº†è§£åå†æ¥é˜…è¯»æœ¬æ–‡ã€‚</p>
<h2 id="vae">VAEç®€å•å›é¡¾</h2>
<p>è¿™é‡Œæˆ‘ä»¬ç®€å•å›é¡¾ä¸€ä¸‹VAEæ¨¡å‹ï¼Œå¹¶ä¸”è®¨è®ºä¸€ä¸‹VAEåœ¨NLPä¸­æ‰€é‡åˆ°çš„å›°éš¾ã€‚å…³äºVAEçš„æ›´è¯¦ç»†ä»‹ç»ï¼Œè¯·è¯»è€…å‚è€ƒç¬”è€…çš„æ—§ä½œ<a href="/archives/5253">ã€Šå˜åˆ†è‡ªç¼–ç å™¨ï¼ˆä¸€ï¼‰ï¼šåŸæ¥æ˜¯è¿™ä¹ˆä¸€å›äº‹ã€‹</a>ã€<a href="/archives/5343">ã€Šå˜åˆ†è‡ªç¼–ç å™¨ï¼ˆäºŒï¼‰ï¼šä»è´å¶æ–¯è§‚ç‚¹å‡ºå‘ã€‹</a>ç­‰ã€‚</p>
<h3 id="vae_1">VAEçš„è®­ç»ƒæµç¨‹</h3>
<p>VAEçš„è®­ç»ƒæµç¨‹å¤§æ¦‚å¯ä»¥å›¾ç¤ºä¸º  </p>
<p><a href="/usr/uploads/2020/05/1557384471.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="VAEè®­ç»ƒæµç¨‹å›¾ç¤º" src="/usr/uploads/2020/05/1557384471.png" /></a></p>
<p>VAEè®­ç»ƒæµç¨‹å›¾ç¤º</p>
<p>å†™æˆå…¬å¼å°±æ˜¯<br />
$$\begin{equation}\mathcal{L} = \mathbb{E}_{x\sim \tilde{p}(x)} \Big[\mathbb{E}_{z\sim p(z|x)}\big[-\log q(x|z)\big]+KL\big(p(z|x)\big\Vert q(z)\big)\Big]  
\end{equation}$$<br />
å…¶ä¸­ç¬¬ä¸€é¡¹å°±æ˜¯é‡æ„é¡¹ï¼Œ$\mathbb{E}_{z\sim p(z|x)}$æ˜¯é€šè¿‡é‡å‚æ•°æ¥å®ç°ï¼›ç¬¬äºŒé¡¹åˆ™ç§°ä¸ºKLæ•£åº¦é¡¹ï¼Œè¿™æ˜¯å®ƒè·Ÿæ™®é€šè‡ªç¼–ç å™¨çš„æ˜¾å¼å·®åˆ«ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸€é¡¹ï¼Œé‚£ä¹ˆåŸºæœ¬ä¸Šé€€åŒ–ä¸ºå¸¸è§„çš„AEã€‚æ›´è¯¦ç»†çš„ç¬¦å·å«ä¹‰å¯ä»¥å‚è€ƒ<a href="/archives/5343">ã€Šå˜åˆ†è‡ªç¼–ç å™¨ï¼ˆäºŒï¼‰ï¼šä»è´å¶æ–¯è§‚ç‚¹å‡ºå‘ã€‹</a>ã€‚</p>
<h3 id="nlpvae">NLPä¸­çš„VAE</h3>
<p>åœ¨NLPä¸­ï¼Œå¥å­è¢«ç¼–ç ä¸ºç¦»æ•£çš„æ•´æ•°IDï¼Œæ‰€ä»¥$q(x|z)$æ˜¯ä¸€ä¸ªç¦»æ•£å‹åˆ†å¸ƒï¼Œå¯ä»¥ç”¨ä¸‡èƒ½çš„â€œæ¡ä»¶è¯­è¨€æ¨¡å‹â€æ¥å®ç°ï¼Œå› æ­¤ç†è®ºä¸Š$q(x|z)$å¯ä»¥ç²¾ç¡®åœ°æ‹Ÿåˆç”Ÿæˆåˆ†å¸ƒï¼Œé—®é¢˜å°±å‡ºåœ¨$q(x|z)$å¤ªå¼ºäº†ï¼Œè®­ç»ƒæ—¶é‡å‚æ•°æ“ä½œä¼šæ¥å™ªå£°ï¼Œå™ªå£°ä¸€å¤§ï¼Œ$z$çš„åˆ©ç”¨å°±å˜å¾—å›°éš¾èµ·æ¥ï¼Œæ‰€ä»¥å®ƒå¹²è„†ä¸è¦$z$äº†ï¼Œé€€åŒ–ä¸ºæ— æ¡ä»¶è¯­è¨€æ¨¡å‹ï¼ˆä¾ç„¶å¾ˆå¼ºï¼‰ï¼Œ$KL(p(z|x)\Vert q(z))$åˆ™éšä¹‹ä¸‹é™åˆ°0ï¼Œè¿™å°±å‡ºç°äº†KLæ•£åº¦æ¶ˆå¤±ç°è±¡ã€‚</p>
<p>è¿™ç§æƒ…å†µä¸‹çš„VAEæ¨¡å‹å¹¶æ²¡æœ‰ä»€ä¹ˆä»·å€¼ï¼šKLæ•£åº¦ä¸º0è¯´æ˜ç¼–ç å™¨è¾“å‡ºçš„æ˜¯å¸¸æ•°å‘é‡ï¼Œè€Œè§£ç å™¨åˆ™æ˜¯ä¸€ä¸ªæ™®é€šçš„è¯­è¨€æ¨¡å‹ã€‚è€Œæˆ‘ä»¬ä½¿ç”¨VAEé€šå¸¸æ¥è¯´æ˜¯çœ‹ä¸­äº†å®ƒæ— ç›‘ç£æ„å»ºç¼–ç å‘é‡çš„èƒ½åŠ›ï¼Œæ‰€ä»¥è¦åº”ç”¨VAEçš„è¯è¿˜æ˜¯å¾—è§£å†³KLæ•£åº¦æ¶ˆå¤±é—®é¢˜ã€‚äº‹å®ä¸Šä»2016å¼€å§‹ï¼Œæœ‰ä¸å°‘å·¥ä½œåœ¨åšè¿™ä¸ªé—®é¢˜ï¼Œç›¸åº”åœ°ä¹Ÿæå‡ºäº†å¾ˆå¤šæ–¹æ¡ˆï¼Œæ¯”å¦‚é€€ç«ç­–ç•¥ã€æ›´æ¢å…ˆéªŒåˆ†å¸ƒç­‰ï¼Œè¯»è€…Googleä¸€ä¸‹â€œKL Vanishingâ€å°±å¯ä»¥æ‰¾åˆ°å¾ˆå¤šæ–‡çŒ®äº†ï¼Œè¿™é‡Œä¸ä¸€ä¸€æº¯æºã€‚</p>
<h2 id="bn">BNçš„å·§ä¸å¦™</h2>
<p>æœ¬æ–‡çš„æ–¹æ¡ˆåˆ™æ˜¯ç›´æ¥é’ˆå¯¹KLæ•£åº¦é¡¹å…¥æ‰‹ï¼Œç®€å•æœ‰æ•ˆè€Œä¸”æ²¡ä»€ä¹ˆè¶…å‚æ•°ã€‚å…¶æ€æƒ³å¾ˆç®€å•ï¼š</p>
<blockquote>
<p>KLæ•£åº¦æ¶ˆå¤±ä¸å°±æ˜¯KLæ•£åº¦é¡¹å˜æˆ0å—ï¼Ÿæˆ‘è°ƒæ•´ä¸€ä¸‹ç¼–ç å™¨è¾“å‡ºï¼Œè®©KLæ•£åº¦æœ‰ä¸€ä¸ªå¤§äºé›¶çš„ä¸‹ç•Œï¼Œè¿™æ ·å®ƒä¸å°±è‚¯å®šä¸ä¼šæ¶ˆå¤±äº†å—ï¼Ÿ</p>
</blockquote>
<p>è¿™ä¸ªç®€å•çš„æ€æƒ³çš„ç›´æ¥ç»“æœå°±æ˜¯ï¼šåœ¨$\mu$åé¢åŠ å…¥BNå±‚ï¼Œå¦‚å›¾  </p>
<p><a href="/usr/uploads/2020/05/3260688433.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="å¾€VAEé‡ŒåŠ å…¥BN" src="/usr/uploads/2020/05/3260688433.png" /></a></p>
<p>å¾€VAEé‡ŒåŠ å…¥BN</p>
<h3 id="_1">æ¨å¯¼è¿‡ç¨‹ç®€è¿°</h3>
<p>ä¸ºä»€ä¹ˆä¼šè·ŸBNè”ç³»èµ·æ¥å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹KLæ•£åº¦é¡¹çš„å½¢å¼ï¼š<br />
\begin{equation}\mathbb{E}<em i="1">{x\sim\tilde{p}(x)}\left[KL\big(p(z|x)\big\Vert q(z)\big)\right] = \frac{1}{b} \sum</em>}^b \sum_{j=1}^d \frac{1}{2}\Big(\mu_{i,j}^2 + \sigma_{i,j}^2 - \log \sigma_{i,j}^2 - 1\Big)\end{equation<br />
ä¸Šå¼æ˜¯é‡‡æ ·äº†$b$ä¸ªæ ·æœ¬è¿›è¡Œè®¡ç®—çš„ç»“æœï¼Œè€Œç¼–ç å‘é‡çš„ç»´åº¦åˆ™æ˜¯$d$ç»´ã€‚ç”±äºæˆ‘ä»¬æ€»æ˜¯æœ‰$e^x \geq x + 1$ï¼Œæ‰€ä»¥$\sigma_{i,j}^2 - \log \sigma_{i,j}^2 - 1 \geq 0$ï¼Œå› æ­¤<br />
\begin{equation}\mathbb{E}<em i="1">{x\sim\tilde{p}(x)}\left[KL\big(p(z|x)\big\Vert q(z)\big)\right] \geq \frac{1}{b} \sum</em>}^b \sum_{j=1}^d \frac{1}{2}\mu_{i,j}^2 = \frac{1}{2}\sum_{j=1}^d \left(\frac{1}{b} \sum_{i=1}^b \mu_{i,j}^2\right)\label{eq:kl}\end{equation<br />
ç•™æ„åˆ°æ‹¬å·é‡Œè¾¹çš„é‡ï¼Œå…¶å®å®ƒå°±æ˜¯$\mu$åœ¨batchå†…çš„äºŒé˜¶çŸ©ï¼Œå¦‚æœæˆ‘ä»¬å¾€$\mu$åŠ å…¥BNå±‚ï¼Œé‚£ä¹ˆå¤§ä½“ä¸Šå¯ä»¥ä¿è¯$\mu$çš„å‡å€¼ä¸º$\beta$ï¼Œæ–¹å·®ä¸º$\gamma^2$ï¼ˆ$\beta,\gamma$æ˜¯BNé‡Œè¾¹çš„å¯è®­ç»ƒå‚æ•°ï¼‰ï¼Œè¿™æ—¶å€™<br />
\begin{equation}\mathbb{E}_{x\sim\tilde{p}(x)}\left[KL\big(p(z|x)\big\Vert q(z)\big)\right] \geq \frac{d}{2}\left(\beta^2 + \gamma^2\right)\label{eq:kl-lb}\end{equation}<br />
æ‰€ä»¥åªè¦æ§åˆ¶å¥½$\beta,\gamma$ï¼ˆä¸»è¦æ˜¯å›ºå®š$\gamma$ä¸ºæŸä¸ªå¸¸æ•°ï¼‰ï¼Œå°±å¯ä»¥è®©KLæ•£åº¦é¡¹æœ‰ä¸ªæ­£çš„ä¸‹ç•Œï¼Œå› æ­¤å°±ä¸ä¼šå‡ºç°KLæ•£åº¦æ¶ˆå¤±ç°è±¡äº†ã€‚è¿™æ ·ä¸€æ¥ï¼ŒKLæ•£åº¦æ¶ˆå¤±ç°è±¡è·ŸBNå°±è¢«å·§å¦™åœ°è”ç³»èµ·æ¥äº†ï¼Œé€šè¿‡BNæ¥â€œæœç»â€äº†KLæ•£åº¦æ¶ˆå¤±çš„å¯èƒ½æ€§ã€‚</p>
<h3 id="ln">ä¸ºä»€ä¹ˆä¸æ˜¯LNï¼Ÿ</h3>
<p>å–„äºæ¨å¯¼çš„è¯»è€…å¯èƒ½ä¼šæƒ³åˆ°ï¼ŒæŒ‰ç…§ä¸Šè¿°æ€è·¯ï¼Œå¦‚æœåªæ˜¯ä¸ºäº†è®©KLæ•£åº¦é¡¹æœ‰ä¸ªæ­£çš„ä¸‹ç•Œï¼Œå…¶å®LNï¼ˆLayer Normalizationï¼‰ä¹Ÿå¯ä»¥ï¼Œä¹Ÿå°±æ˜¯åœ¨å¼$\eqref{eq:kl}$ä¸­æŒ‰$j$é‚£ä¸€ç»´å½’ä¸€åŒ–ã€‚</p>
<p><strong>é‚£ä¸ºä»€ä¹ˆç”¨BNè€Œä¸æ˜¯LNå‘¢ï¼Ÿ</strong></p>
<p>è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆä¹Ÿæ˜¯BNçš„å·§å¦™ä¹‹å¤„ã€‚ç›´è§‚æ¥ç†è§£ï¼ŒKLæ•£åº¦æ¶ˆå¤±æ˜¯å› ä¸º$z\sim p(z|x)$çš„å™ªå£°æ¯”è¾ƒå¤§ï¼Œè§£ç å™¨æ— æ³•å¾ˆå¥½åœ°è¾¨åˆ«å‡º$z$ä¸­çš„éå™ªå£°æˆåˆ†ï¼Œæ‰€ä»¥å¹²è„†å¼ƒä¹‹ä¸ç”¨ï¼›è€Œå½“ç»™$\mu(x)$åŠ ä¸ŠBNåï¼Œç›¸å½“äºé€‚å½“åœ°æ‹‰å¼€äº†ä¸åŒæ ·æœ¬çš„$z$çš„è·ç¦»ï¼Œä½¿å¾—å“ªæ€•$z$å¸¦äº†å™ªå£°ï¼ŒåŒºåˆ†èµ·æ¥ä¹Ÿå®¹æ˜“ä¸€äº›ï¼Œæ‰€ä»¥è¿™æ—¶å€™è§£ç å™¨ä¹æ„ç”¨$z$çš„ä¿¡æ¯ï¼Œå› æ­¤èƒ½ç¼“è§£è¿™ä¸ªé—®é¢˜ï¼›ç›¸æ¯”ä¹‹ä¸‹ï¼ŒLNæ˜¯åœ¨æ ·æœ¬å†…è¿›çš„è¡Œå½’ä¸€åŒ–ï¼Œæ²¡æœ‰æ‹‰å¼€æ ·æœ¬é—´å·®è·çš„ä½œç”¨ï¼Œæ‰€ä»¥LNçš„æ•ˆæœä¸ä¼šæœ‰BNé‚£ä¹ˆå¥½ã€‚</p>
<h2 id="_2">è¿›ä¸€æ­¥çš„ç»“æœ</h2>
<p>äº‹å®ä¸Šï¼ŒåŸè®ºæ–‡çš„æ¨å¯¼åˆ°ä¸Šé¢åŸºæœ¬ä¸Šå°±ç»“æŸäº†ï¼Œå‰©ä¸‹çš„éƒ½æ˜¯å®éªŒéƒ¨åˆ†ï¼ŒåŒ…æ‹¬é€šè¿‡å®éªŒæ¥ç¡®å®š$\gamma$çš„å€¼ã€‚ç„¶è€Œï¼Œç¬”è€…è®¤ä¸ºç›®å‰ä¸ºæ­¢çš„ç»“è®ºè¿˜æœ‰ä¸€äº›ç¾ä¸­ä¸è¶³çš„åœ°æ–¹ï¼Œæ¯”å¦‚æ²¡æœ‰æä¾›å…³äºåŠ å…¥BNçš„æ›´æ·±åˆ»ç†è§£ï¼Œå€’æ›´åƒæ˜¯ä¸€ä¸ªå·¥ç¨‹çš„æŠ€å·§ï¼Œåˆæ¯”å¦‚åªæ˜¯$\mu(x)$åŠ ä¸Šäº†BNï¼Œ$\sigma(x)$æ²¡æœ‰åŠ ä¸Šï¼Œæœªå…æœ‰äº›ä¸å¯¹ç§°ä¹‹æ„Ÿã€‚</p>
<p>ç»è¿‡ç¬”è€…çš„æ¨å¯¼ï¼Œå‘ç°ä¸Šé¢çš„ç»“è®ºå¯ä»¥è¿›ä¸€æ­¥å®Œå–„ã€‚</p>
<h3 id="_3">è”ç³»åˆ°å…ˆéªŒåˆ†å¸ƒ</h3>
<p>å¯¹äºVAEæ¥è¯´ï¼Œå®ƒå¸Œæœ›è®­ç»ƒå¥½åçš„æ¨¡å‹çš„éšå˜é‡åˆ†å¸ƒä¸ºå…ˆéªŒåˆ†å¸ƒ$q(z)=\mathcal{N}(z;0,1)$ï¼Œè€ŒåéªŒåˆ†å¸ƒåˆ™æ˜¯$p(z|x)=\mathcal{N}(z; \mu(x),\sigma^2(x))$ï¼Œæ‰€ä»¥VAEå¸Œæœ›ä¸‹å¼æˆç«‹ï¼š<br />
\begin{equation}q(z) = \int \tilde{p}(x)p(z|x)dx=\int \tilde{p}(x)\mathcal{N}(z; \mu(x),\sigma^2(x))dx\end{equation}<br />
ä¸¤è¾¹ä¹˜ä»¥$z$ï¼Œå¹¶å¯¹$z$ç§¯åˆ†ï¼Œå¾—åˆ°<br />
\begin{equation}0 = \int \tilde{p}(x)\mu(x)dx=\mathbb{E}<em _tilde_p="\tilde{p" x_sim="x\sim">{x\sim \tilde{p}(x)}[\mu(x)]\end{equation}<br />
ä¸¤è¾¹ä¹˜ä»¥$z^2$ï¼Œå¹¶å¯¹$z$ç§¯åˆ†ï¼Œå¾—åˆ°<br />
\begin{equation}1 = \int \tilde{p}(x)\left[\mu^2(x) + \sigma^2(x)\right]dx = \mathbb{E}</em>}(x)}\left[\mu^2(x)\right] + \mathbb{E<em _tilde_p="\tilde{p" x_sim="x\sim">{x\sim \tilde{p}(x)}\left[\sigma^2(x)\right]\end{equation}<br />
å¦‚æœå¾€$\mu(x),\sigma(x)$éƒ½åŠ å…¥BNï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æœ‰<br />
\begin{equation}\begin{aligned}<br />
&amp;0 = \mathbb{E}</em>\\\}(x)}[\mu(x)] = \beta_{\mu<br />
&amp;1 = \mathbb{E}<em _tilde_p="\tilde{p" x_sim="x\sim">{x\sim \tilde{p}(x)}\left[\mu^2(x)\right] + \mathbb{E}</em>^2}(x)}\left[\sigma^2(x)\right] = \beta_{\mu}^2 + \gamma_{\mu}^2 + \beta_{\sigma}^2 + \gamma_{\sigma<br />
\end{aligned}\end{equation}<br />
æ‰€ä»¥ç°åœ¨æˆ‘ä»¬çŸ¥é“$\beta_{\mu}$ä¸€å®šæ˜¯0ï¼Œè€Œå¦‚æœæˆ‘ä»¬ä¹Ÿå›ºå®š$\beta_{\sigma}=0$ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æœ‰çº¦æŸå…³ç³»ï¼š<br />
\begin{equation}1 = \gamma_{\mu}^2 + \gamma_{\sigma}^2\label{eq:gamma2}\end{equation}</p>
<h3 id="_4">å‚è€ƒçš„å®ç°æ–¹æ¡ˆ</h3>
<p>ç»è¿‡è¿™æ ·çš„æ¨å¯¼ï¼Œæˆ‘ä»¬å‘ç°å¯ä»¥å¾€$\mu(x),\sigma(x)$éƒ½åŠ å…¥BNï¼Œå¹¶ä¸”å¯ä»¥å›ºå®š$\beta_{\mu}=\beta_{\sigma}=0$ï¼Œä½†æ­¤æ—¶éœ€è¦æ»¡è¶³çº¦æŸ$\eqref{eq:gamma2}$ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™éƒ¨åˆ†è®¨è®ºè¿˜ä»…ä»…æ˜¯å¯¹VAEçš„ä¸€èˆ¬åˆ†æï¼Œå¹¶æ²¡æœ‰æ¶‰åŠåˆ°KLæ•£åº¦æ¶ˆå¤±é—®é¢˜ï¼Œå“ªæ€•è¿™äº›æ¡ä»¶éƒ½æ»¡è¶³äº†ï¼Œä¹Ÿæ— æ³•ä¿è¯KLé¡¹ä¸è¶‹äº0ã€‚ç»“åˆå¼$\eqref{eq:kl-lb}$æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œä¿è¯KLæ•£åº¦ä¸æ¶ˆå¤±çš„å…³é”®æ˜¯ç¡®ä¿$\gamma_{\mu} &gt; 0$ï¼Œæ‰€ä»¥ï¼Œç¬”è€…æå‡ºçš„æœ€ç»ˆç­–ç•¥æ˜¯ï¼š<br />
\begin{equation}\begin{aligned}<br />
&amp;\beta_{\mu}=\beta_{\sigma}=0\\\<br />
&amp;\gamma_{\mu} = \sqrt{\tau + (1-\tau)\cdot\text{sigmoid}(\theta)}\\\<br />
&amp;\gamma_{\sigma} = \sqrt{(1-\tau)\cdot\text{sigmoid}(-\theta)}<br />
\end{aligned}\end{equation}<br />
å…¶ä¸­$\tau\in(0,1)$æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œç¬”è€…åœ¨è‡ªå·±çš„å®éªŒä¸­å–äº†$\tau=0.5$ï¼Œè€Œ$\theta$æ˜¯å¯è®­ç»ƒå‚æ•°ï¼Œä¸Šå¼åˆ©ç”¨äº†æ’ç­‰å¼$\text{sigmoid}(-\theta) = 1-\text{sigmoid}(\theta)$ã€‚</p>
<p>å…³é”®ä»£ç å‚è€ƒï¼ˆKerasï¼‰ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">Scaler</span>(<span class="n">Layer</span>):
    <span class="s">&quot;&quot;&quot;ç‰¹æ®Šçš„scaleå±‚</span>
<span class="s">    &quot;&quot;&quot;</span>
    <span class="n">def</span> <span class="n">__init__</span>(<span class="nb">self</span>, <span class="n">tau</span>=<span class="mf">0.5</span>, **<span class="n">kwargs</span>):
        <span class="n">super</span>(<span class="n">Scaler</span>, <span class="nb">self</span>).<span class="n">__init__</span>(**<span class="n">kwargs</span>)
        <span class="nb">self</span>.<span class="n">tau</span> = <span class="n">tau</span>

    <span class="n">def</span> <span class="n">build</span>(<span class="nb">self</span>, <span class="n">input_shape</span>):
        <span class="n">super</span>(<span class="n">Scaler</span>, <span class="nb">self</span>).<span class="n">build</span>(<span class="n">input_shape</span>)
        <span class="nb">self</span>.<span class="n">scale</span> = <span class="nb">self</span>.<span class="n">add_weight</span>(
            <span class="nb">name</span>=<span class="s">&#39;scale&#39;</span>, <span class="nb">shape</span>=(<span class="n">input_shape</span>[-<span class="mi">1</span>],), <span class="n">initializer</span>=<span class="s">&#39;zeros&#39;</span>
        )

    <span class="n">def</span> <span class="n">call</span>(<span class="nb">self</span>, <span class="n">inputs</span>, <span class="nb">mode</span>=<span class="s">&#39;positive&#39;</span>):
        <span class="k">if</span> <span class="nb">mode</span> == <span class="s">&#39;positive&#39;</span>:
            <span class="n">scale</span> = <span class="nb">self</span>.<span class="n">tau</span> + (<span class="mi">1</span> - <span class="nb">self</span>.<span class="n">tau</span>) * <span class="n">K</span>.<span class="n">sigmoid</span>(<span class="nb">self</span>.<span class="n">scale</span>)
        <span class="n">else:</span>
            <span class="n">scale</span> = (<span class="mi">1</span> - <span class="nb">self</span>.<span class="n">tau</span>) * <span class="n">K</span>.<span class="n">sigmoid</span>(-<span class="n">self</span>.<span class="n">scale</span>)
        <span class="k">return</span> <span class="n">inputs</span> * <span class="n">K</span>.<span class="nb">sqrt</span>(<span class="n">scale</span>)

    <span class="n">def</span> <span class="n">get_config</span>(<span class="nb">self</span>):
        <span class="nb">config</span> = {<span class="s">&#39;tau&#39;</span>: <span class="nb">self</span>.<span class="n">tau</span>}
        <span class="n">base_config</span> = <span class="n">super</span>(<span class="n">Scaler</span>, <span class="nb">self</span>).<span class="n">get_config</span>()
        <span class="k">return</span> <span class="n">dict</span>(<span class="n">list</span>(<span class="n">base_config</span>.<span class="n">items</span>()) + <span class="n">list</span>(<span class="nb">config</span>.<span class="n">items</span>()))


<span class="n">def</span> <span class="n">sampling</span>(<span class="n">inputs</span>):
    <span class="s">&quot;&quot;&quot;é‡å‚æ•°é‡‡æ ·</span>
<span class="s">    &quot;&quot;&quot;</span>
    <span class="n">z_mean</span>, <span class="n">z_std</span> = <span class="n">inputs</span>
    <span class="n">noise</span> = <span class="n">K</span>.<span class="n">random_normal</span>(<span class="nb">shape</span>=<span class="n">K</span>.<span class="nb">shape</span>(<span class="n">z_mean</span>))
    <span class="k">return</span> <span class="n">z_mean</span> + <span class="n">z_std</span> * <span class="n">noise</span>


<span class="n">e_outputs</span>  <span class="c1"># å‡è®¾e_outputsæ˜¯ç¼–ç å™¨çš„è¾“å‡ºå‘é‡</span>
<span class="n">scaler</span> = <span class="n">Scaler</span>()
<span class="n">z_mean</span> = <span class="n">Dense</span>(<span class="n">hidden_dims</span>)(<span class="n">e_outputs</span>)
<span class="n">z_mean</span> = <span class="n">BatchNormalization</span>(<span class="n">scale</span>=<span class="nb">False</span>, <span class="n">center</span>=<span class="nb">False</span>, <span class="n">epsilon</span>=<span class="mf">1e-8</span>)(<span class="n">z_mean</span>)
<span class="n">z_mean</span> = <span class="n">scaler</span>(<span class="n">z_mean</span>, <span class="nb">mode</span>=<span class="s">&#39;positive&#39;</span>)
<span class="n">z_std</span> = <span class="n">Dense</span>(<span class="n">hidden_dims</span>)(<span class="n">e_outputs</span>)
<span class="n">z_std</span> = <span class="n">BatchNormalization</span>(<span class="n">scale</span>=<span class="nb">False</span>, <span class="n">center</span>=<span class="nb">False</span>, <span class="n">epsilon</span>=<span class="mf">1e-8</span>)(<span class="n">z_std</span>)
<span class="n">z_std</span> = <span class="n">scaler</span>(<span class="n">z_std</span>, <span class="nb">mode</span>=<span class="s">&#39;negative&#39;</span>)
<span class="nb">z</span> = <span class="n">Lambda</span>(<span class="n">sampling</span>, <span class="nb">name</span>=<span class="s">&#39;Sampling&#39;</span>)([<span class="n">z_mean</span>, <span class="n">z_std</span>])
</code></pre></div>

<h2 id="_5">æ–‡ç« å†…å®¹å°ç»“</h2>
<p>æœ¬æ–‡ç®€å•åˆ†æäº†VAEåœ¨NLPä¸­çš„KLæ•£åº¦æ¶ˆå¤±ç°è±¡ï¼Œå¹¶ä»‹ç»äº†é€šè¿‡BNå±‚æ¥é˜²æ­¢KLæ•£åº¦æ¶ˆå¤±ã€ç¨³å®šè®­ç»ƒæµç¨‹çš„æ–¹æ³•ã€‚è¿™æ˜¯ä¸€ç§ç®€æ´æœ‰æ•ˆçš„æ–¹æ¡ˆï¼Œä¸å•å•æ˜¯åŸè®ºæ–‡ï¼Œç¬”è€…ç§ä¸‹ä¹Ÿåšäº†ç®€å•çš„å®éªŒï¼Œç»“æœç¡®å®ä¹Ÿè¡¨æ˜äº†å®ƒçš„æœ‰æ•ˆæ€§ï¼Œå€¼å¾—å„ä½è¯»è€…è¯•ç”¨ã€‚å› ä¸ºå…¶æ¨å¯¼å…·æœ‰ä¸€èˆ¬æ€§ï¼Œæ‰€ä»¥ç”šè‡³ä»»æ„åœºæ™¯ï¼ˆæ¯”å¦‚CVï¼‰ä¸­çš„VAEæ¨¡å‹éƒ½å¯ä»¥å°è¯•ä¸€ä¸‹ã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/7381">https://spaces.ac.cn/archives/7381</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (May. 06, 2020). ã€Š å˜åˆ†è‡ªç¼–ç å™¨ï¼ˆäº”ï¼‰ï¼šVAE + BN = æ›´å¥½çš„VAE ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/7381">https://spaces.ac.cn/archives/7381</a></p>
<p>@online{kexuefm-7381,<br />
title={ å˜åˆ†è‡ªç¼–ç å™¨ï¼ˆäº”ï¼‰ï¼šVAE + BN = æ›´å¥½çš„VAE},<br />
author={è‹å‰‘æ—},<br />
year={2020},<br />
month={May},<br />
url={\url{https://spaces.ac.cn/archives/7381}},<br />
} </p>
<hr />
<h2 id="_6">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<p>TODO: æ·»åŠ è¯¦ç»†çš„æ•°å­¦å…¬å¼æ¨å¯¼å’Œæ³¨é‡Š</p>
        </div>
    </div>
</body>
</html>