<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMOï¼šåŸºäºæœ€ä¼˜ä¼ è¾“æ€æƒ³è®¾è®¡çš„åˆ†ç±»æŸå¤±å‡½æ•°</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>EMOï¼šåŸºäºæœ€ä¼˜ä¼ è¾“æ€æƒ³è®¾è®¡çš„åˆ†ç±»æŸå¤±å‡½æ•°</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2026-01-05 | ğŸ“„ å¤§å°: 50.5 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/9797">https://spaces.ac.cn/archives/9797</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œåˆ†ç±»ä»»åŠ¡çš„æ ‡å‡†æŸå¤±æ˜¯äº¤å‰ç†µï¼ˆCross Entropyï¼Œç­‰ä»·äºæœ€å¤§ä¼¼ç„¶MLEï¼Œå³Maximum Likelihood Estimationï¼‰ï¼Œå®ƒæœ‰ç€ç®€å•é«˜æ•ˆçš„ç‰¹ç‚¹ï¼Œä½†åœ¨æŸäº›åœºæ™¯ä¸‹ä¹Ÿæš´éœ²å‡ºä¸€äº›é—®é¢˜ï¼Œå¦‚åç¦»è¯„ä»·æŒ‡æ ‡ã€è¿‡åº¦è‡ªä¿¡ç­‰ï¼Œç›¸åº”çš„æ”¹è¿›å·¥ä½œä¹Ÿæœ‰å¾ˆå¤šï¼Œæ­¤å‰æˆ‘ä»¬ä¹Ÿä»‹ç»è¿‡ä¸€äº›ï¼Œæ¯”å¦‚<a href="/archives/7708">ã€Šå†è°ˆç±»åˆ«ä¸å¹³è¡¡é—®é¢˜ï¼šè°ƒèŠ‚æƒé‡ä¸é­”æ”¹Lossçš„å¯¹æ¯”è”ç³»ã€‹</a>ã€<a href="/archives/9098">ã€Šå¦‚ä½•è®­ç»ƒä½ çš„å‡†ç¡®ç‡ï¼Ÿã€‹</a>ã€<a href="/archives/9526">ã€Šç¼“è§£äº¤å‰ç†µè¿‡åº¦è‡ªä¿¡çš„ä¸€ä¸ªç®€æ˜æ–¹æ¡ˆã€‹</a>ç­‰ã€‚ç”±äºLLMçš„è®­ç»ƒä¹Ÿå¯ä»¥ç†è§£ä¸ºé€tokençš„åˆ†ç±»ä»»åŠ¡ï¼Œé»˜è®¤æŸå¤±ä¹Ÿæ˜¯äº¤å‰ç†µï¼Œå› æ­¤è¿™äº›æ”¹è¿›å·¥ä½œåœ¨LLMæµè¡Œçš„ä»Šå¤©ä¾ç„¶æœ‰ä¸€å®šçš„ä»·å€¼ã€‚</p>
<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»ä¸€ç¯‡åä¸º<a href="https://papers.cool/arxiv/2310.04691">ã€ŠEMO: Earth Mover Distance Optimization for Auto-Regressive Language Modelingã€‹</a>çš„å·¥ä½œï¼Œå®ƒåŸºäºæœ€ä¼˜ä¼ è¾“æ€æƒ³æå‡ºäº†æ–°çš„æ”¹è¿›æŸå¤±å‡½æ•°EMOï¼Œå£°ç§°èƒ½å¤§å¹…æé«˜LLMçš„å¾®è°ƒæ•ˆæœã€‚å…¶ä¸­ç»†èŠ‚å¦‚ä½•ï¼Ÿè®©æˆ‘ä»¬ä¸€æ¢ç©¶ç«Ÿã€‚</p>
<h2 id="_1">æ¦‚ç‡æ•£åº¦</h2>
<p>å‡è®¾$p_i$æ˜¯æ¨¡å‹é¢„æµ‹çš„ç¬¬$i$ä¸ªç±»åˆ«çš„æ¦‚ç‡ï¼Œ$i=1,2,\cdots,n$ï¼Œ$t$åˆ™æ˜¯ç›®æ ‡ç±»åˆ«ï¼Œé‚£ä¹ˆäº¤å‰ç†µæŸå¤±ä¸º<br />
\begin{equation}\mathcal{L} = - \log p_t\end{equation}<br />
å¦‚æœå°†æ ‡ç­¾$t$ç”¨one hotå½¢å¼çš„åˆ†å¸ƒ$\tau$è¡¨ç¤ºå‡ºæ¥ï¼ˆå³$\tau_t=1,\tau_i=0|i\neq t, i\in[1,n]$ï¼‰ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥é‡å†™æˆ<br />
\begin{equation}\mathcal{L} = - \sum_i \tau_i\log p_i\end{equation}<br />
è¿™ä¸ªå½¢å¼åŒæ—¶é€‚ç”¨äºéone hotçš„æ ‡ç­¾$\tau$ï¼ˆå³è½¯æ ‡ç­¾ï¼‰ï¼Œå®ƒç­‰ä»·äºä¼˜åŒ–$\tau,p$çš„KLæ•£åº¦ï¼š<br />
\begin{equation}KL(\tau\Vert p) = \sum_i \tau_i\log \frac{\tau_i}{p_i} = \color{skyblue}{\sum_i \tau_i\log \tau_i} - \sum_i \tau_i\log p_i\end{equation}<br />
å½“$\tau$ç»™å®šæ—¶ï¼Œæœ€å³ç«¯ç¬¬ä¸€é¡¹å°±æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œæ‰€ä»¥å®ƒè·Ÿäº¤å‰ç†µç›®æ ‡æ˜¯ç­‰ä»·çš„ã€‚</p>
<p>è¿™ä¸ªç»“æœè¡¨æ˜ï¼Œæˆ‘ä»¬åœ¨åšMLEï¼Œæˆ–è€…è¯´ä»¥äº¤å‰ç†µä¸ºæŸå¤±æ—¶ï¼Œå®åˆ™å°±æ˜¯åœ¨æœ€å°åŒ–ç›®æ ‡åˆ†å¸ƒå’Œé¢„æµ‹åˆ†å¸ƒçš„KLæ•£åº¦ã€‚ç”±äºKLæ•£åº¦çš„ä¸€èˆ¬æ¨å¹¿æ˜¯fæ•£åº¦ï¼ˆå‚è€ƒ<a href="/archives/6016#f%E6%95%A3%E5%BA%A6">ã€Šf-GANç®€ä»‹ï¼šGANæ¨¡å‹çš„ç”Ÿäº§è½¦é—´ã€‹</a>ï¼‰ï¼Œæ‰€ä»¥å¾ˆè‡ªç„¶æƒ³åˆ°æ¢ç”¨å…¶ä»–fæ•£åº¦æˆ–è®¸æœ‰æ”¹è‰¯ä½œç”¨ã€‚äº‹å®ä¸Šï¼Œç¡®å®æœ‰ä¸å°‘å·¥ä½œæ˜¯æŒ‰ç…§è¿™ä¸ªæ€è·¯è¿›è¡Œçš„ï¼Œæ¯”å¦‚<a href="/archives/9526">ã€Šç¼“è§£äº¤å‰ç†µè¿‡åº¦è‡ªä¿¡çš„ä¸€ä¸ªç®€æ˜æ–¹æ¡ˆã€‹</a>ä»‹ç»çš„æ–¹æ³•ï¼Œå…¶è®ºæ–‡çš„å‡ºå‘ç‚¹æ˜¯â€œTotal Variationè·ç¦»â€ï¼Œä¹Ÿæ˜¯fæ•£åº¦çš„ä¸€ç§ã€‚</p>
<h2 id="_2">æœ€ä¼˜ä¼ è¾“</h2>
<p>ä¸è¿‡ï¼Œæ¯ç§fæ•£åº¦æˆ–å¤šæˆ–å°‘æœ‰äº›é—®é¢˜ï¼Œè¦è¯´æ¦‚ç‡åˆ†å¸ƒä¹‹é—´çš„ç†æƒ³åº¦é‡ï¼Œå½“å±åŸºäºæœ€ä¼˜ä¼ è¾“æ€æƒ³çš„â€œæ¨åœŸæœºè·ç¦»ï¼ˆEarth Mover's Distanceï¼ŒEMDï¼‰â€ï¼Œä¸äº†è§£çš„è¯»è€…å¯ä»¥å‚è€ƒä¸€ä¸‹ç¬”è€…ä¹‹å‰å†™çš„<a href="/archives/6280">ã€Šä»Wassersteinè·ç¦»ã€å¯¹å¶ç†è®ºåˆ°WGANã€‹</a>ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œæ¨åœŸæœºè·ç¦»å®šä¹‰ä¸ºä¸¤ä¸ªåˆ†å¸ƒä¹‹é—´çš„æœ€ä¼˜ä¼ è¾“æˆæœ¬ï¼š<br />
\begin{equation}\mathcal{C}[p,\tau]=\inf_{\gamma\in \Pi[p,\tau]} \sum_{i,j} \gamma_{i,j} c_{i,j} \end{equation}<br />
è¿™é‡Œçš„$\gamma\in \Pi[p,\tau]$è¯´çš„æ˜¯$\gamma$æ˜¯ä»»æ„ä»¥$p,\tau$ä¸ºè¾¹ç¼˜åˆ†å¸ƒçš„è”åˆåˆ†å¸ƒï¼Œ$c_{i,j}$æ˜¯å®ç°ç»™å®šçš„æˆæœ¬å‡½æ•°ï¼Œä»£è¡¨â€œä»$i$æ¬è¿åˆ°$j$çš„æˆæœ¬â€ï¼Œ$\inf$æ˜¯ä¸‹ç¡®ç•Œï¼Œæ„æ€å°±æ˜¯è¯´å°†æœ€ä½çš„è¿è¾“æˆæœ¬ä½œä¸º$p,\tau$ä¹‹é—´çš„å·®å¼‚åº¦é‡ã€‚æ­£å¦‚åŸºäºfæ•£åº¦çš„Vanilla GANæ¢æˆåŸºäºæœ€ä¼˜ä¼ è¾“çš„Wasserstein GANèƒ½å¤Ÿæ›´å¥½çš„æ”¶æ•›æ€§è´¨ï¼Œæˆ‘ä»¬æœŸæœ›å¦‚æœå°†åˆ†ç±»çš„æŸå¤±å‡½æ•°æ¢æˆä¸¤ä¸ªåˆ†å¸ƒçš„Wè·ç¦»ï¼Œä¹Ÿèƒ½æ”¶æ•›åˆ°æ›´å¥½çš„ç»“æœã€‚</p>
<p>å½“$\tau$æ˜¯one hotåˆ†å¸ƒæ—¶ï¼Œç›®æ ‡åˆ†å¸ƒå°±æ˜¯ä¸€ä¸ªç‚¹$t$ï¼Œé‚£ä¹ˆå°±æ— æ‰€è°“æœ€ä¸æœ€ä¼˜äº†ï¼Œä¼ è¾“æ–¹æ¡ˆå°±åªæœ‰ä¸€ä¸ªï¼Œå³æŠŠ$p$çš„æ‰€æœ‰ä¸œè¥¿éƒ½æ¬åˆ°åŒä¸€ä¸ªç‚¹$t$ï¼Œæ‰€ä»¥æ­¤æ—¶å°±æœ‰<br />
\begin{equation}\mathcal{C}[p,\tau]= \sum_i p_i c_{i,t} \label{eq:emo}\end{equation}</p>
<p>å¦‚æœ$\tau$æ˜¯ä¸€èˆ¬çš„è½¯æ ‡ç­¾åˆ†å¸ƒï¼Œé‚£ä¹ˆ$\mathcal{C}[p,\tau]$çš„è®¡ç®—æ˜¯ä¸€ä¸ªçº¿æ€§è§„åˆ’é—®é¢˜ï¼Œæ±‚è§£èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œç”±äº$p_i \tau_j$æ‰€å®šä¹‰çš„åˆ†å¸ƒä¹Ÿå±äº$\Pi[p,\tau]$ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ‰<br />
\begin{equation}\mathcal{C}[p,\tau]=\inf_{\gamma\in \Pi[p,\tau]} \sum_{i,j} \gamma_{i,j} c_{i,j} \leq \sum_{i,j} p_i \tau_j c_{i,j} \end{equation}<br />
è¿™æ˜¯ä¸€ä¸ªå®¹æ˜“è®¡ç®—çš„ä¸Šç•Œï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¼˜åŒ–ç›®æ ‡ï¼Œå¼$\eqref{eq:emo}$åˆ™å¯¹åº”$\tau_j = \delta_{j,t}$ï¼Œå…¶ä¸­$\delta$æ˜¯â€œ<a href="https://en.wikipedia.org/wiki/Kronecker_delta">å…‹ç½—å†…å…‹Î´å‡½æ•°</a>â€ã€‚</p>
<h2 id="_3">æˆæœ¬å‡½æ•°</h2>
<p>ç°åœ¨å›åˆ°åŸè®ºæ–‡æ‰€å…³å¿ƒçš„åœºæ™¯â€”â€”LLMçš„å¾®è°ƒï¼ŒåŒ…æ‹¬äºŒæ¬¡é¢„è®­ç»ƒå’Œå¾®è°ƒåˆ°ä¸‹æ¸¸ä»»åŠ¡ç­‰ã€‚æ­£å¦‚æœ¬æ–‡å¼€å¤´æ‰€è¿°ï¼ŒLLMçš„è®­ç»ƒå¯ä»¥ç†è§£ä¸ºé€tokençš„åˆ†ç±»ä»»åŠ¡ï¼ˆç±»åˆ«å³æ‰€æœ‰tokenï¼‰ï¼Œæ¯ä¸ªæ ‡ç­¾æ˜¯one hotçš„ï¼Œæ‰€ä»¥é€‚ç”¨äºå¼$\eqref{eq:emo}$ã€‚</p>
<p>å¼$\eqref{eq:emo}$è¿˜å·®æˆæœ¬å‡½æ•°$c_{i,t}$è¿˜æ²¡å®šä¸‹æ¥ã€‚å¦‚æœç®€å•åœ°è®¤ä¸ºåªè¦$i\neq t$ï¼Œé‚£ä¹ˆæˆæœ¬éƒ½æ˜¯1ï¼Œå³$c_{i,t}=1 - \delta_{i,t}$ï¼Œé‚£ä¹ˆ<br />
\begin{equation}\mathcal{C}[p,\tau]= \sum_i p_i c_{i,t} = \sum_i (p_i - p_i \delta_{i, t}) = 1 - p_t\end{equation}<br />
è¿™å…¶å®å°±æ˜¯åœ¨æœ€å¤§åŒ–å‡†ç¡®ç‡çš„å…‰æ»‘è¿‘ä¼¼ï¼ˆå‚è€ƒ<a href="/archives/6620#%E6%AD%A3%E7%A1%AE%E7%8E%87">ã€Šå‡½æ•°å…‰æ»‘åŒ–æ‚è°ˆï¼šä¸å¯å¯¼å‡½æ•°çš„å¯å¯¼é€¼è¿‘ã€‹</a>ï¼‰ã€‚ä½†ç›´è§‰ä¸Šï¼Œæ‰€æœ‰$i\neq t$éƒ½ç»™äºˆåŒæ ·ç¨‹åº¦çš„æƒ©ç½šä¼¼ä¹è¿‡äºç®€å•äº†ï¼Œç†æƒ³æƒ…å†µä¸‹åº”è¯¥æ ¹æ®ç›¸ä¼¼åº¦æ¥ç»™æ¯ä¸ªä¸åŒçš„$i$è®¾è®¡ä¸åŒçš„æˆæœ¬ï¼Œå³ç›¸ä¼¼åº¦è¶Šå¤§ï¼Œä¼ è¾“æˆæœ¬è¶Šä½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†ä¼ è¾“æˆæœ¬è®¾è®¡ä¸º<br />
\begin{equation}c_{i,t} = 1 - \cos(\boldsymbol{e}_i,\boldsymbol{e}_t) = 1 - \left\langle\frac{\boldsymbol{e}_i}{\Vert\boldsymbol{e}_i\Vert}, \frac{\boldsymbol{e}_t}{\Vert\boldsymbol{e}_t\Vert}\right\rangle\end{equation}<br />
è¿™é‡Œçš„$\boldsymbol{e}_i,\boldsymbol{e}_t$æ˜¯äº‹å…ˆè·å–åˆ°Token Embeddingï¼ŒåŸè®ºæ–‡æ˜¯å°†é¢„è®­ç»ƒæ¨¡å‹çš„LM Headä½œä¸ºToken Embeddingçš„ï¼Œå¹¶ä¸”æ ¹æ®æœ€ä¼˜ä¼ è¾“çš„å®šä¹‰æˆæœ¬å‡½æ•°æ˜¯è¦å®ç°ç»™å®šçš„ï¼Œå› æ­¤è®¡ç®—ç›¸ä¼¼åº¦çš„Token Embeddingè¦åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å›ºå®šä¸å˜ã€‚</p>
<p>æœ‰äº†æˆæœ¬å‡½æ•°åï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¡ç®—<br />
\begin{equation}\mathcal{C}[p,\tau]= \sum_i p_i c_{i,t} = \sum_i \left(p_i - p_i \left\langle\frac{\boldsymbol{e}_i}{\Vert\boldsymbol{e}_i\Vert}, \frac{\boldsymbol{e}_t}{\Vert\boldsymbol{e}_t\Vert}\right\rangle\right) = 1 - \left\langle \sum_i p_i \frac{\boldsymbol{e}_i}{\Vert\boldsymbol{e}_i\Vert}, \frac{\boldsymbol{e}_t}{\Vert\boldsymbol{e}_t\Vert}\right\rangle\end{equation}<br />
è¿™å°±æ˜¯EMOï¼ˆ<strong>E</strong> arth <strong>M</strong> over Distance <strong>O</strong> ptimizationï¼‰æœ€ç»ˆçš„è®­ç»ƒæŸå¤±ã€‚ç”±äºembedding_sizeé€šå¸¸è¿œå°äºvocab_sizeï¼Œæ‰€ä»¥å…ˆç®—$\sum\limits_i p_i \frac{\boldsymbol{e}_i}{\Vert\boldsymbol{e}_i\Vert}$èƒ½æ˜æ˜¾é™ä½è®¡ç®—é‡ã€‚</p>
<h2 id="_4">å®éªŒæ•ˆæœ</h2>
<p>ç”±äºç¬”è€…å¯¹LLMçš„ç ”ç©¶è¿˜å¤„äºé¢„è®­ç»ƒé˜¶æ®µï¼Œè¿˜æœªæ¶‰åŠåˆ°å¾®è°ƒï¼Œæ‰€ä»¥æš‚æ—¶æ²¡æœ‰è‡ªå·±çš„å®éªŒç»“æœï¼Œåªèƒ½å…ˆè·Ÿå¤§å®¶ä¸€èµ·çœ‹çœ‹åŸè®ºæ–‡çš„å®éªŒã€‚ä¸å¾—ä¸è¯´ï¼ŒåŸè®ºæ–‡çš„å®éªŒç»“æœè¿˜æ˜¯æ¯”è¾ƒæƒŠè‰³çš„ã€‚</p>
<p>é¦–å…ˆï¼Œæ˜¯å°æ¨¡å‹ä¸Šçš„ç»§ç»­é¢„è®­ç»ƒå®éªŒï¼Œç›¸æ¯”äº¤å‰ç†µï¼ˆMLEï¼‰çš„æå‡æœ€å¤šçš„æœ‰10ä¸ªç‚¹ï¼Œå¹¶ä¸”æ˜¯å…¨é¢SOTAï¼š  </p>
<p><a href="/usr/uploads/2023/10/765995927.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="å°æ¨¡å‹ä¸Šçš„ç»§ç»­é¢„è®­ç»ƒå¯¹æ¯”å®éªŒ" src="/usr/uploads/2023/10/765995927.png" /></a></p>
<p>å°æ¨¡å‹ä¸Šçš„ç»§ç»­é¢„è®­ç»ƒå¯¹æ¯”å®éªŒ</p>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¿™é‡Œçš„è¯„ä»·æŒ‡æ ‡æ˜¯MAUVEï¼Œè¶Šå¤§è¶Šå¥½ï¼Œå®ƒæå‡ºè‡ª<a href="https://papers.cool/arxiv/2102.01454">ã€ŠMAUVE: Measuring the Gap Between Neural Text and Human Text using Divergence Frontiersã€‹</a>ï¼Œæ˜¯è·Ÿäººå·¥è¯„ä»·æœ€ç›¸å…³çš„è‡ªåŠ¨è¯„æµ‹æŒ‡æ ‡ä¹‹ä¸€ã€‚æ­¤å¤–ï¼Œå¯¹æ¯”æ–¹æ³•çš„TaiLræˆ‘ä»¬æ›¾åœ¨<a href="/archives/9526">ã€Šç¼“è§£äº¤å‰ç†µè¿‡åº¦è‡ªä¿¡çš„ä¸€ä¸ªç®€æ˜æ–¹æ¡ˆã€‹</a>ç®€å•ä»‹ç»è¿‡ã€‚</p>
<p>å¯èƒ½æœ‰è¯»è€…æƒ³EMOæ›´å¥½æ˜¯ä¸æ˜¯å•çº¯å› ä¸ºè¯„ä»·æŒ‡æ ‡é€‰å¾—å¥½ï¼Ÿå¹¶ä¸æ˜¯ï¼Œè®©äººæ„å¤–çš„æ˜¯ï¼ŒEMOè®­ç»ƒçš„æ¨¡å‹ï¼Œç”šè‡³PPLéƒ½æ›´å¥½ï¼ˆPPLè·ŸMLEæ›´ç›¸å…³ï¼‰ï¼š  </p>
<p><a href="/usr/uploads/2023/10/254031621.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="ä¸åŒè¯„ä»·æŒ‡æ ‡çš„å¯¹æ¯”" src="/usr/uploads/2023/10/254031621.png" /></a></p>
<p>ä¸åŒè¯„ä»·æŒ‡æ ‡çš„å¯¹æ¯”</p>
<p>ç„¶åæ˜¯å°†LLAMA-7B/13Bå¾®è°ƒåˆ°ä¸‹æ¸¸ä»»åŠ¡åšFew Shotçš„æ•ˆæœï¼ŒåŒæ ·å¾ˆå‡ºè‰²ï¼š  </p>
<p><a href="/usr/uploads/2023/10/760182866.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="LLAMA-7B:13Bå¾®è°ƒåˆ°ä¸‹æ¸¸ä»»åŠ¡çš„æ•ˆæœ" src="/usr/uploads/2023/10/760182866.png" /></a></p>
<p>LLAMA-7B:13Bå¾®è°ƒåˆ°ä¸‹æ¸¸ä»»åŠ¡çš„æ•ˆæœ</p>
<p>æœ€åå¯¹æ¯”äº†ä¸åŒæ¨¡å‹è§„æ¨¡å’Œæ•°æ®è§„æ¨¡çš„æ•ˆæœï¼Œæ˜¾ç¤ºå‡ºEMOåœ¨ä¸åŒæ¨¡å‹å’Œæ•°æ®è§„æ¨¡ä¸Šéƒ½æœ‰ä¸é”™çš„è¡¨ç°ï¼š  </p>
<p><a href="/usr/uploads/2023/10/1659559401.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="ä¸åŒæ¨¡å‹è§„æ¨¡/æ•°æ®è§„æ¨¡ä¸Šçš„æ•ˆæœ" src="/usr/uploads/2023/10/1659559401.png" /></a></p>
<p>ä¸åŒæ¨¡å‹è§„æ¨¡/æ•°æ®è§„æ¨¡ä¸Šçš„æ•ˆæœ</p>
<h2 id="_5">ä¸ªäººæ€è€ƒ</h2>
<p>æ€»çš„æ¥è¯´ï¼ŒåŸè®ºæ–‡çš„â€œæˆç»©å•â€è¿˜æ˜¯éå¸¸æ¼‚äº®çš„ï¼Œå€¼å¾—ä¸€è¯•ã€‚å”¯ä¸€çš„ç–‘è™‘å¯èƒ½æ˜¯åŸè®ºæ–‡çš„å®éªŒæ•°æ®é‡å…¶å®éƒ½ä¸ç®—å¤§ï¼Œä¸æ¸…æ¥šè¿›ä¸€æ­¥å¢å¤§æ•°æ®é‡åæ˜¯å¦ä¼šç¼©å°EMOå’ŒMLEçš„å·®è·ã€‚</p>
<p>å°±ç¬”è€…çœ‹æ¥ï¼ŒEMOä¹‹æ‰€ä»¥èƒ½å–å¾—æ›´å¥½çš„ç»“æœï¼Œæ˜¯å› ä¸ºå®ƒé€šè¿‡Embeddingç®—ç›¸ä¼¼åº¦ï¼Œæ¥ä¸ºâ€œè¿‘ä¹‰è¯â€åˆ†é…äº†æ›´åˆç†çš„æŸå¤±ï¼Œä»è€Œä½¿å¾—æ¨¡å‹çš„å­¦ä¹ æ›´åŠ åˆç†ã€‚å› ä¸ºè™½ç„¶å½¢å¼ä¸ŠLLMä¹Ÿæ˜¯åˆ†ç±»ä»»åŠ¡ï¼Œä½†å®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªç®€å•çš„å¯¹ä¸é”™é—®é¢˜ï¼Œå¹¶ä¸æ˜¯è¯´ä¸‹ä¸€ä¸ªé¢„æµ‹çš„tokenè·Ÿæ ‡ç­¾tokenä¸ä¸€è‡´ï¼Œå¥å­å°±ä¸åˆç†äº†ï¼Œå› æ­¤å¼•å…¥è¯­ä¹‰ä¸Šçš„ç›¸ä¼¼åº¦æ¥è®¾è®¡æŸå¤±å¯¹LLMçš„è®­ç»ƒæ˜¯æœ‰å¸®åŠ©çš„ã€‚å¯ä»¥è¿›ä¸€æ­¥çŒœæµ‹çš„æ˜¯ï¼Œvocab_sizeè¶Šå¤§ã€tokené¢—ç²’åº¦è¶Šå¤§çš„æƒ…å†µä¸‹ï¼ŒEMOçš„æ•ˆæœåº”è¯¥è¶Šå¥½ï¼Œå› ä¸ºvocab_sizeå¤§äº†â€œè¿‘ä¹‰è¯â€å°±å¯èƒ½è¶Šå¤šã€‚</p>
<p>å½“ç„¶ï¼Œå¼•å…¥è¯­ä¹‰ç›¸ä¼¼åº¦ä¹Ÿå¯¼è‡´äº†EMOä¸é€‚ç”¨äºä»é›¶è®­ç»ƒï¼Œå› ä¸ºå®ƒéœ€è¦ä¸€ä¸ªè®­ç»ƒå¥½çš„LM Headä½œä¸ºToken Embeddingã€‚å½“ç„¶ï¼Œä¸€ä¸ªå¯èƒ½çš„è§£å†³æ–¹æ¡ˆæ˜¯è€ƒè™‘ç”¨å…¶ä»–æ–¹å¼ï¼Œæ¯”å¦‚ç»å…¸çš„Word2Vecæ¥äº‹å…ˆè®­ç»ƒå¥½Token Embeddingï¼Œä½†è¿™å¯èƒ½ä¼šæœ‰ä¸€ä¸ªé£é™©ï¼Œå³ç»å…¸æ–¹å¼è®­ç»ƒçš„Token Embeddingæ˜¯å¦ä¼šé™ä½LLMèƒ½åŠ›çš„å¤©èŠ±æ¿ï¼ˆæ¯•ç«Ÿå­˜åœ¨ä¸ä¸€è‡´æ€§ï¼‰ã€‚</p>
<p>æ­¤å¤–ï¼Œå³ä¾¿Token Embeddingæ²¡é—®é¢˜ï¼Œä»é›¶é¢„è®­ç»ƒæ—¶å•çº¯ç”¨EMOå¯èƒ½è¿˜å­˜åœ¨æ”¶æ•›è¿‡æ…¢çš„é—®é¢˜ï¼Œè¿™æ˜¯å› ä¸ºæ ¹æ®ç¬”è€…åœ¨<a href="/archives/9098">ã€Šå¦‚ä½•è®­ç»ƒä½ çš„å‡†ç¡®ç‡ï¼Ÿã€‹</a>çš„æœ«å°¾æå‡ºçš„æŸå¤±å‡½æ•°è§†è§’ï¼š</p>
<blockquote>
<p>é¦–å…ˆå¯»æ‰¾è¯„æµ‹æŒ‡æ ‡çš„ä¸€ä¸ªå…‰æ»‘è¿‘ä¼¼ï¼Œæœ€å¥½èƒ½è¡¨è¾¾æˆæ¯ä¸ªæ ·æœ¬çš„æœŸæœ›å½¢å¼ï¼Œç„¶åå°†é”™è¯¯æ–¹å‘çš„è¯¯å·®é€æ¸æ‹‰åˆ°æ— ç©·å¤§ï¼ˆä¿è¯æ¨¡å‹èƒ½æ›´å…³æ³¨é”™è¯¯æ ·æœ¬ï¼‰ï¼Œä½†åŒæ—¶åœ¨æ­£ç¡®æ–¹å‘ä¿è¯ä¸åŸå§‹å½¢å¼æ˜¯ä¸€é˜¶è¿‘ä¼¼ã€‚</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ºäº†ä¿è¯ï¼ˆä»é›¶è®­ç»ƒçš„ï¼‰æ”¶æ•›é€Ÿåº¦ï¼Œé”™è¯¯æ–¹å‘çš„æŸå¤±æœ€å¥½èƒ½æ‹‰åˆ°æ— ç©·å¤§ï¼Œè€ŒEMOæ˜¾ç„¶ä¸æ»¡è¶³è¿™ä¸€ç‚¹ï¼Œå› æ­¤å°†EMOç”¨äºä»é›¶è®­ç»ƒçš„æ—¶å€™ï¼Œå¤§æ¦‚ç‡æ˜¯EMOä¸MLEçš„æŸä¸ªåŠ æƒç»„åˆï¼Œæ‰èƒ½å¹³è¡¡æ”¶æ•›é€Ÿåº¦å’Œæœ€ç»ˆæ•ˆæœã€‚</p>
<h2 id="_6">æ–‡ç« å°ç»“</h2>
<p>æœ¬æ–‡ä»‹ç»äº†äº¤å‰ç†µæŸå¤±çš„ä¸€ä¸ªæ–°çš„â€œæ›¿ä»£å“â€â€”â€”åŸºäºæœ€ä¼˜ä¼ è¾“æ€æƒ³çš„EMOï¼Œä¸ä»¥å¾€çš„å°æå‡ä¸åŒï¼ŒEMOåœ¨LLMçš„å¾®è°ƒå®éªŒä¸­å–å¾—äº†è¾ƒä¸ºæ˜æ˜¾çš„æå‡ã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/9797">https://spaces.ac.cn/archives/9797</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Oct. 13, 2023). ã€ŠEMOï¼šåŸºäºæœ€ä¼˜ä¼ è¾“æ€æƒ³è®¾è®¡çš„åˆ†ç±»æŸå¤±å‡½æ•° ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/9797">https://spaces.ac.cn/archives/9797</a></p>
<p>@online{kexuefm-9797,<br />
title={EMOï¼šåŸºäºæœ€ä¼˜ä¼ è¾“æ€æƒ³è®¾è®¡çš„åˆ†ç±»æŸå¤±å‡½æ•°},<br />
author={è‹å‰‘æ—},<br />
year={2023},<br />
month={Oct},<br />
url={\url{https://spaces.ac.cn/archives/9797}},<br />
} </p>
<hr />
<h2 id="_7">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<h3 id="1">1. æœ€ä¼˜ä¼ è¾“ç†è®ºåŸºç¡€</h3>
<p><strong>Mongeé—®é¢˜ï¼ˆ1781ï¼‰</strong>ï¼šæœ€ä¼˜ä¼ è¾“ç†è®ºèµ·æºäºMongeçš„"åœŸæ–¹æ¬è¿"é—®é¢˜ã€‚ç»™å®šä¸¤ä¸ªæ¦‚ç‡æµ‹åº¦$\mu$å’Œ$\nu$ï¼Œå¯»æ‰¾æœ€ä¼˜çš„è¿è¾“æ–¹æ¡ˆ$T: \mathcal{X} \to \mathcal{Y}$ä½¿å¾—è¿è¾“æˆæœ¬æœ€å°ï¼š</p>
<p>\begin{equation}
\inf_{T: T_{#}\mu = \nu} \int_{\mathcal{X}} c(x, T(x)) d\mu(x) \tag{1}
\end{equation}</p>
<p>å…¶ä¸­$c(x,y)$æ˜¯ä»$x$åˆ°$y$çš„è¿è¾“æˆæœ¬ï¼Œ$T_{#}\mu$è¡¨ç¤ºæµ‹åº¦$\mu$åœ¨$T$ä¸‹çš„æ¨å‰ï¼ˆpushforwardï¼‰ã€‚</p>
<p><strong>Kantorovichæ¾å¼›ï¼ˆ1942ï¼‰</strong>ï¼šKantorovichå°†Mongeé—®é¢˜æ¾å¼›ä¸ºå¯»æ‰¾è”åˆåˆ†å¸ƒ$\gamma \in \Pi(\mu, \nu)$ï¼š</p>
<p>\begin{equation}
\mathcal{C}[\mu, \nu] = \inf_{\gamma \in \Pi(\mu, \nu)} \int_{\mathcal{X} \times \mathcal{Y}} c(x, y) d\gamma(x, y) \tag{2}
\end{equation}</p>
<p>å…¶ä¸­$\Pi(\mu, \nu)$æ˜¯æ‰€æœ‰è¾¹ç¼˜åˆ†å¸ƒä¸º$\mu$å’Œ$\nu$çš„è”åˆåˆ†å¸ƒé›†åˆï¼š</p>
<p>\begin{equation}
\Pi(\mu, \nu) = \left{\gamma \in \mathcal{P}(\mathcal{X} \times \mathcal{Y}): \int_{\mathcal{Y}} d\gamma = \mu, \int_{\mathcal{X}} d\gamma = \nu\right} \tag{3}
\end{equation}</p>
<p><strong>ç¦»æ•£åŒ–</strong>ï¼šå¯¹äºç¦»æ•£åˆ†å¸ƒ$p = (p_1, \ldots, p_n)$å’Œ$\tau = (\tau_1, \ldots, \tau_n)$ï¼Œæœ€ä¼˜ä¼ è¾“é—®é¢˜å˜ä¸ºçº¿æ€§è§„åˆ’ï¼š</p>
<p>\begin{equation}
\mathcal{C}[p, \tau] = \min_{\Gamma \in \mathbb{R}^{n \times n}} \sum_{i,j=1}^{n} \Gamma_{ij} C_{ij} \tag{4}
\end{equation}</p>
<p>çº¦æŸæ¡ä»¶ï¼š</p>
<p>\begin{equation}
\begin{cases}
\sum_{j=1}^{n} \Gamma_{ij} = p_i, &amp; \forall i \
\sum_{i=1}^{n} \Gamma_{ij} = \tau_j, &amp; \forall j \
\Gamma_{ij} \geq 0, &amp; \forall i,j
\end{cases} \tag{5}
\end{equation}</p>
<p>å…¶ä¸­$C_{ij} = c(i,j)$æ˜¯æˆæœ¬çŸ©é˜µã€‚</p>
<h3 id="2-wasserstein">2. Wassersteinè·ç¦»è¯¦è§£</h3>
<p><strong>$p$-Wassersteinè·ç¦»</strong>ï¼šå¯¹äº$p \geq 1$ï¼Œ$p$-Wassersteinè·ç¦»å®šä¹‰ä¸ºï¼š</p>
<p>\begin{equation}
W_p(\mu, \nu) = \left(\inf_{\gamma \in \Pi(\mu, \nu)} \int_{\mathcal{X} \times \mathcal{Y}} d(x,y)^p d\gamma(x,y)\right)^{1/p} \tag{6}
\end{equation}</p>
<p>å…¶ä¸­$d(x,y)$æ˜¯åŸºç¡€åº¦é‡ç©ºé—´ä¸Šçš„è·ç¦»ã€‚</p>
<p><strong>å¸¸ç”¨æƒ…å½¢</strong>ï¼š</p>
<ol>
<li><strong>1-Wassersteinè·ç¦»</strong>ï¼ˆEarth Mover's Distanceï¼‰ï¼š</li>
</ol>
<p>\begin{equation}
   W_1(\mu, \nu) = \inf_{\gamma \in \Pi(\mu, \nu)} \int_{\mathcal{X} \times \mathcal{Y}} d(x,y) d\gamma(x,y) \tag{7}
   \end{equation}</p>
<ol>
<li><strong>2-Wassersteinè·ç¦»</strong>ï¼š</li>
</ol>
<p>\begin{equation}
   W_2(\mu, \nu) = \sqrt{\inf_{\gamma \in \Pi(\mu, \nu)} \int_{\mathcal{X} \times \mathcal{Y}} d(x,y)^2 d\gamma(x,y)} \tag{8}
   \end{equation}</p>
<p><strong>Kantorovich-Rubinsteinå¯¹å¶</strong>ï¼š</p>
<p>\begin{equation}
W_1(\mu, \nu) = \sup_{f: |f|_L \leq 1} \left{\int f d\mu - \int f d\nu\right} \tag{9}
\end{equation}</p>
<p>å…¶ä¸­$|f|_L$æ˜¯Lipschitzå¸¸æ•°ã€‚è¿™æ˜¯WGANçš„ç†è®ºåŸºç¡€ã€‚</p>
<p><strong>ç¦»æ•£1-Wassersteinè·ç¦»</strong>ï¼š</p>
<p>\begin{equation}
W_1(p, \tau) = \min_{\Gamma \geq 0} \sum_{i,j} \Gamma_{ij} d_{ij}, \quad \text{s.t. } \Gamma \mathbf{1} = p, \Gamma^T \mathbf{1} = \tau \tag{10}
\end{equation}</p>
<h3 id="3-emo">3. EMOæŸå¤±å‡½æ•°çš„æ¨å¯¼</h3>
<p><strong>ä»åˆ†ç±»åˆ°æœ€ä¼˜ä¼ è¾“</strong>ï¼š</p>
<p>æ ‡å‡†äº¤å‰ç†µæŸå¤±ï¼š</p>
<p>\begin{equation}
\mathcal{L}_{\text{CE}} = -\log p_t = -\log \frac{e^{z_t}}{\sum_i e^{z_i}} \tag{11}
\end{equation}</p>
<p>KLæ•£åº¦å½¢å¼ï¼š</p>
<p>\begin{equation}
\mathcal{L}_{\text{CE}} = \text{KL}(\tau | p) = \sum_i \tau_i \log \frac{\tau_i}{p_i} = -\sum_i \tau_i \log p_i + \text{const} \tag{12}
\end{equation}</p>
<p><strong>é—®é¢˜</strong>ï¼šKLæ•£åº¦ä¸è€ƒè™‘ç±»åˆ«ä¹‹é—´çš„è¯­ä¹‰è·ç¦»ï¼Œæ‰€æœ‰é”™è¯¯ç±»åˆ«çš„æƒ©ç½šç›¸åŒã€‚</p>
<p><strong>EMOçš„åŠ¨æœº</strong>ï¼šä½¿ç”¨æœ€ä¼˜ä¼ è¾“è·ç¦»$W_1(p, \tau)$æ›¿ä»£KLæ•£åº¦ï¼Œè€ƒè™‘ç±»åˆ«é—´çš„è¯­ä¹‰ç›¸ä¼¼æ€§ã€‚</p>
<p><strong>One-hotç›®æ ‡çš„ç®€åŒ–</strong>ï¼š</p>
<p>å½“$\tau = e_t$ï¼ˆone-hotï¼‰æ—¶ï¼Œæœ€ä¼˜ä¼ è¾“æ–¹æ¡ˆå”¯ä¸€ï¼šå°†$p$çš„æ‰€æœ‰è´¨é‡éƒ½è¿é€åˆ°$t$ï¼Œæˆæœ¬ä¸ºï¼š</p>
<p>\begin{equation}
\mathcal{C}[p, \tau] = \sum_{i=1}^{n} p_i c_{i,t} \tag{13}
\end{equation}</p>
<p>å…¶ä¸­$c_{i,t}$æ˜¯ä»ç±»åˆ«$i$åˆ°ç›®æ ‡ç±»åˆ«$t$çš„è¿è¾“æˆæœ¬ã€‚</p>
<p><strong>æˆæœ¬å‡½æ•°è®¾è®¡</strong>ï¼š</p>
<p>åŸºäºembeddingä½™å¼¦è·ç¦»ï¼š</p>
<p>\begin{equation}
c_{i,j} = 1 - \cos(\boldsymbol{e}_i, \boldsymbol{e}_j) = 1 - \frac{\langle \boldsymbol{e}_i, \boldsymbol{e}_j \rangle}{|\boldsymbol{e}_i| |\boldsymbol{e}_j|} \tag{14}
\end{equation}</p>
<p>å…¶ä¸­${\boldsymbol{e}<em i="1">i}</em>^n$æ˜¯é¢„è®­ç»ƒçš„token embeddingsï¼ˆå›ºå®šä¸å˜ï¼‰ã€‚</p>
<p><strong>EMOæŸå¤±</strong>ï¼š</p>
<p>\begin{equation}
\mathcal{L}<em i="1">{\text{EMO}} = \sum</em>
\end{equation}}^{n} p_i c_{i,t} = \sum_{i=1}^{n} p_i (1 - \cos(\boldsymbol{e}_i, \boldsymbol{e}_t)) \tag{15</p>
<p>å±•å¼€ï¼š</p>
<p>\begin{equation}
\mathcal{L}<em i="1">{\text{EMO}} = 1 - \sum</em>}^{n} p_i \cos(\boldsymbol{e<em i="1">i, \boldsymbol{e}_t) = 1 - \left\langle \sum</em>
\end{equation}}^{n} p_i \frac{\boldsymbol{e}_i}{|\boldsymbol{e}_i|}, \frac{\boldsymbol{e}_t}{|\boldsymbol{e}_t|} \right\rangle \tag{16</p>
<p>å®šä¹‰åŠ æƒå¹³å‡embeddingï¼š</p>
<p>\begin{equation}
\bar{\boldsymbol{e}}<em i="1">p = \sum</em>
\end{equation}}^{n} p_i \frac{\boldsymbol{e}_i}{|\boldsymbol{e}_i|} \tag{17</p>
<p>åˆ™ï¼š</p>
<p>\begin{equation}
\mathcal{L}_{\text{EMO}} = 1 - \cos(\bar{\boldsymbol{e}}_p, \boldsymbol{e}_t) \tag{18}
\end{equation}</p>
<p><strong>å‡ ä½•è§£é‡Š</strong>ï¼šEMOæŸå¤±è¡¡é‡é¢„æµ‹åˆ†å¸ƒçš„åŠ æƒå¹³å‡embeddingä¸ç›®æ ‡embeddingçš„ä½™å¼¦è·ç¦»ã€‚</p>
<h3 id="4">4. æ¢¯åº¦è®¡ç®—</h3>
<p><strong>æŸå¤±å…³äºlogitsçš„æ¢¯åº¦</strong>ï¼š</p>
<p>\begin{equation}
\frac{\partial \mathcal{L}<em i_t="i,t">{\text{EMO}}}{\partial z_j} = \frac{\partial}{\partial z_j} \left(\sum_i p_i c</em>
\end{equation}}\right) \tag{19</p>
<p>åˆ©ç”¨$p_j = \frac{e^{z_j}}{\sum_k e^{z_k}}$ï¼Œæœ‰ï¼š</p>
<p>\begin{equation}
\frac{\partial p_j}{\partial z_k} = p_j (\delta_{jk} - p_k) \tag{20}
\end{equation}</p>
<p>å…¶ä¸­$\delta_{jk}$æ˜¯Kronecker deltaã€‚</p>
<p>ä»£å…¥å¾—ï¼š</p>
<p>\begin{equation}
\begin{aligned}
\frac{\partial \mathcal{L}<em i_t="i,t">{\text{EMO}}}{\partial z_j} &amp;= \sum_i \frac{\partial p_i}{\partial z_j} c</em> \
&amp;= \sum_i p_i (\delta_{ij} - p_j) c_{i,t} \
&amp;= p_j (c_{j,t} - \sum_i p_i c_{i,t}) \
&amp;= p_j (c_{j,t} - \mathcal{L}_{\text{EMO}})
\end{aligned} \tag{21}
\end{equation}</p>
<p><strong>ä¸äº¤å‰ç†µæ¢¯åº¦çš„å¯¹æ¯”</strong>ï¼š</p>
<p>äº¤å‰ç†µï¼š</p>
<p>\begin{equation}
\frac{\partial \mathcal{L}<em jt="jt">{\text{CE}}}{\partial z_j} = p_j - \tau_j = p_j - \delta</em>
\end{equation}} \tag{22</p>
<p>EMOï¼š</p>
<p>\begin{equation}
\frac{\partial \mathcal{L}<em j_t="j,t">{\text{EMO}}}{\partial z_j} = p_j (c</em>
\end{equation}} - \mathcal{L}_{\text{EMO}}) \tag{23</p>
<p><strong>å…³é”®åŒºåˆ«</strong>ï¼š</p>
<ol>
<li><strong>åŠ æƒ</strong>ï¼šEMOæ¢¯åº¦ä¹˜ä»¥ç›¸å¯¹æˆæœ¬$(c_{j,t} - \mathcal{L}_{\text{EMO}})$</li>
<li><strong>è‡ªé€‚åº”</strong>ï¼šæˆæœ¬ä½äºå¹³å‡çš„ç±»åˆ«æ¢¯åº¦ä¸ºè´Ÿï¼ˆé¼“åŠ±ï¼‰ï¼Œæˆæœ¬é«˜äºå¹³å‡çš„æ¢¯åº¦ä¸ºæ­£ï¼ˆæŠ‘åˆ¶ï¼‰</li>
<li><strong>è¯­ä¹‰æ„ŸçŸ¥</strong>ï¼šè¿‘ä¹‰è¯ï¼ˆ$c_{j,t}$å°ï¼‰å—åˆ°çš„æƒ©ç½šå°</li>
</ol>
<h3 id="5-kl">5. ä¸KLæ•£åº¦ç­‰æ•£åº¦çš„å¯¹æ¯”</h3>
<p><strong>f-æ•£åº¦æ—</strong>ï¼š</p>
<p>ä¸€èˆ¬å½¢å¼ï¼š</p>
<p>\begin{equation}
D_f(p | \tau) = \sum_i \tau_i f\left(\frac{p_i}{\tau_i}\right) \tag{24}
\end{equation}</p>
<p>å¸¸è§å®ä¾‹ï¼š</p>
<ol>
<li><strong>KLæ•£åº¦</strong>ï¼š$f(t) = t \log t$</li>
</ol>
<p>\begin{equation}
   \text{KL}(p | \tau) = \sum_i p_i \log \frac{p_i}{\tau_i} \tag{25}
   \end{equation}</p>
<ol>
<li><strong>åKLæ•£åº¦</strong>ï¼š$f(t) = -\log t$</li>
</ol>
<p>\begin{equation}
   \text{KL}(\tau | p) = \sum_i \tau_i \log \frac{\tau_i}{p_i} \tag{26}
   \end{equation}</p>
<ol>
<li><strong>Total Variation</strong>ï¼š$f(t) = |t-1|$</li>
</ol>
<p>\begin{equation}
   \text{TV}(p, \tau) = \frac{1}{2}\sum_i |p_i - \tau_i| \tag{27}
   \end{equation}</p>
<ol>
<li><strong>Hellingerè·ç¦»</strong>ï¼š$f(t) = (\sqrt{t} - 1)^2$</li>
</ol>
<p>\begin{equation}
   H^2(p, \tau) = \sum_i (\sqrt{p_i} - \sqrt{\tau_i})^2 \tag{28}
   \end{equation}</p>
<p><strong>Wasserstein vs f-æ•£åº¦</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>æ€§è´¨</th>
<th>f-æ•£åº¦</th>
<th>Wassersteinè·ç¦»</th>
</tr>
</thead>
<tbody>
<tr>
<td>åº¦é‡ç»“æ„</td>
<td>éåº¦é‡ï¼ˆä¸æ»¡è¶³ä¸‰è§’ä¸ç­‰å¼ï¼‰</td>
<td>çœŸåº¦é‡</td>
</tr>
<tr>
<td>å¼±æ”¶æ•›</td>
<td>ä¸è¿ç»­</td>
<td>è¿ç»­ï¼ˆå¼±æ‹“æ‰‘ï¼‰</td>
</tr>
<tr>
<td>è¯­ä¹‰æ„ŸçŸ¥</td>
<td>å¦</td>
<td>æ˜¯ï¼ˆé€šè¿‡æˆæœ¬çŸ©é˜µï¼‰</td>
</tr>
<tr>
<td>è®¡ç®—å¤æ‚åº¦</td>
<td>$O(n)$</td>
<td>$O(n^3)$æˆ–$O(n^2/\varepsilon^2)$</td>
</tr>
</tbody>
</table>
<p><strong>å®šç†ï¼ˆå¼±æ”¶æ•›ï¼‰</strong>ï¼šè®¾${p_n}$å¼±æ”¶æ•›åˆ°$p$ï¼Œåˆ™ï¼š</p>
<p>\begin{equation}
W_1(p_n, p) \to 0, \quad \text{ä½†} \quad \text{KL}(p_n | p) \not\to 0 \text{ (ä¸€èˆ¬)} \tag{29}
\end{equation}</p>
<p>è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆWassersteinè·ç¦»åœ¨GANè®­ç»ƒä¸­æ¯”f-æ•£åº¦æ›´ç¨³å®šã€‚</p>
<h3 id="6-sinkhorn">6. Sinkhornç®—æ³•è¯¦è§£</h3>
<p><strong>ç†µæ­£åˆ™åŒ–æœ€ä¼˜ä¼ è¾“</strong>ï¼š</p>
<p>æ ‡å‡†æœ€ä¼˜ä¼ è¾“æ±‚è§£å›°éš¾ï¼ˆ$O(n^3 \log n)$ï¼‰ï¼ŒCuturi (2013) æå‡ºç†µæ­£åˆ™åŒ–ï¼š</p>
<p>\begin{equation}
\mathcal{C}<em _Gamma="\Gamma" _Pi_p_="\Pi(p," _in="\in" _tau_="\tau)">{\varepsilon}[p, \tau] = \min</em>
\end{equation}} \left{\sum_{ij} \Gamma_{ij} C_{ij} - \varepsilon H(\Gamma)\right} \tag{30</p>
<p>å…¶ä¸­ç†µä¸ºï¼š</p>
<p>\begin{equation}
H(\Gamma) = -\sum_{ij} \Gamma_{ij} (\log \Gamma_{ij} - 1) \tag{31}
\end{equation}</p>
<p><strong>Sinkhorn-Knoppç®—æ³•</strong>ï¼š</p>
<p>æœ€ä¼˜è§£å…·æœ‰å½¢å¼ï¼š</p>
<p>\begin{equation}
\Gamma^* = \text{diag}(u) K \text{diag}(v) \tag{32}
\end{equation}</p>
<p>å…¶ä¸­$K_{ij} = e^{-C_{ij}/\varepsilon}$æ˜¯Gibbsæ ¸ï¼Œ$u, v$é€šè¿‡è¿­ä»£æ±‚è§£ï¼š</p>
<p>\begin{equation}
\begin{cases}
u^{(k+1)} = \frac{p}{K v^{(k)}} \
v^{(k+1)} = \frac{\tau}{K^T u^{(k+1)}}
\end{cases} \tag{33}
\end{equation}</p>
<p><strong>å¯¹æ•°ç©ºé—´ç¨³å®šç‰ˆæœ¬</strong>ï¼š</p>
<p>å®šä¹‰$\alpha = \varepsilon \log u$ï¼Œ$\beta = \varepsilon \log v$ï¼Œè¿­ä»£ï¼š</p>
<p>\begin{equation}
\begin{cases}
\alpha^{(k+1)} = \varepsilon \log p - \varepsilon \log\left(\sum_j e^{(\beta^{(k)}<em ij="ij">j - C</em>\right) \
\beta^{(k+1)} = \varepsilon \log \tau - \varepsilon \log\left(\sum_i e^{(\alpha^{(k+1)}})/\varepsilon<em ij="ij">i - C</em>\right)
\end{cases} \tag{34}
\end{equation}})/\varepsilon</p>
<p><strong>Log-sum-expæŠ€å·§</strong>ï¼š</p>
<p>\begin{equation}
\text{LSE}(x) = \log\sum_i e^{x_i} = \max_i x_i + \log\sum_i e^{x_i - \max_i x_i} \tag{35}
\end{equation}</p>
<p><strong>æ”¶æ•›é€Ÿç‡</strong>ï¼š</p>
<p>Sinkhornç®—æ³•ä»¥çº¿æ€§é€Ÿç‡æ”¶æ•›ï¼š</p>
<p>\begin{equation}
|\Gamma^{(k)} - \Gamma^*|_F \leq C \cdot \rho^k, \quad \rho &lt; 1 \tag{36}
\end{equation}</p>
<p>å…¶ä¸­$\rho$ä¾èµ–äº$\varepsilon$å’Œè¾¹ç¼˜åˆ†å¸ƒçš„æ­£åˆ™æ€§ã€‚</p>
<p><strong>EMOä¸­çš„åº”ç”¨</strong>ï¼š</p>
<p>è™½ç„¶EMOåœ¨one-hotæƒ…å†µä¸‹ä¸éœ€è¦Sinkhornï¼Œä½†åœ¨soft labelæ‰©å±•ä¸­å¯ä»¥ä½¿ç”¨ï¼š</p>
<p>\begin{equation}
\mathcal{L}<em _Gamma="\Gamma" _Pi_p_="\Pi(p," _in="\in" _tau_="\tau)">{\text{EMO-soft}} = \min</em>
\end{equation}} \sum_{ij} \Gamma_{ij} C_{ij} \tag{37</p>
<p>ç”¨Sinkhornè¿‘ä¼¼æ±‚è§£ã€‚</p>
<h3 id="7">7. ä¿¡æ¯è®ºè§£é‡Š</h3>
<p><strong>äº’ä¿¡æ¯è§†è§’</strong>ï¼š</p>
<p>å®šä¹‰è”åˆåˆ†å¸ƒ$\gamma(i,j) = p_i \tau_j$ï¼ˆç‹¬ç«‹å‡è®¾ï¼‰ï¼Œåˆ™ï¼š</p>
<p>\begin{equation}
I(p; \tau) = \sum_{ij} \gamma(i,j) \log \frac{\gamma(i,j)}{p_i \tau_j} = 0 \tag{38}
\end{equation}</p>
<p>ç‹¬ç«‹åˆ†å¸ƒäº’ä¿¡æ¯ä¸º0ï¼Œè¡¨ç¤ºæ²¡æœ‰åˆ©ç”¨ç±»åˆ«é—´å…³ç³»ã€‚</p>
<p><strong>è¿è¾“è®¡åˆ’çš„äº’ä¿¡æ¯</strong>ï¼š</p>
<p>æœ€ä¼˜ä¼ è¾“è®¡åˆ’$\Gamma^*$å®šä¹‰çš„äº’ä¿¡æ¯ï¼š</p>
<p>\begin{equation}
I(\Gamma^<em>) = \sum_{ij} \Gamma^</em><em ij="ij">{ij} \log \frac{\Gamma^*</em>
\end{equation}}}{p_i \tau_j} \tag{39</p>
<p>è¡¡é‡äº†è¿è¾“æ–¹æ¡ˆä¸­ç¼–ç çš„ç±»åˆ«å…³è”ä¿¡æ¯ã€‚</p>
<p><strong>ç†µæ­£åˆ™åŒ–çš„ä½œç”¨</strong>ï¼š</p>
<p>\begin{equation}
\mathcal{C}_{\varepsilon} = \mathcal{C} + \varepsilon \cdot I(\Gamma) \tag{40}
\end{equation}</p>
<p>$\varepsilon$æ§åˆ¶è¿è¾“æ–¹æ¡ˆçš„"éšæœºæ€§"ï¼š
- $\varepsilon \to 0$ï¼šç¡®å®šæ€§è¿è¾“ï¼ˆå¯èƒ½ä¸ç¨³å®šï¼‰
- $\varepsilon \to \infty$ï¼šå®Œå…¨éšæœºï¼ˆ$\Gamma \to p \otimes \tau$ï¼‰</p>
<p><strong>æ¡ä»¶ç†µ</strong>ï¼š</p>
<p>ç»™å®šé¢„æµ‹$p$ï¼Œç›®æ ‡çš„æ¡ä»¶ç†µï¼š</p>
<p>\begin{equation}
H(\tau | p) = -\sum_{ij} \Gamma^<em>_{ij} \log \Gamma^</em>_{ij|i} \tag{41}
\end{equation}</p>
<p>å…¶ä¸­$\Gamma^<em>_{ij|i} = \Gamma^</em>_{ij} / p_i$ã€‚</p>
<h3 id="8">8. æ¦‚ç‡è®ºè§†è§’</h3>
<p><strong>ç”Ÿæˆæ¨¡å‹è§£é‡Š</strong>ï¼š</p>
<p>å°†EMOè§†ä¸ºç”Ÿæˆè¿‡ç¨‹ï¼š
1. ä»é¢„æµ‹åˆ†å¸ƒ$p$é‡‡æ ·ç±»åˆ«$i$
2. ä»¥æˆæœ¬$c_{i,t}$"æ ¡æ­£"åˆ°ç›®æ ‡$t$</p>
<p>æœŸæœ›æˆæœ¬å³EMOæŸå¤±ã€‚</p>
<p><strong>Bayesé£é™©</strong>ï¼š</p>
<p>å®šä¹‰å†³ç­–è§„åˆ™$\delta: \mathcal{X} \to \mathcal{Y}$ï¼ŒBayesé£é™©ä¸ºï¼š</p>
<p>\begin{equation}
R(\delta) = \mathbb{E}<em _sim="\sim" p_cdot_x_="p(\cdot|x)" y="y">{x \sim \mathcal{D}}[\mathbb{E}</em>
\end{equation}}[c(\delta(x), y)]] \tag{42</p>
<p>EMOæŸå¤±æ˜¯Bayesé£é™©åœ¨æˆæœ¬$c_{i,t}$ä¸‹çš„å®ä¾‹åŒ–ã€‚</p>
<p><strong>Bayesæœ€ä¼˜åˆ†ç±»å™¨</strong>ï¼š</p>
<p>\begin{equation}
\delta^*(x) = \arg\min_{\hat{y}} \sum_{y} p(y|x) c(\hat{y}, y) \tag{43}
\end{equation}</p>
<p>å½“$c = 0$-$1$æŸå¤±æ—¶ï¼Œé€€åŒ–ä¸ºMAPåˆ†ç±»å™¨ã€‚</p>
<p><strong>åéªŒæ ¡å‡†</strong>ï¼š</p>
<p>EMOéšå¼åœ°é¼“åŠ±åéªŒæ ¡å‡†ï¼š</p>
<p>\begin{equation}
p(\hat{y} = y | x) \approx \frac{#{x_i: \hat{y}_i = y}}{N} \tag{44}
\end{equation}</p>
<p>é€šè¿‡æƒ©ç½šè¯­ä¹‰ä¸Šè¿œç¦»ç›®æ ‡çš„é¢„æµ‹ã€‚</p>
<h3 id="9">9. å‡ ä½•ç†è§£</h3>
<p><strong>Embeddingç©ºé—´çš„æµå½¢ç»“æ„</strong>ï¼š</p>
<p>Token embeddings ${\boldsymbol{e}_i}$å®šä¹‰äº†vocabularyæµå½¢$\mathcal{M} \subset \mathbb{R}^d$ã€‚</p>
<p><strong>æµ‹åœ°è·ç¦»</strong>ï¼š</p>
<p>åœ¨embeddingç©ºé—´ä¸­ï¼Œæˆæœ¬$c_{i,j}$è¿‘ä¼¼æµ‹åœ°è·ç¦»ï¼š</p>
<p>\begin{equation}
c_{i,j} \approx d_{\mathcal{M}}(\boldsymbol{e}_i, \boldsymbol{e}_j) \tag{45}
\end{equation}</p>
<p><strong>é‡å¿ƒé—®é¢˜</strong>ï¼š</p>
<p>EMOä¼˜åŒ–ç­‰ä»·äºå¯»æ‰¾Wassersteiné‡å¿ƒï¼š</p>
<p>\begin{equation}
\arg\min_{\boldsymbol{e}} \sum_i p_i d(\boldsymbol{e}, \boldsymbol{e}_i) \tag{46}
\end{equation}</p>
<p>å…¶è§£ä¸ºï¼š</p>
<p>\begin{equation}
\boldsymbol{e}^* = \frac{\sum_i p_i \boldsymbol{e}_i}{|\sum_i p_i \boldsymbol{e}_i|} \tag{47}
\end{equation}</p>
<p>ï¼ˆå½’ä¸€åŒ–åçš„åŠ æƒå¹³å‡ï¼‰</p>
<p><strong>æ›²ç‡çš„å½±å“</strong>ï¼š</p>
<p>åœ¨æ­£æ›²ç‡ç©ºé—´ï¼ˆå¦‚è¶…çƒé¢ï¼‰ï¼ŒWassersteinè·ç¦»æ»¡è¶³ï¼š</p>
<p>\begin{equation}
W_2^2(p, \tau) \leq \frac{1}{\kappa} \left(1 - \cos(\sqrt{\kappa} \cdot d_{\text{Euclidean}}(p, \tau))\right) \tag{48}
\end{equation}</p>
<p>å…¶ä¸­$\kappa &gt; 0$æ˜¯æ›²ç‡ã€‚</p>
<h3 id="10">10. ç†è®ºæ€§è´¨</h3>
<p><strong>æ€§è´¨1ï¼šéè´Ÿæ€§ä¸æ’ç­‰æ€§</strong></p>
<p>\begin{equation}
\mathcal{L}<em _text_EMO="\text{EMO">{\text{EMO}} \geq 0, \quad \mathcal{L}</em>
\end{equation}}} = 0 \Leftrightarrow p = e_t \tag{49</p>
<p>è¯æ˜ï¼š$\mathcal{L}_{\text{EMO}} = 0$å½“ä¸”ä»…å½“$\bar{\boldsymbol{e}}_p = \boldsymbol{e}_t$ï¼Œå³$p = e_t$ã€‚</p>
<p><strong>æ€§è´¨2ï¼šLipschitzè¿ç»­æ€§</strong></p>
<p>\begin{equation}
|\mathcal{L}<em _text_EMO="\text{EMO">{\text{EMO}}(p_1) - \mathcal{L}</em>
\end{equation}}}(p_2)| \leq L |p_1 - p_2|_1 \tag{50</p>
<p>å…¶ä¸­$L = \max_{i,j} c_{i,j} \leq 2$ï¼ˆä½™å¼¦è·ç¦»ç•Œï¼‰ã€‚</p>
<p><strong>æ€§è´¨3ï¼šå‡¸æ€§</strong></p>
<p>$\mathcal{L}_{\text{EMO}}$å…³äº$p$æ˜¯å‡¸å‡½æ•°ï¼š</p>
<p>\begin{equation}
\mathcal{L}<em _text_EMO="\text{EMO">{\text{EMO}}(\lambda p_1 + (1-\lambda)p_2) \leq \lambda \mathcal{L}</em>
\end{equation}}}(p_1) + (1-\lambda)\mathcal{L}_{\text{EMO}}(p_2) \tag{51</p>
<p>è¯æ˜ï¼šä½™å¼¦ç›¸ä¼¼åº¦æ˜¯çº¿æ€§çš„ï¼ŒæŸå¤±æ˜¯ä½™å¼¦ç›¸ä¼¼åº¦çš„å‡¸å‡½æ•°ã€‚</p>
<p><strong>æ€§è´¨4ï¼šæ¢¯åº¦èŒƒæ•°ç•Œ</strong></p>
<p>\begin{equation}
\left|\frac{\partial \mathcal{L}<em i_t="i,t">{\text{EMO}}}{\partial z}\right|_2 \leq \sqrt{n} \cdot \max_i |c</em>
\end{equation}}| \leq 2\sqrt{n} \tag{52</p>
<p><strong>æ€§è´¨5ï¼šHessiançŸ©é˜µ</strong></p>
<p>\begin{equation}
H_{jk} = \frac{\partial^2 \mathcal{L}<em jk="jk">{\text{EMO}}}{\partial z_j \partial z_k} = p_j(\delta</em>
\end{equation}} - p_k)(c_{j,t} - c_{k,t}) \tag{53</p>
<h3 id="11">11. æ•°å€¼ç¨³å®šæ€§</h3>
<p><strong>é—®é¢˜1ï¼šEmbeddingå½’ä¸€åŒ–</strong></p>
<p>å½“$|\boldsymbol{e}_i|$å·®å¼‚å¾ˆå¤§æ—¶ï¼Œä½™å¼¦ç›¸ä¼¼åº¦ä¸ç¨³å®šã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šé¢„å¤„ç†æ—¶L2å½’ä¸€åŒ–æ‰€æœ‰embeddings</p>
<p>\begin{equation}
\tilde{\boldsymbol{e}}_i = \frac{\boldsymbol{e}_i}{\max(|\boldsymbol{e}_i|, \epsilon)}, \quad \epsilon = 10^{-8} \tag{54}
\end{equation}</p>
<p><strong>é—®é¢˜2ï¼šæ•°å€¼ä¸‹æº¢</strong></p>
<p>å½“$p_i$éå¸¸å°æ—¶ï¼Œ$\sum_i p_i \boldsymbol{e}_i$å¯èƒ½ä¸‹æº¢ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šåœ¨log spaceè®¡ç®—</p>
<p>\begin{equation}
\log |\bar{\boldsymbol{e}}_p| = \text{LSE}(\log p + \log |\boldsymbol{e}|) \tag{55}
\end{equation}</p>
<p><strong>é—®é¢˜3ï¼šæ¢¯åº¦æ¶ˆå¤±</strong></p>
<p>å½“é¢„æµ‹éå¸¸å‡†ç¡®æ—¶ï¼Œæ¢¯åº¦æ¥è¿‘0ã€‚</p>
<p><strong>ç¼“è§£</strong>ï¼šç»“åˆäº¤å‰ç†µ</p>
<p>\begin{equation}
\mathcal{L}<em _text_CE="\text{CE">{\text{hybrid}} = (1-\alpha) \mathcal{L}</em>
\end{equation}}} + \alpha \mathcal{L}_{\text{EMO}}, \quad \alpha \in [0,1] \tag{56</p>
<h3 id="12">12. å…·ä½“è®¡ç®—ç¤ºä¾‹</h3>
<p><strong>è®¾ç½®</strong>ï¼š
- Vocabulary size = 4
- Embedding dim = 2
- Target class = 2
- Logits $z = [1.0, 2.0, 0.5, 0.3]$</p>
<p><strong>æ­¥éª¤1ï¼šè®¡ç®—Softmax</strong></p>
<p>\begin{equation}
\begin{aligned}
Z &amp;= \sum_i e^{z_i} = e^{1.0} + e^{2.0} + e^{0.5} + e^{0.3} = 2.718 + 7.389 + 1.649 + 1.350 = 13.106 \
p &amp;= [0.207, 0.564, 0.126, 0.103]
\end{aligned} \tag{57}
\end{equation}</p>
<p><strong>æ­¥éª¤2ï¼šEmbeddingsï¼ˆå½’ä¸€åŒ–ï¼‰</strong></p>
<p>\begin{equation}
\begin{aligned}
\boldsymbol{e}_1 &amp;= [0.6, 0.8] \
\boldsymbol{e}_2 &amp;= [1.0, 0.0] \
\boldsymbol{e}_3 &amp;= [0.6, -0.8] \
\boldsymbol{e}_4 &amp;= [-0.8, 0.6]
\end{aligned} \tag{58}
\end{equation}</p>
<p><strong>æ­¥éª¤3ï¼šè®¡ç®—æˆæœ¬</strong></p>
<p>\begin{equation}
\begin{aligned}
c_{1,2} &amp;= 1 - \langle [0.6, 0.8], [1.0, 0.0] \rangle = 1 - 0.6 = 0.4 \
c_{2,2} &amp;= 1 - 1.0 = 0.0 \
c_{3,2} &amp;= 1 - 0.6 = 0.4 \
c_{4,2} &amp;= 1 - (-0.8) = 1.8
\end{aligned} \tag{59}
\end{equation}</p>
<p><strong>æ­¥éª¤4ï¼šEMOæŸå¤±</strong></p>
<p>\begin{equation}
\begin{aligned}
\mathcal{L}<em i_2="i,2">{\text{EMO}} &amp;= \sum_i p_i c</em> \
&amp;= 0.207 \times 0.4 + 0.564 \times 0 + 0.126 \times 0.4 + 0.103 \times 1.8 \
&amp;= 0.083 + 0 + 0.050 + 0.185 \
&amp;= 0.318
\end{aligned} \tag{60}
\end{equation}</p>
<p><strong>æ­¥éª¤5ï¼šæ¢¯åº¦</strong></p>
<p>\begin{equation}
\begin{aligned}
\frac{\partial \mathcal{L}}{\partial z_1} &amp;= p_1(c_{1,2} - \mathcal{L}_{\text{EMO}}) = 0.207 \times (0.4 - 0.318) = 0.017 \
\frac{\partial \mathcal{L}}{\partial z_2} &amp;= 0.564 \times (0 - 0.318) = -0.179 \
\frac{\partial \mathcal{L}}{\partial z_3} &amp;= 0.126 \times (0.4 - 0.318) = 0.010 \
\frac{\partial \mathcal{L}}{\partial z_4} &amp;= 0.103 \times (1.8 - 0.318) = 0.153
\end{aligned} \tag{61}
\end{equation}</p>
<p><strong>å¯¹æ¯”äº¤å‰ç†µ</strong>ï¼š</p>
<p>\begin{equation}
\frac{\partial \mathcal{L}_{\text{CE}}}{\partial z} = p - e_2 = [0.207, -0.436, 0.126, 0.103] \tag{62}
\end{equation}</p>
<p><strong>è§‚å¯Ÿ</strong>ï¼šEMOå¯¹è¯­ä¹‰ç›¸è¿‘çš„ç±»åˆ«ï¼ˆ1,3ï¼‰æƒ©ç½šæ›´è½»ï¼Œå¯¹è¯­ä¹‰è¿œç¦»çš„ç±»åˆ«ï¼ˆ4ï¼‰æƒ©ç½šæ›´é‡ã€‚</p>
<h3 id="13">13. ä¸å…¶ä»–æŸå¤±å‡½æ•°çš„å¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>æŸå¤±å‡½æ•°</th>
<th>å½¢å¼</th>
<th>è¯­ä¹‰æ„ŸçŸ¥</th>
<th>è®¡ç®—å¤æ‚åº¦</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>äº¤å‰ç†µ</td>
<td>$-\log p_t$</td>
<td>å¦</td>
<td>$O(n)$</td>
<td>é€šç”¨åˆ†ç±»</td>
</tr>
<tr>
<td>Focal Loss</td>
<td>$-(1-p_t)^\gamma \log p_t$</td>
<td>å¦</td>
<td>$O(n)$</td>
<td>ç±»åˆ«ä¸å¹³è¡¡</td>
</tr>
<tr>
<td>Label Smoothing</td>
<td>$\sum_i \tau_i' \log p_i$</td>
<td>å¼±ï¼ˆuniform smoothingï¼‰</td>
<td>$O(n)$</td>
<td>æ­£åˆ™åŒ–</td>
</tr>
<tr>
<td>EMO</td>
<td>$\sum_i p_i c_{i,t}$</td>
<td>æ˜¯ï¼ˆembedding-basedï¼‰</td>
<td>$O(nd)$</td>
<td>LLMã€å¤§è¯è¡¨</td>
</tr>
<tr>
<td>Sinkhorn Loss</td>
<td>$\min_{\Gamma} \langle \Gamma, C \rangle$</td>
<td>æ˜¯</td>
<td>$O(n^2 K)$</td>
<td>Soft labels</td>
</tr>
</tbody>
</table>
<h3 id="14">14. å®è·µå»ºè®®</h3>
<p><strong>Embeddingé€‰æ‹©</strong>ï¼š</p>
<ol>
<li><strong>é¢„è®­ç»ƒEmbeddings</strong>ï¼šä½¿ç”¨æ¨¡å‹çš„è¾“å‡ºå±‚æƒé‡</li>
</ol>
<p>\begin{equation}
   \boldsymbol{e}<em _text_out="\text{out">i = W</em>
   \end{equation}}}[i, :] \tag{63</p>
<ol>
<li>
<p><strong>Word2Vec/GloVe</strong>ï¼šå¯¹äºæ²¡æœ‰é¢„è®­ç»ƒæ¨¡å‹çš„æƒ…å†µ</p>
</li>
<li>
<p><strong>Contextualized Embeddings</strong>ï¼šå¯¹æ¯ä¸ªtokenå–å¹³å‡</p>
</li>
</ol>
<p><strong>è¶…å‚æ•°</strong>ï¼š</p>
<ol>
<li>
<p><strong>æ··åˆç³»æ•°$\alpha$</strong>ï¼ˆhybrid lossï¼‰ï¼š</p>
</li>
<li>
<p>é¢„è®­ç»ƒfrom scratchï¼š$\alpha = 0.1 \sim 0.3$</p>
</li>
<li>
<p>Fine-tuningï¼š$\alpha = 0.5 \sim 0.9$</p>
</li>
<li>
<p><strong>Embeddingå›ºå®š vs å¾®è°ƒ</strong>ï¼š</p>
</li>
<li>
<p>å›ºå®šï¼šä¿æŒæˆæœ¬çŸ©é˜µä¸å˜ï¼ˆç†è®ºä¿è¯ï¼‰</p>
</li>
<li>å¾®è°ƒï¼šå¯èƒ½æå‡æ€§èƒ½ä½†å¤±å»ç†è®ºåŸºç¡€</li>
</ol>
<p><strong>å®ç°æŠ€å·§</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ä¼ªä»£ç </span>
<span class="k">def</span><span class="w"> </span><span class="nf">emo_loss</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">):</span>
    <span class="c1"># logits: [B, V], targets: [B], embeddings: [V, D]</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">softmax</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># [B, V]</span>

    <span class="c1"># å½’ä¸€åŒ–embeddings</span>
    <span class="n">emb_norm</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># [V, D]</span>

    <span class="c1"># è®¡ç®—åŠ æƒå¹³å‡embedding</span>
    <span class="n">weighted_emb</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">emb_norm</span><span class="p">)</span>  <span class="c1"># [B, D]</span>

    <span class="c1"># ç›®æ ‡embedding</span>
    <span class="n">target_emb</span> <span class="o">=</span> <span class="n">emb_norm</span><span class="p">[</span><span class="n">targets</span><span class="p">]</span>  <span class="c1"># [B, D]</span>

    <span class="c1"># ä½™å¼¦ç›¸ä¼¼åº¦</span>
    <span class="n">cos_sim</span> <span class="o">=</span> <span class="p">(</span><span class="n">weighted_emb</span> <span class="o">*</span> <span class="n">target_emb</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># [B]</span>

    <span class="c1"># EMO loss</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cos_sim</span>

    <span class="k">return</span> <span class="n">loss</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div>

<p><strong>è°ƒè¯•checklist</strong>ï¼š</p>
<ol>
<li>éªŒè¯embeddingså·²å½’ä¸€åŒ–</li>
<li>æ£€æŸ¥æˆæœ¬çŸ©é˜µå¯¹ç§°æ€§å’Œä¸‰è§’ä¸ç­‰å¼</li>
<li>ç›‘æ§æŸå¤±å€¼èŒƒå›´ï¼ˆåº”åœ¨$[0, 2]$ï¼‰</li>
<li>å¯¹æ¯”æ¢¯åº¦æ–¹å‘ä¸äº¤å‰ç†µ</li>
</ol>
<h3 id="15">15. ç†è®ºæ‰©å±•</h3>
<p><strong>æ‰©å±•1ï¼šå¤šæ ‡ç­¾EMO</strong></p>
<p>\begin{equation}
\mathcal{L}<em _in="\in" _mathcal_T="\mathcal{T" t="t">{\text{multi-EMO}} = \sum</em>
\end{equation}}} w_t \sum_i p_i c_{i,t} \tag{64</p>
<p>å…¶ä¸­$\mathcal{T}$æ˜¯ç›®æ ‡ç±»åˆ«é›†ï¼Œ$w_t$æ˜¯æƒé‡ã€‚</p>
<p><strong>æ‰©å±•2ï¼šSoft Label EMO</strong></p>
<p>\begin{equation}
\mathcal{L}<em i_j="i,j">{\text{soft-EMO}} = \sum</em> \Gamma^*<em i_j="i,j">{ij} c</em>
\end{equation}} \tag{65</p>
<p>ä½¿ç”¨Sinkhornæ±‚è§£$\Gamma^*$ã€‚</p>
<p><strong>æ‰©å±•3ï¼šæˆæœ¬å­¦ä¹ </strong></p>
<p>å°†æˆæœ¬çŸ©é˜µ$C$ä½œä¸ºå‚æ•°è”åˆä¼˜åŒ–ï¼š</p>
<p>\begin{equation}
\min_{\theta, C} \mathbb{E}[\mathcal{L}<em>{\text{EMO}}(p</em>\theta, C)] + \lambda R(C) \tag{66}
\end{equation}</p>
<p>å…¶ä¸­$R(C)$æ˜¯æ­£åˆ™é¡¹ï¼ˆå¦‚é¼“åŠ±åº¦é‡æ€§è´¨ï¼‰ã€‚</p>
<hr />
<p><strong>æ€»ç»“</strong>ï¼šæœ¬èŠ‚å…¨é¢ä»‹ç»äº†åŸºäºæœ€ä¼˜ä¼ è¾“ç†è®ºçš„EMOæŸå¤±å‡½æ•°ï¼Œä»ç†è®ºåŸºç¡€ï¼ˆMonge-Kantoroviché—®é¢˜ï¼‰åˆ°å®é™…åº”ç”¨ï¼ˆLLMå¾®è°ƒï¼‰ï¼Œæ¶µç›–Wassersteinè·ç¦»ã€Sinkhornç®—æ³•ã€ä¿¡æ¯è®ºè§£é‡Šã€å‡ ä½•è§†è§’ç­‰å¤šä¸ªæ–¹é¢ã€‚è¯¦ç»†çš„æ¨å¯¼å’Œå®ä¾‹å±•ç¤ºäº†EMOå¦‚ä½•é€šè¿‡è€ƒè™‘ç±»åˆ«é—´è¯­ä¹‰è·ç¦»æ¥æ”¹è¿›æ ‡å‡†äº¤å‰ç†µæŸå¤±ã€‚</p>
<hr />
<h2 id="_8">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<h3 id="1_1">1. æœ€ä¼˜ä¼ è¾“ç†è®ºåŸºç¡€</h3>
<p><strong>Mongeé—®é¢˜ï¼ˆ1781ï¼‰</strong>ï¼šæœ€ä¼˜ä¼ è¾“ç†è®ºèµ·æºäºMongeçš„"åœŸæ–¹æ¬è¿"é—®é¢˜ã€‚ç»™å®šä¸¤ä¸ªæ¦‚ç‡æµ‹åº¦$\mu$å’Œ$\nu$ï¼Œå¯»æ‰¾æœ€ä¼˜çš„è¿è¾“æ–¹æ¡ˆ$T: \mathcal{X} \to \mathcal{Y}$ä½¿å¾—è¿è¾“æˆæœ¬æœ€å°ï¼š</p>
<p>\begin{equation}
\inf_{T: T_{#}\mu = \nu} \int_{\mathcal{X}} c(x, T(x)) d\mu(x) \tag{1}
\end{equation}</p>
<p>å…¶ä¸­$c(x,y)$æ˜¯ä»$x$åˆ°$y$çš„è¿è¾“æˆæœ¬ï¼Œ$T_{#}\mu$è¡¨ç¤ºæµ‹åº¦$\mu$åœ¨$T$ä¸‹çš„æ¨å‰ï¼ˆpushforwardï¼‰ã€‚</p>
<p><strong>Kantorovichæ¾å¼›ï¼ˆ1942ï¼‰</strong>ï¼šKantorovichå°†Mongeé—®é¢˜æ¾å¼›ä¸ºå¯»æ‰¾è”åˆåˆ†å¸ƒ$\gamma \in \Pi(\mu, \nu)$ï¼š</p>
<p>\begin{equation}
\mathcal{C}[\mu, \nu] = \inf_{\gamma \in \Pi(\mu, \nu)} \int_{\mathcal{X} \times \mathcal{Y}} c(x, y) d\gamma(x, y) \tag{2}
\end{equation}</p>
<p>å…¶ä¸­$\Pi(\mu, \nu)$æ˜¯æ‰€æœ‰è¾¹ç¼˜åˆ†å¸ƒä¸º$\mu$å’Œ$\nu$çš„è”åˆåˆ†å¸ƒé›†åˆï¼š</p>
<p>\begin{equation}
\Pi(\mu, \nu) = \left{\gamma \in \mathcal{P}(\mathcal{X} \times \mathcal{Y}): \int_{\mathcal{Y}} d\gamma = \mu, \int_{\mathcal{X}} d\gamma = \nu\right} \tag{3}
\end{equation}</p>
<p><strong>ç¦»æ•£åŒ–</strong>ï¼šå¯¹äºç¦»æ•£åˆ†å¸ƒ$p = (p_1, \ldots, p_n)$å’Œ$\tau = (\tau_1, \ldots, \tau_n)$ï¼Œæœ€ä¼˜ä¼ è¾“é—®é¢˜å˜ä¸ºçº¿æ€§è§„åˆ’ï¼š</p>
<p>\begin{equation}
\mathcal{C}[p, \tau] = \min_{\Gamma \in \mathbb{R}^{n \times n}} \sum_{i,j=1}^{n} \Gamma_{ij} C_{ij} \tag{4}
\end{equation}</p>
<p>çº¦æŸæ¡ä»¶ï¼š</p>
<p>\begin{equation}
\begin{cases}
\sum_{j=1}^{n} \Gamma_{ij} = p_i, &amp; \forall i \
\sum_{i=1}^{n} \Gamma_{ij} = \tau_j, &amp; \forall j \
\Gamma_{ij} \geq 0, &amp; \forall i,j
\end{cases} \tag{5}
\end{equation}</p>
<p>å…¶ä¸­$C_{ij} = c(i,j)$æ˜¯æˆæœ¬çŸ©é˜µã€‚</p>
<h3 id="2-wasserstein_1">2. Wassersteinè·ç¦»è¯¦è§£</h3>
<p><strong>$p$-Wassersteinè·ç¦»</strong>ï¼šå¯¹äº$p \geq 1$ï¼Œ$p$-Wassersteinè·ç¦»å®šä¹‰ä¸ºï¼š</p>
<p>\begin{equation}
W_p(\mu, \nu) = \left(\inf_{\gamma \in \Pi(\mu, \nu)} \int_{\mathcal{X} \times \mathcal{Y}} d(x,y)^p d\gamma(x,y)\right)^{1/p} \tag{6}
\end{equation}</p>
<p>å…¶ä¸­$d(x,y)$æ˜¯åŸºç¡€åº¦é‡ç©ºé—´ä¸Šçš„è·ç¦»ã€‚</p>
<p><strong>å¸¸ç”¨æƒ…å½¢</strong>ï¼š</p>
<ol>
<li><strong>1-Wassersteinè·ç¦»</strong>ï¼ˆEarth Mover's Distanceï¼‰ï¼š</li>
</ol>
<p>\begin{equation}
   W_1(\mu, \nu) = \inf_{\gamma \in \Pi(\mu, \nu)} \int_{\mathcal{X} \times \mathcal{Y}} d(x,y) d\gamma(x,y) \tag{7}
   \end{equation}</p>
<ol>
<li><strong>2-Wassersteinè·ç¦»</strong>ï¼š</li>
</ol>
<p>\begin{equation}
   W_2(\mu, \nu) = \sqrt{\inf_{\gamma \in \Pi(\mu, \nu)} \int_{\mathcal{X} \times \mathcal{Y}} d(x,y)^2 d\gamma(x,y)} \tag{8}
   \end{equation}</p>
<p><strong>Kantorovich-Rubinsteinå¯¹å¶</strong>ï¼š</p>
<p>\begin{equation}
W_1(\mu, \nu) = \sup_{f: |f|_L \leq 1} \left{\int f d\mu - \int f d\nu\right} \tag{9}
\end{equation}</p>
<p>å…¶ä¸­$|f|_L$æ˜¯Lipschitzå¸¸æ•°ã€‚è¿™æ˜¯WGANçš„ç†è®ºåŸºç¡€ã€‚</p>
<p><strong>ç¦»æ•£1-Wassersteinè·ç¦»</strong>ï¼š</p>
<p>\begin{equation}
W_1(p, \tau) = \min_{\Gamma \geq 0} \sum_{i,j} \Gamma_{ij} d_{ij}, \quad \text{s.t. } \Gamma \mathbf{1} = p, \Gamma^T \mathbf{1} = \tau \tag{10}
\end{equation}</p>
<h3 id="3-emo_1">3. EMOæŸå¤±å‡½æ•°çš„æ¨å¯¼</h3>
<p><strong>ä»åˆ†ç±»åˆ°æœ€ä¼˜ä¼ è¾“</strong>ï¼š</p>
<p>æ ‡å‡†äº¤å‰ç†µæŸå¤±ï¼š</p>
<p>\begin{equation}
\mathcal{L}_{\text{CE}} = -\log p_t = -\log \frac{e^{z_t}}{\sum_i e^{z_i}} \tag{11}
\end{equation}</p>
<p>KLæ•£åº¦å½¢å¼ï¼š</p>
<p>\begin{equation}
\mathcal{L}_{\text{CE}} = \text{KL}(\tau | p) = \sum_i \tau_i \log \frac{\tau_i}{p_i} = -\sum_i \tau_i \log p_i + \text{const} \tag{12}
\end{equation}</p>
<p><strong>é—®é¢˜</strong>ï¼šKLæ•£åº¦ä¸è€ƒè™‘ç±»åˆ«ä¹‹é—´çš„è¯­ä¹‰è·ç¦»ï¼Œæ‰€æœ‰é”™è¯¯ç±»åˆ«çš„æƒ©ç½šç›¸åŒã€‚</p>
<p><strong>EMOçš„åŠ¨æœº</strong>ï¼šä½¿ç”¨æœ€ä¼˜ä¼ è¾“è·ç¦»$W_1(p, \tau)$æ›¿ä»£KLæ•£åº¦ï¼Œè€ƒè™‘ç±»åˆ«é—´çš„è¯­ä¹‰ç›¸ä¼¼æ€§ã€‚</p>
<p><strong>One-hotç›®æ ‡çš„ç®€åŒ–</strong>ï¼š</p>
<p>å½“$\tau = e_t$ï¼ˆone-hotï¼‰æ—¶ï¼Œæœ€ä¼˜ä¼ è¾“æ–¹æ¡ˆå”¯ä¸€ï¼šå°†$p$çš„æ‰€æœ‰è´¨é‡éƒ½è¿é€åˆ°$t$ï¼Œæˆæœ¬ä¸ºï¼š</p>
<p>\begin{equation}
\mathcal{C}[p, \tau] = \sum_{i=1}^{n} p_i c_{i,t} \tag{13}
\end{equation}</p>
<p>å…¶ä¸­$c_{i,t}$æ˜¯ä»ç±»åˆ«$i$åˆ°ç›®æ ‡ç±»åˆ«$t$çš„è¿è¾“æˆæœ¬ã€‚</p>
<p><strong>æˆæœ¬å‡½æ•°è®¾è®¡</strong>ï¼š</p>
<p>åŸºäºembeddingä½™å¼¦è·ç¦»ï¼š</p>
<p>\begin{equation}
c_{i,j} = 1 - \cos(\boldsymbol{e}_i, \boldsymbol{e}_j) = 1 - \frac{\langle \boldsymbol{e}_i, \boldsymbol{e}_j \rangle}{|\boldsymbol{e}_i| |\boldsymbol{e}_j|} \tag{14}
\end{equation}</p>
<p>å…¶ä¸­${\boldsymbol{e}<em i="1">i}</em>^n$æ˜¯é¢„è®­ç»ƒçš„token embeddingsï¼ˆå›ºå®šä¸å˜ï¼‰ã€‚</p>
<p><strong>EMOæŸå¤±</strong>ï¼š</p>
<p>\begin{equation}
\mathcal{L}<em i="1">{\text{EMO}} = \sum</em>
\end{equation}}^{n} p_i c_{i,t} = \sum_{i=1}^{n} p_i (1 - \cos(\boldsymbol{e}_i, \boldsymbol{e}_t)) \tag{15</p>
<p>å±•å¼€ï¼š</p>
<p>\begin{equation}
\mathcal{L}<em i="1">{\text{EMO}} = 1 - \sum</em>}^{n} p_i \cos(\boldsymbol{e<em i="1">i, \boldsymbol{e}_t) = 1 - \left\langle \sum</em>
\end{equation}}^{n} p_i \frac{\boldsymbol{e}_i}{|\boldsymbol{e}_i|}, \frac{\boldsymbol{e}_t}{|\boldsymbol{e}_t|} \right\rangle \tag{16</p>
<p>å®šä¹‰åŠ æƒå¹³å‡embeddingï¼š</p>
<p>\begin{equation}
\bar{\boldsymbol{e}}<em i="1">p = \sum</em>
\end{equation}}^{n} p_i \frac{\boldsymbol{e}_i}{|\boldsymbol{e}_i|} \tag{17</p>
<p>åˆ™ï¼š</p>
<p>\begin{equation}
\mathcal{L}_{\text{EMO}} = 1 - \cos(\bar{\boldsymbol{e}}_p, \boldsymbol{e}_t) \tag{18}
\end{equation}</p>
<p><strong>å‡ ä½•è§£é‡Š</strong>ï¼šEMOæŸå¤±è¡¡é‡é¢„æµ‹åˆ†å¸ƒçš„åŠ æƒå¹³å‡embeddingä¸ç›®æ ‡embeddingçš„ä½™å¼¦è·ç¦»ã€‚</p>
<h3 id="4_1">4. æ¢¯åº¦è®¡ç®—</h3>
<p><strong>æŸå¤±å…³äºlogitsçš„æ¢¯åº¦</strong>ï¼š</p>
<p>\begin{equation}
\frac{\partial \mathcal{L}<em i_t="i,t">{\text{EMO}}}{\partial z_j} = \frac{\partial}{\partial z_j} \left(\sum_i p_i c</em>
\end{equation}}\right) \tag{19</p>
<p>åˆ©ç”¨$p_j = \frac{e^{z_j}}{\sum_k e^{z_k}}$ï¼Œæœ‰ï¼š</p>
<p>\begin{equation}
\frac{\partial p_j}{\partial z_k} = p_j (\delta_{jk} - p_k) \tag{20}
\end{equation}</p>
<p>å…¶ä¸­$\delta_{jk}$æ˜¯Kronecker deltaã€‚</p>
<p>ä»£å…¥å¾—ï¼š</p>
<p>\begin{equation}
\begin{aligned}
\frac{\partial \mathcal{L}<em i_t="i,t">{\text{EMO}}}{\partial z_j} &amp;= \sum_i \frac{\partial p_i}{\partial z_j} c</em> \
&amp;= \sum_i p_i (\delta_{ij} - p_j) c_{i,t} \
&amp;= p_j (c_{j,t} - \sum_i p_i c_{i,t}) \
&amp;= p_j (c_{j,t} - \mathcal{L}_{\text{EMO}})
\end{aligned} \tag{21}
\end{equation}</p>
<p><strong>ä¸äº¤å‰ç†µæ¢¯åº¦çš„å¯¹æ¯”</strong>ï¼š</p>
<p>äº¤å‰ç†µï¼š</p>
<p>\begin{equation}
\frac{\partial \mathcal{L}<em jt="jt">{\text{CE}}}{\partial z_j} = p_j - \tau_j = p_j - \delta</em>
\end{equation}} \tag{22</p>
<p>EMOï¼š</p>
<p>\begin{equation}
\frac{\partial \mathcal{L}<em j_t="j,t">{\text{EMO}}}{\partial z_j} = p_j (c</em>
\end{equation}} - \mathcal{L}_{\text{EMO}}) \tag{23</p>
<p><strong>å…³é”®åŒºåˆ«</strong>ï¼š</p>
<ol>
<li><strong>åŠ æƒ</strong>ï¼šEMOæ¢¯åº¦ä¹˜ä»¥ç›¸å¯¹æˆæœ¬$(c_{j,t} - \mathcal{L}_{\text{EMO}})$</li>
<li><strong>è‡ªé€‚åº”</strong>ï¼šæˆæœ¬ä½äºå¹³å‡çš„ç±»åˆ«æ¢¯åº¦ä¸ºè´Ÿï¼ˆé¼“åŠ±ï¼‰ï¼Œæˆæœ¬é«˜äºå¹³å‡çš„æ¢¯åº¦ä¸ºæ­£ï¼ˆæŠ‘åˆ¶ï¼‰</li>
<li><strong>è¯­ä¹‰æ„ŸçŸ¥</strong>ï¼šè¿‘ä¹‰è¯ï¼ˆ$c_{j,t}$å°ï¼‰å—åˆ°çš„æƒ©ç½šå°</li>
</ol>
<h3 id="5-kl_1">5. ä¸KLæ•£åº¦ç­‰æ•£åº¦çš„å¯¹æ¯”</h3>
<p><strong>f-æ•£åº¦æ—</strong>ï¼š</p>
<p>ä¸€èˆ¬å½¢å¼ï¼š</p>
<p>\begin{equation}
D_f(p | \tau) = \sum_i \tau_i f\left(\frac{p_i}{\tau_i}\right) \tag{24}
\end{equation}</p>
<p>å¸¸è§å®ä¾‹ï¼š</p>
<ol>
<li><strong>KLæ•£åº¦</strong>ï¼š$f(t) = t \log t$</li>
</ol>
<p>\begin{equation}
   \text{KL}(p | \tau) = \sum_i p_i \log \frac{p_i}{\tau_i} \tag{25}
   \end{equation}</p>
<ol>
<li><strong>åKLæ•£åº¦</strong>ï¼š$f(t) = -\log t$</li>
</ol>
<p>\begin{equation}
   \text{KL}(\tau | p) = \sum_i \tau_i \log \frac{\tau_i}{p_i} \tag{26}
   \end{equation}</p>
<ol>
<li><strong>Total Variation</strong>ï¼š$f(t) = |t-1|$</li>
</ol>
<p>\begin{equation}
   \text{TV}(p, \tau) = \frac{1}{2}\sum_i |p_i - \tau_i| \tag{27}
   \end{equation}</p>
<ol>
<li><strong>Hellingerè·ç¦»</strong>ï¼š$f(t) = (\sqrt{t} - 1)^2$</li>
</ol>
<p>\begin{equation}
   H^2(p, \tau) = \sum_i (\sqrt{p_i} - \sqrt{\tau_i})^2 \tag{28}
   \end{equation}</p>
<p><strong>Wasserstein vs f-æ•£åº¦</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>æ€§è´¨</th>
<th>f-æ•£åº¦</th>
<th>Wassersteinè·ç¦»</th>
</tr>
</thead>
<tbody>
<tr>
<td>åº¦é‡ç»“æ„</td>
<td>éåº¦é‡ï¼ˆä¸æ»¡è¶³ä¸‰è§’ä¸ç­‰å¼ï¼‰</td>
<td>çœŸåº¦é‡</td>
</tr>
<tr>
<td>å¼±æ”¶æ•›</td>
<td>ä¸è¿ç»­</td>
<td>è¿ç»­ï¼ˆå¼±æ‹“æ‰‘ï¼‰</td>
</tr>
<tr>
<td>è¯­ä¹‰æ„ŸçŸ¥</td>
<td>å¦</td>
<td>æ˜¯ï¼ˆé€šè¿‡æˆæœ¬çŸ©é˜µï¼‰</td>
</tr>
<tr>
<td>è®¡ç®—å¤æ‚åº¦</td>
<td>$O(n)$</td>
<td>$O(n^3)$æˆ–$O(n^2/\varepsilon^2)$</td>
</tr>
</tbody>
</table>
<p><strong>å®šç†ï¼ˆå¼±æ”¶æ•›ï¼‰</strong>ï¼šè®¾${p_n}$å¼±æ”¶æ•›åˆ°$p$ï¼Œåˆ™ï¼š</p>
<p>\begin{equation}
W_1(p_n, p) \to 0, \quad \text{ä½†} \quad \text{KL}(p_n | p) \not\to 0 \text{ (ä¸€èˆ¬)} \tag{29}
\end{equation}</p>
<p>è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆWassersteinè·ç¦»åœ¨GANè®­ç»ƒä¸­æ¯”f-æ•£åº¦æ›´ç¨³å®šã€‚</p>
<h3 id="6-sinkhorn_1">6. Sinkhornç®—æ³•è¯¦è§£</h3>
<p><strong>ç†µæ­£åˆ™åŒ–æœ€ä¼˜ä¼ è¾“</strong>ï¼š</p>
<p>æ ‡å‡†æœ€ä¼˜ä¼ è¾“æ±‚è§£å›°éš¾ï¼ˆ$O(n^3 \log n)$ï¼‰ï¼ŒCuturi (2013) æå‡ºç†µæ­£åˆ™åŒ–ï¼š</p>
<p>\begin{equation}
\mathcal{C}<em _Gamma="\Gamma" _Pi_p_="\Pi(p," _in="\in" _tau_="\tau)">{\varepsilon}[p, \tau] = \min</em>
\end{equation}} \left{\sum_{ij} \Gamma_{ij} C_{ij} - \varepsilon H(\Gamma)\right} \tag{30</p>
<p>å…¶ä¸­ç†µä¸ºï¼š</p>
<p>\begin{equation}
H(\Gamma) = -\sum_{ij} \Gamma_{ij} (\log \Gamma_{ij} - 1) \tag{31}
\end{equation}</p>
<p><strong>Sinkhorn-Knoppç®—æ³•</strong>ï¼š</p>
<p>æœ€ä¼˜è§£å…·æœ‰å½¢å¼ï¼š</p>
<p>\begin{equation}
\Gamma^* = \text{diag}(u) K \text{diag}(v) \tag{32}
\end{equation}</p>
<p>å…¶ä¸­$K_{ij} = e^{-C_{ij}/\varepsilon}$æ˜¯Gibbsæ ¸ï¼Œ$u, v$é€šè¿‡è¿­ä»£æ±‚è§£ï¼š</p>
<p>\begin{equation}
\begin{cases}
u^{(k+1)} = \frac{p}{K v^{(k)}} \
v^{(k+1)} = \frac{\tau}{K^T u^{(k+1)}}
\end{cases} \tag{33}
\end{equation}</p>
<p><strong>å¯¹æ•°ç©ºé—´ç¨³å®šç‰ˆæœ¬</strong>ï¼š</p>
<p>å®šä¹‰$\alpha = \varepsilon \log u$ï¼Œ$\beta = \varepsilon \log v$ï¼Œè¿­ä»£ï¼š</p>
<p>\begin{equation}
\begin{cases}
\alpha^{(k+1)} = \varepsilon \log p - \varepsilon \log\left(\sum_j e^{(\beta^{(k)}<em ij="ij">j - C</em>\right) \
\beta^{(k+1)} = \varepsilon \log \tau - \varepsilon \log\left(\sum_i e^{(\alpha^{(k+1)}})/\varepsilon<em ij="ij">i - C</em>\right)
\end{cases} \tag{34}
\end{equation}})/\varepsilon</p>
<p><strong>Log-sum-expæŠ€å·§</strong>ï¼š</p>
<p>\begin{equation}
\text{LSE}(x) = \log\sum_i e^{x_i} = \max_i x_i + \log\sum_i e^{x_i - \max_i x_i} \tag{35}
\end{equation}</p>
<p><strong>æ”¶æ•›é€Ÿç‡</strong>ï¼š</p>
<p>Sinkhornç®—æ³•ä»¥çº¿æ€§é€Ÿç‡æ”¶æ•›ï¼š</p>
<p>\begin{equation}
|\Gamma^{(k)} - \Gamma^*|_F \leq C \cdot \rho^k, \quad \rho &lt; 1 \tag{36}
\end{equation}</p>
<p>å…¶ä¸­$\rho$ä¾èµ–äº$\varepsilon$å’Œè¾¹ç¼˜åˆ†å¸ƒçš„æ­£åˆ™æ€§ã€‚</p>
<p><strong>EMOä¸­çš„åº”ç”¨</strong>ï¼š</p>
<p>è™½ç„¶EMOåœ¨one-hotæƒ…å†µä¸‹ä¸éœ€è¦Sinkhornï¼Œä½†åœ¨soft labelæ‰©å±•ä¸­å¯ä»¥ä½¿ç”¨ï¼š</p>
<p>\begin{equation}
\mathcal{L}<em _Gamma="\Gamma" _Pi_p_="\Pi(p," _in="\in" _tau_="\tau)">{\text{EMO-soft}} = \min</em>
\end{equation}} \sum_{ij} \Gamma_{ij} C_{ij} \tag{37</p>
<p>ç”¨Sinkhornè¿‘ä¼¼æ±‚è§£ã€‚</p>
<h3 id="7_1">7. ä¿¡æ¯è®ºè§£é‡Š</h3>
<p><strong>äº’ä¿¡æ¯è§†è§’</strong>ï¼š</p>
<p>å®šä¹‰è”åˆåˆ†å¸ƒ$\gamma(i,j) = p_i \tau_j$ï¼ˆç‹¬ç«‹å‡è®¾ï¼‰ï¼Œåˆ™ï¼š</p>
<p>\begin{equation}
I(p; \tau) = \sum_{ij} \gamma(i,j) \log \frac{\gamma(i,j)}{p_i \tau_j} = 0 \tag{38}
\end{equation}</p>
<p>ç‹¬ç«‹åˆ†å¸ƒäº’ä¿¡æ¯ä¸º0ï¼Œè¡¨ç¤ºæ²¡æœ‰åˆ©ç”¨ç±»åˆ«é—´å…³ç³»ã€‚</p>
<p><strong>è¿è¾“è®¡åˆ’çš„äº’ä¿¡æ¯</strong>ï¼š</p>
<p>æœ€ä¼˜ä¼ è¾“è®¡åˆ’$\Gamma^*$å®šä¹‰çš„äº’ä¿¡æ¯ï¼š</p>
<p>\begin{equation}
I(\Gamma^<em>) = \sum_{ij} \Gamma^</em><em ij="ij">{ij} \log \frac{\Gamma^*</em>
\end{equation}}}{p_i \tau_j} \tag{39</p>
<p>è¡¡é‡äº†è¿è¾“æ–¹æ¡ˆä¸­ç¼–ç çš„ç±»åˆ«å…³è”ä¿¡æ¯ã€‚</p>
<p><strong>ç†µæ­£åˆ™åŒ–çš„ä½œç”¨</strong>ï¼š</p>
<p>\begin{equation}
\mathcal{C}_{\varepsilon} = \mathcal{C} + \varepsilon \cdot I(\Gamma) \tag{40}
\end{equation}</p>
<p>$\varepsilon$æ§åˆ¶è¿è¾“æ–¹æ¡ˆçš„"éšæœºæ€§"ï¼š
- $\varepsilon \to 0$ï¼šç¡®å®šæ€§è¿è¾“ï¼ˆå¯èƒ½ä¸ç¨³å®šï¼‰
- $\varepsilon \to \infty$ï¼šå®Œå…¨éšæœºï¼ˆ$\Gamma \to p \otimes \tau$ï¼‰</p>
<p><strong>æ¡ä»¶ç†µ</strong>ï¼š</p>
<p>ç»™å®šé¢„æµ‹$p$ï¼Œç›®æ ‡çš„æ¡ä»¶ç†µï¼š</p>
<p>\begin{equation}
H(\tau | p) = -\sum_{ij} \Gamma^<em>_{ij} \log \Gamma^</em>_{ij|i} \tag{41}
\end{equation}</p>
<p>å…¶ä¸­$\Gamma^<em>_{ij|i} = \Gamma^</em>_{ij} / p_i$ã€‚</p>
<h3 id="8_1">8. æ¦‚ç‡è®ºè§†è§’</h3>
<p><strong>ç”Ÿæˆæ¨¡å‹è§£é‡Š</strong>ï¼š</p>
<p>å°†EMOè§†ä¸ºç”Ÿæˆè¿‡ç¨‹ï¼š
1. ä»é¢„æµ‹åˆ†å¸ƒ$p$é‡‡æ ·ç±»åˆ«$i$
2. ä»¥æˆæœ¬$c_{i,t}$"æ ¡æ­£"åˆ°ç›®æ ‡$t$</p>
<p>æœŸæœ›æˆæœ¬å³EMOæŸå¤±ã€‚</p>
<p><strong>Bayesé£é™©</strong>ï¼š</p>
<p>å®šä¹‰å†³ç­–è§„åˆ™$\delta: \mathcal{X} \to \mathcal{Y}$ï¼ŒBayesé£é™©ä¸ºï¼š</p>
<p>\begin{equation}
R(\delta) = \mathbb{E}<em _sim="\sim" p_cdot_x_="p(\cdot|x)" y="y">{x \sim \mathcal{D}}[\mathbb{E}</em>
\end{equation}}[c(\delta(x), y)]] \tag{42</p>
<p>EMOæŸå¤±æ˜¯Bayesé£é™©åœ¨æˆæœ¬$c_{i,t}$ä¸‹çš„å®ä¾‹åŒ–ã€‚</p>
<p><strong>Bayesæœ€ä¼˜åˆ†ç±»å™¨</strong>ï¼š</p>
<p>\begin{equation}
\delta^*(x) = \arg\min_{\hat{y}} \sum_{y} p(y|x) c(\hat{y}, y) \tag{43}
\end{equation}</p>
<p>å½“$c = 0$-$1$æŸå¤±æ—¶ï¼Œé€€åŒ–ä¸ºMAPåˆ†ç±»å™¨ã€‚</p>
<p><strong>åéªŒæ ¡å‡†</strong>ï¼š</p>
<p>EMOéšå¼åœ°é¼“åŠ±åéªŒæ ¡å‡†ï¼š</p>
<p>\begin{equation}
p(\hat{y} = y | x) \approx \frac{#{x_i: \hat{y}_i = y}}{N} \tag{44}
\end{equation}</p>
<p>é€šè¿‡æƒ©ç½šè¯­ä¹‰ä¸Šè¿œç¦»ç›®æ ‡çš„é¢„æµ‹ã€‚</p>
<h3 id="9_1">9. å‡ ä½•ç†è§£</h3>
<p><strong>Embeddingç©ºé—´çš„æµå½¢ç»“æ„</strong>ï¼š</p>
<p>Token embeddings ${\boldsymbol{e}_i}$å®šä¹‰äº†vocabularyæµå½¢$\mathcal{M} \subset \mathbb{R}^d$ã€‚</p>
<p><strong>æµ‹åœ°è·ç¦»</strong>ï¼š</p>
<p>åœ¨embeddingç©ºé—´ä¸­ï¼Œæˆæœ¬$c_{i,j}$è¿‘ä¼¼æµ‹åœ°è·ç¦»ï¼š</p>
<p>\begin{equation}
c_{i,j} \approx d_{\mathcal{M}}(\boldsymbol{e}_i, \boldsymbol{e}_j) \tag{45}
\end{equation}</p>
<p><strong>é‡å¿ƒé—®é¢˜</strong>ï¼š</p>
<p>EMOä¼˜åŒ–ç­‰ä»·äºå¯»æ‰¾Wassersteiné‡å¿ƒï¼š</p>
<p>\begin{equation}
\arg\min_{\boldsymbol{e}} \sum_i p_i d(\boldsymbol{e}, \boldsymbol{e}_i) \tag{46}
\end{equation}</p>
<p>å…¶è§£ä¸ºï¼š</p>
<p>\begin{equation}
\boldsymbol{e}^* = \frac{\sum_i p_i \boldsymbol{e}_i}{|\sum_i p_i \boldsymbol{e}_i|} \tag{47}
\end{equation}</p>
<p>ï¼ˆå½’ä¸€åŒ–åçš„åŠ æƒå¹³å‡ï¼‰</p>
<p><strong>æ›²ç‡çš„å½±å“</strong>ï¼š</p>
<p>åœ¨æ­£æ›²ç‡ç©ºé—´ï¼ˆå¦‚è¶…çƒé¢ï¼‰ï¼ŒWassersteinè·ç¦»æ»¡è¶³ï¼š</p>
<p>\begin{equation}
W_2^2(p, \tau) \leq \frac{1}{\kappa} \left(1 - \cos(\sqrt{\kappa} \cdot d_{\text{Euclidean}}(p, \tau))\right) \tag{48}
\end{equation}</p>
<p>å…¶ä¸­$\kappa &gt; 0$æ˜¯æ›²ç‡ã€‚</p>
<h3 id="10_1">10. ç†è®ºæ€§è´¨</h3>
<p><strong>æ€§è´¨1ï¼šéè´Ÿæ€§ä¸æ’ç­‰æ€§</strong></p>
<p>\begin{equation}
\mathcal{L}<em _text_EMO="\text{EMO">{\text{EMO}} \geq 0, \quad \mathcal{L}</em>
\end{equation}}} = 0 \Leftrightarrow p = e_t \tag{49</p>
<p>è¯æ˜ï¼š$\mathcal{L}_{\text{EMO}} = 0$å½“ä¸”ä»…å½“$\bar{\boldsymbol{e}}_p = \boldsymbol{e}_t$ï¼Œå³$p = e_t$ã€‚</p>
<p><strong>æ€§è´¨2ï¼šLipschitzè¿ç»­æ€§</strong></p>
<p>\begin{equation}
|\mathcal{L}<em _text_EMO="\text{EMO">{\text{EMO}}(p_1) - \mathcal{L}</em>
\end{equation}}}(p_2)| \leq L |p_1 - p_2|_1 \tag{50</p>
<p>å…¶ä¸­$L = \max_{i,j} c_{i,j} \leq 2$ï¼ˆä½™å¼¦è·ç¦»ç•Œï¼‰ã€‚</p>
<p><strong>æ€§è´¨3ï¼šå‡¸æ€§</strong></p>
<p>$\mathcal{L}_{\text{EMO}}$å…³äº$p$æ˜¯å‡¸å‡½æ•°ï¼š</p>
<p>\begin{equation}
\mathcal{L}<em _text_EMO="\text{EMO">{\text{EMO}}(\lambda p_1 + (1-\lambda)p_2) \leq \lambda \mathcal{L}</em>
\end{equation}}}(p_1) + (1-\lambda)\mathcal{L}_{\text{EMO}}(p_2) \tag{51</p>
<p>è¯æ˜ï¼šä½™å¼¦ç›¸ä¼¼åº¦æ˜¯çº¿æ€§çš„ï¼ŒæŸå¤±æ˜¯ä½™å¼¦ç›¸ä¼¼åº¦çš„å‡¸å‡½æ•°ã€‚</p>
<p><strong>æ€§è´¨4ï¼šæ¢¯åº¦èŒƒæ•°ç•Œ</strong></p>
<p>\begin{equation}
\left|\frac{\partial \mathcal{L}<em i_t="i,t">{\text{EMO}}}{\partial z}\right|_2 \leq \sqrt{n} \cdot \max_i |c</em>
\end{equation}}| \leq 2\sqrt{n} \tag{52</p>
<p><strong>æ€§è´¨5ï¼šHessiançŸ©é˜µ</strong></p>
<p>\begin{equation}
H_{jk} = \frac{\partial^2 \mathcal{L}<em jk="jk">{\text{EMO}}}{\partial z_j \partial z_k} = p_j(\delta</em>
\end{equation}} - p_k)(c_{j,t} - c_{k,t}) \tag{53</p>
<h3 id="11_1">11. æ•°å€¼ç¨³å®šæ€§</h3>
<p><strong>é—®é¢˜1ï¼šEmbeddingå½’ä¸€åŒ–</strong></p>
<p>å½“$|\boldsymbol{e}_i|$å·®å¼‚å¾ˆå¤§æ—¶ï¼Œä½™å¼¦ç›¸ä¼¼åº¦ä¸ç¨³å®šã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šé¢„å¤„ç†æ—¶L2å½’ä¸€åŒ–æ‰€æœ‰embeddings</p>
<p>\begin{equation}
\tilde{\boldsymbol{e}}_i = \frac{\boldsymbol{e}_i}{\max(|\boldsymbol{e}_i|, \epsilon)}, \quad \epsilon = 10^{-8} \tag{54}
\end{equation}</p>
<p><strong>é—®é¢˜2ï¼šæ•°å€¼ä¸‹æº¢</strong></p>
<p>å½“$p_i$éå¸¸å°æ—¶ï¼Œ$\sum_i p_i \boldsymbol{e}_i$å¯èƒ½ä¸‹æº¢ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šåœ¨log spaceè®¡ç®—</p>
<p>\begin{equation}
\log |\bar{\boldsymbol{e}}_p| = \text{LSE}(\log p + \log |\boldsymbol{e}|) \tag{55}
\end{equation}</p>
<p><strong>é—®é¢˜3ï¼šæ¢¯åº¦æ¶ˆå¤±</strong></p>
<p>å½“é¢„æµ‹éå¸¸å‡†ç¡®æ—¶ï¼Œæ¢¯åº¦æ¥è¿‘0ã€‚</p>
<p><strong>ç¼“è§£</strong>ï¼šç»“åˆäº¤å‰ç†µ</p>
<p>\begin{equation}
\mathcal{L}<em _text_CE="\text{CE">{\text{hybrid}} = (1-\alpha) \mathcal{L}</em>
\end{equation}}} + \alpha \mathcal{L}_{\text{EMO}}, \quad \alpha \in [0,1] \tag{56</p>
<h3 id="12_1">12. å…·ä½“è®¡ç®—ç¤ºä¾‹</h3>
<p><strong>è®¾ç½®</strong>ï¼š
- Vocabulary size = 4
- Embedding dim = 2
- Target class = 2
- Logits $z = [1.0, 2.0, 0.5, 0.3]$</p>
<p><strong>æ­¥éª¤1ï¼šè®¡ç®—Softmax</strong></p>
<p>\begin{equation}
\begin{aligned}
Z &amp;= \sum_i e^{z_i} = e^{1.0} + e^{2.0} + e^{0.5} + e^{0.3} = 2.718 + 7.389 + 1.649 + 1.350 = 13.106 \
p &amp;= [0.207, 0.564, 0.126, 0.103]
\end{aligned} \tag{57}
\end{equation}</p>
<p><strong>æ­¥éª¤2ï¼šEmbeddingsï¼ˆå½’ä¸€åŒ–ï¼‰</strong></p>
<p>\begin{equation}
\begin{aligned}
\boldsymbol{e}_1 &amp;= [0.6, 0.8] \
\boldsymbol{e}_2 &amp;= [1.0, 0.0] \
\boldsymbol{e}_3 &amp;= [0.6, -0.8] \
\boldsymbol{e}_4 &amp;= [-0.8, 0.6]
\end{aligned} \tag{58}
\end{equation}</p>
<p><strong>æ­¥éª¤3ï¼šè®¡ç®—æˆæœ¬</strong></p>
<p>\begin{equation}
\begin{aligned}
c_{1,2} &amp;= 1 - \langle [0.6, 0.8], [1.0, 0.0] \rangle = 1 - 0.6 = 0.4 \
c_{2,2} &amp;= 1 - 1.0 = 0.0 \
c_{3,2} &amp;= 1 - 0.6 = 0.4 \
c_{4,2} &amp;= 1 - (-0.8) = 1.8
\end{aligned} \tag{59}
\end{equation}</p>
<p><strong>æ­¥éª¤4ï¼šEMOæŸå¤±</strong></p>
<p>\begin{equation}
\begin{aligned}
\mathcal{L}<em i_2="i,2">{\text{EMO}} &amp;= \sum_i p_i c</em> \
&amp;= 0.207 \times 0.4 + 0.564 \times 0 + 0.126 \times 0.4 + 0.103 \times 1.8 \
&amp;= 0.083 + 0 + 0.050 + 0.185 \
&amp;= 0.318
\end{aligned} \tag{60}
\end{equation}</p>
<p><strong>æ­¥éª¤5ï¼šæ¢¯åº¦</strong></p>
<p>\begin{equation}
\begin{aligned}
\frac{\partial \mathcal{L}}{\partial z_1} &amp;= p_1(c_{1,2} - \mathcal{L}_{\text{EMO}}) = 0.207 \times (0.4 - 0.318) = 0.017 \
\frac{\partial \mathcal{L}}{\partial z_2} &amp;= 0.564 \times (0 - 0.318) = -0.179 \
\frac{\partial \mathcal{L}}{\partial z_3} &amp;= 0.126 \times (0.4 - 0.318) = 0.010 \
\frac{\partial \mathcal{L}}{\partial z_4} &amp;= 0.103 \times (1.8 - 0.318) = 0.153
\end{aligned} \tag{61}
\end{equation}</p>
<p><strong>å¯¹æ¯”äº¤å‰ç†µ</strong>ï¼š</p>
<p>\begin{equation}
\frac{\partial \mathcal{L}_{\text{CE}}}{\partial z} = p - e_2 = [0.207, -0.436, 0.126, 0.103] \tag{62}
\end{equation}</p>
<p><strong>è§‚å¯Ÿ</strong>ï¼šEMOå¯¹è¯­ä¹‰ç›¸è¿‘çš„ç±»åˆ«ï¼ˆ1,3ï¼‰æƒ©ç½šæ›´è½»ï¼Œå¯¹è¯­ä¹‰è¿œç¦»çš„ç±»åˆ«ï¼ˆ4ï¼‰æƒ©ç½šæ›´é‡ã€‚</p>
<h3 id="13_1">13. ä¸å…¶ä»–æŸå¤±å‡½æ•°çš„å¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>æŸå¤±å‡½æ•°</th>
<th>å½¢å¼</th>
<th>è¯­ä¹‰æ„ŸçŸ¥</th>
<th>è®¡ç®—å¤æ‚åº¦</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>äº¤å‰ç†µ</td>
<td>$-\log p_t$</td>
<td>å¦</td>
<td>$O(n)$</td>
<td>é€šç”¨åˆ†ç±»</td>
</tr>
<tr>
<td>Focal Loss</td>
<td>$-(1-p_t)^\gamma \log p_t$</td>
<td>å¦</td>
<td>$O(n)$</td>
<td>ç±»åˆ«ä¸å¹³è¡¡</td>
</tr>
<tr>
<td>Label Smoothing</td>
<td>$\sum_i \tau_i' \log p_i$</td>
<td>å¼±ï¼ˆuniform smoothingï¼‰</td>
<td>$O(n)$</td>
<td>æ­£åˆ™åŒ–</td>
</tr>
<tr>
<td>EMO</td>
<td>$\sum_i p_i c_{i,t}$</td>
<td>æ˜¯ï¼ˆembedding-basedï¼‰</td>
<td>$O(nd)$</td>
<td>LLMã€å¤§è¯è¡¨</td>
</tr>
<tr>
<td>Sinkhorn Loss</td>
<td>$\min_{\Gamma} \langle \Gamma, C \rangle$</td>
<td>æ˜¯</td>
<td>$O(n^2 K)$</td>
<td>Soft labels</td>
</tr>
</tbody>
</table>
<h3 id="14_1">14. å®è·µå»ºè®®</h3>
<p><strong>Embeddingé€‰æ‹©</strong>ï¼š</p>
<ol>
<li><strong>é¢„è®­ç»ƒEmbeddings</strong>ï¼šä½¿ç”¨æ¨¡å‹çš„è¾“å‡ºå±‚æƒé‡</li>
</ol>
<p>\begin{equation}
   \boldsymbol{e}<em _text_out="\text{out">i = W</em>
   \end{equation}}}[i, :] \tag{63</p>
<ol>
<li>
<p><strong>Word2Vec/GloVe</strong>ï¼šå¯¹äºæ²¡æœ‰é¢„è®­ç»ƒæ¨¡å‹çš„æƒ…å†µ</p>
</li>
<li>
<p><strong>Contextualized Embeddings</strong>ï¼šå¯¹æ¯ä¸ªtokenå–å¹³å‡</p>
</li>
</ol>
<p><strong>è¶…å‚æ•°</strong>ï¼š</p>
<ol>
<li>
<p><strong>æ··åˆç³»æ•°$\alpha$</strong>ï¼ˆhybrid lossï¼‰ï¼š</p>
</li>
<li>
<p>é¢„è®­ç»ƒfrom scratchï¼š$\alpha = 0.1 \sim 0.3$</p>
</li>
<li>
<p>Fine-tuningï¼š$\alpha = 0.5 \sim 0.9$</p>
</li>
<li>
<p><strong>Embeddingå›ºå®š vs å¾®è°ƒ</strong>ï¼š</p>
</li>
<li>
<p>å›ºå®šï¼šä¿æŒæˆæœ¬çŸ©é˜µä¸å˜ï¼ˆç†è®ºä¿è¯ï¼‰</p>
</li>
<li>å¾®è°ƒï¼šå¯èƒ½æå‡æ€§èƒ½ä½†å¤±å»ç†è®ºåŸºç¡€</li>
</ol>
<p><strong>å®ç°æŠ€å·§</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ä¼ªä»£ç </span>
<span class="k">def</span><span class="w"> </span><span class="nf">emo_loss</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">):</span>
    <span class="c1"># logits: [B, V], targets: [B], embeddings: [V, D]</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">softmax</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># [B, V]</span>

    <span class="c1"># å½’ä¸€åŒ–embeddings</span>
    <span class="n">emb_norm</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># [V, D]</span>

    <span class="c1"># è®¡ç®—åŠ æƒå¹³å‡embedding</span>
    <span class="n">weighted_emb</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">emb_norm</span><span class="p">)</span>  <span class="c1"># [B, D]</span>

    <span class="c1"># ç›®æ ‡embedding</span>
    <span class="n">target_emb</span> <span class="o">=</span> <span class="n">emb_norm</span><span class="p">[</span><span class="n">targets</span><span class="p">]</span>  <span class="c1"># [B, D]</span>

    <span class="c1"># ä½™å¼¦ç›¸ä¼¼åº¦</span>
    <span class="n">cos_sim</span> <span class="o">=</span> <span class="p">(</span><span class="n">weighted_emb</span> <span class="o">*</span> <span class="n">target_emb</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># [B]</span>

    <span class="c1"># EMO loss</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cos_sim</span>

    <span class="k">return</span> <span class="n">loss</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div>

<p><strong>è°ƒè¯•checklist</strong>ï¼š</p>
<ol>
<li>éªŒè¯embeddingså·²å½’ä¸€åŒ–</li>
<li>æ£€æŸ¥æˆæœ¬çŸ©é˜µå¯¹ç§°æ€§å’Œä¸‰è§’ä¸ç­‰å¼</li>
<li>ç›‘æ§æŸå¤±å€¼èŒƒå›´ï¼ˆåº”åœ¨$[0, 2]$ï¼‰</li>
<li>å¯¹æ¯”æ¢¯åº¦æ–¹å‘ä¸äº¤å‰ç†µ</li>
</ol>
<h3 id="15_1">15. ç†è®ºæ‰©å±•</h3>
<p><strong>æ‰©å±•1ï¼šå¤šæ ‡ç­¾EMO</strong></p>
<p>\begin{equation}
\mathcal{L}<em _in="\in" _mathcal_T="\mathcal{T" t="t">{\text{multi-EMO}} = \sum</em>
\end{equation}}} w_t \sum_i p_i c_{i,t} \tag{64</p>
<p>å…¶ä¸­$\mathcal{T}$æ˜¯ç›®æ ‡ç±»åˆ«é›†ï¼Œ$w_t$æ˜¯æƒé‡ã€‚</p>
<p><strong>æ‰©å±•2ï¼šSoft Label EMO</strong></p>
<p>\begin{equation}
\mathcal{L}<em i_j="i,j">{\text{soft-EMO}} = \sum</em> \Gamma^*<em i_j="i,j">{ij} c</em>
\end{equation}} \tag{65</p>
<p>ä½¿ç”¨Sinkhornæ±‚è§£$\Gamma^*$ã€‚</p>
<p><strong>æ‰©å±•3ï¼šæˆæœ¬å­¦ä¹ </strong></p>
<p>å°†æˆæœ¬çŸ©é˜µ$C$ä½œä¸ºå‚æ•°è”åˆä¼˜åŒ–ï¼š</p>
<p>\begin{equation}
\min_{\theta, C} \mathbb{E}[\mathcal{L}<em>{\text{EMO}}(p</em>\theta, C)] + \lambda R(C) \tag{66}
\end{equation}</p>
<p>å…¶ä¸­$R(C)$æ˜¯æ­£åˆ™é¡¹ï¼ˆå¦‚é¼“åŠ±åº¦é‡æ€§è´¨ï¼‰ã€‚</p>
<hr />
<p><strong>æ€»ç»“</strong>ï¼šæœ¬èŠ‚å…¨é¢ä»‹ç»äº†åŸºäºæœ€ä¼˜ä¼ è¾“ç†è®ºçš„EMOæŸå¤±å‡½æ•°ï¼Œä»ç†è®ºåŸºç¡€ï¼ˆMonge-Kantoroviché—®é¢˜ï¼‰åˆ°å®é™…åº”ç”¨ï¼ˆLLMå¾®è°ƒï¼‰ï¼Œæ¶µç›–Wassersteinè·ç¦»ã€Sinkhornç®—æ³•ã€ä¿¡æ¯è®ºè§£é‡Šã€å‡ ä½•è§†è§’ç­‰å¤šä¸ªæ–¹é¢ã€‚è¯¦ç»†çš„æ¨å¯¼å’Œå®ä¾‹å±•ç¤ºäº†EMOå¦‚ä½•é€šè¿‡è€ƒè™‘ç±»åˆ«é—´è¯­ä¹‰è·ç¦»æ¥æ”¹è¿›æ ‡å‡†äº¤å‰ç†µæŸå¤±ã€‚</p>
        </div>
    </div>
</body>
</html>