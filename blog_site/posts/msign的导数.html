<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>msignçš„å¯¼æ•°</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>msignçš„å¯¼æ•°</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-26 | ğŸ“„ å¤§å°: 53.2 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/11025">https://spaces.ac.cn/archives/11025</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>è¿™ç¯‡æ–‡ç« æˆ‘ä»¬æ¥æ¨å¯¼$\newcommand{msign}{\mathop{\text{msign}}}\msign$ç®—å­çš„æ±‚å¯¼å…¬å¼ã€‚å¦‚æœè¯»è€…æƒ³è¦åƒ<a href="https://papers.cool/arxiv/2505.23884">ã€ŠTest-Time Training Done Rightã€‹</a>ä¸€æ ·ï¼Œå°†<a href="https://papers.cool/arxiv/2407.04620">TTT</a>å’Œ<a href="/archives/10592">Muon</a>ç»“åˆèµ·æ¥ï¼Œé‚£ä¹ˆæœ¬æ–‡å¯èƒ½ä¼šå¯¹ä½ æœ‰å¸®åŠ©ã€‚</p>
<h2 id="_1">ä¸¤ç§å®šä¹‰</h2>
<p>æœ¬æ–‡ä¾ç„¶å‡è®¾å¤§å®¶å·²ç»å¯¹$\msign$æœ‰æ‰€äº†è§£ï¼Œå¦‚æœè¿˜æ²¡æœ‰ï¼Œå¯ä»¥å…ˆç§»æ­¥é˜…è¯»<a href="/archives/10592">ã€ŠMuonä¼˜åŒ–å™¨èµæï¼šä»å‘é‡åˆ°çŸ©é˜µçš„æœ¬è´¨è·¨è¶Šã€‹</a>å’Œ<a href="/archives/10922">ã€Šmsignç®—å­çš„Newton-Schulzè¿­ä»£ï¼ˆä¸Šï¼‰ã€‹</a>ã€‚ç°è®¾æœ‰çŸ©é˜µ$\boldsymbol{M}\in\mathbb{R}^{n\times m}$ï¼Œé‚£ä¹ˆ<br />
\begin{equation}\boldsymbol{U},\boldsymbol{\Sigma},\boldsymbol{V}^{\top} = \text{SVD}(\boldsymbol{M}) \quad\Rightarrow\quad \msign(\boldsymbol{M}) = \boldsymbol{U}<em _:_:r_="[:,:r]">{[:,:r]}\boldsymbol{V}</em>}^{\top}\end{equation<br />
å…¶ä¸­$\boldsymbol{U}\in\mathbb{R}^{n\times n},\boldsymbol{\Sigma}\in\mathbb{R}^{n\times m},\boldsymbol{V}\in\mathbb{R}^{m\times m}$ï¼Œ$r$æ˜¯$\boldsymbol{M}$çš„ç§©ã€‚ç®€å•æ¥è¯´ï¼Œ$\msign$å°±æ˜¯æŠŠçŸ©é˜µçš„æ‰€æœ‰éé›¶å¥‡å¼‚å€¼éƒ½å˜æˆ1åæ‰€å¾—çš„æ–°çŸ©é˜µã€‚åŸºäºSVDï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è¯æ˜<br />
\begin{equation}\msign(\boldsymbol{M}) = (\boldsymbol{M}\boldsymbol{M}^{\top})^{-1/2}\boldsymbol{M}= \boldsymbol{M}(\boldsymbol{M}^{\top}\boldsymbol{M})^{-1/2}\end{equation}<br />
è¿™é‡Œçš„$^{-1/2}$çš„çŸ©é˜µçš„$1/2$æ¬¡å¹‚çš„é€†ï¼Œç”±äº$\boldsymbol{M}\boldsymbol{M}^{\top}$å’Œ$\boldsymbol{M}^{\top}\boldsymbol{M}$æ˜¯ï¼ˆåŠï¼‰æ­£å®šå¯¹ç§°çš„ï¼Œæ‰€ä»¥$1/2$æ¬¡å¹‚æ€»æ˜¯å¯æ±‚ï¼Œä½†é€†æœªå¿…ï¼Œä¸å¯é€†çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥ç”¨â€œ<a href="/archives/10366">ä¼ªé€†</a>â€ã€‚$\msign$è¿™ä¸ªåå­—ï¼Œæºäºä¸Šå¼ä¸å®æ•°ç¬¦å·å‡½æ•°$\newcommand{sign}{\mathop{\text{sign}}}\sign(x) = x/\sqrt{x^2}$çš„ç›¸ä¼¼æ€§ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä¹‹å‰ä¹Ÿæåˆ°è¿‡ï¼Œç¬¦å·å‡½æ•°è¿˜æœ‰<a href="https://en.wikipedia.org/wiki/Matrix_sign_function">å¦ä¸€ä¸ªçŸ©é˜µç‰ˆ</a>ï¼Œè¿™é‡Œç§°ä¸º$\newcommand{mcsgn}{\mathop{\text{mcsgn}}}\newcommand{csgn}{\mathop{\text{csgn}}}\mcsgn$ï¼š<br />
\begin{equation}\mcsgn(\boldsymbol{M}) = \boldsymbol{M}(\boldsymbol{M}^2)^{-1/2}\end{equation}<br />
å³$\msign$çš„$\boldsymbol{M}^{\top}\boldsymbol{M}$æ¢æˆäº†$\boldsymbol{M}^2$ã€‚ç”±äºåªæœ‰æ–¹é˜µæ‰èƒ½ç®—å¹³æ–¹ï¼Œæ‰€ä»¥è¿™ç§å®šä¹‰åªé€‚ç”¨äºæ–¹é˜µã€‚åœ¨ä¸€ç¯‡æ–‡ç« å†…å¼•å…¥ä¸¤ç§ç›¸ä¼¼ä½†ä¸åŒçš„å®šä¹‰æ˜¯å®¹æ˜“å¼•èµ·æ··æ·†çš„ï¼Œä½†å¾ˆä¸å¹¸ï¼Œåé¢çš„è®¡ç®—ä¸­ä¸¤ç§å®šä¹‰éƒ½éœ€è¦ç”¨åˆ°ï¼Œæ‰€ä»¥ä¸å¾—ä¸åŒæ—¶å‡ºç°ã€‚</p>
<p>$\mcsgn$å…·å¤‡ç›¸ä¼¼ä¸å˜æ€§ï¼Œå¦‚æœ$\boldsymbol{M}=\boldsymbol{P}\boldsymbol{\Lambda}\boldsymbol{P}^{-1}$ï¼Œé‚£ä¹ˆ$\mcsgn(\boldsymbol{M})=\boldsymbol{P}\mcsgn(\boldsymbol{\Lambda})\boldsymbol{P}^{-1}$ã€‚è¿›ä¸€æ­¥åœ°ï¼Œå¦‚æœ$\boldsymbol{\Lambda}$æ˜¯å¯¹è§’é˜µï¼ˆåœ¨å¤æ•°åŸŸå†…å‡ ä¹æ€»æ˜¯å¯ä»¥åšåˆ°ï¼‰ï¼Œé‚£ä¹ˆæœ‰<br />
\begin{equation}\mcsgn(\boldsymbol{M}) = \boldsymbol{P}\csgn(\boldsymbol{\Lambda})\boldsymbol{P}^{-1}\end{equation}<br />
$\csgn(\boldsymbol{\Lambda})$è¡¨ç¤ºå¯¹è§’çº¿çš„å…ƒç´ éƒ½å–$\csgn$ï¼Œå…¶ä¸­$\csgn(z) = z/\sqrt{z^2}$æ˜¯ç¬¦å·å‡½æ•°çš„å¤æ•°ç‰ˆï¼Œå¦‚æœ$z$çš„å®éƒ¨éé›¶é‚£ä¹ˆå®ƒç­‰äº$\sign(\mathop{\text{Re}}[z])$ã€‚è¿™æ ·çœ‹æ¥ï¼Œ$\msign$å’Œ$\mcsgn$çš„åŒºåˆ«åœ¨äºï¼Œå‰è€…æ˜¯åœ¨å¥‡å¼‚å€¼åˆ†è§£åŸºç¡€ä¸Šå¯¹å¥‡å¼‚å€¼å–ç¬¦å·å‡½æ•°ï¼Œåè€…æ˜¯åœ¨ç‰¹å¾å€¼åˆ†è§£åŸºç¡€ä¸Šå¯¹ç‰¹å¾å€¼å–ç¬¦å·å‡½æ•°ã€‚å½“$\boldsymbol{M}$æ˜¯å¯¹ç§°çŸ©é˜µæ—¶ï¼Œå®ƒä»¬æ˜¯ç›¸ç­‰çš„ã€‚</p>
<h2 id="_2">åŒä¸€è®¡ç®—</h2>
<p>ç›®å‰è€Œè¨€ï¼Œ$\msign$çš„æ•°å€¼è®¡ç®—ä¸»è¦é å¦‚ä¸‹æ ¼å¼çš„â€œNewton-Schulzè¿­ä»£â€ï¼š<br />
\begin{equation}\boldsymbol{X}<em t_1="t+1">0 = \frac{\boldsymbol{M}}{\Vert\boldsymbol{M}\Vert_F},\qquad \boldsymbol{X}</em>} = a_{t+1}\boldsymbol{X<em t_1="t+1">t + b</em>}\boldsymbol{X<em t_1="t+1">t(\boldsymbol{X}_t^{\top}\boldsymbol{X}_t) + c</em>}\boldsymbol{X}_t(\boldsymbol{X}_t^{\top}\boldsymbol{X}_t)^2\end{equation<br />
è‡³äºç³»æ•°çš„é€‰æ‹©ï¼Œè¿™æˆ‘ä»¬åœ¨<a href="/archives/10922">ã€Šmsignç®—å­çš„Newton-Schulzè¿­ä»£ï¼ˆä¸Šï¼‰ã€‹</a>å’Œ<a href="/archives/10996">ã€Šmsignç®—å­çš„Newton-Schulzè¿­ä»£ï¼ˆä¸‹ï¼‰ã€‹</a>å·²ç»è¯¦ç»†æ¢è®¨è¿‡äº†ï¼Œå…¶ä¸­å‡ºè‡ªä¸‹ç¯‡çš„æ¯”è¾ƒæ–°çš„ç»“æœæ˜¯ï¼š<br />
$$\begin{array}{c|ccc}  
\hline  
t & a\times 1.01 & b\times 1.01^3 & c\times 1.01^5 \\\  
\hline  
\quad 1\quad & 8.28721 & -23.5959 & 17.3004 \\\  
2 & 4.10706 & -2.94785 & 0.544843 \\\  
3 & 3.94869 & -2.9089 & 0.551819 \\\  
4 & 3.31842 & -2.48849 & 0.510049 \\\  
5 & 2.30065 & -1.6689 & 0.418807 \\\  
6 & 1.8913 & 1.268 & 0.376804 \\\  
7 & 1.875 & -1.25 & 0.375 \\\  
8 & 1.875 & -1.25 & 0.375 \\\  
\hline  
\end{array}$$<br />
è¿™ä¸ªç»“æœçš„å¥½å¤„æ˜¯å¯ä»¥ä»»æ„æˆªæ–­å’Œå åŠ ï¼Œæ¯”å¦‚åªä¿ç•™å‰5è¡Œå®ƒå°±æ˜¯æœ€ä½³çš„5æ­¥è¿­ä»£ï¼Œä¿ç•™å‰6è¡Œå°±æ˜¯æœ€ä½³6æ­¥è¿­ä»£ï¼Œå¹¶ä¸”è¿‘ä¼¼ç¨‹åº¦æ˜¯æœ‰ä¿è¯åœ°ä¼˜äº5æ­¥è¿­ä»£ï¼Œä¾æ­¤ç±»æ¨ã€‚</p>
<p>è‡³äº$\mcsgn$ï¼Œå®ƒåªæ˜¯æŠŠ$\msign$çš„$\boldsymbol{M}^{\top}\boldsymbol{M}$æ¢æˆäº†$\boldsymbol{M}^2$ï¼Œæ‰€ä»¥ç†è®ºä¸Šä¹Ÿå¯ä»¥ç”¨Newton-Schulzè¿­ä»£ï¼Œä½†ç”±äºç‰¹å¾å€¼å¯ä»¥æ˜¯å¤æ•°ï¼Œå› æ­¤ä¸€èˆ¬çš„æ”¶æ•›ä¼šå›°éš¾å¾—å¤šã€‚ä¸è¿‡ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥å®ç°ç¡®è®¤çŸ©é˜µ$\boldsymbol{M}$çš„ç‰¹å¾å€¼éƒ½æ˜¯å®æ•°ï¼ˆæ¯”å¦‚æœ¬æ–‡åé¢è¦åº”ç”¨$\mcsgn$çš„åˆ†å—ä¸‰è§’çŸ©é˜µï¼‰ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¤ç”¨$\msign$çš„è¿­ä»£å’Œç³»æ•°ï¼š<br />
\begin{equation}\newcommand{tr}{\mathop{\text{tr}}}\boldsymbol{X}<em t_1="t+1">0 = \frac{\boldsymbol{M}}{\sqrt{\tr(\boldsymbol{M}^2)}},\qquad \boldsymbol{X}</em>} = a_{t+1}\boldsymbol{X<em t_1="t+1">t + b</em>}\boldsymbol{X<em t_1="t+1">t^3 + c</em>}\boldsymbol{X}_t^5\end{equation</p>
<h2 id="_3">æ¨å¯¼è¿‡ç¨‹</h2>
<p>ä¸‹é¢æ­£å¼è¿›å…¥ä¸»é¢˜â€”â€”æ±‚$\boldsymbol{O}=\msign(\boldsymbol{M})$çš„å¯¼æ•°ã€‚å¦‚æœè¯»è€…åªæ˜¯å°†Muonå½“æˆä¸€ä¸ªæ™®é€šä¼˜åŒ–å™¨ç”¨ï¼Œé‚£ä¹ˆæœ¬æ–‡å¤šåŠè·Ÿä½ æ— å…³äº†ã€‚å½“æˆ‘ä»¬éœ€è¦å‚è€ƒTTTï¼Œç”¨Muonä¼˜åŒ–å™¨æ¥æ„å»ºRNNæ¨¡å‹æ—¶ï¼Œæ‰éœ€è¦$\msign$çš„å¯¼æ•°ï¼Œæ­¤æ—¶$\msign$åœ¨æ¨¡å‹è¡¨ç°ä¸ºå‰å‘ä¼ æ’­ï¼Œè€Œè¦å¯¹æ•´ä¸ªæ¨¡å‹åå‘ä¼ æ’­ï¼Œè‡ªç„¶å°±æ¶‰åŠåˆ°äº†$\msign$çš„å¯¼æ•°ã€‚</p>
<p>ç”±äº$\msign$æ˜¯é€šè¿‡Newton-Schulzè¿­ä»£è®¡ç®—çš„ï¼Œå®é™…ä¸Šå®ƒå¯ä»¥ç›´æ¥åå‘ä¼ æ’­ï¼Œæ‰€ä»¥$\msign$çš„æ•°å€¼æ±‚å¯¼æœ¬èº«ä¸æ˜¯é—®é¢˜ï¼Œä½†åŸºäºè¿­ä»£åä¼ æ„å‘³ç€æœ‰å¾ˆå¤šä¸­é—´çŠ¶æ€è¦å­˜ï¼Œæ˜¾å­˜å¾€å¾€è¦çˆ†ç‚¸ï¼Œæ‰€ä»¥å¸Œæœ›èƒ½å¾—åˆ°å¯¼æ•°çš„è§£æè§£æ¥ç®€åŒ–ã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨<a href="/archives/10878">ã€ŠSVDçš„å¯¼æ•°ã€‹</a>ä¸­æˆ‘ä»¬å…¶å®ä¹Ÿæ±‚è¿‡$\msign$çš„å¯¼æ•°ï¼Œä½†é‚£æ˜¯åŸºäºSVDçš„è¡¨è¾¾å¼ï¼Œè€ŒSVDå¹¶ä¸æ˜¯GPUé«˜æ•ˆçš„ç®—æ³•ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯å¯»æ±‚ä¸€ä¸ªä¸ä¾èµ–äºSVDçš„ã€èƒ½å¤Ÿé«˜æ•ˆè®¡ç®—çš„ç»“æœã€‚æˆ‘ä»¬ä»æ’ç­‰å¼<br />
\begin{equation}\boldsymbol{M} = \boldsymbol{O}\boldsymbol{M}^{\top}\boldsymbol{O}\end{equation}<br />
å‡ºå‘ï¼ˆç”±$\msign$çš„å®šä¹‰å³å¯è¯æ˜ï¼‰ï¼Œä¸¤è¾¹å¾®åˆ†å¾—åˆ°<br />
\begin{equation}d\boldsymbol{M} = (d\boldsymbol{O})\boldsymbol{M}^{\top}\boldsymbol{O} + \boldsymbol{O}(d\boldsymbol{M}^{\top})\boldsymbol{O} + \boldsymbol{O}\boldsymbol{M}^{\top}(d\boldsymbol{O})\label{eq:dm-do}\end{equation}<br />
è¿™ä¸ªç»“æœçš„éš¾åº¦åœ¨äºæ— æ³•ç®€å•åœ°åˆ†ç¦»å‡º$d\boldsymbol{M}=f(d\boldsymbol{O})$æˆ–$d\boldsymbol{O}=f(d\boldsymbol{M})$çš„å½¢å¼ï¼Œå› æ­¤ä¸å¤§å¥½çœ‹å‡º$\nabla_{\boldsymbol{O}}\mathcal{L}$ä¸$\nabla_{\boldsymbol{W}}\mathcal{L}$çš„å…³ç³»ï¼ˆ$\mathcal{L}$æ˜¯æŸå¤±å‡½æ•°ï¼‰ã€‚è¿™ç§æƒ…å†µä¸‹æœ€å¥½çš„åŠæ³•æ˜¯å›å½’åˆ°çŸ©é˜µæ±‚å¯¼çš„æ ¹æœ¬æ€è·¯â€”â€”â€œè¿¹æŠ€å·§â€ï¼š</p>
<blockquote>
<p><strong>è¿¹æŠ€å·§ï¼ˆtrace trickï¼‰</strong> å¦‚æœæˆ‘ä»¬èƒ½æ‰¾åˆ°è·Ÿ$\boldsymbol{M}$åŒå½¢çŠ¶çš„çŸ©é˜µ$\boldsymbol{G}$æ»¡è¶³ \begin{equation}d\mathcal{L}=\langle \boldsymbol{G}, d\boldsymbol{M}\rangle_F = \tr(\boldsymbol{G}^{\top} (d\boldsymbol{M}))\end{equation} é‚£ä¹ˆ$\boldsymbol{G} = \nabla_{\boldsymbol{M}}\mathcal{L}$ã€‚</p>
</blockquote>
<p>è¿¹æŠ€å·§çš„è¦ä¹‰æ˜¯åŒ–çŸ©é˜µ/å‘é‡ä¸ºæ ‡é‡ï¼Œç„¶ååŒ–æ ‡é‡ä¸ºè¿¹ï¼Œç»§è€Œå¯ä»¥åˆ©ç”¨è¿¹çš„æ’ç­‰å¼ï¼š<br />
\begin{equation}\tr(\boldsymbol{A}\boldsymbol{B}) = \tr(\boldsymbol{B}\boldsymbol{A}) = \tr(\boldsymbol{A}^{\top}\boldsymbol{B}^{\top}) = \tr(\boldsymbol{B}^{\top}\boldsymbol{A}^{\top})\end{equation}<br />
ç°åœ¨è®¾$\boldsymbol{X}$æ˜¯ä»»æ„è·Ÿ$\boldsymbol{M}$åŒå½¢çŠ¶çŸ©é˜µï¼Œç»™å¼$\eqref{eq:dm-do}$ä¸¤è¾¹ä¹˜$\boldsymbol{X}^{\top}$ï¼Œç„¶åæ±‚è¿¹<br />
\begin{equation}\begin{aligned}<br />
\tr(\boldsymbol{X}^{\top}(d\boldsymbol{M})) =&amp;\, \tr(\boldsymbol{X}^{\top}(d\boldsymbol{O})\boldsymbol{M}^{\top}\boldsymbol{O}) + \tr(\boldsymbol{X}^{\top}\boldsymbol{O}(d\boldsymbol{M}^{\top})\boldsymbol{O}) + \tr(\boldsymbol{X}^{\top}\boldsymbol{O}\boldsymbol{M}^{\top}(d\boldsymbol{O})) \\\[7pt]<br />
=&amp;\, \tr(\boldsymbol{M}^{\top}\boldsymbol{O}\boldsymbol{X}^{\top}(d\boldsymbol{O})) + \tr(\boldsymbol{O}\boldsymbol{X}^{\top}\boldsymbol{O}(d\boldsymbol{M}^{\top})) + \tr(\boldsymbol{X}^{\top}\boldsymbol{O}\boldsymbol{M}^{\top}(d\boldsymbol{O})) \\\[7pt]<br />
=&amp;\, \tr(\boldsymbol{M}^{\top}\boldsymbol{O}\boldsymbol{X}^{\top}(d\boldsymbol{O})) + \tr(\boldsymbol{O}^{\top}\boldsymbol{X}\boldsymbol{O}^{\top}(d\boldsymbol{M})) + \tr(\boldsymbol{X}^{\top}\boldsymbol{O}\boldsymbol{M}^{\top}(d\boldsymbol{O})) \\\[7pt]<br />
\end{aligned}\end{equation}<br />
ç”±æ­¤å¯å¾—<br />
\begin{equation}\tr((\boldsymbol{X}^{\top} - \boldsymbol{O}^{\top}\boldsymbol{X}\boldsymbol{O}^{\top})(d\boldsymbol{M})) = \tr((\boldsymbol{M}^{\top}\boldsymbol{O}\boldsymbol{X}^{\top} + \boldsymbol{X}^{\top}\boldsymbol{O}\boldsymbol{M}^{\top})(d\boldsymbol{O}))\end{equation}<br />
å¦‚æœæˆ‘ä»¬è®©$\boldsymbol{M}^{\top}\boldsymbol{O}\boldsymbol{X}^{\top} + \boldsymbol{X}^{\top}\boldsymbol{O}\boldsymbol{M}^{\top}=(\nabla_{\boldsymbol{O}}\mathcal{L})^{\top}$ï¼Œé‚£ä¹ˆä¸Šå¼ä¾¿å…·æœ‰$d\mathcal{L}$çš„å«ä¹‰ï¼Œé‚£ä¹ˆæ ¹æ®è¿¹æŠ€å·§å°±æœ‰$\boldsymbol{X}^{\top} - \boldsymbol{O}^{\top}\boldsymbol{X}\boldsymbol{O}^{\top}=(\nabla_{\boldsymbol{M}}\mathcal{L})^{\top}$ï¼Œè¿™è¡¨æ˜$\nabla_{\boldsymbol{M}}\mathcal{L}$å’Œ$\nabla_{\boldsymbol{O}}\mathcal{L}$çš„å…³ç³»ï¼Œç”±ä¸‹è¿°æ–¹ç¨‹ç»„æè¿°<br />
\begin{gather}\boldsymbol{X} - \boldsymbol{O}\boldsymbol{X}^{\top}\boldsymbol{O} = \nabla_{\boldsymbol{M}}\mathcal{L} \label{eq:g-m}\\\[7pt]<br />
\boldsymbol{X}\boldsymbol{O}^{\top}\boldsymbol{M} + \boldsymbol{M}\boldsymbol{O}^{\top}\boldsymbol{X} = \nabla_{\boldsymbol{O}}\mathcal{L}\label{eq:g-o}\end{gather}</p>
<h2 id="_4">ç†è®ºå½¢å¼</h2>
<p>æ‰€ä»¥ï¼Œç°åœ¨é—®é¢˜å˜æˆäº†ï¼Œä»å¼$\eqref{eq:g-o}$ä¸­è§£å‡º$\boldsymbol{X}$ï¼Œç„¶åä»£å…¥å¼$\eqref{eq:g-m}$å¾—åˆ°$\nabla_{\boldsymbol{M}}\mathcal{L}$ï¼Œå³å°†$\nabla_{\boldsymbol{M}}\mathcal{L}$è¡¨ç¤ºä¸º$\nabla_{\boldsymbol{O}}\mathcal{L}$çš„å‡½æ•°ï¼Œé¿å…ç›´æ¥æ±‚$\nabla_{\boldsymbol{M}}\boldsymbol{O}$ã€‚å¾ˆæ˜æ˜¾ï¼Œå”¯ä¸€çš„éš¾åº¦å°±æ˜¯æ–¹ç¨‹$\eqref{eq:g-o}$çš„æ±‚è§£ã€‚</p>
<p>è¿™ä¸€èŠ‚æˆ‘ä»¬å…ˆåŸºäºSVDæ±‚ä¸€ä¸ªä¸é‚£ä¹ˆå®ç”¨çš„ç†è®ºè§£ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬äº†è§£æ–¹ç¨‹$\eqref{eq:g-o}$çš„æ€§è´¨ï¼Œå¹¶ä¸”è·Ÿä¹‹å‰çš„ç»“æœå¯¹é½ã€‚è®¾$\boldsymbol{X}=\boldsymbol{U}\boldsymbol{Y}\boldsymbol{V}^{\top}$ï¼Œç„¶åæˆ‘ä»¬è¿˜æœ‰$\boldsymbol{O}^{\top}\boldsymbol{M} = (\boldsymbol{M}^{\top}\boldsymbol{M})^{1/2} = \boldsymbol{V}(\boldsymbol{\Sigma}^{\top}\boldsymbol{\Sigma})^{1/2}\boldsymbol{V}^{\top}$å’Œ$\boldsymbol{M}\boldsymbol{O}^{\top}=(\boldsymbol{M}\boldsymbol{M}^{\top})^{1/2} = \boldsymbol{U}(\boldsymbol{\Sigma}\boldsymbol{\Sigma}^{\top})^{1/2}\boldsymbol{U}^{\top}$ï¼Œå°†è¿™äº›ç­‰å¼ä»£å…¥æ–¹ç¨‹$\eqref{eq:g-o}$å¾—åˆ°<br />
\begin{equation}\boldsymbol{U}\boldsymbol{Y}(\boldsymbol{\Sigma}^{\top}\boldsymbol{\Sigma})^{1/2}\boldsymbol{V}^{\top} + \boldsymbol{U}(\boldsymbol{\Sigma}\boldsymbol{\Sigma}^{\top})^{1/2}\boldsymbol{Y}\boldsymbol{V}^{\top} = \nabla_{\boldsymbol{O}}\mathcal{L}\end{equation}<br />
å³<br />
\begin{equation}\boldsymbol{Y}(\boldsymbol{\Sigma}^{\top}\boldsymbol{\Sigma})^{1/2} + (\boldsymbol{\Sigma}\boldsymbol{\Sigma}^{\top})^{1/2}\boldsymbol{Y} = \boldsymbol{U}^{\top}(\nabla_{\boldsymbol{O}}\mathcal{L})\boldsymbol{V}\label{eq:g-o-2}\end{equation}<br />
ä¸Šå¼å·¦ç«¯å¦‚æœå†™æˆåˆ†é‡å½¢å¼æ˜¯$\boldsymbol{Y}<em i_j="i,j">{i,j}\sigma_j + \sigma_i \boldsymbol{Y}</em>} = (\sigma_i + \sigma_j)\boldsymbol{Y<em r_1="r+1">{i,j}$ï¼Œå…¶ä¸­$\sigma_1,\sigma_2,\cdots,\sigma_r$æ˜¯$\boldsymbol{M}$çš„éé›¶å¥‡å¼‚å€¼ï¼Œè€Œ$0=\sigma</em>$æ˜¯æ»¡ç§©æ–¹é˜µæ—¶ï¼Œå¯ä»¥è§£å¾—}=\sigma_{r+2}=\cdots$ã€‚å¾ˆæ˜æ˜¾ï¼Œå¦‚æœå½“$\boldsymbol{M<br />
\begin{equation}\boldsymbol{Y} = (\boldsymbol{U}^{\top}(\nabla_{\boldsymbol{O}}\mathcal{L})\boldsymbol{V}) \oslash \boldsymbol{S}\end{equation}<br />
å…¶ä¸­$\boldsymbol{S}_{i,j} = \sigma_i+\sigma_j$ï¼Œ$\oslash$æ˜¯Hadamardé™¤ï¼ˆé€ä½ç›¸é™¤ï¼‰ã€‚è¿™æ—¶å€™æˆ‘ä»¬å°†$\boldsymbol{X}=\boldsymbol{U}\boldsymbol{Y}\boldsymbol{V}^{\top}$ä»£å…¥å¼$\eqref{eq:g-m}$ï¼Œå°±å¾—åˆ°è·Ÿ<a href="/archives/10878">ã€ŠSVDçš„å¯¼æ•°ã€‹</a>é‡Œè¾¹ä¸€è‡´çš„ç»“æœã€‚è¿™ä¸ªæ®Šé€”åŒå½’ä¹Ÿå¢å¼ºäº†æˆ‘ä»¬çš„ä¿¡å¿ƒï¼Œçœ‹æ¥è‡³å°‘åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬çš„æ¨å¯¼éƒ½è¿˜æ˜¯æ­£ç¡®çš„ã€‚</p>
<p>è‹¥$\boldsymbol{M}$ä¸æ»¡ç§©æˆ–ä¸æ˜¯æ–¹é˜µå‘¢ï¼Ÿæ­¤æ—¶å¦‚æœå³ç«¯çš„$\boldsymbol{U}^{\top}(\nabla_{\boldsymbol{O}}\mathcal{L})\boldsymbol{V}$â€œä¸é…åˆâ€ï¼Œé‚£ä¹ˆæ–¹ç¨‹$\eqref{eq:g-o-2}$æ— è§£ã€‚ä½†æ–¹ç¨‹$\eqref{eq:g-o-2}$æ˜¯ä»å®é™…é—®é¢˜å¾—åˆ°çš„ï¼Œæ‰€ä»¥å®ƒè‚¯å®šæœ‰è§£ï¼Œé‚£ä¹ˆå³ç«¯â€œå¿…é¡»é…åˆâ€ï¼æ€æ ·æ‰æ˜¯é…åˆå‘¢ï¼Ÿå¦‚æœ$\boldsymbol{M}$çš„ç§©ä¸º$r$ï¼Œé‚£ä¹ˆçŸ©é˜µ$\boldsymbol{S}$åªæœ‰$\boldsymbol{S}<em _boldsymbol_O="\boldsymbol{O">{[:r,:r]}$æ˜¯éé›¶çš„ï¼Œä¸ºäº†ä½¿å¾—æ–¹ç¨‹$\eqref{eq:g-o-2}$æœ‰è§£ï¼Œ$(\boldsymbol{U}^{\top}(\nabla</em>)}}\mathcal{L})\boldsymbol{V<em 0="0" _epsilon_to="\epsilon\to">{[:r,:r]}$ä»¥å¤–çš„éƒ¨åˆ†åªèƒ½æ˜¯é›¶ã€‚åœ¨è¿™ä¸ªæ¡ä»¶ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡º<br />
\begin{equation}\boldsymbol{Y} = \lim</em>}\,\, (\boldsymbol{U}^{\top}(\nabla_{\boldsymbol{O}}\mathcal{L})\boldsymbol{V}) \oslash (\boldsymbol{S} + \epsilon) \end{equation<br />
è¿™ç›¸å½“äºè¯´ï¼Œæˆ‘ä»¬å¯ä»¥ç»™å¥‡å¼‚å€¼åŠ äº›æ‰°åŠ¨ï¼Œè½¬åŒ–ä¸ºå…¨ä½“å¥‡å¼‚å€¼éé›¶çš„æƒ…å†µï¼Œè®¡ç®—å®Œæˆåå†è®©æ‰°åŠ¨è¶‹äºé›¶ï¼Œä»è€Œå¾—åˆ°æ­£ç¡®çš„ç»“æœã€‚</p>
<h2 id="_5">é«˜æ•ˆæ±‚è§£</h2>
<p>ä¸Šä¸€èŠ‚çš„SVDè§£å¾€å¾€åªæœ‰ç†è®ºä»·å€¼ï¼Œä¸ºäº†åœ¨GPUä¸­é«˜æ•ˆè®¡ç®—ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯»æ±‚å…¶ä»–å½¢å¼çš„è§£ã€‚å¼•å…¥è®°å·$\boldsymbol{M}\boldsymbol{O}^{\top}=\boldsymbol{A},\boldsymbol{O}^{\top}\boldsymbol{M}=\boldsymbol{B},\nabla_{\boldsymbol{O}}\mathcal{L}=\boldsymbol{C}$ï¼Œé‚£ä¹ˆå¼$\eqref{eq:g-o}$å®é™…ä¸Šæ˜¯ä¸€ä¸ª<a href="https://en.wikipedia.org/wiki/Sylvester_equation">Sylvesteræ–¹ç¨‹</a>ï¼š<br />
\begin{equation}\boldsymbol{A}\boldsymbol{X}+\boldsymbol{X}\boldsymbol{B} = \boldsymbol{C}\end{equation}<br />
æ±‚è§£Sylvesteræ–¹ç¨‹çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œå…¶ä¸­æœ€ç²¾å¦™ã€å¯¹GPUæœ€é«˜æ•ˆçš„ï¼Œå¯èƒ½æ˜¯åŸºäº$\mcsgn$ï¼ˆä¸æ˜¯$\msign$ï¼‰çš„æ±‚è§£æ–¹æ¡ˆï¼ˆè¿™é‡Œå‚è€ƒäº†<a href="https://papers.cool/arxiv/2201.08663">ã€ŠFast Differentiable Matrix Square Rootã€‹</a>ï¼‰ã€‚é¦–å…ˆï¼Œä»ä¸Šè¿°æ–¹ç¨‹å‡ºå‘ï¼Œæˆ‘ä»¬å¯ä»¥éªŒè¯ä¸‹å¼æˆç«‹<br />
\begin{equation}\begin{bmatrix} \boldsymbol{A} &amp; -\boldsymbol{C} \\\ \boldsymbol{0} &amp; -\boldsymbol{B}\end{bmatrix} = \begin{bmatrix} \boldsymbol{I} &amp; \boldsymbol{X} \\\ \boldsymbol{0} &amp; \boldsymbol{I}\end{bmatrix}\begin{bmatrix} \boldsymbol{A} &amp; \boldsymbol{0} \\\ \boldsymbol{0} &amp; -\boldsymbol{B}\end{bmatrix}\begin{bmatrix} \boldsymbol{I} &amp; \boldsymbol{X} \\\ \boldsymbol{0} &amp; \boldsymbol{I}\end{bmatrix}^{-1}<br />
\end{equation}<br />
ä¸¤è¾¹å–$\mcsgn$ï¼Œæ ¹æ®$\mcsgn$çš„æ€§è´¨ï¼Œæˆ‘ä»¬æœ‰<br />
\begin{equation}\mcsgn\left(\begin{bmatrix} \boldsymbol{A} &amp; -\boldsymbol{C} \\\ \boldsymbol{0} &amp; -\boldsymbol{B}\end{bmatrix}\right) = \begin{bmatrix} \boldsymbol{I} &amp; \boldsymbol{X} \\\ \boldsymbol{0} &amp; \boldsymbol{I}\end{bmatrix}\begin{bmatrix} \mcsgn(\boldsymbol{A}) &amp; \boldsymbol{0} \\\ \boldsymbol{0} &amp; -\mcsgn(\boldsymbol{B})\end{bmatrix}\begin{bmatrix} \boldsymbol{I} &amp; \boldsymbol{X} \\\ \boldsymbol{0} &amp; \boldsymbol{I}\end{bmatrix}^{-1}<br />
\end{equation}<br />
æ³¨æ„$\boldsymbol{A}=\boldsymbol{M}\boldsymbol{O}^{\top}=(\boldsymbol{M}\boldsymbol{M}^{\top})^{1/2}, \boldsymbol{B}=\boldsymbol{O}^{\top}\boldsymbol{M}=(\boldsymbol{M}^{\top}\boldsymbol{M})^{1/2}$ï¼Œå‡è®¾$\boldsymbol{M}$æ˜¯æ»¡ç§©æ–¹é˜µï¼Œé‚£ä¹ˆ$\boldsymbol{A},\boldsymbol{B}$éƒ½æ˜¯æ­£å®šå¯¹ç§°çš„ï¼Œæ­£å®šå¯¹ç§°çŸ©é˜µçš„$\mcsgn$éƒ½æ˜¯æ–¹é˜µï¼Œæ‰€ä»¥<br />
\begin{equation}\mcsgn\left(\begin{bmatrix} \boldsymbol{A} &amp; -\boldsymbol{C} \\\ \boldsymbol{0} &amp; -\boldsymbol{B}\end{bmatrix}\right) = \begin{bmatrix} \boldsymbol{I} &amp; \boldsymbol{X} \\\ \boldsymbol{0} &amp; \boldsymbol{I}\end{bmatrix}\begin{bmatrix} \boldsymbol{I} &amp; \boldsymbol{0} \\\ \boldsymbol{0} &amp; -\boldsymbol{I}\end{bmatrix}\begin{bmatrix} \boldsymbol{I} &amp; \boldsymbol{X} \\\ \boldsymbol{0} &amp; \boldsymbol{I}\end{bmatrix}^{-1} = \begin{bmatrix} \boldsymbol{I} &amp; -2\boldsymbol{X} \\\ \boldsymbol{0} &amp; -\boldsymbol{I}\end{bmatrix}<br />
\end{equation}<br />
æœ€åçš„åŒ–ç®€ç”¨åˆ°äº†ç­‰å¼$\begin{bmatrix} \boldsymbol{I} &amp; \boldsymbol{X} \\\ \boldsymbol{0} &amp; \boldsymbol{I}\end{bmatrix}^{-1}=\begin{bmatrix} \boldsymbol{I} &amp; -\boldsymbol{X} \\\ \boldsymbol{0} &amp; \boldsymbol{I}\end{bmatrix}$ã€‚ä»è¯¥ç»“æœå¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬åªéœ€è¦å¯¹åˆ†å—çŸ©é˜µ$\begin{bmatrix} \boldsymbol{A} &amp; -\boldsymbol{C} \\\ \boldsymbol{0} &amp; -\boldsymbol{B}\end{bmatrix}$ç®—$\mcsgn$ï¼Œç„¶åå°±å¯ä»¥ä»ç»“æœçš„å³ä¸Šè§’è¯»å‡º$\boldsymbol{X}$ã€‚$\mcsgn$å¯ä»¥é€šè¿‡Newton-Schulzè¿­ä»£é«˜æ•ˆåœ°è®¡ç®—ï¼Œå› æ­¤è¯¥æ–¹æ¡ˆæ˜¯GPUå‹å¥½çš„ã€‚</p>
<p>å½“$\boldsymbol{M}$ä¸æ»¡ç§©æˆ–éæ–¹é˜µæ—¶ï¼Œ$\boldsymbol{A},\boldsymbol{B}$åªæ˜¯åŠæ­£å®šçš„ï¼Œè¿™æ—¶å€™å®ƒä»¬å°±$\mcsgn$å°±ä¸æ˜¯$\boldsymbol{I}$ã€‚ä¸è¿‡ï¼Œä¸Šä¸€èŠ‚çš„ç»éªŒå‘Šè¯‰æˆ‘ä»¬ï¼Œç”±äº$\nabla_{\boldsymbol{O}}\mathcal{L}$â€œå¿…é¡»é…åˆâ€ï¼Œæ‰€ä»¥åªéœ€è¦ç»™$\boldsymbol{\Sigma}$åŠ ç‚¹æ‰°åŠ¨ï¼Œè®©å®ƒå˜æˆæ­£å®šçš„æƒ…å†µå³å¯è§£ã€‚è¿™é‡Œç»™$\boldsymbol{\Sigma}$åŠ æ‰°åŠ¨ï¼Œç›¸å½“äºç»™$\boldsymbol{A},\boldsymbol{B}$åŠ $\epsilon \boldsymbol{I}$ï¼Œæ‰€ä»¥<br />
\begin{equation}\boldsymbol{X} = -\frac{1}{2} \left(\lim_{\epsilon\to 0}\,\, \mcsgn\left(\begin{bmatrix} \boldsymbol{A} + \epsilon \boldsymbol{I} &amp; -\boldsymbol{C} \\\ \boldsymbol{0} &amp; -\boldsymbol{B} - \epsilon \boldsymbol{I}\end{bmatrix}\right)\right)_{[:n,n:]}<br />
\end{equation}<br />
å®é™…è®¡ç®—æ—¶ï¼Œå°±åªèƒ½é€‰æ‹©ä¸€ä¸ªæ¯”è¾ƒå°çš„$\epsilon &gt; 0$æ¥è¿‘ä¼¼è®¡ç®—äº†ï¼Œå¯ä»¥è€ƒè™‘$\epsilon=10^{-3}$ï¼Œå®ƒåœ¨æˆ‘ä»¬ä¹‹å‰å¯»æ‰¾Newton-Schulzè¿­ä»£çš„ä¸‹ç•ŒèŒƒå›´å†…ã€‚</p>
<h2 id="_6">è¯¦ç»†æ•°å­¦æ¨å¯¼</h2>
<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»å¤šä¸ªè§’åº¦æ·±å…¥æ¢è®¨$\msign$ç®—å­çš„å¯¼æ•°ç†è®ºï¼ŒåŒ…æ‹¬FrÃ©chetå¯¼æ•°çš„ä¸¥æ ¼å®šä¹‰ã€åŸºäºLyapunovæ–¹ç¨‹çš„æ¨å¯¼ã€ç§¯åˆ†è¡¨ç¤ºã€æ•°å€¼è®¡ç®—æ–¹æ³•ä»¥åŠåœ¨æ·±åº¦å­¦ä¹ ä¸­çš„å®é™…åº”ç”¨ã€‚</p>
<h3 id="frechet">FrÃ©chetå¯¼æ•°çš„å®šä¹‰ä¸æ€§è´¨</h3>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸¥æ ¼å®šä¹‰çŸ©é˜µå‡½æ•°çš„å¯¼æ•°ã€‚å¯¹äºä»$\mathbb{R}^{n\times m}$åˆ°$\mathbb{R}^{p\times q}$çš„æ˜ å°„$F$ï¼Œå…¶<strong>FrÃ©chetå¯¼æ•°</strong>ï¼ˆæˆ–æ–¹å‘å¯¼æ•°ï¼‰å®šä¹‰å¦‚ä¸‹ï¼š</p>
<p><strong>å®šä¹‰1ï¼ˆFrÃ©chetå¯¼æ•°ï¼‰</strong>ï¼šè®¾$F: \mathbb{R}^{n\times m} \to \mathbb{R}^{p\times q}$æ˜¯çŸ©é˜µå‡½æ•°ï¼Œå¦‚æœå­˜åœ¨çº¿æ€§ç®—å­$\mathcal{D}F(\boldsymbol{M}): \mathbb{R}^{n\times m} \to \mathbb{R}^{p\times q}$ä½¿å¾—
\begin{equation}
F(\boldsymbol{M} + \boldsymbol{H}) = F(\boldsymbol{M}) + \mathcal{D}F(\boldsymbol{M})[\boldsymbol{H}] + o(\Vert\boldsymbol{H}\Vert_F)
\end{equation}
å…¶ä¸­$\lim_{\Vert\boldsymbol{H}\Vert_F\to 0} \frac{\Vert o(\Vert\boldsymbol{H}\Vert_F)\Vert_F}{\Vert\boldsymbol{H}\Vert_F} = 0$ï¼Œåˆ™ç§°$\mathcal{D}F(\boldsymbol{M})$ä¸º$F$åœ¨$\boldsymbol{M}$å¤„çš„FrÃ©chetå¯¼æ•°ã€‚</p>
<p>å¯¹äºæˆ‘ä»¬çš„æƒ…å†µï¼Œ$F(\boldsymbol{M}) = \msign(\boldsymbol{M})$ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°$\mathcal{D}<a href="\boldsymbol{M}">\msign</a>[\boldsymbol{H}]$ï¼Œå³å½“$\boldsymbol{M}$æœ‰ä¸€ä¸ªå¾®å°æ‰°åŠ¨$\boldsymbol{H}$æ—¶ï¼Œ$\msign(\boldsymbol{M})$çš„å˜åŒ–ã€‚</p>
<p><strong>æ€§è´¨1ï¼ˆé“¾å¼æ³•åˆ™ï¼‰</strong>ï¼šå¦‚æœ$F = G \circ H$ï¼Œåˆ™
\begin{equation}
\mathcal{D}F(\boldsymbol{M})[\boldsymbol{H}] = \mathcal{D}G(H(\boldsymbol{M}))[\mathcal{D}H(\boldsymbol{M})[\boldsymbol{H}]]
\end{equation}</p>
<p><strong>æ€§è´¨2ï¼ˆçº¿æ€§æ€§ï¼‰</strong>ï¼šFrÃ©chetå¯¼æ•°å…³äºæ‰°åŠ¨$\boldsymbol{H}$æ˜¯çº¿æ€§çš„ï¼Œå³
\begin{equation}
\mathcal{D}F(\boldsymbol{M})[\alpha\boldsymbol{H}_1 + \beta\boldsymbol{H}_2] = \alpha\mathcal{D}F(\boldsymbol{M})[\boldsymbol{H}_1] + \beta\mathcal{D}F(\boldsymbol{M})[\boldsymbol{H}_2]
\end{equation}</p>
<p><strong>æ€§è´¨3ï¼ˆä¹˜ç§¯æ³•åˆ™ï¼‰</strong>ï¼šå¦‚æœ$F(\boldsymbol{M}) = \boldsymbol{A}(\boldsymbol{M})\boldsymbol{B}(\boldsymbol{M})$ï¼Œåˆ™
\begin{equation}
\mathcal{D}F(\boldsymbol{M})[\boldsymbol{H}] = \mathcal{D}\boldsymbol{A}(\boldsymbol{M})[\boldsymbol{H}]\cdot\boldsymbol{B}(\boldsymbol{M}) + \boldsymbol{A}(\boldsymbol{M})\cdot\mathcal{D}\boldsymbol{B}(\boldsymbol{M})[\boldsymbol{H}]
\end{equation}</p>
<h3 id="msignfrechet">msignçš„FrÃ©chetå¯¼æ•°æ˜¾å¼å…¬å¼</h3>
<p>ç°åœ¨æˆ‘ä»¬æ¨å¯¼$\msign$çš„FrÃ©chetå¯¼æ•°ã€‚è®°$\boldsymbol{O} = \msign(\boldsymbol{M})$ï¼Œä»æ’ç­‰å¼
\begin{equation}
\boldsymbol{M} = \boldsymbol{O}\boldsymbol{M}^{\top}\boldsymbol{O}
\end{equation}
å‡ºå‘ï¼Œå¯¹ä¸¤è¾¹å–FrÃ©chetå¯¼æ•°ï¼ˆä½¿ç”¨ä¹˜ç§¯æ³•åˆ™ï¼‰ï¼š
\begin{equation}
\boldsymbol{H} = \mathcal{D}\boldsymbol{O}[\boldsymbol{H}]\cdot\boldsymbol{M}^{\top}\boldsymbol{O} + \boldsymbol{O}\cdot\boldsymbol{H}^{\top}\cdot\boldsymbol{O} + \boldsymbol{O}\cdot\boldsymbol{M}^{\top}\cdot\mathcal{D}\boldsymbol{O}[\boldsymbol{H}]
\end{equation}</p>
<p>è®°$d\boldsymbol{O} = \mathcal{D}\boldsymbol{O}[\boldsymbol{H}]$ä¸º$\boldsymbol{O}$åœ¨æ–¹å‘$\boldsymbol{H}$ä¸Šçš„å¯¼æ•°ï¼Œæˆ‘ä»¬æœ‰
\begin{equation}
\boldsymbol{H} = (d\boldsymbol{O})\boldsymbol{M}^{\top}\boldsymbol{O} + \boldsymbol{O}\boldsymbol{H}^{\top}\boldsymbol{O} + \boldsymbol{O}\boldsymbol{M}^{\top}(d\boldsymbol{O})
\end{equation}</p>
<p>å®šä¹‰ç®—å­$\mathcal{L}: \mathbb{R}^{n\times m} \to \mathbb{R}^{n\times m}$ä¸º
\begin{equation}
\mathcal{L}(\boldsymbol{X}) = \boldsymbol{X}\boldsymbol{M}^{\top}\boldsymbol{O} + \boldsymbol{O}\boldsymbol{M}^{\top}\boldsymbol{X}
\end{equation}</p>
<p>åˆ™æˆ‘ä»¬çš„å¯¼æ•°æ–¹ç¨‹å¯ä»¥å†™æˆç®—å­æ–¹ç¨‹çš„å½¢å¼ï¼š
\begin{equation}
\mathcal{L}(d\boldsymbol{O}) = \boldsymbol{H} - \boldsymbol{O}\boldsymbol{H}^{\top}\boldsymbol{O}
\end{equation}</p>
<p>å› æ­¤ï¼Œ$\msign$çš„FrÃ©chetå¯¼æ•°çš„<strong>æ˜¾å¼å…¬å¼</strong>ä¸ºï¼š
\begin{equation}
\mathcal{D}<a href="\boldsymbol{M}">\msign</a>[\boldsymbol{H}] = \mathcal{L}^{-1}(\boldsymbol{H} - \boldsymbol{O}\boldsymbol{H}^{\top}\boldsymbol{O})
\end{equation}</p>
<p>å…¶ä¸­$\mathcal{L}^{-1}$æ˜¯ç®—å­$\mathcal{L}$çš„é€†ã€‚</p>
<h3 id="lyapunov">åŸºäºLyapunovæ–¹ç¨‹çš„æ¨å¯¼</h3>
<p>æ³¨æ„åˆ°ç®—å­$\mathcal{L}$å®šä¹‰çš„æ–¹ç¨‹å®é™…ä¸Šæ˜¯ä¸€ä¸ª<strong>è¿ç»­æ—¶é—´Lyapunovæ–¹ç¨‹</strong>çš„ç‰¹æ®Šå½¢å¼ã€‚æ ‡å‡†çš„Lyapunovæ–¹ç¨‹ä¸ºï¼š
\begin{equation}
\boldsymbol{A}\boldsymbol{X} + \boldsymbol{X}\boldsymbol{B} = \boldsymbol{C}
\end{equation}</p>
<p>åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œä»¤$\boldsymbol{A} = \boldsymbol{M}\boldsymbol{O}^{\top}, \boldsymbol{B} = \boldsymbol{O}^{\top}\boldsymbol{M}$ï¼ˆæ³¨æ„è¿™é‡Œæ˜¯è½¬ç½®ï¼‰ï¼Œ$\boldsymbol{X} = d\boldsymbol{O}$ï¼Œ$\boldsymbol{C} = \boldsymbol{H} - \boldsymbol{O}\boldsymbol{H}^{\top}\boldsymbol{O}$ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¯¼æ•°æ–¹ç¨‹æ”¹å†™ä¸ºï¼š
\begin{equation}
\boldsymbol{M}\boldsymbol{O}^{\top}(d\boldsymbol{O}) + (d\boldsymbol{O})\boldsymbol{O}^{\top}\boldsymbol{M} = \boldsymbol{H} - \boldsymbol{O}\boldsymbol{H}^{\top}\boldsymbol{O}
\end{equation}</p>
<p>è¿™æ­£æ˜¯Sylvesteræ–¹ç¨‹çš„å½¢å¼ã€‚æˆ‘ä»¬çŸ¥é“$\boldsymbol{A} = \boldsymbol{M}\boldsymbol{O}^{\top} = (\boldsymbol{M}\boldsymbol{M}^{\top})^{1/2}$å’Œ$\boldsymbol{B} = \boldsymbol{O}^{\top}\boldsymbol{M} = (\boldsymbol{M}^{\top}\boldsymbol{M})^{1/2}$éƒ½æ˜¯åŠæ­£å®šçŸ©é˜µã€‚</p>
<p><strong>å®šç†1ï¼ˆLyapunovæ–¹ç¨‹å¯è§£æ€§ï¼‰</strong>ï¼šå¦‚æœ$\boldsymbol{A}$å’Œ$\boldsymbol{B}$çš„ç‰¹å¾å€¼æ»¡è¶³$\lambda_i(\boldsymbol{A}) + \lambda_j(\boldsymbol{B}) \neq 0$å¯¹æ‰€æœ‰$i,j$æˆç«‹ï¼Œåˆ™Lyapunovæ–¹ç¨‹$\boldsymbol{A}\boldsymbol{X} + \boldsymbol{X}\boldsymbol{B} = \boldsymbol{C}$æœ‰å”¯ä¸€è§£ã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œ$\boldsymbol{A}$å’Œ$\boldsymbol{B}$çš„ç‰¹å¾å€¼éƒ½æ˜¯éè´Ÿçš„ï¼ˆå®ƒä»¬æ˜¯å¹³æ–¹æ ¹çŸ©é˜µçš„ç‰¹å¾å€¼ï¼‰ï¼Œå› æ­¤$\lambda_i(\boldsymbol{A}) + \lambda_j(\boldsymbol{B}) \geq 0$ã€‚åªæœ‰å½“$\boldsymbol{M}$çš„æŸäº›å¥‡å¼‚å€¼ä¸ºé›¶æ—¶ï¼Œå’Œæ‰å¯èƒ½ä¸ºé›¶ã€‚</p>
<p><strong>å¼•ç†1</strong>ï¼šå½“$\boldsymbol{M}$æ»¡ç§©æ—¶ï¼ŒLyapunovæ–¹ç¨‹æœ‰å”¯ä¸€è§£ã€‚å½“$\boldsymbol{M}$ä¸æ»¡ç§©æ—¶ï¼Œæ–¹ç¨‹æœ‰è§£å½“ä¸”ä»…å½“$\boldsymbol{C}$æ»¡è¶³ç›¸å®¹æ€§æ¡ä»¶ã€‚</p>
<p>ç›¸å®¹æ€§æ¡ä»¶å¯ä»¥é€šè¿‡SVDåˆ†æå¾—åˆ°ã€‚è®¾$\boldsymbol{M} = \boldsymbol{U}\boldsymbol{\Sigma}\boldsymbol{V}^{\top}$ï¼Œç§©ä¸º$r$ï¼Œåˆ™
\begin{equation}
\boldsymbol{A} = \boldsymbol{U}\boldsymbol{\Sigma}^{1/2}<em ext="ext">{ext}\boldsymbol{U}^{\top}, \quad \boldsymbol{B} = \boldsymbol{V}\boldsymbol{\Sigma}^{1/2}</em>
\end{equation}
å…¶ä¸­$\boldsymbol{\Sigma}_{ext}$æ˜¯æ‰©å±•çš„å¯¹è§’çŸ©é˜µï¼Œä¿æŒå‰$r$ä¸ªå¥‡å¼‚å€¼ï¼Œå…¶ä½™ä¸ºé›¶ã€‚}\boldsymbol{V}^{\top</p>
<p>å°†$d\boldsymbol{O} = \boldsymbol{U}\boldsymbol{Y}\boldsymbol{V}^{\top}$ä»£å…¥Lyapunovæ–¹ç¨‹ï¼Œå¾—åˆ°
\begin{equation}
\boldsymbol{U}\boldsymbol{\Sigma}^{1/2}<em ext="ext">{ext}\boldsymbol{U}^{\top}\boldsymbol{U}\boldsymbol{Y}\boldsymbol{V}^{\top} + \boldsymbol{U}\boldsymbol{Y}\boldsymbol{V}^{\top}\boldsymbol{V}\boldsymbol{\Sigma}^{1/2}</em>
\end{equation}}\boldsymbol{V}^{\top} = \boldsymbol{C</p>
<p>ç®€åŒ–åå¾—åˆ°
\begin{equation}
\boldsymbol{\Sigma}^{1/2}<em ext="ext">{ext}\boldsymbol{Y} + \boldsymbol{Y}\boldsymbol{\Sigma}^{1/2}</em>
\end{equation}} = \boldsymbol{U}^{\top}\boldsymbol{C}\boldsymbol{V</p>
<p>å†™æˆåˆ†é‡å½¢å¼ï¼š
\begin{equation}
(\sigma_i^{1/2} + \sigma_j^{1/2})\boldsymbol{Y}<em ij="ij">{ij} = [\boldsymbol{U}^{\top}\boldsymbol{C}\boldsymbol{V}]</em>
\end{equation}</p>
<p>å› æ­¤ï¼Œè§£ä¸º
\begin{equation}
\boldsymbol{Y}<em ij="ij">{ij} = \begin{cases}
\frac{[\boldsymbol{U}^{\top}\boldsymbol{C}\boldsymbol{V}]</em> i,j \leq r \
0 &amp; \text{otherwise}
\end{cases}
\end{equation}}}{\sigma_i^{1/2} + \sigma_j^{1/2}} &amp; \text{if </p>
<p>ç›¸å®¹æ€§æ¡ä»¶å°±æ˜¯ï¼šå½“$i &gt; r$æˆ–$j &gt; r$æ—¶ï¼Œ$[\boldsymbol{U}^{\top}\boldsymbol{C}\boldsymbol{V}]_{ij} = 0$ã€‚</p>
<h3 id="_7">åŸºäºç§¯åˆ†è¡¨ç¤ºçš„æ¨å¯¼</h3>
<p>é™¤äº†ä»£æ•°æ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä»ç§¯åˆ†è¡¨ç¤ºçš„è§’åº¦ç†è§£$\msign$çš„å¯¼æ•°ã€‚è€ƒè™‘çŸ©é˜µç¬¦å·å‡½æ•°çš„<strong>Cauchyç§¯åˆ†è¡¨ç¤º</strong>ï¼š</p>
<p>å¯¹äºå¯å¯¹è§’åŒ–çš„çŸ©é˜µ$\boldsymbol{M}$ï¼ˆç‰¹å¾å€¼ä¸åœ¨è´Ÿå®è½´ä¸Šï¼‰ï¼Œç¬¦å·å‡½æ•°å¯ä»¥è¡¨ç¤ºä¸º
\begin{equation}
\text{sign}(\boldsymbol{M}) = \frac{1}{2\pi i}\oint_{\Gamma} \text{sign}(z)(\boldsymbol{M} - z\boldsymbol{I})^{-1}dz
\end{equation}</p>
<p>å…¶ä¸­$\Gamma$æ˜¯åŒ…å›´$\boldsymbol{M}$æ‰€æœ‰ç‰¹å¾å€¼çš„é—­åˆè·¯å¾„ã€‚</p>
<p>å¯¹äº$\msign$ï¼Œæˆ‘ä»¬æœ‰ç±»ä¼¼çš„è¡¨ç¤ºã€‚è®¾$\boldsymbol{M} = \boldsymbol{U}\boldsymbol{\Sigma}\boldsymbol{V}^{\top}$ï¼Œå®šä¹‰
\begin{equation}
\msign(\boldsymbol{M}) = \boldsymbol{U}\text{sign}(\boldsymbol{\Sigma})\boldsymbol{V}^{\top}
\end{equation}</p>
<p>å…¶ä¸­$\text{sign}(\boldsymbol{\Sigma})$å¯¹å¯¹è§’å…ƒç´ é€ä¸ªåº”ç”¨ç¬¦å·å‡½æ•°ï¼ˆæ­£æ•°å˜1ï¼Œè´Ÿæ•°å˜-1ï¼Œé›¶ä¿æŒä¸ºé›¶ï¼‰ã€‚</p>
<p>æ›´ä¸€èˆ¬åœ°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>è°±åˆ†è§£</strong>æ¥è¡¨ç¤º$\msign$ï¼š
\begin{equation}
\msign(\boldsymbol{M}) = \sum_{i=1}^{r} \boldsymbol{u}_i\boldsymbol{v}_i^{\top}
\end{equation}</p>
<p>å…¶ä¸­$\boldsymbol{u}_i, \boldsymbol{v}_i$æ˜¯å¯¹åº”éé›¶å¥‡å¼‚å€¼çš„å·¦å³å¥‡å¼‚å‘é‡ã€‚</p>
<p>è¿™ä¸ªè¡¨ç¤ºçš„å¯¼æ•°å¯ä»¥é€šè¿‡å¯¹æ¯ä¸€é¡¹æ±‚å¯¼å¾—åˆ°ï¼š
\begin{equation}
\mathcal{D}<a href="\boldsymbol{M}">\msign</a>[\boldsymbol{H}] = \sum_{i=1}^{r} \left(\mathcal{D}\boldsymbol{u}_i[\boldsymbol{H}]\boldsymbol{v}_i^{\top} + \boldsymbol{u}_i\mathcal{D}\boldsymbol{v}_i[\boldsymbol{H}]^{\top}\right)
\end{equation}</p>
<p>å¥‡å¼‚å‘é‡çš„å¯¼æ•°å¯ä»¥é€šè¿‡æ‰°åŠ¨ç†è®ºå¾—åˆ°ã€‚å¯¹äº$\boldsymbol{M}\boldsymbol{v}_i = \sigma_i\boldsymbol{u}_i$ï¼Œæ‰°åŠ¨åæˆ‘ä»¬æœ‰
\begin{equation}
(\boldsymbol{M} + \boldsymbol{H})(\boldsymbol{v}_i + \delta\boldsymbol{v}_i) = (\sigma_i + \delta\sigma_i)(\boldsymbol{u}_i + \delta\boldsymbol{u}_i)
\end{equation}</p>
<p>å¿½ç•¥é«˜é˜¶é¡¹ï¼Œå¾—åˆ°
\begin{equation}
\boldsymbol{M}\delta\boldsymbol{v}_i + \boldsymbol{H}\boldsymbol{v}_i = \sigma_i\delta\boldsymbol{u}_i + \delta\sigma_i\boldsymbol{u}_i
\end{equation}</p>
<p>å·¦ä¹˜$\boldsymbol{u}_i^{\top}$ï¼Œåˆ©ç”¨$\boldsymbol{u}_i^{\top}\boldsymbol{M}\delta\boldsymbol{v}_i = \sigma_i\boldsymbol{u}_i^{\top}\delta\boldsymbol{v}_i$å’Œæ­£äº¤æ€§æ¡ä»¶$\boldsymbol{u}_i^{\top}\delta\boldsymbol{u}_i = 0$ï¼Œå¾—åˆ°
\begin{equation}
\delta\sigma_i = \boldsymbol{u}_i^{\top}\boldsymbol{H}\boldsymbol{v}_i
\end{equation}</p>
<p>è¿™ç»™å‡ºäº†å¥‡å¼‚å€¼çš„ä¸€é˜¶æ‰°åŠ¨å…¬å¼ã€‚</p>
<p>å¯¹äºå¥‡å¼‚å‘é‡çš„æ‰°åŠ¨ï¼Œæˆ‘ä»¬æœ‰
\begin{equation}
\delta\boldsymbol{u}<em i="i" j_neq="j\neq">i = \sum</em>}\frac{\boldsymbol{u<em i="i" j_neq="j\neq">j^{\top}\boldsymbol{H}\boldsymbol{v}_i}{\sigma_i - \sigma_j}\boldsymbol{u}_j
\end{equation}
\begin{equation}
\delta\boldsymbol{v}_i = \sum</em>_j
\end{equation}}\frac{\boldsymbol{u}_i^{\top}\boldsymbol{H}\boldsymbol{v}_j}{\sigma_i - \sigma_j}\boldsymbol{v</p>
<p>ä½†è¦æ³¨æ„ï¼Œå½“å¥‡å¼‚å€¼é‡å¤æ—¶ï¼Œè¿™ä¸ªå…¬å¼ä¼šå‡ºç°å¥‡å¼‚æ€§ã€‚å¯¹äº$\msign$ï¼Œç”±äºæ‰€æœ‰éé›¶å¥‡å¼‚å€¼éƒ½è¢«æ˜ å°„åˆ°1ï¼Œè¿™ç§å¥‡å¼‚æ€§æ˜¯ä¸å¯é¿å…çš„ã€‚</p>
<h3 id="_8">åå‘ä¼ æ’­ä¸­çš„æ¢¯åº¦è®¡ç®—</h3>
<p>åœ¨æ·±åº¦å­¦ä¹ çš„åå‘ä¼ æ’­ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¸ç›´æ¥è®¡ç®—FrÃ©chetå¯¼æ•°ï¼Œè€Œæ˜¯è®¡ç®—æ ‡é‡æŸå¤±å‡½æ•°å…³äºå‚æ•°çš„æ¢¯åº¦ã€‚è®¾$\mathcal{L}$æ˜¯æ ‡é‡æŸå¤±å‡½æ•°ï¼Œæˆ‘ä»¬å·²çŸ¥$\nabla_{\boldsymbol{O}}\mathcal{L}$ï¼ˆå³æŸå¤±å¯¹$\boldsymbol{O} = \msign(\boldsymbol{M})$çš„æ¢¯åº¦ï¼‰ï¼Œéœ€è¦è®¡ç®—$\nabla_{\boldsymbol{M}}\mathcal{L}$ã€‚</p>
<p>æ ¹æ®é“¾å¼æ³•åˆ™ï¼Œæˆ‘ä»¬æœ‰
\begin{equation}
\langle \nabla_{\boldsymbol{M}}\mathcal{L}, \boldsymbol{H} \rangle = \langle \nabla_{\boldsymbol{O}}\mathcal{L}, \mathcal{D}<a href="\boldsymbol{M}">\msign</a>[\boldsymbol{H}] \rangle
\end{equation}</p>
<p>å…¶ä¸­$\langle \cdot, \cdot \rangle$è¡¨ç¤ºFrobeniuså†…ç§¯ã€‚è¿™å¯ä»¥æ”¹å†™ä¸º
\begin{equation}
\tr((\nabla_{\boldsymbol{M}}\mathcal{L})^{\top}\boldsymbol{H}) = \tr((\nabla_{\boldsymbol{O}}\mathcal{L})^{\top}\mathcal{D}<a href="\boldsymbol{M}">\msign</a>[\boldsymbol{H}])
\end{equation}</p>
<p>ä»å‰é¢çš„æ¨å¯¼ï¼Œæˆ‘ä»¬çŸ¥é“$\mathcal{D}<a href="\boldsymbol{M}">\msign</a>[\boldsymbol{H}]$æ»¡è¶³
\begin{equation}
\boldsymbol{H} = \mathcal{D}<a href="\boldsymbol{M}">\msign</a>[\boldsymbol{H}]\cdot\boldsymbol{M}^{\top}\boldsymbol{O} + \boldsymbol{O}\boldsymbol{H}^{\top}\boldsymbol{O} + \boldsymbol{O}\boldsymbol{M}^{\top}\cdot\mathcal{D}<a href="\boldsymbol{M}">\msign</a>[\boldsymbol{H}]
\end{equation}</p>
<p>è®°$d\boldsymbol{O} = \mathcal{D}<a href="\boldsymbol{M}">\msign</a>[\boldsymbol{H}]$ï¼Œ$\boldsymbol{G} = \nabla_{\boldsymbol{O}}\mathcal{L}$ï¼Œæˆ‘ä»¬éœ€è¦æ±‚$\nabla_{\boldsymbol{M}}\mathcal{L}$ä½¿å¾—
\begin{equation}
\tr((\nabla_{\boldsymbol{M}}\mathcal{L})^{\top}\boldsymbol{H}) = \tr(\boldsymbol{G}^{\top}d\boldsymbol{O})
\end{equation}</p>
<p>å¼•å…¥è¾…åŠ©çŸ©é˜µ$\boldsymbol{X}$æ»¡è¶³
\begin{equation}
\boldsymbol{X}\boldsymbol{O}^{\top}\boldsymbol{M} + \boldsymbol{M}\boldsymbol{O}^{\top}\boldsymbol{X} = \boldsymbol{G}
\end{equation}</p>
<p>è¿™ä¹Ÿæ˜¯ä¸€ä¸ªSylvesteræ–¹ç¨‹ï¼Œä¸å‰å‘ä¼ æ’­çš„æ–¹ç¨‹å½¢å¼ç›¸åŒã€‚</p>
<p>å°†$\boldsymbol{H} = (d\boldsymbol{O})\boldsymbol{M}^{\top}\boldsymbol{O} + \boldsymbol{O}\boldsymbol{H}^{\top}\boldsymbol{O} + \boldsymbol{O}\boldsymbol{M}^{\top}(d\boldsymbol{O})$ä»£å…¥æ¢¯åº¦è®¡ç®—ï¼Œç»è¿‡è¿¹çš„å¾ªç¯æ€§è´¨å˜æ¢ï¼Œå¯ä»¥å¾—åˆ°
\begin{equation}
\nabla_{\boldsymbol{M}}\mathcal{L} = \boldsymbol{X} - \boldsymbol{O}\boldsymbol{X}^{\top}\boldsymbol{O}
\end{equation}</p>
<p><strong>ç®—æ³•1ï¼ˆmsignåå‘ä¼ æ’­ï¼‰</strong>ï¼š
1. è¾“å…¥ï¼š$\boldsymbol{M}, \boldsymbol{O} = \msign(\boldsymbol{M}), \boldsymbol{G} = \nabla_{\boldsymbol{O}}\mathcal{L}$
2. è®¡ç®—$\boldsymbol{A} = \boldsymbol{M}\boldsymbol{O}^{\top}, \boldsymbol{B} = \boldsymbol{O}^{\top}\boldsymbol{M}$
3. æ±‚è§£Sylvesteræ–¹ç¨‹ï¼š$\boldsymbol{X}\boldsymbol{B} + \boldsymbol{A}\boldsymbol{X} = \boldsymbol{G}$
4. è®¡ç®—$\nabla_{\boldsymbol{M}}\mathcal{L} = \boldsymbol{X} - \boldsymbol{O}\boldsymbol{X}^{\top}\boldsymbol{O}$
5. è¾“å‡ºï¼š$\nabla_{\boldsymbol{M}}\mathcal{L}$</p>
<h3 id="mcsgn">åŸºäºmcsgnçš„é«˜æ•ˆæ±‚è§£ç®—æ³•</h3>
<p>å‰æ–‡æåˆ°ï¼ŒSylvesteræ–¹ç¨‹å¯ä»¥é€šè¿‡$\mcsgn$é«˜æ•ˆæ±‚è§£ã€‚æˆ‘ä»¬è¯¦ç»†å±•å¼€è¿™ä¸ªæ–¹æ³•ã€‚</p>
<p>æ„é€ å¢å¹¿çŸ©é˜µ
\begin{equation}
\boldsymbol{T} = \begin{bmatrix} \boldsymbol{A} &amp; -\boldsymbol{G} \ \boldsymbol{0} &amp; -\boldsymbol{B}\end{bmatrix}
\end{equation}</p>
<p>å…¶ä¸­$\boldsymbol{A} = \boldsymbol{M}\boldsymbol{O}^{\top}, \boldsymbol{B} = \boldsymbol{O}^{\top}\boldsymbol{M}$ã€‚</p>
<p><strong>å¼•ç†2</strong>ï¼šå¦‚æœ$\boldsymbol{X}$æ»¡è¶³$\boldsymbol{A}\boldsymbol{X} + \boldsymbol{X}\boldsymbol{B} = \boldsymbol{G}$ï¼Œåˆ™
\begin{equation}
\boldsymbol{T} = \begin{bmatrix} \boldsymbol{I} &amp; \boldsymbol{X} \ \boldsymbol{0} &amp; \boldsymbol{I}\end{bmatrix}\begin{bmatrix} \boldsymbol{A} &amp; \boldsymbol{0} \ \boldsymbol{0} &amp; -\boldsymbol{B}\end{bmatrix}\begin{bmatrix} \boldsymbol{I} &amp; -\boldsymbol{X} \ \boldsymbol{0} &amp; \boldsymbol{I}\end{bmatrix}
\end{equation}</p>
<p>è¯æ˜ï¼šå±•å¼€å³è¾¹
\begin{align}
&amp;\begin{bmatrix} \boldsymbol{I} &amp; \boldsymbol{X} \ \boldsymbol{0} &amp; \boldsymbol{I}\end{bmatrix}\begin{bmatrix} \boldsymbol{A} &amp; \boldsymbol{0} \ \boldsymbol{0} &amp; -\boldsymbol{B}\end{bmatrix}\begin{bmatrix} \boldsymbol{I} &amp; -\boldsymbol{X} \ \boldsymbol{0} &amp; \boldsymbol{I}\end{bmatrix}\
&amp;= \begin{bmatrix} \boldsymbol{A} &amp; -\boldsymbol{X}\boldsymbol{B} \ \boldsymbol{0} &amp; -\boldsymbol{B}\end{bmatrix}\begin{bmatrix} \boldsymbol{I} &amp; -\boldsymbol{X} \ \boldsymbol{0} &amp; \boldsymbol{I}\end{bmatrix}\
&amp;= \begin{bmatrix} \boldsymbol{A} &amp; -\boldsymbol{A}\boldsymbol{X} - \boldsymbol{X}\boldsymbol{B} \ \boldsymbol{0} &amp; -\boldsymbol{B}\end{bmatrix}
\end{align}</p>
<p>å¦‚æœ$\boldsymbol{A}\boldsymbol{X} + \boldsymbol{X}\boldsymbol{B} = \boldsymbol{G}$ï¼Œåˆ™å³ä¸Šè§’æ­£å¥½æ˜¯$-\boldsymbol{G}$ã€‚$\square$</p>
<p>åº”ç”¨$\mcsgn$çš„ç›¸ä¼¼ä¸å˜æ€§ï¼Œæˆ‘ä»¬æœ‰
\begin{equation}
\mcsgn(\boldsymbol{T}) = \begin{bmatrix} \boldsymbol{I} &amp; \boldsymbol{X} \ \boldsymbol{0} &amp; \boldsymbol{I}\end{bmatrix}\begin{bmatrix} \mcsgn(\boldsymbol{A}) &amp; \boldsymbol{0} \ \boldsymbol{0} &amp; \mcsgn(-\boldsymbol{B})\end{bmatrix}\begin{bmatrix} \boldsymbol{I} &amp; -\boldsymbol{X} \ \boldsymbol{0} &amp; \boldsymbol{I}\end{bmatrix}
\end{equation}</p>
<p>å½“$\boldsymbol{M}$æ»¡ç§©æ—¶ï¼Œ$\boldsymbol{A}, \boldsymbol{B}$éƒ½æ˜¯æ­£å®šçš„ï¼Œå› æ­¤$\mcsgn(\boldsymbol{A}) = \boldsymbol{I}, \mcsgn(-\boldsymbol{B}) = -\boldsymbol{I}$ï¼Œä»è€Œ
\begin{equation}
\mcsgn(\boldsymbol{T}) = \begin{bmatrix} \boldsymbol{I} &amp; \boldsymbol{X} \ \boldsymbol{0} &amp; \boldsymbol{I}\end{bmatrix}\begin{bmatrix} \boldsymbol{I} &amp; \boldsymbol{0} \ \boldsymbol{0} &amp; -\boldsymbol{I}\end{bmatrix}\begin{bmatrix} \boldsymbol{I} &amp; -\boldsymbol{X} \ \boldsymbol{0} &amp; \boldsymbol{I}\end{bmatrix} = \begin{bmatrix} \boldsymbol{I} &amp; -2\boldsymbol{X} \ \boldsymbol{0} &amp; -\boldsymbol{I}\end{bmatrix}
\end{equation}</p>
<p>å› æ­¤
\begin{equation}
\boldsymbol{X} = -\frac{1}{2}[\mcsgn(\boldsymbol{T})]_{[:n,n:]}
\end{equation}</p>
<p>å…¶ä¸­$[\cdot]_{[:n,n:]}$è¡¨ç¤ºå–å³ä¸Šè§’çš„$n\times m$å—ã€‚</p>
<p><strong>ç®—æ³•2ï¼ˆåŸºäºmcsgnçš„åå‘ä¼ æ’­ï¼‰</strong>ï¼š
1. è¾“å…¥ï¼š$\boldsymbol{M}, \boldsymbol{O} = \msign(\boldsymbol{M}), \boldsymbol{G} = \nabla_{\boldsymbol{O}}\mathcal{L}$
2. è®¡ç®—$\boldsymbol{A} = \boldsymbol{M}\boldsymbol{O}^{\top}, \boldsymbol{B} = \boldsymbol{O}^{\top}\boldsymbol{M}$
3. æ„é€ $\boldsymbol{T} = \begin{bmatrix} \boldsymbol{A} + \epsilon\boldsymbol{I} &amp; -\boldsymbol{G} \ \boldsymbol{0} &amp; -\boldsymbol{B} - \epsilon\boldsymbol{I}\end{bmatrix}$ï¼ˆ$\epsilon$ç”¨äºæ•°å€¼ç¨³å®šï¼‰
4. ä½¿ç”¨Newton-Schulzè¿­ä»£è®¡ç®—$\mcsgn(\boldsymbol{T})$
5. æå–$\boldsymbol{X} = -\frac{1}{2}[\mcsgn(\boldsymbol{T})]<em _boldsymbol_M="\boldsymbol{M">{[:n,n:]}$
6. è®¡ç®—$\nabla</em>$
7. è¾“å‡ºï¼š$\nabla_{\boldsymbol{M}}\mathcal{L}$}}\mathcal{L} = \boldsymbol{X} - \boldsymbol{O}\boldsymbol{X}^{\top}\boldsymbol{O</p>
<h3 id="newton-schulz">Newton-Schulzè¿­ä»£çš„å¯¼æ•°</h3>
<p>å‰é¢æåˆ°ï¼Œ$\msign$å¯ä»¥é€šè¿‡Newton-Schulzè¿­ä»£è®¡ç®—ã€‚è¿­ä»£æ ¼å¼ä¸º
\begin{equation}
\boldsymbol{X}<em t_1="t+1">0 = \frac{\boldsymbol{M}}{\Vert\boldsymbol{M}\Vert_F}, \quad \boldsymbol{X}</em>_t)^2
\end{equation}} = a_t\boldsymbol{X}_t + b_t\boldsymbol{X}_t(\boldsymbol{X}_t^{\top}\boldsymbol{X}_t) + c_t\boldsymbol{X}_t(\boldsymbol{X}_t^{\top}\boldsymbol{X</p>
<p>è¿™ä¸ªè¿­ä»£è¿‡ç¨‹æœ¬èº«æ˜¯å¯å¾®çš„ï¼Œå¯ä»¥ç›´æ¥åå‘ä¼ æ’­ã€‚è®¾$\boldsymbol{X}_T \approx \msign(\boldsymbol{M})$ï¼Œæˆ‘ä»¬éœ€è¦åå‘ä¼ æ’­æ¢¯åº¦ã€‚</p>
<p>å¯¹äºç¬¬$t$æ­¥çš„æ›´æ–°ï¼Œè®¾$\boldsymbol{G}<em _boldsymbol_X="\boldsymbol{X">t = \nabla</em><em t-1="t-1">t}\mathcal{L}$ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—$\boldsymbol{G}</em>$ã€‚} = \nabla_{\boldsymbol{X}_{t-1}}\mathcal{L</p>
<p>è®°$\boldsymbol{P}<em t-1="t-1">t = \boldsymbol{X}_t^{\top}\boldsymbol{X}_t$ï¼Œåˆ™
\begin{equation}
\boldsymbol{X}_t = a</em>}\boldsymbol{X<em t-1="t-1">{t-1} + b</em>}\boldsymbol{X<em t-1="t-1">{t-1}\boldsymbol{P}</em>} + c_{t-1}\boldsymbol{X<em t-1="t-1">{t-1}\boldsymbol{P}</em>^2
\end{equation}</p>
<p>å¯¹$\boldsymbol{X}<em t-1="t-1">{t-1}$æ±‚å¯¼ï¼ˆè¿™é‡Œéœ€è¦ä½¿ç”¨çŸ©é˜µå¾®ç§¯åˆ†çš„ä¹˜ç§¯æ³•åˆ™å’Œé“¾å¼æ³•åˆ™ï¼‰ï¼š
\begin{align}
\boldsymbol{G}</em>} &amp;= a_{t-1}\boldsymbol{G<em t-1="t-1">t + b</em>}\boldsymbol{G<em t-1="t-1">t\boldsymbol{P}</em>} + c_{t-1}\boldsymbol{G<em t-1="t-1">t\boldsymbol{P}</em>^2\
&amp;\quad + b_{t-1}\nabla_{\boldsymbol{X}<em t-1="t-1">{t-1}}(\boldsymbol{X}</em>}\boldsymbol{P<em t-1="t-1">{t-1})^{\top}\boldsymbol{G}_t\
&amp;\quad + c</em>}\nabla_{\boldsymbol{X<em t-1="t-1">{t-1}}(\boldsymbol{X}</em>_t
\end{align}}\boldsymbol{P}_{t-1}^2)^{\top}\boldsymbol{G</p>
<p>å¯¹äº$\boldsymbol{P}<em _boldsymbol_X="\boldsymbol{X">t = \boldsymbol{X}_t^{\top}\boldsymbol{X}_t$çš„å¯¼æ•°ï¼Œæˆ‘ä»¬æœ‰
\begin{equation}
\nabla</em><em _boldsymbol_X="\boldsymbol{X">t}\tr(\boldsymbol{G}_P^{\top}\boldsymbol{P}_t) = \nabla</em>_P
\end{equation}}_t}\tr(\boldsymbol{G}_P^{\top}\boldsymbol{X}_t^{\top}\boldsymbol{X}_t) = 2\boldsymbol{X}_t\boldsymbol{G</p>
<p>å› æ­¤ï¼Œä»$\nabla_{\boldsymbol{X}_t\boldsymbol{P}_t}\mathcal{L}$åå‘ä¼ æ’­åˆ°$\boldsymbol{X}_t$æ—¶ï¼Œéœ€è¦è€ƒè™‘$\boldsymbol{P}_t$å¯¹$\boldsymbol{X}_t$çš„ä¾èµ–ã€‚</p>
<p>å®Œæ•´çš„åå‘ä¼ æ’­å…¬å¼ä¸ºï¼š
\begin{align}
\boldsymbol{G}<em t-1="t-1">{P,t-1} &amp;= b</em>}\boldsymbol{X<em t-1="t-1">{t-1}^{\top}\boldsymbol{G}_t + 2c</em>}\boldsymbol{P<em t-1="t-1">{t-1}\boldsymbol{X}</em>}^{\top}\boldsymbol{G<em t-1="t-1">t\
\boldsymbol{G}</em>} &amp;= a_{t-1}\boldsymbol{G<em t-1="t-1">t + b</em>}\boldsymbol{G<em t-1="t-1">t\boldsymbol{P}</em>} + c_{t-1}\boldsymbol{G<em t-1="t-1">t\boldsymbol{P}</em>}^2 + 2\boldsymbol{X<em P_t-1="P,t-1">{t-1}\boldsymbol{G}</em>
\end{align}</p>
<p>è¿™ä¸ªé€’æ¨å…³ç³»ä½¿å¾—æˆ‘ä»¬å¯ä»¥ä»$\boldsymbol{G}_T$é€æ­¥åå‘ä¼ æ’­åˆ°$\boldsymbol{G}_0$ã€‚</p>
<h3 id="_9">è‡ªåŠ¨å¾®åˆ†çš„å®ç°</h3>
<p>åœ¨ç°ä»£æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼ˆå¦‚PyTorch, JAXï¼‰ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è‡ªåŠ¨å¾®åˆ†ï¼ˆAutomatic Differentiation, ADï¼‰æ¥è‡ªåŠ¨è®¡ç®—æ¢¯åº¦ã€‚è¿™é‡Œè®¨è®ºä¸¤ç§å®ç°æ–¹å¼ï¼š</p>
<p><strong>æ–¹å¼1ï¼šç›´æ¥åå‘ä¼ æ’­Newton-Schulzè¿­ä»£</strong></p>
<p>æœ€ç®€å•çš„æ–¹å¼æ˜¯å°†Newton-Schulzè¿­ä»£ä½œä¸ºä¸€ç³»åˆ—å¯å¾®æ“ä½œï¼Œè®©è‡ªåŠ¨å¾®åˆ†æ¡†æ¶è‡ªåŠ¨å¤„ç†åå‘ä¼ æ’­ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">msign_autograd</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">num_iters</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ä½¿ç”¨è‡ªåŠ¨å¾®åˆ†è®¡ç®—msignçš„æ¢¯åº¦&quot;&quot;&quot;</span>
    <span class="c1"># åˆå§‹åŒ–</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">M</span> <span class="o">/</span> <span class="n">torch</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="s1">&#39;fro&#39;</span><span class="p">)</span>

    <span class="c1"># Newton-Schulzè¿­ä»£ï¼ˆä½¿ç”¨é¢„å®šä¹‰ç³»æ•°ï¼‰</span>
    <span class="n">coeffs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mf">8.28721</span> <span class="o">*</span> <span class="mf">1.01</span><span class="p">,</span> <span class="o">-</span><span class="mf">23.5959</span> <span class="o">*</span> <span class="mf">1.01</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="mf">17.3004</span> <span class="o">*</span> <span class="mf">1.01</span><span class="o">**</span><span class="mi">5</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">4.10706</span> <span class="o">*</span> <span class="mf">1.01</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.94785</span> <span class="o">*</span> <span class="mf">1.01</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.544843</span> <span class="o">*</span> <span class="mf">1.01</span><span class="o">**</span><span class="mi">5</span><span class="p">),</span>
        <span class="c1"># ... æ›´å¤šç³»æ•°</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_iters</span><span class="p">):</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">XTX</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">X</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">X</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">X</span> <span class="o">@</span> <span class="n">XTX</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">X</span> <span class="o">@</span> <span class="p">(</span><span class="n">XTX</span> <span class="o">@</span> <span class="n">XTX</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">X</span>
</code></pre></div>

<p>è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯å®ç°ç®€å•ï¼Œç¼ºç‚¹æ˜¯éœ€è¦å­˜å‚¨æ‰€æœ‰ä¸­é—´çŠ¶æ€$\boldsymbol{X}_0, \boldsymbol{X}_1, \ldots, \boldsymbol{X}_T$ï¼Œæ˜¾å­˜å¼€é”€å¤§ã€‚</p>
<p><strong>æ–¹å¼2ï¼šè‡ªå®šä¹‰åå‘ä¼ æ’­å‡½æ•°</strong></p>
<p>æ›´é«˜æ•ˆçš„æ–¹å¼æ˜¯è‡ªå®šä¹‰åå‘ä¼ æ’­ï¼Œä½¿ç”¨åŸºäºSylvesteræ–¹ç¨‹çš„è§£æè§£ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MSignFunction</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Function</span><span class="p">):</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å‰å‘ä¼ æ’­ï¼šè®¡ç®—O = msign(M)&quot;&quot;&quot;</span>
        <span class="n">O</span> <span class="o">=</span> <span class="n">compute_msign_newton_schulz</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">save_for_backward</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">O</span><span class="p">)</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">epsilon</span>
        <span class="k">return</span> <span class="n">O</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">backward</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">grad_output</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;åå‘ä¼ æ’­ï¼šè®¡ç®—grad_M&quot;&quot;&quot;</span>
        <span class="n">M</span><span class="p">,</span> <span class="n">O</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">saved_tensors</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">grad_output</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">epsilon</span>

        <span class="c1"># æ„é€ å¢å¹¿çŸ©é˜µ</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">M</span> <span class="o">@</span> <span class="n">O</span><span class="o">.</span><span class="n">T</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">O</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">M</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">shape</span>

        <span class="c1"># æ·»åŠ æ­£åˆ™åŒ–ä»¥å¤„ç†å¥‡å¼‚æƒ…å†µ</span>
        <span class="n">A_reg</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">epsilon</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="n">B_reg</span> <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="n">epsilon</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

        <span class="c1"># æ„é€ TçŸ©é˜µ</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">A_reg</span><span class="p">,</span> <span class="o">-</span><span class="n">G</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">M</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="o">-</span><span class="n">B_reg</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># è®¡ç®—mcsgn(T)</span>
        <span class="n">T_sgn</span> <span class="o">=</span> <span class="n">compute_mcsgn_newton_schulz</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>

        <span class="c1"># æå–X</span>
        <span class="n">X</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">T_sgn</span><span class="p">[:</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">:]</span>

        <span class="c1"># è®¡ç®—æœ€ç»ˆæ¢¯åº¦</span>
        <span class="n">grad_M</span> <span class="o">=</span> <span class="n">X</span> <span class="o">-</span> <span class="n">O</span> <span class="o">@</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">O</span>

        <span class="k">return</span> <span class="n">grad_M</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div>

<p><strong>æ–¹å¼3ï¼šéšå‡½æ•°å®šç†</strong></p>
<p>å¦ä¸€ç§æ€è·¯æ˜¯åˆ©ç”¨éšå‡½æ•°å®šç†ï¼ˆImplicit Function Theoremï¼‰ã€‚ç”±äº$\boldsymbol{O}$æ»¡è¶³$\boldsymbol{M} = \boldsymbol{O}\boldsymbol{M}^{\top}\boldsymbol{O}$ï¼Œå¯ä»¥å°†è¿™ä¸ªçº¦æŸè§†ä¸ºéšå¼å®šä¹‰$\boldsymbol{O}$çš„æ–¹ç¨‹ã€‚</p>
<p>è®¾$F(\boldsymbol{O}, \boldsymbol{M}) = \boldsymbol{O}\boldsymbol{M}^{\top}\boldsymbol{O} - \boldsymbol{M} = \boldsymbol{0}$ï¼Œæ ¹æ®éšå‡½æ•°å®šç†
\begin{equation}
\frac{\partial \boldsymbol{O}}{\partial \boldsymbol{M}} = -\left(\frac{\partial F}{\partial \boldsymbol{O}}\right)^{-1}\frac{\partial F}{\partial \boldsymbol{M}}
\end{equation}</p>
<p>è¿™éœ€è¦æ±‚è§£ä¸€ä¸ªçº¿æ€§ç³»ç»Ÿï¼Œä½†è¿™ä¸ªçº¿æ€§ç³»ç»Ÿçš„ç»“æ„æ­£æ˜¯æˆ‘ä»¬å‰é¢è®¨è®ºçš„Sylvesteræ–¹ç¨‹ã€‚</p>
<h3 id="svd">ä¸SVDå¯¼æ•°çš„å…³ç³»</h3>
<p>å‰æ–‡æåˆ°ï¼Œ$\msign$å¯ä»¥é€šè¿‡SVDå®šä¹‰ï¼š$\msign(\boldsymbol{M}) = \boldsymbol{U}<em _:_:r_="[:,:r]">{[:,:r]}\boldsymbol{V}</em>$ã€‚å› æ­¤ï¼Œ$\msign$çš„å¯¼æ•°ä¸SVDçš„å¯¼æ•°å¯†åˆ‡ç›¸å…³ã€‚}^{\top</p>
<p>SVDçš„å¯¼æ•°å…¬å¼å·²åœ¨æ–‡çŒ®ä¸­å……åˆ†ç ”ç©¶ã€‚å¯¹äº$\boldsymbol{M} = \boldsymbol{U}\boldsymbol{\Sigma}\boldsymbol{V}^{\top}$ï¼Œæˆ‘ä»¬æœ‰
\begin{align}
d\boldsymbol{U} &amp;= (\boldsymbol{I} - \boldsymbol{U}\boldsymbol{U}^{\top})(d\boldsymbol{M})\boldsymbol{V}\boldsymbol{\Sigma}^{-1} + \boldsymbol{U}\boldsymbol{\Omega}_U\
d\boldsymbol{V} &amp;= (\boldsymbol{I} - \boldsymbol{V}\boldsymbol{V}^{\top})(d\boldsymbol{M})^{\top}\boldsymbol{U}\boldsymbol{\Sigma}^{-1} + \boldsymbol{V}\boldsymbol{\Omega}_V\
d\boldsymbol{\Sigma} &amp;= \boldsymbol{U}^{\top}(d\boldsymbol{M})\boldsymbol{V}
\end{align}</p>
<p>å…¶ä¸­$\boldsymbol{\Omega}<em ij="ij">U, \boldsymbol{\Omega}_V$æ˜¯åå¯¹ç§°çŸ©é˜µï¼Œæ»¡è¶³
\begin{equation}
[\boldsymbol{\Omega}_U]</em>
\end{equation}} = \frac{\boldsymbol{u}_i^{\top}(d\boldsymbol{M})\boldsymbol{v}_j\sigma_j - \boldsymbol{u}_j^{\top}(d\boldsymbol{M})\boldsymbol{v}_i\sigma_i}{\sigma_i^2 - \sigma_j^2</p>
<p>å¯¹äº$\msign(\boldsymbol{M}) = \boldsymbol{U}<em _:_:r_="[:,:r]">{[:,:r]}\boldsymbol{V}</em>$ï¼Œå…¶å¯¼æ•°ä¸º
\begin{equation}
d[\msign(\boldsymbol{M})] = (d\boldsymbol{U}}^{\top<em _:_:r_="[:,:r]">{[:,:r]})\boldsymbol{V}</em>}^{\top} + \boldsymbol{U<em _:_:r_="[:,:r]">{[:,:r]}(d\boldsymbol{V}</em>
\end{equation}})^{\top</p>
<p>æ³¨æ„åˆ°$\msign$ä¸ä¾èµ–äº$\boldsymbol{\Sigma}$ï¼ˆå› ä¸ºéé›¶å¥‡å¼‚å€¼éƒ½å˜ä¸º1ï¼‰ï¼Œæ‰€ä»¥$\msign$å¯¹å¥‡å¼‚å€¼çš„å˜åŒ–ä¸æ•æ„Ÿï¼Œåªå¯¹å¥‡å¼‚å‘é‡çš„å˜åŒ–æ•æ„Ÿã€‚</p>
<p>å°†SVDå¯¼æ•°å…¬å¼ä»£å…¥ï¼Œç»è¿‡å¤æ‚çš„ä»£æ•°è¿ç®—ï¼Œå¯ä»¥éªŒè¯è¿™ä¸æˆ‘ä»¬å‰é¢åŸºäºæ’ç­‰å¼$\boldsymbol{M} = \boldsymbol{O}\boldsymbol{M}^{\top}\boldsymbol{O}$å¾—åˆ°çš„ç»“æœæ˜¯ä¸€è‡´çš„ã€‚è¿™ä¸ºæˆ‘ä»¬çš„æ¨å¯¼æä¾›äº†å¦ä¸€ä¸ªéªŒè¯ã€‚</p>
<p><strong>å®šç†2ï¼ˆSVDå¯¼æ•°ä¸Sylvesteræ–¹ç¨‹çš„ç­‰ä»·æ€§ï¼‰</strong>ï¼šåŸºäºSVDçš„$\msign$å¯¼æ•°å…¬å¼ä¸åŸºäºSylvesteræ–¹ç¨‹çš„è§£åœ¨æ•°å€¼ä¸Šæ˜¯ç­‰ä»·çš„ï¼ˆå½“$\boldsymbol{M}$æ»¡ç§©æ—¶ï¼‰ã€‚</p>
<p>è¯æ˜æ€è·¯ï¼šå°†SVDè¡¨è¾¾å¼ä»£å…¥Sylvesteræ–¹ç¨‹ï¼Œåˆ©ç”¨å¥‡å¼‚å‘é‡çš„æ­£äº¤æ€§å’Œç‰¹æ®Šç»“æ„ï¼Œå¯ä»¥è¯æ˜ä¸¤è€…ç»™å‡ºç›¸åŒçš„ç»“æœã€‚è¯¦ç»†è¯æ˜è¾ƒä¸ºå†—é•¿ï¼Œè¿™é‡Œçœç•¥ã€‚</p>
<h3 id="_10">é“¾å¼æ³•åˆ™çš„åº”ç”¨</h3>
<p>åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œ$\msign$é€šå¸¸ä¸æ˜¯å•ç‹¬å‡ºç°ï¼Œè€Œæ˜¯ä½œä¸ºæŸä¸ªå¤åˆå‡½æ•°çš„ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œåœ¨Muonä¼˜åŒ–å™¨ä¸­ï¼Œå‚æ•°æ›´æ–°æ¶‰åŠåˆ°
\begin{equation}
\boldsymbol{W}_{t+1} = \boldsymbol{W}_t - \eta\msign(\boldsymbol{G}_t)
\end{equation}</p>
<p>å…¶ä¸­$\boldsymbol{G}_t$æ˜¯æ¢¯åº¦æˆ–åŠ¨é‡ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬è¦åˆ†æä¼˜åŒ–å™¨çš„äºŒé˜¶æ€§è´¨ï¼ˆä¾‹å¦‚è®¡ç®—Hessianæˆ–è¿›è¡Œè¶…å‚æ•°ä¼˜åŒ–ï¼‰ï¼Œå°±éœ€è¦å¯¹ä¼˜åŒ–å™¨æœ¬èº«æ±‚å¯¼ï¼Œè¿™æ¶‰åŠåˆ°åµŒå¥—çš„é“¾å¼æ³•åˆ™ã€‚</p>
<p><strong>ä¾‹1ï¼šåµŒå¥—msign</strong></p>
<p>è€ƒè™‘$f(\boldsymbol{M}) = \msign(\msign(\boldsymbol{M}))$ã€‚æ ¹æ®é“¾å¼æ³•åˆ™
\begin{equation}
\mathcal{D}f(\boldsymbol{M})[\boldsymbol{H}] = \mathcal{D}<a href="\msign(\boldsymbol{M})">\msign</a>[\mathcal{D}<a href="\boldsymbol{M}">\msign</a>[\boldsymbol{H}]]
\end{equation}</p>
<p>æ³¨æ„åˆ°$\msign(\msign(\boldsymbol{M})) = \msign(\boldsymbol{M})$ï¼ˆå› ä¸º$\msign$æ˜¯å¹‚ç­‰çš„ï¼‰ï¼Œæ‰€ä»¥å¤–å±‚å¯¼æ•°å®é™…ä¸Šæ˜¯åœ¨$\boldsymbol{O} = \msign(\boldsymbol{M})$å¤„è®¡ç®—çš„ã€‚</p>
<p><strong>ä¾‹2ï¼šmsignçš„çº¿æ€§ç»„åˆ</strong></p>
<p>è€ƒè™‘$f(\boldsymbol{M}) = \boldsymbol{A}\msign(\boldsymbol{M})\boldsymbol{B}$ï¼Œå…¶ä¸­$\boldsymbol{A}, \boldsymbol{B}$æ˜¯å¸¸æ•°çŸ©é˜µã€‚å¯¼æ•°ä¸º
\begin{equation}
\mathcal{D}f(\boldsymbol{M})[\boldsymbol{H}] = \boldsymbol{A}\mathcal{D}<a href="\boldsymbol{M}">\msign</a>[\boldsymbol{H}]\boldsymbol{B}
\end{equation}</p>
<p>åœ¨åå‘ä¼ æ’­ä¸­ï¼Œå¦‚æœ$\nabla_f\mathcal{L} = \boldsymbol{G}$ï¼Œåˆ™
\begin{equation}
\nabla_{\msign(\boldsymbol{M})}\mathcal{L} = \boldsymbol{A}^{\top}\boldsymbol{G}\boldsymbol{B}^{\top}
\end{equation}</p>
<p>ç„¶åå†ç”¨æˆ‘ä»¬çš„Sylvesteræ–¹ç¨‹æ–¹æ³•è®¡ç®—$\nabla_{\boldsymbol{M}}\mathcal{L}$ã€‚</p>
<p><strong>ä¾‹3ï¼šè¿¹å‡½æ•°</strong></p>
<p>è€ƒè™‘$f(\boldsymbol{M}) = \tr(\boldsymbol{C}^{\top}\msign(\boldsymbol{M}))$ï¼Œè¿™åœ¨æŸäº›æ­£åˆ™åŒ–é¡¹ä¸­å‡ºç°ã€‚</p>
<p>\begin{equation}
\frac{\partial f}{\partial \boldsymbol{M}} = \mathcal{D}<a href="\boldsymbol{M}">\msign</a>^*[\boldsymbol{C}]
\end{equation}</p>
<p>å…¶ä¸­$\mathcal{D}<a href="\boldsymbol{M}">\msign</a>^<em>$æ˜¯ä¼´éšç®—å­ï¼ˆadjoint operatorï¼‰ï¼Œæ»¡è¶³
\begin{equation}
\langle \mathcal{D}<a href="\boldsymbol{M}">\msign</a>[\boldsymbol{H}], \boldsymbol{C} \rangle = \langle \boldsymbol{H}, \mathcal{D}<a href="\boldsymbol{M}">\msign</a>^</em>[\boldsymbol{C}] \rangle
\end{equation}</p>
<p>è¿™æ­£æ˜¯æˆ‘ä»¬åå‘ä¼ æ’­ç®—æ³•è®¡ç®—çš„é‡ã€‚</p>
<h3 id="rnnttt">åœ¨RNNå’ŒTTTä¸­çš„åº”ç”¨</h3>
<p>Test-Time Training (TTT) ç»“åˆ Muon ä¼˜åŒ–å™¨éœ€è¦å°†ä¼˜åŒ–æ­¥éª¤åµŒå…¥åˆ°æ¨¡å‹çš„å‰å‘ä¼ æ’­ä¸­ã€‚å…·ä½“æ¥è¯´ï¼ŒRNNçš„éšè—çŠ¶æ€æ›´æ–°å¯èƒ½æ¶‰åŠ
\begin{equation}
\boldsymbol{h}_{t+1} = f(\boldsymbol{h}_t, \boldsymbol{x}_t; \boldsymbol{\theta}_t)
\end{equation}</p>
<p>å…¶ä¸­$\boldsymbol{\theta}<em t_1="t+1">t$é€šè¿‡Muonä¼˜åŒ–å™¨åœ¨æµ‹è¯•æ—¶æ›´æ–°ï¼š
\begin{equation}
\boldsymbol{\theta}</em>_t)
\end{equation}} = \boldsymbol{\theta}_t - \eta\msign(\boldsymbol{g</p>
<p>$\boldsymbol{g}_t$æ˜¯æŸç§æ¢¯åº¦æˆ–åŠ¨é‡ä¼°è®¡ã€‚</p>
<p>ä¸ºäº†è®­ç»ƒæ•´ä¸ªTTT-RNNç³»ç»Ÿï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡æ•´ä¸ªå±•å¼€çš„è®¡ç®—å›¾åå‘ä¼ æ’­ï¼Œè¿™éœ€è¦$\msign$çš„å¯¼æ•°ã€‚</p>
<p><strong>æ¢¯åº¦æµåˆ†æ</strong>ï¼š</p>
<p>è®¾æœ€ç»ˆæŸå¤±ä¸º$\mathcal{L}(\boldsymbol{h}<em t="0">T)$ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—$\frac{\partial\mathcal{L}}{\partial\boldsymbol{\theta}_0}$ã€‚æ ¹æ®é“¾å¼æ³•åˆ™
\begin{equation}
\frac{\partial\mathcal{L}}{\partial\boldsymbol{\theta}_0} = \sum</em>
\end{equation}}^{T-1}\frac{\partial\mathcal{L}}{\partial\boldsymbol{\theta}_t}\frac{\partial\boldsymbol{\theta}_t}{\partial\boldsymbol{\theta}_0</p>
<p>å…¶ä¸­
\begin{equation}
\frac{\partial\boldsymbol{\theta}_{t+1}}{\partial\boldsymbol{\theta}_t} = \boldsymbol{I} - \eta\frac{\partial\msign(\boldsymbol{g}_t)}{\partial\boldsymbol{\theta}_t}
\end{equation}</p>
<p>å¦‚æœ$\boldsymbol{g}<em _boldsymbol_theta="\boldsymbol{\theta">t$æœ¬èº«ä¾èµ–äº$\boldsymbol{\theta}_t$ï¼ˆä¾‹å¦‚$\boldsymbol{g}_t = \nabla</em><em _text_aux="\text{aux">t}\mathcal{L}</em>$ï¼‰ï¼Œåˆ™éœ€è¦è¿›ä¸€æ­¥å±•å¼€é“¾å¼æ³•åˆ™ã€‚}</p>
<p>è¿™ç§åµŒå¥—çš„å¾®åˆ†ç»“æ„ä½¿å¾—TTT+Muonçš„è®­ç»ƒåœ¨è®¡ç®—ä¸Šéå¸¸æ˜‚è´µï¼Œä½†æˆ‘ä»¬çš„é«˜æ•ˆSylvesteræ±‚è§£æ–¹æ³•å¯ä»¥æ˜¾è‘—å‡å°‘è®¡ç®—æˆæœ¬ã€‚</p>
<h3 id="_11">æ•°å€¼ç¨³å®šæ€§è€ƒè™‘</h3>
<p>åœ¨å®é™…å®ç°ä¸­ï¼Œæ•°å€¼ç¨³å®šæ€§è‡³å…³é‡è¦ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå…³é”®çš„ç¨³å®šæ€§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼š</p>
<p><strong>é—®é¢˜1ï¼šå¥‡å¼‚å€¼æ¥è¿‘é›¶</strong></p>
<p>å½“$\boldsymbol{M}$æ¥è¿‘ç§©äºæ—¶ï¼Œ$\boldsymbol{A} = (\boldsymbol{M}\boldsymbol{M}^{\top})^{1/2}$å’Œ$\boldsymbol{B} = (\boldsymbol{M}^{\top}\boldsymbol{M})^{1/2}$ä¼šæœ‰æ¥è¿‘é›¶çš„ç‰¹å¾å€¼ï¼Œå¯¼è‡´Sylvesteræ–¹ç¨‹ç—…æ€ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šæ·»åŠ æ­£åˆ™åŒ–é¡¹
\begin{equation}
\boldsymbol{A}<em _text_reg="\text{reg">{\text{reg}} = \boldsymbol{A} + \epsilon\boldsymbol{I}, \quad \boldsymbol{B}</em>
\end{equation}}} = \boldsymbol{B} + \epsilon\boldsymbol{I</p>
<p>å…¶ä¸­$\epsilon \sim 10^{-3}$ã€‚è¿™ç›¸å½“äºå‡è®¾$\boldsymbol{M}$çš„æœ€å°å¥‡å¼‚å€¼è‡³å°‘ä¸º$\sqrt{2\epsilon}$ã€‚</p>
<p><strong>é—®é¢˜2ï¼šNewton-Schulzè¿­ä»£çš„æ•°å€¼è¯¯å·®ç´¯ç§¯</strong></p>
<p>Newton-Schulzè¿­ä»£æ˜¯é«˜é˜¶æ–¹æ³•ï¼Œä½†æ¯æ­¥éƒ½ä¼šå¼•å…¥èˆå…¥è¯¯å·®ã€‚å¤šæ­¥è¿­ä»£åï¼Œè¯¯å·®å¯èƒ½ç´¯ç§¯ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š
1. ä½¿ç”¨æ··åˆç²¾åº¦è®¡ç®—ï¼ˆFP32ç”¨äºç´¯ç§¯ï¼ŒFP16ç”¨äºçŸ©é˜µä¹˜æ³•ï¼‰
2. é™åˆ¶è¿­ä»£æ¬¡æ•°ï¼ˆé€šå¸¸5-8æ­¥è¶³å¤Ÿï¼‰
3. ç›‘æ§è¿­ä»£æ”¶æ•›æ€§ï¼Œæå‰åœæ­¢</p>
<p><strong>é—®é¢˜3ï¼šæ¢¯åº¦çˆ†ç‚¸/æ¶ˆå¤±</strong></p>
<p>åœ¨åå‘ä¼ æ’­ä¸­ï¼Œæ¢¯åº¦å¯èƒ½å› ä¸ºå¤šæ¬¡çŸ©é˜µä¹˜æ³•è€Œçˆ†ç‚¸æˆ–æ¶ˆå¤±ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š
1. æ¢¯åº¦è£å‰ªï¼ˆgradient clippingï¼‰
2. ä½¿ç”¨å½’ä¸€åŒ–çš„æ¢¯åº¦ï¼ˆå¦‚$\frac{\nabla_{\boldsymbol{M}}\mathcal{L}}{\Vert\nabla_{\boldsymbol{M}}\mathcal{L}\Vert_F}$ï¼‰
3. è‡ªé€‚åº”å­¦ä¹ ç‡</p>
<p><strong>é—®é¢˜4ï¼šmcsgnçš„ç‰¹å¾å€¼è¦æ±‚</strong></p>
<p>$\mcsgn$è¦æ±‚çŸ©é˜µçš„ç‰¹å¾å€¼ä¸åœ¨è´Ÿå®è½´ä¸Šã€‚å¯¹äºå¢å¹¿çŸ©é˜µ$\boldsymbol{T}$ï¼Œè¿™é€šå¸¸æ˜¯æ»¡è¶³çš„ï¼Œä½†åœ¨æç«¯æƒ…å†µä¸‹å¯èƒ½å¤±è´¥ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š
1. éªŒè¯$\boldsymbol{M}\boldsymbol{O}^{\top}$å’Œ$\boldsymbol{O}^{\top}\boldsymbol{M}$çš„æ­£å®šæ€§
2. å¦‚æœæ£€æµ‹åˆ°è´Ÿç‰¹å¾å€¼ï¼Œå¢åŠ $\epsilon$
3. å›é€€åˆ°ç›´æ¥SVDæ–¹æ³•ï¼ˆä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆï¼‰</p>
<p><strong>é—®é¢˜5ï¼šå¤§çŸ©é˜µçš„æ˜¾å­˜é™åˆ¶</strong></p>
<p>å¯¹äºå¤§è§„æ¨¡çŸ©é˜µï¼ˆå¦‚$1000 \times 1000$ï¼‰ï¼Œæ„é€ å¢å¹¿çŸ©é˜µ$\boldsymbol{T}$ï¼ˆå¤§å°ä¸º$2000 \times 2000$ï¼‰å¯èƒ½è¶…å‡ºæ˜¾å­˜ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š
1. åˆ†å—å¤„ç†ï¼ˆå¦‚æœçŸ©é˜µæœ‰ç¨€ç–æˆ–åˆ†å—ç»“æ„ï¼‰
2. ä½¿ç”¨ä½ç§©è¿‘ä¼¼ï¼ˆNystrÃ¶mæ–¹æ³•ï¼‰
3. è¿­ä»£æ±‚è§£Sylvesteræ–¹ç¨‹ï¼ˆä¸æ˜¾å¼æ„é€ $\boldsymbol{T}$ï¼‰</p>
<h3 id="_12">è®¡ç®—å¤æ‚åº¦åˆ†æ</h3>
<p>è®©æˆ‘ä»¬åˆ†æå„ç§æ–¹æ³•çš„è®¡ç®—å¤æ‚åº¦ï¼š</p>
<p><strong>æ–¹æ³•1ï¼šç›´æ¥åå‘ä¼ æ’­Newton-Schulzè¿­ä»£</strong>
- æ—¶é—´å¤æ‚åº¦ï¼š$O(Tn^2m)$ï¼Œå…¶ä¸­$T$æ˜¯è¿­ä»£æ¬¡æ•°
- ç©ºé—´å¤æ‚åº¦ï¼š$O(Tnm)$ï¼ˆå­˜å‚¨æ‰€æœ‰ä¸­é—´çŠ¶æ€ï¼‰</p>
<p><strong>æ–¹æ³•2ï¼šåŸºäºSVDçš„è§£æè§£</strong>
- æ—¶é—´å¤æ‚åº¦ï¼š$O(n^2m + nm^2)$ï¼ˆSVDè®¡ç®—ï¼‰
- ç©ºé—´å¤æ‚åº¦ï¼š$O(nm)$</p>
<p><strong>æ–¹æ³•3ï¼šåŸºäºSylvesteræ–¹ç¨‹å’Œmcsgn</strong>
- æ—¶é—´å¤æ‚åº¦ï¼š$O(T'(n+m)^3)$ï¼Œå…¶ä¸­$T'$æ˜¯mcsgnçš„è¿­ä»£æ¬¡æ•°
- ç©ºé—´å¤æ‚åº¦ï¼š$O((n+m)^2)$ï¼ˆå¢å¹¿çŸ©é˜µï¼‰</p>
<p>å¯¹äº$n \approx m$çš„æ–¹é˜µï¼Œæ–¹æ³•3çš„æ—¶é—´å¤æ‚åº¦çº¦ä¸º$O(T'n^3)$ã€‚ç”±äº$T' \sim 5$-$8$é€šå¸¸è¿œå°äºç›´æ¥æ–¹æ³•çš„æ“ä½œæ•°ï¼Œä¸”GPUä¸ŠçŸ©é˜µä¹˜æ³•é«˜åº¦ä¼˜åŒ–ï¼Œæ–¹æ³•3åœ¨å®è·µä¸­å¾€å¾€æœ€å¿«ã€‚</p>
<p><strong>ä¼˜åŒ–æŠ€å·§</strong>ï¼š
1. <strong>ç¼“å­˜å¤ç”¨</strong>ï¼šåœ¨å‰å‘ä¼ æ’­ä¸­è®¡ç®—çš„$\boldsymbol{O}$åœ¨åå‘ä¼ æ’­ä¸­å¤ç”¨
2. <strong>èåˆç®—å­</strong>ï¼šå°†å¤šä¸ªçŸ©é˜µæ“ä½œèåˆä¸ºå•ä¸ªCUDA kernel
3. <strong>å¼‚æ­¥è®¡ç®—</strong>ï¼šåˆ©ç”¨GPUçš„æµï¼ˆstreamsï¼‰å¹¶è¡Œè®¡ç®—ä¸åŒéƒ¨åˆ†
4. <strong>é‡åŒ–</strong>ï¼šä½¿ç”¨ä½ç²¾åº¦ï¼ˆå¦‚FP16ï¼‰åŠ é€Ÿï¼Œå…³é”®æ­¥éª¤ç”¨FP32</p>
<h3 id="_13">å®éªŒéªŒè¯ï¼šæ¢¯åº¦æ£€éªŒ</h3>
<p>å®ç°$\msign$çš„è‡ªå®šä¹‰æ¢¯åº¦åï¼ŒåŠ¡å¿…è¿›è¡Œ<strong>æ¢¯åº¦æ£€éªŒ</strong>ï¼ˆgradient checkï¼‰ä»¥éªŒè¯æ­£ç¡®æ€§ã€‚</p>
<p><strong>æœ‰é™å·®åˆ†æ³•</strong>ï¼š
\begin{equation}
\frac{\partial \mathcal{L}}{\partial M_{ij}} \approx \frac{\mathcal{L}(\boldsymbol{M} + \epsilon\boldsymbol{E}<em ij="ij">{ij}) - \mathcal{L}(\boldsymbol{M} - \epsilon\boldsymbol{E}</em>
\end{equation}})}{2\epsilon</p>
<p>å…¶ä¸­$\boldsymbol{E}_{ij}$æ˜¯ç¬¬$(i,j)$ä½ç½®ä¸º1ã€å…¶ä½™ä¸º0çš„çŸ©é˜µã€‚</p>
<p><strong>æ£€éªŒä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">gradient_check</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">loss_fn</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;æ¢¯åº¦æ£€éªŒ&quot;&quot;&quot;</span>
    <span class="c1"># è‡ªåŠ¨å¾®åˆ†è®¡ç®—çš„æ¢¯åº¦</span>
    <span class="n">M_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_fn</span><span class="p">(</span><span class="n">msign</span><span class="p">(</span><span class="n">M_tensor</span><span class="p">))</span>
    <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
    <span class="n">grad_auto</span> <span class="o">=</span> <span class="n">M_tensor</span><span class="o">.</span><span class="n">grad</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="c1"># æœ‰é™å·®åˆ†è®¡ç®—çš„æ¢¯åº¦</span>
    <span class="n">grad_fd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">M_plus</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">M_plus</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">epsilon</span>
            <span class="n">M_minus</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">M_minus</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-=</span> <span class="n">epsilon</span>

            <span class="n">loss_plus</span> <span class="o">=</span> <span class="n">loss_fn</span><span class="p">(</span><span class="n">msign</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">M_plus</span><span class="p">)))</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="n">loss_minus</span> <span class="o">=</span> <span class="n">loss_fn</span><span class="p">(</span><span class="n">msign</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">M_minus</span><span class="p">)))</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

            <span class="n">grad_fd</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">loss_plus</span> <span class="o">-</span> <span class="n">loss_minus</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">epsilon</span><span class="p">)</span>

    <span class="c1"># æ¯”è¾ƒ</span>
    <span class="n">relative_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">grad_auto</span> <span class="o">-</span> <span class="n">grad_fd</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">grad_fd</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Relative error: </span><span class="si">{</span><span class="n">relative_error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">relative_error</span> <span class="o">&lt;</span> <span class="mf">1e-4</span>  <span class="c1"># é€šè¿‡é˜ˆå€¼</span>
</code></pre></div>

<p>å¦‚æœç›¸å¯¹è¯¯å·®å°äº$10^{-4}$ï¼Œåˆ™æ¢¯åº¦å®ç°åŸºæœ¬æ­£ç¡®ã€‚</p>
<h3 id="_14">é«˜é˜¶å¯¼æ•°</h3>
<p>åœ¨æŸäº›é«˜çº§åº”ç”¨ä¸­ï¼ˆå¦‚å…ƒå­¦ä¹ ã€è¶…å‚æ•°ä¼˜åŒ–ï¼‰ï¼Œå¯èƒ½éœ€è¦äºŒé˜¶å¯¼æ•°ï¼ˆHessianï¼‰ã€‚</p>
<p>$\msign$çš„äºŒé˜¶å¯¼æ•°å¯ä»¥é€šè¿‡å¯¹ä¸€é˜¶å¯¼æ•°å†æ¬¡åº”ç”¨FrÃ©chetå¯¼æ•°å¾—åˆ°ã€‚è®¾
\begin{equation}
\mathcal{D}^2<a href="\boldsymbol{M}">\msign</a>[\boldsymbol{H}_1, \boldsymbol{H}_2] = \mathcal{D}\left(\mathcal{D}<a href="\boldsymbol{M}">\msign</a>[\boldsymbol{H}_1]\right)[\boldsymbol{H}_2]
\end{equation}</p>
<p>ä»ä¸€é˜¶å¯¼æ•°çš„Sylvesteræ–¹ç¨‹
\begin{equation}
\boldsymbol{A}\boldsymbol{X} + \boldsymbol{X}\boldsymbol{B} = \boldsymbol{C}
\end{equation}</p>
<p>å¯¹$\boldsymbol{M}$å†æ¬¡æ±‚å¯¼ï¼Œå¾—åˆ°
\begin{equation}
(d\boldsymbol{A})\boldsymbol{X} + \boldsymbol{A}(d\boldsymbol{X}) + (d\boldsymbol{X})\boldsymbol{B} + \boldsymbol{X}(d\boldsymbol{B}) = d\boldsymbol{C}
\end{equation}</p>
<p>å…¶ä¸­$d\boldsymbol{A}, d\boldsymbol{B}, d\boldsymbol{C}$å¯ä»¥ä»ä¸€é˜¶å¯¼æ•°è®¡ç®—å¾—å‡ºï¼Œè€Œ$d\boldsymbol{X}$å°±æ˜¯æˆ‘ä»¬è¦æ±‚çš„äºŒé˜¶å¯¼æ•°ï¼Œå®ƒæ»¡è¶³å¦ä¸€ä¸ªSylvesteræ–¹ç¨‹ã€‚</p>
<p>è¿™ä¸ªè¿‡ç¨‹å¯ä»¥é€’å½’åœ°è¿›è¡Œï¼Œç†è®ºä¸Šå¯ä»¥è®¡ç®—ä»»æ„é˜¶å¯¼æ•°ï¼Œä½†å®é™…ä¸­å¾ˆå°‘éœ€è¦ä¸‰é˜¶åŠä»¥ä¸Šã€‚</p>
<h3 id="_15">å°ç»“</h3>
<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä»å¤šä¸ªè§’åº¦æ·±å…¥æ¢è®¨äº†$\msign$ç®—å­çš„å¯¼æ•°ç†è®ºï¼š</p>
<ol>
<li><strong>FrÃ©chetå¯¼æ•°æ¡†æ¶</strong>ï¼šå»ºç«‹äº†ä¸¥æ ¼çš„æ•°å­¦åŸºç¡€ï¼Œå®šä¹‰äº†çŸ©é˜µå‡½æ•°çš„å¯¼æ•°</li>
<li><strong>Lyapunovæ–¹ç¨‹æ–¹æ³•</strong>ï¼šå°†å¯¼æ•°è®¡ç®—è½¬åŒ–ä¸ºæ ‡å‡†çš„çº¿æ€§ä»£æ•°é—®é¢˜</li>
<li><strong>ç§¯åˆ†è¡¨ç¤ºå’Œè°±åˆ†è§£</strong>ï¼šæä¾›äº†å¦ä¸€ä¸ªç†è®ºè§†è§’ï¼Œæ­ç¤ºäº†ä¸å¥‡å¼‚å€¼/ç‰¹å¾å€¼çš„å…³ç³»</li>
<li><strong>åå‘ä¼ æ’­ç®—æ³•</strong>ï¼šç»™å‡ºäº†å®ç”¨çš„ã€GPUé«˜æ•ˆçš„æ¢¯åº¦è®¡ç®—æ–¹æ³•</li>
<li><strong>ä¸SVDå¯¼æ•°çš„è”ç³»</strong>ï¼šéªŒè¯äº†ä¸åŒæ–¹æ³•çš„ç­‰ä»·æ€§</li>
<li><strong>é“¾å¼æ³•åˆ™åº”ç”¨</strong>ï¼šå±•ç¤ºäº†å¦‚ä½•åœ¨å¤æ‚çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ä¸­ä½¿ç”¨$\msign$</li>
<li><strong>æ•°å€¼ç¨³å®šæ€§</strong>ï¼šè®¨è®ºäº†å®é™…å®ç°ä¸­çš„å„ç§æ•°å€¼é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ</li>
<li><strong>è®¡ç®—å¤æ‚åº¦</strong>ï¼šåˆ†æäº†ä¸åŒæ–¹æ³•çš„æ•ˆç‡ï¼ŒæŒ‡å‡ºäº†æœ€ä¼˜é€‰æ‹©</li>
</ol>
<p>è¿™äº›ç†è®ºå’ŒæŠ€æœ¯ä¸ºåœ¨TTT+Muonç­‰å…ˆè¿›æ¶æ„ä¸­ä½¿ç”¨$\msign$æä¾›äº†åšå®çš„åŸºç¡€ã€‚</p>
<h2 id="_16">æ–‡ç« å°ç»“</h2>
<p>æœ¬æ–‡è®¨è®ºäº†$\msign$ç®—å­çš„å¯¼æ•°è®¡ç®—ï¼Œå¦‚æœä½ å…³å¿ƒ"TTT + Muon"çš„ç»„åˆï¼Œé‚£ä¹ˆæœ¬æ–‡ä¹Ÿè®¸å¯¹ä½ æœ‰å¸®åŠ©ã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/11025">https://spaces.ac.cn/archives/11025</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Jun. 13, 2025). ã€Šmsignçš„å¯¼æ•° ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/11025">https://spaces.ac.cn/archives/11025</a></p>
<p>@online{kexuefm-11025,
title={msignçš„å¯¼æ•°},
author={è‹å‰‘æ—},
year={2025},
month={Jun},
url={\url{https://spaces.ac.cn/archives/11025}},
}</p>
        </div>
    </div>
</body>
</html>