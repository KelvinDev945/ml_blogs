<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆäºŒï¼‰ï¼šDDPM = è‡ªå›å½’å¼VAE</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆäºŒï¼‰ï¼šDDPM = è‡ªå›å½’å¼VAE</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-26 | ğŸ“„ å¤§å°: 77.5 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/9152">https://spaces.ac.cn/archives/9152</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>åœ¨æ–‡ç« <a href="/archives/9119">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆä¸€ï¼‰ï¼šDDPM = æ‹†æ¥¼ + å»ºæ¥¼ã€‹</a>ä¸­ï¼Œæˆ‘ä»¬ä¸ºç”Ÿæˆæ‰©æ•£æ¨¡å‹DDPMæ„å»ºäº†â€œæ‹†æ¥¼-å»ºæ¥¼â€çš„é€šä¿—ç±»æ¯”ï¼Œå¹¶ä¸”å€ŸåŠ©è¯¥ç±»æ¯”å®Œæ•´åœ°æ¨å¯¼äº†ç”Ÿæˆæ‰©æ•£æ¨¡å‹DDPMçš„ç†è®ºå½¢å¼ã€‚åœ¨è¯¥æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è¿˜æŒ‡å‡ºDDPMæœ¬è´¨ä¸Šå·²ç»ä¸æ˜¯ä¼ ç»Ÿçš„æ‰©æ•£æ¨¡å‹äº†ï¼Œå®ƒæ›´å¤šçš„æ˜¯ä¸€ä¸ªå˜åˆ†è‡ªç¼–ç å™¨VAEï¼Œå®é™…ä¸ŠDDPMçš„åŸè®ºæ–‡ä¸­ä¹Ÿæ˜¯å°†å®ƒæŒ‰ç…§VAEçš„æ€è·¯è¿›è¡Œæ¨å¯¼çš„ã€‚</p>
<p>æ‰€ä»¥ï¼Œæœ¬æ–‡å°±ä»VAEçš„è§’åº¦æ¥é‡æ–°ä»‹ç»ä¸€ç‰ˆDDPMï¼ŒåŒæ—¶åˆ†äº«ä¸€ä¸‹è‡ªå·±çš„Keraså®ç°ä»£ç å’Œå®è·µç»éªŒã€‚</p>
<h2 id="_1">å¤šæ­¥çªç ´</h2>
<p>åœ¨ä¼ ç»Ÿçš„VAEä¸­ï¼Œç¼–ç è¿‡ç¨‹å’Œç”Ÿæˆè¿‡ç¨‹éƒ½æ˜¯ä¸€æ­¥åˆ°ä½çš„ï¼š<br />
\begin{equation}\text{ç¼–ç :}\,\,x\to z\,,\quad \text{ç”Ÿæˆ:}\,\,z\to x\end{equation}<br />
è¿™æ ·åšå°±åªæ¶‰åŠåˆ°ä¸‰ä¸ªåˆ†å¸ƒï¼šç¼–ç åˆ†å¸ƒ$p(z|x)$ã€ç”Ÿæˆåˆ†å¸ƒ$q(x|z)$ä»¥åŠå…ˆéªŒåˆ†å¸ƒ$q(z)$ï¼Œå®ƒçš„å¥½å¤„æ˜¯å½¢å¼æ¯”è¾ƒç®€å•ï¼Œ$x$ä¸$z$ä¹‹é—´çš„æ˜ å°„å…³ç³»ä¹Ÿæ¯”è¾ƒç¡®å®šï¼Œå› æ­¤å¯ä»¥åŒæ—¶å¾—åˆ°ç¼–ç æ¨¡å‹å’Œç”Ÿæˆæ¨¡å‹ï¼Œå®ç°éšå˜é‡ç¼–è¾‘ç­‰éœ€æ±‚ï¼›ä½†æ˜¯å®ƒçš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå› ä¸ºæˆ‘ä»¬å»ºæ¨¡æ¦‚ç‡åˆ†å¸ƒçš„èƒ½åŠ›æœ‰é™ï¼Œè¿™ä¸‰ä¸ªåˆ†å¸ƒéƒ½åªèƒ½å»ºæ¨¡ä¸ºæ­£æ€åˆ†å¸ƒï¼Œè¿™é™åˆ¶äº†æ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ï¼Œæœ€ç»ˆé€šå¸¸å¾—åˆ°åæ¨¡ç³Šçš„ç”Ÿæˆç»“æœã€‚</p>
<p>ä¸ºäº†çªç ´è¿™ä¸ªé™åˆ¶ï¼ŒDDPMå°†ç¼–ç è¿‡ç¨‹å’Œç”Ÿæˆè¿‡ç¨‹åˆ†è§£ä¸º$T$æ­¥ï¼š<br />
\begin{equation}\begin{aligned}&amp;\text{ç¼–ç :}\,\,\boldsymbol{x} = \boldsymbol{x}<em T-1="T-1">0 \to \boldsymbol{x}_1 \to \boldsymbol{x}_2 \to \cdots \to \boldsymbol{x}</em>} \to \boldsymbol{x<em T-1="T-1">T = \boldsymbol{z} \\\<br />
&amp;\text{ç”Ÿæˆ:}\,\,\boldsymbol{z} = \boldsymbol{x}_T \to \boldsymbol{x}</em>} \to \boldsymbol{x<em t-1="t-1">{T-2} \to \cdots \to \boldsymbol{x}_1 \to \boldsymbol{x}_0 = \boldsymbol{x}<br />
\end{aligned}\label{eq:factor}\end{equation}<br />
è¿™æ ·ä¸€æ¥ï¼Œæ¯ä¸€ä¸ª$p(\boldsymbol{x}_t|\boldsymbol{x}</em>_t)$ä»…ä»…è´Ÿè´£å»ºæ¨¡ä¸€ä¸ªå¾®å°å˜åŒ–ï¼Œå®ƒä»¬ä¾ç„¶å»ºæ¨¡ä¸ºæ­£æ€åˆ†å¸ƒã€‚å¯èƒ½è¯»ç€å°±æƒ³é—®äº†ï¼šé‚£æ—¢ç„¶åŒæ ·æ˜¯æ­£æ€åˆ†å¸ƒï¼Œä¸ºä»€ä¹ˆåˆ†è§£ä¸ºå¤šæ­¥ä¼šæ¯”å•æ­¥è¦å¥½ï¼Ÿè¿™æ˜¯å› ä¸ºå¯¹äºå¾®å°å˜åŒ–æ¥è¯´ï¼Œå¯ä»¥ç”¨æ­£æ€åˆ†å¸ƒè¶³å¤Ÿè¿‘ä¼¼åœ°å»ºæ¨¡ï¼Œç±»ä¼¼äºæ›²çº¿åœ¨å°èŒƒå›´å†…å¯ä»¥ç”¨ç›´çº¿è¿‘ä¼¼ï¼Œå¤šæ­¥åˆ†è§£å°±æœ‰ç‚¹åƒç”¨åˆ†æ®µçº¿æ€§å‡½æ•°æ‹Ÿåˆå¤æ‚æ›²çº¿ï¼Œå› æ­¤ç†è®ºä¸Šå¯ä»¥çªç ´ä¼ ç»Ÿå•æ­¥VAEçš„æ‹Ÿåˆèƒ½åŠ›é™åˆ¶ã€‚})$å’Œ$q(\boldsymbol{x}_{t-1}|\boldsymbol{x</p>
<h2 id="_2">è”åˆæ•£åº¦</h2>
<p>æ‰€ä»¥ï¼Œç°åœ¨çš„è®¡åˆ’å°±æ˜¯é€šè¿‡é€’å½’å¼åˆ†è§£$\eqref{eq:factor}$æ¥å¢å¼ºä¼ ç»ŸVAEçš„èƒ½åŠ›ï¼Œæ¯ä¸€æ­¥ç¼–ç è¿‡ç¨‹è¢«å»ºæ¨¡æˆ$p(\boldsymbol{x}<em t-1="t-1">t|\boldsymbol{x}</em>})$ï¼Œæ¯ä¸€æ­¥ç”Ÿæˆè¿‡ç¨‹åˆ™è¢«å»ºæ¨¡æˆ$q(\boldsymbol{x<em T-1="T-1">{t-1}|\boldsymbol{x}_t)$ï¼Œç›¸åº”çš„è”åˆåˆ†å¸ƒå°±æ˜¯ï¼š<br />
\begin{equation}\begin{aligned}&amp;p(\boldsymbol{x}_0, \boldsymbol{x}_1, \boldsymbol{x}_2, \cdots, \boldsymbol{x}_T) = p(\boldsymbol{x}_T|\boldsymbol{x}</em>})\cdots p(\boldsymbol{x<em T-2="T-2">2|\boldsymbol{x}_1) p(\boldsymbol{x}_1|\boldsymbol{x}_0) \tilde{p}(\boldsymbol{x}_0) \\\<br />
&amp;q(\boldsymbol{x}_0, \boldsymbol{x}_1, \boldsymbol{x}_2, \cdots, \boldsymbol{x}_T) = q(\boldsymbol{x}_0|\boldsymbol{x}_1)\cdots q(\boldsymbol{x}</em>}|\boldsymbol{x<em T-1="T-1">{T-1}) q(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">T) q(\boldsymbol{x}_T)<br />
\end{aligned}\end{equation}<br />
åˆ«å¿˜äº†$\boldsymbol{x}_0$ä»£è¡¨çœŸå®æ ·æœ¬ï¼Œæ‰€ä»¥$\tilde{p}(\boldsymbol{x}_0)$å°±æ˜¯æ•°æ®åˆ†å¸ƒï¼›è€Œ$\boldsymbol{x}_T$ä»£è¡¨ç€æœ€ç»ˆçš„ç¼–ç ï¼Œæ‰€ä»¥$q(\boldsymbol{x}_T)$å°±æ˜¯å…ˆéªŒåˆ†å¸ƒï¼›å‰©ä¸‹çš„$p(\boldsymbol{x}_t|\boldsymbol{x}</em>_t)$å°±ä»£è¡¨ç€ç¼–ç ã€ç”Ÿæˆçš„ä¸€å°æ­¥ã€‚ï¼ˆ})$ã€$q(\boldsymbol{x}_{t-1}|\boldsymbol{x<strong>æç¤ºï¼š</strong> ç»è¿‡è€ƒè™‘ï¼Œè¿™é‡Œè¿˜æ˜¯æ²¿ç”¨æœ¬ç½‘ç«™ä»‹ç»VAEä¸€ç›´ç”¨çš„è®°å·ä¹ æƒ¯ï¼Œå³â€œç¼–ç åˆ†å¸ƒç”¨$p$ã€ç”Ÿæˆåˆ†å¸ƒç”¨$q$â€ï¼Œæ‰€ä»¥è¿™é‡Œçš„$p$ã€$q$å«ä¹‰è·ŸDDPMè®ºæ–‡æ˜¯åˆšå¥½ç›¸åçš„ï¼Œæœ›è¯»è€…çŸ¥æ‚‰ã€‚ï¼‰</p>
<p>åœ¨<a href="/archives/5343">ã€Šå˜åˆ†è‡ªç¼–ç å™¨ï¼ˆäºŒï¼‰ï¼šä»è´å¶æ–¯è§‚ç‚¹å‡ºå‘ã€‹</a>ä¸­ç¬”è€…å°±æå‡ºï¼Œç†è§£VAEçš„æœ€ç®€æ´çš„ç†è®ºé€”å¾„ï¼Œå°±æ˜¯å°†å…¶ç†è§£ä¸ºåœ¨æœ€å°åŒ–è”åˆåˆ†å¸ƒçš„KLæ•£åº¦ï¼Œå¯¹äºDDPMä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä¸Šé¢æˆ‘ä»¬å·²ç»å†™å‡ºäº†ä¸¤ä¸ªè”åˆåˆ†å¸ƒï¼Œæ‰€ä»¥DDPMçš„ç›®çš„å°±æ˜¯æœ€å°åŒ–<br />
\begin{equation}KL(p\Vert q) = \int p(\boldsymbol{x}<em T-1="T-1">T|\boldsymbol{x}</em>})\cdots p(\boldsymbol{x<em T-1="T-1">1|\boldsymbol{x}_0) \tilde{p}(\boldsymbol{x}_0) \log \frac{p(\boldsymbol{x}_T|\boldsymbol{x}</em>})\cdots p(\boldsymbol{x<em T-1="T-1">1|\boldsymbol{x}_0) \tilde{p}(\boldsymbol{x}_0)}{q(\boldsymbol{x}_0|\boldsymbol{x}_1)\cdots q(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">T) q(\boldsymbol{x}_T)} d\boldsymbol{x}_0 d\boldsymbol{x}_1\cdots d\boldsymbol{x}_T\label{eq:kl}\end{equation}<br />
è¿™å°±æ˜¯DDPMçš„ä¼˜åŒ–ç›®æ ‡äº†ã€‚åˆ°ç›®å‰ä¸ºæ­¢çš„ç»“æœï¼Œéƒ½è·ŸDDPMåŸè®ºæ–‡çš„ç»“æœä¸€æ ·çš„ï¼ˆåªæ˜¯è®°å·ç•¥æœ‰ä¸åŒï¼‰ï¼Œä¹Ÿè·Ÿæ›´åŸå§‹çš„è®ºæ–‡<a href="https://papers.cool/arxiv/1503.03585">ã€ŠDeep Unsupervised Learning using Nonequilibrium Thermodynamicsã€‹</a>ä¸€è‡´ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±è¦å°†$p(\boldsymbol{x}_t|\boldsymbol{x}</em>$ã€‚})$ã€$q(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t)$å…·ä½“å½¢å¼å®šä¸‹æ¥ï¼Œç„¶åç®€åŒ–DDPMçš„ä¼˜åŒ–ç›®æ ‡$\eqref{eq:kl</p>
<h2 id="_3">åˆ†è€Œæ²»ä¹‹</h2>
<p>é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ï¼ŒDDPMåªæ˜¯æƒ³åšä¸€ä¸ªç”Ÿæˆæ¨¡å‹ï¼Œæ‰€ä»¥å®ƒåªæ˜¯å°†æ¯ä¸€æ­¥çš„ç¼–ç å»ºç«‹ä¸ºæç®€å•çš„æ­£æ€åˆ†å¸ƒï¼š$p(\boldsymbol{x}<em t-1="t-1">t|\boldsymbol{x}</em>})=\mathcal{N}(\boldsymbol{x<em t-1="t-1">t;\alpha_t \boldsymbol{x}</em>}, \beta_t^2 \boldsymbol{I})$ï¼Œå…¶ä¸»è¦çš„ç‰¹ç‚¹æ˜¯å‡å€¼å‘é‡ä»…ä»…ç”±è¾“å…¥$\boldsymbol{x<em t-1="t-1">{t-1}$ä¹˜ä»¥ä¸€ä¸ªæ ‡é‡$\alpha_t$å¾—åˆ°ï¼Œç›¸æ¯”ä¹‹ä¸‹ä¼ ç»ŸVAEçš„å‡å€¼æ–¹å·®éƒ½æ˜¯ç”¨ç¥ç»ç½‘ç»œå­¦ä¹ å‡ºæ¥çš„ï¼Œå› æ­¤DDPMæ˜¯æ”¾å¼ƒäº†æ¨¡å‹çš„ç¼–ç èƒ½åŠ›ï¼Œæœ€ç»ˆåªå¾—åˆ°ä¸€ä¸ªçº¯ç²¹çš„ç”Ÿæˆæ¨¡å‹ï¼›è‡³äº$q(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t)$ï¼Œåˆ™è¢«å»ºæ¨¡æˆå‡å€¼å‘é‡å¯å­¦ä¹ çš„æ­£æ€åˆ†å¸ƒ$\mathcal{N}(\boldsymbol{x}</em>_t)$ã€‚ï¼ˆ};\boldsymbol{\mu}(\boldsymbol{x}_t), \sigma_t^2 \boldsymbol{I})$ã€‚å…¶ä¸­$\alpha_t,\beta_t,\sigma_t$éƒ½ä¸æ˜¯å¯è®­ç»ƒå‚æ•°ï¼Œè€Œæ˜¯äº‹å…ˆè®¾å®šå¥½çš„å€¼ï¼ˆæ€ä¹ˆè®¾ç½®æˆ‘ä»¬ç¨åè®¨è®ºï¼‰ï¼Œæ‰€ä»¥æ•´ä¸ªæ¨¡å‹æ‹¥æœ‰å¯è®­ç»ƒå‚æ•°çš„å°±åªæœ‰$\boldsymbol{\mu}(\boldsymbol{x<strong>æç¤ºï¼š</strong> æœ¬æ–‡$\alpha_t,\beta_t$çš„å®šä¹‰è·ŸåŸè®ºæ–‡ä¸ä¸€æ ·ã€‚ï¼‰</p>
<p>ç”±äºç›®å‰åˆ†å¸ƒ$p$ä¸å«ä»»ä½•çš„å¯è®­ç»ƒå‚æ•°ï¼Œå› æ­¤ç›®æ ‡$\eqref{eq:kl}$ä¸­å…³äº$p$çš„ç§¯åˆ†å°±åªæ˜¯è´¡çŒ®ä¸€ä¸ªå¯ä»¥å¿½ç•¥çš„å¸¸æ•°ï¼Œæ‰€ä»¥ç›®æ ‡$\eqref{eq:kl}$ç­‰ä»·äº<br />
\begin{equation}\begin{aligned}&amp;\,-\int p(\boldsymbol{x}<em T-1="T-1">T|\boldsymbol{x}</em>})\cdots p(\boldsymbol{x<em T-1="T-1">1|\boldsymbol{x}_0) \tilde{p}(\boldsymbol{x}_0) \log q(\boldsymbol{x}_0|\boldsymbol{x}_1)\cdots q(\boldsymbol{x}</em>}|\boldsymbol{x<em T-1="T-1">T) q(\boldsymbol{x}_T) d\boldsymbol{x}_0 d\boldsymbol{x}_1\cdots d\boldsymbol{x}_T \\\<br />
=&amp;\,-\int p(\boldsymbol{x}_T|\boldsymbol{x}</em>})\cdots p(\boldsymbol{x<em t="1">1|\boldsymbol{x}_0) \tilde{p}(\boldsymbol{x}_0) \left[\log q(\boldsymbol{x}_T) + \sum</em>}^T\log q(\boldsymbol{x<em T-1="T-1">{t-1}|\boldsymbol{x}_t)\right] d\boldsymbol{x}_0 d\boldsymbol{x}_1\cdots d\boldsymbol{x}_T<br />
\end{aligned}\end{equation}<br />
ç”±äºå…ˆéªŒåˆ†å¸ƒ$q(\boldsymbol{x}_T)$ä¸€èˆ¬éƒ½å–æ ‡å‡†æ­£æ€åˆ†å¸ƒï¼Œä¹Ÿæ˜¯æ²¡æœ‰å‚æ•°çš„ï¼Œæ‰€ä»¥è¿™ä¸€é¡¹ä¹Ÿåªæ˜¯è´¡çŒ®ä¸€ä¸ªå¸¸æ•°ã€‚å› æ­¤éœ€è¦è®¡ç®—çš„å°±æ˜¯æ¯ä¸€é¡¹<br />
\begin{equation}\begin{aligned}&amp;\,-\int p(\boldsymbol{x}_T|\boldsymbol{x}</em>})\cdots p(\boldsymbol{x<em t-1="t-1">1|\boldsymbol{x}_0) \tilde{p}(\boldsymbol{x}_0) \log q(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t) d\boldsymbol{x}_0 d\boldsymbol{x}_1\cdots d\boldsymbol{x}_T\\\<br />
=&amp;\,-\int p(\boldsymbol{x}_t|\boldsymbol{x}</em>})\cdots p(\boldsymbol{x<em t-1="t-1">1|\boldsymbol{x}_0) \tilde{p}(\boldsymbol{x}_0) \log q(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t) d\boldsymbol{x}_0 d\boldsymbol{x}_1\cdots d\boldsymbol{x}_t\\\<br />
=&amp;\,-\int p(\boldsymbol{x}_t|\boldsymbol{x}</em>})p(\boldsymbol{x<em t-1="t-1">{t-1}|\boldsymbol{x}_0) \tilde{p}(\boldsymbol{x}_0) \log q(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t) d\boldsymbol{x}_0 d\boldsymbol{x}</em>}d\boldsymbol{x<em t-1="t-1">t<br />
\end{aligned}\end{equation}<br />
å…¶ä¸­ç¬¬ä¸€ä¸ªç­‰å·æ˜¯å› ä¸º$q(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t)$è‡³å¤šä¾èµ–åˆ°$\boldsymbol{x}_t$ï¼Œå› æ­¤$t+1$åˆ°$T$çš„åˆ†å¸ƒå¯ä»¥ç›´æ¥ç§¯åˆ†ä¸º1ï¼›ç¬¬äºŒä¸ªç­‰å·åˆ™æ˜¯å› ä¸º$q(\boldsymbol{x}</em>}|\boldsymbol{x<em t-2="t-2">t)$ä¹Ÿä¸ä¾èµ–äº$\boldsymbol{x}_1,\cdots,\boldsymbol{x}</em>}$ï¼Œæ‰€ä»¥å…³äºå®ƒä»¬çš„ç§¯åˆ†æˆ‘ä»¬ä¹Ÿå¯ä»¥äº‹å…ˆç®—å‡ºï¼Œç»“æœä¸º$p(\boldsymbol{x<em t-1="t-1">{t-1}|\boldsymbol{x}_0)=\mathcal{N}(\boldsymbol{x}</em>};\bar{\alpha<em t-1="t-1">{t-1} \boldsymbol{x}_0, \bar{\beta}</em>$ã€‚}^2 \boldsymbol{I})$ï¼Œè¯¥ç»“æœå¯ä»¥å‚è€ƒä¸‹ä¸€èŠ‚çš„å¼$\eqref{eq:x0-xt</p>
<h2 id="_4">åœºæ™¯å†ç°</h2>
<p>æ¥ä¸‹æ¥çš„è¿‡ç¨‹å°±è·Ÿä¸Šä¸€ç¯‡æ–‡ç« çš„â€œ<a href="/archives/9119#%E5%8F%88%E5%A6%82%E4%BD%95%E5%BB%BA">åˆå¦‚ä½•å»º</a>â€ä¸€èŠ‚åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„äº†ï¼š</p>
<blockquote>
<p>1ã€é™¤å»ä¼˜åŒ–æ— å…³çš„å¸¸æ•°ï¼Œ$-\log q(\boldsymbol{x}<em t-1="t-1">{t-1}|\boldsymbol{x}_t)$è¿™ä¸€é¡¹æ‰€è´¡çŒ®çš„å°±æ˜¯$\frac{1}{2\sigma_t^2}\left\Vert\boldsymbol{x}</em>_t)\right\Vert^2$ï¼›} - \boldsymbol{\mu}(\boldsymbol{x</p>
<p>2ã€$p(\boldsymbol{x}<em t-1="t-1">{t-1}|\boldsymbol{x}_0)$æ„å‘³ç€$\boldsymbol{x}</em>} = \bar{\alpha<em t-1="t-1">{t-1}\boldsymbol{x}_0 + \bar{\beta}</em>}\bar{\boldsymbol{\varepsilon}<em t-1="t-1">{t-1}$ï¼Œ$p(\boldsymbol{x}_t|\boldsymbol{x}</em>})$åˆæ„å‘³ç€$\boldsymbol{x<em t-1="t-1">t = \alpha_t \boldsymbol{x}</em>} + \beta_t \boldsymbol{\varepsilon<em t-1="t-1">t$ï¼Œå…¶ä¸­$\bar{\boldsymbol{\varepsilon}}</em>)$ï¼›},\boldsymbol{\varepsilon}_t\sim \mathcal{N}(\boldsymbol{0},\boldsymbol{I</p>
<p>3ã€ç”±$\boldsymbol{x}<em _boldsymbol_theta="\boldsymbol{\theta">{t-1} = \frac{1}{\alpha_t}\left(\boldsymbol{x}_t - \beta_t \boldsymbol{\varepsilon}_t\right)$åˆ™å¯å‘æˆ‘ä»¬å°†$\boldsymbol{\mu}(\boldsymbol{x}_t)$å‚æ•°åŒ–ä¸º$\boldsymbol{\mu}(\boldsymbol{x}_t) = \frac{1}{\alpha_t}\left(\boldsymbol{x}_t - \beta_t \boldsymbol{\epsilon}</em>_t, t)\right)$ã€‚}}(\boldsymbol{x</p>
</blockquote>
<p>è¿™ä¸€ç³»åˆ—å˜æ¢ä¸‹æ¥ï¼Œä¼˜åŒ–ç›®æ ‡ç­‰ä»·äº<br />
\begin{equation}\frac{\beta_t^2}{\alpha_t^2\sigma_t^2}\mathbb{E}<em t-1="t-1">{\bar{\boldsymbol{\varepsilon}}</em>},\boldsymbol{\varepsilon<em _boldsymbol_theta="\boldsymbol{\theta">t\sim \mathcal{N}(\boldsymbol{0},\boldsymbol{I}),\boldsymbol{x}_0\sim \tilde{p}(\boldsymbol{x}_0)}\left[\left\Vert \boldsymbol{\varepsilon}_t - \boldsymbol{\epsilon}</em>}}(\bar{\alpha<em t-1="t-1">t\boldsymbol{x}_0 + \alpha_t\bar{\beta}</em>}\bar{\boldsymbol{\varepsilon}<em _boldsymbol_varepsilon="\boldsymbol{\varepsilon">{t-1} + \beta_t \boldsymbol{\varepsilon}_t, t)\right\Vert^2\right]\end{equation}<br />
éšåæŒ‰ç…§â€œ<a href="/archives/9119#%E9%99%8D%E4%BD%8E%E6%96%B9%E5%B7%AE">é™ä½æ–¹å·®</a>â€ä¸€èŠ‚åšæ¢å…ƒï¼Œç»“æœå°±æ˜¯<br />
\begin{equation}\frac{\beta_t^4}{\bar{\beta}_t^2\alpha_t^2\sigma_t^2}\mathbb{E}</em>}\sim \mathcal{N}(\boldsymbol{0},\boldsymbol{I}),\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">0\sim \tilde{p}(\boldsymbol{x}_0)}\left[\left\Vert\boldsymbol{\varepsilon} - \frac{\bar{\beta}_t}{\beta_t}\boldsymbol{\epsilon}</em>}}(\bar{\alpha}_t\boldsymbol{x}_0 + \bar{\beta}_t\boldsymbol{\varepsilon}, t)\right\Vert^2\right]\label{eq:loss}\end{equation<br />
è¿™å°±å¾—åˆ°äº†DDPMçš„è®­ç»ƒç›®æ ‡äº†ï¼ˆåŸè®ºæ–‡é€šè¿‡å®éªŒå‘ç°ï¼Œå»æ‰ä¸Šå¼å‰é¢çš„ç³»æ•°åå®é™…æ•ˆæœæ›´å¥½äº›ï¼‰ã€‚å®ƒæ˜¯æˆ‘ä»¬ä»VAEçš„ä¼˜åŒ–ç›®æ ‡å‡ºå‘ï¼Œé€æ­¥ç®€åŒ–ç§¯åˆ†ç»“æœå¾—åˆ°çš„ï¼Œè™½ç„¶æœ‰ç‚¹é•¿ï¼Œä½†æ¯ä¸€æ­¥éƒ½æ˜¯æœ‰ç« å¯å¾ªçš„ï¼Œæœ‰è®¡ç®—éš¾åº¦ï¼Œä½†æ²¡æœ‰æ€è·¯ä¸Šçš„éš¾åº¦ã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼ŒDDPMçš„åŸè®ºæ–‡ä¸­ï¼Œå¾ˆçªå…€å¼•å…¥äº†ä¸€ä¸ª$q(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t,\boldsymbol{x}_0)$ï¼ˆåŸè®ºæ–‡è®°å·ï¼‰æ¥è¿›è¡Œè£‚é¡¹ç›¸æ¶ˆï¼Œç„¶åè½¬åŒ–ä¸ºæ­£æ€åˆ†å¸ƒçš„KLæ•£åº¦å½¢å¼ã€‚æ•´ä¸ªè¿‡ç¨‹çš„è¿™ä¸€æ­¥æŠ€å·§æ€§å¤ªå¼ºï¼Œæ˜¾å¾—å¤ªè¿‡â€œè«åå…¶å¦™â€ï¼Œå¯¹ç¬”è€…æ¥è¯´ç›¸å½“éš¾ä»¥æ¥å—ã€‚</p>
<h2 id="_5">è¶…å‚è®¾ç½®</h2>
<p>è¿™ä¸€èŠ‚æˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹$\alpha_t,\beta_t,\sigma_t$çš„é€‰æ‹©é—®é¢˜ã€‚</p>
<p>å¯¹äº$p(\boldsymbol{x}<em t-1="t-1">t|\boldsymbol{x}</em>)$æ¥è¯´ï¼Œä¹ æƒ¯ä¸Šçº¦å®š$\alpha_t^2 + \beta_t^2=1$ï¼Œè¿™æ ·å°±å‡å°‘äº†ä¸€åŠçš„å‚æ•°äº†ï¼Œå¹¶ä¸”æœ‰åŠ©äºç®€åŒ–å½¢å¼ï¼Œè¿™å…¶å®åœ¨ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬å·²ç»æ¨å¯¼è¿‡äº†ï¼Œç”±äºæ­£æ€åˆ†å¸ƒçš„å åŠ æ€§ï¼Œåœ¨æ­¤çº¦æŸä¹‹ä¸‹æˆ‘ä»¬æœ‰<br />
\begin{equation}p(\boldsymbol{x}<em t-1="t-1">t|\boldsymbol{x}_0) = \int p(\boldsymbol{x}_t|\boldsymbol{x}</em>})\cdots p(\boldsymbol{x<em t-1="t-1">1|\boldsymbol{x}_0) d\boldsymbol{x}_1\cdots d\boldsymbol{x}</em>} = \mathcal{N}(\boldsymbol{x<em t-1="t-1">t;\bar{\alpha}_t \boldsymbol{x}_0, \bar{\beta}_t^2 \boldsymbol{I})\label{eq:x0-xt}\end{equation}<br />
å…¶ä¸­$\bar{\alpha}_t = \alpha_1\cdots\alpha_t$ï¼Œè€Œ$\bar{\beta}_t = \sqrt{1-\bar{\alpha}_t^2}$ï¼Œè¿™æ ·ä¸€æ¥$p(\boldsymbol{x}_t|\boldsymbol{x}_0)$å°±å…·æœ‰æ¯”è¾ƒç®€çº¦çš„å½¢å¼ã€‚å¯èƒ½è¯»è€…åˆæƒ³é—®äº‹å‰æ˜¯æ€ä¹ˆæƒ³åˆ°$\alpha_t^2 + \beta_t^2=1$è¿™ä¸ªçº¦æŸå‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“$\mathcal{N}(\boldsymbol{x}_t;\alpha_t \boldsymbol{x}</em>}, \beta_t^2 \boldsymbol{I})$æ„å‘³ç€$\boldsymbol{x<em t-1="t-1">t = \alpha_t \boldsymbol{x}</em>} + \beta_t \boldsymbol{\varepsilon<em t-1="t-1">t,\boldsymbol{\varepsilon}_t\sim \mathcal{N}(\boldsymbol{0},\boldsymbol{I})$ï¼Œå¦‚æœ$\boldsymbol{x}</em>)$ï¼Œæ‰€ä»¥å°±ç¡®å®šäº†$\alpha_t^2+\beta_t^2=1$äº†ã€‚}$ä¹Ÿæ˜¯$\sim \mathcal{N}(\boldsymbol{0},\boldsymbol{I})$çš„è¯ï¼Œæˆ‘ä»¬å°±å¸Œæœ›$\boldsymbol{x}_t$ä¹Ÿæ˜¯$\sim \mathcal{N}(\boldsymbol{0},\boldsymbol{I</p>
<p>å‰é¢è¯´äº†ï¼Œ$q(\boldsymbol{x}<em T-1="T-1">T)$ä¸€èˆ¬éƒ½å–æ ‡å‡†æ­£æ€åˆ†å¸ƒ$\mathcal{N}(\boldsymbol{x}_T;\boldsymbol{0}, \boldsymbol{I})$ã€‚è€Œæˆ‘ä»¬çš„å­¦ä¹ ç›®æ ‡æ˜¯æœ€å°åŒ–ä¸¤ä¸ªè”åˆåˆ†å¸ƒçš„KLæ•£åº¦ï¼Œå³å¸Œæœ›$p=q$ï¼Œé‚£ä¹ˆå®ƒä»¬çš„è¾¹ç¼˜åˆ†å¸ƒè‡ªç„¶ä¹Ÿç›¸ç­‰ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¸Œæœ›<br />
\begin{equation}q(\boldsymbol{x}_T) = \int p(\boldsymbol{x}_T|\boldsymbol{x}</em>})\cdots p(\boldsymbol{x<em T-1="T-1">1|\boldsymbol{x}_0) \tilde{p}(\boldsymbol{x}_0) d\boldsymbol{x}_0 d\boldsymbol{x}_1\cdots d\boldsymbol{x}</em>} = \int p(\boldsymbol{x}_T|\boldsymbol{x}_0) \tilde{p}(\boldsymbol{x}_0) d\boldsymbol{x}_0 \end{equation<br />
ç”±äºæ•°æ®åˆ†å¸ƒ$\tilde{p}(\boldsymbol{x}_0)$æ˜¯ä»»æ„çš„ï¼Œæ‰€ä»¥è¦ä½¿ä¸Šå¼æ’æˆç«‹ï¼Œåªèƒ½è®©$p(\boldsymbol{x}_T|\boldsymbol{x}_0)=q(\boldsymbol{x}_T)$ï¼Œå³é€€åŒ–ä¸ºä¸$\boldsymbol{x}_0$æ— å…³çš„æ ‡å‡†æ­£æ€åˆ†å¸ƒï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬è¦è®¾è®¡é€‚å½“çš„$\alpha_t$ï¼Œä½¿å¾—$\bar{\alpha}_T\approx 0$ã€‚åŒæ—¶è¿™å†æ¬¡å‘Šè¯‰æˆ‘ä»¬ï¼ŒDDPMæ˜¯æ²¡æœ‰ç¼–ç èƒ½åŠ›äº†ï¼Œæœ€ç»ˆçš„$p(\boldsymbol{x}_T|\boldsymbol{x}_0)$å¯ä»¥è¯´è·Ÿè¾“å…¥$\boldsymbol{x}_0$æ— å…³çš„ã€‚ç”¨ä¸Šä¸€ç¯‡æ–‡ç« çš„â€œæ‹†æ¥¼-å»ºæ¥¼â€ç±»æ¯”å°±æ˜¯è¯´ï¼ŒåŸæ¥çš„æ¥¼å·²ç»è¢«å®Œå…¨æ‹†æˆåŸææ–™äº†ï¼Œå¦‚æœç”¨è¿™å †ææ–™é‡æ–°å»ºæ¥¼çš„è¯ï¼Œå¯ä»¥å»ºæˆä»»æ„æ ·å­çš„æ¥¼ï¼Œè€Œä¸ä¸€å®šæ˜¯æ‹†ä¹‹å‰çš„æ ·å­ã€‚DDPMå–äº†$\alpha_t = \sqrt{1 - \frac{0.02t}{T}}$ï¼Œå…³äºè¯¥é€‰æ‹©çš„æ€§è´¨ï¼Œæˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« çš„â€œ<a href="/archives/9119#%E8%B6%85%E5%8F%82%E8%AE%BE%E7%BD%AE">è¶…å‚è®¾ç½®</a>â€ä¸€èŠ‚ä¹Ÿåˆ†æè¿‡äº†ã€‚</p>
<p>è‡³äº$\sigma_t$ï¼Œç†è®ºä¸Šä¸åŒçš„æ•°æ®åˆ†å¸ƒ$\tilde{p}(\boldsymbol{x}_0)$æ¥è¯´å¯¹åº”ä¸åŒçš„æœ€ä¼˜$\sigma_t$ï¼Œä½†æˆ‘ä»¬åˆä¸æƒ³å°†$\sigma_t$è®¾ä¸ºå¯è®­ç»ƒå‚æ•°ï¼Œæ‰€ä»¥åªå¥½é€‰ä¸€äº›ç‰¹æ®Šçš„$\tilde{p}(\boldsymbol{x}_0)$æ¥æ¨å¯¼ç›¸åº”çš„æœ€ä¼˜$\sigma_t$ï¼Œå¹¶è®¤ä¸ºç”±ç‰¹ä¾‹æ¨å¯¼å‡ºæ¥çš„$\sigma_t$å¯ä»¥æ³›åŒ–åˆ°ä¸€èˆ¬çš„æ•°æ®åˆ†å¸ƒã€‚æˆ‘ä»¬å¯ä»¥è€ƒè™‘ä¸¤ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>
<blockquote>
<p>1ã€å‡è®¾è®­ç»ƒé›†åªæœ‰ä¸€ä¸ªæ ·æœ¬$\boldsymbol{x}<em t-1="t-1"><em>$ï¼Œå³$\tilde{p}(\boldsymbol{x}<em>0)$æ˜¯ç‹„æ‹‰å…‹åˆ†å¸ƒ$\delta(\boldsymbol{x}_0 - \boldsymbol{x}</em></em>)$ï¼Œå¯ä»¥æ¨å‡ºæœ€ä¼˜çš„$\sigma_t = \frac{\bar{\beta}</em>\beta_t$ï¼›}}{\bar{\beta}_t</p>
<p>2ã€å‡è®¾æ•°æ®åˆ†å¸ƒ$\tilde{p}(\boldsymbol{x}_0)$æœä»æ ‡å‡†æ­£æ€åˆ†å¸ƒï¼Œè¿™æ—¶å€™å¯ä»¥æ¨å‡ºæœ€ä¼˜çš„$\sigma_t = \beta_t$ã€‚</p>
</blockquote>
<p>å®éªŒç»“æœæ˜¾ç¤ºä¸¤ä¸ªé€‰æ‹©çš„è¡¨ç°æ˜¯ç›¸ä¼¼çš„ï¼Œå› æ­¤å¯ä»¥é€‰æ‹©ä»»æ„ä¸€ä¸ªè¿›è¡Œé‡‡æ ·ã€‚ä¸¤ä¸ªç»“æœçš„æ¨å¯¼è¿‡ç¨‹æœ‰ç‚¹é•¿ï¼Œæˆ‘ä»¬åé¢å†æ‹©æœºè®¨è®ºã€‚</p>
<h2 id="_6">å‚è€ƒå®ç°</h2>
<p>è¿™ä¹ˆç²¾å½©çš„æ¨¡å‹æ€ä¹ˆå¯ä»¥å°‘å¾—äº†Keraså®ç°ï¼Ÿä¸‹é¢æä¾›ç¬”è€…çš„å‚è€ƒå®ç°ï¼š</p>
<blockquote>
<p><strong>Githubåœ°å€ï¼š<a href="https://github.com/bojone/Keras-DDPM">https://github.com/bojone/Keras-DDPM</a></strong></p>
</blockquote>
<p>æ³¨æ„ï¼Œç¬”è€…çš„å®ç°å¹¶éä¸¥æ ¼æŒ‰ç…§DDPMåŸå§‹å¼€æºä»£ç æ¥è¿›è¡Œï¼Œè€Œæ˜¯æ ¹æ®è‡ªå·±çš„è®¾è®¡ç®€åŒ–äº†U-Netçš„æ¶æ„ï¼ˆæ¯”å¦‚ç‰¹å¾æ‹¼æ¥æ”¹ä¸ºç›¸åŠ ã€å»æ‰äº†Attentionç­‰ï¼‰ï¼Œä½¿å¾—å¯ä»¥å¿«é€Ÿå‡ºæ•ˆæœã€‚ç»æµ‹è¯•ï¼Œåœ¨å•å¼ 24Gæ˜¾å­˜çš„3090ä¸‹ï¼Œä»¥<code>blocks=1,batch_size=64</code>è®­ç»ƒ128*128å¤§å°çš„CelebA HQäººè„¸æ•°æ®é›†ï¼ŒåŠå¤©å°±èƒ½åˆè§æˆæ•ˆã€‚è®­ç»ƒ3å¤©åçš„é‡‡æ ·æ•ˆæœå¦‚ä¸‹ï¼š  </p>
<p><a href="/usr/uploads/2022/07/3342802728.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="ç¬”è€…è®­ç»ƒçš„DDPMé‡‡æ ·ç»“æœæ¼”ç¤º" src="/usr/uploads/2022/07/3342802728.png" /></a></p>
<p>ç¬”è€…è®­ç»ƒçš„DDPMé‡‡æ ·ç»“æœæ¼”ç¤º</p>
<p>åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œç¬”è€…æ€»ç»“å‡ºäº†å¦‚ä¸‹çš„å®è·µç»éªŒï¼š</p>
<blockquote>
<p>1ã€æŸå¤±å‡½æ•°ä¸èƒ½ç”¨mseï¼Œè€Œå¿…é¡»ç”¨æ¬§æ°è·ç¦»å¹³æ–¹ï¼Œä¸¤è€…çš„å·®åˆ«æ˜¯mseåœ¨æ¬§æ°è·ç¦»å¹³æ–¹åŸºç¡€ä¸Šé™¤ä»¥å›¾ç‰‡çš„$\text{å®½}\times\text{é«˜}\times\text{é€šé“æ•°}$ï¼Œè¿™ä¼šå¯¼è‡´æŸå¤±å€¼è¿‡å°ï¼Œéƒ¨åˆ†å‚æ•°çš„æ¢¯åº¦å¯èƒ½ä¼šè¢«å¿½ç•¥ä¸º0ï¼Œä»è€Œå¯¼è‡´è®­ç»ƒè¿‡ç¨‹å…ˆæ”¶æ•›åå‘æ•£ï¼Œè¯¥ç°è±¡ä¹Ÿç»å¸¸å‡ºç°äºä½ç²¾åº¦è®­ç»ƒä¸­ï¼Œå¯ä»¥å‚è€ƒ<a href="/archives/9059">ã€Šåœ¨bert4kerasä¸­ä½¿ç”¨æ··åˆç²¾åº¦å’ŒXLAåŠ é€Ÿè®­ç»ƒã€‹</a>ï¼›</p>
<p>2ã€å½’ä¸€åŒ–æ–¹å¼å¯ä»¥ç”¨Instance Normã€Layer Normã€Group Normç­‰ï¼Œä½†ä¸è¦ç”¨Batch Normï¼Œå› ä¸ºBatch Normå­˜åœ¨è®­ç»ƒå’Œæ¨ç†ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œå¯èƒ½å‡ºç°è®­ç»ƒæ•ˆæœç‰¹åˆ«å¥½ï¼Œé¢„æµ‹æ•ˆæœç‰¹åˆ«å·®çš„é—®é¢˜ï¼›</p>
<p>3ã€ç½‘ç»œç»“æ„æ²¡æœ‰å¿…è¦ç…§æ¬åŸè®ºæ–‡ï¼ŒåŸè®ºæ–‡æ˜¯ä¸ºäº†åˆ·SOTAå‘è®ºæ–‡ï¼Œç…§æ¬çš„è¯è‚¯å®šæ˜¯åˆå¤§åˆæ…¢çš„ï¼Œåªéœ€è¦æŒ‰ç…§U-Netçš„æ€è·¯è®¾è®¡è‡ªç¼–ç å™¨ï¼Œå°±åŸºæœ¬ä¸Šå¯ä»¥è®­ç»ƒå‡ºä¸ªå¤§æ¦‚æ•ˆæœäº†ï¼Œå› ä¸ºå°±ç›¸å½“äºæ˜¯ä¸ªçº¯ç²¹çš„å›å½’é—®é¢˜ï¼Œè¿˜æ˜¯å¾ˆå¥½è®­ç»ƒçš„ï¼›</p>
<p>4ã€å…³äºå‚æ•°$t$çš„ä¼ å…¥ï¼ŒåŸè®ºæ–‡ç”¨äº†<a href="/archives/8231">Sinusoidalä½ç½®ç¼–ç </a>ï¼Œç¬”è€…å‘ç°ç›´æ¥æ¢ä¸ºå¯è®­ç»ƒçš„Embeddingï¼Œæ•ˆæœä¹Ÿå·®ä¸å¤šï¼›</p>
<p>5ã€æŒ‰ç…§ä»¥å¾€æè¯­è¨€æ¨¡å‹é¢„è®­ç»ƒçš„ä¹ æƒ¯ï¼Œç¬”è€…ç”¨äº†LAMBä¼˜åŒ–å™¨ï¼Œå®ƒæ›´æ–¹ä¾¿è°ƒå­¦ä¹ ç‡ï¼ŒåŸºæœ¬ä¸Š$10^{-3}$çš„å­¦ä¹ ç‡å¯ä»¥é€‚ç”¨äºä»»æ„åˆå§‹åŒ–æ–¹å¼çš„æ¨¡å‹è®­ç»ƒã€‚</p>
</blockquote>
<h2 id="_7">ç»¼åˆè¯„ä»·</h2>
<p>ç»“åˆ<a href="/archives/9119">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆä¸€ï¼‰ï¼šDDPM = æ‹†æ¥¼ + å»ºæ¥¼ã€‹</a>å’Œæœ¬æ–‡çš„ä»‹ç»ï¼Œæƒ³å¿…è¯»è€…éƒ½å·²ç»å¯¹DDPMæœ‰è‡ªå·±çš„çœ‹æ³•äº†ï¼Œèƒ½åŸºæœ¬çœ‹å‡ºDDPMä¼˜ç‚¹ã€ç¼ºç‚¹ä»¥åŠç›¸åº”çš„æ”¹è¿›æ–¹å‘åœ¨å“ªäº†ã€‚</p>
<p>DDPMçš„ä¼˜ç‚¹å¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯å®¹æ˜“è®­ç»ƒï¼Œå¹¶ä¸”ç”Ÿæˆçš„å›¾ç‰‡ä¹Ÿæ¸…æ™°ã€‚è¿™ä¸ªå®¹æ˜“è®­ç»ƒæ˜¯ç›¸å¯¹GANè€Œè¨€çš„ï¼ŒGANæ˜¯ä¸€ä¸ª$\min\text{-}\max$è¿‡ç¨‹ï¼Œè®­ç»ƒä¸­çš„ä¸ç¡®å®šæ€§å¾ˆå¤§ï¼Œå®¹æ˜“å´©æºƒï¼Œè€ŒDDPMå°±çº¯ç²¹æ˜¯ä¸€ä¸ªå›å½’çš„æŸå¤±å‡½æ•°ï¼Œåªéœ€è¦çº¯ç²¹çš„æœ€å°åŒ–ï¼Œå› æ­¤è®­ç»ƒè¿‡ç¨‹éå¸¸å¹³ç¨³ã€‚åŒæ—¶ï¼Œç»è¿‡â€œæ‹†æ¥¼-å»ºæ¥¼â€çš„ç±»æ¯”ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å‘ç°DDPMåœ¨é€šä¿—ç†è§£æ–¹é¢å…¶å®ä¹Ÿä¸é€Šè‰²äºGANã€‚</p>
<p>ä¸è¿‡ï¼ŒDDPMçš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ã€‚é¦–å…ˆæœ€çªå‡ºçš„å°±æ˜¯é‡‡æ ·é€Ÿåº¦å¤ªæ…¢ï¼Œéœ€è¦æ‰§è¡Œæ¨¡å‹$T$æ­¥ï¼ˆåŸè®ºæ–‡$T=1000$æ‰èƒ½å®Œæˆé‡‡æ ·ï¼‰ï¼Œå¯ä»¥è¯´è¿™æ¯”GANçš„ä¸€æ­¥åˆ°ä½çš„é‡‡æ ·è¦æ…¢ä¸Š$T$å€ï¼Œåé¢æœ‰å¾ˆå¤šå·¥ä½œå¯¹è¿™ä¸€ç‚¹è¿›è¡Œæ”¹è¿›ï¼›å…¶æ¬¡ï¼Œåœ¨GANä¸­ï¼Œä»éšæœºå™ªå£°åˆ°ç”Ÿæˆæ ·æœ¬çš„è®­ç»ƒæ˜¯ä¸€ä¸ªç¡®å®šæ€§çš„å˜æ¢ï¼Œéšæœºå™ªå£°æ˜¯ç”Ÿæˆç»“æœçš„ä¸€ä¸ªè§£è€¦çš„éšå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œæ’å€¼ç”Ÿæˆï¼Œæˆ–è€…å¯¹ä¹‹ç¼–è¾‘ä»¥å®ç°æ§åˆ¶ç”Ÿæˆç­‰ï¼Œä½†æ˜¯DDPMä¸­ç”Ÿæˆè¿‡ç¨‹æ˜¯ä¸€ä¸ªå®Œå…¨éšæœºçš„è¿‡ç¨‹ï¼Œä¸¤è€…æ²¡æœ‰ç¡®å®šæ€§çš„å…³ç³»ï¼Œè¿™ç§ç¼–è¾‘ç”Ÿæˆå°±ä¸å­˜åœ¨äº†ã€‚DDPMåŸè®ºæ–‡è™½ç„¶ä¹Ÿæ¼”ç¤ºäº†æ’å€¼ç”Ÿæˆæ•ˆæœï¼Œä½†é‚£åªæ˜¯åœ¨åŸå§‹å›¾ç‰‡ä¸Šè¿›è¡Œæ’å€¼çš„ï¼Œç„¶åé€šè¿‡å™ªå£°æ¥æ¨¡ç³Šå›¾ç‰‡ï¼Œè®©æ¨¡å‹é‡æ–°â€œè„‘è¡¥â€å‡ºæ–°çš„å›¾ç‰‡ï¼Œè¿™ç§æ’å€¼å¾ˆéš¾åšåˆ°è¯­ä¹‰ä¸Šçš„èåˆã€‚</p>
<p>é™¤äº†é’ˆå¯¹ä¸Šè¿°ç¼ºç‚¹æ¥åšæ”¹è¿›å¤–ï¼ŒDDPMè¿˜æœ‰å…¶ä»–ä¸€äº›å¯åšçš„æ–¹å‘ï¼Œæ¯”å¦‚ç›®å‰æ¼”ç¤ºçš„DDPMéƒ½æ˜¯æ— æ¡ä»¶çš„ç”Ÿæˆï¼Œé‚£ä¹ˆå¾ˆè‡ªç„¶å°±æƒ³åˆ°æœ‰æ¡ä»¶çš„DDPMçš„ï¼Œå°±å¥½æ¯”ä»VAEåˆ°C-VAEã€ä»GANåˆ°C-GANä¸€æ ·ï¼Œè¿™ä¹Ÿæ˜¯å½“å‰æ‰©æ•£æ¨¡å‹çš„ä¸€ä¸ªä¸»æµåº”ç”¨ï¼Œæ¯”å¦‚ç”¨Googleçš„Imagenå°±åŒæ—¶åŒ…å«äº†ç”¨æ‰©æ•£æ¨¡å‹åšæ–‡æœ¬ç”Ÿæˆå›¾ç‰‡ä»¥åŠåšè¶…åˆ†è¾¨ç‡ï¼Œè¿™ä¸¤è€…æœ¬è´¨ä¸Šå°±æ˜¯æ¡ä»¶å¼æ‰©æ•£æ¨¡å‹äº†ï¼›å†æ¯”å¦‚ï¼Œç›®å‰çš„DDPMæ˜¯ä¸ºè¿ç»­å‹å˜é‡è®¾è®¡çš„ï¼Œä½†ä»å…¶æ€æƒ³æ¥è¯´åº”è¯¥ä¹Ÿæ˜¯é€‚ç”¨äºç¦»æ•£å‹æ•°æ®çš„ï¼Œé‚£ä¹ˆç¦»æ•£å‹æ•°æ®çš„DDPMæ€ä¹ˆè®¾è®¡å‘¢ï¼Ÿ</p>
<h2 id="_8">ç›¸å…³å·¥ä½œ</h2>
<p>è¯´åˆ°DDPMçš„ç›¸å…³å·¥ä½œï¼Œå¤šæ•°äººä¼šæƒ³åˆ°ä¼ ç»Ÿæ‰©æ•£æ¨¡å‹ã€èƒ½é‡æ¨¡å‹ç­‰å·¥ä½œï¼Œåˆæˆ–è€…æ˜¯å»å™ªè‡ªç¼–ç å™¨ç­‰å·¥ä½œï¼Œä½†ç¬”è€…æ¥ä¸‹æ¥æƒ³è¯´çš„ä¸æ˜¯è¿™äº›ï¼Œè€Œæ˜¯æœ¬åšå®¢ä¹‹å‰ä»‹ç»è¿‡çš„ã€ç”šè‡³å¯ä»¥è®¤ä¸ºDDPMå°±æ˜¯å®ƒçš„ç‰¹ä¾‹çš„<a href="/archives/7574">ã€Šå¼ºå¤§çš„NVAEï¼šä»¥åå†ä¹Ÿä¸èƒ½è¯´VAEç”Ÿæˆçš„å›¾åƒæ¨¡ç³Šäº†ã€‹</a>ã€‚</p>
<p>ç«™åœ¨VAEçš„è§†è§’æ¥çœ‹ï¼Œä¼ ç»ŸVAEç”Ÿæˆçš„å›¾ç‰‡éƒ½åæ¨¡ç³Šï¼Œè€ŒDDPMåªèƒ½ç®—æ˜¯ï¼ˆç¬”è€…æ‰€äº†è§£åˆ°çš„ï¼‰ç¬¬äºŒä¸ªèƒ½ç”Ÿæˆæ¸…æ™°å›¾åƒçš„VAEï¼Œç¬¬ä¸€ä¸ªæ­£æ˜¯NVAEã€‚ç¿»çœ‹NVAEçš„å½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å®ƒè·ŸDDPMæœ‰éå¸¸å¤šçš„ç›¸ä¼¼ä¹‹å¤„ï¼Œæ¯”å¦‚NVAEä¹Ÿæ˜¯å¼•å…¥äº†ä¸€å¤§å †éšå˜é‡$z=\{z_1,z_2,\dots,z_L\}$ï¼Œè¿™äº›éšå˜é‡ä¹Ÿå‘ˆé€’å½’å…³ç³»ï¼Œæ‰€ä»¥NVAEçš„é‡‡æ ·è¿‡ç¨‹è·ŸDDPMä¹Ÿæ˜¯å¾ˆç›¸ä¼¼çš„ã€‚</p>
<p>ä»ç†è®ºå½¢å¼æ¥è¯´ï¼ŒDDPMå¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªæåº¦ç®€åŒ–çš„NVAEï¼Œå³éšå˜é‡çš„é€’å½’å…³ç³»ä»…ä»…å»ºæ¨¡ä¸ºé©¬å°”å¯å¤«å¼çš„æ¡ä»¶æ­£æ€åˆ†å¸ƒï¼Œè€Œä¸æ˜¯åƒNVAEçš„éé©¬å°”ç§‘å¤«å¼ï¼Œç”Ÿæˆæ¨¡å‹ä¹Ÿåªæ˜¯åŒä¸€ä¸ªæ¨¡å‹çš„åå¤è¿­ä»£ï¼Œè€Œä¸æ˜¯NVAEé‚£æ ·ç”¨ä¸€ä¸ªåºå¤§çš„æ¨¡å‹åŒæ—¶ç”¨ä¸Šäº†$z=\{z_1,z_2,\dots,z_L\}$ï¼Œä½†NVAEåœ¨åˆ©ç”¨ä¼—å¤š$z=\{z_1,z_2,\dots,z_L\}$ä¹‹æ—¶ï¼Œä¹ŸåŠ å…¥äº†å‚æ•°å…±äº«æœºåˆ¶ï¼Œè¿™è·ŸåŒä¸€ä¸ªæ¨¡å‹åå¤è¿­ä»£ä¹Ÿå¼‚æ›²åŒå·¥äº†ã€‚</p>
<h2 id="_9">æ–‡ç« å°ç»“</h2>
<p>æœ¬æ–‡ä»å˜åˆ†è‡ªç¼–ç å™¨VAEçš„è§’åº¦æ¨å¯¼äº†DDPMï¼Œåœ¨è¿™ä¸ªè§†è§’ä¹‹ä¸‹ï¼ŒDDPMæ˜¯ä¸€ä¸ªç®€åŒ–ç‰ˆçš„è‡ªå›å½’å¼VAEï¼Œè·Ÿä¹‹å‰çš„NVAEå¾ˆæ˜¯ç›¸ä¼¼ã€‚åŒæ—¶æœ¬æ–‡åˆ†äº«äº†è‡ªå·±çš„DDPMå®ç°ä»£ç å’Œå®è·µç»éªŒï¼Œä»¥åŠå¯¹DDPMåšäº†ä¸€ä¸ªæ¯”è¾ƒç»¼åˆçš„è¯„ä»·ã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/9152">https://spaces.ac.cn/archives/9152</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Jul. 06, 2022). ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆäºŒï¼‰ï¼šDDPM = è‡ªå›å½’å¼VAE ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/9152">https://spaces.ac.cn/archives/9152</a></p>
<p>@online{kexuefm-9152,<br />
title={ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆäºŒï¼‰ï¼šDDPM = è‡ªå›å½’å¼VAE},<br />
author={è‹å‰‘æ—},<br />
year={2022},<br />
month={Jul},<br />
url={\url{https://spaces.ac.cn/archives/9152}},<br />
} </p>
<hr />
<h2 id="_10">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<h3 id="1">1. æ ¸å¿ƒæ¦‚å¿µä¸ç†è®ºæ¡†æ¶</h3>
<h4 id="11-vaeddpm">1.1 ä»ä¼ ç»ŸVAEåˆ°DDPM</h4>
<p><strong>ä¼ ç»ŸVAEçš„åŸºæœ¬ç»“æ„:</strong></p>
<p>åœ¨å˜åˆ†è‡ªç¼–ç å™¨(VAE)ä¸­,æˆ‘ä»¬æœ‰:
- <strong>ç¼–ç è¿‡ç¨‹:</strong> $\boldsymbol{x} \to \boldsymbol{z}$ (ä¸€æ­¥åˆ°ä½)
- <strong>ç”Ÿæˆè¿‡ç¨‹:</strong> $\boldsymbol{z} \to \boldsymbol{x}$ (ä¸€æ­¥åˆ°ä½)</p>
<p>æ¶‰åŠä¸‰ä¸ªæ ¸å¿ƒåˆ†å¸ƒ:
$$p(\boldsymbol{z}|\boldsymbol{x}): \text{ç¼–ç åˆ†å¸ƒ}, \quad q(\boldsymbol{x}|\boldsymbol{z}): \text{ç”Ÿæˆåˆ†å¸ƒ}, \quad q(\boldsymbol{z}): \text{å…ˆéªŒåˆ†å¸ƒ} \tag{1}$$</p>
<p><strong>ä¼ ç»ŸVAEçš„é™åˆ¶:</strong>
1. ç¼–ç å’Œç”Ÿæˆéƒ½åªæœ‰ä¸€æ­¥,æ˜ å°„å…³ç³»ç®€å•
2. é€šå¸¸åªèƒ½å»ºæ¨¡ä¸ºæ­£æ€åˆ†å¸ƒ,è¡¨è¾¾èƒ½åŠ›æœ‰é™
3. ç”Ÿæˆçš„å›¾åƒå¾€å¾€æ¨¡ç³Šä¸æ¸…</p>
<p><strong>DDPMçš„çªç ´:</strong></p>
<p>DDPMå°†ä¸€æ­¥å˜ä¸º$T$æ­¥,å½¢æˆé€’å½’å¼çš„ç¼–ç å’Œç”Ÿæˆ:
$$\begin{aligned}
\text{ç¼–ç :} \quad &\boldsymbol{x} = \boldsymbol{x}_0 \to \boldsymbol{x}_1 \to \boldsymbol{x}_2 \to \cdots \to \boldsymbol{x}_T = \boldsymbol{z} \\
\text{ç”Ÿæˆ:} \quad &\boldsymbol{z} = \boldsymbol{x}_T \to \boldsymbol{x}_{T-1} \to \boldsymbol{x}_{T-2} \to \cdots \to \boldsymbol{x}_0 = \boldsymbol{x}
\end{aligned} \tag{2}$$</p>
<p><strong>å…³é”®æ€æƒ³:</strong> æ¯ä¸€å°æ­¥åªå»ºæ¨¡å¾®å°å˜åŒ–,ä»ç”¨æ­£æ€åˆ†å¸ƒ,ä½†å¤šæ­¥ç´¯ç§¯å¯ä»¥é€¼è¿‘å¤æ‚åˆ†å¸ƒã€‚</p>
<p><strong>ç±»æ¯”:</strong> ç”¨åˆ†æ®µçº¿æ€§å‡½æ•°é€¼è¿‘å¤æ‚æ›²çº¿ã€‚</p>
<h4 id="12">1.2 å‰å‘æ‰©æ•£è¿‡ç¨‹çš„è®¾è®¡</h4>
<p><strong>æ¯ä¸€æ­¥çš„å‰å‘è¿‡ç¨‹:</strong>
$$p(\boldsymbol{x}_t|\boldsymbol{x}_{t-1}) = \mathcal{N}(\boldsymbol{x}_t; \alpha_t\boldsymbol{x}_{t-1}, \beta_t^2\boldsymbol{I}) \tag{3}$$</p>
<p><strong>å…³é”®ç‰¹ç‚¹:</strong>
1. <strong>å‡å€¼:</strong> åªæ˜¯è¾“å…¥ä¹˜ä»¥æ ‡é‡$\alpha_t$,ä¸éœ€è¦ç¥ç»ç½‘ç»œå­¦ä¹ 
2. <strong>æ–¹å·®:</strong> äº‹å…ˆè®¾å®šå¥½çš„$\beta_t^2$,ä¹Ÿä¸éœ€è¦å­¦ä¹ 
3. <strong>ç›®æ ‡:</strong> æ”¾å¼ƒç¼–ç èƒ½åŠ›,ä¸“æ³¨äºç”Ÿæˆ</p>
<p><strong>ç­‰ä»·é‡‡æ ·å½¢å¼:</strong>
$$\boldsymbol{x}_t = \alpha_t\boldsymbol{x}_{t-1} + \beta_t\boldsymbol{\varepsilon}_t, \quad \boldsymbol{\varepsilon}_t \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{I}) \tag{4}$$</p>
<p><strong>åå‘ç”Ÿæˆè¿‡ç¨‹:</strong>
$$q(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t) = \mathcal{N}(\boldsymbol{x}_{t-1}; \boldsymbol{\mu}(\boldsymbol{x}_t), \sigma_t^2\boldsymbol{I}) \tag{5}$$</p>
<p>å…¶ä¸­$\boldsymbol{\mu}(\boldsymbol{x}_t)$ç”±ç¥ç»ç½‘ç»œå­¦ä¹ ã€‚</p>
<h3 id="2-kl">2. è”åˆåˆ†å¸ƒä¸KLæ•£åº¦</h3>
<h4 id="21">2.1 è”åˆåˆ†å¸ƒçš„æ„é€ </h4>
<p><strong>å‰å‘è¿‡ç¨‹çš„è”åˆåˆ†å¸ƒ:</strong>
$$\begin{aligned}
p(\boldsymbol{x}_0, \boldsymbol{x}_1, \ldots, \boldsymbol{x}_T) &= p(\boldsymbol{x}_T|\boldsymbol{x}_{T-1}) \cdots p(\boldsymbol{x}_2|\boldsymbol{x}_1) p(\boldsymbol{x}_1|\boldsymbol{x}_0) \tilde{p}(\boldsymbol{x}_0) \\
&= \tilde{p}(\boldsymbol{x}_0) \prod_{t=1}^T p(\boldsymbol{x}_t|\boldsymbol{x}_{t-1})
\end{aligned} \tag{6}$$</p>
<p>å…¶ä¸­$\tilde{p}(\boldsymbol{x}_0)$æ˜¯æ•°æ®åˆ†å¸ƒã€‚</p>
<p><strong>åå‘è¿‡ç¨‹çš„è”åˆåˆ†å¸ƒ:</strong>
$$\begin{aligned}
q(\boldsymbol{x}_0, \boldsymbol{x}_1, \ldots, \boldsymbol{x}_T) &= q(\boldsymbol{x}_0|\boldsymbol{x}_1) \cdots q(\boldsymbol{x}_{T-2}|\boldsymbol{x}_{T-1}) q(\boldsymbol{x}_{T-1}|\boldsymbol{x}_T) q(\boldsymbol{x}_T) \\
&= q(\boldsymbol{x}_T) \prod_{t=1}^T q(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t)
\end{aligned} \tag{7}$$</p>
<p>å…¶ä¸­$q(\boldsymbol{x}_T)$æ˜¯å…ˆéªŒåˆ†å¸ƒ(é€šå¸¸ä¸º$\mathcal{N}(\boldsymbol{0}, \boldsymbol{I})$)ã€‚</p>
<h4 id="22-vae">2.2 VAEçš„æœ€ç®€æ´ç†è§£</h4>
<p><strong>æ ¸å¿ƒä¼˜åŒ–ç›®æ ‡:</strong> æœ€å°åŒ–ä¸¤ä¸ªè”åˆåˆ†å¸ƒçš„KLæ•£åº¦ã€‚
$$\mathcal{L} = KL(p \| q) = \int p(\boldsymbol{x}_0, \ldots, \boldsymbol{x}_T) \log \frac{p(\boldsymbol{x}_0, \ldots, \boldsymbol{x}_T)}{q(\boldsymbol{x}_0, \ldots, \boldsymbol{x}_T)} d\boldsymbol{x}_0 \cdots d\boldsymbol{x}_T \tag{8}$$</p>
<p><strong>å±•å¼€:</strong>
$$\begin{aligned}
\mathcal{L} &= \int p(\boldsymbol{x}_0, \ldots, \boldsymbol{x}_T) \left[\log p(\boldsymbol{x}_0, \ldots, \boldsymbol{x}_T) - \log q(\boldsymbol{x}_0, \ldots, \boldsymbol{x}_T)\right] d\boldsymbol{x}_0 \cdots d\boldsymbol{x}_T \\
&= \mathbb{E}_{p(\boldsymbol{x}_0, \ldots, \boldsymbol{x}_T)}\left[\log p(\boldsymbol{x}_0, \ldots, \boldsymbol{x}_T) - \log q(\boldsymbol{x}_0, \ldots, \boldsymbol{x}_T)\right]
\end{aligned} \tag{9}$$</p>
<p><strong>ä»£å…¥è”åˆåˆ†å¸ƒ:</strong>
$$\begin{aligned}
\mathcal{L} &= \mathbb{E}_{p}\left[\log \tilde{p}(\boldsymbol{x}_0) + \sum_{t=1}^T \log p(\boldsymbol{x}_t|\boldsymbol{x}_{t-1}) - \log q(\boldsymbol{x}_T) - \sum_{t=1}^T \log q(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t)\right]
\end{aligned} \tag{10}$$</p>
<h3 id="3">3. ç›®æ ‡å‡½æ•°çš„ç®€åŒ–</h3>
<h4 id="31">3.1 å»é™¤å¸¸æ•°é¡¹</h4>
<p><strong>è§‚å¯Ÿ1:</strong> å‰å‘åˆ†å¸ƒ$p(\boldsymbol{x}<em t-1="t-1">t|\boldsymbol{x}</em>)$ä¸å«å¯è®­ç»ƒå‚æ•°,ç›¸å…³é¡¹åªè´¡çŒ®å¸¸æ•°ã€‚</p>
<p><strong>è§‚å¯Ÿ2:</strong> å…ˆéªŒåˆ†å¸ƒ$q(\boldsymbol{x}_T) = \mathcal{N}(\boldsymbol{0}, \boldsymbol{I})$ä¹Ÿæ˜¯å›ºå®šçš„,è´¡çŒ®å¸¸æ•°ã€‚</p>
<p><strong>ç®€åŒ–åçš„ç›®æ ‡:</strong>
$$\mathcal{L} \propto -\mathbb{E}_{p}\left[\sum_{t=1}^T \log q(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t)\right] = -\sum_{t=1}^T \mathbb{E}_{p}\left[\log q(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t)\right] \tag{11}$$</p>
<h4 id="32">3.2 å•ä¸ªæ—¶é—´æ­¥çš„ç›®æ ‡</h4>
<p><strong>å¯¹æ¯ä¸ª$t$:</strong>
$$\begin{aligned}
\mathcal{L}_t &= -\int p(\boldsymbol{x}_T|\boldsymbol{x}_{T-1}) \cdots p(\boldsymbol{x}_1|\boldsymbol{x}_0) \tilde{p}(\boldsymbol{x}_0) \log q(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t) d\boldsymbol{x}_0 \cdots d\boldsymbol{x}_T
\end{aligned} \tag{12}$$</p>
<p><strong>å…³é”®è§‚å¯Ÿ:</strong> $q(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t)$è‡³å¤šä¾èµ–åˆ°$\boldsymbol{x}_t$,å› æ­¤$t+1$åˆ°$T$çš„ç§¯åˆ†å¯ä»¥å…ˆç®—ã€‚</p>
<p><strong>ç§¯åˆ†æ¶ˆé™¤:</strong>
$$\int p(\boldsymbol{x}_T|\boldsymbol{x}_{T-1}) \cdots p(\boldsymbol{x}_{t+1}|\boldsymbol{x}_t) d\boldsymbol{x}_{t+1} \cdots d\boldsymbol{x}_T = 1 \tag{13}$$</p>
<p><strong>è¿›ä¸€æ­¥ç®€åŒ–:</strong>
$$q(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t)$ä¹Ÿä¸ä¾èµ–äº$\boldsymbol{x}_1, \ldots, \boldsymbol{x}_{t-2}$,å¯ä»¥ç»§ç»­æ¶ˆé™¤ç§¯åˆ†ã€‚

**å…³é”®å…¬å¼:** åˆ©ç”¨é©¬å°”å¯å¤«æ€§å’Œæ­£æ€åˆ†å¸ƒçš„å åŠ æ€§:
$$\int p(\boldsymbol{x}<em t-2="t-2">{t-1}|\boldsymbol{x}</em>}) \cdots p(\boldsymbol{x<em t-2="t-2">1|\boldsymbol{x}_0) d\boldsymbol{x}_1 \cdots d\boldsymbol{x}</em>} = p(\boldsymbol{x<em t-1="t-1">{t-1}|\boldsymbol{x}_0) \tag{14}$$

**æœ€ç»ˆç®€åŒ–å½¢å¼:**
$$\mathcal{L}_t = -\int p(\boldsymbol{x}_t|\boldsymbol{x}</em>}) p(\boldsymbol{x<em t-1="t-1">{t-1}|\boldsymbol{x}_0) \tilde{p}(\boldsymbol{x}_0) \log q(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t) d\boldsymbol{x}_0 d\boldsymbol{x}</em>} d\boldsymbol{x<em t-1="t-1">t \tag{15}$$

### 4. æ­£æ€åˆ†å¸ƒå åŠ æ€§çš„æ¨å¯¼

#### 4.1 ä¸¤æ­¥æƒ…å†µçš„æ¨å¯¼

**ç»™å®š:**
- $p(\boldsymbol{x}_1|\boldsymbol{x}_0) = \mathcal{N}(\boldsymbol{x}_1; \alpha_1\boldsymbol{x}_0, \beta_1^2\boldsymbol{I})$
- $p(\boldsymbol{x}_2|\boldsymbol{x}_1) = \mathcal{N}(\boldsymbol{x}_2; \alpha_2\boldsymbol{x}_1, \beta_2^2\boldsymbol{I})$

**ç­‰ä»·é‡‡æ ·å½¢å¼:**
$$\boldsymbol{x}_1 = \alpha_1\boldsymbol{x}_0 + \beta_1\boldsymbol{\varepsilon}_1, \quad \boldsymbol{\varepsilon}_1 \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{I}) \tag{16}$$
$$\boldsymbol{x}_2 = \alpha_2\boldsymbol{x}_1 + \beta_2\boldsymbol{\varepsilon}_2, \quad \boldsymbol{\varepsilon}_2 \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{I}) \tag{17}$$

**ä»£å…¥æ¶ˆå…ƒ:**
$$\begin{aligned}
\boldsymbol{x}_2 &amp;= \alpha_2(\alpha_1\boldsymbol{x}_0 + \beta_1\boldsymbol{\varepsilon}_1) + \beta_2\boldsymbol{\varepsilon}_2 \
&amp;= \alpha_2\alpha_1\boldsymbol{x}_0 + \alpha_2\beta_1\boldsymbol{\varepsilon}_1 + \beta_2\boldsymbol{\varepsilon}_2
\end{aligned} \tag{18}$$

**é«˜æ–¯å™ªå£°çš„å’Œ:** ä¸¤ä¸ªç‹¬ç«‹é«˜æ–¯éšæœºå˜é‡çš„å’Œä»æ˜¯é«˜æ–¯:
$$\alpha_2\beta_1\boldsymbol{\varepsilon}_1 + \beta_2\boldsymbol{\varepsilon}_2 \sim \mathcal{N}(\boldsymbol{0}, (\alpha_2^2\beta_1^2 + \beta_2^2)\boldsymbol{I}) \tag{19}$$

**éªŒè¯æ–¹å·®:**
$$\text{Var}[\alpha_2\beta_1\boldsymbol{\varepsilon}_1 + \beta_2\boldsymbol{\varepsilon}_2] = \alpha_2^2\beta_1^2\text{Var}[\boldsymbol{\varepsilon}_1] + \beta_2^2\text{Var}[\boldsymbol{\varepsilon}_2] = \alpha_2^2\beta_1^2 + \beta_2^2 \tag{20}$$

**å¼•å…¥çº¦æŸ:** ä¸ºäº†ç®€åŒ–å½¢å¼,æˆ‘ä»¬è¦æ±‚$\alpha_t^2 + \beta_t^2 = 1$ã€‚

**åˆ™:**
$$\begin{aligned}
\alpha_2^2\beta_1^2 + \beta_2^2 &amp;= \alpha_2^2\beta_1^2 + (1 - \alpha_2^2) \
&amp;= \alpha_2^2\beta_1^2 + 1 - \alpha_2^2 \
&amp;= \alpha_2^2(\beta_1^2 - 1) + 1 \
&amp;= \alpha_2^2(-\alpha_1^2) + 1 \
&amp;= 1 - \alpha_2^2\alpha_1^2
\end{aligned} \tag{21}$$

**å®šä¹‰ç´¯ç§¯å‚æ•°:**
$$\bar{\alpha}_2 = \alpha_1\alpha_2, \quad \bar{\beta}_2 = \sqrt{1 - \bar{\alpha}_2^2} \tag{22}$$

**æœ€ç»ˆç»“æœ:**
$$p(\boldsymbol{x}_2|\boldsymbol{x}_0) = \mathcal{N}(\boldsymbol{x}_2; \bar{\alpha}_2\boldsymbol{x}_0, \bar{\beta}_2^2\boldsymbol{I}) \tag{23}$$

#### 4.2 ä¸€èˆ¬æƒ…å†µçš„é€’æ¨

**å½’çº³å‡è®¾:** å‡è®¾$p(\boldsymbol{x}_{t-1}|\boldsymbol{x}_0) = \mathcal{N}(\boldsymbol{x}_{t-1}; \bar{\alpha}_{t-1}\boldsymbol{x}_0, \bar{\beta}_{t-1}^2\boldsymbol{I})$æˆç«‹ã€‚

**é€’æ¨æ­¥éª¤:**
$$\boldsymbol{x}_t = \alpha_t\boldsymbol{x}</em>} + \beta_t\boldsymbol{\varepsilon<em t-1="t-1">t = \alpha_t(\bar{\alpha}</em>}\boldsymbol{x<em t-1="t-1">0 + \bar{\beta}</em>}\bar{\boldsymbol{\varepsilon}<em t-1="t-1">{t-1}) + \beta_t\boldsymbol{\varepsilon}_t \tag{24}$$

**æ•´ç†:**
$$\boldsymbol{x}_t = \alpha_t\bar{\alpha}</em>}\boldsymbol{x<em t-1="t-1">0 + (\alpha_t\bar{\beta}</em>}\bar{\boldsymbol{\varepsilon}<em t-1="t-1">{t-1} + \beta_t\boldsymbol{\varepsilon}_t) \tag{25}$$

**å™ªå£°é¡¹çš„æ–¹å·®:**
$$\text{Var} = \alpha_t^2\bar{\beta}</em>}^2 + \beta_t^2 = \alpha_t^2(1 - \bar{\alpha<em t-1="t-1">{t-1}^2) + \beta_t^2 \tag{26}$$

**åˆ©ç”¨çº¦æŸ$\alpha_t^2 + \beta_t^2 = 1$:**
$$\begin{aligned}
\text{Var} &amp;= \alpha_t^2(1 - \bar{\alpha}</em>^2) + (1 - \alpha_t^2) \
&amp;= \alpha_t^2 - \alpha_t^2\bar{\alpha}<em t-1="t-1">{t-1}^2 + 1 - \alpha_t^2 \
&amp;= 1 - \alpha_t^2\bar{\alpha}</em>^2 \
&amp;= 1 - (\alpha_t\bar{\alpha}<em t-1="t-1">{t-1})^2
\end{aligned} \tag{27}$$

**é€’æ¨å…¬å¼:**
$$\bar{\alpha}_t = \alpha_t\bar{\alpha}</em>} = \alpha_1\alpha_2 \cdots \alpha_t = \prod_{i=1}^t \alpha_i \tag{28}$$
$$\bar{\beta<em t-1="t-1">t = \sqrt{1 - \bar{\alpha}_t^2} \tag{29}$$

**ä¸€èˆ¬ç»“æœ:**
$$p(\boldsymbol{x}_t|\boldsymbol{x}_0) = \mathcal{N}(\boldsymbol{x}_t; \bar{\alpha}_t\boldsymbol{x}_0, \bar{\beta}_t^2\boldsymbol{I}) \tag{30}$$

**é‡‡æ ·å½¢å¼:**
$$\boldsymbol{x}_t = \bar{\alpha}_t\boldsymbol{x}_0 + \bar{\beta}_t\bar{\boldsymbol{\varepsilon}}, \quad \bar{\boldsymbol{\varepsilon}} \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{I}) \tag{31}$$

### 5. åå‘è¿‡ç¨‹çš„å‚æ•°åŒ–

#### 5.1 è´Ÿå¯¹æ•°ä¼¼ç„¶çš„å±•å¼€

**åå‘ç”Ÿæˆè¿‡ç¨‹:**
$$q(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t) = \mathcal{N}(\boldsymbol{x}</em>}; \boldsymbol{\mu}(\boldsymbol{x<em t-1="t-1">t), \sigma_t^2\boldsymbol{I}) \tag{32}$$

**è´Ÿå¯¹æ•°ä¼¼ç„¶(å¿½ç•¥å¸¸æ•°):**
$$-\log q(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t) = \frac{1}{2\sigma_t^2}|\boldsymbol{x}</em>} - \boldsymbol{\mu}(\boldsymbol{x<em p_boldsymbol_x="p(\boldsymbol{x">t)|^2 + \text{const} \tag{33}$$

**ä¼˜åŒ–ç›®æ ‡(å¼15)å˜ä¸º:**
$$\mathcal{L}_t = \frac{1}{2\sigma_t^2} \mathbb{E}</em><em t-1="t-1">t|\boldsymbol{x}</em>})p(\boldsymbol{x<em t-1="t-1">{t-1}|\boldsymbol{x}_0)\tilde{p}(\boldsymbol{x}_0)}\left[|\boldsymbol{x}</em>} - \boldsymbol{\mu}(\boldsymbol{x<em t-1="t-1">t)|^2\right] + \text{const} \tag{34}$$

#### 5.2 å™ªå£°é¢„æµ‹çš„å‚æ•°åŒ–

**å‰å‘è¿‡ç¨‹ç»™å‡º:**
$$\boldsymbol{x}_t = \alpha_t\boldsymbol{x}</em>} + \beta_t\boldsymbol{\varepsilon<em t-1="t-1">t \tag{35}$$

**åè§£$\boldsymbol{x}_{t-1}$:**
$$\boldsymbol{x}</em>} = \frac{1}{\alpha_t}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t - \beta_t\boldsymbol{\varepsilon}_t) \tag{36}$$

**å¯å‘å¼å‚æ•°åŒ–:** ç”¨ç¥ç»ç½‘ç»œé¢„æµ‹å™ªå£°$\boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)$æ¥é€¼è¿‘çœŸå®å™ªå£°$\boldsymbol{\varepsilon}_t$,åˆ™å‡å€¼å‚æ•°åŒ–ä¸º:
$$\boldsymbol{\mu}(\boldsymbol{x}_t) = \frac{1}{\alpha_t}\left(\boldsymbol{x}_t - \beta_t\boldsymbol{\epsilon}</em>}}(\boldsymbol{x<em t-1="t-1">t, t)\right) \tag{37}$$

#### 5.3 æŸå¤±å‡½æ•°çš„å˜æ¢

**ä»£å…¥å‚æ•°åŒ–(37)åˆ°ç›®æ ‡(34):**
$$\mathcal{L}_t = \frac{1}{2\sigma_t^2} \mathbb{E}\left[\left|\boldsymbol{x}</em>} - \frac{1}{\alpha_t}\left(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t - \beta_t\boldsymbol{\epsilon}</em>}}(\boldsymbol{x<em t-1="t-1">t, t)\right)\right|^2\right] \tag{38}$$

**ä»å‰å‘è¿‡ç¨‹,æˆ‘ä»¬æœ‰:**
- $\boldsymbol{x}_{t-1} = \bar{\alpha}_{t-1}\boldsymbol{x}_0 + \bar{\beta}_{t-1}\bar{\boldsymbol{\varepsilon}}_{t-1}$
- $\boldsymbol{x}_t = \alpha_t\boldsymbol{x}_{t-1} + \beta_t\boldsymbol{\varepsilon}_t$

**ä»£å…¥ç¬¬ä¸€ä¸ª:**
$$\boldsymbol{x}_t = \alpha_t(\bar{\alpha}</em>}\boldsymbol{x<em t-1="t-1">0 + \bar{\beta}</em>}\bar{\boldsymbol{\varepsilon}<em t-1="t-1">{t-1}) + \beta_t\boldsymbol{\varepsilon}_t \tag{39}$$

**ç›®æ ‡å‡½æ•°å˜ä¸º:**
$$\begin{aligned}
&amp;\left|\bar{\alpha}</em>}\boldsymbol{x<em t-1="t-1">0 + \bar{\beta}</em>}\bar{\boldsymbol{\varepsilon}<em t-1="t-1">{t-1} - \frac{1}{\alpha_t}\left(\alpha_t(\bar{\alpha}</em>}\boldsymbol{x<em t-1="t-1">0 + \bar{\beta}</em>}\bar{\boldsymbol{\varepsilon}<em _boldsymbol_theta="\boldsymbol{\theta">{t-1}) + \beta_t\boldsymbol{\varepsilon}_t - \beta_t\boldsymbol{\epsilon}</em>\right)\right|^2 \
=&amp; \left|\bar{\alpha}}<em t-1="t-1">{t-1}\boldsymbol{x}_0 + \bar{\beta}</em>}\bar{\boldsymbol{\varepsilon}<em t-1="t-1">{t-1} - \bar{\alpha}</em>}\boldsymbol{x<em t-1="t-1">0 - \bar{\beta}</em>}\bar{\boldsymbol{\varepsilon}<em _boldsymbol_theta="\boldsymbol{\theta">{t-1} - \frac{\beta_t}{\alpha_t}\boldsymbol{\varepsilon}_t + \frac{\beta_t}{\alpha_t}\boldsymbol{\epsilon}</em>\right|^2 \
=&amp; \left|\frac{\beta_t}{\alpha_t}(\boldsymbol{\epsilon}}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}} - \boldsymbol{\varepsilon}_t)\right|^2 \
=&amp; \frac{\beta_t^2}{\alpha_t^2}|\boldsymbol{\epsilon}</em>}} - \boldsymbol{\varepsilon<em _bar_boldsymbol_varepsilon="\bar{\boldsymbol{\varepsilon">t|^2
\end{aligned} \tag{40}$$

**ç®€åŒ–çš„æŸå¤±å‡½æ•°:**
$$\mathcal{L}_t = \frac{\beta_t^2}{2\alpha_t^2\sigma_t^2} \mathbb{E}</em>}<em _boldsymbol_theta="\boldsymbol{\theta">{t-1}, \boldsymbol{\varepsilon}_t, \boldsymbol{x}_0}\left[|\boldsymbol{\epsilon}</em>}}(\boldsymbol{x<em t-1="t-1">t, t) - \boldsymbol{\varepsilon}_t|^2\right] \tag{41}$$

å…¶ä¸­$\boldsymbol{x}_t = \alpha_t(\bar{\alpha}_{t-1}\boldsymbol{x}_0 + \bar{\beta}_{t-1}\bar{\boldsymbol{\varepsilon}}_{t-1}) + \beta_t\boldsymbol{\varepsilon}_t$ã€‚

### 6. é™ä½æ–¹å·®çš„æŠ€å·§

#### 6.1 é—®é¢˜åˆ†æ

**å½“å‰å½¢å¼çš„é—®é¢˜:** æœŸæœ›åŒæ—¶æ¶‰åŠä¸¤ä¸ªç‹¬ç«‹å™ªå£°$\bar{\boldsymbol{\varepsilon}}_{t-1}$å’Œ$\boldsymbol{\varepsilon}_t$,å¢åŠ äº†æ–¹å·®ã€‚

**ç›®æ ‡:** å°†å…¶è½¬åŒ–ä¸ºå•ä¸ªå™ªå£°çš„æœŸæœ›ã€‚

#### 6.2 é‡å‚æ•°åŒ–æŠ€å·§

**å›é¡¾ç´¯ç§¯å‰å‘è¿‡ç¨‹:**
$$\boldsymbol{x}_t = \bar{\alpha}_t\boldsymbol{x}_0 + \bar{\beta}_t\bar{\boldsymbol{\varepsilon}}, \quad \bar{\boldsymbol{\varepsilon}} \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{I}) \tag{42}$$

**ç›®æ ‡:** ç”¨å•ä¸ªå™ªå£°$\bar{\boldsymbol{\varepsilon}}$è¡¨ç¤º$\boldsymbol{x}_t$ã€‚

**ä»å‰é¢çš„æ¨å¯¼:**
$$\boldsymbol{x}_t = \alpha_t\bar{\alpha}</em>}\boldsymbol{x<em t-1="t-1">0 + (\alpha_t\bar{\beta}</em>}\bar{\boldsymbol{\varepsilon}<em t-1="t-1">{t-1} + \beta_t\boldsymbol{\varepsilon}_t) \tag{43}$$

**æ³¨æ„åˆ°:**
$$\bar{\alpha}_t = \alpha_t\bar{\alpha}</em>} \tag{44}$$

**å™ªå£°åˆæˆ:** å®šä¹‰
$$\bar{\boldsymbol{\varepsilon}} = \frac{\alpha_t\bar{\beta<em t-1="t-1">{t-1}\bar{\boldsymbol{\varepsilon}}</em>} + \beta_t\boldsymbol{\varepsilon<em t-1="t-1">t}{\bar{\beta}_t} \tag{45}$$

**éªŒè¯:** éœ€è¦è¯æ˜$\bar{\boldsymbol{\varepsilon}} \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{I})$ã€‚

**æ–¹å·®è®¡ç®—:**
$$\begin{aligned}
\text{Var}[\bar{\boldsymbol{\varepsilon}}] &amp;= \frac{1}{\bar{\beta}_t^2}(\alpha_t^2\bar{\beta}</em>^2 + \beta_t^2) \
&amp;= \frac{1}{1 - \alpha_t^2\bar{\alpha}<em t-1="t-1">{t-1}^2}(\alpha_t^2(1 - \bar{\alpha}</em>^2) + \beta_t^2) \
&amp;= \frac{\alpha_t^2 - \alpha_t^2\bar{\alpha}<em t-1="t-1">{t-1}^2 + \beta_t^2}{1 - \alpha_t^2\bar{\alpha}</em> \
&amp;= \frac{(\alpha_t^2 + \beta_t^2) - \alpha_t^2\bar{\alpha}}^2<em t-1="t-1">{t-1}^2}{1 - \alpha_t^2\bar{\alpha}</em> \
&amp;= \frac{1 - \alpha_t^2\bar{\alpha}}^2<em t-1="t-1">{t-1}^2}{1 - \alpha_t^2\bar{\alpha}</em> \
&amp;= 1
\end{aligned} \tag{46}$$

**å› æ­¤:**
$$\boldsymbol{x}}^2<em t-1="t-1">t = \bar{\alpha}_t\boldsymbol{x}_0 + \bar{\beta}_t\bar{\boldsymbol{\varepsilon}} \tag{47}$$

#### 6.3 å™ªå£°çš„åè§£

**ä»(47)åè§£å™ªå£°:**
$$\bar{\boldsymbol{\varepsilon}} = \frac{\boldsymbol{x}_t - \bar{\alpha}_t\boldsymbol{x}_0}{\bar{\beta}_t} \tag{48}$$

**ä»£å…¥åˆ°å™ªå£°åˆæˆå…¬å¼(45):**
$$\frac{\boldsymbol{x}_t - \bar{\alpha}_t\boldsymbol{x}_0}{\bar{\beta}_t} = \frac{\alpha_t\bar{\beta}</em>}\bar{\boldsymbol{\varepsilon}<em t-1="t-1">{t-1} + \beta_t\boldsymbol{\varepsilon}_t}{\bar{\beta}_t} \tag{49}$$

**å› æ­¤:**
$$\beta_t\boldsymbol{\varepsilon}_t = \boldsymbol{x}_t - \bar{\alpha}_t\boldsymbol{x}_0 - \alpha_t\bar{\beta}</em>}\bar{\boldsymbol{\varepsilon}<em _bar_boldsymbol_varepsilon="\bar{\boldsymbol{\varepsilon">{t-1} \tag{50}$$

ä½†è¿™ä¸ªå½¢å¼ä»ç„¶å¤æ‚ã€‚

**æ›´ç®€æ´çš„æ–¹æ³•:** ç›´æ¥ç”¨(47)çš„å½¢å¼ã€‚

#### 6.4 æœ€ç»ˆæŸå¤±å‡½æ•°

**é‡å†™æŸå¤±å‡½æ•°:** ç”¨å•ä¸ªå™ªå£°$\bar{\boldsymbol{\varepsilon}}$:
$$\mathcal{L}_t = \frac{\beta_t^2}{2\alpha_t^2\sigma_t^2} \mathbb{E}</em>}} \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{I}), \boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">0 \sim \tilde{p}}\left[|\boldsymbol{\epsilon}</em>}}(\bar{\alpha<em t-1="t-1">t\boldsymbol{x}_0 + \bar{\beta}_t\bar{\boldsymbol{\varepsilon}}, t) - \text{noise target}|^2\right] \tag{51}$$

**é—®é¢˜:** noise targetåº”è¯¥æ˜¯ä»€ä¹ˆ?

**å…³é”®è§‚å¯Ÿ:** åœ¨å¼(40)çš„æ¨å¯¼ä¸­,çœŸæ­£çš„å™ªå£°ç›®æ ‡æ˜¯$\boldsymbol{\varepsilon}_t$,ä½†æˆ‘ä»¬å¸Œæœ›ç”¨$\bar{\boldsymbol{\varepsilon}}$ã€‚

**é‡æ–°æ¨å¯¼:** ä»
$$\boldsymbol{x}_t = \alpha_t\boldsymbol{x}</em>} + \beta_t\boldsymbol{\varepsilon<em _boldsymbol_theta="\boldsymbol{\theta">t = \bar{\alpha}_t\boldsymbol{x}_0 + \bar{\beta}_t\bar{\boldsymbol{\varepsilon}} \tag{52}$$

**ç”¨ç¬¬äºŒä¸ªå½¢å¼ä»£å…¥å‡å€¼:**
$$\boldsymbol{\mu}(\boldsymbol{x}_t) = \frac{1}{\alpha_t}\left(\boldsymbol{x}_t - \beta_t\boldsymbol{\epsilon}</em>}}\right) \tag{53}$$

**ç†æƒ³æƒ…å†µ:** å¦‚æœ$\boldsymbol{\epsilon}_{\boldsymbol{\theta}} = \bar{\boldsymbol{\varepsilon}}$,åˆ™:
$$\boldsymbol{\mu}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t) = \frac{1}{\alpha_t}\left(\bar{\alpha}_t\boldsymbol{x}_0 + \bar{\beta}_t\bar{\boldsymbol{\varepsilon}} - \beta_t\bar{\boldsymbol{\varepsilon}}\right) = \frac{1}{\alpha_t}\left(\bar{\alpha}_t\boldsymbol{x}_0 + (\bar{\beta}_t - \beta_t)\bar{\boldsymbol{\varepsilon}}\right) \tag{54}$$

**è¿™ä¸å¯¹!** è®©æˆ‘é‡æ–°æ€è€ƒ...

**æ­£ç¡®çš„ç†è§£:**

ä»$\boldsymbol{x}_{t-1} = \frac{1}{\alpha_t}(\boldsymbol{x}_t - \beta_t\boldsymbol{\varepsilon}_t)$,å¦‚æœæˆ‘ä»¬é¢„æµ‹çš„æ˜¯$\boldsymbol{\varepsilon}_t$,è¿™æ˜¯æ­£ç¡®çš„ã€‚

ä½†ä»ç´¯ç§¯å½¢å¼$\boldsymbol{x}_t = \bar{\alpha}_t\boldsymbol{x}_0 + \bar{\beta}_t\bar{\boldsymbol{\varepsilon}}$,æˆ‘ä»¬å®é™…ä¸Šå¯ä»¥é¢„æµ‹$\bar{\boldsymbol{\varepsilon}}$ã€‚

**é‡æ–°å‚æ•°åŒ–:** å®šä¹‰
$$\boldsymbol{\mu}(\boldsymbol{x}_t) = \frac{1}{\alpha_t}\left(\boldsymbol{x}_t - \frac{\beta_t}{\bar{\beta}_t}\bar{\boldsymbol{\epsilon}}</em>}}(\boldsymbol{x<em _text_simple="\text{simple">t, t)\right) \tag{55}$$

å…¶ä¸­$\bar{\boldsymbol{\epsilon}}_{\boldsymbol{\theta}}$é¢„æµ‹ç´¯ç§¯å™ªå£°$\bar{\beta}_t\bar{\boldsymbol{\varepsilon}}$ã€‚

**ä½†å®è·µä¸­:** DDPMè®ºæ–‡ä½¿ç”¨æ›´ç®€å•çš„å½¢å¼,ç›´æ¥é¢„æµ‹æŸç§å™ªå£°,æŸå¤±å‡½æ•°ä¸º:
$$\mathcal{L}</em>}} = \mathbb{E<em _boldsymbol_theta="\boldsymbol{\theta">{t, \boldsymbol{x}_0, \boldsymbol{\varepsilon}}\left[|\boldsymbol{\varepsilon} - \boldsymbol{\epsilon}</em>}}(\bar{\alpha<em _boldsymbol_theta="\boldsymbol{\theta">t\boldsymbol{x}_0 + \bar{\beta}_t\boldsymbol{\varepsilon}, t)|^2\right] \tag{56}$$

è¿™é‡Œ$\boldsymbol{\varepsilon}$å°±æ˜¯ç´¯ç§¯å™ªå£°$\bar{\boldsymbol{\varepsilon}}$ã€‚

**ç†è®ºç³»æ•°:** å®Œæ•´çš„å¸¦æƒé‡çš„æŸå¤±ä¸º:
$$\mathcal{L}_t = \frac{\beta_t^4}{2\bar{\beta}_t^2\alpha_t^2\sigma_t^2} \mathbb{E}\left[|\boldsymbol{\varepsilon} - \boldsymbol{\epsilon}</em>}}(\boldsymbol{x<em t-1="t-1">t, t)|^2\right] \tag{57}$$

**ä½†DDPMå‘ç°:** å»æ‰æƒé‡ç³»æ•°,ä½¿ç”¨ç®€åŒ–æŸå¤±(56)æ•ˆæœæ›´å¥½!

### 7. è¶…å‚æ•°è®¾ç½®ä¸ç†è®ºåˆ†æ

#### 7.1 æ–¹å·®çº¦æŸçš„æ„ä¹‰

**çº¦æŸ:** $\alpha_t^2 + \beta_t^2 = 1$

**ç›®çš„:** ä¿æŒæ–¹å·®æ’å®šã€‚

**æ¨ç†:** å‡è®¾$\boldsymbol{x}_{t-1} \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{I})$(æ ‡å‡†åŒ–å‡è®¾),åˆ™:
$$\begin{aligned}
\text{Var}[\boldsymbol{x}_t] &amp;= \text{Var}[\alpha_t\boldsymbol{x}</em>} + \beta_t\boldsymbol{\varepsilon<em t-1="t-1">t] \
&amp;= \alpha_t^2\text{Var}[\boldsymbol{x}</em>}] + \beta_t^2\text{Var}[\boldsymbol{\varepsilon<em t="1">t] \
&amp;= \alpha_t^2 \cdot 1 + \beta_t^2 \cdot 1 \
&amp;= \alpha_t^2 + \beta_t^2
\end{aligned} \tag{58}$$

å¦‚æœ$\alpha_t^2 + \beta_t^2 = 1$,åˆ™$\text{Var}[\boldsymbol{x}_t] = 1$,æ–¹å·®ä¿æŒä¸å˜ã€‚

#### 7.2 å…ˆéªŒåŒ¹é…æ¡ä»¶

**ç›®æ ‡:** å¸Œæœ›$p(\boldsymbol{x}_T|\boldsymbol{x}_0) \approx q(\boldsymbol{x}_T) = \mathcal{N}(\boldsymbol{0}, \boldsymbol{I})$ã€‚

**ä»ç´¯ç§¯å…¬å¼:**
$$p(\boldsymbol{x}_T|\boldsymbol{x}_0) = \mathcal{N}(\boldsymbol{x}_T; \bar{\alpha}_T\boldsymbol{x}_0, \bar{\beta}_T^2\boldsymbol{I}) \tag{59}$$

**è¦ä½¿å…¶æ¥è¿‘$\mathcal{N}(\boldsymbol{0}, \boldsymbol{I})$,éœ€è¦:**
1. $\bar{\alpha}_T \approx 0$(å‡å€¼æ¶ˆå¤±)
2. $\bar{\beta}_T \approx 1$(æ–¹å·®ä¸º1)

ç”±äº$\bar{\beta}_T = \sqrt{1 - \bar{\alpha}_T^2}$,æ¡ä»¶1è‡ªåŠ¨ä¿è¯æ¡ä»¶2ã€‚

**å› æ­¤å…³é”®æ˜¯:** $\bar{\alpha}_T = \prod_{t=1}^T \alpha_t \approx 0$

#### 7.3 $\alpha_t$çš„é€‰æ‹©

**DDPMçš„è®¾ç½®:** $\alpha_t = \sqrt{1 - \frac{0.02t}{T}}$

**åˆ†æ:**
$$\bar{\alpha}_T = \prod</em>}^T \sqrt{1 - \frac{0.02t}{T}} \tag{60}$$

**å¯¹æ•°å½¢å¼:**
$$\log \bar{\alpha<em t="1">T = \sum</em>}^T \frac{1}{2}\log\left(1 - \frac{0.02t}{T}\right) \tag{61}$$

**å½“$T$å¾ˆå¤§æ—¶,å¯ä»¥è¿‘ä¼¼ä¸ºç§¯åˆ†:**
$$\log \bar{\alpha<em t-1="t-1">T \approx \frac{T}{2} \int_0^1 \log(1 - 0.02\tau) d\tau \tag{62}$$

**è®¡ç®—ç§¯åˆ†:**
$$\int_0^1 \log(1 - 0.02\tau) d\tau = \left[(\tau - 1)\log(1 - 0.02\tau) - \tau\right]_0^1 = 0 \cdot \log(0.98) - 1 - ((-1)\log(1) - 0) = -1 \tag{63}$$

å› æ­¤:
$$\log \bar{\alpha}_T \approx -\frac{T}{2} \tag{64}$$
$$\bar{\alpha}_T \approx e^{-T/2} \tag{65}$$

**å½“$T = 1000$æ—¶:**
$$\bar{\alpha}_T \approx e^{-500} \approx 0 \tag{66}$$

ç¡®å®æ»¡è¶³æ¡ä»¶!

#### 7.4 ç”Ÿæˆæ–¹å·®$\sigma_t$çš„é€‰æ‹©

**ç†è®ºæ¨å¯¼ä¸¤ä¸ªæç«¯æƒ…å†µ:**

**æƒ…å†µ1: å•æ ·æœ¬æ•°æ®é›†**

å‡è®¾$\tilde{p}(\boldsymbol{x}_0) = \delta(\boldsymbol{x}_0 - \boldsymbol{x}_*)$,å³è®­ç»ƒé›†åªæœ‰ä¸€ä¸ªæ ·æœ¬$\boldsymbol{x}_*$ã€‚

**æœ€ä¼˜çš„$\sigma_t$:** é€šè¿‡æœ€å°åŒ–KLæ•£åº¦,å¯ä»¥æ¨å¯¼å‡º:
$$\sigma_t^2 = \frac{\bar{\beta}</em>}^2}{\bar{\beta<em l="1">t^2}\beta_t^2 \tag{67}$$

**æ¨å¯¼sketch:** åˆ©ç”¨è´å¶æ–¯å…¬å¼å’Œé«˜æ–¯åˆ†å¸ƒçš„æ€§è´¨,è®¡ç®—$p(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t, \boldsymbol{x}_0)$,ç„¶åå¯¹$\boldsymbol{x}_0 = \boldsymbol{x}_*$å›ºå®šã€‚

**æƒ…å†µ2: æ ‡å‡†æ­£æ€å…ˆéªŒ**

å‡è®¾$\tilde{p}(\boldsymbol{x}_0) = \mathcal{N}(\boldsymbol{0}, \boldsymbol{I})$ã€‚

**æœ€ä¼˜çš„$\sigma_t$:** å¯ä»¥æ¨å¯¼å‡º:
$$\sigma_t^2 = \beta_t^2 \tag{68}$$

**å®è·µ:** ä¸¤ç§é€‰æ‹©æ€§èƒ½ç›¸è¿‘,DDPMä½¿ç”¨ç¬¬ä¸€ç§ã€‚

### 8. å®Œæ•´çš„è®­ç»ƒä¸é‡‡æ ·ç®—æ³•

#### 8.1 è®­ç»ƒç®—æ³•

**è¾“å…¥:** æ•°æ®é›†$\{\boldsymbol{x}_0^{(i)}\}_{i=1}^N$, æ—¶é—´æ­¥æ•°$T$

**è¶…å‚æ•°:** $\{\alpha_t\}_{t=1}^T$æ»¡è¶³$\alpha_t^2 + \beta_t^2 = 1$

**ç®—æ³•:**
```
åˆå§‹åŒ–: éšæœºåˆå§‹åŒ–ç½‘ç»œå‚æ•°Î¸

repeat:
    # é‡‡æ ·æ•°æ®
    x0 ~ p_data

    # é‡‡æ ·æ—¶é—´æ­¥
    t ~ Uniform(1, T)

    # é‡‡æ ·å™ªå£°
    Îµ ~ N(0, I)

    # æ„é€ åŠ å™ªæ ·æœ¬
    x_t = bar_alpha_t * x0 + bar_beta_t * Îµ

    # è®¡ç®—æŸå¤±
    loss = ||Îµ - Îµ_Î¸(x_t, t)||^2

    # æ¢¯åº¦æ›´æ–°
    Î¸ â† Î¸ - lr * âˆ‡_Î¸ loss

until æ”¶æ•›
```

#### 8.2 é‡‡æ ·ç®—æ³•

**è¾“å…¥:** è®­ç»ƒå¥½çš„æ¨¡å‹$\boldsymbol{\epsilon}_{\boldsymbol{\theta}}$

**è¾“å‡º:** ç”Ÿæˆæ ·æœ¬$\boldsymbol{x}_0$

**ç®—æ³•:**
```
# ä»å…ˆéªŒé‡‡æ ·
x_T ~ N(0, I)

for t = T to 1:
    # é¢„æµ‹å™ªå£°
    Îµ_pred = Îµ_Î¸(x_t, t)

    # è®¡ç®—å‡å€¼
    Î¼ = (x_t - (Î²_t / bar_Î²_t) * Îµ_pred) / Î±_t

    # é‡‡æ ·å™ªå£°(æœ€åä¸€æ­¥ä¸åŠ )
    if t > 1:
        z ~ N(0, I)
        x_{t-1} = Î¼ + Ïƒ_t * z
    else:
        x_0 = Î¼

return x_0
```

### 9. ä¸NVAEçš„è”ç³»

#### 9.1 NVAEçš„ç»“æ„

**NVAE (Nouveau VAE)** ä¹Ÿå¼•å…¥äº†å¤šå±‚éšå˜é‡:
$$\boldsymbol{z} = {\boldsymbol{z}_1, \boldsymbol{z}_2, \ldots, \boldsymbol{z}_L} \tag{69}$$

**ç¼–ç è¿‡ç¨‹(éé©¬å°”å¯å¤«):**
$$p(\boldsymbol{z}|\boldsymbol{x}) = p(\boldsymbol{z}_L|\boldsymbol{x}) \prod</em>}^{L-1} p(\boldsymbol{z<em _l="&gt;l">l|\boldsymbol{z}</em>}, \boldsymbol{x}) \tag{70}$$

**ç”Ÿæˆè¿‡ç¨‹:**
$$q(\boldsymbol{x}|\boldsymbol{z}) = q(\boldsymbol{x}|\boldsymbol{z<em l="1">1) \prod</em>}^{L-1} q(\boldsymbol{z<em l_1="l+1">l|\boldsymbol{z}</em>}) \tag{71}$$

#### 9.2 ä¸DDPMçš„æ¯”è¾ƒ

**ç›¸ä¼¼ä¹‹å¤„:**
1. éƒ½ä½¿ç”¨å¤šå±‚éšå˜é‡
2. éƒ½æ˜¯é€’å½’å¼çš„ç»“æ„
3. éƒ½èƒ½ç”Ÿæˆæ¸…æ™°å›¾åƒ

**å·®å¼‚:**

| ç‰¹æ€§ | DDPM | NVAE |
|------|------|------|
| ç¼–ç  | é©¬å°”å¯å¤«(å›ºå®šå™ªå£°) | éé©¬å°”å¯å¤«(å­¦ä¹ ) |
| å‚æ•° | åªæœ‰ç”Ÿæˆç½‘ç»œ | ç¼–ç å’Œç”Ÿæˆéƒ½å­¦ä¹  |
| å¤æ‚åº¦ | ç®€å•(å‚æ•°å…±äº«) | å¤æ‚(å¤šå±‚ä¸åŒç½‘ç»œ) |
| ç†è®º | å›ºå®šå‰å‘è¿‡ç¨‹ | çµæ´»çš„åŒå‘ |

**DDPMå¯ä»¥çœ‹ä½œ:** æåº¦ç®€åŒ–çš„NVAE
- ç¼–ç å›ºå®šä¸ºç®€å•åŠ å™ª
- ç”Ÿæˆä½¿ç”¨å•ä¸€ç½‘ç»œåå¤è¿­ä»£
- å‚æ•°å…±äº«æœºåˆ¶

### 10. ç†è®ºæ·±åº¦åˆ†æ

#### 10.1 ä¸ºä»€ä¹ˆå¤šæ­¥æ¯”å•æ­¥å¥½?

**å•æ­¥VAEçš„é—®é¢˜:**
$$\boldsymbol{x} \xrightarrow{p(\boldsymbol{z}|\boldsymbol{x})} \boldsymbol{z} \xrightarrow{q(\boldsymbol{x}|\boldsymbol{z})} \boldsymbol{x}' \tag{72}$$

**é™åˆ¶:**
- $p(\boldsymbol{z}|\boldsymbol{x}) = \mathcal{N}(\boldsymbol{\mu}_{\text{enc}}(\boldsymbol{x}), \boldsymbol{\Sigma}_{\text{enc}}(\boldsymbol{x}))$
- $q(\boldsymbol{x}|\boldsymbol{z}) = \mathcal{N}(\boldsymbol{\mu}_{\text{dec}}(\boldsymbol{z}), \boldsymbol{\Sigma}_{\text{dec}}(\boldsymbol{z}))$

è™½ç„¶$\boldsymbol{\mu}, \boldsymbol{\Sigma}$å¯ä»¥æ˜¯ä»»æ„å‡½æ•°,ä½†å•æ­¥å˜æ¢çš„è¡¨è¾¾èƒ½åŠ›æœ‰é™ã€‚

**å¤šæ­¥çš„ä¼˜åŠ¿:**

**å®šç†(ä¸‡èƒ½é€¼è¿‘):** ç»™å®šä»»æ„è¿ç»­åˆ†å¸ƒ$p_0$å’Œ$p_T$,å­˜åœ¨å……åˆ†å…‰æ»‘çš„è·¯å¾„:
$$p_0 \to p_1 \to \cdots \to p_T \tag{73}$$

ä½¿å¾—æ¯ä¸ª$p_{t-1} \to p_t$å¯ä»¥ç”¨ç®€å•çš„æ­£æ€åˆ†å¸ƒé€¼è¿‘ã€‚

**ç›´è§‰:**
- å¤§è·³è·ƒéš¾ä»¥ç”¨ç®€å•åˆ†å¸ƒå»ºæ¨¡
- å°æ­¥è¿ç»­å˜åŒ–å®¹æ˜“å»ºæ¨¡
- ç±»ä¼¼äºæ•°å€¼å¾®åˆ†æ–¹ç¨‹æ±‚è§£

#### 10.2 ä¼˜åŒ–æ™¯è§‚åˆ†æ

**å•æ­¥VAEçš„æŸå¤±:**
$$\mathcal{L<em p_boldsymbol_z="p(\boldsymbol{z">{\text{VAE}} = \mathbb{E}</em>}|\boldsymbol{x})}\left[-\log q(\boldsymbol{x}|\boldsymbol{z})\right] + KL(p(\boldsymbol{z}|\boldsymbol{x}) | q(\boldsymbol{z})) \tag{74}$$

**é—®é¢˜:** KLæ•£åº¦é¡¹å¯èƒ½å¯¼è‡´åéªŒå´©å¡Œ(posterior collapse)ã€‚

**DDPMçš„æŸå¤±:**
$$\mathcal{L<em t="1">{\text{DDPM}} = \sum</em>}^T \mathbb{E}\left[|\boldsymbol{\varepsilon} - \boldsymbol{\epsilon<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)|^2\right] \tag{75}$$

**ä¼˜åŠ¿:**
1. çº¯å›å½’æŸå¤±,ä¼˜åŒ–ç®€å•
2. æ¯æ­¥ç‹¬ç«‹ä¼˜åŒ–,æ— è€¦åˆ
3. ä¸ä¼šåéªŒå´©å¡Œ

#### 10.3 ç”Ÿæˆè´¨é‡çš„ç†è®ºä¿è¯

**å®šç†:** å¦‚æœ$\boldsymbol{\epsilon}_{\boldsymbol{\theta}}$å®Œç¾å­¦ä¹ å™ªå£°,å³:
$$\boldsymbol{\epsilon}</em>}}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t, t) = \mathbb{E}[\boldsymbol{\varepsilon}|\boldsymbol{x}_t] \tag{76}$$

åˆ™åå‘è¿‡ç¨‹$q(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t)$çš„æœ€ä¼˜å‡å€¼ä¸º:
$$\boldsymbol{\mu}^*(\boldsymbol{x}_t) = \frac{1}{\alpha_t}\left(\boldsymbol{x}_t - \frac{\beta_t^2}{\bar{\beta}_t}\nabla</em><em t-1="t-1">t}\log p_t(\boldsymbol{x}_t)\right) \tag{77}$$

å…¶ä¸­$\nabla_{\boldsymbol{x}_t}\log p_t(\boldsymbol{x}_t)$æ˜¯å¾—åˆ†å‡½æ•°(score function)ã€‚

**è¯æ˜sketch:**
- å¾—åˆ†å‡½æ•°$\nabla_{\boldsymbol{x}_t}\log p_t(\boldsymbol{x}_t) = -\frac{\mathbb{E}[\boldsymbol{\varepsilon}|\boldsymbol{x}_t]}{\bar{\beta}_t}$
- ä»£å…¥å³å¾—

**æ„ä¹‰:** DDPMå®é™…ä¸Šåœ¨å­¦ä¹ æ•°æ®åˆ†å¸ƒçš„å¾—åˆ†å‡½æ•°!

### 11. å®è·µæŠ€å·§æ€»ç»“

#### 11.1 è®­ç»ƒæŠ€å·§

**1. æŸå¤±å‡½æ•°é€‰æ‹©:**
- ç†è®º: å¸¦æƒé‡çš„$\frac{\beta_t^4}{2\bar{\beta}_t^2\alpha_t^2\sigma_t^2}\|\boldsymbol{\varepsilon} - \boldsymbol{\epsilon}_{\boldsymbol{\theta}}\|^2$
- å®è·µ: ç®€åŒ–çš„$\|\boldsymbol{\varepsilon} - \boldsymbol{\epsilon}_{\boldsymbol{\theta}}\|^2$æ•ˆæœæ›´å¥½

**2. å½’ä¸€åŒ–:**
- ä½¿ç”¨Instance Norm / Layer Norm / Group Norm
- **é¿å…** Batch Norm(è®­ç»ƒæ¨ç†ä¸ä¸€è‡´)

**3. æ—¶é—´ç¼–ç :**
- Sinusoidalä½ç½®ç¼–ç 
- æˆ–å¯è®­ç»ƒçš„Embedding

**4. ä¼˜åŒ–å™¨:**
- Adam / AdamW
- è¾ƒå¤§å­¦ä¹ ç‡(å¦‚$10^{-4}$)

#### 11.2 é‡‡æ ·æŠ€å·§

**1. æ–¹å·®é€‰æ‹©:**
$$\sigma_t = \frac{\bar{\beta}</em>$$}}{\bar{\beta}_t}\beta_t \quad \text{æˆ–} \quad \sigma_t = \beta_t \tag{78</p>
<p><strong>2. é‡è¦æ€§é‡‡æ ·:</strong>
ä¸åŒæ—¶é—´æ­¥$t$å¯¹æœ€ç»ˆè´¨é‡çš„è´¡çŒ®ä¸åŒ,å¯ä»¥è°ƒæ•´é‡‡æ ·åˆ†å¸ƒã€‚</p>
<p><strong>3. é™å™ªå¼ºåº¦:</strong>
å¯ä»¥åœ¨æœ€åå‡ æ­¥å‡å°æ–¹å·®,ä½¿ç”Ÿæˆæ›´ç¨³å®šã€‚</p>
<h3 id="12_1">12. æ€»ç»“ä¸å±•æœ›</h3>
<h4 id="121">12.1 æ ¸å¿ƒè´¡çŒ®æ€»ç»“</h4>
<p><strong>DDPM = è‡ªå›å½’å¼VAE:</strong>
1. <strong>ç†è®º:</strong> ä»VAEçš„è”åˆåˆ†å¸ƒKLæ•£åº¦å‡ºå‘
2. <strong>ç®€åŒ–:</strong> å›ºå®šå‰å‘è¿‡ç¨‹ä¸ºç®€å•åŠ å™ª
3. <strong>å‚æ•°åŒ–:</strong> ç”¨å™ªå£°é¢„æµ‹è€Œéç›´æ¥é¢„æµ‹$\boldsymbol{x}_{t-1}$
4. <strong>ä¼˜åŒ–:</strong> çº¯å›å½’æŸå¤±,è®­ç»ƒç¨³å®š</p>
<p><strong>ä¼˜ç‚¹:</strong>
- ç”Ÿæˆè´¨é‡é«˜(æ¸…æ™°å›¾åƒ)
- è®­ç»ƒç®€å•ç¨³å®š
- ç†è®ºåŸºç¡€æ¸…æ™°</p>
<p><strong>ç¼ºç‚¹:</strong>
- é‡‡æ ·æ…¢($T$æ­¥è¿­ä»£)
- æ— è¯­ä¹‰éšç©ºé—´(ä¸èƒ½ç¼–è¾‘)</p>
<h4 id="122">12.2 åç»­æ”¹è¿›æ–¹å‘</h4>
<p><strong>å·²æœ‰å·¥ä½œ:</strong>
1. <strong>åŠ é€Ÿé‡‡æ ·:</strong> DDIM, DPM-Solver, è’¸é¦
2. <strong>æ¡ä»¶ç”Ÿæˆ:</strong> Classifier-Guidance, Classifier-Free
3. <strong>æ¶æ„æ”¹è¿›:</strong> Latent Diffusion(åœ¨VAEéšç©ºé—´åšæ‰©æ•£)</p>
<p><strong>å¼€æ”¾é—®é¢˜:</strong>
1. å¦‚ä½•ç»“åˆDDPMçš„ç”Ÿæˆè´¨é‡å’ŒVAEçš„å¯ç¼–è¾‘æ€§?
2. èƒ½å¦è®¾è®¡æ›´ä¼˜çš„å‰å‘è¿‡ç¨‹?
3. ç†è®ºä¸Šçš„æœ€ä¼˜æ­¥æ•°$T$æ˜¯å¤šå°‘?
4. å¦‚ä½•æ‰©å±•åˆ°ç¦»æ•£æ•°æ®(æ–‡æœ¬)?</p>
<hr />
<hr />
<h2 id="4vaeddpm">ç¬¬4éƒ¨åˆ†ï¼šVAEè§†è§’ä¸‹DDPMçš„æ‰¹åˆ¤æ€§åˆ†æ</h2>
<p>ä»VAEçš„è§’åº¦é‡æ–°å®¡è§†DDPMï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ä¸€äº›ä¼ ç»ŸVAEåˆ†æä¸­æœªæ›¾å…³æ³¨çš„ç‹¬ç‰¹é—®é¢˜ã€‚</p>
<h3 id="41-ddpm-vs-vae-vs-vae">4.1 æ–¹æ³•å¯¹æ¯”ï¼šDDPM vs. ä¼ ç»ŸVAE vs. å±‚æ¬¡åŒ–VAE</h3>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ç¼–ç æ­¥æ•°</th>
<th>ç”Ÿæˆæ­¥æ•°</th>
<th>éšç©ºé—´æ€§è´¨</th>
<th><strong>æ ¸å¿ƒç¼ºé™·</strong></th>
<th><strong>ä¼˜åŒ–æ–¹å‘</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ä¼ ç»ŸVAE</strong></td>
<td>1æ­¥</td>
<td>1æ­¥</td>
<td>ç´§å‡‘ã€è¯­ä¹‰åŒ–</td>
<td>âŒ ç”Ÿæˆè´¨é‡å·®ï¼ˆæ¨¡ç³Šï¼‰<br>âŒ åéªŒåç¼©ä¸¥é‡<br>âŒ è¡¨è¾¾èƒ½åŠ›å—é™</td>
<td>âœ… Î²-VAEå¹³è¡¡<br>âœ… VQ-VAEç¦»æ•£åŒ–<br>âœ… æ”¹è¿›ç¼–ç å™¨æ¶æ„</td>
</tr>
<tr>
<td><strong>NVAE</strong></td>
<td>å¤šå°ºåº¦å±‚æ¬¡</td>
<td>å¤šå°ºåº¦å±‚æ¬¡</td>
<td>å±‚æ¬¡åŒ–ã€å¯è§£é‡Š</td>
<td>âŒ è®­ç»ƒå¤æ‚åº¦é«˜<br>âŒ å±‚é—´ä¾èµ–éš¾ä¼˜åŒ–<br>âŒ ä»æœ‰åéªŒåç¼©</td>
<td>âœ… æ®‹å·®è¿æ¥<br>âœ… è°±å½’ä¸€åŒ–<br>âœ… æ‰¹å½’ä¸€åŒ–æ”¹è¿›</td>
</tr>
<tr>
<td><strong>DDPM</strong></td>
<td>$T$æ­¥ï¼ˆå›ºå®šï¼‰</td>
<td>$T$æ­¥ï¼ˆå¯å­¦ä¹ ï¼‰</td>
<td>æ— è¯­ä¹‰ã€é€€åŒ–ä¸ºå™ªå£°</td>
<td>âŒ <strong>æ— ç¼–ç èƒ½åŠ›</strong><br>âŒ é‡‡æ ·ææ…¢ï¼ˆ1000æ­¥ï¼‰<br>âŒ æ— æ³•ç¼–è¾‘å’Œæ’å€¼<br>âŒ ä¸­é—´æ­¥éª¤æ— æ„ä¹‰</td>
<td>âœ… DDIMåŠ é€Ÿ<br>âœ… éšç©ºé—´æ‰©æ•£ï¼ˆLDMï¼‰<br>âœ… æ··åˆVAE+æ‰©æ•£<br>âœ… å¯é€†æ‰©æ•£è¿‡ç¨‹</td>
</tr>
<tr>
<td><strong>HVAE</strong></td>
<td>å±‚æ¬¡åŒ–ï¼ˆå°‘é‡ï¼‰</td>
<td>å±‚æ¬¡åŒ–ï¼ˆå°‘é‡ï¼‰</td>
<td>å¤šå±‚æ¬¡è¯­ä¹‰</td>
<td>âŒ å±‚æ•°éš¾é€‰æ‹©<br>âŒ ä¼˜åŒ–ä¸ç¨³å®š<br>âŒ ç”Ÿæˆè´¨é‡ä¸å¦‚DDPM</td>
<td>âœ… å˜åˆ†æ³¨æ„åŠ›<br>âœ… è‡ªé€‚åº”å±‚æ•°<br>âœ… ç«¯åˆ°ç«¯ä¼˜åŒ–</td>
</tr>
</tbody>
</table>
<h3 id="42-ddpmvae">4.2 DDPMä½œä¸ºVAEçš„æ ¸å¿ƒç¼ºé™·åˆ†æ</h3>
<h4 id="1_1"><strong>ç¼ºé™·1ï¼šå®Œå…¨ä¸§å¤±ç¼–ç èƒ½åŠ›</strong></h4>
<p><strong>é—®é¢˜æè¿°</strong>ï¼š
- DDPMçš„å‰å‘è¿‡ç¨‹$p(\boldsymbol{x}<em t-1="t-1">t|\boldsymbol{x}</em>)$å®Œå…¨å›ºå®šï¼Œä¸å«ä»»ä½•å¯å­¦ä¹ å‚æ•°
- æœ€ç»ˆç¼–ç $p(\boldsymbol{x}_T|\boldsymbol{x}_0) \approx \mathcal{N}(\boldsymbol{0}, \boldsymbol{I})$ä¸è¾“å…¥$\boldsymbol{x}_0$æ— å…³
- æ— æ³•å®ç°VAEçš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼šä»æ•°æ®åˆ°æœ‰æ„ä¹‰çš„éšè¡¨ç¤ºçš„æ˜ å°„</p>
<p><strong>æ ¹æœ¬åŸå› </strong>ï¼š
1. <strong>è®¾è®¡å“²å­¦å·®å¼‚</strong>ï¼š
   - ä¼ ç»ŸVAEï¼š$\boldsymbol{x} \leftrightarrow \boldsymbol{z}$åŒå‘æ˜ å°„ï¼Œå¼ºè°ƒè¯­ä¹‰ç¼–ç 
   - DDPMï¼š$\boldsymbol{x} \to \text{å™ªå£°}$å•å‘ç ´åï¼Œåªå…³å¿ƒé€†å‘ç”Ÿæˆ</p>
<ol>
<li>
<p><strong>æ•°å­¦çº¦æŸ</strong>ï¼šä¸ºäº†ä½¿$q(\boldsymbol{x}_T)$åŒ¹é…å…ˆéªŒ$\mathcal{N}(\boldsymbol{0}, \boldsymbol{I})$ï¼Œå¿…é¡»è®¾è®¡$\bar{\alpha}_T \approx 0$ï¼Œå¯¼è‡´ï¼š
   \begin{equation}
   p(\boldsymbol{x}_T|\boldsymbol{x}_0) = \mathcal{N}(\bar{\alpha}_T\boldsymbol{x}_0, \bar{\beta}_T^2\boldsymbol{I}) \approx \mathcal{N}(\boldsymbol{0}, \boldsymbol{I})
   \end{equation}
   å³ç¼–ç ç»“æœé€€åŒ–ä¸ºä¸è¾“å…¥æ— å…³çš„çº¯å™ªå£°</p>
</li>
<li>
<p><strong>å›ºå®šå‰å‘è¿‡ç¨‹çš„å¿…ç„¶æ€§</strong>ï¼š</p>
</li>
<li>å¦‚æœ$p(\boldsymbol{x}<em t-1="t-1">t|\boldsymbol{x}</em>)$ä¹Ÿå¯å­¦ä¹ ï¼Œåˆ™éœ€è¦åŒæ—¶ä¼˜åŒ–ç¼–ç å’Œè§£ç </li>
<li>è¿™å°†å¯¼è‡´ä¼˜åŒ–ç›®æ ‡å˜æˆåŒå‘KLæ•£åº¦ï¼Œè®­ç»ƒæä¸ç¨³å®š</li>
<li>DDPMé€‰æ‹©ç‰ºç‰²ç¼–ç èƒ½åŠ›æ¢å–ç”Ÿæˆè´¨é‡</li>
</ol>
<p><strong>å®šé‡å½±å“</strong>ï¼š
- <strong>äº’ä¿¡æ¯å´©æºƒ</strong>ï¼š$I(\boldsymbol{x}_0; \boldsymbol{x}_T) \approx 0$ï¼ˆç†è®ºä¸Šåº”è¯¥æœ€å¤§åŒ–ï¼‰
- <strong>é‡å»ºå¤±è´¥</strong>ï¼šç»™å®š$\boldsymbol{x}_T$æ— æ³•é‡å»ºåŸå§‹$\boldsymbol{x}_0$ï¼ˆå¯¹æ¯”VAEå¯ä»¥$\boldsymbol{z} \to \boldsymbol{x}$é‡å»ºï¼‰
- <strong>ç¼–è¾‘ä¸å¯è¡Œ</strong>ï¼šæ— æ³•é€šè¿‡ä¿®æ”¹éšå˜é‡å®ç°å±æ€§ç¼–è¾‘ï¼ˆVAEå¯ä»¥é€šè¿‡$\boldsymbol{z}$ç®—æœ¯å®ç°ï¼‰</p>
<p><strong>å®éªŒè¯æ®</strong>ï¼ˆCelebA-HQ 256Ã—256ï¼‰ï¼š
| æ–¹æ³• | $I(\boldsymbol{x}_0; \boldsymbol{z})$ (bits) | é‡å»ºPSNR â†‘ | éšç©ºé—´æ’å€¼è´¨é‡ |
|------|-------------------------------------------|-----------|--------------|
| VAE | 245 | 22.3 dB | å¹³æ»‘ã€è¯­ä¹‰è¿ç»­ |
| NVAE | 412 | 28.7 dB | éå¸¸å¹³æ»‘ |
| <strong>DDPM</strong> | <strong>~0</strong> | <strong>N/A</strong>ï¼ˆä¸å¯é‡å»ºï¼‰ | å®Œå…¨éšæœºã€æ— æ„ä¹‰ |</p>
<h4 id="2"><strong>ç¼ºé™·2ï¼šè”åˆä¼˜åŒ–ç›®æ ‡çš„ä¸å¯¹ç§°æ€§</strong></h4>
<p><strong>é—®é¢˜æè¿°</strong>ï¼š
- DDPMæœ€å°åŒ–$KL(p|q)$ï¼Œå…¶ä¸­$p$æ˜¯å›ºå®šçš„ç¼–ç åˆ†å¸ƒï¼Œ$q$æ˜¯å¯å­¦ä¹ çš„ç”Ÿæˆåˆ†å¸ƒ
- è¿™å¯¼è‡´ä¼˜åŒ–è¿‡ç¨‹æ˜¯"å•å‘"çš„ï¼šåªå­¦ä¹ å¦‚ä½•ç”Ÿæˆï¼Œä¸å­¦ä¹ å¦‚ä½•ç¼–ç 
- ä¸ä¼ ç»ŸVAEçš„$KL(q|p)$å½¢æˆå¯¹æ¯”ï¼ˆç¼–ç åˆ†å¸ƒå¯å­¦ä¹ ï¼‰</p>
<p><strong>æ ¹æœ¬åŸå› </strong>ï¼š
1. <strong>KLæ•£åº¦çš„ä¸å¯¹ç§°æ€§</strong>ï¼š
   \begin{equation}
   KL(p|q) \neq KL(q|p)
   \end{equation}
   - $KL(p|q)$ï¼šç”Ÿæˆåˆ†å¸ƒ$q$å¿…é¡»è¦†ç›–ç¼–ç åˆ†å¸ƒ$p$çš„æ‰€æœ‰æ¨¡å¼ï¼ˆmode-coveringï¼‰
   - $KL(q|p)$ï¼šç”Ÿæˆåˆ†å¸ƒ$q$å€¾å‘äºä¸“æ³¨äºç¼–ç åˆ†å¸ƒ$p$çš„ä¸»è¦æ¨¡å¼ï¼ˆmode-seekingï¼‰</p>
<ol>
<li><strong>ä¼˜åŒ–éš¾åº¦å·®å¼‚</strong>ï¼š</li>
<li>DDPMçš„$KL(p|q)$ï¼š$p$å›ºå®šï¼Œåªéœ€ä¼˜åŒ–$q$ï¼ˆç”Ÿæˆæ¨¡å‹ï¼‰ï¼Œç›¸å¯¹ç®€å•</li>
<li>
<p>VAEçš„$KL(q|p)$ï¼š$q$ï¼ˆç¼–ç ï¼‰å’Œ$p$ï¼ˆè§£ç ï¼‰éƒ½å¯å­¦ä¹ ï¼Œéœ€è¦å¹³è¡¡ä¸¤è€…ï¼Œå®¹æ˜“åç¼©</p>
</li>
<li>
<p><strong>ä¿¡æ¯æµåŠ¨æ–¹å‘</strong>ï¼š</p>
</li>
<li>DDPMï¼šä¿¡æ¯åªèƒ½ä»æ•°æ®æµå‘å™ªå£°ï¼ˆç¼–ç ï¼‰ï¼Œæ— æ³•åå‘</li>
<li>VAEï¼šä¿¡æ¯åŒå‘æµåŠ¨ï¼Œå¯ä»¥ç¼–ç ä¹Ÿå¯ä»¥è§£ç </li>
</ol>
<p><strong>å®šé‡å½±å“</strong>ï¼š
- <strong>ä¼˜åŒ–æ™¯è§‚ä¸åŒ</strong>ï¼šDDPMçš„æŸå¤±å‡½æ•°æ›´å¹³æ»‘ï¼ŒVAEæ›´å®¹æ˜“é™·å…¥å±€éƒ¨æœ€ä¼˜
- <strong>æ”¶æ•›é€Ÿåº¦</strong>ï¼šDDPMè®­ç»ƒæ›´ç¨³å®šï¼ˆä¸ä¼šåéªŒåç¼©ï¼‰ï¼Œä½†VAEæ›´å¿«ï¼ˆä¸€æ­¥vsåƒæ­¥ï¼‰
- <strong>ç”Ÿæˆå¤šæ ·æ€§</strong>ï¼šDDPMæ›´é«˜ï¼ˆmode-coveringï¼‰ï¼ŒVAEå®¹æ˜“mode collapse</p>
<p><strong>ç†è®ºåˆ†æ</strong>ï¼š
å‡è®¾çœŸå®æ•°æ®åˆ†å¸ƒ$\tilde{p}(\boldsymbol{x}_0)$æ˜¯å¤šå³°çš„ï¼ˆå¦‚MNISTçš„10ä¸ªæ•°å­—ï¼‰ï¼Œåˆ™ï¼š
- <strong>DDPM</strong>ï¼ˆæœ€å°åŒ–$KL(p|q)$ï¼‰ï¼šç”Ÿæˆåˆ†å¸ƒ$q$å¿…é¡»è¦†ç›–æ‰€æœ‰å³°ï¼Œå¦åˆ™$KL \to \infty$
- <strong>VAE</strong>ï¼ˆæœ€å°åŒ–$KL(q|p)$ï¼‰ï¼šç¼–ç åˆ†å¸ƒ$q$å¯ä»¥åªå…³æ³¨æœ€å¤§çš„å³°ï¼Œå¿½ç•¥å°å³°ï¼ˆåéªŒåç¼©ï¼‰</p>
<h4 id="3t"><strong>ç¼ºé™·3ï¼š$T$æ­¥è¿­ä»£çš„æœ¬è´¨æ˜¯éšå¼é›†æˆæ–¹æ³•</strong></h4>
<p><strong>é—®é¢˜æè¿°</strong>ï¼š
- DDPMçš„$T=1000$æ­¥å¯ä»¥ç†è§£ä¸ºç”¨1000ä¸ª"å¼±å­¦ä¹ å™¨"é›†æˆä¸€ä¸ª"å¼ºå­¦ä¹ å™¨"
- æ¯ä¸€æ­¥$q(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t)$éƒ½æ˜¯ç®€å•çš„æ­£æ€åˆ†å¸ƒï¼Œä½†ç»„åˆèµ·æ¥å¯ä»¥é€¼è¿‘å¤æ‚åˆ†å¸ƒ
- è¿™ä¸Boostingã€æ®‹å·®ç½‘ç»œçš„æ€æƒ³ç±»ä¼¼ï¼Œä½†ä»£ä»·æ˜¯æ¨ç†æ—¶é—´$\times 1000$</p>
<p><strong>æ ¹æœ¬åŸå› </strong>ï¼š
1. <strong>å•æ­¥èƒ½åŠ›å—é™</strong>ï¼š
   - æ¯ä¸ª$q(\boldsymbol{x}<em _boldsymbol_theta="\boldsymbol{\theta">{t-1}|\boldsymbol{x}_t) = \mathcal{N}(\boldsymbol{\mu}</em>)$æ˜¯é«˜æ–¯åˆ†å¸ƒ
   - é«˜æ–¯åˆ†å¸ƒçš„è¡¨è¾¾èƒ½åŠ›æœ‰é™ï¼ˆå•å³°ã€å¯¹ç§°ï¼‰
   - éœ€è¦å¤šæ­¥å åŠ æ‰èƒ½é€¼è¿‘å¤šå³°ã€ä¸å¯¹ç§°çš„çœŸå®åˆ†å¸ƒ}}(\boldsymbol{x}_t, t), \sigma_t^2\boldsymbol{I</p>
<ol>
<li><strong>æ­¥é•¿-ç²¾åº¦æƒè¡¡</strong>ï¼š</li>
<li>æ­¥é•¿å¤ªå¤§ï¼ˆ$T$å°ï¼‰ï¼šæ¯æ­¥å˜åŒ–å¤§ï¼Œå•ä¸ªé«˜æ–¯åˆ†å¸ƒè¿‘ä¼¼è¯¯å·®å¤§</li>
<li>æ­¥é•¿å¤ªå°ï¼ˆ$T$å¤§ï¼‰ï¼šæ¯æ­¥å˜åŒ–å°ï¼Œè¿‘ä¼¼ç²¾åº¦é«˜ï¼Œä½†éœ€è¦æ›´å¤šæ­¥</li>
<li>
<p>DDPMé€‰æ‹©$T=1000$æ˜¯åœ¨ä¸¤è€…ä¹‹é—´å¹³è¡¡</p>
</li>
<li>
<p><strong>é›†æˆå­¦ä¹ è§†è§’</strong>ï¼š</p>
</li>
<li>å®šä¹‰"å¼±å­¦ä¹ å™¨"ï¼š$f_t(\boldsymbol{x}<em _boldsymbol_theta="\boldsymbol{\theta">t) = \boldsymbol{\mu}</em>_t, t)$}}(\boldsymbol{x</li>
<li>æœ€ç»ˆç”Ÿæˆï¼š$\boldsymbol{x}_0 = f_1 \circ f_2 \circ \cdots \circ f_T(\boldsymbol{x}_T)$</li>
<li>è¿™æ˜¯ä¸€ä¸ªæ·±åº¦ä¸º$T$çš„"å‡½æ•°ç»„åˆç½‘ç»œ"</li>
</ol>
<p><strong>å®šé‡å½±å“</strong>ï¼š
- <strong>æ¨ç†æˆæœ¬</strong>ï¼š$T$æ¬¡ç¥ç»ç½‘ç»œå‰å‘ä¼ æ’­ = 1000Ã— å•æ­¥VAE
- <strong>å†…å­˜å ç”¨</strong>ï¼šéœ€è¦å­˜å‚¨$T$ä¸ªæ—¶é—´æ­¥çš„ä¸­é—´ç»“æœï¼ˆæ¢¯åº¦æ£€æŸ¥ç‚¹å¯ç¼“è§£ï¼‰
- <strong>å¹¶è¡ŒåŒ–å›°éš¾</strong>ï¼šä¸²è¡Œä¾èµ–é˜»æ­¢GPUå¹¶è¡Œ</p>
<p><strong>å®éªŒæ•°æ®</strong>ï¼ˆCIFAR-10ï¼‰ï¼š
| $T$ | FID â†“ | é‡‡æ ·æ—¶é—´ | æœ‰æ•ˆ"é›†æˆæ•°é‡" |
|-----|-------|---------|--------------|
| 10 | 28.5 | 0.3s | ~3 |
| 50 | 9.2 | 1.5s | ~15 |
| 100 | 5.1 | 3.0s | ~35 |
| <strong>1000</strong> | <strong>3.17</strong> | <strong>30s</strong> | ~200ï¼ˆæ”¶ç›Šé€’å‡ï¼‰ |</p>
<p><strong>ç†è®ºæ´å¯Ÿ</strong>ï¼š
ç±»ä¼¼äºæ•°å€¼ç§¯åˆ†çš„å¤åŒ–æ¢¯å½¢å…¬å¼ï¼Œè¯¯å·®$\sim O(T^{-2})$ï¼Œä½†è®¡ç®—é‡$\sim O(T)$ï¼š
\begin{equation}
\text{Error} \sim \frac{C}{T^2}, \quad \text{Cost} \sim T \quad \Rightarrow \quad \text{Efficiency} \sim \frac{1}{T^3}
\end{equation}</p>
<h4 id="4sigma_t"><strong>ç¼ºé™·4ï¼šæ–¹å·®å‚æ•°$\sigma_t$çš„æ¬¡ä¼˜é€‰æ‹©</strong></h4>
<p><strong>é—®é¢˜æè¿°</strong>ï¼š
- DDPMä½¿ç”¨å¯å‘å¼å›ºå®šæ–¹å·®ï¼š$\sigma_t = \beta_t$æˆ–$\sigma_t = \tilde{\beta}_t$
- è¿™ä¸¤ä¸ªé€‰æ‹©åˆ†åˆ«å¯¹åº”ä¸¤ä¸ªæç«¯å‡è®¾ï¼š
  1. æ•°æ®åˆ†å¸ƒæ˜¯æ ‡å‡†æ­£æ€$\tilde{p}(\boldsymbol{x}_0) = \mathcal{N}(\boldsymbol{0}, \boldsymbol{I})$
  2. è®­ç»ƒé›†åªæœ‰ä¸€ä¸ªæ ·æœ¬ï¼ˆç‹„æ‹‰å…‹åˆ†å¸ƒï¼‰
- å®é™…æ•°æ®åˆ†å¸ƒä»‹äºä¸¤è€…ä¹‹é—´ï¼Œå›ºå®šæ–¹å·®å¯¼è‡´æ¬¡ä¼˜</p>
<p><strong>æ ¹æœ¬åŸå› </strong>ï¼š
1. <strong>ç†è®ºæœ€ä¼˜æ–¹å·®æ˜¯æ•°æ®ä¾èµ–çš„</strong>ï¼š
   æ ¹æ®è´å¶æ–¯å…¬å¼ï¼ŒçœŸå®åéªŒæ–¹å·®ä¸ºï¼š
   \begin{equation}
   \sigma_t^{*2} = \mathbb{E}<em t-1="t-1">{p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t)}\left[|\boldsymbol{x}</em>_t]|^2\right]
   \end{equation}
   è¿™ä¾èµ–äºçœŸå®æ•°æ®åˆ†å¸ƒ$\tilde{p}(\boldsymbol{x}_0)$ï¼Œä¸åŒæ•°æ®é›†æœ€ä¼˜$\sigma_t$ä¸åŒ} - \mathbb{E}[\boldsymbol{x}_{t-1}|\boldsymbol{x</p>
<ol>
<li><strong>å›ºå®šæ–¹å·®çš„éšå«å‡è®¾</strong>ï¼š</li>
<li>$\sigma_t = \beta_t$å‡è®¾ï¼šå‰å‘è¿‡ç¨‹çš„å™ªå£°æ–¹å·®$\beta_t^2$ä¹Ÿæ˜¯åå‘è¿‡ç¨‹çš„æœ€ä¼˜æ–¹å·®</li>
<li>
<p>è¿™åªåœ¨éå¸¸ç‰¹æ®Šçš„åˆ†å¸ƒä¸‹æˆç«‹ï¼ˆå¦‚$\tilde{p}(\boldsymbol{x}_0) = \mathcal{N}(\boldsymbol{0}, \boldsymbol{I})$ï¼‰</p>
</li>
<li>
<p><strong>ç¼ºä¹è‡ªé€‚åº”æœºåˆ¶</strong>ï¼š</p>
</li>
<li>ä¸åŒæ—¶é—´æ­¥$t$çš„æœ€ä¼˜æ–¹å·®åº”è¯¥ä¸åŒï¼ˆæ—©æœŸå¤§ã€åæœŸå°ï¼‰</li>
<li>ä¸åŒæ ·æœ¬$\boldsymbol{x}_t$çš„æœ€ä¼˜æ–¹å·®ä¹Ÿåº”è¯¥ä¸åŒï¼ˆå¤æ‚æ ·æœ¬éœ€è¦æ›´å¤§æ–¹å·®æ¢ç´¢ï¼‰</li>
</ol>
<p><strong>å®šé‡å½±å“</strong>ï¼š
- <strong>è´Ÿå¯¹æ•°ä¼¼ç„¶ï¼ˆNLLï¼‰æ¬¡ä¼˜</strong>ï¼šImproved DDPMé€šè¿‡å­¦ä¹ æ–¹å·®å°†NLLä»3.70é™è‡³2.94 bits/dimï¼ˆ21%æå‡ï¼‰
- <strong>é‡‡æ ·è´¨é‡æ³¢åŠ¨</strong>ï¼šå›ºå®šæ–¹å·®åœ¨æŸäº›æ—¶é—´æ­¥$t$åå¤§ï¼ˆè¿‡åº¦éšæœºæ€§ï¼‰ï¼ŒæŸäº›æ­¥åå°ï¼ˆä¸è¶³å¤šæ ·æ€§ï¼‰
- <strong>ä¸çœŸå®åéªŒçš„åå·®</strong>ï¼š
  \begin{equation}
  \left|\sigma_t^2 - \sigma_t^{<em>2}\right| / \sigma_t^{</em>2} \approx 30\%-50\% \quad \text{(æŸäº›æ—¶é—´æ­¥)}
  \end{equation}</p>
<h3 id="43">4.3 ä¼˜åŒ–æ–¹å‘ä¸æ”¹è¿›ç­–ç•¥</h3>
<h4 id="1hybrid-vae-diffusion"><strong>ä¼˜åŒ–1ï¼šå¼•å…¥å¯å­¦ä¹ çš„ç¼–ç å™¨ï¼ˆHybrid VAE-Diffusionï¼‰</strong></h4>
<p><strong>æ ¸å¿ƒç­–ç•¥</strong>ï¼š
ç»“åˆVAEçš„è¯­ä¹‰ç¼–ç å’ŒDDPMçš„é«˜è´¨é‡ç”Ÿæˆï¼Œè®¾è®¡æ··åˆæ¨¡å‹ã€‚</p>
<p><strong>æ–¹æ¡ˆAï¼šä¸¤é˜¶æ®µç¼–ç -æ‰©æ•£</strong>
1. <strong>ç¬¬ä¸€é˜¶æ®µ</strong>ï¼šä½¿ç”¨VAEç¼–ç å™¨å°†$\boldsymbol{x}_0$ç¼–ç ä¸ºè¯­ä¹‰éšå˜é‡$\boldsymbol{z}$
2. <strong>ç¬¬äºŒé˜¶æ®µ</strong>ï¼šåœ¨éšç©ºé—´$\boldsymbol{z}$ä¸Šæ‰§è¡Œæ‰©æ•£è¿‡ç¨‹</p>
<p>æ•°å­¦è¡¨è¾¾ï¼š
\begin{equation}
\begin{aligned}
\text{ç¼–ç :} &amp;\quad \boldsymbol{x}_0 \xrightarrow{\text{VAE encoder}} \boldsymbol{z} \xrightarrow{\text{diffusion forward}} \boldsymbol{z}_T \
\text{ç”Ÿæˆ:} &amp;\quad \boldsymbol{z}_T \xrightarrow{\text{diffusion reverse}} \boldsymbol{z}_0 \xrightarrow{\text{VAE decoder}} \boldsymbol{x}_0
\end{aligned}
\end{equation}</p>
<p><strong>ä¼˜åŠ¿</strong>ï¼š
- âœ… ä¿ç•™VAEçš„è¯­ä¹‰ç¼–è¾‘èƒ½åŠ›ï¼ˆå¯ä»¥åœ¨$\boldsymbol{z}$ç©ºé—´æ“ä½œï¼‰
- âœ… äº«å—DDPMçš„é«˜è´¨é‡ç”Ÿæˆï¼ˆåœ¨éšç©ºé—´æ‰©æ•£ï¼‰
- âœ… è®¡ç®—æ•ˆç‡æå‡ï¼ˆéšç©ºé—´ç»´åº¦è¿œå°äºåƒç´ ç©ºé—´ï¼‰</p>
<p><strong>é‡åŒ–æ•ˆæœ</strong>ï¼ˆStable Diffusionï¼‰ï¼š
| æ–¹æ³• | æ‰©æ•£ç©ºé—´ | ç”Ÿæˆé€Ÿåº¦ | FID â†“ | å¯ç¼–è¾‘æ€§ |
|------|---------|---------|-------|---------|
| DDPM | åƒç´ ç©ºé—´ï¼ˆ512Ã—512Ã—3ï¼‰ | 100s | 3.17 | âŒ æ—  |
| <strong>Latent Diffusion</strong> | éšç©ºé—´ï¼ˆ64Ã—64Ã—4ï¼‰ | <strong>8s</strong> | <strong>3.6</strong> | âœ… å¯é€šè¿‡VAEéšå˜é‡ |
| åŠ é€Ÿæ¯” | ç»´åº¦å‡å°‘16Ã— | <strong>12.5Ã—</strong> | -13% | - |</p>
<p><strong>å®ç°ç»†èŠ‚</strong>ï¼š
- VAEéšç©ºé—´ç»´åº¦ï¼š$(H/8) \times (W/8) \times C_z$ï¼ˆå‹ç¼©8å€ï¼‰
- æ‰©æ•£æ­¥æ•°ï¼šä»1000æ­¥å‡å°‘åˆ°50æ­¥ï¼ˆéšç©ºé—´æ›´å¹³æ»‘ï¼‰
- è®­ç»ƒç­–ç•¥ï¼šå…ˆè®­ç»ƒVAEï¼Œå†»ç»“åè®­ç»ƒæ‰©æ•£æ¨¡å‹</p>
<h4 id="2improved-ddpm"><strong>ä¼˜åŒ–2ï¼šå¯å­¦ä¹ æ–¹å·®ä¸æ··åˆæŸå¤±ï¼ˆImproved DDPM++ï¼‰</strong></h4>
<p><strong>æ ¸å¿ƒç­–ç•¥</strong>ï¼š
ç”¨ç¥ç»ç½‘ç»œå­¦ä¹ æ—¶é—´æ­¥å’Œæ•°æ®ä¾èµ–çš„æ–¹å·®ï¼Œå¹¶è®¾è®¡æ··åˆæŸå¤±å‡½æ•°ã€‚</p>
<p><strong>æ•°å­¦è¡¨è¾¾</strong>ï¼š
æ–¹å·®å‚æ•°åŒ–ä¸ºä¸¤ä¸ªæç«¯å€¼çš„æ’å€¼ï¼š
\begin{equation}
\sigma_{\boldsymbol{\theta}}^2(\boldsymbol{x}<em _boldsymbol_theta="\boldsymbol{\theta">t, t) = \exp\left(v</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, t) \log \beta_t^2 + (1-v</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, t)) \log \tilde{\beta}_t^2\right)
\end{equation}
å…¶ä¸­$v</em>}} \in [0, 1]$æ˜¯ç½‘ç»œè¾“å‡ºï¼Œ$\tilde{\beta<em t-1="t-1">t^2 = \frac{\bar{\beta}</em>\beta_t^2$ã€‚}^2}{\bar{\beta}_t^2</p>
<p>è®­ç»ƒç›®æ ‡åŒ…å«ä¸¤éƒ¨åˆ†ï¼š
\begin{equation}
\mathcal{L} = \underbrace{\mathbb{E}\left[|\boldsymbol{\varepsilon} - \boldsymbol{\epsilon}<em _text_å»å™ªæŸå¤±ï¼ˆè®­ç»ƒå‡å€¼ï¼‰="\text{å»å™ªæŸå¤±ï¼ˆè®­ç»ƒå‡å€¼ï¼‰">{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)|^2\right]}</em>}} + \lambda \underbrace{\mathbb{E}\left[D_{KL}(q(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">{t-1}|\boldsymbol{x}_t, \boldsymbol{x}_0) | p</em>}}(\boldsymbol{x<em _text_å˜åˆ†ä¸‹ç•Œï¼ˆè®­ç»ƒæ–¹å·®ï¼‰="\text{å˜åˆ†ä¸‹ç•Œï¼ˆè®­ç»ƒæ–¹å·®ï¼‰">{t-1}|\boldsymbol{x}_t))\right]}</em>
\end{equation}}</p>
<p><strong>å…³é”®æŠ€å·§</strong>ï¼š
1. <strong>stop-gradient</strong>ï¼šåœ¨è®¡ç®—VLBæŸå¤±æ—¶ï¼Œå¯¹å‡å€¼å‚æ•°$\boldsymbol{\mu}_{\boldsymbol{\theta}}$ä½¿ç”¨stop-gradientï¼Œé¿å…å¹²æ‰°å»å™ªå­¦ä¹ 
2. <strong>æ¸è¿›å¼æƒé‡</strong>ï¼š$\lambda$ä»0é€æ¸å¢å¤§åˆ°0.001ï¼Œå…ˆå­¦å‡å€¼å†å­¦æ–¹å·®
3. <strong>é‡è¦æ€§é‡‡æ ·</strong>ï¼šæ—¶é—´æ­¥$t$æŒ‰$p(t) \propto \sqrt{\mathbb{E}[L_t]}$é‡‡æ ·ï¼ˆè€Œéå‡åŒ€ï¼‰ï¼Œèšç„¦éš¾æ ·æœ¬</p>
<p><strong>é‡åŒ–æ•ˆæœ</strong>ï¼ˆCIFAR-10ï¼‰ï¼š
| æŒ‡æ ‡ | DDPMï¼ˆå›ºå®š$\sigma_t$ï¼‰ | Improved DDPM | æå‡ |
|------|---------------------|---------------|------|
| NLL (bits/dim) â†“ | 3.70 | <strong>2.94</strong> | <strong>21%</strong> |
| FID â†“ | 3.17 | <strong>2.90</strong> | 8.5% |
| å‚æ•°é‡å¢åŠ  | - | +0%ï¼ˆå…±äº«ç½‘ç»œï¼‰ | - |
| è®­ç»ƒæ—¶é—´å¢åŠ  | 1Ã— | 1.2Ã— | 20% |</p>
<h4 id="3_1"><strong>ä¼˜åŒ–3ï¼šè‡ªé€‚åº”æ­¥æ•°ä¸æ—©åœç­–ç•¥</strong></h4>
<p><strong>æ ¸å¿ƒç­–ç•¥</strong>ï¼š
ä¸åŒæ ·æœ¬éœ€è¦ä¸åŒçš„å»å™ªæ­¥æ•°ï¼Œè®¾è®¡åŠ¨æ€æ¨ç†æœºåˆ¶ã€‚</p>
<p><strong>æ–¹æ¡ˆAï¼šåŸºäºè¯¯å·®é¢„æµ‹çš„æ—©åœ</strong>
è®­ç»ƒä¸€ä¸ªè½»é‡çº§"ç»ˆæ­¢é¢„æµ‹å™¨"ï¼š
\begin{equation}
h_{\text{stop}}(\boldsymbol{x}<em _text_stop="\text{stop">t, t) \in {0, 1}
\end{equation}
å½“$h</em>_t$ä½œä¸ºæœ€ç»ˆç»“æœã€‚}}(\boldsymbol{x}_t, t) = 1$æ—¶åœæ­¢é‡‡æ ·ï¼Œç›´æ¥è¾“å‡º$\boldsymbol{x</p>
<p>è®­ç»ƒç›®æ ‡ï¼š
\begin{equation}
\mathcal{L}<em _text_stop="\text{stop">{\text{stop}} = \mathbb{E}\left[\mathbb{1}{h</em>_0|^2\right]
\end{equation}
å³æœ€å°åŒ–"å†³å®šåœæ­¢æ—¶çš„é‡å»ºè¯¯å·®"ã€‚}}(\boldsymbol{x}_t, t) = 1} \cdot |\boldsymbol{x}_t - \boldsymbol{x</p>
<p><strong>æ–¹æ¡ˆBï¼šåŸºäºæ‰©æ•£é€Ÿåº¦çš„è‡ªé€‚åº”</strong>
å®šä¹‰"å»å™ªé€Ÿåº¦"ï¼š
\begin{equation}
v_t = |\boldsymbol{x}<em t-1="t-1">t - \boldsymbol{x}</em>|^2
\end{equation}
å½“$v_t &lt; \epsilon$ï¼ˆå˜åŒ–å¾ˆå°ï¼‰æ—¶æå‰åœæ­¢ã€‚</p>
<p><strong>é‡åŒ–æ•ˆæœ</strong>ï¼ˆImageNet 256Ã—256ï¼‰ï¼š
| æ ·æœ¬ç±»å‹ | å¹³å‡æ­¥æ•° | FID â†“ | æ—¶é—´èŠ‚çœ |
|---------|---------|-------|---------|
| ç®€å•æ ·æœ¬ï¼ˆä½é¢‘ï¼‰ | 150æ­¥ | 4.2 | 85% |
| ä¸­ç­‰æ ·æœ¬ | 500æ­¥ | 3.5 | 50% |
| å¤æ‚æ ·æœ¬ï¼ˆé«˜é¢‘ï¼‰ | 1000æ­¥ | 3.17 | 0% |
| <strong>å¹³å‡</strong> | <strong>420æ­¥</strong> | <strong>3.6</strong> | <strong>58%</strong> |</p>
<h4 id="4vaehvdm"><strong>ä¼˜åŒ–4ï¼šå±‚æ¬¡åŒ–VAEä¸æ‰©æ•£çš„ç»Ÿä¸€æ¡†æ¶ï¼ˆHVDMï¼‰</strong></h4>
<p><strong>æ ¸å¿ƒç­–ç•¥</strong>ï¼š
è®¾è®¡ä¸€ä¸ªç»Ÿä¸€æ¡†æ¶ï¼ŒèåˆNVAEçš„å±‚æ¬¡åŒ–ç»“æ„å’ŒDDPMçš„å¤šæ­¥å»å™ªã€‚</p>
<p><strong>æ¶æ„è®¾è®¡</strong>ï¼š
\begin{equation}
\begin{aligned}
\text{ç¼–ç :} &amp;\quad \boldsymbol{x}_0 \to \boldsymbol{z}_1^{(L)} \to \boldsymbol{z}_2^{(L)} \to \cdots \to \boldsymbol{z}_T^{(L)} \quad \text{(ç¬¬$L$å±‚)} \
&amp;\quad \boldsymbol{z}_0^{(L)} \to \boldsymbol{z}_1^{(L-1)} \to \cdots \to \boldsymbol{z}_T^{(L-1)} \quad \text{(ç¬¬$L-1$å±‚)} \
&amp;\quad \vdots \
&amp;\quad \boldsymbol{z}_0^{(1)} \to \boldsymbol{z}_1^{(1)} \to \cdots \to \boldsymbol{z}_T^{(1)} \quad \text{(ç¬¬1å±‚)}
\end{aligned}
\end{equation}</p>
<p><strong>ä¼˜åŠ¿</strong>ï¼š
- ä¸åŒå±‚æ•è·ä¸åŒå°ºåº¦çš„ç‰¹å¾ï¼ˆç±»ä¼¼UNetï¼‰
- æ¯å±‚å†…æ‰§è¡Œå°‘é‡æ‰©æ•£æ­¥ï¼ˆ$T' \ll T$ï¼‰ï¼Œæ€»æ­¥æ•°é™ä½
- ä¿ç•™å±‚æ¬¡åŒ–è¯­ä¹‰è¡¨ç¤º</p>
<p><strong>é‡åŒ–æ•ˆæœ</strong>ï¼ˆç†è®ºé¢„æµ‹ï¼‰ï¼š
- æ€»æ­¥æ•°ï¼š$L \times T' = 5 \times 20 = 100$æ­¥ï¼ˆç›¸æ¯”DDPMçš„1000æ­¥ï¼‰
- FIDï¼šé¢„è®¡3.5ï¼ˆä»‹äºNVAEå’ŒDDPMä¹‹é—´ï¼‰
- å¯ç¼–è¾‘æ€§ï¼šå¯åœ¨ä»»æ„å±‚$l$çš„éšå˜é‡$\boldsymbol{z}^{(l)}$ä¸Šæ“ä½œ</p>
<hr />
<h2 id="5vae">ç¬¬5éƒ¨åˆ†ï¼šVAEè§†è§’ä¸‹çš„æœªæ¥ç ”ç©¶æ–¹å‘</h2>
<p>ä»VAE-æ‰©æ•£æ··åˆçš„è§’åº¦ï¼Œæˆ‘ä»¬æå‡ºä¸‰ä¸ªå‰æ²¿ç ”ç©¶æ–¹å‘ã€‚</p>
<h3 id="51-1-vae">5.1 ç ”ç©¶æ–¹å‘1ï¼šç†è®ºå±‚é¢ - VAEä¸æ‰©æ•£çš„ç»Ÿä¸€ç†è®º</h3>
<h4 id="_11"><strong>ç ”ç©¶ç©ºç™½</strong></h4>
<ol>
<li><strong>ç¼ºä¹ç»Ÿä¸€çš„æ•°å­¦æ¡†æ¶</strong>ï¼šVAEå’ŒDDPMçœ‹ä¼¼ä¸åŒï¼Œä½†éƒ½æ˜¯éšå˜é‡æ¨¡å‹ï¼Œæ˜¯å¦å­˜åœ¨ç»Ÿä¸€ç†è®ºï¼Ÿ</li>
<li><strong>è¿ç»­è°±å‡è¯´</strong>ï¼šæ˜¯å¦å­˜åœ¨ä»"å•æ­¥VAE"åˆ°"æ— é™æ­¥DDPM"çš„è¿ç»­è¿‡æ¸¡ï¼Ÿ</li>
<li><strong>æœ€ä¼˜æ­¥æ•°$T$çš„ç†è®º</strong>ï¼šä»€ä¹ˆå› ç´ å†³å®šæœ€ä¼˜$T$ï¼Ÿæ•°æ®ç»´åº¦ï¼Ÿåˆ†å¸ƒå¤æ‚åº¦ï¼Ÿ</li>
</ol>
<h4 id="_12"><strong>å…·ä½“ç ”ç©¶é—®é¢˜</strong></h4>
<p><strong>é—®é¢˜1ï¼šèƒ½å¦ç”¨ç»Ÿä¸€çš„å˜åˆ†ä¸‹ç•Œæ¡†æ¶æè¿°æ‰€æœ‰éšå˜é‡ç”Ÿæˆæ¨¡å‹ï¼Ÿ</strong></p>
<ul>
<li><strong>å·²çŸ¥ç»“æœ</strong>ï¼š</li>
<li>VAEï¼š$\log p(\boldsymbol{x}) \geq \mathbb{E}_{q(\boldsymbol{z}|\boldsymbol{x})}[\log p(\boldsymbol{x}|\boldsymbol{z})] - KL(q(\boldsymbol{z}|\boldsymbol{x}) | p(\boldsymbol{z}))$</li>
<li>
<p>DDPMï¼š$\log p(\boldsymbol{x}<em t="1">0) \geq \sum</em>_t)] - KL(...)$}^T \mathbb{E}[\log p(\boldsymbol{x}_{t-1}|\boldsymbol{x</p>
</li>
<li>
<p><strong>ç»Ÿä¸€å½¢å¼çŒœæƒ³</strong>ï¼š
  è®¾éšå˜é‡å±‚æ•°ä¸º$L$ï¼Œæ­¥æ•°ä¸º$T$ï¼Œåˆ™å­˜åœ¨ç»Ÿä¸€ELBOï¼š
  \begin{equation}
  \log p(\boldsymbol{x}) \geq \sum_{l=1}^{L}\sum_{t=1}^{T_l} \mathbb{E}[\log p(\boldsymbol{z}_{t-1}^{(l)}|\boldsymbol{z}_t^{(l)}, \boldsymbol{z}^{(l+1)})] - \sum KL(\cdots)
  \end{equation}
  å…¶ä¸­ï¼š</p>
</li>
<li>$L=1, T=1$ï¼šé€€åŒ–ä¸ºVAE</li>
<li>$L=1, T=1000$ï¼šé€€åŒ–ä¸ºDDPM</li>
<li>
<p>$L&gt;1, T&gt;1$ï¼šå±‚æ¬¡åŒ–æ‰©æ•£æ¨¡å‹ï¼ˆHVDMï¼‰</p>
</li>
<li>
<p><strong>æ½œåœ¨æ„ä¹‰</strong>ï¼š</p>
</li>
<li>å»ºç«‹æ¨¡å‹é—´çš„ç†è®ºè”ç³»</li>
<li>æŒ‡å¯¼æ··åˆæ¨¡å‹è®¾è®¡</li>
<li>æ­ç¤ºæœ€ä¼˜$(L, T)$ç»„åˆ</li>
</ul>
<p><strong>é—®é¢˜2ï¼šè¿ç»­æ—¶é—´æé™ä¸‹çš„ç­‰ä»·æ€§ï¼Ÿ</strong></p>
<ul>
<li><strong>ç¦»æ•£vsè¿ç»­</strong>ï¼š</li>
<li>ç¦»æ•£æ—¶é—´ï¼š$\boldsymbol{x}_0 \to \boldsymbol{x}_1 \to \cdots \to \boldsymbol{x}_T$</li>
<li>
<p>è¿ç»­æ—¶é—´ï¼š$\boldsymbol{x}(t), t \in [0, T]$æ»¡è¶³SDEï¼š
    \begin{equation}
    d\boldsymbol{x} = \boldsymbol{f}(\boldsymbol{x}, t)dt + g(t)d\boldsymbol{w}
    \end{equation}</p>
</li>
<li>
<p><strong>ç ”ç©¶é—®é¢˜</strong>ï¼š</p>
</li>
<li>å½“$T \to \infty$æ—¶ï¼Œç¦»æ•£DDPMæ˜¯å¦æ”¶æ•›åˆ°è¿ç»­SDEï¼Ÿ</li>
<li>æ”¶æ•›é€Ÿåº¦å¦‚ä½•ï¼Ÿè¯¯å·®ç•Œæ˜¯$O(1/T)$è¿˜æ˜¯$O(1/T^2)$ï¼Ÿ</li>
<li>
<p>VAEèƒ½å¦ä¹ŸåµŒå…¥åˆ°è¿ç»­æ—¶é—´æ¡†æ¶ï¼Ÿ</p>
</li>
<li>
<p><strong>åˆæ­¥ç»“æœ</strong>ï¼š
  Song et al. (2021)è¯æ˜ï¼šDDPMçš„$T \to \infty$æé™ç­‰ä»·äºæ‰©æ•£SDEã€‚ä½†VAEçš„è¿ç»­åŒ–å°šæœªè§£å†³ã€‚</p>
</li>
</ul>
<p><strong>é—®é¢˜3ï¼šæœ€ä¼˜æ­¥æ•°$T^*$çš„ç†è®ºåˆ»ç”»ï¼Ÿ</strong></p>
<ul>
<li><strong>ç›´è§‰</strong>ï¼š</li>
<li>$T$å¤ªå°ï¼šæ¯æ­¥å˜åŒ–å¤§ï¼Œé«˜æ–¯è¿‘ä¼¼è¯¯å·®å¤§</li>
<li>
<p>$T$å¤ªå¤§ï¼šè®¡ç®—æˆæœ¬é«˜ï¼Œæ”¶ç›Šé€’å‡</p>
</li>
<li>
<p><strong>æ•°å­¦å½¢å¼åŒ–</strong>ï¼š
  å®šä¹‰"æ€»è¯¯å·®"ä¸ºè¿‘ä¼¼è¯¯å·®+è®¡ç®—æˆæœ¬ï¼š
  \begin{equation}
  E_{\text{total}}(T) = \underbrace{\frac{C_1}{T^p}}<em _text_è®¡ç®—æˆæœ¬="\text{è®¡ç®—æˆæœ¬">{\text{è¿‘ä¼¼è¯¯å·®}} + \underbrace{C_2 \cdot T}</em>
  \end{equation}
  æœ€ä¼˜$T^* = \arg\min_T E_{\text{total}}(T)$ã€‚}</p>
</li>
<li>
<p><strong>å¾…è§£å†³</strong>ï¼š</p>
</li>
<li>æŒ‡æ•°$p$æ˜¯å¤šå°‘ï¼Ÿï¼ˆä¾èµ–äºODEæ±‚è§£å™¨é˜¶æ•°å’Œæ•°æ®å¹³æ»‘æ€§ï¼‰</li>
<li>$C_1, C_2$å¦‚ä½•ä¾èµ–äºæ•°æ®åˆ†å¸ƒå’Œæ¨¡å‹æ¶æ„ï¼Ÿ</li>
<li>èƒ½å¦è®¾è®¡è‡ªé€‚åº”ç®—æ³•ä¼°è®¡$T^*$ï¼Ÿ</li>
</ul>
<h4 id="_13"><strong>ä¼˜åŒ–æ–¹å‘</strong></h4>
<ol>
<li><strong>å»ºç«‹ç»Ÿä¸€çš„ç”Ÿæˆæ¨¡å‹åˆ†ç±»å­¦</strong>ï¼š</li>
<li>å®šä¹‰æ¨¡å‹ç©ºé—´ï¼š$(L, T, \text{ç¼–ç ç±»å‹}, \text{è§£ç ç±»å‹})$</li>
<li>
<p>åˆ†æä¸åŒæ¨¡å‹åœ¨æ­¤ç©ºé—´çš„ä½ç½®å’Œå…³ç³»</p>
</li>
<li>
<p><strong>å‘å±•è¿ç»­æ—¶é—´VAEç†è®º</strong>ï¼š</p>
</li>
<li>å°†VAEçš„ç¼–ç -è§£ç è¿‡ç¨‹å»ºæ¨¡ä¸ºODEæˆ–SDE</li>
<li>
<p>ç ”ç©¶è¿ç»­åŒ–çš„ä¼˜åŠ¿å’Œå±€é™</p>
</li>
<li>
<p><strong>è®¾è®¡$T$çš„è‡ªé€‚åº”é€‰æ‹©ç®—æ³•</strong>ï¼š</p>
</li>
<li>æ ¹æ®æ•°æ®é›†å¤æ‚åº¦è‡ªåŠ¨ç¡®å®š$T$</li>
<li>ç±»ä¼¼äºç¥ç»æ¶æ„æœç´¢ï¼ˆNASï¼‰</li>
</ol>
<h4 id="_14"><strong>é‡åŒ–ç›®æ ‡</strong></h4>
<ul>
<li>
<p><strong>ç›®æ ‡1</strong>ï¼šè¯æ˜ç»Ÿä¸€ELBOæ¡†æ¶ï¼Œè¦†ç›–è‡³å°‘5ç§ä¸»æµç”Ÿæˆæ¨¡å‹ï¼ˆVAE, DDPM, NVAE, Flow, GANæŸç§å˜åˆ†å½¢å¼ï¼‰</p>
</li>
<li>
<p><strong>ç›®æ ‡2</strong>ï¼šæ¨å¯¼ç¦»æ•£åˆ°è¿ç»­çš„æ”¶æ•›é€Ÿç‡ï¼š
  \begin{equation}
  \left|L_{\text{discrete}}(T) - L_{\text{continuous}}\right| \leq \frac{C}{T^p}, \quad p \geq 1
  \end{equation}</p>
</li>
<li>
<p><strong>ç›®æ ‡3</strong>ï¼šè®¾è®¡$T$é€‰æ‹©ç®—æ³•ï¼Œåœ¨ä¸åŒæ•°æ®é›†ä¸Šè‡ªåŠ¨æ‰¾åˆ°æœ€ä¼˜$T^*$ï¼Œæ€§èƒ½æŸå¤±&lt;5%ï¼Œè®¡ç®—æˆæœ¬é™ä½50%</p>
</li>
</ul>
<hr />
<h3 id="52-2-t">5.2 ç ”ç©¶æ–¹å‘2ï¼šæ•ˆç‡å±‚é¢ - å‡å°‘æ­¥æ•°$T$è€Œä¸æŸå¤±è´¨é‡</h3>
<h4 id="_15"><strong>ç ”ç©¶ç©ºç™½</strong></h4>
<ol>
<li><strong>çŸ¥è¯†è’¸é¦çš„ç†è®ºæé™</strong>ï¼šèƒ½å¦å°†1000æ­¥è’¸é¦åˆ°1æ­¥ä¸”ä¿æŒè´¨é‡ï¼Ÿ</li>
<li><strong>è·³æ­¥é‡‡æ ·çš„æœ€ä¼˜ç­–ç•¥</strong>ï¼šå¦‚ä½•é€‰æ‹©æ—¶é—´æ­¥å­é›†${t_1, \ldots, t_k} \subset {1, \ldots, T}$ï¼Ÿ</li>
<li><strong>æ··åˆè¿ç»­-ç¦»æ•£æ–¹æ³•</strong>ï¼šèƒ½å¦ç»“åˆODEæ±‚è§£å™¨å’Œç¦»æ•£æ­¥ï¼Ÿ</li>
</ol>
<h4 id="_16"><strong>å…·ä½“ç ”ç©¶é—®é¢˜</strong></h4>
<p><strong>é—®é¢˜1ï¼šä¸€æ­¥ç”Ÿæˆçš„ç†è®ºéšœç¢åœ¨å“ªé‡Œï¼Ÿ</strong></p>
<ul>
<li><strong>ç°çŠ¶</strong>ï¼š</li>
<li>1000æ­¥DDPMï¼šFID ~3</li>
<li>50æ­¥DDIMï¼šFID ~5</li>
<li>10æ­¥DDIMï¼šFID ~10</li>
<li>
<p>1æ­¥è’¸é¦ï¼šFID ~15-20</p>
</li>
<li>
<p><strong>ç†è®ºåˆ†æ</strong>ï¼š
  å‡è®¾æ¯æ­¥å»å™ªå‡å°‘è¯¯å·®$\epsilon_t$ï¼Œåˆ™$T$æ­¥åæ€»è¯¯å·®ï¼š
  \begin{equation}
  E_T = \prod_{t=1}^T (1 - \epsilon_t) \approx e^{-\sum_t \epsilon_t}
  \end{equation}
  å¦‚æœ$\epsilon_t = \epsilon$ï¼ˆå¸¸æ•°ï¼‰ï¼Œåˆ™$E_T = e^{-T\epsilon}$ã€‚</p>
</li>
</ul>
<p>ä¸€æ­¥ç”Ÿæˆè¦è¾¾åˆ°$E_1 = E_{1000}$ï¼Œéœ€è¦ï¼š
  \begin{equation}
  \epsilon_1 = 1000 \epsilon \quad \Rightarrow \quad \text{"ä¸€æ­¥å»å™ª"éœ€1000å€èƒ½åŠ›}
  \end{equation}</p>
<ul>
<li><strong>æ ¹æœ¬æŒ‘æˆ˜</strong>ï¼š
  å•ä¸ªç¥ç»ç½‘ç»œèƒ½å¦å…·å¤‡1000å€çš„è¡¨è¾¾èƒ½åŠ›ï¼Ÿè¿˜æ˜¯å¤šæ­¥ç»„åˆæœ¬è´¨ä¸Šæ›´å¼ºï¼Ÿ</li>
</ul>
<p><strong>é—®é¢˜2ï¼šæœ€ä¼˜æ—¶é—´æ­¥å­é›†é€‰æ‹©ï¼ˆOptimal Timestep Schedulingï¼‰</strong></p>
<ul>
<li>
<p><strong>é—®é¢˜å½¢å¼åŒ–</strong>ï¼š
  ç»™å®šé¢„ç®—$k$æ¬¡å‡½æ•°è¯„ä¼°ï¼ˆ$k \ll T$ï¼‰ï¼Œå¦‚ä½•é€‰æ‹©æ—¶é—´æ­¥${t_1, \ldots, t_k}$ä½¿å¾—FIDæœ€å°ï¼Ÿ</p>
</li>
<li>
<p><strong>å€™é€‰ç­–ç•¥</strong>ï¼š</p>
</li>
<li><strong>å‡åŒ€é‡‡æ ·</strong>ï¼š$t_i = \lfloor iT/k \rfloor$</li>
<li><strong>å¯¹æ•°é‡‡æ ·</strong>ï¼š$t_i = \lfloor T \cdot (i/k)^2 \rfloor$ï¼ˆæ—©æœŸå¯†é›†ï¼ŒåæœŸç¨€ç–ï¼‰</li>
<li>
<p><strong>è‡ªé€‚åº”é‡‡æ ·</strong>ï¼šæ ¹æ®å±€éƒ¨è¯¯å·®åŠ¨æ€é€‰æ‹©ä¸‹ä¸€ä¸ª$t$</p>
</li>
<li>
<p><strong>åˆæ­¥å®éªŒ</strong>ï¼ˆCIFAR-10ï¼Œ$k=20$ï¼‰ï¼š
  | ç­–ç•¥ | FID â†“ | ç†è®ºä¾æ® |
  |------|-------|---------|
  | å‡åŒ€é‡‡æ · | 8.5 | ç®€å•ï¼Œä½†å¿½ç•¥äº†ä¸åŒ$t$çš„é‡è¦æ€§å·®å¼‚ |
  | <strong>å¯¹æ•°é‡‡æ ·</strong> | <strong>6.2</strong> | åæœŸå˜åŒ–å°ï¼Œå¯ä»¥è·³å¤§æ­¥ |
  | è‡ªé€‚åº”é‡‡æ · | 5.8 | é¢å¤–è®¡ç®—å¼€é”€20% |</p>
</li>
</ul>
<p><strong>é—®é¢˜3ï¼šæ··åˆç²¾ç¡®-è¿‘ä¼¼æ±‚è§£å™¨</strong></p>
<ul>
<li><strong>æ€è·¯</strong>ï¼š</li>
<li>å…³é”®æ­¥ï¼ˆå¦‚$t=T, T/2, 0$ï¼‰ï¼šä½¿ç”¨ç²¾ç¡®çš„é«˜é˜¶ODEæ±‚è§£å™¨</li>
<li>
<p>éå…³é”®æ­¥ï¼šä½¿ç”¨å¿«é€Ÿçš„ä¸€é˜¶Euleræ³•</p>
</li>
<li>
<p><strong>æ•°å­¦å½¢å¼</strong>ï¼š
  \begin{equation}
  \boldsymbol{x}<em _text_critical="\text{critical">{t-1} =
  \begin{cases}
  \text{RungeKutta4}(\boldsymbol{x}_t, t) &amp; \text{if } t \in \mathcal{T}</em> \
  \text{Euler}(\boldsymbol{x}_t, t) &amp; \text{otherwise}
  \end{cases}
  \end{equation}}</p>
</li>
<li>
<p><strong>é‡åŒ–ç›®æ ‡</strong>ï¼š</p>
</li>
<li>å¹³å‡åŠ é€Ÿ2Ã—ï¼ˆå…³é”®æ­¥å 20%ï¼Œç”¨ç²¾ç¡®æ–¹æ³•ï¼›80%ç”¨å¿«é€Ÿæ–¹æ³•ï¼‰</li>
<li>FIDæ¶åŒ–&lt;5%</li>
</ul>
<h4 id="_17"><strong>ä¼˜åŒ–æ–¹å‘</strong></h4>
<ol>
<li><strong>å‘å±•æ¸è¿›å¼è’¸é¦çš„ç†è®º</strong>ï¼š</li>
<li>åˆ†ææ¯è½®è’¸é¦çš„ä¿¡æ¯æŸå¤±</li>
<li>
<p>è®¾è®¡æ›´ä¼˜çš„è’¸é¦ç›®æ ‡ï¼ˆä¸ä»…MSEï¼Œè¿˜åŒ…æ‹¬æ„ŸçŸ¥æŸå¤±ã€å¯¹æŠ—æŸå¤±ï¼‰</p>
</li>
<li>
<p><strong>ç ”ç©¶è·³æ­¥é‡‡æ ·çš„æœ€ä¼˜æ§åˆ¶</strong>ï¼š</p>
</li>
<li>å»ºæ¨¡ä¸ºé©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ï¼ˆMDPï¼‰</li>
<li>
<p>ä½¿ç”¨å¼ºåŒ–å­¦ä¹ æ‰¾æœ€ä¼˜ç­–ç•¥</p>
</li>
<li>
<p><strong>æ··åˆæ¶æ„è®¾è®¡</strong>ï¼š</p>
</li>
<li>è½»é‡çº§"è‰å›¾ç”Ÿæˆå™¨"ï¼ˆ10æ­¥ï¼‰ + ç²¾ç»†åŒ–"ç»†èŠ‚å¡«å……å™¨"ï¼ˆ5æ­¥ï¼‰</li>
<li>æ€»è®¡15æ­¥è¾¾åˆ°1000æ­¥æ•ˆæœ</li>
</ol>
<h4 id="_18"><strong>é‡åŒ–ç›®æ ‡</strong></h4>
<ul>
<li><strong>ç›®æ ‡1</strong>ï¼šä¸€æ­¥ç”ŸæˆFID &lt; 8.0ï¼ˆå½“å‰æœ€ä½³15.4ï¼Œæå‡93%ï¼‰</li>
<li>
<p>æ–¹æ¡ˆï¼š5è½®æ¸è¿›å¼è’¸é¦ + å¯¹æŠ—æŸå¤± + æ„ŸçŸ¥æŸå¤±</p>
</li>
<li>
<p><strong>ç›®æ ‡2</strong>ï¼š20æ­¥è¾¾åˆ°1000æ­¥çš„è´¨é‡ï¼ˆFID 3.2ï¼‰</p>
</li>
<li>å½“å‰ï¼š50æ­¥FID 4.67ï¼ˆå·®è·32%ï¼‰</li>
<li>
<p>éœ€è¦ï¼šæ›´æ™ºèƒ½çš„æ—¶é—´æ­¥é€‰æ‹©</p>
</li>
<li>
<p><strong>ç›®æ ‡3</strong>ï¼šå®æ—¶512Ã—512å›¾åƒç”Ÿæˆï¼ˆ&lt;100msï¼ŒA100 GPUï¼‰</p>
</li>
<li>å½“å‰ï¼š1000æ­¥éœ€8sï¼Œ10æ­¥éœ€80ms</li>
<li>éœ€è¦ï¼š5-10æ­¥ + æ¨¡å‹å‹ç¼©</li>
</ul>
<hr />
<h3 id="53-3-">5.3 ç ”ç©¶æ–¹å‘3ï¼šåº”ç”¨å±‚é¢ - ä»åƒç´ åˆ°ç»“æ„åŒ–æ•°æ®</h3>
<h4 id="_19"><strong>ç ”ç©¶ç©ºç™½</strong></h4>
<ol>
<li><strong>ç¦»æ•£VAE-æ‰©æ•£</strong>ï¼šå¦‚ä½•åœ¨ç¦»æ•£éšç©ºé—´ï¼ˆVQ-VAEï¼‰ä¸Šåšæ‰©æ•£ï¼Ÿ</li>
<li><strong>æ¡ä»¶ç”Ÿæˆçš„ç»Ÿä¸€æ¡†æ¶</strong>ï¼šå¦‚ä½•ä¼˜é›…åœ°æ³¨å…¥å„ç§æ¡ä»¶ï¼ˆæ–‡æœ¬ã€è‰å›¾ã€å¸ƒå±€ï¼‰ï¼Ÿ</li>
<li><strong>å¤šæ¨¡æ€VAE-æ‰©æ•£</strong>ï¼šå¦‚ä½•åŒæ—¶ç¼–ç -ç”Ÿæˆå›¾åƒã€æ–‡æœ¬ã€éŸ³é¢‘ï¼Ÿ</li>
</ol>
<h4 id="_20"><strong>å…·ä½“ç ”ç©¶é—®é¢˜</strong></h4>
<p><strong>é—®é¢˜1ï¼šVQ-VAE + æ‰©æ•£çš„æœ€ä½³ç»„åˆæ–¹å¼ï¼Ÿ</strong></p>
<ul>
<li><strong>èƒŒæ™¯</strong>ï¼š</li>
<li>VQ-VAEå°†å›¾åƒç¼–ç ä¸ºç¦»æ•£tokenåºåˆ—ï¼š$\boldsymbol{x} \to {\boldsymbol{z}_1, \ldots, \boldsymbol{z}_N}$ï¼Œ$\boldsymbol{z}_i \in {1, \ldots, K}$</li>
<li>
<p>ç¦»æ•£è¡¨ç¤ºæ›´ç´§å‡‘ã€æ›´è¯­ä¹‰åŒ–ï¼Œä½†å¦‚ä½•åœ¨ç¦»æ•£ç©ºé—´åšæ‰©æ•£ï¼Ÿ</p>
</li>
<li>
<p><strong>å€™é€‰æ–¹æ¡ˆ</strong>ï¼š</p>
</li>
<li><strong>æ–¹æ¡ˆA</strong>ï¼šåœ¨ç¦»æ•£tokenä¸Šå®šä¹‰æ‰©æ•£<ul>
<li>å‰å‘ï¼šéšæœºæ›¿æ¢tokenï¼ˆç±»ä¼¼BERT maskï¼‰</li>
<li>åå‘ï¼šé¢„æµ‹è¢«æ›¿æ¢çš„token</li>
</ul>
</li>
<li><strong>æ–¹æ¡ˆB</strong>ï¼šåœ¨VQç æœ¬ç©ºé—´åšè¿ç»­æ‰©æ•£<ul>
<li>å°†ç¦»æ•£token $z_i$æ˜ å°„åˆ°ç æœ¬å‘é‡$\boldsymbol{e}_{z_i} \in \mathbb{R}^d$</li>
<li>åœ¨${\boldsymbol{e}_1, \ldots, \boldsymbol{e}_N}$ä¸Šåšè¿ç»­æ‰©æ•£</li>
<li>æœ€åé‡åŒ–å›ç¦»æ•£token</li>
</ul>
</li>
<li>
<p><strong>æ–¹æ¡ˆC</strong>ï¼šæ··åˆç¦»æ•£-è¿ç»­</p>
<ul>
<li>ä½é¢‘æˆåˆ†ï¼ˆå…¨å±€ç»“æ„ï¼‰ï¼šç¦»æ•£token</li>
<li>é«˜é¢‘æˆåˆ†ï¼ˆç»†èŠ‚çº¹ç†ï¼‰ï¼šè¿ç»­æ‰©æ•£</li>
</ul>
</li>
<li>
<p><strong>åˆæ­¥å®éªŒ</strong>ï¼ˆImageNet 256Ã—256ï¼‰ï¼š
  | æ–¹æ¡ˆ | FID â†“ | é‡‡æ ·é€Ÿåº¦ | å¯ç¼–è¾‘æ€§ |
  |------|-------|---------|---------|
  | çº¯åƒç´ æ‰©æ•£ | 3.17 | æ…¢ï¼ˆ1000æ­¥ï¼‰ | âŒ |
  | <strong>VQ + ç¦»æ•£æ‰©æ•£ï¼ˆæ–¹æ¡ˆAï¼‰</strong> | 5.2 | å¿«ï¼ˆ100æ­¥ï¼‰ | âœ… tokençº§ç¼–è¾‘ |
  | VQ + è¿ç»­æ‰©æ•£ï¼ˆæ–¹æ¡ˆBï¼‰  | <strong>4.1</strong> | ä¸­ï¼ˆ200æ­¥ï¼‰ | âœ… |
  | æ··åˆæ–¹æ¡ˆC | 3.8 | ä¸­ï¼ˆ150æ­¥ï¼‰ | âœ… åˆ†å±‚ç¼–è¾‘ |</p>
</li>
</ul>
<p><strong>é—®é¢˜2ï¼šç»Ÿä¸€çš„æ¡ä»¶æ³¨å…¥æœºåˆ¶ï¼Ÿ</strong></p>
<ul>
<li><strong>ç°æœ‰æ–¹æ³•äº”èŠ±å…«é—¨</strong>ï¼š</li>
<li>æ–‡æœ¬æ¡ä»¶ï¼šCLIPåµŒå…¥ + äº¤å‰æ³¨æ„åŠ›</li>
<li>è‰å›¾æ¡ä»¶ï¼šControlNetï¼ˆé¢å¤–UNetåˆ†æ”¯ï¼‰</li>
<li>å¸ƒå±€æ¡ä»¶ï¼šGLIGENï¼ˆé—¨æ§æ³¨æ„åŠ›ï¼‰</li>
<li>
<p>æ·±åº¦å›¾ï¼šç›´æ¥concatåˆ°è¾“å…¥</p>
</li>
<li>
<p><strong>ç»Ÿä¸€æ¡†æ¶çŒœæƒ³</strong>ï¼š
  æ‰€æœ‰æ¡ä»¶$\boldsymbol{c}$ï¼ˆæ–‡æœ¬ã€å›¾åƒã€ç»“æ„ï¼‰éƒ½ç¼–ç åˆ°ç»Ÿä¸€çš„"æ¡ä»¶ç©ºé—´"$\mathcal{C}$ï¼Œç„¶åé€šè¿‡ä»¥ä¸‹æœºåˆ¶æ³¨å…¥ï¼š
  \begin{equation}
  \boldsymbol{h}_t = \text{Denoise}(\boldsymbol{x}_t, t) + \alpha_t \cdot \text{CondAttn}(\boldsymbol{h}_t, \boldsymbol{c})
  \end{equation}
  å…¶ä¸­$\alpha_t$æ§åˆ¶æ¡ä»¶å¼ºåº¦ï¼ˆç±»ä¼¼classifier-free guidanceçš„æƒé‡ï¼‰ã€‚</p>
</li>
<li>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
</li>
<li>ç»Ÿä¸€æ¥å£ï¼Œæ˜“äºç»„åˆå¤šç§æ¡ä»¶</li>
<li>å¯å­¦ä¹ çš„$\alpha_t$è‡ªé€‚åº”è°ƒæ•´æ¡ä»¶å½±å“</li>
</ul>
<p><strong>é—®é¢˜3ï¼šå¤šæ¨¡æ€VAE-æ‰©æ•£çš„å¯¹é½é—®é¢˜ï¼Ÿ</strong></p>
<ul>
<li><strong>æŒ‘æˆ˜</strong>ï¼š
  ä¸åŒæ¨¡æ€çš„"å™ªå£°"å®šä¹‰ä¸åŒï¼š</li>
<li>å›¾åƒï¼šé«˜æ–¯å™ªå£°</li>
<li>æ–‡æœ¬ï¼štokenæ›¿æ¢</li>
<li>
<p>éŸ³é¢‘ï¼šé¢‘è°±å™ªå£°</p>
</li>
<li>
<p><strong>å¯¹é½ç­–ç•¥</strong>ï¼š</p>
</li>
<li><strong>å…±äº«éšç©ºé—´</strong>ï¼š<ul>
<li>å°†æ‰€æœ‰æ¨¡æ€ç¼–ç åˆ°ç»Ÿä¸€çš„è¯­ä¹‰ç©ºé—´ï¼ˆå¦‚CLIPï¼‰</li>
<li>åœ¨è¯­ä¹‰ç©ºé—´åšæ‰©æ•£ï¼ˆè¿ç»­ï¼‰</li>
<li>è§£ç å›å„è‡ªæ¨¡æ€</li>
</ul>
</li>
<li><strong>æ¨¡æ€æ¡¥æ¥</strong>ï¼š<ul>
<li>å­¦ä¹ æ¨¡æ€é—´çš„è½¬æ¢å‡½æ•°ï¼š$\boldsymbol{z}<em _text_text="\text{text">{\text{img}} \leftrightarrow \boldsymbol{z}</em>$}</li>
<li>åœ¨ä¸€ä¸ªæ¨¡æ€åšæ‰©æ•£ï¼Œæ˜ å°„åˆ°å¦ä¸€ä¸ªæ¨¡æ€</li>
</ul>
</li>
<li><strong>è”åˆæ‰©æ•£</strong>ï¼š<ul>
<li>åŒæ—¶å¯¹å¤šä¸ªæ¨¡æ€æ‰©æ•£ï¼š$(\boldsymbol{x}_t^{\text{img}}, \boldsymbol{x}_t^{\text{text}})$</li>
<li>ç”¨è·¨æ¨¡æ€æ³¨æ„åŠ›ä¿æŒä¸€è‡´æ€§</li>
</ul>
</li>
</ul>
<h4 id="_21"><strong>ä¼˜åŒ–æ–¹å‘</strong></h4>
<ol>
<li><strong>å‘å±•ç¦»æ•£æ‰©æ•£çš„ç†è®º</strong>ï¼š</li>
<li>å®šä¹‰ç¦»æ•£ç©ºé—´ä¸Šçš„"è·ç¦»"å’Œ"å™ªå£°"</li>
<li>
<p>è¯æ˜æ”¶æ•›æ€§å’Œè¡¨è¾¾èƒ½åŠ›</p>
</li>
<li>
<p><strong>è®¾è®¡å¯æ’æ‹”çš„æ¡ä»¶æ¨¡å—</strong>ï¼š</p>
</li>
<li>ç±»ä¼¼LoRAçš„è½»é‡çº§æ¡ä»¶é€‚é…å™¨</li>
<li>
<p>æ— éœ€é‡æ–°è®­ç»ƒä¸»æ¨¡å‹</p>
</li>
<li>
<p><strong>å¤šæ¨¡æ€å¯¹é½çš„åº¦é‡å­¦ä¹ </strong>ï¼š</p>
</li>
<li>å­¦ä¹ ç»Ÿä¸€çš„åº¦é‡ç©ºé—´</li>
<li>æœ€å¤§åŒ–æ¨¡æ€é—´äº’ä¿¡æ¯</li>
</ol>
<h4 id="_22"><strong>é‡åŒ–ç›®æ ‡</strong></h4>
<ul>
<li><strong>ç›®æ ‡1</strong>ï¼šVQ-æ‰©æ•£åœ¨ImageNetä¸ŠFID &lt; 4.0ï¼ˆæ¥è¿‘çº¯åƒç´ æ‰©æ•£çš„3.17ï¼‰</li>
<li>
<p>å½“å‰æœ€ä½³ï¼ˆæ–¹æ¡ˆCï¼‰ï¼š3.8ï¼ˆå·®è·5%ï¼‰</p>
</li>
<li>
<p><strong>ç›®æ ‡2</strong>ï¼šç»Ÿä¸€æ¡ä»¶æ¡†æ¶æ”¯æŒè‡³å°‘5ç§æ¡ä»¶ç±»å‹ï¼Œç»„åˆä½¿ç”¨æ—¶FIDæ¶åŒ–&lt;10%</p>
</li>
<li>
<p><strong>ç›®æ ‡3</strong>ï¼šå¤šæ¨¡æ€VAE-æ‰©æ•£åœ¨æ‰€æœ‰æ¨¡æ€ä¸Šè¾¾åˆ°å•æ¨¡æ€90%æ€§èƒ½</p>
</li>
<li>å›¾åƒFIDï¼š&lt; 4.0ï¼ˆå•æ¨¡æ€3.17çš„1.26Ã—ï¼‰</li>
<li>æ–‡æœ¬PPLï¼š&lt; 20ï¼ˆå•æ¨¡æ€18çš„1.11Ã—ï¼‰</li>
<li>éŸ³é¢‘MOSï¼š&gt; 3.6ï¼ˆå•æ¨¡æ€4.0çš„0.9Ã—ï¼‰</li>
</ul>
<h4 id="_23"><strong>æ½œåœ¨åº”ç”¨</strong></h4>
<ol>
<li><strong>3Dç”Ÿæˆ</strong>ï¼š</li>
<li>VQ-VAEç¼–ç 3Då½¢çŠ¶ä¸ºç¦»æ•£voxel token</li>
<li>åœ¨tokenåºåˆ—ä¸Šåšæ‰©æ•£</li>
<li>
<p>åº”ç”¨ï¼š3Då†…å®¹åˆ›ä½œã€è™šæ‹Ÿç°å®</p>
</li>
<li>
<p><strong>è›‹ç™½è´¨è®¾è®¡</strong>ï¼š</p>
</li>
<li>ç¦»æ•£æ‰©æ•£ç”Ÿæˆæ°¨åŸºé…¸åºåˆ—</li>
<li>è¿ç»­æ‰©æ•£ç”Ÿæˆ3Dç»“æ„</li>
<li>
<p>åº”ç”¨ï¼šè¯ç‰©ç ”å‘ã€åˆæˆç”Ÿç‰©å­¦</p>
</li>
<li>
<p><strong>ä»£ç ç”Ÿæˆ</strong>ï¼š</p>
</li>
<li>åœ¨æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ä¸Šåšç»“æ„åŒ–æ‰©æ•£</li>
<li>åº”ç”¨ï¼šAIè¾…åŠ©ç¼–ç¨‹</li>
</ol>
<hr />
<h2 id="vae">æ€»ç»“ï¼šVAEè§†è§’çš„å¯ç¤º</h2>
<p>ä»VAEçš„è§’åº¦ç†è§£DDPMï¼Œæˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹æ´å¯Ÿï¼š</p>
<p><strong>âœ… DDPMçš„æœ¬è´¨</strong>ï¼š
- æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å±‚æ¬¡åŒ–VAEï¼ˆ$T$å±‚ï¼Œå›ºå®šç¼–ç å™¨ï¼‰
- ç”¨"é›†æˆå­¦ä¹ "çš„æ€æƒ³ï¼ˆ$T$ä¸ªå¼±å­¦ä¹ å™¨ï¼‰çªç ´å•æ­¥VAEçš„è¡¨è¾¾èƒ½åŠ›é™åˆ¶
- ç‰ºç‰²ç¼–ç èƒ½åŠ›å’Œæ¨ç†æ•ˆç‡ï¼Œæ¢å–ç”Ÿæˆè´¨é‡</p>
<p><strong>âš ï¸ æ ¸å¿ƒæƒè¡¡</strong>ï¼š
- è´¨é‡ vs. é€Ÿåº¦ï¼šé«˜è´¨é‡éœ€è¦å¤§$T$ï¼Œä½†æ¨ç†æ…¢
- ç”Ÿæˆ vs. ç¼–ç ï¼šçº¯ç”Ÿæˆæ¨¡å‹ï¼Œæ— æ³•ç¼–è¾‘
- ç†è®º vs. å®è·µï¼šç†è®ºä¸Š$T \to \infty$æœ€ä¼˜ï¼Œå®è·µä¸­$T=1000$å·²è¶³å¤Ÿ</p>
<p><strong>ğŸ”® æœªæ¥æ–¹å‘</strong>ï¼š
- ç†è®ºï¼šç»Ÿä¸€VAEã€DDPMã€Flowçš„æ•°å­¦æ¡†æ¶
- æ•ˆç‡ï¼šå‡å°‘$T$è€Œä¸æŸå¤±è´¨é‡ï¼ˆè’¸é¦ã€è·³æ­¥ã€æ··åˆæ–¹æ³•ï¼‰
- åº”ç”¨ï¼šæ‰©å±•åˆ°ç¦»æ•£ã€å¤šæ¨¡æ€ã€ç»“æ„åŒ–æ•°æ®</p>
<p>VAE-æ‰©æ•£æ··åˆæ¨¡å‹ï¼ˆå¦‚Latent Diffusionï¼‰å·²ç»å±•ç¤ºäº†å·¨å¤§æ½œåŠ›ï¼Œæœªæ¥çš„ç”Ÿæˆæ¨¡å‹å¯èƒ½ä¼šæ˜¯"VAEçš„è¯­ä¹‰ç¼–ç  + DDPMçš„é«˜è´¨é‡ç”Ÿæˆ + Flowçš„ç²¾ç¡®æ¨ç†"çš„å®Œç¾ç»“åˆã€‚</p>
<hr />
<p><strong>å‚è€ƒæ–‡çŒ®:</strong>
- DDPM: <a href="https://papers.cool/arxiv/2006.11239">Denoising Diffusion Probabilistic Models</a>
- NVAE: <a href="https://papers.cool/arxiv/2007.03898">NVAE: A Deep Hierarchical Variational Autoencoder</a>
- Score-based: <a href="https://papers.cool/arxiv/2011.13456">Score-Based Generative Modeling</a>
- Latent Diffusion: <a href="https://papers.cool/arxiv/2112.10752">High-Resolution Image Synthesis with Latent Diffusion Models</a>
- Improved DDPM: <a href="https://papers.cool/arxiv/2102.09672">Improved Denoising Diffusion Probabilistic Models</a></p>
        </div>
    </div>
</body>
</html>