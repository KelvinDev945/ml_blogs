<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muonä¼˜åŒ–å™¨èµæï¼šä»å‘é‡åˆ°çŸ©é˜µçš„æœ¬è´¨è·¨è¶Š</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>Muonä¼˜åŒ–å™¨èµæï¼šä»å‘é‡åˆ°çŸ©é˜µçš„æœ¬è´¨è·¨è¶Š</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-26 | ğŸ“„ å¤§å°: 56.5 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/10592">https://spaces.ac.cn/archives/10592</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>éšç€LLMæ—¶ä»£çš„åˆ°æ¥ï¼Œå­¦æœ¯ç•Œå¯¹äºä¼˜åŒ–å™¨çš„ç ”ç©¶çƒ­æƒ…ä¼¼ä¹æœ‰æ‰€å‡é€€ã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºç›®å‰ä¸»æµçš„AdamWå·²ç»èƒ½å¤Ÿæ»¡è¶³å¤§å¤šæ•°éœ€æ±‚ï¼Œè€Œå¦‚æœå¯¹ä¼˜åŒ–å™¨â€œå¤§åŠ¨å¹²æˆˆâ€ï¼Œé‚£ä¹ˆéœ€è¦å·¨å¤§çš„éªŒè¯æˆæœ¬ã€‚å› æ­¤ï¼Œå½“å‰ä¼˜åŒ–å™¨çš„å˜åŒ–ï¼Œå¤šæ•°éƒ½åªæ˜¯å·¥ä¸šç•Œæ ¹æ®è‡ªå·±çš„è®­ç»ƒç»éªŒæ¥å¯¹AdamWæ‰“çš„ä¸€äº›å°è¡¥ä¸ã€‚</p>
<p>ä¸è¿‡ï¼Œæœ€è¿‘æ¨ç‰¹ä¸Šä¸€ä¸ªåä¸ºâ€œ<a href="https://github.com/KellerJordan/Muon">Muon</a>â€çš„ä¼˜åŒ–å™¨é¢‡ä¸ºçƒ­é—¹ï¼Œå®ƒå£°ç§°æ¯”AdamWæ›´ä¸ºé«˜æ•ˆï¼Œä¸”å¹¶ä¸åªæ˜¯åœ¨AdamåŸºç¡€ä¸Šçš„â€œå°æ‰“å°é—¹â€ï¼Œè€Œæ˜¯ä½“ç°äº†å…³äºå‘é‡ä¸çŸ©é˜µå·®å¼‚çš„ä¸€äº›å€¼å¾—æ·±æ€çš„åŸç†ã€‚æœ¬æ–‡è®©æˆ‘ä»¬ä¸€èµ·èµæä¸€ç•ªã€‚</p>
<p><a href="/usr/uploads/2024/12/125501438.jpeg" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="Muonä¸AdamWæ•ˆæœå¯¹æ¯”ï¼ˆæ¥æºï¼šæ¨ç‰¹@Yuchenj_UWï¼‰" src="/usr/uploads/2024/12/125501438.jpeg" /></a></p>
<p>Muonä¸AdamWæ•ˆæœå¯¹æ¯”ï¼ˆæ¥æºï¼šæ¨ç‰¹@Yuchenj_UWï¼‰</p>
<h2 id="_1">ç®—æ³•åˆæ¢</h2>
<p>Muonå…¨ç§°æ˜¯â€œMomentUm Orthogonalized by Newton-schulzâ€ï¼Œå®ƒé€‚ç”¨äºçŸ©é˜µå‚æ•°$\boldsymbol{W}\in\mathbb{R}^{n\times m}$ï¼Œå…¶æ›´æ–°è§„åˆ™æ˜¯<br />
\begin{equation}\begin{aligned}<br />
\boldsymbol{M}<em t-1="t-1">t =&amp;\, \beta\boldsymbol{M}</em>} + \boldsymbol{G<em t-1="t-1">t \\\[5pt]<br />
\boldsymbol{W}_t =&amp;\, \boldsymbol{W}</em>} - \eta_t [\text{msign}(\boldsymbol{M<em t-1="t-1">t) + \lambda \boldsymbol{W}</em>] \\\<br />
\end{aligned}\end{equation}<br />
è¿™é‡Œ$\text{msign}$æ˜¯<a href="https://en.wikipedia.org/wiki/Matrix_sign_function">çŸ©é˜µç¬¦å·å‡½æ•°</a>ï¼Œå®ƒå¹¶ä¸æ˜¯ç®€å•åœ°å¯¹çŸ©é˜µæ¯ä¸ªåˆ†é‡å–$\text{sign}$æ“ä½œï¼Œè€Œæ˜¯$\text{sign}$å‡½æ•°çš„çŸ©é˜µåŒ–æ¨å¹¿ï¼Œå®ƒè·Ÿ<a href="/archives/10407">SVD</a>çš„å…³ç³»æ˜¯ï¼š<br />
\begin{equation}\boldsymbol{U},\boldsymbol{\Sigma},\boldsymbol{V}^{\top} = \text{SVD}(\boldsymbol{M}) \quad\Rightarrow\quad \text{msign}(\boldsymbol{M}) = \boldsymbol{U}<em _:_:r_="[:,:r]">{[:,:r]}\boldsymbol{V}</em>}^{\top}\end{equation<br />
å…¶ä¸­$\boldsymbol{U}\in\mathbb{R}^{n\times n},\boldsymbol{\Sigma}\in\mathbb{R}^{n\times m},\boldsymbol{V}\in\mathbb{R}^{m\times m}$ï¼Œ$r$æ˜¯$\boldsymbol{M}$çš„ç§©ã€‚æ›´å¤šçš„ç†è®ºç»†èŠ‚æˆ‘ä»¬ç¨åå†å±•å¼€ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆæ¥å°è¯•ç›´è§‚æ„ŸçŸ¥å¦‚ä¸‹äº‹å®ï¼š</p>
<blockquote>
<p>Muonæ˜¯ä¸€ä¸ªç±»ä¼¼äºAdamçš„è‡ªé€‚åº”å­¦ä¹ ç‡ä¼˜åŒ–å™¨ã€‚</p>
</blockquote>
<p>åƒAdagradã€RMSpropã€Adamç­‰è‡ªé€‚åº”å­¦ä¹ ç‡ä¼˜åŒ–å™¨çš„ç‰¹ç‚¹æ˜¯é€šè¿‡é™¤ä»¥ <em>æ¢¯åº¦å¹³æ–¹çš„æ»‘åŠ¨å¹³å‡çš„å¹³æ–¹æ ¹</em> æ¥è°ƒæ•´æ¯ä¸ªå‚æ•°çš„æ›´æ–°é‡ï¼Œè¿™è¾¾åˆ°äº†ä¸¤ä¸ªæ•ˆæœï¼š1ã€æŸå¤±å‡½æ•°çš„å¸¸æ•°ç¼©æ”¾ä¸å½±å“ä¼˜åŒ–è½¨è¿¹ï¼›2ã€æ¯ä¸ªå‚æ•°åˆ†é‡çš„æ›´æ–°å¹…åº¦å°½å¯èƒ½ä¸€è‡´ã€‚Muonæ­£å¥½æ»¡è¶³è¿™ä¸¤ä¸ªç‰¹æ€§ï¼š</p>
<blockquote>
<p>1ã€æŸå¤±å‡½æ•°ä¹˜ä»¥$\lambda$ï¼Œ$\boldsymbol{M}$ä¹Ÿä¼šä¹˜ä»¥$\lambda$ï¼Œç»“æœæ˜¯$\boldsymbol{\Sigma}$è¢«ä¹˜ä»¥$\lambda$ï¼Œä½†Muonæœ€åçš„æ›´æ–°é‡æ˜¯å°†$\boldsymbol{\Sigma}$å˜ä¸ºå•ä½é˜µï¼Œæ‰€ä»¥ä¸å½±å“ä¼˜åŒ–ç»“æœï¼›</p>
<p>2ã€å½“$\boldsymbol{M}$è¢«SVDä¸º$\boldsymbol{U}\boldsymbol{\Sigma}\boldsymbol{V}^{\top}$æ—¶ï¼Œ$\boldsymbol{\Sigma}$çš„ä¸åŒå¥‡å¼‚å€¼ä½“ç°äº†$\boldsymbol{M}$çš„â€œå„å‘å¼‚æ€§â€ï¼Œè€Œå°†å®ƒä»¬éƒ½ <em>ç½®ä¸€</em> åˆ™æ›´åŠ å„å‘åŒæ€§ï¼Œä¹Ÿèµ·åˆ°åŒæ­¥æ›´æ–°å¹…åº¦çš„ä½œç”¨ã€‚</p>
</blockquote>
<p>å¯¹äº†ï¼Œå…³äºç¬¬2ç‚¹ï¼Œæœ‰æ²¡æœ‰è¯»è€…æƒ³èµ·äº†<a href="/archives/8069">BERT-whitening</a>ï¼Ÿå¦å¤–è¦æŒ‡å‡ºçš„æ˜¯ï¼ŒMuonè¿˜æœ‰ä¸ªNesterovç‰ˆï¼Œå®ƒåªæ˜¯å°†æ›´æ–°è§„åˆ™ä¸­çš„$\text{msign}(\boldsymbol{M}_t)$æ¢æˆ$\text{msign}(\beta\boldsymbol{M}_t + \boldsymbol{G}_t)$ï¼Œå…¶ä½™éƒ¨ä»½å®Œå…¨ä¸€è‡´ï¼Œç®€å•èµ·è§å°±ä¸å±•å¼€ä»‹ç»äº†ã€‚</p>
<p>ï¼ˆè€ƒå¤ï¼šäº‹åå‘ç°ï¼Œ2015å¹´çš„è®ºæ–‡<a href="https://proceedings.mlr.press/v38/carlson15.html">ã€ŠStochastic Spectral Descent for Restricted Boltzmann Machinesã€‹</a>å·²ç»æå‡ºè¿‡è·ŸMuonå¤§è‡´ç›¸åŒçš„ä¼˜åŒ–ç®—æ³•ï¼Œå½“æ—¶ç§°ä¸ºâ€œStochastic Spectral Descentâ€ã€‚ï¼‰</p>
<h2 id="_2">ç¬¦å·å‡½æ•°</h2>
<p>åˆ©ç”¨SVDï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è¯æ˜æ’ç­‰å¼<br />
\begin{equation}\text{msign}(\boldsymbol{M}) = (\boldsymbol{M}\boldsymbol{M}^{\top})^{-1/2}\boldsymbol{M}= \boldsymbol{M}(\boldsymbol{M}^{\top}\boldsymbol{M})^{-1/2}\label{eq:msign-id}\end{equation}<br />
å…¶ä¸­${}^{-1/2}$æ˜¯çŸ©é˜µçš„$1/2$æ¬¡å¹‚çš„é€†çŸ©é˜µï¼Œå¦‚æœä¸å¯é€†çš„è¯åˆ™å–<a href="/archives/10366">ä¼ªé€†</a>ã€‚è¿™ä¸ªæ’ç­‰å¼èƒ½è®©æˆ‘ä»¬æ›´å¥½ç†è§£ä¸ºä»€ä¹ˆ$\text{msign}$æ˜¯$\text{sign}$çš„çŸ©é˜µæ¨å¹¿ï¼šå¯¹äºæ ‡é‡$x$æˆ‘ä»¬æœ‰$\text{sign}(x)=x(x^2)^{-1/2}$ï¼Œæ­£æ˜¯ä¸Šå¼çš„ä¸€ä¸ªç‰¹æ®Šæƒ…å½¢ï¼ˆå½“$\boldsymbol{M}$æ˜¯$1\times 1$çŸ©é˜µæ—¶ï¼‰ã€‚è¿™ä¸ªç‰¹æ®Šä¾‹å­è¿˜å¯ä»¥æ¨å¹¿åˆ°å¯¹è§’é˜µ$\boldsymbol{M}=\text{diag}(\boldsymbol{m})$ï¼š<br />
\begin{equation}\text{msign}(\boldsymbol{M}) = \text{diag}(\boldsymbol{m})[\text{diag}(\boldsymbol{m})^2]^{-1/2} = \text{diag}(\text{sign}(\boldsymbol{m}))=\text{sign}(\boldsymbol{M})\end{equation}<br />
å…¶ä¸­$\text{sign}(\boldsymbol{m})$ã€$\text{sign}(\boldsymbol{M})$æ˜¯æŒ‡å‘é‡/çŸ©é˜µçš„æ¯ä¸ªåˆ†é‡éƒ½å–$\text{sign}$ã€‚ä¸Šå¼æ„å‘³ç€ï¼Œå½“$\boldsymbol{M}$æ˜¯å¯¹è§’é˜µæ—¶ï¼ŒMuonå°±é€€åŒ–ä¸ºå¸¦åŠ¨é‡çš„<a href="/archives/10542#%E8%87%AA%E9%80%82%E5%BA%94%E7%89%88">SignSGD</a>ï¼ˆSignumï¼‰æˆ–ç¬”è€…æ‰€æçš„<a href="/archives/9512">Tiger</a>ï¼Œå®ƒä»¬éƒ½æ˜¯Adamçš„ç»å…¸è¿‘ä¼¼ã€‚åè¿‡æ¥è¯´ï¼ŒMuonä¸Signumã€Tigerçš„åŒºåˆ«å°±æ˜¯Element-wiseçš„$\text{sign}(\boldsymbol{M})$æ›¿æ¢æˆäº†çŸ©é˜µç‰ˆ$\text{msign}(\boldsymbol{M})$ã€‚</p>
<p>å¯¹äº$n$ç»´å‘é‡æ¥è¯´ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è§†ä¸º$n\times 1$çš„çŸ©é˜µï¼Œæ­¤æ—¶$\text{msign}(\boldsymbol{m}) = \boldsymbol{m}/\Vert\boldsymbol{m}\Vert_2$æ­£å¥½æ˜¯$l_2$å½’ä¸€åŒ–ã€‚æ‰€ä»¥ï¼Œåœ¨Muonæ¡†æ¶ä¸‹å¯¹å‘é‡æˆ‘ä»¬æœ‰ä¸¤ç§è§†è§’ï¼šä¸€æ˜¯å¯¹è§’çŸ©é˜µï¼Œå¦‚LayerNormçš„gammaå‚æ•°ï¼Œç»“æœæ˜¯å¯¹åŠ¨é‡å–$\text{sign}$ï¼›äºŒæ˜¯$n\times 1$çš„çŸ©é˜µï¼Œç»“æœæ˜¯å¯¹åŠ¨é‡åš$l_2$å½’ä¸€åŒ–ã€‚æ­¤å¤–ï¼Œè¾“å…¥å’Œè¾“å‡ºçš„Embeddingè™½ç„¶ä¹Ÿæ˜¯çŸ©é˜µï¼Œä½†å®ƒä»¬ä½¿ç”¨ä¸Šæ˜¯ç¨€ç–çš„ï¼Œæ‰€ä»¥æ›´åˆç†çš„æ–¹å¼ä¹Ÿæ˜¯å°†å®ƒä»¬å½“æˆå¤šä¸ªå‘é‡ç‹¬ç«‹å¤„ç†ã€‚</p>
<p>å½“$m=n=r$æ—¶ï¼Œ$\text{msign}(\boldsymbol{M})$è¿˜æœ‰ä¸€ä¸ªæ„ä¹‰æ˜¯â€œæœ€ä¼˜æ­£äº¤è¿‘ä¼¼â€ï¼š<br />
\begin{equation}\text{msign}(\boldsymbol{M}) = \mathop{\text{argmin}}<em _boldsymbol_O="\boldsymbol{O">{\boldsymbol{O}^{\top}\boldsymbol{O} = \boldsymbol{I}}\Vert \boldsymbol{M} - \boldsymbol{O}\Vert_F^2 \label{eq:nearest-orth}\end{equation}<br />
ç±»ä¼¼åœ°ï¼Œå¯¹äº$\text{sign}(\boldsymbol{M})$æˆ‘ä»¬å¯ä»¥å†™å‡ºï¼ˆå‡è®¾$\boldsymbol{M}$æ²¡æœ‰é›¶å…ƒç´ ï¼‰ï¼š<br />
\begin{equation}\text{sign}(\boldsymbol{M}) = \mathop{\text{argmin}}</em>}\in\{-1,1\}^{n\times m}}\Vert \boldsymbol{M} - \boldsymbol{O}\Vert_F^2\end{equation<br />
ä¸è®ºæ˜¯$\boldsymbol{O}^{\top}\boldsymbol{O} = \boldsymbol{I}$è¿˜æ˜¯$\boldsymbol{O}\in\{-1,1\}^{n\times m}$ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥è§†ä¸ºå¯¹æ›´æ–°é‡çš„ä¸€ç§è§„æ•´åŒ–çº¦æŸï¼Œæ‰€ä»¥Muonå’ŒSignumã€Tigerå¯ä»¥è§†ä½œæ˜¯åŒä¸€æ€è·¯ä¸‹çš„ä¼˜åŒ–å™¨ï¼Œå®ƒä»¬éƒ½ä»¥åŠ¨é‡$\boldsymbol{M}$ä¸ºå‡ºå‘ç‚¹æ¥æ„å»ºæ›´æ–°é‡ï¼Œåªæ˜¯ä¸ºæ›´æ–°é‡é€‰æ‹©äº†ä¸åŒçš„è§„æ•´åŒ–æ–¹æ³•ã€‚</p>
<blockquote>
<p><strong>å¼$\eqref{eq:nearest-orth}$çš„è¯æ˜</strong> ï¼šå¯¹äºæ­£äº¤çŸ©é˜µ$\boldsymbol{O}$ï¼Œæˆ‘ä»¬æœ‰<br />
 \begin{equation}\begin{aligned}<br />
 \Vert \boldsymbol{M} - \boldsymbol{O}\Vert_F^2 =&amp;\, \Vert \boldsymbol{M}\Vert_F^2 + \Vert \boldsymbol{O}\Vert_F^2 - 2\langle\boldsymbol{M},\boldsymbol{O}\rangle_F \\\[5pt]<br />
 =&amp;\, \Vert \boldsymbol{M}\Vert_F^2 + n - 2\text{Tr}(\boldsymbol{M}\boldsymbol{O}^{\top})\\\[5pt]<br />
 =&amp;\, \Vert \boldsymbol{M}\Vert_F^2 + n - 2\text{Tr}(\boldsymbol{U}\boldsymbol{\Sigma}\boldsymbol{V}^{\top}\boldsymbol{O}^{\top})\\\[5pt]<br />
 =&amp;\, \Vert \boldsymbol{M}\Vert_F^2 + n - 2\text{Tr}(\boldsymbol{\Sigma}\boldsymbol{V}^{\top}\boldsymbol{O}^{\top}\boldsymbol{U})\\\<br />
 =&amp;\, \Vert \boldsymbol{M}\Vert_F^2 + n - 2\sum_{i=1}^n \boldsymbol{\Sigma}<em i_i="i,i">{i,i}(\boldsymbol{V}^{\top}\boldsymbol{O}^{\top}\boldsymbol{U})</em><br />
 \end{aligned}\end{equation}<br />
 å…¶ä¸­æ¶‰åŠåˆ°çš„è¿ç®—è§„åˆ™æˆ‘ä»¬åœ¨<a href="/archives/10366">ä¼ªé€†</a>ä¸­å·²ç»ä»‹ç»è¿‡ã€‚ç”±äº$\boldsymbol{U},\boldsymbol{V},\boldsymbol{O}$éƒ½æ˜¯æ­£äº¤çŸ©é˜µï¼Œæ‰€ä»¥$\boldsymbol{V}^{\top}\boldsymbol{O}^{\top}\boldsymbol{U}$ä¹Ÿæ˜¯æ­£äº¤çŸ©é˜µï¼Œæ­£äº¤çŸ©é˜µçš„æ¯ä¸ªåˆ†é‡å¿…ç„¶ä¸è¶…è¿‡1ï¼Œåˆå› ä¸º$\boldsymbol{\Sigma}<em i_i="i,i">{i,i} &gt; 0$ï¼Œæ‰€ä»¥ä¸Šå¼å–æœ€å°å€¼å¯¹åº”äºæ¯ä¸ª$(\boldsymbol{V}^{\top}\boldsymbol{O}^{\top}\boldsymbol{U})</em>$ã€‚}$å–æœ€å¤§å€¼ï¼Œå³$(\boldsymbol{V}^{\top}\boldsymbol{O}^{\top}\boldsymbol{U})_{i,i}=1$ï¼Œè¿™æ„å‘³ç€$\boldsymbol{V}^{\top}\boldsymbol{O}^{\top}\boldsymbol{U}=\boldsymbol{I}$ï¼Œå³$\boldsymbol{O}=\boldsymbol{U}\boldsymbol{V}^{\top</p>
<p>è¯¥ç»“è®ºè¿˜å¯ä»¥ä»”ç»†åœ°æ¨å¹¿åˆ°$m,n,r$ä¸ç›¸ç­‰çš„æƒ…å½¢ï¼Œä½†è¿™é‡Œä¸ä½œè¿›ä¸€æ­¥å±•å¼€ã€‚</p>
</blockquote>
<h2 id="_3">è¿­ä»£æ±‚è§£</h2>
<p>å®è·µä¸­ï¼Œå¦‚æœæ¯ä¸€æ­¥éƒ½å¯¹$\boldsymbol{M}$åšSVDæ¥æ±‚è§£$\text{msign}(\boldsymbol{M})$çš„è¯ï¼Œé‚£ä¹ˆè®¡ç®—æˆæœ¬è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œå› æ­¤ä½œè€…æå‡ºäº†ç”¨Newton-schulzè¿­ä»£æ¥è¿‘ä¼¼è®¡ç®—$\text{msign}(\boldsymbol{M})$ã€‚</p>
<p>è¿­ä»£çš„å‡ºå‘ç‚¹æ˜¯æ’ç­‰å¼$\eqref{eq:msign-id}$ï¼Œä¸å¤±ä¸€èˆ¬æ€§ï¼Œæˆ‘ä»¬å‡è®¾$n\geq m$ï¼Œç„¶åè€ƒè™‘åœ¨$\boldsymbol{M}^{\top}\boldsymbol{M}=\boldsymbol{I}$å¤„æ³°å‹’å±•å¼€$(\boldsymbol{M}^{\top}\boldsymbol{M})^{-1/2}$ï¼Œå±•å¼€çš„æ–¹å¼æ˜¯ç›´æ¥å°†æ ‡é‡å‡½æ•°$t^{-1/2}$çš„ç»“æœç”¨åˆ°çŸ©é˜µä¸­ï¼š<br />
\begin{equation}t^{-1/2} = 1 - \frac{1}{2}(t-1) + \frac{3}{8}(t-1)^2 - \frac{5}{16}(t-1)^3 + \cdots\end{equation}<br />
ä¿ç•™åˆ°äºŒé˜¶ï¼Œç»“æœæ˜¯$(15 - 10t + 3t^2)/8$ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ‰<br />
\begin{equation}\text{msign}(\boldsymbol{M}) = \boldsymbol{M}(\boldsymbol{M}^{\top}\boldsymbol{M})^{-1/2}\approx \frac{15}{8}\boldsymbol{M} - \frac{5}{4}\boldsymbol{M}(\boldsymbol{M}^{\top}\boldsymbol{M}) + \frac{3}{8}\boldsymbol{M}(\boldsymbol{M}^{\top}\boldsymbol{M})^2\end{equation}<br />
å‡å¦‚$\boldsymbol{X}<em t_1="t+1">t$æ˜¯$\text{msign}(\boldsymbol{M})$çš„æŸä¸ªè¿‘ä¼¼ï¼Œæˆ‘ä»¬è®¤ä¸ºå°†å®ƒä»£å…¥ä¸Šå¼åï¼Œä¼šå¾—åˆ°$\text{msign}(\boldsymbol{M})$çš„ä¸€ä¸ªæ›´å¥½çš„è¿‘ä¼¼ï¼Œäºæ˜¯æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªå¯ç”¨çš„è¿­ä»£æ ¼å¼<br />
\begin{equation}\boldsymbol{X}</em>} = \frac{15}{8}\boldsymbol{X}_t - \frac{5}{4}\boldsymbol{X}_t(\boldsymbol{X}_t^{\top}\boldsymbol{X}_t) + \frac{3}{8}\boldsymbol{X}_t(\boldsymbol{X}_t^{\top}\boldsymbol{X}_t)^2\end{equation<br />
ç„¶è€Œï¼ŒæŸ¥çœ‹Muonçš„å®˜æ–¹ä»£ç æˆ‘ä»¬å°±ä¼šå‘ç°ï¼Œå®ƒé‡Œè¾¹çš„Newton-schulzè¿­ä»£ç¡®å®æ˜¯è¿™ä¸ªå½¢å¼ï¼Œä½†ä¸‰ä¸ªç³»æ•°å´æ˜¯$(3.4445, -4.7750, 2.0315)$ï¼Œè€Œä¸”ä½œè€…æ²¡æœ‰ç»™å‡ºæ•°å­¦æ¨å¯¼ï¼Œåªæœ‰ä¸€æ®µè¯­ç„‰ä¸è¯¦çš„æ³¨é‡Šï¼š  </p>
<p><a href="/usr/uploads/2024/12/39782973.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="Muonä¼˜åŒ–å™¨çš„Newton-schulzè¿­ä»£" src="/usr/uploads/2024/12/39782973.png" /></a></p>
<p>Muonä¼˜åŒ–å™¨çš„Newton-schulzè¿­ä»£</p>
<h2 id="_4">æ”¶æ•›åŠ é€Ÿ</h2>
<p>ä¸ºäº†çŒœæµ‹å®˜æ–¹è¿­ä»£ç®—æ³•çš„æ¥æºï¼Œæˆ‘ä»¬è€ƒè™‘ä¸€èˆ¬çš„è¿­ä»£è¿‡ç¨‹<br />
\begin{equation}\boldsymbol{X}_{t+1} = a\boldsymbol{X}_t + b\boldsymbol{X}_t(\boldsymbol{X}_t^{\top}\boldsymbol{X}_t) + c\boldsymbol{X}_t(\boldsymbol{X}_t^{\top}\boldsymbol{X}_t)^2\label{eq:iteration}\end{equation}<br />
å…¶ä¸­$a,b,c$æ˜¯ä¸‰ä¸ªå¾…æ±‚è§£çš„ç³»æ•°ï¼Œå¦‚æœæƒ³è¦æ›´é«˜é˜¶çš„è¿­ä»£ç®—æ³•ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€æ¬¡è¡¥å……$\boldsymbol{X}_t(\boldsymbol{X}_t^{\top}\boldsymbol{X}_t)^3$ã€$\boldsymbol{X}_t(\boldsymbol{X}_t^{\top}\boldsymbol{X}_t)^4$ç­‰é¡¹ï¼Œä¸‹é¢çš„åˆ†æè¿‡ç¨‹æ˜¯é€šç”¨çš„ã€‚</p>
<p>æˆ‘ä»¬é€‰æ‹©çš„åˆå§‹å€¼æ˜¯$\boldsymbol{X}<em t_1="t+1">0=\boldsymbol{M}/\Vert\boldsymbol{M}\Vert_F$ï¼Œ$\Vert\cdot\Vert_F$æ˜¯çŸ©é˜µçš„$F$èŒƒæ•°ï¼Œé€‰æ‹©çš„ä¾æ®æ˜¯é™¤ä»¥$\Vert\boldsymbol{M}\Vert_F$ä¸æ”¹å˜SVDçš„$\boldsymbol{U},\boldsymbol{V}$ï¼Œä½†å¯ä»¥è®©$\boldsymbol{X}_0$çš„æ‰€æœ‰å¥‡å¼‚å€¼éƒ½åœ¨$[0,1]$ä¹‹é—´ï¼Œè®©è¿­ä»£çš„åˆå§‹å¥‡å¼‚å€¼æ›´æ ‡å‡†ä¸€äº›ã€‚ç°åœ¨å‡è®¾$\boldsymbol{X}_t$å¯ä»¥SVDä¸º$\boldsymbol{U}\boldsymbol{\Sigma}_t\boldsymbol{V}^{\top}$ï¼Œé‚£ä¹ˆä»£å…¥ä¸Šå¼æˆ‘ä»¬å¯ä»¥å¾—åˆ°<br />
\begin{equation}\boldsymbol{X}</em>} = \boldsymbol{U<em t_:r_:r_="t,[:r,:r]">{[:,:r]}(a \boldsymbol{\Sigma}</em>} + b \boldsymbol{\Sigma<em t_:r_:r_="t,[:r,:r]">{t,[:r,:r]}^3 + c \boldsymbol{\Sigma}</em>}^5)\boldsymbol{V<em _:r_:r_="[:r,:r]">{[:,:r]}^{\top}\end{equation}<br />
å› æ­¤ï¼Œå¼$\eqref{eq:iteration}$å®é™…ä¸Šåœ¨è¿­ä»£å¥‡å¼‚å€¼ç»„æˆçš„å¯¹è§’é˜µ$\boldsymbol{\Sigma}</em>}$ï¼Œå¦‚æœè®°$\boldsymbol{X<em _:_:r_="[:,:r]">t=\boldsymbol{U}</em>}\boldsymbol{\Sigma<em _:_:r_="[:,:r]">{t,[:r,:r]}\boldsymbol{V}</em>}^{\top}$ï¼Œé‚£ä¹ˆæœ‰$\boldsymbol{\Sigma<em t_:r_:r_="t,[:r,:r]">{t+1,[:r,:r]} = g(\boldsymbol{\Sigma}</em>})$ï¼Œå…¶ä¸­$g(x) = ax + bx^3 + cx^5$ã€‚åˆå› ä¸ºå¯¹è§’é˜µçš„å¹‚ç­‰äºå¯¹è§’çº¿å…ƒç´ å„è‡ªå–å¹‚ï¼Œæ‰€ä»¥é—®é¢˜ç®€åŒ–æˆå•ä¸ªå¥‡å¼‚å€¼$\sigma$çš„è¿­ä»£ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯è®¡ç®—$\boldsymbol{U<em _:_:r_="[:,:r]">{[:,:r]}\boldsymbol{V}</em>}^{\top}$ï¼Œæ¢è¨€ä¹‹å¸Œæœ›é€šè¿‡è¿­ä»£å°†$\boldsymbol{\Sigma<em t_1="t+1">{[:r,:r]}$å˜ä¸ºå•ä½é˜µï¼Œè¿™åˆå¯ä»¥ç®€åŒ–ä¸ºè¿­ä»£$\sigma</em> = g(\sigma_t)$å°†å•ä¸ªå¥‡å¼‚å€¼å˜ä¸º1ã€‚</p>
<p>å—<a href="https://x.com/leloykun/status/1846165001746501899">@leloykun</a>å¯å‘ï¼Œæˆ‘ä»¬å°†$a,b,c$çš„é€‰æ‹©è§†ä¸ºä¸€ä¸ªæœ€ä¼˜åŒ–é—®é¢˜ï¼Œç›®æ ‡æ˜¯è®©è¿­ä»£è¿‡ç¨‹å¯¹äºä»»æ„åˆå§‹å¥‡å¼‚å€¼éƒ½æ”¶æ•›å¾—å°½å¯èƒ½å¿«ã€‚é¦–å…ˆæˆ‘ä»¬å°†$g(x)$é‡æ–°å‚æ•°åŒ–ä¸º<br />
\begin{equation}g(x) = x + \kappa x(x^2 - x_1^2)(x^2 - x_2^2)\end{equation}<br />
å…¶ä¸­$x_1 \leq x_2$ã€‚è¯¥å‚æ•°åŒ–çš„å¥½å¤„æ˜¯ç›´è§‚è¡¨ç¤ºå‡ºäº†è¿­ä»£çš„5ä¸ªä¸åŠ¨ç‚¹$0,\pm x_1,\pm x_2$ã€‚ç”±äºæˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ”¶æ•›åˆ°1ï¼Œå› æ­¤åˆå§‹åŒ–æˆ‘ä»¬é€‰æ‹©$x_1 &lt; 1,x_2 &gt; 1$ï¼Œæƒ³æ³•æ˜¯ä¸ç®¡è¿­ä»£è¿‡ç¨‹å¾€$x_1$èµ°è¿˜æ˜¯å¾€$x_2$èµ°ï¼Œç»“æœéƒ½æ˜¯1é™„è¿‘ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç¡®å®šè¿­ä»£æ­¥æ•°$T$ï¼Œè¿™æ ·è¿­ä»£è¿‡ç¨‹å°±ç§°ä¸ºä¸€ä¸ªç¡®å®šæ€§å‡½æ•°ï¼Œç„¶åæˆ‘ä»¬å°†çŸ©é˜µçš„å½¢çŠ¶ï¼ˆå³$n,m$ï¼‰ç¡®å®šå¥½ï¼Œå°±å¯ä»¥é‡‡æ ·ä¸€æ‰¹çŸ©é˜µï¼Œå¹¶é€šè¿‡SVDæ¥ç®—å¥‡å¼‚å€¼ã€‚æœ€åï¼Œæˆ‘ä»¬å°†è¿™äº›å¥‡å¼‚å€¼å½“æˆè¾“å…¥ï¼Œè€Œç›®æ ‡è¾“å‡ºåˆ™æ˜¯1ï¼ŒæŸå¤±å‡½æ•°æ˜¯å¹³æ–¹è¯¯å·®ï¼Œæ•´ä¸ªæ¨¡å‹å®Œå…¨å¯å¯¼ï¼Œå¯ä»¥ç”¨æ¢¯åº¦ä¸‹é™è§£å†³ï¼ˆ<a href="https://x.com/leloykun/status/1846165001746501899">@leloykun</a>åˆ™å‡è®¾äº†$x_1 + x_2 = 2$ï¼Œç„¶åç”¨ç½‘æ ¼æœç´¢æ¥æ±‚è§£ï¼‰ã€‚</p>
<p>ä¸€äº›è®¡ç®—ç»“æœï¼š<br />
\begin{array}{ccc|ccc|ccc|c|c}<br />
\hline<br />
n &amp; m &amp; T &amp; \kappa &amp; x_1 &amp; x_2 &amp; a &amp; b &amp; c &amp; \text{mse} &amp; \text{mse}_{\text{o}}\\\<br />
\hline<br />
1024 &amp; 1024 &amp; 3 &amp; 7.020 &amp; 0.830 &amp; 0.830 &amp; 4.328 &amp; -9.666 &amp; 7.020 &amp; 0.10257 &amp; 0.18278 \\\<br />
1024 &amp; 1024 &amp; 5 &amp; 1.724 &amp; 0.935 &amp; 1.235 &amp; 3.297 &amp; -4.136 &amp; 1.724 &amp; 0.02733 &amp; 0.04431 \\\<br />
2048 &amp; 1024 &amp; 3 &amp; 7.028 &amp; 0.815 &amp; 0.815 &amp; 4.095 &amp; -9.327 &amp; 7.028 &amp; 0.01628 &amp; 0.06171 \\\<br />
2048 &amp; 1024 &amp; 5 &amp; 1.476 &amp; 0.983 &amp; 1.074 &amp; 2.644 &amp; -3.128 &amp; 1.476 &amp; 0.00038 &amp; 0.02954 \\\<br />
4096 &amp; 1024 &amp; 3 &amp; 6.948 &amp; 0.802 &amp; 0.804 &amp; 3.886 &amp; -8.956 &amp; 6.948 &amp; 0.00371 &amp; 0.02574 \\\<br />
4096 &amp; 1024 &amp; 5 &amp; 1.214 &amp; 1.047 &amp; 1.048 &amp; 2.461 &amp; -2.663 &amp; 1.214 &amp; 0.00008 &amp; 0.02563 \\\<br />
\hline<br />
2048 &amp; 2048 &amp; 3 &amp; 11.130 &amp; 0.767 &amp; 0.767 &amp; 4.857 &amp; -13.103 &amp; 11.130 &amp; 0.10739 &amp; 0.24410 \\\<br />
2048 &amp; 2048 &amp; 5 &amp; 1.779 &amp; 0.921 &amp; 1.243 &amp; 3.333 &amp; -4.259 &amp; 1.779 &amp; 0.03516 &amp; 0.04991 \\\<br />
4096 &amp; 4096 &amp; 3 &amp; 18.017 &amp; 0.705 &amp; 0.705 &amp; 5.460 &amp; -17.929 &amp; 18.017 &amp; 0.11303 &amp; 0.33404 \\\<br />
4096 &amp; 4096 &amp; 5 &amp; 2.057 &amp; 0.894 &amp; 1.201 &amp; 3.373 &amp; -4.613 &amp; 2.057 &amp; 0.04700 &amp; 0.06372 \\\<br />
8192 &amp; 8192 &amp; 3 &amp; 30.147 &amp; 0.643 &amp; 0.643 &amp; 6.139 &amp; -24.893 &amp; 30.147 &amp; 0.11944 &amp; 0.44843 \\\<br />
8192 &amp; 8192 &amp; 5 &amp; 2.310 &amp; 0.871 &amp; 1.168 &amp; 3.389 &amp; -4.902 &amp; 2.310 &amp; 0.05869 &amp; 0.07606 \\\<br />
\hline<br />
\end{array}</p>
<p>è¿™é‡Œçš„$\text{mse}_{\text{o}}$æ˜¯æœ‰Muonä½œè€…çš„$a,b,c$ç®—å‡ºæ¥çš„ç»“æœã€‚ä»è¡¨æ ¼å¯ä»¥çœ‹å‡ºï¼Œç»“æœè·ŸçŸ©é˜µå¤§å°ã€è¿­ä»£æ­¥æ•°éƒ½æœ‰æ˜æ˜¾å…³ç³»ï¼›ä»æŸå¤±å‡½æ•°æ¥çœ‹ï¼Œéæ–¹é˜µæ¯”æ–¹é˜µæ›´å®¹æ˜“æ”¶æ•›ï¼›Muonä½œè€…ç»™å‡ºçš„$a,b,c$ï¼Œå¤§æ¦‚æ˜¯è¿­ä»£æ­¥æ•°ä¸º5æ—¶æ–¹é˜µçš„æœ€ä¼˜è§£ã€‚å½“è¿­ä»£æ­¥æ•°ç»™å®šæ—¶ï¼Œç»“æœä¾èµ–äºçŸ©é˜µå¤§å°ï¼Œè¿™æœ¬è´¨ä¸Šæ˜¯ä¾èµ–äºå¥‡å¼‚å€¼çš„åˆ†å¸ƒï¼Œå…³äºè¿™ä¸ªåˆ†å¸ƒæœ‰ä¸ªå€¼å¾—ä¸€æçš„ç»“æœæ˜¯å½“$n,m\to\infty$æ—¶ä¸º<a href="https://en.wikipedia.org/wiki/Marchenko%E2%80%93Pastur_distribution">Marchenkoâ€“Pasturåˆ†å¸ƒ</a>ã€‚</p>
<p>å‚è€ƒä»£ç ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">jax</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jax.numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jnp</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>

<span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">5</span>
<span class="n">key</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">key</span><span class="p">(</span><span class="mi">42</span><span class="p">),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;SVD&#39;</span><span class="p">):</span>
    <span class="n">key</span><span class="p">,</span> <span class="n">subkey</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">subkey</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">full_matrices</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">data</span><span class="p">,</span> <span class="n">S</span> <span class="o">/</span> <span class="p">(</span><span class="n">S</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">**</span><span class="mf">0.5</span><span class="p">])</span>

<span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="n">k</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">w</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">x1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">x2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">f_grad</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">w</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">]),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100000</span><span class="p">),</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;SGD&#39;</span><span class="p">):</span>
    <span class="n">u</span> <span class="o">=</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="n">u</span> <span class="o">+</span> <span class="n">f_grad</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>  <span class="c1"># åŠ¨é‡åŠ é€Ÿ</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">w</span> <span class="o">-</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">u</span>

<span class="n">k</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">w</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">x1</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x2</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x2</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">k</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1"> &amp; </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s1"> &amp; </span><span class="si">{</span><span class="n">T</span><span class="si">}</span><span class="s1"> &amp; </span><span class="si">{</span><span class="n">k</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> &amp; </span><span class="si">{</span><span class="n">x1</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> &amp; </span><span class="si">{</span><span class="n">x2</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> &amp; </span><span class="si">{</span><span class="n">a</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> &amp; </span><span class="si">{</span><span class="n">b</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> &amp; </span><span class="si">{</span><span class="n">c</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> &amp; </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="si">:</span><span class="s1">.5f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>

<h2 id="_5">ä¸€äº›æ€è€ƒ</h2>
<p>å¦‚æœæŒ‰ç…§é»˜è®¤é€‰æ‹©$T=5$ï¼Œé‚£ä¹ˆå¯¹äºä¸€ä¸ª$n\times n$çš„çŸ©é˜µå‚æ•°ï¼ŒMuonçš„æ¯ä¸€æ­¥æ›´æ–°è‡³å°‘éœ€è¦ç®—15æ¬¡$n\times n$ä¸$n\times n$çš„çŸ©é˜µä¹˜æ³•ï¼Œè¿™è®¡ç®—é‡æ¯‹åº¸ç½®ç–‘æ˜¯æ¯”Adamæ˜æ˜¾å¤§çš„ï¼Œç”±æ­¤å¯èƒ½æœ‰è¯»è€…æ‹…å¿ƒMuonå®è·µä¸Šæ˜¯å¦å¯è¡Œã€‚</p>
<p>äº‹å®ä¸Šï¼Œè¿™ç§æ‹…å¿ƒæ˜¯å¤šä½™çš„ï¼ŒMuonè®¡ç®—è™½ç„¶æ¯”Adamå¤æ‚ï¼Œä½†æ¯ä¸€æ­¥å¢åŠ çš„æ—¶é—´ä¸å¤šï¼Œç¬”è€…çš„ç»“è®ºæ˜¯5%å†…ï¼ŒMuonä½œè€…åˆ™å£°ç§°èƒ½åšåˆ°2%ã€‚è¿™æ˜¯å› ä¸ºMuonçš„çŸ©é˜µä¹˜æ³•å‘ç”Ÿåœ¨å½“å‰æ¢¯åº¦è®¡ç®—å®Œåã€ä¸‹ä¸€æ¢¯åº¦è®¡ç®—å‰ï¼Œè¿™æœŸé—´å‡ ä¹æ‰€æœ‰çš„ç®—åŠ›éƒ½æ˜¯ç©ºé—²çš„ï¼Œè€Œè¿™äº›çŸ©é˜µä¹˜æ³•æ˜¯é™æ€å¤§å°ä¸”å¯ä»¥å¹¶è¡Œï¼Œå› æ­¤ä¸ä¼šæ˜æ˜¾å¢åŠ æ—¶é—´æˆæœ¬ï¼Œåè€Œæ˜¯Muonæ¯”Adamå°‘ä¸€ç»„ç¼“å­˜å˜é‡ï¼Œæ˜¾å­˜æˆæœ¬æ›´ä½ã€‚</p>
<p>Muonæœ€å€¼å¾—æ·±æ€çš„åœ°æ–¹ï¼Œå…¶å®æ˜¯å‘é‡ä¸çŸ©é˜µçš„å†…åœ¨åŒºåˆ«ï¼Œä»¥åŠå®ƒå¯¹ä¼˜åŒ–çš„å½±å“ã€‚SGDã€Adamã€Tigerç­‰å¸¸è§ä¼˜åŒ–å™¨çš„æ›´æ–°è§„åˆ™æ˜¯Element-wiseçš„ï¼Œå³ä¸è®ºå‘é‡ã€çŸ©é˜µå‚æ•°ï¼Œå®é™…éƒ½è§†ä¸ºä¸€ä¸ªå¤§å‘é‡ï¼Œåˆ†é‡æŒ‰ç…§ç›¸åŒçš„è§„åˆ™ç‹¬ç«‹åœ°æ›´æ–°ã€‚å…·å¤‡è¿™ä¸ªç‰¹æ€§çš„ä¼˜åŒ–å™¨å¾€å¾€ç†è®ºåˆ†æèµ·æ¥æ›´åŠ ç®€åŒ–ï¼Œä¹Ÿæ–¹ä¾¿å¼ é‡å¹¶è¡Œï¼Œå› ä¸ºä¸€ä¸ªå¤§çŸ©é˜µåˆ‡æˆä¸¤ä¸ªå°çŸ©é˜µç‹¬ç«‹å¤„ç†ï¼Œå¹¶ä¸æ”¹å˜ä¼˜åŒ–è½¨è¿¹ã€‚</p>
<p>ä½†Muonä¸ä¸€æ ·ï¼Œå®ƒä»¥çŸ©é˜µä¸ºåŸºæœ¬å•ä½ï¼Œè€ƒè™‘äº†çŸ©é˜µçš„ä¸€äº›ç‹¬æœ‰ç‰¹æ€§ã€‚å¯èƒ½æœ‰äº›è¯»è€…ä¼šå¥‡æ€ªï¼šçŸ©é˜µå’Œå‘é‡ä¸éƒ½åªæ˜¯ä¸€å †æ•°å­—çš„æ’åˆ—å—ï¼Œèƒ½æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸¾ä¸ªä¾‹å­ï¼ŒçŸ©é˜µæˆ‘ä»¬æœ‰â€œè¿¹ï¼ˆtraceï¼‰â€è¿™ä¸ªæ¦‚å¿µï¼Œå®ƒæ˜¯å¯¹è§’çº¿å…ƒç´ ä¹‹å’Œï¼Œè¿™ä¸ªæ¦‚å¿µä¸æ˜¯çå®šä¹‰çš„ï¼Œå®ƒæœ‰ä¸€ä¸ªé‡è¦ç‰¹æ€§æ˜¯åœ¨ç›¸ä¼¼å˜æ¢ä¸‹ä¿æŒä¸å˜ï¼Œå®ƒè¿˜ç­‰äºçŸ©é˜µçš„æ‰€æœ‰ç‰¹å¾å€¼ä¹‹å’Œã€‚ä»è¿™ä¸ªä¾‹å­å°±å¯ä»¥çœ‹å‡ºï¼ŒçŸ©é˜µçš„å¯¹è§’çº¿å…ƒç´ è·Ÿéå¯¹è§’çº¿å…ƒç´ ï¼Œåœ°ä½å…¶å®æ˜¯ä¸å®Œå…¨å¯¹ç­‰çš„ã€‚è€ŒMuonæ­£æ˜¯å› ä¸ºè€ƒè™‘äº†è¿™ç§ä¸å¯¹ç­‰æ€§ï¼Œæ‰æœ‰ç€æ›´å¥½çš„æ•ˆæœã€‚</p>
<p>å½“ç„¶ï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´ä¸€äº›è´Ÿé¢å½±å“ã€‚å¦‚æœä¸€ä¸ªçŸ©é˜µè¢«åˆ’åˆ†åˆ°ä¸åŒè®¾å¤‡ä¸Šï¼Œé‚£ä¹ˆç”¨Muonæ—¶å°±éœ€è¦å°†å®ƒä»¬çš„æ¢¯åº¦å°±éœ€è¦æ±‡èšèµ·æ¥å†è®¡ç®—æ›´æ–°é‡äº†ï¼Œè€Œä¸èƒ½æ¯ä¸ªè®¾å¤‡ç‹¬ç«‹æ›´æ–°ï¼Œè¿™å¢åŠ äº†é€šä¿¡æˆæœ¬ã€‚å³ä¾¿æˆ‘ä»¬ä¸è€ƒè™‘å¹¶è¡Œæ–¹é¢ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿå­˜åœ¨ï¼Œæ¯”å¦‚Multi-Head Attentionä¸€èˆ¬æ˜¯é€šè¿‡å•ä¸ªå¤§çŸ©é˜µæŠ•å½±åˆ°$Q$ï¼ˆ$K,V$åŒç†ï¼‰ï¼Œç„¶åç”¨reshapeçš„æ–¹å¼å¾—åˆ°å¤šä¸ªHeadï¼Œè¿™æ ·åœ¨æ¨¡å‹å‚æ•°ä¸­å°±åªæœ‰å•ä¸ªçŸ©é˜µï¼Œä½†å®ƒæœ¬è´¨ä¸Šæ˜¯å¤šä¸ªå°çŸ©é˜µï¼Œæ‰€ä»¥æŒ‰é“ç†æˆ‘ä»¬éœ€è¦å°†å¤§çŸ©é˜µæ‹†å¼€æˆå¤šä¸ªå°çŸ©é˜µç‹¬ç«‹æ›´æ–°ã€‚</p>
<p>æ€»ä¹‹ï¼ŒMuonè¿™ç§éElement-wiseçš„æ›´æ–°è§„åˆ™ï¼Œåœ¨æ•æ‰å‘é‡ä¸çŸ©é˜µçš„æœ¬è´¨å·®å¼‚çš„åŒæ—¶ï¼Œä¹Ÿä¼šå¼•å…¥ä¸€äº›å°é—®é¢˜ï¼Œè¿™å¯èƒ½ä¼šä¸æ»¡è¶³ä¸€äº›è¯»è€…çš„å®¡ç¾ã€‚</p>
<p>ï¼ˆè¡¥å……ï¼šå‡ ä¹åœ¨æœ¬åšå®¢å‘å¸ƒçš„åŒæ—¶ï¼ŒMuonçš„ä½œè€…Keller Jordanä¹Ÿå‘å¸ƒäº†è‡ªå·±çš„ä¸€ç¯‡åšå®¢<a href="https://kellerjordan.github.io/posts/muon/">ã€ŠMuon: An optimizer for hidden layers in neural networksã€‹</a>ã€‚ï¼‰</p>
<h2 id="_6">èŒƒæ•°è§†è§’</h2>
<p>ä»ç†è®ºä¸Šçœ‹ï¼ŒMuonæ•æ‰äº†çŸ©é˜µçš„ä»€ä¹ˆå…³é”®ç‰¹æ€§å‘¢ï¼Ÿä¹Ÿè®¸æ¥ä¸‹æ¥çš„èŒƒæ•°è§†è§’å¯ä»¥å›ç­”æˆ‘ä»¬çš„é—®é¢˜ã€‚</p>
<p>è¿™ä¸€èŠ‚çš„è®¨è®ºä¸»è¦å‚è€ƒäº†è®ºæ–‡<a href="https://ieeexplore.ieee.org/abstract/document/7347351">ã€ŠStochastic Spectral Descent for Discrete Graphical Modelsã€‹</a>å’Œ<a href="https://papers.cool/arxiv/2409.20325">ã€ŠOld Optimizer, New Norm: An Anthologyã€‹</a>ï¼Œç‰¹åˆ«æ˜¯åä¸€ç¯‡ã€‚ä¸è¿‡å…¶ä¸­çš„å‡ºå‘ç‚¹å¹¶ä¸æ˜¯æ–°çš„ï¼Œæˆ‘ä»¬åœ¨<a href="/archives/9660">ã€Šæ¢¯åº¦æµï¼šæ¢ç´¢é€šå‘æœ€å°å€¼ä¹‹è·¯ã€‹</a>å°±å·²ç»ç®€å•æ¶‰çŒè¿‡ï¼šå¯¹äºå‘é‡å‚æ•°$\boldsymbol{w}\in\mathbb{R}^n$ï¼Œæˆ‘ä»¬å°†ä¸‹ä¸€æ­¥çš„æ›´æ–°è§„åˆ™å®šä¹‰ä¸º<br />
\begin{equation}\boldsymbol{w}<em _boldsymbol_w="\boldsymbol{w">{t+1} = \mathop{\text{argmin}}</em>}} \frac{\Vert\boldsymbol{w} - \boldsymbol{w<em t_1="t+1">t\Vert^2}{2\eta_t} + \mathcal{L}(\boldsymbol{w})\end{equation}<br />
å…¶ä¸­$\Vert\Vert$æ˜¯æŸä¸ªå‘é‡èŒƒæ•°ï¼Œè¿™ç§°ä¸ºåœ¨æŸä¸ªèŒƒæ•°çº¦æŸä¸‹çš„â€œæœ€é€Ÿæ¢¯åº¦ä¸‹é™â€ã€‚æ¥ç€å‡è®¾$\eta_t$è¶³å¤Ÿå°ï¼Œé‚£ä¹ˆç¬¬ä¸€é¡¹å ä¸»å¯¼ï¼Œè¿™æ„å‘³ç€$\boldsymbol{w}</em>}$ä¸$\boldsymbol{w<em t_1="t+1">t$ä¼šå¾ˆæ¥è¿‘ï¼Œäºæ˜¯æˆ‘ä»¬å‡è®¾$\mathcal{L}(\boldsymbol{w})$çš„ä¸€é˜¶è¿‘ä¼¼å¤Ÿç”¨äº†ï¼Œäºæ˜¯é—®é¢˜ç®€åŒ–æˆ<br />
\begin{equation}\boldsymbol{w}</em>} = \mathop{\text{argmin}<em _boldsymbol_w="\boldsymbol{w">{\boldsymbol{w}} \frac{\Vert\boldsymbol{w} - \boldsymbol{w}_t\Vert^2}{2\eta_t} + \mathcal{L}(\boldsymbol{w}_t) + \nabla</em><em t_1="t+1">t}\mathcal{L}(\boldsymbol{w}_t)^{\top}(\boldsymbol{w}-\boldsymbol{w}_t)\end{equation}<br />
è®°$\Delta\boldsymbol{w}</em>} = \boldsymbol{w<em _boldsymbol_w="\boldsymbol{w">{t+1}-\boldsymbol{w}_t, \boldsymbol{g}_t = \nabla</em><em t_1="t+1">t}\mathcal{L}(\boldsymbol{w}_t)$ï¼Œé‚£ä¹ˆå¯ä»¥ç®€å†™æˆ<br />
\begin{equation}\Delta\boldsymbol{w}</em>} = \mathop{\text{argmin}<em t_1="t+1">{\Delta\boldsymbol{w}} \frac{\Vert\Delta\boldsymbol{w}\Vert^2}{2\eta_t} + \boldsymbol{g}_t^{\top}\Delta\boldsymbol{w}\end{equation}<br />
è®¡ç®—$\Delta\boldsymbol{w}</em>$çš„ä¸€èˆ¬æ€è·¯æ˜¯æ±‚å¯¼ï¼Œä½†<a href="https://papers.cool/arxiv/2409.20325">ã€ŠOld Optimizer, New Norm: An Anthologyã€‹</a>æä¾›äº†ä¸€ä¸ªä¸ç”¨æ±‚å¯¼çš„ç»Ÿä¸€æ–¹æ¡ˆï¼šå°†$\Delta\boldsymbol{w}$åˆ†è§£ä¸ºèŒƒæ•°$\gamma = \Vert\Delta\boldsymbol{w}\Vert$å’Œæ–¹å‘å‘é‡$\boldsymbol{\varphi} = -\Delta\boldsymbol{w}/\Vert\Delta\boldsymbol{w}\Vert$ï¼Œäºæ˜¯<br />
\begin{equation}\min_{\Delta\boldsymbol{w}} \frac{\Vert\Delta\boldsymbol{w}\Vert^2}{2\eta_t} + \boldsymbol{g}<em 0_="0," _Vert_boldsymbol_varphi="\Vert\boldsymbol{\varphi" _gamma_geq="\gamma\geq">t^{\top}\Delta\boldsymbol{w} = \min</em>}\Vert=1} \frac{\gamma^2}{2\eta_t} - \gamma\boldsymbol{g<em 0="0" _gamma_geq="\gamma\geq">t^{\top}\boldsymbol{\varphi} = \min</em>} \frac{\gamma^2}{2\eta_t} - \gamma\bigg(\underbrace{\max_{\Vert\boldsymbol{\varphi}\Vert=1}\boldsymbol{g<em _text_è®°ä¸º="\text{è®°ä¸º">t^{\top}\boldsymbol{\varphi}}</em>}\Vert \boldsymbol{g<em t_1="t+1">t\Vert^{\dagger}}\bigg)\end{equation}<br />
$\gamma$åªæ˜¯ä¸€ä¸ªæ ‡é‡ï¼Œè·Ÿå­¦ä¹ ç‡ç±»ä¼¼ï¼Œå®¹æ˜“æ±‚å¾—æœ€ä¼˜å€¼æ˜¯$\eta_t\Vert \boldsymbol{g}_t\Vert^{\dagger}$ï¼Œè€Œæ›´æ–°æ–¹å‘åˆ™æ˜¯æœ€å¤§åŒ–$\boldsymbol{g}_t^{\top}\boldsymbol{\varphi}$ï¼ˆ$\Vert\boldsymbol{\varphi}\Vert=1$ï¼‰çš„$\boldsymbol{\varphi}^<em>$ã€‚ç°åœ¨ä»£å…¥æ¬§æ°èŒƒæ•°å³$\Vert\boldsymbol{\varphi}\Vert_2 = \sqrt{\boldsymbol{\varphi}^{\top}\boldsymbol{\varphi}}$ï¼Œæˆ‘ä»¬å°±æœ‰$\Vert \boldsymbol{g}_t\Vert^{\dagger}=\Vert \boldsymbol{g}_t\Vert_2$å’Œ$\boldsymbol{\varphi}^</em> = \boldsymbol{g}_t/\Vert\boldsymbol{g}_t\Vert_2$ï¼Œè¿™æ ·ä¸€æ¥$\Delta\boldsymbol{w}</em>}=-\eta_t \boldsymbol{g<em i="1">t$ï¼Œå³æ¢¯åº¦ä¸‹é™ï¼ˆSGDï¼‰ã€‚ä¸€èˆ¬åœ°ï¼Œå¯¹äº$p$èŒƒæ•°<br />
\begin{equation}\Vert\boldsymbol{\varphi}\Vert_p = \sqrt[\uproot{10}p]{\sum</em>}^n |\varphi_i|^p}\end{equation<a href="https://en.wikipedia.org/wiki/H%C3%B6lder%27s_inequality">HÃ¶lderä¸ç­‰å¼</a>ç»™å‡º$\boldsymbol{g}^{\top}\boldsymbol{\varphi} \leq \Vert \boldsymbol{g}\Vert_q \Vert \boldsymbol{\varphi}\Vert_p$ï¼Œå…¶ä¸­$1/p + 1/q = 1$ï¼Œåˆ©ç”¨å®ƒæˆ‘ä»¬å¾—åˆ°<br />
\begin{equation}\max_{\Vert\boldsymbol{\varphi}\Vert_p=1}\boldsymbol{g}^{\top}\boldsymbol{\varphi} = \Vert \boldsymbol{g}\Vert_q\end{equation}<br />
ç­‰å·æˆç«‹çš„æ¡ä»¶æ˜¯<br />
\begin{equation}\boldsymbol{\varphi}^* = \frac{1}{\Vert\boldsymbol{g}\Vert_q^{q/p}}\Big[\text{sign}(g_1) |g_1|^{q/p},\text{sign}(g_2) |g_2|^{q/p},\cdots,\text{sign}(g_n) |g_n|^{q/p}\Big]\end{equation}<br />
ä»¥å®ƒä¸ºæ–¹å‘å‘é‡çš„ä¼˜åŒ–å™¨å«åšpbSGDï¼Œå¯å‚è€ƒ<a href="https://www.ijcai.org/proceedings/2020/451">ã€ŠpbSGD: Powered Stochastic Gradient Descent Methods for Accelerated Non-Convex Optimizationã€‹</a>ã€‚ç‰¹åˆ«åœ°ï¼Œå½“$p\to\infty$æ—¶æœ‰$q\to 1$å’Œ$|g_i|^{q/p}\to 1$ï¼Œæ­¤æ—¶é€€åŒ–ä¸ºSignSGDï¼Œå³SignSGDå®é™…ä¸Šæ˜¯$\Vert\Vert_{\infty}$èŒƒæ•°ä¸‹çš„æœ€é€Ÿæ¢¯åº¦ä¸‹é™ã€‚</p>
<h2 id="_7">çŸ©é˜µèŒƒæ•°</h2>
<p>ç°åœ¨è®©æˆ‘ä»¬å°†ç›®å…‰åˆ‡æ¢åˆ°çŸ©é˜µå‚æ•°$\boldsymbol{W}\in\mathbb{R}^{n\times m}$ã€‚ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬å°†å®ƒçš„æ›´æ–°è§„åˆ™å®šä¹‰ä¸º<br />
\begin{equation}\boldsymbol{W}<em _boldsymbol_W="\boldsymbol{W">{t+1} = \mathop{\text{argmin}}</em>}} \frac{\Vert\boldsymbol{W} - \boldsymbol{W<em t_1="t+1">t\Vert^2}{2\eta_t} + \mathcal{L}(\boldsymbol{W})\end{equation}<br />
æ­¤æ—¶$\Vert\Vert$æ˜¯æŸç§çŸ©é˜µèŒƒæ•°ã€‚åŒæ ·ä½¿ç”¨ä¸€é˜¶è¿‘ä¼¼ï¼Œæˆ‘ä»¬å¾—åˆ°<br />
\begin{equation}\Delta\boldsymbol{W}</em>} = \mathop{\text{argmin}<em t_1="t+1">{\Delta\boldsymbol{W}} \frac{\Vert\Delta\boldsymbol{W}\Vert^2}{2\eta_t} + \text{Tr}(\boldsymbol{G}_t^{\top}\Delta\boldsymbol{W})\end{equation}<br />
è¿™é‡Œ$\Delta\boldsymbol{W}</em>} = \boldsymbol{W<em _boldsymbol_W="\boldsymbol{W">{t+1}-\boldsymbol{W}_t, \boldsymbol{G}_t = \nabla</em><em _Delta_boldsymbol_W="\Delta\boldsymbol{W">t}\mathcal{L}(\boldsymbol{W}_t)$ã€‚è¿˜æ˜¯ä½¿ç”¨â€œèŒƒæ•°-æ–¹å‘â€è§£è€¦ï¼Œå³è®¾$\gamma = \Vert\Delta\boldsymbol{w}\Vert$å’Œ$\boldsymbol{\Phi} = -\Delta\boldsymbol{W}/\Vert\Delta\boldsymbol{W}\Vert$ï¼Œæˆ‘ä»¬å¾—åˆ°<br />
\begin{equation}\min</em>}} \frac{\Vert\Delta\boldsymbol{W}\Vert^2}{2\eta_t} + \text{Tr}(\boldsymbol{G<em 0="0" _gamma_geq="\gamma\geq">t^{\top}\Delta\boldsymbol{W}) = \min</em>} \frac{\gamma^2}{2\eta_t} - \gamma\bigg(\underbrace{\max_{\Vert\boldsymbol{\Phi}\Vert=1}\text{Tr}(\boldsymbol{G<em _text_è®°ä¸º="\text{è®°ä¸º">t^{\top}\boldsymbol{\Phi})}</em>}\Vert \boldsymbol{G<em _Vert="\Vert" _boldsymbol_x="\boldsymbol{x">t\Vert^{\dagger}}\bigg)\end{equation}<br />
ç„¶åå°±æ˜¯å…·ä½“èŒƒæ•°å…·ä½“åˆ†æäº†ã€‚çŸ©é˜µå¸¸ç”¨çš„èŒƒæ•°æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯<a href="/archives/10366#%E8%8C%83%E6%95%B0%E7%9B%B8%E5%85%B3">FèŒƒæ•°</a>ï¼Œå®ƒå®é™…ä¸Šå°±æ˜¯å°†çŸ©é˜µå±•å¹³æˆå‘é‡åç®—çš„æ¬§æ°èŒƒæ•°ï¼Œè¿™ç§æƒ…å†µä¸‹ç»“è®ºè·Ÿå‘é‡æ˜¯ä¸€æ ·çš„ï¼Œç­”æ¡ˆå°±æ˜¯SGDï¼Œè¿™é‡Œä¸å†å±•å¼€ï¼›å¦ä¸€ç§åˆ™æ˜¯ç”±å‘é‡èŒƒæ•°è¯±å¯¼å‡ºæ¥çš„$2$èŒƒæ•°ï¼Œä¹Ÿç§°è°±èŒƒæ•°ï¼š<br />
\begin{equation}\Vert \boldsymbol{\Phi}\Vert_2 = \max</em>}\Vert_2 = 1} \Vert \boldsymbol{\Phi}\boldsymbol{x}\Vert_2\end{equation<br />
æ³¨æ„å³ç«¯å‡ºç°çš„$\Vert\Vert_2$çš„å¯¹è±¡éƒ½æ˜¯å‘é‡ï¼Œæ‰€ä»¥å®šä¹‰æ˜¯æ˜ç¡®çš„ã€‚æ›´å¤šå…³äº$2$èŒƒæ•°çš„è®¨è®ºå¯ä»¥å‚è€ƒ<a href="/archives/6051">ã€Šæ·±åº¦å­¦ä¹ ä¸­çš„Lipschitzçº¦æŸï¼šæ³›åŒ–ä¸ç”Ÿæˆæ¨¡å‹ã€‹</a>å’Œ<a href="/archives/10407#%E7%9F%A9%E9%98%B5%E8%8C%83%E6%95%B0">ã€Šä½ç§©è¿‘ä¼¼ä¹‹è·¯ï¼ˆäºŒï¼‰ï¼šSVDã€‹</a>ã€‚ç”±äº$2$èŒƒæ•°æ˜¯ç”±â€œçŸ©é˜µ-å‘é‡â€ä¹˜æ³•è¯±å¯¼å‡ºæ¥çš„ï¼Œå› æ­¤å®ƒæ›´è´´åˆçŸ©é˜µä¹˜æ³•ï¼Œå¹¶ä¸”è¿˜æ’æˆç«‹$\Vert\boldsymbol{\Phi}\Vert_2\leq \Vert\boldsymbol{\Phi}\Vert_F$ï¼Œå³$2$èŒƒæ•°ç›¸æ¯”$F$èŒƒæ•°æ›´ç´§å‡‘ã€‚</p>
<p>æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±é’ˆå¯¹$2$èŒƒæ•°è¿›è¡Œè®¡ç®—ã€‚è®¾$\boldsymbol{G}$çš„SVDä¸º$\boldsymbol{U}\boldsymbol{\Sigma}\boldsymbol{V}^{\top} = \sum\limits_{i=1}^r \sigma_i \boldsymbol{u}<em i="1">i \boldsymbol{v}_i^{\top}$ï¼Œæˆ‘ä»¬æœ‰<br />
\begin{equation}\text{Tr}(\boldsymbol{G}^{\top}\boldsymbol{\Phi})=\text{Tr}\Big(\sum</em>}^r \sigma_i \boldsymbol{v<em i="1">i \boldsymbol{u}_i^{\top}\boldsymbol{\Phi}\Big) = \sum</em>}^r \sigma_i \boldsymbol{u<em i="1">i^{\top}\boldsymbol{\Phi}\boldsymbol{v}_i\end{equation}<br />
æ ¹æ®å®šä¹‰ï¼Œå½“$\Vert\boldsymbol{\Phi}\Vert_2=1$æ—¶$\Vert\boldsymbol{\Phi}\boldsymbol{v}_i\Vert_2\leq \Vert\boldsymbol{v}_i\Vert_2=1$ï¼Œäºæ˜¯$\boldsymbol{u}_i^{\top}\boldsymbol{\Phi}\boldsymbol{v}_i\leq 1$ï¼Œå› æ­¤<br />
\begin{equation}\text{Tr}(\boldsymbol{G}^{\top}\boldsymbol{\Phi})\leq \sum</em>}^r \sigma_i\end{equation<br />
ç­‰å·åœ¨æ‰€æœ‰$\boldsymbol{u}<em i="1">i^{\top}\boldsymbol{\Phi}\boldsymbol{v}_i$éƒ½ç­‰äº1æ—¶å–åˆ°ï¼Œæ­¤æ—¶<br />
\begin{equation}\boldsymbol{\Phi} = \sum</em>}^r \boldsymbol{u<em _:_:r_="[:,:r]">i \boldsymbol{v}_i^{\top} = \boldsymbol{U}</em>}\boldsymbol{V}_{[:,:r]}^{\top} = \text{msign}(\boldsymbol{G})\end{equation<br />
è‡³æ­¤ï¼Œæˆ‘ä»¬è¯æ˜äº†$2$èŒƒæ•°æƒ©ç½šä¸‹çš„æ¢¯åº¦ä¸‹é™æ­£æ˜¯$\beta=0$æ—¶çš„Muonä¼˜åŒ–å™¨ï¼å½“$\beta &gt; 0$æ—¶ï¼Œæ»‘åŠ¨å¹³å‡ç”Ÿæ•ˆï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒè§†ä¸ºæ¢¯åº¦çš„ä¸€ç§æ›´ç²¾å‡†çš„ä¼°è®¡ï¼Œæ‰€ä»¥æ”¹ä¸ºå¯¹åŠ¨é‡å–$\text{msign}$ã€‚æ€»çš„æ¥è¯´ï¼ŒMuonç›¸å½“äº$2$èŒƒæ•°çº¦æŸä¸‹çš„æ¢¯åº¦ä¸‹é™ï¼Œ$2$èŒƒæ•°æ›´å¥½åœ°åº¦é‡äº†çŸ©é˜µä¹‹é—´çš„æœ¬è´¨å·®å¼‚ï¼Œä»è€Œä½¿æ¯ä¸€æ­¥éƒ½èµ°å¾—æ›´ç²¾å‡†ã€æ›´æœ¬è´¨ã€‚</p>
<h2 id="_8">è¿½æ ¹æº¯æº</h2>
<p>Muonè¿˜æœ‰ä¸€ä¸ªæ›´ä¹…è¿œçš„ç›¸å…³å·¥ä½œ<a href="https://papers.cool/arxiv/1802.09568">ã€ŠShampoo: Preconditioned Stochastic Tensor Optimizationã€‹</a>ï¼Œè¿™æ˜¯2018å¹´çš„è®ºæ–‡ï¼Œæå‡ºäº†åä¸ºShampooçš„ä¼˜åŒ–å™¨ï¼Œè·ŸMuonæœ‰å¼‚æ›²åŒå·¥ä¹‹å¤„ã€‚</p>
<p>Adamé€šè¿‡æ¢¯åº¦å¹³æ–¹çš„å¹³å‡æ¥è‡ªé€‚åº”å­¦ä¹ ç‡çš„ç­–ç•¥ï¼Œæœ€æ—©æå‡ºè‡ªAdagradçš„è®ºæ–‡<a href="https://jmlr.org/papers/v12/duchi11a.html">ã€ŠAdaptive Subgradient Methods for Online Learning and Stochastic Optimizationã€‹</a>ï¼Œé‡Œè¾¹æå‡ºçš„æ˜¯ç›´æ¥å°†æ¢¯åº¦å¹³æ–¹ç´¯åŠ çš„ç­–ç•¥ï¼Œè¿™ç›¸å½“äºå…¨å±€ç­‰æƒå¹³å‡ï¼Œåæ¥çš„RMSPropã€Adamåˆ™ç±»æ¯”åŠ¨é‡çš„è®¾è®¡ï¼Œæ”¹ä¸ºæ»‘åŠ¨å¹³å‡ï¼Œå‘ç°åœ¨å®è·µä¸­è¡¨ç°æ›´å¥½ã€‚</p>
<p>ä¸ä»…å¦‚æ­¤ï¼ŒAdagradæœ€å¼€å§‹æå‡ºçš„å®é™…æ˜¯ç´¯åŠ å¤–ç§¯$\boldsymbol{g}\boldsymbol{g}^{\top}$ï¼Œåªä¸è¿‡ç¼“å­˜å¤–ç§¯ç©ºé—´æˆæœ¬å¤ªå¤§ï¼Œæ‰€ä»¥å®è·µä¸­æ”¹ä¸ºHadamardç§¯$\boldsymbol{g}\odot\boldsymbol{g}$ã€‚é‚£ç´¯åŠ å¤–ç§¯çš„ç†è®ºä¾æ®æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™æˆ‘ä»¬åœ¨<a href="/archives/10588">ã€Šä»Hessianè¿‘ä¼¼çœ‹è‡ªé€‚åº”å­¦ä¹ ç‡ä¼˜åŒ–å™¨ã€‹</a>æ¨å¯¼è¿‡ï¼Œç­”æ¡ˆæ˜¯â€œæ¢¯åº¦å¤–ç§¯çš„é•¿æœŸå¹³å‡$\mathbb{E}[\boldsymbol{g}\boldsymbol{g}^{\top}]$è¿‘ä¼¼äº†HessiançŸ©é˜µçš„å¹³æ–¹$\sigma^2\boldsymbol{\mathcal{H}}_{\boldsymbol{\theta}^*}^2$â€ï¼Œæ‰€ä»¥è¿™å®é™…ä¸Šåœ¨è¿‘ä¼¼äºŒé˜¶çš„Newtonæ³•ã€‚</p>
<p>Shampooä¼ æ‰¿äº†Adagradç¼“å­˜å¤–ç§¯çš„æ€æƒ³ï¼Œä½†è€ƒè™‘åˆ°æˆæœ¬é—®é¢˜ï¼Œå–äº†ä¸ªæŠ˜ä¸­ã€‚è·ŸMuonä¸€æ ·ï¼Œå®ƒåŒæ ·æ˜¯é’ˆå¯¹çŸ©é˜µï¼ˆä»¥åŠé«˜é˜¶å¼ é‡ï¼‰è¿›è¡Œä¼˜åŒ–ï¼Œç­–ç•¥æ˜¯ç¼“å­˜æ¢¯åº¦çš„çŸ©é˜µä¹˜ç§¯$\boldsymbol{G}\boldsymbol{G}^{\top}$å’Œ$\boldsymbol{G}^{\top}\boldsymbol{G}$ï¼Œè€Œä¸æ˜¯å¤–ç§¯ï¼Œè¿™æ ·ç©ºé—´æˆæœ¬æ˜¯$\mathcal{O}(n^2 + m^2)$è€Œä¸æ˜¯$\mathcal{O}(n^2 m^2)$ï¼š<br />
\begin{equation}\begin{aligned}<br />
\boldsymbol{L}<em t-1="t-1">t =&amp;\, \beta\boldsymbol{L}</em>} + \boldsymbol{G<em t-1="t-1">t\boldsymbol{G}_t^{\top} \\\[5pt]<br />
\boldsymbol{R}_t =&amp;\, \beta\boldsymbol{R}</em>} + \boldsymbol{G<em t-1="t-1">t^{\top}\boldsymbol{G}_t \\\[5pt]<br />
\boldsymbol{W}_t =&amp;\, \boldsymbol{W}</em> \\\} - \eta_t \boldsymbol{L}_t^{-1/4}\boldsymbol{G}_t\boldsymbol{R}_t^{-1/4<br />
\end{aligned}\end{equation}<br />
è¿™é‡Œçš„$\beta$æ˜¯ç¬”è€…è‡ªå·±åŠ çš„ï¼ŒShampooé»˜è®¤äº†$\beta=1$ï¼Œ${}^{-1/4}$åŒæ ·æ˜¯çŸ©é˜µçš„å¹‚è¿ç®—ï¼Œå¯ä»¥ç”¨SVDæ¥å®Œæˆã€‚ç”±äºShampooæ²¡æœ‰æå‡ºNewton-schulzè¿­ä»£ä¹‹ç±»çš„è¿‘ä¼¼æ–¹æ¡ˆï¼Œæ˜¯ç›´æ¥ç”¨SVDç®—çš„ï¼Œæ‰€ä»¥ä¸ºäº†èŠ‚çœè®¡ç®—æˆæœ¬ï¼Œå®ƒå¹¶æ²¡æœ‰æ¯ä¸€æ­¥éƒ½è®¡ç®—$\boldsymbol{L}_t^{-1/4}$å’Œ$\boldsymbol{R}_t^{-1/4}$ï¼Œè€Œæ˜¯é—´éš”ä¸€å®šæ­¥æ•°æ‰æ›´æ–°å®ƒä»¬çš„ç»“æœã€‚</p>
<p>ç‰¹åˆ«åœ°ï¼Œå½“$\beta=0$æ—¶ï¼ŒShampooçš„æ›´æ–°å‘é‡ä¸º$(\boldsymbol{G}\boldsymbol{G}^{\top})^{-1/4}\boldsymbol{G}(\boldsymbol{G}^{\top}\boldsymbol{G})^{-1/4}$ï¼Œé€šè¿‡å¯¹$\boldsymbol{G}$è¿›è¡ŒSVDæˆ‘ä»¬å¯ä»¥è¯æ˜<br />
\begin{equation}(\boldsymbol{G}\boldsymbol{G}^{\top})^{-1/4}\boldsymbol{G}(\boldsymbol{G}^{\top}\boldsymbol{G})^{-1/4} = (\boldsymbol{G}\boldsymbol{G}^{\top})^{-1/2}\boldsymbol{G}= \boldsymbol{G}(\boldsymbol{G}^{\top}\boldsymbol{G})^{-1/2}=\text{msign}(\boldsymbol{G})\end{equation}<br />
è¿™è¡¨æ˜$\beta=0$æ—¶Shampooå’ŒMuonåœ¨ç†è®ºä¸Šæ˜¯ç­‰ä»·çš„ï¼å› æ­¤ï¼ŒShampooä¸Muonåœ¨æ›´æ–°é‡çš„è®¾è®¡æ–¹é¢æœ‰ç€ç›¸é€šä¹‹å¤„ã€‚</p>
<h2 id="_9">æ–‡ç« å°ç»“</h2>
<p>æœ¬æ–‡ä»‹ç»äº†æœ€è¿‘æ¨ç‰¹ä¸Šé¢‡ä¸ºçƒ­é—¹çš„Muonä¼˜åŒ–å™¨ï¼Œå®ƒä¸“é—¨ä¸ºçŸ©é˜µå‚æ•°å®šåˆ¶ï¼Œç›®å‰çœ‹æ¥æ¯”AdamWæ›´é«˜æ•ˆï¼Œå¹¶ä¸”ä¼¼ä¹ä½“ç°äº†ä¸€äº›å‘é‡åŒ–ä¸çŸ©é˜µåŒ–çš„æœ¬è´¨å·®å¼‚ï¼Œå€¼å¾—å­¦ä¹ å’Œæ€è€ƒä¸€ç•ªã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/10592">https://spaces.ac.cn/archives/10592</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Dec. 10, 2024). ã€ŠMuonä¼˜åŒ–å™¨èµæï¼šä»å‘é‡åˆ°çŸ©é˜µçš„æœ¬è´¨è·¨è¶Š ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/10592">https://spaces.ac.cn/archives/10592</a></p>
<p>@online{kexuefm-10592,<br />
title={Muonä¼˜åŒ–å™¨èµæï¼šä»å‘é‡åˆ°çŸ©é˜µçš„æœ¬è´¨è·¨è¶Š},<br />
author={è‹å‰‘æ—},<br />
year={2024},<br />
month={Dec},<br />
url={\url{https://spaces.ac.cn/archives/10592}},<br />
} </p>
<hr />
<h2 id="_10">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<h3 id="1-muon">1. Muonä¼˜åŒ–å™¨çš„å®Œæ•´æ•°å­¦å®šä¹‰</h3>
<p>Muonä¼˜åŒ–å™¨é’ˆå¯¹çŸ©é˜µå‚æ•°$\boldsymbol{W}\in\mathbb{R}^{n\times m}$è®¾è®¡ï¼Œå…¶å®Œæ•´çš„æ›´æ–°è§„åˆ™å¯ä»¥å½¢å¼åŒ–ä¸ºï¼š</p>
<p><strong>å®šä¹‰1.1ï¼ˆMuonä¼˜åŒ–å™¨ï¼‰</strong>ï¼šç»™å®šæŸå¤±å‡½æ•°$\mathcal{L}(\boldsymbol{W})$ï¼Œå‚æ•°çŸ©é˜µ$\boldsymbol{W}<em t="1">t\in\mathbb{R}^{n\times m}$ï¼Œå­¦ä¹ ç‡åºåˆ—$\{\eta_t\}</em>$ï¼ŒåŠ¨é‡ç³»æ•°$\beta\in[0,1)$ï¼Œæƒé‡è¡°å‡ç³»æ•°$\lambda\geq 0$ï¼ŒMuonä¼˜åŒ–å™¨çš„æ›´æ–°è§„åˆ™ä¸ºï¼š}^{\infty</p>
<p>$$
\begin{equation}
\begin{aligned}
\boldsymbol{G}_t &= \nabla_{\boldsymbol{W}_{t-1}}\mathcal{L}(\boldsymbol{W}_{t-1}) \\
\boldsymbol{M}_t &= \beta\boldsymbol{M}_{t-1} + \boldsymbol{G}_t \\
\boldsymbol{W}_t &= \boldsymbol{W}_{t-1} - \eta_t[\text{msign}(\boldsymbol{M}_t) + \lambda\boldsymbol{W}_{t-1}]
\end{aligned}
\end{equation}
$$</p>
<p>å…¶ä¸­$\boldsymbol{M}_0 = \boldsymbol{0}$ï¼ŒçŸ©é˜µç¬¦å·å‡½æ•°$\text{msign}:\mathbb{R}^{n\times m}\to\mathbb{R}^{n\times m}$å®šä¹‰ä¸ºï¼š</p>
<p>$$
\text{msign}(\boldsymbol{M}) = \begin{cases}
\boldsymbol{U}_{[:,:r]}\boldsymbol{V}_{[:,:r]}^{\top} & \text{if } \boldsymbol{M} = \boldsymbol{U}\boldsymbol{\Sigma}\boldsymbol{V}^{\top} \text{ (SVD)} \\
\boldsymbol{0} & \text{if } \boldsymbol{M} = \boldsymbol{0}
\end{cases}
$$</p>
<p>å…¶ä¸­$r=\text{rank}(\boldsymbol{M})$æ˜¯çŸ©é˜µçš„ç§©ã€‚</p>
<p><strong>å‘½é¢˜1.2ï¼ˆmsignçš„ç­‰ä»·å®šä¹‰ï¼‰</strong>ï¼šçŸ©é˜µç¬¦å·å‡½æ•°å…·æœ‰ä»¥ä¸‹ç­‰ä»·å®šä¹‰ï¼š</p>
<p>$$
\text{msign}(\boldsymbol{M}) = (\boldsymbol{M}\boldsymbol{M}^{\top})^{-1/2}\boldsymbol{M} = \boldsymbol{M}(\boldsymbol{M}^{\top}\boldsymbol{M})^{-1/2}
$$</p>
<p><strong>è¯æ˜</strong>ï¼šè®¾$\boldsymbol{M}=\boldsymbol{U}\boldsymbol{\Sigma}\boldsymbol{V}^{\top}$æ˜¯å®Œæ•´SVDï¼Œå…¶ä¸­$\boldsymbol{U}\in\mathbb{R}^{n\times n}$ï¼Œ$\boldsymbol{\Sigma}\in\mathbb{R}^{n\times m}$ï¼Œ$\boldsymbol{V}\in\mathbb{R}^{m\times m}$ã€‚è®°$\boldsymbol{\Sigma}<em _:r_:r_="[:r,:r]">r = \boldsymbol{\Sigma}</em>$ä¸ºéé›¶å¥‡å¼‚å€¼å¯¹è§’çŸ©é˜µã€‚}\in\mathbb{R}^{r\times r</p>
<p>é¦–å…ˆè®¡ç®—$\boldsymbol{M}\boldsymbol{M}^{\top}$ï¼š</p>
<p>$$
\boldsymbol{M}\boldsymbol{M}^{\top} = \boldsymbol{U}\boldsymbol{\Sigma}\boldsymbol{V}^{\top}\boldsymbol{V}\boldsymbol{\Sigma}^{\top}\boldsymbol{U}^{\top} = \boldsymbol{U}\boldsymbol{\Sigma}\boldsymbol{\Sigma}^{\top}\boldsymbol{U}^{\top}
$$</p>
<p>æ³¨æ„åˆ°$\boldsymbol{\Sigma}\boldsymbol{\Sigma}^{\top}\in\mathbb{R}^{n\times n}$æ˜¯å—å¯¹è§’çŸ©é˜µï¼š</p>
<p>$$
\boldsymbol{\Sigma}\boldsymbol{\Sigma}^{\top} = \begin{bmatrix}
\boldsymbol{\Sigma}_r^2 & \boldsymbol{0} \\
\boldsymbol{0} & \boldsymbol{0}
\end{bmatrix}
$$</p>
<p>å› æ­¤ï¼š</p>
<p>$$
(\boldsymbol{M}\boldsymbol{M}^{\top})^{-1/2} = \boldsymbol{U}\begin{bmatrix}
\boldsymbol{\Sigma}_r^{-1} & \boldsymbol{0} \\
\boldsymbol{0} & \boldsymbol{0}
\end{bmatrix}\boldsymbol{U}^{\top}
$$</p>
<p>ä»£å…¥å¾—ï¼š</p>
<p>$$
\begin{aligned}
(\boldsymbol{M}\boldsymbol{M}^{\top})^{-1/2}\boldsymbol{M} &= \boldsymbol{U}\begin{bmatrix}
\boldsymbol{\Sigma}_r^{-1} & \boldsymbol{0} \\
\boldsymbol{0} & \boldsymbol{0}
\end{bmatrix}\boldsymbol{U}^{\top}\boldsymbol{U}\boldsymbol{\Sigma}\boldsymbol{V}^{\top} \\
&= \boldsymbol{U}\begin{bmatrix}
\boldsymbol{\Sigma}_r^{-1} & \boldsymbol{0} \\
\boldsymbol{0} & \boldsymbol{0}
\end{bmatrix}\boldsymbol{\Sigma}\boldsymbol{V}^{\top} \\
&= \boldsymbol{U}_{[:,:r]}\boldsymbol{I}_r\boldsymbol{V}_{[:,:r]}^{\top} = \boldsymbol{U}_{[:,:r]}\boldsymbol{V}_{[:,:r]}^{\top}
\end{aligned}
$$</p>
<p>åŒç†å¯è¯$\boldsymbol{M}(\boldsymbol{M}^{\top}\boldsymbol{M})^{-1/2} = \boldsymbol{U}<em _:_:r_="[:,:r]">{[:,:r]}\boldsymbol{V}</em>$ã€‚è¯æ¯•ã€‚}^{\top</p>
<h3 id="2">2. ä»å‘é‡åˆ°çŸ©é˜µï¼šä¼˜åŒ–å™¨çš„æ¼”åŒ–</h3>
<h4 id="21-sgd">2.1 SGDçš„å‘é‡å½¢å¼</h4>
<p>æ ‡å‡†SGDé’ˆå¯¹å‚æ•°å‘é‡$\boldsymbol{\theta}\in\mathbb{R}^d$ï¼Œæ›´æ–°è§„åˆ™ä¸ºï¼š</p>
<p>$$
\boldsymbol{\theta}_{t+1} = \boldsymbol{\theta}_t - \eta_t\boldsymbol{g}_t
$$</p>
<p>å…¶ä¸­$\boldsymbol{g}<em _boldsymbol_theta="\boldsymbol{\theta">t = \nabla</em>^d$ä¸Šæ²¿ç€è´Ÿæ¢¯åº¦æ–¹å‘çš„ç§»åŠ¨ã€‚}_t}\mathcal{L}(\boldsymbol{\theta}_t)$ã€‚è¿™å¯ä»¥è§†ä¸ºåœ¨æ¬§å‡ é‡Œå¾—ç©ºé—´$\mathbb{R</p>
<h4 id="22-adam">2.2 Adamçš„è‡ªé€‚åº”ç¼©æ”¾</h4>
<p>Adamå¼•å…¥äº†åŸºäºæ¢¯åº¦äºŒé˜¶çŸ©çš„è‡ªé€‚åº”å­¦ä¹ ç‡ï¼š</p>
<p>$$
\begin{aligned}
\boldsymbol{m}_t &= \beta_1\boldsymbol{m}_{t-1} + (1-\beta_1)\boldsymbol{g}_t \\
\boldsymbol{v}_t &= \beta_2\boldsymbol{v}_{t-1} + (1-\beta_2)\boldsymbol{g}_t\odot\boldsymbol{g}_t \\
\hat{\boldsymbol{m}}_t &= \frac{\boldsymbol{m}_t}{1-\beta_1^t}, \quad \hat{\boldsymbol{v}}_t = \frac{\boldsymbol{v}_t}{1-\beta_2^t} \\
\boldsymbol{\theta}_{t+1} &= \boldsymbol{\theta}_t - \eta_t\frac{\hat{\boldsymbol{m}}_t}{\sqrt{\hat{\boldsymbol{v}}_t} + \epsilon}
\end{aligned}
$$</p>
<p>å…³é”®è§‚å¯Ÿï¼šAdamå¯¹æ¯ä¸ªåˆ†é‡ç‹¬ç«‹åœ°è¿›è¡Œç¼©æ”¾ï¼Œæ›´æ–°è§„åˆ™æ˜¯<strong>é€å…ƒç´ ï¼ˆelement-wiseï¼‰</strong>çš„ã€‚</p>
<h4 id="23">2.3 å‘çŸ©é˜µæ›´æ–°çš„èŒƒå¼è½¬å˜</h4>
<p><strong>é—®é¢˜</strong>ï¼šå½“å‚æ•°æ˜¯çŸ©é˜µ$\boldsymbol{W}\in\mathbb{R}^{n\times m}$æ—¶ï¼Œæœ‰ä¸¤ç§è§†è§’ï¼š</p>
<ol>
<li><strong>å‘é‡è§†è§’</strong>ï¼šå°†$\boldsymbol{W}$å±•å¹³ä¸º$nm$ç»´å‘é‡ï¼Œåº”ç”¨é€å…ƒç´ ä¼˜åŒ–å™¨</li>
<li><strong>çŸ©é˜µè§†è§’</strong>ï¼šå°†$\boldsymbol{W}$è§†ä¸ºçŸ©é˜µæµå½¢ä¸Šçš„ç‚¹ï¼Œåˆ©ç”¨çŸ©é˜µç»“æ„</li>
</ol>
<p><strong>å®šç†2.1ï¼ˆçŸ©é˜µç»“æ„çš„ä¿¡æ¯å®¹é‡ï¼‰</strong>ï¼šå¯¹äºç§©ä¸º$r$çš„çŸ©é˜µ$\boldsymbol{W}\in\mathbb{R}^{n\times m}$ï¼Œå…¶è‡ªç”±åº¦ä¸º$(n+m-r)r$ï¼Œè¿œå°äº$nm$ã€‚</p>
<p><strong>è¯æ˜</strong>ï¼šçŸ©é˜µçš„SVDå½¢å¼ä¸º$\boldsymbol{W}=\boldsymbol{U}<em _:_:r_="[:,:r]">{[:,:r]}\boldsymbol{\Sigma}_r\boldsymbol{V}</em>$ï¼Œå…¶ä¸­ï¼š
- $\boldsymbol{U}}^{\top<em _:_:r_="[:,:r]">{[:,:r]}$å æ®$nr - \frac{r(r-1)}{2}$ä¸ªè‡ªç”±åº¦ï¼ˆStiefelæµå½¢ï¼‰
- $\boldsymbol{\Sigma}_r$å æ®$r$ä¸ªè‡ªç”±åº¦ï¼ˆæ­£å¯¹è§’çŸ©é˜µï¼‰
- $\boldsymbol{V}</em>$ä¸ªè‡ªç”±åº¦}$å æ®$mr - \frac{r(r-1)}{2</p>
<p>æ€»è®¡ï¼š$nr + mr - r(r-1) + r = (n+m-r)r$ã€‚è¯æ¯•ã€‚</p>
<p>è¿™è¡¨æ˜çŸ©é˜µçš„å†…åœ¨ç»´åº¦å¯èƒ½è¿œä½äºå…¶è¡¨è§‚ç»´åº¦ï¼Œå› æ­¤åˆ©ç”¨çŸ©é˜µç»“æ„å¯ä»¥æ›´é«˜æ•ˆåœ°ä¼˜åŒ–ã€‚</p>
<h3 id="3">3. çŸ©é˜µç¬¦å·å‡½æ•°çš„æ·±å±‚æœºåˆ¶</h3>
<h4 id="31">3.1 ä»æ ‡é‡åˆ°çŸ©é˜µçš„å‡½æ•°æ¨å¹¿</h4>
<p>å¯¹äºæ ‡é‡å‡½æ•°$f:\mathbb{R}\to\mathbb{R}$ï¼Œå…¶çŸ©é˜µæ¨å¹¿$f:\mathbb{R}^{n\times n}\to\mathbb{R}^{n\times n}$å®šä¹‰ä¸ºï¼š</p>
<p>$$
f(\boldsymbol{A}) = \boldsymbol{Q}f(\boldsymbol{\Lambda})\boldsymbol{Q}^{\top}
$$</p>
<p>å…¶ä¸­$\boldsymbol{A}=\boldsymbol{Q}\boldsymbol{\Lambda}\boldsymbol{Q}^{\top}$æ˜¯ç‰¹å¾å€¼åˆ†è§£ï¼Œ$f(\boldsymbol{\Lambda})=\text{diag}(f(\lambda_1),\ldots,f(\lambda_n))$ã€‚</p>
<p>å¯¹äºéæ–¹é˜µï¼Œä½¿ç”¨SVDï¼š</p>
<p>$$
f(\boldsymbol{M}) = \boldsymbol{U}f(\boldsymbol{\Sigma})\boldsymbol{V}^{\top}
$$</p>
<p><strong>æ ‡é‡ç¬¦å·å‡½æ•°</strong>ï¼š$\text{sign}(x) = \begin{cases}1 &amp; x&gt;0 \ 0 &amp; x=0 \ -1 &amp; x&lt;0\end{cases}$</p>
<p><strong>çŸ©é˜µç¬¦å·å‡½æ•°</strong>ï¼š$\text{msign}(\boldsymbol{M}) = \boldsymbol{U}\text{sign}(\boldsymbol{\Sigma})\boldsymbol{V}^{\top}$</p>
<p>ä½†æ³¨æ„åˆ°$\boldsymbol{\Sigma}$çš„é›¶å¥‡å¼‚å€¼å¯¹åº”çš„å¥‡å¼‚å‘é‡æ˜¯ä¸ç¡®å®šçš„ï¼Œå› æ­¤å®šä¹‰ä¸ºï¼š</p>
<p>$$
\text{msign}(\boldsymbol{M}) = \boldsymbol{U}_{[:,:r]}\boldsymbol{I}_r\boldsymbol{V}_{[:,:r]}^{\top}
$$</p>
<h4 id="32">3.2 çŸ©é˜µç¬¦å·å‡½æ•°çš„å‡ ä½•æ„ä¹‰</h4>
<p><strong>å‘½é¢˜3.1ï¼ˆæœ€ä¼˜æ­£äº¤é€¼è¿‘ï¼‰</strong>ï¼šè®¾$\boldsymbol{M}\in\mathbb{R}^{n\times n}$æ»¡ç§©ï¼Œåˆ™ï¼š</p>
<p>$$
\text{msign}(\boldsymbol{M}) = \mathop{\arg\min}_{\boldsymbol{Q}^{\top}\boldsymbol{Q}=\boldsymbol{I}}\|\boldsymbol{M}-\boldsymbol{Q}\|_F^2
$$</p>
<p><strong>è¯æ˜</strong>ï¼šå±•å¼€ç›®æ ‡å‡½æ•°ï¼š</p>
<p>$$
\begin{aligned}
\|\boldsymbol{M}-\boldsymbol{Q}\|_F^2 &= \text{Tr}[(\boldsymbol{M}-\boldsymbol{Q})^{\top}(\boldsymbol{M}-\boldsymbol{Q})] \\
&= \text{Tr}(\boldsymbol{M}^{\top}\boldsymbol{M}) + \text{Tr}(\boldsymbol{Q}^{\top}\boldsymbol{Q}) - 2\text{Tr}(\boldsymbol{M}^{\top}\boldsymbol{Q}) \\
&= \|\boldsymbol{M}\|_F^2 + n - 2\text{Tr}(\boldsymbol{M}^{\top}\boldsymbol{Q})
\end{aligned}
$$</p>
<p>å› æ­¤æœ€å°åŒ–ç­‰ä»·äºæœ€å¤§åŒ–$\text{Tr}(\boldsymbol{M}^{\top}\boldsymbol{Q})$ã€‚è®¾$\boldsymbol{M}=\boldsymbol{U}\boldsymbol{\Sigma}\boldsymbol{V}^{\top}$ï¼Œåˆ™ï¼š</p>
<p>$$
\text{Tr}(\boldsymbol{M}^{\top}\boldsymbol{Q}) = \text{Tr}(\boldsymbol{V}\boldsymbol{\Sigma}\boldsymbol{U}^{\top}\boldsymbol{Q}) = \text{Tr}(\boldsymbol{\Sigma}\boldsymbol{U}^{\top}\boldsymbol{Q}\boldsymbol{V}) = \sum_{i=1}^n\sigma_i(\boldsymbol{U}^{\top}\boldsymbol{Q}\boldsymbol{V})_{ii}
$$</p>
<p>ç”±äº$\boldsymbol{U}^{\top}\boldsymbol{Q}\boldsymbol{V}$æ˜¯æ­£äº¤çŸ©é˜µï¼Œå…¶å…ƒç´ æ»¡è¶³$|(\boldsymbol{U}^{\top}\boldsymbol{Q}\boldsymbol{V})<em ii="ii">{ij}|\leq 1$ã€‚å½“$(\boldsymbol{U}^{\top}\boldsymbol{Q}\boldsymbol{V})</em>)$ã€‚è¯æ¯•ã€‚}=1$å¯¹æ‰€æœ‰$i$æˆç«‹æ—¶ï¼Œ$\boldsymbol{U}^{\top}\boldsymbol{Q}\boldsymbol{V}=\boldsymbol{I}$ï¼Œå³$\boldsymbol{Q}=\boldsymbol{U}\boldsymbol{V}^{\top}=\text{msign}(\boldsymbol{M</p>
<p><strong>å‡ ä½•è§£é‡Š</strong>ï¼š$\text{msign}(\boldsymbol{M})$æ˜¯ä¸$\boldsymbol{M}$æœ€æ¥è¿‘çš„æ­£äº¤çŸ©é˜µï¼Œè¿™ç±»ä¼¼äºå°†$\boldsymbol{M}$"æŠ•å½±"åˆ°æ­£äº¤ç¾¤$O(n)$ä¸Šã€‚</p>
<h4 id="33">3.3 è°±å½’ä¸€åŒ–æ€§è´¨</h4>
<p><strong>å‘½é¢˜3.2ï¼ˆè°±å½’ä¸€åŒ–ï¼‰</strong>ï¼š$\text{msign}(\boldsymbol{M})$çš„æ‰€æœ‰éé›¶å¥‡å¼‚å€¼å‡ä¸º1ï¼Œå³ï¼š</p>
<p>$$
\|\text{msign}(\boldsymbol{M})\|_2 = 1, \quad \text{rank}(\text{msign}(\boldsymbol{M})) = \text{rank}(\boldsymbol{M})
$$</p>
<p><strong>è¯æ˜</strong>ï¼šç”±å®šä¹‰$\text{msign}(\boldsymbol{M})=\boldsymbol{U}<em _:_:r_="[:,:r]">{[:,:r]}\boldsymbol{V}</em>$ï¼Œå…¶SVDå³ä¸ºå…¶è‡ªèº«ï¼Œå¥‡å¼‚å€¼å…¨ä¸º1ã€‚è¯æ¯•ã€‚}^{\top</p>
<p>è¿™è¯´æ˜$\text{msign}$æ“ä½œæ¶ˆé™¤äº†æ¢¯åº¦çš„å°ºåº¦ä¿¡æ¯ï¼Œåªä¿ç•™äº†æ–¹å‘ä¿¡æ¯ï¼Œè¿™ä¸Adamä¸­é™¤ä»¥$\sqrt{\boldsymbol{v}_t}$å½’ä¸€åŒ–æ¢¯åº¦å°ºåº¦çš„æ€æƒ³ä¸€è‡´ã€‚</p>
<h3 id="4">4. é¢„æ¡ä»¶å™¨çš„çŸ©é˜µå½¢å¼æ¨å¯¼</h3>
<h4 id="41">4.1 é¢„æ¡ä»¶æ¢¯åº¦ä¸‹é™</h4>
<p>ä¸€èˆ¬çš„é¢„æ¡ä»¶æ¢¯åº¦ä¸‹é™å½¢å¼ä¸ºï¼š</p>
<p>$$
\boldsymbol{\theta}_{t+1} = \boldsymbol{\theta}_t - \eta_t\boldsymbol{P}_t^{-1}\boldsymbol{g}_t
$$</p>
<p>å…¶ä¸­$\boldsymbol{P}_t\succ 0$æ˜¯é¢„æ¡ä»¶çŸ©é˜µã€‚é€‰æ‹©$\boldsymbol{P}_t$çš„ç›®æ ‡æ˜¯è¿‘ä¼¼HessiançŸ©é˜µ$\boldsymbol{H}_t = \nabla^2\mathcal{L}(\boldsymbol{\theta}_t)$ï¼Œä»è€ŒåŠ é€Ÿæ”¶æ•›ã€‚</p>
<h4 id="42-adam">4.2 Adamä½œä¸ºå¯¹è§’é¢„æ¡ä»¶å™¨</h4>
<p>Adamçš„æ›´æ–°å¯ä»¥å†™ä¸ºï¼š</p>
<p>$$
\boldsymbol{\theta}_{t+1} = \boldsymbol{\theta}_t - \eta_t\boldsymbol{D}_t^{-1}\boldsymbol{m}_t
$$</p>
<p>å…¶ä¸­$\boldsymbol{D}_t = \text{diag}(\sqrt{\boldsymbol{v}_t}+\epsilon)$ã€‚è¿™æ˜¯å¯¹è§’é¢„æ¡ä»¶å™¨ï¼Œå‡è®¾Hessianè¿‘ä¼¼å¯¹è§’ã€‚</p>
<h4 id="43-muon">4.3 Muonçš„çŸ©é˜µé¢„æ¡ä»¶å™¨</h4>
<p>å¯¹äºçŸ©é˜µå‚æ•°$\boldsymbol{W}\in\mathbb{R}^{n\times m}$ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘å·¦å³é¢„æ¡ä»¶ï¼š</p>
<p>$$
\boldsymbol{W}_{t+1} = \boldsymbol{W}_t - \eta_t\boldsymbol{L}_t^{-1}\boldsymbol{G}_t\boldsymbol{R}_t^{-1}
$$</p>
<p><strong>å®šç†4.1ï¼ˆMuonçš„éšå¼é¢„æ¡ä»¶å½¢å¼ï¼‰</strong>ï¼šMuonæ›´æ–°ç­‰ä»·äºé¢„æ¡ä»¶å™¨ï¼š</p>
<p>$$
\boldsymbol{L}_t = (\boldsymbol{M}_t\boldsymbol{M}_t^{\top})^{1/2}, \quad \boldsymbol{R}_t = (\boldsymbol{M}_t^{\top}\boldsymbol{M}_t)^{1/2}
$$</p>
<p><strong>è¯æ˜</strong>ï¼šç”±msignçš„å®šä¹‰ï¼š</p>
<p>$$
\begin{aligned}
\text{msign}(\boldsymbol{M}_t) &= (\boldsymbol{M}_t\boldsymbol{M}_t^{\top})^{-1/2}\boldsymbol{M}_t \\
&= \boldsymbol{M}_t(\boldsymbol{M}_t^{\top}\boldsymbol{M}_t)^{-1/2} \\
&= (\boldsymbol{M}_t\boldsymbol{M}_t^{\top})^{-1/2}\boldsymbol{M}_t(\boldsymbol{M}_t^{\top}\boldsymbol{M}_t)^{-1/2} \cdot (\boldsymbol{M}_t^{\top}\boldsymbol{M}_t)^{1/2} \\
&= \boldsymbol{L}_t^{-1}\boldsymbol{M}_t\boldsymbol{R}_t^{-1}
\end{aligned}
$$</p>
<p>è¿™ä¸Shampooçš„é¢„æ¡ä»¶å½¢å¼ä¸€è‡´ï¼ˆ$1/4$æ¬¡å¹‚ vs $1/2$æ¬¡å¹‚çš„å·®å¼‚ï¼‰ã€‚è¯æ¯•ã€‚</p>
<p><strong>ç‰©ç†æ„ä¹‰</strong>ï¼š$\boldsymbol{M}_t\boldsymbol{M}_t^{\top}$å’Œ$\boldsymbol{M}_t^{\top}\boldsymbol{M}_t$åˆ†åˆ«æ•æ‰äº†æ¢¯åº¦åœ¨è¡Œç©ºé—´å’Œåˆ—ç©ºé—´çš„äºŒé˜¶ç»Ÿè®¡ä¿¡æ¯ã€‚</p>
<h3 id="5-natural-gradient">5. ä¸Natural Gradientçš„è”ç³»</h3>
<h4 id="51-natural-gradient">5.1 Natural Gradientçš„å®šä¹‰</h4>
<p>åœ¨å‚æ•°ç©ºé—´$\Theta$ä¸Šå®šä¹‰Riemannianåº¦é‡ï¼ˆFisherä¿¡æ¯çŸ©é˜µï¼‰ï¼š</p>
<p>$$
\boldsymbol{F}(\boldsymbol{\theta}) = \mathbb{E}_{p(x|\boldsymbol{\theta})}[\nabla\log p(x|\boldsymbol{\theta})\nabla\log p(x|\boldsymbol{\theta})^{\top}]
$$</p>
<p>Natural Gradientå®šä¹‰ä¸ºï¼š</p>
<p>$$
\tilde{\boldsymbol{g}}_t = \boldsymbol{F}(\boldsymbol{\theta}_t)^{-1}\boldsymbol{g}_t
$$</p>
<p>æ›´æ–°è§„åˆ™ï¼š$\boldsymbol{\theta}_{t+1} = \boldsymbol{\theta}_t - \eta_t\tilde{\boldsymbol{g}}_t$</p>
<h4 id="52-fisher">5.2 çŸ©é˜µå‚æ•°çš„Fisherä¿¡æ¯</h4>
<p>å¯¹äºç¥ç»ç½‘ç»œå±‚$\boldsymbol{y}=\boldsymbol{W}\boldsymbol{x}$ï¼ŒFisherä¿¡æ¯çŸ©é˜µï¼ˆä½¿ç”¨Kroneckeråˆ†è§£è¿‘ä¼¼ï¼‰ï¼š</p>
<p>$$
\boldsymbol{F} \approx \mathbb{E}[\boldsymbol{x}\boldsymbol{x}^{\top}] \otimes \mathbb{E}[\boldsymbol{\delta}\boldsymbol{\delta}^{\top}]
$$</p>
<p>å…¶ä¸­$\boldsymbol{\delta}$æ˜¯ä»è¾“å‡ºåä¼ çš„æ¢¯åº¦ã€‚Natural Gradientæ›´æ–°ï¼š</p>
<p>$$
\Delta\boldsymbol{W} = -\eta(\mathbb{E}[\boldsymbol{\delta}\boldsymbol{\delta}^{\top}])^{-1}\boldsymbol{G}(\mathbb{E}[\boldsymbol{x}\boldsymbol{x}^{\top}])^{-1}
$$</p>
<p><strong>è¿æ¥åˆ°Muon</strong>ï¼šå½“æˆ‘ä»¬ç”¨æ¢¯åº¦çš„çŸ©é˜µä¹˜ç§¯$\boldsymbol{M}_t\boldsymbol{M}_t^{\top}$å’Œ$\boldsymbol{M}_t^{\top}\boldsymbol{M}_t$è¿‘ä¼¼è¿™äº›äºŒé˜¶çŸ©æ—¶ï¼ŒMuonæä¾›äº†ä¸€ç§å®ç”¨çš„Natural Gradientè¿‘ä¼¼ã€‚</p>
<p><strong>å‘½é¢˜5.1</strong>ï¼šåœ¨çº¿æ€§è¿‘ä¼¼ä¸‹ï¼ŒMuonçš„æ›´æ–°æ–¹å‘ä¸Natural Gradientæ–¹å‘çš„ç›¸å…³æ€§é«˜äºSGDã€‚</p>
<p>ï¼ˆå®Œæ•´è¯æ˜éœ€è¦å…·ä½“çš„åˆ†å¸ƒå‡è®¾ï¼Œæ­¤å¤„ç•¥ï¼‰</p>
<h3 id="6">6. é»æ›¼å‡ ä½•è§†è§’</h3>
<h4 id="61">6.1 çŸ©é˜µæµå½¢çš„åˆ‡ç©ºé—´</h4>
<p>è€ƒè™‘ç§©$r$çŸ©é˜µçš„æµå½¢ï¼š</p>
<p>$$
\mathcal{M}_r = \\{\boldsymbol{W}\in\mathbb{R}^{n\times m} : \text{rank}(\boldsymbol{W}) = r\\}
$$</p>
<p>è¿™æ˜¯ä¸€ä¸ª$(n+m-r)r$ç»´çš„åµŒå…¥å­æµå½¢ã€‚</p>
<p>åœ¨ç‚¹$\boldsymbol{W}\in\mathcal{M}_r$å¤„çš„åˆ‡ç©ºé—´ï¼š</p>
<p>$$
T_{\boldsymbol{W}}\mathcal{M}_r = \\{\boldsymbol{U}\boldsymbol{V}^{\top} + \boldsymbol{U}_{\perp}\boldsymbol{X}^{\top} + \boldsymbol{Y}\boldsymbol{V}_{\perp}^{\top} : \boldsymbol{X}\in\mathbb{R}^{r\times(m-r)}, \boldsymbol{Y}\in\mathbb{R}^{(n-r)\times r}\\}
$$</p>
<p>å…¶ä¸­$\boldsymbol{W}=\boldsymbol{U}\boldsymbol{\Sigma}\boldsymbol{V}^{\top}$ã€‚</p>
<h4 id="62-riemannian">6.2 Riemannianæ¢¯åº¦</h4>
<p>æ¬§å‡ é‡Œå¾—æ¢¯åº¦$\boldsymbol{G}$åˆ°Riemannianæ¢¯åº¦çš„æŠ•å½±ï¼š</p>
<p>$$
\text{grad}_{\mathcal{M}}\mathcal{L}(\boldsymbol{W}) = \text{Proj}_{T_{\boldsymbol{W}}\mathcal{M}}(\boldsymbol{G})
$$</p>
<p><strong>å®šç†6.1ï¼ˆmsignä½œä¸ºåˆ‡ç©ºé—´å½’ä¸€åŒ–ï¼‰</strong>ï¼š$\text{msign}(\boldsymbol{G})$å¯ä»¥è§†ä¸ºå°†æ¢¯åº¦æŠ•å½±åˆ°åˆ‡ç©ºé—´å¹¶å½’ä¸€åŒ–ã€‚</p>
<p><strong>è¯æ˜æ€è·¯</strong>ï¼šè®¾$\boldsymbol{W}=\boldsymbol{U}\boldsymbol{\Sigma}\boldsymbol{V}^{\top}$ï¼Œ$\boldsymbol{G}=\boldsymbol{U}\boldsymbol{G}<em _perp="\perp">U\boldsymbol{V}^{\top} + \boldsymbol{U}</em>}\boldsymbol{G<em _perp="\perp">{\perp}\boldsymbol{V}</em> + \cdots$}^{\top</p>
<p>$\text{msign}$æ“ä½œä¿ç•™$\boldsymbol{U},\boldsymbol{V}$ç©ºé—´çš„æˆåˆ†ï¼Œä¸¢å¼ƒå‚ç›´ç©ºé—´ï¼Œå¹¶å½’ä¸€åŒ–å¥‡å¼‚å€¼ã€‚</p>
<h4 id="63-retraction">6.3 æŒ‡æ•°æ˜ å°„ä¸retraction</h4>
<p>æµå½¢ä¸Šçš„æŒ‡æ•°æ˜ å°„$\exp_{\boldsymbol{W}}:\boldsymbol{T}_{\boldsymbol{W}}\mathcal{M}\to\mathcal{M}$å®šä¹‰ä¸ºï¼š</p>
<p>$$
\exp_{\boldsymbol{W}}(\boldsymbol{\xi}) = \boldsymbol{W} + \boldsymbol{\xi} + O(\|\boldsymbol{\xi}\|^2)
$$</p>
<p>Muonçš„æ›´æ–°å¯ä»¥è¿‘ä¼¼ä¸ºï¼š</p>
<p>$$
\boldsymbol{W}_{t+1} = \text{Retr}_{\boldsymbol{W}_t}(-\eta_t\text{msign}(\boldsymbol{M}_t))
$$</p>
<p>å…¶ä¸­retractionæ˜¯æŒ‡æ•°æ˜ å°„çš„ä¸€é˜¶è¿‘ä¼¼ã€‚</p>
<p><strong>å‡ ä½•ç›´è§‚</strong>ï¼šMuonåœ¨çŸ©é˜µæµå½¢ä¸Šæ²¿ç€å½’ä¸€åŒ–çš„åˆ‡å‘é‡ç§»åŠ¨ï¼Œè‡ªåŠ¨é€‚åº”æµå½¢çš„å¼¯æ›²ã€‚</p>
<h3 id="7">7. è°±è£å‰ªä¸æ¢¯åº¦è£å‰ªçš„å¯¹æ¯”</h3>
<h4 id="71">7.1 ä¼ ç»Ÿæ¢¯åº¦è£å‰ª</h4>
<p>$$
\boldsymbol{g}_t^{\text{clip}} = \begin{cases}
\boldsymbol{g}_t & \|\boldsymbol{g}_t\|_2 \leq c \\
c\frac{\boldsymbol{g}_t}{\|\boldsymbol{g}_t\|_2} & \|\boldsymbol{g}_t\|_2 > c
\end{cases}
$$</p>
<p>è¿™æ§åˆ¶äº†æ¢¯åº¦çš„$\ell_2$èŒƒæ•°ï¼Œä½†å¯¹äºçŸ©é˜µå‚æ•°ï¼Œå®ƒå°†çŸ©é˜µå±•å¹³å¤„ç†ã€‚</p>
<h4 id="72">7.2 è°±è£å‰ª</h4>
<p>å¯¹äºçŸ©é˜µ$\boldsymbol{G}$ï¼š</p>
<p>$$
\boldsymbol{G}^{\text{spectral-clip}} = \begin{cases}
\boldsymbol{G} & \|\boldsymbol{G}\|_2 \leq c \\
c\cdot\text{msign}(\boldsymbol{G}) & \|\boldsymbol{G}\|_2 > c
\end{cases}
$$</p>
<p>å…¶ä¸­$|\boldsymbol{G}|<em _max="\max">2 = \sigma</em>)$æ˜¯è°±èŒƒæ•°ï¼ˆæœ€å¤§å¥‡å¼‚å€¼ï¼‰ã€‚}(\boldsymbol{G</p>
<p><strong>å®šç†7.1ï¼ˆè°±è£å‰ªçš„ä¼˜åŠ¿ï¼‰</strong>ï¼šè°±è£å‰ª$|\cdot|_2$æ¯”FrobeniusèŒƒæ•°è£å‰ª$|\cdot|_F$æ›´ç´§ï¼š</p>
<p>$$
\|\boldsymbol{G}\|_2 \leq \|\boldsymbol{G}\|_F \leq \sqrt{r}\|\boldsymbol{G}\|_2
$$</p>
<p>å…¶ä¸­$r=\text{rank}(\boldsymbol{G})$ã€‚</p>
<p><strong>è¯æ˜</strong>ï¼š</p>
<p>$$
\|\boldsymbol{G}\|_F^2 = \sum_{i=1}^r\sigma_i^2 \geq \sigma_{\max}^2 = \|\boldsymbol{G}\|_2^2
$$</p>
<p>$$
\|\boldsymbol{G}\|_F^2 = \sum_{i=1}^r\sigma_i^2 \leq r\sigma_{\max}^2 = r\|\boldsymbol{G}\|_2^2
$$</p>
<p>è¯æ¯•ã€‚</p>
<p><strong>å®è·µæ„ä¹‰</strong>ï¼šè°±è£å‰ªé¿å…äº†å•ä¸ªå¤§å¥‡å¼‚å€¼æ”¯é…æ›´æ–°ï¼ŒMuoné€šè¿‡msignè‡ªç„¶å®ç°äº†è¿™ä¸€ç‚¹ã€‚</p>
<h4 id="73">7.3 å„å‘å¼‚æ€§åˆ†æ</h4>
<p>è€ƒè™‘çŸ©é˜µ$\boldsymbol{G}$çš„æ¡ä»¶æ•°ï¼š</p>
<p>$$
\kappa(\boldsymbol{G}) = \frac{\sigma_{\max}(\boldsymbol{G})}{\sigma_{\min}(\boldsymbol{G})}
$$</p>
<p><strong>å‘½é¢˜7.2</strong>ï¼šæ¢¯åº¦è£å‰ªä¿æŒæ¡ä»¶æ•°ä¸å˜ï¼Œè€Œmsignå°†æ¡ä»¶æ•°é™ä¸º1ã€‚</p>
<p><strong>è¯æ˜</strong>ï¼š
- æ¢¯åº¦è£å‰ªï¼š$\boldsymbol{G}^{\text{clip}} = c\boldsymbol{U}\frac{\boldsymbol{\Sigma}}{|\boldsymbol{\Sigma}|_F}\boldsymbol{V}^{\top}$ï¼Œå¥‡å¼‚å€¼ç­‰æ¯”ä¾‹ç¼©æ”¾ï¼Œ$\kappa$ä¸å˜
- msignï¼š$\text{msign}(\boldsymbol{G}) = \boldsymbol{U}\boldsymbol{I}\boldsymbol{V}^{\top}$ï¼Œæ‰€æœ‰å¥‡å¼‚å€¼ä¸º1ï¼Œ$\kappa=1$</p>
<p>è¯æ¯•ã€‚</p>
<p>è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆMuonåœ¨ç—…æ€é—®é¢˜ä¸Šè¡¨ç°æ›´å¥½ã€‚</p>
<h3 id="8">8. æ”¶æ•›æ€§åˆ†æ</h3>
<h4 id="81">8.1 å‡¸æƒ…å†µä¸‹çš„æ”¶æ•›æ€§</h4>
<p><strong>å®šç†8.1ï¼ˆå‡¸å‡½æ•°çš„æ”¶æ•›ç‡ï¼‰</strong>ï¼šå‡è®¾$\mathcal{L}:\mathbb{R}^{n\times m}\to\mathbb{R}$æ˜¯$L$-å…‰æ»‘å‡¸å‡½æ•°ï¼Œæ¢¯åº¦æœ‰ç•Œ$|\boldsymbol{G}_t|_F\leq G$ï¼Œå­¦ä¹ ç‡æ»¡è¶³$\eta_t = \frac{\eta}{\sqrt{T}}$ï¼Œåˆ™Muonï¼ˆ$\beta=0$ï¼‰æ»¡è¶³ï¼š</p>
<p>$$
\mathbb{E}[\mathcal{L}(\bar{\boldsymbol{W}}_T)] - \mathcal{L}(\boldsymbol{W}^*) = O\left(\frac{1}{\sqrt{T}}\right)
$$</p>
<p>å…¶ä¸­$\bar{\boldsymbol{W}}<em t="1">T = \frac{1}{T}\sum</em>_t$ã€‚}^T\boldsymbol{W</p>
<p><strong>è¯æ˜æ€è·¯</strong>ï¼š</p>
<p>è®¾$\boldsymbol{W}^*$æ˜¯æœ€ä¼˜è§£ã€‚åˆ©ç”¨å‡¸æ€§ï¼š</p>
<p>$$
\mathcal{L}(\boldsymbol{W}_t) - \mathcal{L}(\boldsymbol{W}^*) \leq \langle\boldsymbol{G}_t, \boldsymbol{W}_t - \boldsymbol{W}^*\rangle_F
$$</p>
<p>Muonæ›´æ–°ï¼š$\boldsymbol{W}_{t+1} = \boldsymbol{W}_t - \eta_t\text{msign}(\boldsymbol{G}_t)$</p>
<p>è®¡ç®—è·ç¦»å˜åŒ–ï¼š</p>
<p>$$
\begin{aligned}
\|\boldsymbol{W}_{t+1} - \boldsymbol{W}^*\|_F^2 &= \|\boldsymbol{W}_t - \boldsymbol{W}^* - \eta_t\text{msign}(\boldsymbol{G}_t)\|_F^2 \\
&= \|\boldsymbol{W}_t - \boldsymbol{W}^*\|_F^2 - 2\eta_t\langle\text{msign}(\boldsymbol{G}_t), \boldsymbol{W}_t - \boldsymbol{W}^*\rangle_F + \eta_t^2\|\text{msign}(\boldsymbol{G}_t)\|_F^2
\end{aligned}
$$</p>
<p>ç”±äº$|\text{msign}(\boldsymbol{G}_t)|_F^2 = r\leq \min(n,m)$ï¼Œä¸”ï¼š</p>
<p>$$
\langle\text{msign}(\boldsymbol{G}_t), \boldsymbol{G}_t\rangle_F = \text{Tr}[\text{msign}(\boldsymbol{G}_t)^{\top}\boldsymbol{G}_t] = \sum_{i=1}^r\sigma_i(\boldsymbol{G}_t) \geq \sigma_{\max}(\boldsymbol{G}_t)
$$</p>
<p>é€šè¿‡æ ‡å‡†çš„åœ¨çº¿å‡¸ä¼˜åŒ–åˆ†æï¼ˆç±»ä¼¼äºAdaGradçš„åˆ†æï¼‰ï¼Œå¯å¾—$O(1/\sqrt{T})$æ”¶æ•›ç‡ã€‚</p>
<p>ï¼ˆå®Œæ•´æŠ€æœ¯è¯æ˜éœ€è¦æ›´ç»†è‡´çš„ç•Œï¼Œæ­¤å¤„ç»™å‡ºä¸»è¦æ€è·¯ï¼‰</p>
<h4 id="82">8.2 éå‡¸æƒ…å†µï¼šä¸€é˜¶ç¨³å®šç‚¹</h4>
<p><strong>å®šç†8.2ï¼ˆéå‡¸æ”¶æ•›ï¼‰</strong>ï¼šå‡è®¾$\mathcal{L}$æ˜¯$L$-å…‰æ»‘éå‡¸å‡½æ•°ï¼Œæ¢¯åº¦æœ‰ç•Œï¼Œ$\eta_t = \eta$å¸¸æ•°ï¼Œåˆ™ï¼š</p>
<p>$$
\min_{t\in[T]}\mathbb{E}[\|\nabla\mathcal{L}(\boldsymbol{W}_t)\|_F^2] = O\left(\frac{1}{T}\right)
$$</p>
<p><strong>è¯æ˜æ€è·¯</strong>ï¼šä½¿ç”¨Descent Lemmaï¼š</p>
<p>$$
\mathcal{L}(\boldsymbol{W}_{t+1}) \leq \mathcal{L}(\boldsymbol{W}_t) + \langle\boldsymbol{G}_t, \boldsymbol{W}_{t+1} - \boldsymbol{W}_t\rangle_F + \frac{L}{2}\|\boldsymbol{W}_{t+1} - \boldsymbol{W}_t\|_F^2
$$</p>
<p>ä»£å…¥Muonæ›´æ–°ï¼š</p>
<p>$$
\begin{aligned}
\mathcal{L}(\boldsymbol{W}_{t+1}) &\leq \mathcal{L}(\boldsymbol{W}_t) - \eta\langle\boldsymbol{G}_t, \text{msign}(\boldsymbol{G}_t)\rangle_F + \frac{L\eta^2}{2}\|\text{msign}(\boldsymbol{G}_t)\|_F^2 \\
&\leq \mathcal{L}(\boldsymbol{W}_t) - \eta\|\boldsymbol{G}_t\|_* + \frac{L\eta^2 r}{2}
\end{aligned}
$$</p>
<p>å…¶ä¸­$|\boldsymbol{G}<em>t|</em>* = \sum_i\sigma_i(\boldsymbol{G}_t)$æ˜¯æ ¸èŒƒæ•°ã€‚å¯¹äºæ»¡ç§©çŸ©é˜µï¼š</p>
<p>$$
\|\boldsymbol{G}_t\|_* \geq \sqrt{r}\|\boldsymbol{G}_t\|_F
$$</p>
<p>å› æ­¤ï¼š</p>
<p>$$
\mathcal{L}(\boldsymbol{W}_{t+1}) \leq \mathcal{L}(\boldsymbol{W}_t) - \eta\sqrt{r}\|\boldsymbol{G}_t\|_F + \frac{L\eta^2 r}{2}
$$</p>
<p>æ±‚å’Œå¹¶å¹³å‡ï¼Œå¯å¾—å®šç†ç»“è®ºã€‚</p>
<h4 id="83-sgdadam">8.3 ä¸SGD/Adamçš„æ¯”è¾ƒ</h4>
<table>
<thead>
<tr>
<th>ä¼˜åŒ–å™¨</th>
<th>å‡¸æ”¶æ•›ç‡</th>
<th>éå‡¸æ”¶æ•›ç‡</th>
<th>å…³é”®é‡</th>
</tr>
</thead>
<tbody>
<tr>
<td>SGD</td>
<td>$O(1/\sqrt{T})$</td>
<td>$O(1/T)$</td>
<td>$|\boldsymbol{g}|_2$</td>
</tr>
<tr>
<td>Adam</td>
<td>$O(1/\sqrt{T})$</td>
<td>$O(1/T)$</td>
<td>$|\boldsymbol{g}|_2/\sqrt{\boldsymbol{v}}$</td>
</tr>
<tr>
<td>Muon</td>
<td>$O(1/\sqrt{T})$</td>
<td>$O(1/T)$</td>
<td>$|\boldsymbol{G}|_*$</td>
</tr>
</tbody>
</table>
<p>Muonä½¿ç”¨æ ¸èŒƒæ•°ï¼ˆå¥‡å¼‚å€¼å’Œï¼‰è€ŒéFrobeniusèŒƒæ•°ï¼Œåœ¨ä½ç§©æƒ…å†µä¸‹æ›´ä¼˜ã€‚</p>
<h3 id="9">9. è®¡ç®—å¤æ‚åº¦åˆ†æ</h3>
<h4 id="91-svd">9.1 ç›´æ¥SVDæ–¹æ³•</h4>
<p>å¯¹äº$\boldsymbol{M}\in\mathbb{R}^{n\times m}$ï¼ˆå‡è®¾$n\geq m$ï¼‰ï¼Œå®Œæ•´SVDçš„å¤æ‚åº¦ï¼š</p>
<p>$$
\mathcal{O}(nm^2) \text{ æ—¶é—´}, \quad \mathcal{O}(nm + m^2) \text{ ç©ºé—´}
$$</p>
<p>æ¯æ­¥æ›´æ–°éœ€è¦ä¸€æ¬¡SVDï¼Œè¿™åœ¨å¤§çŸ©é˜µæ—¶æ˜¯ç“¶é¢ˆã€‚</p>
<h4 id="92-newton-schulz">9.2 Newton-Schulzè¿­ä»£</h4>
<p>è¿­ä»£å…¬å¼ï¼ˆ$T$æ­¥ï¼‰ï¼š</p>
<p>$$
\boldsymbol{X}_{k+1} = a\boldsymbol{X}_k + b\boldsymbol{X}_k(\boldsymbol{X}_k^{\top}\boldsymbol{X}_k) + c\boldsymbol{X}_k(\boldsymbol{X}_k^{\top}\boldsymbol{X}_k)^2
$$</p>
<p><strong>æ¯æ­¥è¿­ä»£çš„è®¡ç®—é‡</strong>ï¼š
- $\boldsymbol{X}_k^{\top}\boldsymbol{X}_k$: $O(m^2n)$
- $(\boldsymbol{X}_k^{\top}\boldsymbol{X}_k)^2$: $O(m^3)$
- çŸ©é˜µä¹˜æ³•$\boldsymbol{X}_k(\cdots)$: $O(nm^2)$</p>
<p>æ€»è®¡ï¼š$O(T \cdot nm^2)$ï¼Œä½†å¸¸æ•°è¾ƒå¤§ï¼ˆçº¦ä¸º$5T$æ¬¡$nm^2$ä¹˜æ³•ï¼‰ã€‚</p>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(nm + m^2)$ï¼Œä¸åŸçŸ©é˜µç›¸åŒã€‚</p>
<h4 id="93-adam">9.3 ä¸Adamçš„å¯¹æ¯”</h4>
<p>Adamæ¯æ­¥ï¼š
- è®¡ç®—$\boldsymbol{v}<em t-1="t-1">t = \beta_2\boldsymbol{v}</em>_t^2$: $O(nm)$
- è®¡ç®—$\boldsymbol{G}_t/\sqrt{\boldsymbol{v}_t}$: $O(nm)$
- æ€»è®¡ï¼š$O(nm)$} + (1-\beta_2)\boldsymbol{G</p>
<p><strong>æ—¶é—´å€ç‡</strong>ï¼šMuonæ˜¯Adamçš„$O(Tm)$å€ï¼Œå¯¹äº$m=1024$ï¼Œ$T=5$ï¼Œçº¦ä¸º$5000$å€ç†è®ºå¤æ‚åº¦ã€‚</p>
<p><strong>ä½†å®é™…åŠ é€Ÿ</strong>ï¼š
1. <strong>å¹¶è¡ŒåŒ–</strong>ï¼šNewton-Schulzè¿­ä»£çš„çŸ©é˜µä¹˜æ³•é«˜åº¦å¹¶è¡Œï¼ŒGPUåˆ©ç”¨ç‡é«˜
2. <strong>æµæ°´çº¿</strong>ï¼šåœ¨åå‘ä¼ æ’­æœŸé—´GPUç©ºé—²ï¼Œå¯å¼‚æ­¥è®¡ç®—msign
3. <strong>å†…å­˜å¸¦å®½</strong>ï¼šçŸ©é˜µä¹˜æ³•æ˜¯è®¡ç®—å¯†é›†å‹ï¼ˆcompute-boundï¼‰ï¼Œè€ŒAdamæ˜¯å†…å­˜å¸¦å®½å¯†é›†å‹ï¼ˆmemory-boundï¼‰</p>
<p><strong>å®æµ‹ç»“æœ</strong>ï¼šMuonä»…å¢åŠ 2-5%çš„wall-clockæ—¶é—´ã€‚</p>
<h4 id="94">9.4 å†…å­˜ä¼˜åŠ¿</h4>
<table>
<thead>
<tr>
<th>ä¼˜åŒ–å™¨</th>
<th>çŠ¶æ€å˜é‡</th>
<th>ç©ºé—´å¤æ‚åº¦</th>
</tr>
</thead>
<tbody>
<tr>
<td>Adam</td>
<td>$\boldsymbol{m}_t, \boldsymbol{v}_t$</td>
<td>$2nm$</td>
</tr>
<tr>
<td>Muon</td>
<td>$\boldsymbol{M}_t$</td>
<td>$nm$</td>
</tr>
<tr>
<td>AdamW</td>
<td>$\boldsymbol{m}_t, \boldsymbol{v}_t$</td>
<td>$2nm$</td>
</tr>
</tbody>
</table>
<p>MuonèŠ‚çœ50%çš„ä¼˜åŒ–å™¨çŠ¶æ€å†…å­˜ï¼Œè¿™åœ¨è®­ç»ƒå¤§æ¨¡å‹æ—¶å¾ˆé‡è¦ã€‚</p>
<h3 id="10-transformer">10. Transformerè®­ç»ƒä¸­çš„å®éªŒç»“æœè§£é‡Š</h3>
<h4 id="101">10.1 è®­ç»ƒåŠ¨æ€åˆ†æ</h4>
<p>åœ¨Transformerè®­ç»ƒä¸­è§‚å¯Ÿåˆ°çš„ç°è±¡ï¼š</p>
<p><strong>ç°è±¡1</strong>ï¼šMuonåœ¨è®­ç»ƒæ—©æœŸæ”¶æ•›æ›´å¿«</p>
<p><strong>è§£é‡Š</strong>ï¼šæ—©æœŸæ¢¯åº¦å„å‘å¼‚æ€§å¼ºï¼ˆæ¡ä»¶æ•°å¤§ï¼‰ï¼ŒMuonçš„è°±å½’ä¸€åŒ–æ¶ˆé™¤äº†è¿™ç§å„å‘å¼‚æ€§ï¼Œä½¿å¾—æ‰€æœ‰æ–¹å‘çš„å­¦ä¹ é€Ÿç‡å‡è¡¡ã€‚</p>
<p>æ•°å­¦ä¸Šï¼Œè®°$\kappa_t = \frac{\sigma_{\max}(\boldsymbol{G}<em _min="\min">t)}{\sigma</em>$ï¼š}(\boldsymbol{G}_t)</p>
<p>$$
\text{Effective learning rate range (Adam)}: \left[\frac{\eta}{\sqrt{v_{\max}}}, \frac{\eta}{\sqrt{v_{\min}}}\right]
$$</p>
<p>$$
\text{Effective learning rate (Muon)}: \eta \quad (\text{all directions})
$$</p>
<p><strong>ç°è±¡2</strong>ï¼šMuonå¯¹å­¦ä¹ ç‡çš„é²æ£’æ€§æ›´å¼º</p>
<p><strong>è§£é‡Š</strong>ï¼šç”±äºmsignå½’ä¸€åŒ–ï¼Œæ›´æ–°é‡çš„å°ºåº¦ç”±$\eta$ç›´æ¥æ§åˆ¶ï¼Œè€Œä¸ä¾èµ–äºæ¢¯åº¦å°ºåº¦ã€‚</p>
<p>Adamçš„æ›´æ–°å°ºåº¦ï¼š$\propto \eta \cdot \frac{|\boldsymbol{m}_t|}{\sqrt{\boldsymbol{v}_t}}$ï¼Œä¾èµ–äºæ¢¯åº¦ç»Ÿè®¡ã€‚</p>
<h4 id="102">10.2 æ³¨æ„åŠ›çŸ©é˜µçš„ä¼˜åŒ–</h4>
<p>å¯¹äºæ³¨æ„åŠ›å±‚çš„$\boldsymbol{W}_Q, \boldsymbol{W}_K, \boldsymbol{W}_V\in\mathbb{R}^{d\times d}$ï¼š</p>
<p><strong>è§‚å¯Ÿ</strong>ï¼šè¿™äº›çŸ©é˜µçš„æ¢¯åº¦é€šå¸¸æ˜¯ä½ç§©çš„ã€‚</p>
<p><strong>å®šç†10.1ï¼ˆä½ç§©æ¢¯åº¦çš„ä¼˜åŒ–ï¼‰</strong>ï¼šå½“$\text{rank}(\boldsymbol{G}_t) = r \ll d$æ—¶ï¼ŒMuonçš„æœ‰æ•ˆè‡ªç”±åº¦ä¸º$O(rd)$ï¼Œè€ŒAdamä¸º$O(d^2)$ã€‚</p>
<p><strong>è¯æ˜</strong>ï¼šMuoné€šè¿‡msignå°†æ›´æ–°æŠ•å½±åˆ°ç§©$r$å­ç©ºé—´ï¼Œåªåœ¨$r$ä¸ªå¥‡å¼‚æ–¹å‘ä¸Šæ›´æ–°ï¼Œæ¯ä¸ªæ–¹å‘æ˜¯$d$ç»´å‘é‡ï¼Œæ•…æ€»è‡ªç”±åº¦$O(rd)$ã€‚</p>
<p>Adamå¯¹æ‰€æœ‰$d^2$ä¸ªå‚æ•°ç‹¬ç«‹æ›´æ–°ã€‚</p>
<p><strong>ç»“æœ</strong>ï¼šåœ¨ä½ç§©æ¢¯åº¦æƒ…å†µä¸‹ï¼ŒMuonæ›´é«˜æ•ˆã€‚</p>
<h4 id="103">10.3 å±‚å½’ä¸€åŒ–çš„ç›¸äº’ä½œç”¨</h4>
<p>LayerNormä¹‹åçš„çŸ©é˜µæ¢¯åº¦å…·æœ‰ç‰¹æ®Šç»“æ„ï¼š</p>
<p>$$
\boldsymbol{G}_t = \boldsymbol{G}_t^{\text{raw}} - \frac{1}{d}\text{Tr}(\boldsymbol{G}_t^{\text{raw}})\boldsymbol{I} - \frac{1}{d}\boldsymbol{W}_t\boldsymbol{W}_t^{\top}\boldsymbol{G}_t^{\text{raw}}
$$</p>
<p>è¿™å¯¼è‡´æ¢¯åº¦åœ¨æŸäº›æ–¹å‘ä¸Šè¢«æŠ‘åˆ¶ã€‚</p>
<p><strong>å‘½é¢˜10.2</strong>ï¼šMuonçš„msignæ“ä½œä¸LayerNormçš„æ¢¯åº¦ä¿®æ­£è‡ªç„¶å…¼å®¹ï¼Œä¸éœ€è¦é¢å¤–è°ƒæ•´ã€‚</p>
<p>ï¼ˆè¯æ˜ç•¥ï¼Œæ¶‰åŠå¯¹ç§°æ€§åˆ†æï¼‰</p>
<h4 id="104">10.4 æ•°å€¼ç¨³å®šæ€§</h4>
<p><strong>è§‚å¯Ÿ</strong>ï¼šMuonåœ¨é•¿åºåˆ—è®­ç»ƒä¸­æ•°å€¼æ›´ç¨³å®šã€‚</p>
<p><strong>è§£é‡Š</strong>ï¼šè°±èŒƒæ•°å½’ä¸€åŒ–é˜²æ­¢äº†æ¢¯åº¦çˆ†ç‚¸ã€‚è®¾ï¼š</p>
<p>$$
\|\boldsymbol{W}_{t+1} - \boldsymbol{W}_t\|_2 = \eta\|\text{msign}(\boldsymbol{M}_t)\|_2 = \eta
$$</p>
<p>æ›´æ–°çš„è°±èŒƒæ•°ä¸¥æ ¼å—æ§äºå­¦ä¹ ç‡ï¼Œè€ŒAdamä¸­ï¼š</p>
<p>$$
\|\boldsymbol{W}_{t+1} - \boldsymbol{W}_t\|_2 \leq \eta\frac{\|\boldsymbol{m}_t\|_2}{\sqrt{v_{\min}}}
$$</p>
<p>å½“$v_{\min}$å¾ˆå°æ—¶ï¼Œæ›´æ–°å¯èƒ½å¾ˆå¤§ã€‚</p>
<h4 id="105">10.5 å®éªŒæ•°æ®çš„ç†è®ºè§£é‡Š</h4>
<p>å‡è®¾åœ¨æŸä¸ªTransformerè®­ç»ƒå®éªŒä¸­è§‚å¯Ÿåˆ°ï¼š</p>
<ul>
<li><strong>Muon</strong>åœ¨10kæ­¥è¾¾åˆ°loss=2.5</li>
<li><strong>AdamW</strong>åœ¨15kæ­¥è¾¾åˆ°loss=2.5</li>
</ul>
<p><strong>ç†è®ºè§£é‡Š</strong>ï¼š</p>
<p>è®¾æ¯æ­¥çš„"æœ‰æ•ˆè¿›å±•"ä¸º$\Delta_{\text{eff}}$ï¼Œåˆ™ï¼š</p>
<p>$$
\Delta_{\text{eff}}^{\text{Muon}} \propto \eta\|\boldsymbol{G}\|_*, \quad \Delta_{\text{eff}}^{\text{Adam}} \propto \eta\|\boldsymbol{G}\|_F/\sqrt{\mathbb{E}[\boldsymbol{G}^2]}
$$</p>
<p>å½“æ¢¯åº¦çŸ©é˜µä½ç§©æ—¶ï¼Œ$|\boldsymbol{G}|_* / |\boldsymbol{G}|_F \approx \sqrt{r/d}$ï¼ŒMuonæ¯æ­¥è¿›å±•æ›´å¤§ã€‚</p>
<p><strong>å®šé‡ä¼°è®¡</strong>ï¼šå¦‚æœå¹³å‡ç§©$r\approx d/3$ï¼Œåˆ™Muonæ¯æ­¥çº¦$\sqrt{3}\approx 1.7$å€æ•ˆç‡ï¼Œ$15k/1.7\approx 8.8k$æ­¥ï¼Œè€ƒè™‘å…¶ä»–å› ç´ ï¼Œ10kæ­¥åˆç†ã€‚</p>
<h3 id="_11">æ€»ç»“</h3>
<p>é€šè¿‡ä»¥ä¸Šè¯¦ç»†çš„æ•°å­¦æ¨å¯¼ï¼Œæˆ‘ä»¬æ·±å…¥ç†è§£äº†Muonä¼˜åŒ–å™¨çš„å¤šä¸ªæ–¹é¢ï¼š</p>
<ol>
<li><strong>çŸ©é˜µç¬¦å·å‡½æ•°</strong>ä½œä¸ºå‘é‡ç¬¦å·å‡½æ•°çš„è‡ªç„¶æ¨å¹¿ï¼Œå®ç°äº†è°±å½’ä¸€åŒ–</li>
<li><strong>é¢„æ¡ä»¶å™¨å½¢å¼</strong>æ­ç¤ºäº†ä¸äºŒé˜¶æ–¹æ³•çš„è”ç³»</li>
<li><strong>é»æ›¼å‡ ä½•è§†è§’</strong>é˜æ˜äº†åœ¨çŸ©é˜µæµå½¢ä¸Šçš„ä¼˜åŒ–æœ¬è´¨</li>
<li><strong>æ”¶æ•›æ€§åˆ†æ</strong>å»ºç«‹äº†ç†è®ºä¿è¯</li>
<li><strong>è®¡ç®—å¤æ‚åº¦</strong>åˆ†æäº†å®ç”¨æ€§</li>
<li><strong>å®éªŒç°è±¡</strong>å¾—åˆ°äº†ç†è®ºè§£é‡Š</li>
</ol>
<p>Muonä»£è¡¨äº†ä»å‘é‡åˆ°çŸ©é˜µçš„èŒƒå¼è½¬å˜ï¼Œå……åˆ†åˆ©ç”¨äº†çŸ©é˜µå‚æ•°çš„ç»“æ„ä¿¡æ¯ï¼Œåœ¨ç†è®ºå’Œå®è·µä¸Šéƒ½æœ‰é‡è¦ä»·å€¼ã€‚</p>
        </div>
    </div>
</body>
</html>