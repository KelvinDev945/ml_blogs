<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ»‘åŠ¨å¹³å‡è§†è§’ä¸‹çš„æƒé‡è¡°å‡å’Œå­¦ä¹ ç‡</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>æ»‘åŠ¨å¹³å‡è§†è§’ä¸‹çš„æƒé‡è¡°å‡å’Œå­¦ä¹ ç‡</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2026-01-08 | ğŸ“„ å¤§å°: 52.7 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/11459">https://spaces.ac.cn/archives/11459</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>æƒé‡è¡°å‡ï¼ˆWeight Decayï¼‰å’Œå­¦ä¹ ç‡ï¼ˆLearning Rateï¼‰æ˜¯LLMé¢„è®­ç»ƒçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒä»¬çš„è®¾ç½®æ˜¯å¦å¦¥å½“ï¼Œæ˜¯æ¨¡å‹æœ€ç»ˆæˆè´¥çš„å…³é”®å› ç´ ä¹‹ä¸€ã€‚è‡ª<a href="https://papers.cool/arxiv/1711.05101">AdamW</a>ä»¥æ¥ï¼Œå•ç‹¬åˆ†ç¦»å‡ºWeight Decayæ¥å–ä»£ä¼ ç»Ÿçš„L2æ­£åˆ™ï¼ŒåŸºæœ¬ä¸Šå·²ç»æˆä¸ºäº†å…±è¯†ï¼Œä½†åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¦‚ä½•åˆç†åœ°è®¾ç½®Weight Decayå’ŒLearning Rateï¼Œå¹¶æ²¡æœ‰æ˜¾è‘—çš„ç†è®ºè¿›å±•ã€‚</p>
<p>æœ¬æ–‡å°†æŠ›ç –å¼•ç‰ï¼Œåˆ†äº«ç¬”è€…å…³äºè¿™ä¸ªé—®é¢˜çš„ä¸€äº›æ–°ç†è§£ï¼šæŠŠè®­ç»ƒè¿‡ç¨‹çœ‹ä½œå¯¹è®­ç»ƒæ•°æ®çš„æ»‘åŠ¨å¹³å‡è®°å¿†ï¼Œæ¢è®¨å¦‚ä½•è®¾ç½®Weight Decayå’ŒLearning Rateæ‰èƒ½è®©è¿™ä¸ªè®°å¿†æ›´ä¸ºç§‘å­¦ã€‚</p>
<h2 id="_1">æ»‘åŠ¨å¹³å‡</h2>
<p>Weight Decayçš„ä¸€èˆ¬å½¢å¼æ˜¯<br />
\begin{equation}\boldsymbol{\theta}<em t-1="t-1">t = \boldsymbol{\theta}</em>} - \eta_t (\boldsymbol{u<em t-1="t-1">t + \lambda_t \boldsymbol{\theta}</em>})\end{equation<br />
å…¶ä¸­$\boldsymbol{\theta}$æ˜¯å‚æ•°ï¼Œ$\boldsymbol{u}$æ˜¯ä¼˜åŒ–å™¨ç»™å‡ºçš„æ›´æ–°é‡ï¼Œ$\lambda_t,\eta_t$äº¦å³æˆ‘ä»¬è¯´çš„Weight Decayå’ŒLearning Rateï¼Œè€Œæ•´ä¸ªåºåˆ—$\{\lambda_t\}$å’Œ$\{\eta_t\}$ï¼Œæˆ‘ä»¬åˆ†åˆ«ç§°ä¸ºâ€œWD Scheduleâ€å’Œâ€œLR Scheduleâ€ã€‚å¼•å…¥è®°å·<br />
\begin{equation}\begin{aligned}<br />
\boldsymbol{m}<em t-1="t-1">t =&amp;\, \beta_1 \boldsymbol{m}</em>} + \left(1 - \beta_1\right) \boldsymbol{g<em t-1="t-1">t, &amp; \hat{\boldsymbol{m}}_t =&amp;\, \boldsymbol{m}_t\left/\left(1 - \beta_1^t\right)\right. &amp;\\\[5pt]<br />
\boldsymbol{v}_t =&amp;\, \beta_2 \boldsymbol{v}</em>_t\left/\left(1 - \beta_2^t\right)\right. &amp;} + \left(1 - \beta_2\right) \boldsymbol{g}_t^2,&amp; \hat{\boldsymbol{v}}_t =&amp;\, \boldsymbol{v<br />
\end{aligned}\end{equation}<br />
é‚£ä¹ˆå¯¹äºSGDMæ¥è¯´æœ‰$\boldsymbol{u}_t=\boldsymbol{m}_t$ï¼Œå¯¹äºRMSPropæ¥è¯´$\boldsymbol{u}_t= \boldsymbol{g}_t/(\sqrt{\boldsymbol{v}_t} + \epsilon)$ï¼Œå¯¹äºAdamæ¥è¯´åˆ™æ˜¯$\boldsymbol{u}_t=\hat{\boldsymbol{m}}_t\left/\left(\sqrt{\hat{\boldsymbol{v}}_t} + \epsilon\right)\right.$ï¼Œå¯¹äºSignSGDMæ¥è¯´åˆ™$\newcommand{sign}{\mathop{\text{sign}}}\boldsymbol{u}_t=\sign(\boldsymbol{m}_t)$ï¼Œè€ŒMuonåˆ™æ˜¯$\newcommand{msign}{\mathop{\text{msign}}}\boldsymbol{u}_t=\msign(\boldsymbol{m}_t)$ã€‚è¿™é‡Œåˆ—ä¸¾çš„ä¾‹å­ï¼Œé™¤äº†SGDMå¤–ï¼Œå…¶ä»–éƒ½ç®—æ˜¯æŸç§è‡ªé€‚åº”å­¦ä¹ ç‡ä¼˜åŒ–å™¨ã€‚</p>
<p>æˆ‘ä»¬çš„å‡ºå‘ç‚¹æ˜¯æ»‘åŠ¨å¹³å‡ï¼ˆExponential Moving Averageï¼ŒEMAï¼‰è§†è§’ï¼Œå³å°†Weight Decayå†™æˆ<br />
\begin{equation}\boldsymbol{\theta}<em t-1="t-1">t = (1 - \lambda_t \eta_t)\boldsymbol{\theta}</em>} - \eta_t \boldsymbol{u<em t-1="t-1">t = (1 - \lambda_t \eta_t)\boldsymbol{\theta}</em>} + \lambda_t \eta_t ( -\boldsymbol{u}_t / \lambda_t)\label{eq:wd-ema}\end{equation<br />
æ­¤æ—¶Weight Decayè¡¨ç°ä¸ºæ¨¡å‹å‚æ•°ä¸$-\boldsymbol{u}_t / \lambda_t$çš„åŠ æƒå¹³å‡å½¢å¼ã€‚æ»‘åŠ¨å¹³å‡è§†è§’ä¸æ˜¯æ–°çš„ï¼Œ<a href="https://papers.cool/arxiv/2405.13698">ã€ŠHow to set AdamW's weight decay as you scale model and dataset sizeã€‹</a>ã€<a href="https://papers.cool/arxiv/2505.13738">ã€ŠPower Lines: Scaling Laws for Weight Decay and Batch Size in LLM Pre-trainingã€‹</a>ç­‰æ–‡ç« å·²æœ‰è¿‡è®¨è®ºï¼Œæœ¬æ–‡åˆ™æ˜¯åœ¨è¿™ä¸ªè§†è§’ä¸‹å°†å„æ–¹é¢ç®—å¾—æ›´ä»”ç»†ä¸€äº›ã€‚</p>
<p>æ¥ä¸‹æ¥çš„ç¯‡å¹…æˆ‘ä»¬ä¸»è¦ä»¥Adamä¸ºä¾‹ï¼Œæœ€åå†è®¨è®ºå…¶ä»–ä¼˜åŒ–å™¨çš„å¯ç”¨æ€§ã€‚è®¡ç®—è¿‡ç¨‹è·Ÿ<a href="/archives/11307">ã€ŠAdamWçš„Weight RMSçš„æ¸è¿‘ä¼°è®¡ï¼ˆä¸Šï¼‰ã€‹</a>å’Œ<a href="/archives/11404">ã€ŠAdamWçš„Weight RMSçš„æ¸è¿‘ä¼°è®¡ï¼ˆä¸‹ï¼‰ã€‹</a>ä¼šæœ‰ç›¸å½“ä¸€éƒ¨ä»½é‡å ä¹‹å¤„ï¼Œè¯»è€…å¯ä»¥ç›¸äº’å‚è€ƒç€é˜…è¯»ã€‚</p>
<h2 id="_2">è¿­ä»£å±•å¼€</h2>
<p>ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å…ˆè€ƒè™‘å¸¸æ•°$\lambda,\eta$ï¼Œè®°$\beta_3 = 1 - \lambda\eta$ï¼Œé‚£ä¹ˆ$\boldsymbol{\theta}<em t-1="t-1">t = \beta_3 \boldsymbol{\theta}</em>} + (1 - \beta_3)( -\boldsymbol{u<em i="1">t / \lambda)$ï¼Œè¿™æ ·å½¢å¼ä¸Šå°±è·Ÿ$\boldsymbol{m}_t,\boldsymbol{v}_t$ä¸€è‡´äº†ã€‚ç›´æ¥è¿­ä»£å±•å¼€å¾—<br />
\begin{equation}\boldsymbol{\theta}_t = \beta_3^t \boldsymbol{\theta}_0 + (1 - \beta_3)\sum</em>}^t \beta_3^{t-i} (-\boldsymbol{u<em i="1">i / \lambda) \end{equation}<br />
å¯¹äºAdamæœ‰$\boldsymbol{u}_t=\hat{\boldsymbol{m}}_t\left/\left(\sqrt{\hat{\boldsymbol{v}}_t} + \epsilon\right)\right.$ï¼Œä¸€èˆ¬åœ¨è®­ç»ƒç»“æŸæ—¶ï¼Œ$t$éƒ½èƒ½è¶³å¤Ÿå¤§ä»¥è‡³äº$\beta_1^t,\beta_2^t$è¶³å¤Ÿæ¥è¿‘äºé›¶ï¼Œæ‰€ä»¥å¯ä»¥ä¸å»åŒºåˆ†$\boldsymbol{m}_t$å’Œ$\hat{\boldsymbol{m}}_t$ã€$\boldsymbol{v}_t$å’Œ$\hat{\boldsymbol{v}}_t$ï¼Œè¿›ä¸€æ­¥åœ°ï¼Œç®€å•è®¾$\epsilon=0$ï¼Œé‚£ä¹ˆå¯ä»¥ç®€åŒ–æˆ$\boldsymbol{u}_t=\boldsymbol{m}_t / \sqrt{\boldsymbol{v}_t}$ï¼Œç„¶åæ¥ä¸ªç»å…¸çš„å¹³å‡åœºè¿‘ä¼¼<br />
\begin{equation}\underbrace{\frac{1-\beta_3}{1-\beta_3^t}\sum</em>}^t \beta_3^{t-i} \boldsymbol{u<em _text_è®°ä¸º="\text{è®°ä¸º">i}</em>}\bar{\boldsymbol{u}<em i="1">t} = \frac{1-\beta_3}{1-\beta_3^t}\sum</em>}^t \beta_3^{t-i} \frac{\boldsymbol{m<em i="1">i}{\sqrt{\boldsymbol{v}_i}}\approx \frac{\bar{\boldsymbol{m}}_t \,\,\triangleq\,\, \frac{1-\beta_3}{1-\beta_3^t}\sum</em>}^t \beta_3^{t-i}\boldsymbol{m<em i="1">i}{\sqrt{\bar{\boldsymbol{v}}_t \,\,\triangleq\,\, \frac{1-\beta_3}{1-\beta_3^t}\sum</em>}^t \beta_3^{t-i}\boldsymbol{v<em i="1">i}}\label{eq:u-bar}\end{equation}<br />
å±•å¼€$\boldsymbol{m}_t,\boldsymbol{v}_t$å¾—$\boldsymbol{m}_t = (1 - \beta_1)\sum</em>}^t \beta_1^{t-i}\boldsymbol{g<em i="1">i$å’Œ$\boldsymbol{v}_t = (1 - \beta_2)\sum</em>}^t \beta_2^{t-i}\boldsymbol{g<em i="1">i^2$ï¼Œä»£å…¥ä¸Šå¼<br />
\begin{gather}<br />
\bar{\boldsymbol{m}}_t = \frac{(1-\beta_3)(1 - \beta_1)}{1-\beta_3^t}\sum</em>}^t \beta_3^{t-i} \sum_{j=1}^i \beta_1^{i-j}\boldsymbol{g<em j="1">j = \frac{(1-\beta_3)(1 - \beta_1)}{(1-\beta_3^t)(\beta_3 - \beta_1)}\sum</em>}^t (\beta_3^{t-j+1} - \beta_1^{t-j+1})\boldsymbol{g<em i="1">j\\\[6pt]<br />
\bar{\boldsymbol{v}}_t = \frac{(1-\beta_3)(1 - \beta_2)}{1-\beta_3^t}\sum</em>}^t \beta_3^{t-i} \sum_{j=1}^i \beta_2^{i-j}\boldsymbol{g<em j="1">j^2 = \frac{(1-\beta_3)(1 - \beta_2)}{(1-\beta_3^t)(\beta_3 - \beta_2)}\sum</em>}^t (\beta_3^{t-j+1} - \beta_2^{t-j+1})\boldsymbol{g<em i="1">j^2<br />
\end{gather}<br />
äº¤æ¢æ±‚å’Œç¬¦å·åŸºäºæ’ç­‰å¼$\sum</em>^t a_i b_j$ã€‚ç»¼ä¸Šï¼Œæˆ‘ä»¬æœ‰}^t \sum_{j=1}^i a_i b_j = \sum_{j=1}^t \sum_{i=j<br />
\begin{equation}\boldsymbol{\theta}_t = \beta_3^t \boldsymbol{\theta}_0 + (1 - \beta_3^t)(-\bar{\boldsymbol{u}}_t / \lambda) \label{eq:theta-0-bar-u}\end{equation}<br />
æƒé‡$\boldsymbol{\theta}_t$æ˜¯æˆ‘ä»¬æƒ³è¦çš„è®­ç»ƒç»“æœï¼Œå®ƒè¢«è¡¨ç¤ºä¸º$\boldsymbol{\theta}_0$å’Œ$-\bar{\boldsymbol{u}}_t / \lambda$çš„åŠ æƒå¹³å‡ã€‚å…¶ä¸­ï¼Œ$\boldsymbol{\theta}_0$æ˜¯åˆå§‹æƒé‡ï¼Œ$\bar{\boldsymbol{u}}_t$åˆ™æ˜¯æ•°æ®ç›¸å…³çš„ï¼Œåœ¨å¹³å‡åœºè¿‘ä¼¼ä¸‹å®ƒçº¦ç­‰äº$\bar{\boldsymbol{m}}_t/\sqrt{\bar{\boldsymbol{v}}_t}$ï¼Œè€Œ$\bar{\boldsymbol{m}}_t$å’Œ$\bar{\boldsymbol{v}}_t$å¯ä»¥è¡¨ç¤ºæˆæ¯ä¸€æ­¥æ¢¯åº¦çš„åŠ æƒæ±‚å’Œï¼Œä»¥$\bar{\boldsymbol{m}}_t$ä¸ºä¾‹ï¼Œç¬¬$j$æ­¥çš„æ¢¯åº¦æƒé‡æ­£æ¯”äº$\beta_3^{t-j+1} - \beta_1^{t-j+1}$ã€‚</p>
<h2 id="_3">è®°å¿†å‘¨æœŸ</h2>
<p>æˆ‘ä»¬ä¸»è¦å…³å¿ƒçš„æ˜¯é¢„è®­ç»ƒï¼Œç‰¹ç‚¹æ˜¯Single-Epochï¼Œå¤§éƒ¨åˆ†æ•°æ®éƒ½åªè¿‡ä¸€éï¼Œæ‰€ä»¥è®­å‡ºå¥½æ•ˆæœçš„å…³é”®ä¹‹ä¸€æ˜¯ä¸è¦å¿˜æ‰æ—©æœŸçš„æ•°æ®ã€‚å‡è®¾è®­ç»ƒæ•°æ®å·²ç»ç»è¿‡å…¨å±€æ‰“ä¹±ï¼Œé‚£ä¹ˆå¯ä»¥åˆç†åœ°è®¤ä¸ºæ¯ä¸€ä¸ªBatchçš„æ•°æ®éƒ½åŒç­‰é‡è¦ã€‚</p>
<p>æ•°æ®æ˜¯ä»¥æ¢¯åº¦å½¢å¼çº¿æ€§å åŠ åˆ°$\bar{\boldsymbol{m}}_t$ä¸­çš„ï¼Œå‡è®¾æ¯ä¸€æ­¥æ¢¯åº¦åªåŒ…å«å½“å‰Batchçš„ä¿¡æ¯ï¼Œé‚£ä¹ˆæŸä¸ªBatchæƒ³è¦ä¸è¢«é—å¿˜ï¼Œç³»æ•°$\beta_3^{t-j+1} - \beta_1^{t-j+1}$å°±ä¸èƒ½å¤ªå°ã€‚è€ƒå¯Ÿå‡½æ•°$f(s) = \beta_3^s - \beta_1^s$ï¼Œå®ƒæ˜¯ä¸€ä¸ªå…ˆå¢åå‡çš„å‡½æ•°ï¼Œä½†å› ä¸º$\beta_3$ä¼šæ¯”$\beta_1$æ›´æ¥è¿‘äº1ï¼Œæ‰€ä»¥å¢çš„æ­¥æ•°ä¸å¤šï¼Œè¿œå¤„æ›´å¤šæ˜¯æ¥è¿‘æŒ‡æ•°ä¸‹é™ï¼Œå¦‚ä¸‹å›¾ï¼š  </p>
<p><a href="/usr/uploads/2025/12/2468435175.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="æ¢¯åº¦æƒé‡ç¤ºæ„å›¾" src="/usr/uploads/2025/12/2468435175.png" /></a></p>
<p>æ¢¯åº¦æƒé‡ç¤ºæ„å›¾</p>
<p>æ€»ä¹‹è¶‹åŠ¿æ˜¯è·ç¦»è¶Šè¿œç³»æ•°è¶Šå°ã€‚é‚£ä¹ˆè¦æƒ³æ¨¡å‹ä¸é—å¿˜æ¯ä¸€ä¸ªBatchï¼Œæœ€è¿œå¤„çš„ç³»æ•°å°±ä¸èƒ½å¤ªå°ã€‚å‡è®¾ç³»æ•°ä¸å°äº$c \in (0, 1)$æ‰èƒ½è¢«è®°ä½ï¼Œå½“$s$è¶³å¤Ÿå¤§æ—¶$\beta_1^s$å…ˆè¶‹äº0ï¼Œæ‰€ä»¥$\beta_3^s - \beta_1^s\approx \beta_3^s$ï¼Œç”±$\beta_3^s\geq c$å¯ä»¥è§£å¾—$s \leq \frac{\log c}{\log \beta_3} \approx \frac{-\log c}{\lambda\eta}$ã€‚è¿™è¡¨æ˜ï¼Œæ¨¡å‹é¡¶å¤šèƒ½è®°ä½$\mathcal{O}(1/\lambda\eta)$æ­¥çš„æ•°æ®ï¼Œè¿™æ˜¯å®ƒçš„è®°å¿†å‘¨æœŸã€‚</p>
<p>é‚£ç›´æ¥æ— è„‘$\lambda=0$ï¼Œè®©è®°å¿†å‘¨æœŸæ— é™å¤§ï¼Œæ˜¯å¦å°±å¯ä»¥ä¸æ‹…å¿ƒé—å¿˜é—®é¢˜äº†ï¼Ÿç†è®ºä¸Šæ˜¯çš„ï¼Œç„¶è€Œè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½é€‰æ‹©ã€‚Weight Decayè¿˜æœ‰ä¸€ä¸ªä½œç”¨æ˜¯å¸®åŠ©æ¨¡å‹å¿˜æ‰åˆå§‹åŒ–ã€‚ç”±å¼$\eqref{eq:theta-0-bar-u}$å¯çŸ¥åˆå§‹åŒ–$\boldsymbol{\theta}_0$çš„æƒé‡æ˜¯$\beta_3^t$ï¼Œå¦‚æœ$\beta_3$å¤ªå¤§æˆ–è€…è®­ç»ƒæ­¥æ•°$t$å¤ªå°ï¼Œé‚£ä¹ˆåˆå§‹åŒ–çš„å æ¯”è¿˜å¾ˆé«˜ï¼Œæ¨¡å‹å¯èƒ½è¿˜å¤„äºæ¬ æ‹Ÿåˆé˜¶æ®µã€‚</p>
<p>æ­¤å¤–ï¼ŒWeight Decayè¿˜æœ‰åˆ©äºç¨³å®šæ¨¡å‹â€œå†…ç§‘â€ã€‚åœ¨<a href="/archives/11307">ã€ŠAdamWçš„Weight RMSçš„æ¸è¿‘ä¼°è®¡ï¼ˆä¸Šï¼‰ã€‹</a>æˆ‘ä»¬å·²ç»æ¨å¯¼è¿‡ï¼ŒAdamWçš„Weight RMSçš„æ¸è¿‘ç»“æœæ˜¯$\sqrt{\eta/2\lambda}$ï¼Œå¦‚æœ$\lambda=0$ï¼Œé‚£ä¹ˆWeight RMSä¼šä»¥$\eta\sqrt{t}$çš„é€Ÿç‡è†¨èƒ€ã€‚è¿™æ„å‘³ç€ç›´æ¥è®¾ç½®$\lambda=0$ï¼Œè¿˜å¯èƒ½å¸¦æ¥æƒé‡çˆ†ç‚¸ç­‰æ¨¡å‹å†…ç§‘å¼‚å¸¸ã€‚</p>
<p>å› æ­¤ï¼Œ$\beta_3$ä¸èƒ½å¤ªå°ï¼Œä»¥å…å¿˜è®°æ—©æœŸæ•°æ®ï¼ŒåŒæ—¶ä¹Ÿä¸èƒ½å¤ªå¤§ï¼Œä»¥å…æ¬ æ‹Ÿåˆæˆ–è€…æƒé‡çˆ†ç‚¸ã€‚æ¯”è¾ƒé€‚åˆçš„è®¾ç½®æ˜¯è®©$1/\lambda\eta$æ­£æ¯”äºè®­ç»ƒæ­¥æ•°ï¼Œå¦‚æœæ˜¯Multi-Epochçš„è®­ç»ƒåœºæ™¯ï¼Œåˆ™è€ƒè™‘è®©$1/\lambda\eta$æ­£æ¯”äºå•ä¸ªEpochçš„è®­ç»ƒæ­¥æ•°ã€‚</p>
<h2 id="_4">åŠ¨æ€ç‰ˆæœ¬</h2>
<p>åœ¨å®é™…è®­ç»ƒä¸­ï¼Œæˆ‘ä»¬æ›´å¤šæ˜¯é€‚ç”¨åŠ¨æ€å˜åŒ–çš„LR Scheduleï¼Œæ¯”å¦‚Consine Decayã€Linear Decayã€WSDï¼ˆWarmup-Stable-Decayï¼‰ç­‰ï¼Œæ‰€ä»¥ä¸Šè¿°é™æ€Weight Decayå’ŒLearning Rateçš„ç»“æœå¹¶ä¸å®Œå…¨ç¬¦åˆå®è·µï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒä»¬æ¨å¹¿åˆ°åŠ¨æ€ç‰ˆã€‚</p>
<p>ä»å¼$\eqref{eq:wd-ema}$å‡ºå‘ï¼Œåˆ©ç”¨è¿‘ä¼¼$1 - \lambda_t \eta_t\approx e^{-\lambda_t \eta_t}$ï¼Œå¹¶è¿­ä»£å±•å¼€ï¼Œå¯å¾—<br />
\begin{equation}\boldsymbol{\theta}<em t-1="t-1">t = (1 - \lambda_t \eta_t)\boldsymbol{\theta}</em>} - \eta_t \boldsymbol{u<em t-1="t-1">t \approx e^{-\lambda_t \eta_t}\boldsymbol{\theta}</em>} - \eta_t \boldsymbol{u<em i="1">t = e^{-\kappa_t}\left(\boldsymbol{\theta}_0 - \sum</em>}^t e^{\kappa_i}\eta_i\boldsymbol{u<em i="1">i\right)\end{equation}<br />
å…¶ä¸­$\kappa_t = \sum</em>\eta_i$ï¼Œé‚£ä¹ˆå¯ä»¥å¾—åˆ°åŒæ ·çš„å¹³å‡åœºè¿‘ä¼¼}^t \eta_i\lambda_i$ã€‚ç»§ç»­è®¾$z_t = \sum_{i=1}^t e^{\kappa_i<br />
\begin{equation}\bar{\boldsymbol{u}}<em i="1">t\triangleq\frac{1}{z_t}\sum</em>}^t e^{\kappa_i}\eta_i \boldsymbol{u<em i="1">i = \frac{1}{z_t}\sum</em>}^t e^{\kappa_i}\eta_i \frac{\boldsymbol{m<em i="1">i}{\sqrt{\boldsymbol{v}_i}}\approx \frac{\bar{\boldsymbol{m}}_t \,\,\triangleq\,\, \frac{1}{z_t}\sum</em>}^t e^{\kappa_i}\eta_i\boldsymbol{m<em i="1">i}{\sqrt{\bar{\boldsymbol{v}}_t \,\,\triangleq\,\, \frac{1}{z_t}\sum</em>}^t e^{\kappa_i}\eta_i\boldsymbol{v<em i="1">i}}\end{equation}<br />
ä»£å…¥$\boldsymbol{m}_t,\boldsymbol{v}_t$çš„å±•å¼€å¼å¾—<br />
\begin{gather}<br />
\bar{\boldsymbol{m}}_t = \frac{1}{z_t}\sum</em>}^t e^{\kappa_i}\eta_i\boldsymbol{m<em i="1">i = \frac{1 - \beta_1}{z_t}\sum</em>}^t e^{\kappa_i}\eta_i\sum_{j=1}^i \beta_1^{i-j}\boldsymbol{g<em j="1">j = \sum</em>}^t\boldsymbol{g<em i="j">j\underbrace{\frac{1 - \beta_1}{z_t}\sum</em>}^t e^{\kappa_i}\beta_1^{i-j}\eta_i<em i="1">{\text{è®°ä¸º}\bar{\beta}_1(j,t)} \\\<br />
\bar{\boldsymbol{v}}_t = \frac{1}{z_t}\sum</em>}^t e^{\kappa_i}\eta_i\boldsymbol{v<em i="1">i = \frac{1 - \beta_2}{z_t}\sum</em>}^t e^{\kappa_i}\eta_i\sum_{j=1}^i \beta_2^{i-j}\boldsymbol{g<em j="1">j^2 = \sum</em>}^t\boldsymbol{g<em i="j">j^2\underbrace{\frac{1 - \beta_2}{z_t}\sum</em> \\\}^t e^{\kappa_i}\beta_2^{i-j}\eta_i}_{\text{è®°ä¸º}\bar{\beta}_2(j,t)<br />
\end{gather}<br />
å¯ä»¥çœ‹åˆ°ï¼Œè·Ÿé™æ€Weight Decayå’ŒLearning Rateç›¸æ¯”ï¼ŒåŠ¨æ€ç‰ˆå½¢å¼ä¸Šå¹¶æ²¡æœ‰å¤ªå¤§å˜åŒ–ï¼Œåªä¸è¿‡æ¢¯åº¦çš„åŠ æƒç³»æ•°å˜æˆäº†ç¨å¾®å¤æ‚ä¸€ç‚¹çš„$\bar{\beta}_1(j,t)$å’Œ$\bar{\beta}_2(j,t)$ã€‚ç‰¹åˆ«åœ°ï¼Œå½“$\beta_1,\beta_2\to 0$æ—¶ï¼Œ$\bar{\beta}_1(j,t)$å’Œ$\bar{\beta}_2(j,t)$ç®€åŒ–ä¸º<br />
\begin{equation}\bar{\beta}_1(j,t) = \bar{\beta}_2(j,t) = \frac{e^{\kappa_j}\eta_j}{z_t}\label{eq:bb1-bb2-0}\end{equation}</p>
<h2 id="_5">æœ€ä¼˜è°ƒåº¦</h2>
<p>æ¥ä¸‹æ¥å¯ä»¥åšçš„äº‹æƒ…æœ‰å¾ˆå¤šï¼Œæœ€åŸºæœ¬çš„å°±æ˜¯æ ¹æ®å…·ä½“çš„WD Scheduleå’ŒLR Scheduleå»ç®—$\bar{\beta}_1(j,t)$å’Œ$\bar{\beta}_2(j,t)$ã€ä¼°è®¡è®°å¿†å‘¨æœŸç­‰ã€‚ä¸è¿‡ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©åšä¸€ä»¶æ›´æè‡´çš„äº‹æƒ…â€”â€”ç›´æ¥å»åæ¨ä¸€ä¸ªæœ€ä¼˜çš„WD Scheduleå’ŒLR Scheduleã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œå‰é¢æˆ‘ä»¬å‡è®¾äº†æ•°æ®å·²ç»å…¨å±€æ‰“ä¹±ï¼Œé‚£ä¹ˆæ¯ä¸ªBatchçš„æ•°æ®éƒ½åŒç­‰é‡è¦ï¼Œä½†é™æ€ç‰ˆå¾—åˆ°çš„ç³»æ•°$\bar{\beta}_1(j,t)\propto\beta_3^{t-j+1} - \beta_1^{t-j+1}$å¹¶éå¸¸æ•°ï¼Œè€Œæ˜¯éšè·ç¦»å˜åŒ–ï¼Œè¿™è·Ÿâ€œæ¯ä¸ªBatchçš„æ•°æ®éƒ½åŒç­‰é‡è¦â€ä¸å®Œå…¨å»åˆã€‚å¦‚æœæ¡ä»¶å…è®¸ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœŸæœ›å®ƒåº”è¯¥æ’ç­‰äºæŸä¸ªå¸¸æ•°ã€‚æ ¹æ®è¿™ä¸ªæœŸæœ›ï¼Œæˆ‘ä»¬å°±å¯ä»¥åè§£å‡ºå¯¹åº”çš„$\lambda_j,\eta_j$ã€‚</p>
<p>ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä»$\beta_1,\beta_2\to 0$å…¥æ‰‹ï¼Œæ­¤æ—¶æœŸæœ›æ¡ä»¶å¯ä»¥å†™ä¸º$\forall 0\leq i,j \leq t, e^{\kappa_i}\eta_i/z_t = e^{\kappa_j}\eta_j/z_t$ï¼Œæ•´ç†å¾—$\eta_i / \eta_j = e^{\kappa_j - \kappa_i}$ï¼Œä»£å…¥$i=j-1$å¾—$\eta_{j-1}/\eta_j = e^{\kappa_j - \kappa_{j-1}} = e^{\lambda_j\eta_j}$ï¼Œæˆ–è€…å†™æˆ<br />
\begin{equation}e^{\lambda_j\eta_j}\eta_j = \eta_{j-1}\end{equation}<br />
è¿™æ ·å°±å¾—åˆ°äº†ä¸€ç§æ±‚è§£$\lambda_j,\eta_j$çš„æ•°å€¼æ–¹æ³•ï¼šæ¯ä¸€æ­¥å¾—åˆ°$\eta_{j-1}$åï¼Œé€šè¿‡æ±‚è§£è¯¥éçº¿æ€§æ–¹ç¨‹å°±èƒ½ç»§ç»­å¾—åˆ°$\lambda_j,\eta_j$ï¼Œäºæ˜¯ä»$\eta_1$å‡ºå‘å°±å¯ä»¥é€’å½’åœ°å¾—åˆ°æ•´ä¸ªåºåˆ—ã€‚å¦‚æœæƒ³è¦æ›´è§£æçš„ç»“æœï¼Œå¯ä»¥ç”¨å¯¼æ•°è¿‘ä¼¼å·®åˆ†ï¼šä¸¤ç«¯å–å¯¹æ•°å¾—$\lambda_j\eta_j + \log \eta_j - \log \eta_{j-1} = 0$ï¼Œå°†$\lambda_j,\eta_j$è§†ä¸ºè¿ç»­å‡½æ•°$\lambda_s,\eta_s$ï¼Œ$\log \eta_j - \log \eta_{j-1}$åˆ™è§†ä¸º$\log \eta_s$çš„å¯¼æ•°è¿‘ä¼¼ï¼Œäºæ˜¯æœ‰<br />
\begin{equation}\lambda_s \eta_s + \frac{\dot{\eta}<em _max="\max">s}{\eta_s} \approx 0 \label{eq:lr-wd-ode}\end{equation}<br />
å¦‚æœ$\lambda_s$å–å¸¸æ•°$\lambda$ï¼Œé‚£ä¹ˆå¯ä»¥è§£å¾—<br />
\begin{equation}\eta_s \approx \frac{\eta</em>}}{\lambda\eta_{\max} s + 1}\label{eq:opt-lrt-wd}\end{equation<br />
è¿™ä¾¿æ˜¯å¸¸æ•°Weight Decayä¸‹çš„æœ€ä½³LR Scheduleï¼Œå®ƒä¸éœ€è¦é¢„è®¾ç»ˆç‚¹$t$å’Œæœ€å°å­¦ä¹ ç‡$\eta_{\min}$ï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥æ— é™è®­ç»ƒä¸‹å»ï¼Œç±»ä¼¼äºWSDçš„Stableé˜¶æ®µï¼Œä½†å®ƒèƒ½è‡ªåŠ¨å¹³è¡¡æ¯ä¸€æ­¥æ¢¯åº¦çš„ç³»æ•°ã€‚ä¸è¿‡å®ƒä¹Ÿæœ‰ä¸ªç¼ºç‚¹ï¼š$s\to\infty$æ—¶å®ƒä¼šè¶‹äº0ã€‚ä»<a href="/archives/11404">ã€ŠAdamWçš„Weight RMSçš„æ¸è¿‘ä¼°è®¡ï¼ˆä¸‹ï¼‰ã€‹</a>å¯çŸ¥Weight RMSä¼šè¶‹äº$\lim\limits_{s\to\infty} \frac{\eta_s}{2\lambda_s}$ï¼Œæ‰€ä»¥è¯¥ç¼ºç‚¹å¯èƒ½å¸¦æ¥æƒé‡åç¼©çš„é£é™©ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘è®©$\lambda_s = \alpha\eta_s$ï¼Œ$\alpha=\lambda_{\max}/\eta_{\max}$æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œæ­¤æ—¶å¯ä»¥è§£å¾—<br />
\begin{equation}\eta_s \approx \frac{\eta_{\max}}{\sqrt{2\lambda_{\max}\eta_{\max} s + 1}},\qquad \lambda_s \approx \frac{\lambda_{\max}}{\sqrt{2\lambda_{\max}\eta_{\max} s + 1}} \label{eq:opt-lrt-wdt}\end{equation}<br />
ç›¸åº”çš„$e^{\kappa_s} \approx \sqrt{2\lambda_{\max}\eta_{\max} s + 1}, e^{\kappa_s}\eta_s \approx \eta_{\max}, z_t\approx \eta_{\max} t, \bar{\beta}_1(j,t) = \bar{\beta}_2(j,t) \approx 1/t$ã€‚</p>
<h2 id="_6">ä¸€èˆ¬ç»“æœ</h2>
<p>ç›®å‰çš„ç»“æœï¼Œæ¯”å¦‚å¼$\eqref{eq:opt-lrt-wd}$å’Œå¼$\eqref{eq:opt-lrt-wdt}$ï¼Œéƒ½æ˜¯åŸºäº$\beta_1,\beta_2=0$çš„ï¼Œå½“å®ƒä»¬ä¸ç­‰äº0æ—¶ï¼Œç»“æœéœ€è¦å˜åŒ–å—ï¼Ÿæ›´ä¸€èˆ¬åœ°ï¼Œä¸Šè¿°ç»“æœéƒ½æ˜¯åŸºäºAdamä¼˜åŒ–å™¨çš„ï¼Œå®ƒä»¬å¤šå¤§ç¨‹åº¦ä¸Šå¯ä»¥æ¨å¹¿åˆ°å…¶ä»–ä¼˜åŒ–å™¨å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆæ¥çœ‹$\beta_1,\beta_2\neq 0$æ—¶çš„é—®é¢˜ï¼Œç­”æ¡ˆæ˜¯å½“$t$è¶³å¤Ÿå¤§æ—¶ï¼Œç»“è®ºå¹¶ä¸ç”¨å¤§æ”¹ã€‚ä»¥$\bar{\beta}<em i="j">1(j,t)$ä¸ºä¾‹ï¼Œåœ¨ä¸Šè¿°æœ€ä¼˜è°ƒåº¦ä¸‹$e^{\kappa_i}\eta_i$ç­‰äºï¼ˆè·Ÿ$t$æœ‰å…³çš„ï¼‰å¸¸æ•°ï¼Œé‚£ä¹ˆæ ¹æ®å®šä¹‰<br />
\begin{equation}\bar{\beta}_1(j,t) = \frac{1 - \beta_1}{z_t}\sum</em>}^t e^{\kappa_i}\beta_1^{i-j}\eta_i \propto \sum_{i=j}^t \beta_1^{i-j} = \frac{1 - \beta_1^{t-j+1}}{1 - \beta_1}\end{equation<br />
å½“$t$è¶³å¤Ÿå¤§æ—¶$\beta_1^{t-j+1}\to 0$ï¼Œæ‰€ä»¥è¿™ä¹Ÿå¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªè·Ÿ$j$æ— å…³çš„å¸¸æ•°ã€‚å‰é¢ä¹Ÿè¯´äº†ï¼Œå¯¹äº$\beta_1,\beta_2$æ¥è¯´ï¼Œâ€œ$t$è¶³å¤Ÿå¤§â€è¿™ä»¶äº‹æƒ…å‡ ä¹æ—¶è‚¯å®šçš„ï¼Œæ‰€ä»¥ç›´æ¥ç”¨$\beta_1,\beta_2=0$çš„ç»“æœå°±è¡Œã€‚</p>
<p>è‡³äºä¼˜åŒ–å™¨ï¼Œå‰é¢æˆ‘ä»¬æåˆ°çš„ä¼˜åŒ–å™¨æœ‰SGDMã€RMSPropã€Adamã€SignSGDMã€Muonï¼Œå®ƒä»¬å¯ä»¥åˆ†ä¸ºä¸¤ç±»ã€‚å…¶ä¸­ï¼ŒSGDMæ˜¯ä¸€ç±»ï¼Œå®ƒçš„$\bar{\boldsymbol{u}}_t$ç›´æ¥å°±æ˜¯$\bar{\boldsymbol{m}}_t$ï¼Œè¿å¹³å‡åœºè¿‘ä¼¼éƒ½ä¸éœ€è¦ç”¨ï¼Œæ‰€ä»¥ç›´åˆ°å¼$\eqref{eq:lr-wd-ode}$çš„ç»“æœéƒ½æ˜¯é€‚ç”¨çš„ã€‚ä¸è¿‡ï¼Œå¼$\eqref{eq:opt-lrt-wd}$å’Œå¼$\eqref{eq:opt-lrt-wdt}$å¤§æ¦‚ä¸æ˜¯æœ€é€‚åˆçš„äº†ï¼Œå› ä¸ºSGDMçš„æ¸è¿‘Weight RMSè¿˜ä¾èµ–äºæ¢¯åº¦æ¨¡é•¿[<a href="https://papers.cool/arxiv/2305.17212">å‚è€ƒ</a>]ï¼Œæ‰€ä»¥è¦æŠŠæ¢¯åº¦æ¨¡é•¿è€ƒè™‘è¿›å»æ‰è¡Œï¼Œç›¸å¯¹å¤æ‚ä¸€äº›ã€‚</p>
<p>å‰©ä¸‹çš„RMSPropã€Adamã€SignSGDMã€Muonæˆ‘ä»¬å°†å®ƒå½’ä¸ºå¦ä¸€ç±»ï¼Œéƒ½å±äºè‡ªé€‚åº”å­¦ä¹ ç‡ä¼˜åŒ–å™¨ï¼Œå®ƒä»¬çš„æ›´æ–°è§„åˆ™éƒ½å…·æœ‰$\frac{\text{æ¢¯åº¦}}{\sqrt{\text{æ¢¯åº¦}{}^2}}$çš„å…¶æ¬¡å½¢å¼ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬ä¾æ—§ç›¸ä¿¡å¹³å‡åœºè¿‘ä¼¼ï¼Œé‚£ä¹ˆå°±èƒ½å¾—åˆ°åŒæ ·çš„$\bar{\boldsymbol{m}}_t$ã€åŒæ ·çš„$\beta_1(j,t)$ï¼Œæ‰€ä»¥åˆ°å¼$\eqref{eq:lr-wd-ode}$çš„ç»“æœä¹Ÿæ˜¯é€‚ç”¨çš„ï¼›å¹¶ä¸”å¯¹äºè¿™ç±»é½æ¬¡å‹ä¼˜åŒ–å™¨ï¼Œå¯ä»¥è¯æ˜Weight RMSåŒæ ·æ¸è¿‘æ­£æ¯”äº$\sqrt{\eta/\lambda}$ï¼Œæ‰€ä»¥è¿åŒå¼$\eqref{eq:opt-lrt-wd}$å’Œå¼$\eqref{eq:opt-lrt-wdt}$ä¹Ÿå¯ä»¥å¤ç”¨ã€‚</p>
<h2 id="_7">å‡è®¾è®¨è®º</h2>
<p>æˆ‘ä»¬çš„æ¨å¯¼æš‚å‘Šä¸€æ®µè½ï¼Œè¿™ä¸€èŠ‚æˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹æ¨å¯¼æ‰€ä¾èµ–çš„å‡è®¾ã€‚</p>
<p>çºµè§‚å…¨æ–‡ï¼Œæ¨å¯¼è¿‡ç¨‹ä¸­æ‰€ç”¨åˆ°çš„å€¼å¾—æ‹¿å‡ºæ¥è®¨è®ºçš„å¤§å‡è®¾ä¸»è¦æœ‰ä¸¤ä¸ªã€‚ç¬¬ä¸€ä¸ªå‡è®¾æ˜¯å¹³å‡åœºè¿‘ä¼¼ï¼Œé¦–æ¬¡ä»‹ç»äº<a href="/archives/11280">ã€Šé‡æ–°æ€è€ƒå­¦ä¹ ç‡ä¸Batch Sizeï¼ˆäºŒï¼‰ï¼šå¹³å‡åœºã€‹</a>ã€‚å¹³å‡åœºæœ¬èº«è‚¯å®šä¸æ˜¯æ–°çš„ï¼Œå®ƒæ˜¯ç‰©ç†å­¦ä¸­çš„ç»å…¸è¿‘ä¼¼ï¼Œä½†å°†å…¶ç”¨æ¥åˆ†æä¼˜åŒ–å™¨çš„ç›¸å…³åŠ¨æ€ï¼Œåº”è¯¥æ˜¯ç¬”è€…é¦–æ¬¡å¼•å…¥çš„ï¼Œç›®å‰å·²ç»ç”¨å®ƒä¼°ç®—è¿‡ä¼˜åŒ–å™¨çš„<a href="/archives/11280">Batch Size</a>ã€<a href="/archives/11267">Update RMS</a>ã€<a href="/archives/11307">Weight RMS</a>ç­‰ï¼Œç»“æœçœ‹èµ·æ¥æ˜¯åˆç†çš„ã€‚</p>
<p>å¯¹äºå¹³å‡åœºè¿‘ä¼¼çš„æœ‰æ•ˆæ€§ï¼Œå…¶å®æˆ‘ä»¬æ²¡æ³•è¯„è¿°å¤ªå¤šï¼Œå®ƒæ›´å¤šä½“ç°äº†ä¸€ç§ä¿¡ä»°ã€‚ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬æ ¹æ®å·²æœ‰çš„ä¼°ç®—ç»“æœçš„åˆç†æ€§ï¼Œç›¸ä¿¡å®ƒä¼šç»§ç»­åˆç†ä¸‹å»ï¼Œè‡³å°‘èƒ½å¯¹ä¸€äº›æ ‡é‡æŒ‡æ ‡ç»™å‡ºæœ‰æ•ˆçš„æ¸è¿‘ä¼°è®¡ã€‚å¦ä¸€æ–¹é¢ï¼Œå¯¹äºè‡ªé€‚åº”å­¦ä¹ ç‡ä¼˜åŒ–å™¨ï¼Œç”±äºå…¶æ›´æ–°è§„åˆ™çš„éçº¿æ€§ï¼Œåˆ†æéš¾åº¦å¤§å¤§å¢åŠ ï¼Œé™¤äº†å¹³å‡åœºè¿‘ä¼¼å¤–ï¼Œæˆ‘ä»¬å…¶å®ä¹Ÿæ²¡ä»€ä¹ˆè®¡ç®—å·¥å…·èƒ½ç”¨äº†ã€‚</p>
<p>è¿™å…¶ä¸­æœ€å…¸å‹çš„ä¾‹å­å°±æ˜¯Muonï¼Œå› ä¸ºå®ƒæ˜¯éElement-wiseçš„è¿ç®—ï¼Œä»¥å¾€åƒSignSGDé‚£æ ·é€åˆ†é‡çš„è®¡ç®—æ‰‹æ®µä¾¿å¤±å»äº†ä½œç”¨ï¼Œè€Œå¹³å‡åœºè¿‘ä¼¼ä¾ç„¶å¥æ•ˆï¼ˆå‚è€ƒ<a href="/archives/11285">ã€Šé‡æ–°æ€è€ƒå­¦ä¹ ç‡ä¸Batch Sizeï¼ˆä¸‰ï¼‰ï¼šMuonã€‹</a>ï¼‰ã€‚æ‰€ä»¥ï¼Œå¹³å‡åœºè¿‘ä¼¼å®é™…ä¸Šä¸ºä¸€å¤§ç±»è‡ªé€‚åº”å­¦ä¹ ç‡ä¼˜åŒ–å™¨çš„åˆ†æå’Œä¼°è®¡æä¾›äº†ç»Ÿä¸€ã€æœ‰æ•ˆã€ç®€æ´çš„è®¡ç®—æ‰‹æ®µï¼Œç›®å‰çœ‹æ¥ä¼¼ä¹æ²¡æœ‰åˆ«çš„æ–¹æ³•æœ‰åŒæ ·çš„æ•ˆæœï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½ç»§ç»­ç›¸ä¿¡å®ƒã€‚</p>
<p>ç¬¬äºŒä¸ªå¤§çš„å‡è®¾æ˜¯â€œæ¯ä¸€æ­¥æ¢¯åº¦åªåŒ…å«å½“å‰Batchçš„ä¿¡æ¯â€ï¼Œè¿™ä¸ªå‡è®¾æœ¬è´¨ä¸Šæ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºæ¢¯åº¦ä¸ä»…ä¾èµ–äºå½“å‰Batchçš„æ•°æ®ï¼Œè¿˜ä¾èµ–äºä¸Šä¸€æ­¥çš„å‚æ•°ï¼Œè€Œä¸Šä¸€æ­¥çš„å‚æ•°è‡ªç„¶æ˜¯åŒ…å«äº†å†å²ä¿¡æ¯ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•è¡¥æ•‘ä¸€ä¸‹ï¼Œå› ä¸ºç†è®ºä¸Šæ¥è¯´ï¼Œæ¯ä¸ªBatchéƒ½ä¼šå¸¦æ¥æ–°çš„ä¿¡æ¯ï¼Œå¦åˆ™è¿™ä¸ªBatchå°±æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰äº†ï¼Œæ‰€ä»¥è¡¥æ•‘çš„æ–¹æ³•æ˜¯æ”¹ä¸ºâ€œæ¯ä¸€æ­¥æ¢¯åº¦åŒ…å«å¤§è‡´ç›¸åŒçš„å¢é‡ä¿¡æ¯â€ã€‚</p>
<p>å½“ç„¶ï¼Œä»”ç»†æ€è€ƒä¹‹ä¸‹è¿™ä¸ªè¯´æ³•ä¹Ÿæ˜¯æœ‰äº‰è®®çš„ï¼Œå› ä¸ºå­¦å¾—è¶Šå¤šï¼Œè¦†ç›–é¢è¶Šå¹¿ï¼Œåæ¥Batchçš„ç‹¬ç‰¹ä¿¡æ¯å°±è¶Šå°‘ã€‚ä¸è¿‡ï¼Œè¿˜å¯ä»¥æŒ£æ‰ä¸€ä¸‹ï¼Œé‚£å°±æ˜¯å°†çŸ¥è¯†åˆ†ä¸ºâ€œè§„å¾‹â€å’Œâ€œäº‹å®â€ä¸¤å¤§ç±»ï¼Œäº‹å®å‹çŸ¥è¯†â€”â€”æ¯”å¦‚æŸä¸ªå®šç†æ˜¯æŸä¸ªæ•°å­¦å®¶å‘ç°çš„â€”â€”åªèƒ½é è®°å¿†ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘æ”¹ä¸ºâ€œæ¯ä¸€æ­¥æ¢¯åº¦åŒ…å«å¤§è‡´ç›¸åŒçš„äº‹å®å‹çŸ¥è¯†â€ã€‚æ€»ä¹‹ï¼Œä»å®è·µæ¥çœ‹ï¼Œâ€œå¹³ç­‰å¯¹å¾…æ¯ä¸€æ­¥æ¢¯åº¦â€æ‰€å¾—çš„LR Scheduleä¼¼ä¹çœŸçš„æ˜¯æœ‰å¥½å¤„çš„ï¼Œæ‰€ä»¥æ€»å¯ä»¥å°è¯•ä¸ºå®ƒæ„é€ ä¸€ä¸ªè§£é‡Šã€‚</p>
<p>æœ€è¿‘çš„è®ºæ–‡<a href="https://papers.cool/arxiv/2511.18903">ã€ŠHow Learning Rate Decay Wastes Your Best Data in Curriculum-Based LLM Pretrainingã€‹</a>æä¾›äº†ä¸€ä¸ªé—´æ¥è¯æ®ã€‚å®ƒè€ƒè™‘äº†æ•°æ®è´¨é‡ä»ä½åˆ°é«˜çš„è¯¾ç¨‹å­¦ä¹ ï¼Œå‘ç°æ¿€è¿›çš„LR Decayä¼šè®©è¯¾ç¨‹å­¦ä¹ ä¼˜åŠ¿å…¨æ— ã€‚è€Œæˆ‘ä»¬çš„ç»“æœæ˜¯æ¯ä¸€Batchçš„æƒé‡æ˜¯å¼$\eqref{eq:bb1-bb2-0}$ï¼Œæ­£æ¯”äºLearning Rateï¼Œå¦‚æœLR Decayè¿‡äºæ¿€è¿›ï¼Œé‚£ä¹ˆåé¢çš„é«˜è´¨é‡æ•°æ®æƒé‡åè€Œè¿‡å°ï¼Œå› è€Œæ•ˆæœæ¬ ä½³ã€‚èƒ½å¤Ÿåˆç†è§£é‡Šè¿™ä¸ªç°è±¡ï¼Œåè¿‡æ¥æ˜¾ç¤ºäº†æˆ‘ä»¬å‡è®¾çš„åˆç†æ€§ã€‚</p>
<h2 id="_8">æ–‡ç« å°ç»“</h2>
<p>æœ¬æ–‡ä»æ»‘åŠ¨å¹³å‡çš„è§†è§’æ¥ç†è§£æƒé‡è¡°å‡ï¼ˆWDï¼‰å’Œå­¦ä¹ ç‡ï¼ˆLRï¼‰ï¼Œå¹¶æ¢è®¨äº†åœ¨è¯¥è§†è§’ä¸‹æœ€ä¼˜çš„WD Scheduleå’ŒLR Scheduleã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/11459">https://spaces.ac.cn/archives/11459</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Dec. 05, 2025). ã€Šæ»‘åŠ¨å¹³å‡è§†è§’ä¸‹çš„æƒé‡è¡°å‡å’Œå­¦ä¹ ç‡ ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/11459">https://spaces.ac.cn/archives/11459</a></p>
<p>@online{kexuefm-11459,<br />
title={æ»‘åŠ¨å¹³å‡è§†è§’ä¸‹çš„æƒé‡è¡°å‡å’Œå­¦ä¹ ç‡},<br />
author={è‹å‰‘æ—},<br />
year={2025},<br />
month={Dec},<br />
url={\url{https://spaces.ac.cn/archives/11459}},<br />
} </p>
<hr />
<h2 id="_9">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<p>æœ¬èŠ‚å°†å¯¹åŸæ–‡ä¸­çš„æ ¸å¿ƒå…¬å¼è¿›è¡Œæè¯¦ç»†çš„æ¨å¯¼å’Œæ‰©å±•ï¼Œæ¶µç›–æ»‘åŠ¨å¹³å‡è§†è§’ã€æƒé‡è¡°å‡æœºåˆ¶ã€å­¦ä¹ ç‡è°ƒåº¦ç­–ç•¥ä»¥åŠæœ€ä¼˜åŒ–ç†è®ºçš„å®Œæ•´æ•°å­¦æ¡†æ¶ã€‚</p>
<hr />
<h3 id="_10">ç¬¬ä¸€éƒ¨åˆ†ï¼šä¼˜åŒ–å™¨ä¸æƒé‡è¡°å‡çš„ç»Ÿä¸€æ¡†æ¶</h3>
<h4 id="11">1.1 ç»å…¸ä¼˜åŒ–å™¨å›é¡¾</h4>
<p><strong>æ ‡å‡†æ¢¯åº¦ä¸‹é™ï¼ˆSGDï¼‰</strong>ï¼š</p>
<p>$$
\theta_t = \theta_{t-1} - \eta_t g_t
$$</p>
<p>å…¶ä¸­ï¼š
- $\theta_t$ï¼šç¬¬$t$æ­¥çš„å‚æ•°
- $\eta_t$ï¼šå­¦ä¹ ç‡
- $g_t$ï¼šç¬¬$t$æ­¥çš„æ¢¯åº¦</p>
<p><strong>å¸¦åŠ¨é‡çš„SGDï¼ˆSGDMï¼‰</strong>ï¼š</p>
<p>$$
\begin{aligned}
m_t &= \beta_1 m_{t-1} + (1 - \beta_1) g_t \\
\theta_t &= \theta_{t-1} - \eta_t m_t
\end{aligned}
$$</p>
<p><strong>Adamä¼˜åŒ–å™¨</strong>ï¼š</p>
<p>$$
\begin{aligned}
m_t &= \beta_1 m_{t-1} + (1 - \beta_1) g_t \quad &\text{ï¼ˆä¸€é˜¶çŸ©ä¼°è®¡ï¼‰} \\
v_t &= \beta_2 v_{t-1} + (1 - \beta_2) g_t^2 \quad &\text{ï¼ˆäºŒé˜¶çŸ©ä¼°è®¡ï¼‰} \\
\hat{m}_t &= \frac{m_t}{1 - \beta_1^t} \quad &\text{ï¼ˆåå·®ä¿®æ­£ï¼‰} \\
\hat{v}_t &= \frac{v_t}{1 - \beta_2^t} \quad &\text{ï¼ˆåå·®ä¿®æ­£ï¼‰} \\
\theta_t &= \theta_{t-1} - \eta_t \frac{\hat{m}_t}{\sqrt{\hat{v}_t} + \epsilon} \quad &\text{ï¼ˆå‚æ•°æ›´æ–°ï¼‰}
\end{aligned}
$$</p>
<p><strong>å…³é”®å‚æ•°</strong>ï¼š
- $\beta_1 \in [0, 1)$ï¼šä¸€é˜¶åŠ¨é‡ç³»æ•°ï¼ˆé€šå¸¸0.9ï¼‰
- $\beta_2 \in [0, 1)$ï¼šäºŒé˜¶åŠ¨é‡ç³»æ•°ï¼ˆé€šå¸¸0.999ï¼‰
- $\epsilon &gt; 0$ï¼šæ•°å€¼ç¨³å®šé¡¹ï¼ˆé€šå¸¸$10^{-8}$ï¼‰</p>
<h4 id="12-l2">1.2 L2æ­£åˆ™åŒ–ä¸æƒé‡è¡°å‡çš„åŒºåˆ«</h4>
<p><strong>L2æ­£åˆ™åŒ–</strong>ï¼ˆä¼ ç»Ÿæ–¹æ³•ï¼‰ï¼š</p>
<p>æŸå¤±å‡½æ•°æ·»åŠ æƒ©ç½šé¡¹ï¼š</p>
<p>$$
\mathcal{L}_{\text{reg}} = \mathcal{L}(\theta) + \frac{\lambda}{2}\|\theta\|^2
$$</p>
<p>æ¢¯åº¦å˜ä¸ºï¼š</p>
<p>$$
\nabla_{\theta} \mathcal{L}_{\text{reg}} = \nabla_{\theta} \mathcal{L} + \lambda \theta
$$</p>
<p>å‚æ•°æ›´æ–°ï¼š</p>
<p>$$
\theta_t = \theta_{t-1} - \eta_t (\nabla_{\theta} \mathcal{L} + \lambda \theta_{t-1})
$$</p>
<p><strong>é—®é¢˜</strong>ï¼šL2æ­£åˆ™åŒ–åœ¨Adamç­‰è‡ªé€‚åº”ä¼˜åŒ–å™¨ä¸­å¤±æ•ˆã€‚</p>
<p><strong>åŸå› æ¨å¯¼</strong>ï¼š</p>
<p>å¯¹äºAdamï¼ŒL2æ­£åˆ™åŒ–çš„æ¢¯åº¦$\nabla_{\theta} \mathcal{L} + \lambda \theta_{t-1}$ä¼šè¢«ç´¯ç§¯åˆ°åŠ¨é‡é¡¹ï¼š</p>
<p>$$
m_t = \beta_1 m_{t-1} + (1 - \beta_1)(\nabla_{\theta} \mathcal{L} + \lambda \theta_{t-1})
$$</p>
<p>ç„¶åå†è¢«è‡ªé€‚åº”å­¦ä¹ ç‡$\frac{\eta_t}{\sqrt{v_t}}$ç¼©æ”¾ï¼Œå¯¼è‡´æ­£åˆ™åŒ–æ•ˆæœä¸ç¨³å®šã€‚</p>
<p><strong>æƒé‡è¡°å‡</strong>ï¼ˆAdamWæ–¹æ³•ï¼‰ï¼š</p>
<p>ç›´æ¥åœ¨å‚æ•°ç©ºé—´åšè¡°å‡ï¼š</p>
<p>$$
\boxed{\theta_t = \theta_{t-1} - \eta_t (u_t + \lambda_t \theta_{t-1}) = (1 - \lambda_t \eta_t)\theta_{t-1} - \eta_t u_t}
$$</p>
<p>å…¶ä¸­$u_t$æ˜¯ä¼˜åŒ–å™¨ç»™å‡ºçš„æ›´æ–°é‡ï¼ˆä¸åŒ…å«æ­£åˆ™åŒ–ï¼‰ï¼š
- SGDMï¼š$u_t = m_t$
- Adamï¼š$u_t = \frac{\hat{m}_t}{\sqrt{\hat{v}_t} + \epsilon}$
- RMSPropï¼š$u_t = \frac{g_t}{\sqrt{v_t} + \epsilon}$</p>
<p><strong>å…³é”®ä¼˜åŠ¿</strong>ï¼š
1. æƒé‡è¡°å‡ä¸æ¢¯åº¦æ›´æ–°è§£è€¦
2. ä¸å—è‡ªé€‚åº”å­¦ä¹ ç‡å½±å“
3. å¯¹æ‰€æœ‰ä¼˜åŒ–å™¨ç»Ÿä¸€æœ‰æ•ˆ</p>
<h4 id="13">1.3 ç»Ÿä¸€æ›´æ–°é‡çš„å®šä¹‰</h4>
<p><strong>å®šä¹‰</strong>ï¼šè®°ä¼˜åŒ–å™¨ç»™å‡ºçš„æ›´æ–°é‡ä¸º$u_t$ï¼Œåˆ™ï¼š</p>
<table>
<thead>
<tr>
<th>ä¼˜åŒ–å™¨</th>
<th>æ›´æ–°é‡$u_t$</th>
<th>ç±»å‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>SGD</td>
<td>$g_t$</td>
<td>åŸºç¡€å‹</td>
</tr>
<tr>
<td>SGDM</td>
<td>$m_t$</td>
<td>åŠ¨é‡å‹</td>
</tr>
<tr>
<td>RMSProp</td>
<td>$\frac{g_t}{\sqrt{v_t} + \epsilon}$</td>
<td>è‡ªé€‚åº”å‹</td>
</tr>
<tr>
<td>Adam</td>
<td>$\frac{\hat{m}_t}{\sqrt{\hat{v}_t} + \epsilon}$</td>
<td>è‡ªé€‚åº”å‹</td>
</tr>
<tr>
<td>SignSGDM</td>
<td>$\text{sign}(m_t)$</td>
<td>ç¬¦å·å‹</td>
</tr>
<tr>
<td>Muon</td>
<td>$\text{msign}(m_t)$</td>
<td>çŸ©é˜µç¬¦å·å‹</td>
</tr>
</tbody>
</table>
<p><strong>é€šç”¨å½¢å¼</strong>ï¼š</p>
<p>$$
\theta_t = \theta_{t-1} - \eta_t (u_t + \lambda_t \theta_{t-1})
$$</p>
<hr />
<h3 id="_11">ç¬¬äºŒéƒ¨åˆ†ï¼šæ»‘åŠ¨å¹³å‡è§†è§’çš„å¼•å…¥</h3>
<h4 id="21-ema">2.1 æŒ‡æ•°æ»‘åŠ¨å¹³å‡ï¼ˆEMAï¼‰çš„æ•°å­¦å½¢å¼</h4>
<p><strong>å®šä¹‰</strong>ï¼šç»™å®šåºåˆ—${x_i}_{i=1}^t$ï¼Œç³»æ•°$\beta \in (0, 1)$ï¼ŒæŒ‡æ•°æ»‘åŠ¨å¹³å‡ä¸ºï¼š</p>
<p>$$
\bar{x}_t = \beta \bar{x}_{t-1} + (1 - \beta) x_t
$$</p>
<p><strong>è¿­ä»£å±•å¼€</strong>ï¼š</p>
<p>$$
\begin{aligned}
\bar{x}_t &= \beta \bar{x}_{t-1} + (1 - \beta) x_t \\
&= \beta[\beta \bar{x}_{t-2} + (1 - \beta) x_{t-1}] + (1 - \beta) x_t \\
&= \beta^2 \bar{x}_{t-2} + (1 - \beta)\beta x_{t-1} + (1 - \beta) x_t \\
&= \cdots \\
&= \beta^t \bar{x}_0 + (1 - \beta)\sum_{i=1}^t \beta^{t-i} x_i
\end{aligned}
$$</p>
<p><strong>å½’ä¸€åŒ–å½¢å¼</strong>ï¼ˆå¿½ç•¥åˆå§‹å€¼ï¼‰ï¼š</p>
<p>$$
\bar{x}_t = \frac{\sum_{i=1}^t \beta^{t-i} x_i}{\sum_{i=1}^t \beta^{t-i}} = \frac{(1 - \beta)\sum_{i=1}^t \beta^{t-i} x_i}{1 - \beta^t}
$$</p>
<p>å½“$t \to \infty$æ—¶ï¼Œ$\beta^t \to 0$ï¼Œå¯ç®€åŒ–ä¸ºï¼š</p>
<p>$$
\bar{x}_t \approx (1 - \beta)\sum_{i=1}^t \beta^{t-i} x_i
$$</p>
<h4 id="22-ema">2.2 æƒé‡è¡°å‡çš„EMAè§£é‡Š</h4>
<p><strong>é‡å†™æƒé‡æ›´æ–°å…¬å¼</strong>ï¼š</p>
<p>$$
\begin{aligned}
\theta_t &= \theta_{t-1} - \eta_t (u_t + \lambda_t \theta_{t-1}) \\
&= (1 - \lambda_t \eta_t)\theta_{t-1} - \eta_t u_t \\
&= (1 - \lambda_t \eta_t)\theta_{t-1} + \lambda_t \eta_t \left(-\frac{u_t}{\lambda_t}\right)
\end{aligned}
$$</p>
<p><strong>EMAå½¢å¼</strong>ï¼š</p>
<p>å®šä¹‰è¡°å‡ç³»æ•°$\beta_3 = 1 - \lambda \eta$ï¼ˆå‡è®¾$\lambda_t, \eta_t$ä¸ºå¸¸æ•°ï¼‰ï¼Œåˆ™ï¼š</p>
<p>$$
\boxed{\theta_t = \beta_3 \theta_{t-1} + (1 - \beta_3)\left(-\frac{u_t}{\lambda}\right)}
$$</p>
<p>è¿™æ°å¥½æ˜¯$\theta_{t-1}$ä¸$-u_t/\lambda$çš„æ»‘åŠ¨å¹³å‡ï¼</p>
<p><strong>ç‰©ç†æ„ä¹‰</strong>ï¼š
- $\beta_3 \to 1$ï¼šæ¨¡å‹"è®°å¿†"å†å²æƒé‡ï¼Œè¡°å‡å¼±
- $\beta_3 \to 0$ï¼šæ¨¡å‹"é—å¿˜"å†å²æƒé‡ï¼Œè¡°å‡å¼º
- $-u_t/\lambda$ï¼šå½“å‰æ•°æ®å¯¹æƒé‡çš„"ç›®æ ‡æ¨åŠ¨æ–¹å‘"</p>
<h4 id="23">2.3 è¿­ä»£å±•å¼€ï¼šå‚æ•°çš„è®°å¿†æ„æˆ</h4>
<p><strong>å®Œå…¨å±•å¼€</strong>ï¼š</p>
<p>ä»$\theta_0$å¼€å§‹è¿­ä»£ï¼š</p>
<p>$$
\begin{aligned}
\theta_t &= \beta_3 \theta_{t-1} + (1 - \beta_3)\left(-\frac{u_t}{\lambda}\right) \\
&= \beta_3\left[\beta_3 \theta_{t-2} + (1 - \beta_3)\left(-\frac{u_{t-1}}{\lambda}\right)\right] + (1 - \beta_3)\left(-\frac{u_t}{\lambda}\right) \\
&= \beta_3^2 \theta_{t-2} + (1 - \beta_3)\beta_3\left(-\frac{u_{t-1}}{\lambda}\right) + (1 - \beta_3)\left(-\frac{u_t}{\lambda}\right) \\
&= \cdots \\
&= \beta_3^t \theta_0 + (1 - \beta_3)\sum_{i=1}^t \beta_3^{t-i}\left(-\frac{u_i}{\lambda}\right)
\end{aligned}
$$</p>
<p><strong>ç®€åŒ–å½¢å¼</strong>ï¼š</p>
<p>$$
\boxed{\theta_t = \beta_3^t \theta_0 + (1 - \beta_3)\sum_{i=1}^t \beta_3^{t-i}\left(-\frac{u_i}{\lambda}\right)}
$$</p>
<p><strong>å…³é”®è§‚å¯Ÿ</strong>ï¼š
1. <strong>åˆå§‹åŒ–é—å¿˜</strong>ï¼š$\beta_3^t \to 0$æ„å‘³ç€æ¨¡å‹é€æ¸é—å¿˜åˆå§‹åŒ–$\theta_0$
2. <strong>å†å²åŠ æƒ</strong>ï¼šæ¯ä¸€æ­¥çš„æ›´æ–°$u_i$æŒ‰æŒ‡æ•°è¡°å‡æƒé‡$\beta_3^{t-i}$ç´¯ç§¯
3. <strong>æƒé‡å½’ä¸€åŒ–</strong>ï¼šç³»æ•°$1 - \beta_3$ä¿è¯æ€»æƒé‡$\sum_{i=1}^t \beta_3^{t-i}(1 - \beta_3) \approx 1$ï¼ˆå½“$t \to \infty$ï¼‰</p>
<h4 id="24">2.4 è®°å¿†å‘¨æœŸçš„å®šé‡åˆ†æ</h4>
<p><strong>å®šä¹‰</strong>ï¼šè®°å¿†å‘¨æœŸ$T_{\text{mem}}$æ˜¯æŒ‡æƒé‡ç³»æ•°è¡°å‡åˆ°$c \in (0, 1)$ï¼ˆå¦‚$c = e^{-1} \approx 0.368$ï¼‰æ‰€éœ€çš„æ­¥æ•°ã€‚</p>
<p><strong>æ¨å¯¼</strong>ï¼š</p>
<p>ä»$\beta_3^s \geq c$æ±‚è§£ï¼š</p>
<p>$$
\begin{aligned}
\beta_3^s &\geq c \\
(1 - \lambda\eta)^s &\geq c \\
s \log(1 - \lambda\eta) &\geq \log c \\
s &\leq \frac{\log c}{\log(1 - \lambda\eta)}
\end{aligned}
$$</p>
<p><strong>æ³°å‹’å±•å¼€</strong>ï¼šå½“$\lambda\eta \ll 1$æ—¶ï¼Œ$\log(1 - \lambda\eta) \approx -\lambda\eta$ï¼Œå› æ­¤ï¼š</p>
<p>$$
s \leq \frac{\log c}{-\lambda\eta} = \frac{-\log c}{\lambda\eta}
$$</p>
<p>å–$c = e^{-1}$ï¼Œåˆ™$-\log c = 1$ï¼š</p>
<p>$$
\boxed{T_{\text{mem}} \approx \frac{1}{\lambda\eta}}
$$</p>
<p><strong>å®ä¾‹è®¡ç®—</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>$\lambda$</th>
<th>$\eta$</th>
<th>$\lambda\eta$</th>
<th>$T_{\text{mem}}$</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody>
<tr>
<td>0.01</td>
<td>0.001</td>
<td>$10^{-5}$</td>
<td>100,000</td>
<td>è®°å¿†10ä¸‡æ­¥</td>
</tr>
<tr>
<td>0.1</td>
<td>0.001</td>
<td>$10^{-4}$</td>
<td>10,000</td>
<td>è®°å¿†1ä¸‡æ­¥</td>
</tr>
<tr>
<td>0.1</td>
<td>0.01</td>
<td>$10^{-3}$</td>
<td>1,000</td>
<td>è®°å¿†1åƒæ­¥</td>
</tr>
</tbody>
</table>
<p><strong>å…³é”®æ´å¯Ÿ</strong>ï¼š
- $\lambda\eta$å° â†’ è®°å¿†å‘¨æœŸé•¿ â†’ å®¹æ˜“æ¬ æ‹Ÿåˆã€æƒé‡çˆ†ç‚¸
- $\lambda\eta$å¤§ â†’ è®°å¿†å‘¨æœŸçŸ­ â†’ å®¹æ˜“é—å¿˜æ—©æœŸæ•°æ®</p>
<hr />
<h3 id="adam">ç¬¬ä¸‰éƒ¨åˆ†ï¼šAdamçš„å¹³å‡åœºè¿‘ä¼¼</h3>
<h4 id="31">3.1 å¹³å‡åœºè¿‘ä¼¼çš„ç‰©ç†èƒŒæ™¯</h4>
<p><strong>æ¥æº</strong>ï¼šå¹³å‡åœºç†è®ºï¼ˆMean Field Theoryï¼‰æºäºç»Ÿè®¡ç‰©ç†å­¦ï¼Œç”¨äºç®€åŒ–å¤šä½“ç³»ç»Ÿçš„ç›¸äº’ä½œç”¨ã€‚</p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå°†$n$ä¸ªç›¸äº’ä½œç”¨çš„ç²’å­ç®€åŒ–ä¸ºæ¯ä¸ªç²’å­ä¸"å¹³å‡åœº"çš„ç›¸äº’ä½œç”¨ã€‚</p>
<p><strong>åº”ç”¨åˆ°ä¼˜åŒ–å™¨</strong>ï¼š</p>
<p>Adamçš„æ›´æ–°é‡ä¸ºï¼š</p>
<p>$$
u_t = \frac{\hat{m}_t}{\sqrt{\hat{v}_t} + \epsilon}
$$</p>
<p>å…¶ä¸­$\hat{m}_t$å’Œ$\hat{v}_t$éƒ½æ˜¯æ—¶é—´åºåˆ—çš„æ»‘åŠ¨å¹³å‡ã€‚</p>
<p><strong>éçº¿æ€§è€¦åˆ</strong>ï¼š</p>
<p>$$
u_t = \frac{\sum_{i=1}^t w_1^{(i)} g_i}{\sqrt{\sum_{i=1}^t w_2^{(i)} g_i^2} + \epsilon}
$$</p>
<p>è¿™æ˜¯ä¸€ä¸ª<strong>åˆ†å¼éçº¿æ€§å‡½æ•°</strong>ï¼Œç›´æ¥åˆ†ææå…¶å›°éš¾ã€‚</p>
<p><strong>å¹³å‡åœºè¿‘ä¼¼</strong>ï¼š</p>
<p>å‡è®¾åˆ†å­å’Œåˆ†æ¯çš„æ»‘åŠ¨å¹³å‡å¯ä»¥ç‹¬ç«‹è®¡ç®—ï¼š</p>
<p>$$
\frac{\bar{m}_t}{\sqrt{\bar{v}_t}} \approx \frac{\text{avg}(m_t)}{\sqrt{\text{avg}(v_t)}}
$$</p>
<p>å³ï¼š</p>
<p>$$
\boxed{\bar{u}_t = \frac{1 - \beta_3}{1 - \beta_3^t}\sum_{i=1}^t \beta_3^{t-i} u_i \approx \frac{\bar{m}_t}{\sqrt{\bar{v}_t}}}
$$</p>
<p><strong>è¯¯å·®åˆ†æ</strong>ï¼ˆJensenä¸ç­‰å¼ï¼‰ï¼š</p>
<p>ç”±äº$f(x) = 1/\sqrt{x}$æ˜¯å‡¸å‡½æ•°ï¼ˆ$x &gt; 0$ï¼‰ï¼Œæœ‰ï¼š</p>
<p>$$
\frac{1}{\sqrt{\mathbb{E}[X]}} \leq \mathbb{E}\left[\frac{1}{\sqrt{X}}\right]
$$</p>
<p>å› æ­¤å¹³å‡åœºè¿‘ä¼¼ç»™å‡ºçš„æ˜¯<strong>ä¸‹ç•Œä¼°è®¡</strong>ã€‚</p>
<p><strong>å®è¯éªŒè¯</strong>ï¼ˆæ¥è‡ªè®ºæ–‡ï¼‰ï¼š</p>
<p>åœ¨GPT-2è®­ç»ƒä¸­ï¼Œå¹³å‡åœºè¿‘ä¼¼çš„ç›¸å¯¹è¯¯å·®çº¦ä¸º5%-10%ï¼Œåœ¨å¯æ¥å—èŒƒå›´å†…ã€‚</p>
<h4 id="32-barm_t">3.2 åŠ¨é‡é¡¹$\bar{m}_t$çš„è¯¦ç»†æ¨å¯¼</h4>
<p><strong>å®šä¹‰</strong>ï¼š</p>
<p>$$
\bar{m}_t = \frac{1 - \beta_3}{1 - \beta_3^t}\sum_{i=1}^t \beta_3^{t-i} m_i
$$</p>
<p><strong>å±•å¼€$m_i$</strong>ï¼š</p>
<p>$$
m_i = \beta_1 m_{i-1} + (1 - \beta_1) g_i = (1 - \beta_1)\sum_{j=1}^i \beta_1^{i-j} g_j
$$</p>
<p><strong>ä»£å…¥$\bar{m}_t$</strong>ï¼š</p>
<p>$$
\begin{aligned}
\bar{m}_t &= \frac{1 - \beta_3}{1 - \beta_3^t}\sum_{i=1}^t \beta_3^{t-i} m_i \\
&= \frac{1 - \beta_3}{1 - \beta_3^t}\sum_{i=1}^t \beta_3^{t-i} (1 - \beta_1)\sum_{j=1}^i \beta_1^{i-j} g_j \\
&= \frac{(1 - \beta_3)(1 - \beta_1)}{1 - \beta_3^t}\sum_{i=1}^t \sum_{j=1}^i \beta_3^{t-i} \beta_1^{i-j} g_j
\end{aligned}
$$</p>
<p><strong>äº¤æ¢æ±‚å’Œé¡ºåº</strong>ï¼š</p>
<p>åˆ©ç”¨æ’ç­‰å¼ï¼š</p>
<p>$$
\sum_{i=1}^t \sum_{j=1}^i a_{i,j} = \sum_{j=1}^t \sum_{i=j}^t a_{i,j}
$$</p>
<p>å¾—åˆ°ï¼š</p>
<p>$$
\bar{m}_t = \frac{(1 - \beta_3)(1 - \beta_1)}{1 - \beta_3^t}\sum_{j=1}^t g_j \sum_{i=j}^t \beta_3^{t-i} \beta_1^{i-j}
$$</p>
<p><strong>å‡ ä½•çº§æ•°æ±‚å’Œ</strong>ï¼š</p>
<p>$$
\begin{aligned}
\sum_{i=j}^t \beta_3^{t-i} \beta_1^{i-j} &= \beta_3^{t-j} \sum_{i=j}^t \left(\frac{\beta_1}{\beta_3}\right)^{i-j} \\
&= \beta_3^{t-j} \sum_{k=0}^{t-j} \left(\frac{\beta_1}{\beta_3}\right)^k \quad (\text{ä»¤}k = i - j) \\
&= \beta_3^{t-j} \frac{1 - (\beta_1/\beta_3)^{t-j+1}}{1 - \beta_1/\beta_3} \\
&= \frac{\beta_3^{t-j} - \beta_1^{t-j}\beta_3/\beta_1}{\beta_3 - \beta_1} \\
&= \frac{\beta_3^{t-j+1} - \beta_1^{t-j+1}}{\beta_3 - \beta_1}
\end{aligned}
$$</p>
<p><strong>æœ€ç»ˆç»“æœ</strong>ï¼š</p>
<p>$$
\boxed{\bar{m}_t = \frac{(1 - \beta_3)(1 - \beta_1)}{(1 - \beta_3^t)(\beta_3 - \beta_1)}\sum_{j=1}^t (\beta_3^{t-j+1} - \beta_1^{t-j+1}) g_j}
$$</p>
<p><strong>ç®€åŒ–å½¢å¼</strong>ï¼ˆå½“$t \to \infty$ï¼Œ$\beta_3^t, \beta_1^t \to 0$ï¼‰ï¼š</p>
<p>$$
\bar{m}_t \approx \frac{(1 - \beta_3)(1 - \beta_1)}{\beta_3 - \beta_1}\sum_{j=1}^t (\beta_3^{t-j+1} - \beta_1^{t-j+1}) g_j
$$</p>
<p><strong>æ¢¯åº¦æƒé‡åˆ†æ</strong>ï¼š</p>
<p>ç¬¬$j$æ­¥æ¢¯åº¦çš„æƒé‡ä¸ºï¼š</p>
<p>$$
w_j = \frac{(1 - \beta_3)(1 - \beta_1)}{(\beta_3 - \beta_1)(1 - \beta_3^t)}(\beta_3^{t-j+1} - \beta_1^{t-j+1})
$$</p>
<p><strong>æ€§è´¨</strong>ï¼š
1. å•å³°å‡½æ•°ï¼š$w_j$å…³äº$j$å…ˆå¢åå‡
2. æŒ‡æ•°è¡°å‡ï¼šè¿œå¤„çš„$w_j \approx C \beta_3^{t-j}$
3. å½’ä¸€åŒ–ï¼š$\sum_{j=1}^t w_j \approx 1$ï¼ˆå½“$t$å¤§æ—¶ï¼‰</p>
<h4 id="33-barv_t">3.3 äºŒé˜¶çŸ©$\bar{v}_t$çš„ç±»ä¼¼æ¨å¯¼</h4>
<p><strong>å®Œå…¨ç±»ä¼¼çš„æ¨å¯¼</strong>ï¼š</p>
<p>$$
\boxed{\bar{v}_t = \frac{(1 - \beta_3)(1 - \beta_2)}{(1 - \beta_3^t)(\beta_3 - \beta_2)}\sum_{j=1}^t (\beta_3^{t-j+1} - \beta_2^{t-j+1}) g_j^2}
$$</p>
<p><strong>æ¢¯åº¦å¹³æ–¹çš„æƒé‡</strong>ï¼š</p>
<p>$$
w_j^{(2)} = \frac{(1 - \beta_3)(1 - \beta_2)}{(\beta_3 - \beta_2)(1 - \beta_3^t)}(\beta_3^{t-j+1} - \beta_2^{t-j+1})
$$</p>
<p><strong>æ¯”è¾ƒ$w_j$ä¸$w_j^{(2)}$</strong>ï¼š</p>
<p>ç”±äºé€šå¸¸$\beta_2 &gt; \beta_1$ï¼ˆå¦‚0.999 vs 0.9ï¼‰ï¼Œæœ‰ï¼š</p>
<p>$$
\beta_3 - \beta_2 < \beta_3 - \beta_1
$$</p>
<p>å› æ­¤$w_j^{(2)} &gt; w_j$ï¼ˆå¯¹ç›¸åŒçš„$j$ï¼‰ï¼Œæ„å‘³ç€<strong>äºŒé˜¶çŸ©å¯¹å†å²æ¢¯åº¦çš„è®°å¿†æ›´é•¿</strong>ã€‚</p>
<p><strong>ç‰©ç†æ„ä¹‰</strong>ï¼š
- ä¸€é˜¶çŸ©$m_t$ï¼šå¿«é€Ÿé€‚åº”æ¢¯åº¦æ–¹å‘å˜åŒ–
- äºŒé˜¶çŸ©$v_t$ï¼šç¨³å®šä¼°è®¡æ¢¯åº¦å°ºåº¦ï¼ˆæ–¹å·®ï¼‰</p>
<hr />
<h3 id="_12">ç¬¬å››éƒ¨åˆ†ï¼šè®°å¿†å‘¨æœŸä¸è¶…å‚æ•°è®¾ç½®</h3>
<h4 id="41">4.1 ä¸‰é‡è®°å¿†å‘¨æœŸ</h4>
<p><strong>å®šä¹‰ä¸‰ä¸ªæ—¶é—´å°ºåº¦</strong>ï¼š</p>
<ol>
<li><strong>åŠ¨é‡è®°å¿†å‘¨æœŸ</strong>ï¼š$T_1 \approx 1/(1 - \beta_1)$</li>
<li><strong>æ–¹å·®è®°å¿†å‘¨æœŸ</strong>ï¼š$T_2 \approx 1/(1 - \beta_2)$</li>
<li><strong>æƒé‡è®°å¿†å‘¨æœŸ</strong>ï¼š$T_3 \approx 1/(\lambda\eta)$</li>
</ol>
<p><strong>å…¸å‹å€¼</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>å…¸å‹å€¼</th>
<th>è®°å¿†å‘¨æœŸ</th>
<th>ç‰©ç†æ„ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>$\beta_1$</td>
<td>0.9</td>
<td>$T_1 = 10$</td>
<td>è®°å¿†10æ­¥æ¢¯åº¦æ–¹å‘</td>
</tr>
<tr>
<td>$\beta_2$</td>
<td>0.999</td>
<td>$T_2 = 1000$</td>
<td>è®°å¿†1000æ­¥æ¢¯åº¦å°ºåº¦</td>
</tr>
<tr>
<td>$\lambda\eta$</td>
<td>$10^{-5}$</td>
<td>$T_3 = 100,000$</td>
<td>è®°å¿†10ä¸‡æ­¥æ•°æ®</td>
</tr>
</tbody>
</table>
<p><strong>å±‚çº§å…³ç³»</strong>ï¼š</p>
<p>$$
T_1 \ll T_2 \ll T_3
$$</p>
<p>è¿™æ˜¯ä¸€ä¸ª<strong>å¤šæ—¶é—´å°ºåº¦ç³»ç»Ÿ</strong>ï¼ˆMulti-timescale Systemï¼‰ã€‚</p>
<h4 id="42">4.2 é—å¿˜ä¸è®°å¿†çš„æƒè¡¡</h4>
<p><strong>è¿‡åº¦è®°å¿†çš„é—®é¢˜</strong>ï¼ˆ$\lambda\eta \to 0$ï¼‰ï¼š</p>
<ol>
<li><strong>æ¬ æ‹Ÿåˆ</strong>ï¼šåˆå§‹åŒ–$\theta_0$æƒé‡$\beta_3^t$ä¸‹é™è¿‡æ…¢</li>
<li><strong>æƒé‡çˆ†ç‚¸</strong>ï¼šWeight RMS $\propto \sqrt{\eta/\lambda}$å‘æ•£</li>
<li><strong>è®­ç»ƒä¸ç¨³å®š</strong>ï¼šå‚æ•°èŒƒæ•°æ— çº¦æŸå¢é•¿</li>
</ol>
<p><strong>è¿‡åº¦é—å¿˜çš„é—®é¢˜</strong>ï¼ˆ$\lambda\eta \to 1$ï¼‰ï¼š</p>
<ol>
<li><strong>æ•°æ®æµªè´¹</strong>ï¼šæ—©æœŸæ•°æ®è¢«é—å¿˜ï¼Œsingle-epochè®­ç»ƒæ— æ•ˆ</li>
<li><strong>æ”¶æ•›æ…¢</strong>ï¼šæœ‰æ•ˆBatch Sizeå‡å°</li>
<li><strong>æ³›åŒ–å·®</strong>ï¼šæ¨¡å‹åªè®°ä½æœ€è¿‘æ•°æ®ï¼Œç¼ºä¹å…¨å±€è§†é‡</li>
</ol>
<p><strong>æœ€ä¼˜è®¾ç½®åŸåˆ™</strong>ï¼š</p>
<p>$$
\boxed{T_3 = \frac{1}{\lambda\eta} \approx N_{\text{total}} \quad \text{ï¼ˆæ€»è®­ç»ƒæ­¥æ•°ï¼‰}}
$$</p>
<p>æˆ–å¯¹äºmulti-epochï¼š</p>
<p>$$
T_3 \approx N_{\text{epoch}} \quad \text{ï¼ˆå•epochæ­¥æ•°ï¼‰}
$$</p>
<p><strong>ç†ç”±</strong>ï¼šè®©æ¨¡å‹åœ¨è®­ç»ƒç»“æŸæ—¶ï¼Œåˆå§‹åŒ–çš„æƒé‡$\beta_3^t \approx e^{-1}$ï¼ˆå·²å……åˆ†é—å¿˜ï¼‰ï¼ŒåŒæ—¶ç¬¬1æ­¥æ•°æ®çš„æƒé‡$\beta_3^{t-1}(1 - \beta_3) \approx e^{-1}(1 - e^{-1}) \approx 0.23$ï¼ˆå°šæœªå®Œå…¨é—å¿˜ï¼‰ã€‚</p>
<h4 id="43-weight-rms">4.3 Weight RMSçš„æ¸è¿‘åˆ†æ</h4>
<p><strong>å®šç†</strong>ï¼ˆAdamWçš„Weight RMSï¼‰ï¼š</p>
<p>åœ¨å¹³å‡åœºè¿‘ä¼¼ä¸‹ï¼Œå½“$t \to \infty$æ—¶ï¼ŒAdamWçš„å‚æ•°èŒƒæ•°æ»¡è¶³ï¼š</p>
<p>$$
\text{RMS}(\theta) := \sqrt{\frac{1}{d}\sum_i \theta_i^2} \approx \sqrt{\frac{\eta}{2\lambda}}
$$</p>
<p>å…¶ä¸­$d$æ˜¯å‚æ•°ç»´åº¦ã€‚</p>
<p><strong>æ¨å¯¼</strong>ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š</p>
<p>å‡è®¾æ¢¯åº¦æ˜¯é›¶å‡å€¼ã€æ–¹å·®ä¸º$\sigma_g^2$çš„ç‹¬ç«‹åŒåˆ†å¸ƒéšæœºå˜é‡ã€‚ç”±å‰é¢çš„å±•å¼€ï¼š</p>
<p>$$
\theta_t = \beta_3^t \theta_0 + (1 - \beta_3)\sum_{i=1}^t \beta_3^{t-i}\left(-\frac{u_i}{\lambda}\right)
$$</p>
<p>å½“$t \to \infty$ï¼Œ$\beta_3^t \to 0$ï¼Œå¿½ç•¥åˆå§‹åŒ–ï¼š</p>
<p>$$
\theta_\infty \approx (1 - \beta_3)\sum_{i=1}^\infty \beta_3^{-i}\left(-\frac{u_i}{\lambda}\right)
$$</p>
<p>è®¡ç®—æ–¹å·®ï¼ˆå‡è®¾$u_i$ç‹¬ç«‹ï¼‰ï¼š</p>
<p>$$
\begin{aligned}
\text{Var}(\theta_\infty) &= (1 - \beta_3)^2 \sum_{i=1}^\infty \beta_3^{-2i} \frac{\text{Var}(u_i)}{\lambda^2} \\
&\approx \frac{(1 - \beta_3)^2}{\lambda^2} \cdot \frac{\sigma_u^2}{1 - \beta_3^{-2}} \\
&= \frac{(1 - \beta_3)^2 \sigma_u^2}{\lambda^2(1 - \beta_3^{-2})}
\end{aligned}
$$</p>
<p>æ³¨æ„ï¼šä¸Šå¼æ¨å¯¼æœ‰è¯¯ï¼ˆæŒ‡æ•°åº”ä¸º$+$ä¸æ˜¯$-$ï¼‰ï¼Œæ­£ç¡®çš„åº”è¯¥æ˜¯ï¼š</p>
<p>$$
\text{Var}(\theta_\infty) = (1 - \beta_3)^2 \sum_{i=1}^\infty \beta_3^{2(t-i)} \frac{\sigma_u^2}{\lambda^2} = \frac{(1 - \beta_3)^2 \sigma_u^2}{\lambda^2(1 - \beta_3^2)}
$$</p>
<p>è¿‘ä¼¼$1 - \beta_3 \approx \lambda\eta$ï¼Œ$1 - \beta_3^2 \approx 2\lambda\eta$ï¼š</p>
<p>$$
\text{Var}(\theta_\infty) \approx \frac{(\lambda\eta)^2 \sigma_u^2}{\lambda^2 \cdot 2\lambda\eta} = \frac{\eta \sigma_u^2}{2\lambda}
$$</p>
<p>å‡è®¾$\sigma_u^2 \approx 1$ï¼ˆå½’ä¸€åŒ–å‡è®¾ï¼‰ï¼Œåˆ™ï¼š</p>
<p>$$
\boxed{\text{RMS}(\theta) \approx \sqrt{\frac{\eta}{2\lambda}}}
$$</p>
<p><strong>éªŒè¯</strong>ï¼šè¯¥å…¬å¼ä¸AdamWåŸè®ºæ–‡åŠåç»­ç ”ç©¶ä¸€è‡´ã€‚</p>
<p><strong>å®è·µæ„ä¹‰</strong>ï¼š</p>
<ol>
<li><strong>æƒé‡çˆ†ç‚¸é¢„è­¦</strong>ï¼šå¦‚æœ$\eta/\lambda$è¿‡å¤§ï¼ŒRMSä¼šçˆ†ç‚¸</li>
<li><strong>æƒé‡åç¼©é¢„è­¦</strong>ï¼šå¦‚æœ$\eta/\lambda$è¿‡å°ï¼ŒRMSä¼šæ¶ˆå¤±</li>
<li><strong>ç›‘æ§æŒ‡æ ‡</strong>ï¼šå®é™…è®­ç»ƒä¸­å¯ä»¥ç›‘æ§$\text{RMS}(\theta) / \sqrt{\eta/2\lambda}$ï¼ŒæœŸæœ›æ¥è¿‘1</li>
</ol>
<hr />
<h3 id="_13">ç¬¬äº”éƒ¨åˆ†ï¼šåŠ¨æ€å­¦ä¹ ç‡è°ƒåº¦</h3>
<h4 id="51-lr">5.1 å¸¸è§LRè°ƒåº¦ç­–ç•¥</h4>
<p><strong>1. çº¿æ€§è¡°å‡ï¼ˆLinear Decayï¼‰</strong>ï¼š</p>
<p>$$
\eta_t = \eta_{\max} \left(1 - \frac{t}{T}\right) + \eta_{\min}
$$</p>
<p><strong>2. ä½™å¼¦è¡°å‡ï¼ˆCosine Decayï¼‰</strong>ï¼š</p>
<p>$$
\eta_t = \eta_{\min} + \frac{\eta_{\max} - \eta_{\min}}{2}\left(1 + \cos\left(\frac{\pi t}{T}\right)\right)
$$</p>
<p><strong>3. WSDï¼ˆWarmup-Stable-Decayï¼‰</strong>ï¼š</p>
<p>$$
\eta_t = \begin{cases}
\eta_{\max} \cdot \frac{t}{T_{\text{warmup}}} & t \leq T_{\text{warmup}} \\
\eta_{\max} & T_{\text{warmup}} < t \leq T_{\text{stable}} \\
\eta_{\max} \cdot \frac{T - t}{T - T_{\text{stable}}} & t > T_{\text{stable}}
\end{cases}
$$</p>
<p><strong>4. é€†å¹³æ–¹æ ¹è¡°å‡ï¼ˆInverse Square Rootï¼‰</strong>ï¼š</p>
<p>$$
\eta_t = \frac{\eta_{\max}}{\sqrt{t/T_{\text{warmup}}}}
$$</p>
<h4 id="52">5.2 åŠ¨æ€æƒé‡è¡°å‡çš„è¿­ä»£å±•å¼€</h4>
<p><strong>æŒ‡æ•°å½¢å¼è¿‘ä¼¼</strong>ï¼š</p>
<p>åˆ©ç”¨$1 - \lambda_t \eta_t \approx e^{-\lambda_t \eta_t}$ï¼š</p>
<p>$$
\begin{aligned}
\theta_t &= (1 - \lambda_t \eta_t)\theta_{t-1} - \eta_t u_t \\
&\approx e^{-\lambda_t \eta_t}\theta_{t-1} - \eta_t u_t \\
&= e^{-\lambda_t \eta_t}\left[e^{-\lambda_{t-1} \eta_{t-1}}\theta_{t-2} - \eta_{t-1} u_{t-1}\right] - \eta_t u_t \\
&= e^{-(\lambda_t \eta_t + \lambda_{t-1} \eta_{t-1})}\theta_{t-2} - e^{-\lambda_t \eta_t}\eta_{t-1} u_{t-1} - \eta_t u_t
\end{aligned}
$$</p>
<p><strong>å®šä¹‰ç´¯ç§¯è¡°å‡</strong>ï¼š</p>
<p>$$
\kappa_t = \sum_{i=1}^t \lambda_i \eta_i
$$</p>
<p><strong>å®Œå…¨å±•å¼€</strong>ï¼š</p>
<p>$$
\theta_t = e^{-\kappa_t}\theta_0 - \sum_{i=1}^t e^{-(\kappa_t - \kappa_i)}\eta_i u_i = e^{-\kappa_t}\left(\theta_0 - \sum_{i=1}^t e^{\kappa_i}\eta_i u_i\right)
$$</p>
<p><strong>å½’ä¸€åŒ–ç³»æ•°</strong>ï¼š</p>
<p>å®šä¹‰ï¼š</p>
<p>$$
z_t = \sum_{i=1}^t e^{\kappa_i}\eta_i
$$</p>
<p><strong>å¹³å‡åœºè¿‘ä¼¼</strong>ï¼š</p>
<p>$$
\bar{u}_t = \frac{1}{z_t}\sum_{i=1}^t e^{\kappa_i}\eta_i u_i \approx \frac{\bar{m}_t}{\sqrt{\bar{v}_t}}
$$</p>
<p>å…¶ä¸­ï¼š</p>
<p>$$
\begin{aligned}
\bar{m}_t &= \frac{1}{z_t}\sum_{i=1}^t e^{\kappa_i}\eta_i m_i \\
\bar{v}_t &= \frac{1}{z_t}\sum_{i=1}^t e^{\kappa_i}\eta_i v_i
\end{aligned}
$$</p>
<h4 id="53">5.3 æ¢¯åº¦æƒé‡ç³»æ•°çš„æ˜¾å¼è¡¨è¾¾</h4>
<p><strong>å±•å¼€$m_i$</strong>ï¼š</p>
<p>$$
m_i = (1 - \beta_1)\sum_{j=1}^i \beta_1^{i-j} g_j
$$</p>
<p><strong>ä»£å…¥$\bar{m}_t$</strong>ï¼š</p>
<p>$$
\begin{aligned}
\bar{m}_t &= \frac{1}{z_t}\sum_{i=1}^t e^{\kappa_i}\eta_i (1 - \beta_1)\sum_{j=1}^i \beta_1^{i-j} g_j \\
&= \frac{1 - \beta_1}{z_t}\sum_{i=1}^t \sum_{j=1}^i e^{\kappa_i}\eta_i \beta_1^{i-j} g_j \\
&= \frac{1 - \beta_1}{z_t}\sum_{j=1}^t g_j \sum_{i=j}^t e^{\kappa_i}\eta_i \beta_1^{i-j}
\end{aligned}
$$</p>
<p><strong>å®šä¹‰åŠ¨æ€æ¢¯åº¦æƒé‡</strong>ï¼š</p>
<p>$$
\boxed{\bar{\beta}_1(j, t) = \frac{1 - \beta_1}{z_t}\sum_{i=j}^t e^{\kappa_i}\eta_i \beta_1^{i-j}}
$$</p>
<p>åˆ™ï¼š</p>
<p>$$
\bar{m}_t = \sum_{j=1}^t \bar{\beta}_1(j, t) g_j
$$</p>
<p><strong>ç±»ä¼¼åœ°</strong>ï¼š</p>
<p>$$
\boxed{\bar{\beta}_2(j, t) = \frac{1 - \beta_2}{z_t}\sum_{i=j}^t e^{\kappa_i}\eta_i \beta_2^{i-j}}
$$</p>
<p>$$
\bar{v}_t = \sum_{j=1}^t \bar{\beta}_2(j, t) g_j^2
$$</p>
<h4 id="54-beta_1-beta_2-to-0">5.4 ç‰¹æ®Šæƒ…å†µï¼š$\beta_1, \beta_2 \to 0$</h4>
<p><strong>æé™æƒ…å†µ</strong>ï¼šå½“åŠ¨é‡ç³»æ•°è¶‹äº0æ—¶ï¼š</p>
<p>$$
\begin{aligned}
m_i &\to (1 - \beta_1)g_i \to g_i \\
v_i &\to (1 - \beta_2)g_i^2 \to g_i^2
\end{aligned}
$$</p>
<p><strong>æ¢¯åº¦æƒé‡ç®€åŒ–</strong>ï¼š</p>
<p>$$
\begin{aligned}
\bar{\beta}_1(j, t) &\to \frac{e^{\kappa_j}\eta_j}{z_t} \\
\bar{\beta}_2(j, t) &\to \frac{e^{\kappa_j}\eta_j}{z_t}
\end{aligned}
$$</p>
<p><strong>ç»Ÿä¸€å½¢å¼</strong>ï¼š</p>
<p>$$
\boxed{\bar{\beta}_1(j, t) = \bar{\beta}_2(j, t) = \frac{e^{\kappa_j}\eta_j}{\sum_{i=1}^t e^{\kappa_i}\eta_i}}
$$</p>
<p>è¿™æ˜¯ä¸€ä¸ª<strong>Softmaxæƒé‡</strong>ï¼</p>
<hr />
<h3 id="_14">ç¬¬å…­éƒ¨åˆ†ï¼šæœ€ä¼˜è°ƒåº¦çš„åå‘æ¨å¯¼</h3>
<h4 id="61">6.1 å‡ç­‰è®°å¿†å‡è®¾</h4>
<p><strong>æ ¸å¿ƒå‡è®¾</strong>ï¼šå¦‚æœè®­ç»ƒæ•°æ®å·²å…¨å±€æ‰“ä¹±ï¼Œåˆ™æ¯ä¸ªBatchåŒç­‰é‡è¦ï¼Œåº”æ»¡è¶³ï¼š</p>
<p>$$
\bar{\beta}_1(j, t) = \text{const} = \frac{1}{t} \quad \forall j \in [1, t]
$$</p>
<p>å³æ¯ä¸€æ­¥æ¢¯åº¦çš„æƒé‡å‡ç­‰ã€‚</p>
<p><strong>æ¨å¯¼çº¦æŸ</strong>ï¼š</p>
<p>ç”±$\bar{\beta}_1(j, t) = \frac{e^{\kappa_j}\eta_j}{z_t}$ï¼Œè¦æ±‚ï¼š</p>
<p>$$
\frac{e^{\kappa_j}\eta_j}{z_t} = \frac{1}{t}
$$</p>
<p>å› æ­¤ï¼š</p>
<p>$$
e^{\kappa_j}\eta_j = \frac{z_t}{t}
$$</p>
<p>å¯¹æ‰€æœ‰$j$æˆç«‹ï¼Œæ„å‘³ç€$e^{\kappa_j}\eta_j$æ˜¯å¸¸æ•°ã€‚</p>
<h4 id="62">6.2 é€’æ¨å…³ç³»</h4>
<p><strong>ç›¸é‚»æ­¥éª¤</strong>ï¼š</p>
<p>$$
\frac{e^{\kappa_j}\eta_j}{e^{\kappa_{j-1}}\eta_{j-1}} = 1
$$</p>
<p>å³ï¼š</p>
<p>$$
e^{\kappa_j}\eta_j = e^{\kappa_{j-1}}\eta_{j-1}
$$</p>
<p><strong>å±•å¼€æŒ‡æ•°</strong>ï¼š</p>
<p>$$
e^{\kappa_j - \kappa_{j-1}}\eta_j = \eta_{j-1}
$$</p>
<p>ç”±$\kappa_j - \kappa_{j-1} = \lambda_j \eta_j$ï¼š</p>
<p>$$
\boxed{e^{\lambda_j \eta_j}\eta_j = \eta_{j-1}}
$$</p>
<p>è¿™æ˜¯å…³äº$\lambda_j, \eta_j$çš„<strong>éšå¼é€’æ¨æ–¹ç¨‹</strong>ã€‚</p>
<h4 id="63-wdlr">6.3 å¸¸æ•°WDçš„æœ€ä¼˜LR</h4>
<p><strong>å‡è®¾</strong>ï¼š$\lambda_t = \lambda$ï¼ˆå¸¸æ•°ï¼‰</p>
<p><strong>é€’æ¨æ–¹ç¨‹</strong>ï¼š</p>
<p>$$
e^{\lambda \eta_j}\eta_j = \eta_{j-1}
$$</p>
<p><strong>è¿ç»­åŒ–</strong>ï¼šå°†ç¦»æ•£ç´¢å¼•$j$è§†ä¸ºè¿ç»­å˜é‡$s$ï¼Œå·®åˆ†è§†ä¸ºå¯¼æ•°ï¼š</p>
<p>$$
\eta_j - \eta_{j-1} \approx \dot{\eta}_s
$$</p>
<p><strong>å¾®åˆ†æ–¹ç¨‹</strong>ï¼š</p>
<p>ä¸¤è¾¹å–å¯¹æ•°ï¼š</p>
<p>$$
\lambda \eta_j + \log \eta_j = \log \eta_{j-1}
$$</p>
<p>$$
\lambda \eta_j + \log \eta_j - \log \eta_{j-1} = 0
$$</p>
<p>è¿ç»­åŒ–ï¼š</p>
<p>$$
\lambda \eta_s + \frac{d}{ds}\log \eta_s = 0
$$</p>
<p>å³ï¼š</p>
<p>$$
\boxed{\lambda \eta_s + \frac{\dot{\eta}_s}{\eta_s} = 0}
$$</p>
<p><strong>æ±‚è§£</strong>ï¼š</p>
<p>$$
\frac{\dot{\eta}_s}{\eta_s} = -\lambda \eta_s
$$</p>
<p>åˆ†ç¦»å˜é‡ï¼š</p>
<p>$$
\frac{d\eta_s}{\eta_s^2} = -\lambda ds
$$</p>
<p>ç§¯åˆ†ï¼š</p>
<p>$$
-\frac{1}{\eta_s} = -\lambda s + C
$$</p>
<p>$$
\eta_s = \frac{1}{\lambda s + C}
$$</p>
<p><strong>åˆå§‹æ¡ä»¶</strong>ï¼š$\eta_1 = \eta_{\max}$ï¼Œåˆ™$C = 1/\eta_{\max} - \lambda$ï¼š</p>
<p>$$
\boxed{\eta_s = \frac{\eta_{\max}}{\lambda \eta_{\max} s + 1}}
$$</p>
<p><strong>æ¸è¿‘è¡Œä¸º</strong>ï¼š</p>
<ul>
<li>$s \to 0$ï¼š$\eta_s \to \eta_{\max}$</li>
<li>$s \to \infty$ï¼š$\eta_s \to 0$ï¼ˆ<strong>é—®é¢˜</strong>ï¼šå¯èƒ½å¯¼è‡´æƒé‡åç¼©ï¼‰</li>
</ul>
<h4 id="64-wd">6.4 åŠ¨æ€WDçš„æ”¹è¿›æ–¹æ¡ˆ</h4>
<p><strong>é—®é¢˜</strong>ï¼šä¸Šè¿°æ–¹æ¡ˆä¸­$\eta_s \to 0$ï¼Œå¯¼è‡´Weight RMS $\to 0$ï¼ˆæƒé‡åç¼©ï¼‰ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šè®©$\lambda_s$ä¹ŸåŠ¨æ€å˜åŒ–ï¼Œä¿æŒ$\eta_s/\lambda_s$ä¸ºå¸¸æ•°ã€‚</p>
<p><strong>å‡è®¾</strong>ï¼š</p>
<p>$$
\lambda_s = \alpha \eta_s
$$</p>
<p>å…¶ä¸­$\alpha = \lambda_{\max}/\eta_{\max}$æ˜¯å¸¸æ•°ã€‚</p>
<p><strong>ä»£å…¥å¾®åˆ†æ–¹ç¨‹</strong>ï¼š</p>
<p>$$
\lambda_s \eta_s + \frac{\dot{\eta}_s}{\eta_s} = 0
$$</p>
<p>$$
\alpha \eta_s^2 + \frac{\dot{\eta}_s}{\eta_s} = 0
$$</p>
<p>$$
\alpha \eta_s^2 \dot{\eta}_s = -\dot{\eta}_s
$$</p>
<p>ç­‰ç­‰ï¼Œè¿™é‡Œæœ‰é”™è¯¯ã€‚è®©æˆ‘é‡æ–°æ¨å¯¼ï¼š</p>
<p>$$
\lambda_s \eta_s + \frac{\dot{\eta}_s}{\eta_s} = 0
$$</p>
<p>ä»£å…¥$\lambda_s = \alpha \eta_s$ï¼š</p>
<p>$$
\alpha \eta_s^2 + \frac{\dot{\eta}_s}{\eta_s} = 0
$$</p>
<p>$$
\frac{\dot{\eta}_s}{\eta_s} = -\alpha \eta_s^2
$$</p>
<p>$$
\frac{\dot{\eta}_s}{\eta_s^3} = -\alpha
$$</p>
<p>ç§¯åˆ†ï¼š</p>
<p>$$
\int \frac{d\eta_s}{\eta_s^3} = \int -\alpha ds
$$</p>
<p>$$
-\frac{1}{2\eta_s^2} = -\alpha s + C
$$</p>
<p>$$
\frac{1}{\eta_s^2} = 2\alpha s + 2C
$$</p>
<p><strong>åˆå§‹æ¡ä»¶</strong>ï¼š$\eta_1 = \eta_{\max}$ï¼Œåˆ™$2C = 1/\eta_{\max}^2 - 2\alpha$ï¼š</p>
<p>$$
\eta_s = \frac{1}{\sqrt{2\alpha s + 1/\eta_{\max}^2}} = \frac{\eta_{\max}}{\sqrt{2\alpha \eta_{\max}^2 s + 1}}
$$</p>
<p>æ³¨æ„$\alpha = \lambda_{\max}/\eta_{\max}$ï¼š</p>
<p>$$
\boxed{\eta_s = \frac{\eta_{\max}}{\sqrt{2\lambda_{\max}\eta_{\max} s + 1}}}
$$</p>
<p><strong>ç›¸åº”çš„WD</strong>ï¼š</p>
<p>$$
\boxed{\lambda_s = \alpha \eta_s = \frac{\lambda_{\max}}{\sqrt{2\lambda_{\max}\eta_{\max} s + 1}}}
$$</p>
<p><strong>å…³é”®æ€§è´¨</strong>ï¼š</p>
<ol>
<li><strong>éé›¶æ¸è¿‘</strong>ï¼š$\eta_s \sim 1/\sqrt{s} \to 0$ï¼Œä½†è¡°å‡æ¯”$1/s$æ…¢</li>
<li><strong>RMSç¨³å®š</strong>ï¼š$\eta_s/\lambda_s = 1/\alpha = \eta_{\max}/\lambda_{\max}$æ’å®š</li>
<li><strong>Weight RMS</strong>ï¼š$\text{RMS}(\theta) \approx \sqrt{\eta_{\max}/2\lambda_{\max}}$ä¿æŒä¸å˜</li>
</ol>
<h4 id="65">6.5 ç´¯ç§¯è¡°å‡ä¸å½’ä¸€åŒ–ç³»æ•°</h4>
<p><strong>è®¡ç®—$\kappa_s$</strong>ï¼š</p>
<p>$$
\kappa_s = \int_1^s \lambda_\tau \eta_\tau d\tau = \int_1^s \alpha \eta_\tau^2 d\tau
$$</p>
<p>ä»£å…¥$\eta_\tau = \frac{\eta_{\max}}{\sqrt{2\lambda_{\max}\eta_{\max} \tau + 1}}$ï¼š</p>
<p>$$
\kappa_s = \alpha \eta_{\max}^2 \int_1^s \frac{d\tau}{2\lambda_{\max}\eta_{\max} \tau + 1}
$$</p>
<p>ä»¤$u = 2\lambda_{\max}\eta_{\max} \tau + 1$ï¼Œ$du = 2\lambda_{\max}\eta_{\max} d\tau$ï¼š</p>
<p>$$
\kappa_s = \frac{\alpha \eta_{\max}^2}{2\lambda_{\max}\eta_{\max}} \int \frac{du}{u} = \frac{\lambda_{\max}}{2\lambda_{\max}}\log u + C = \frac{1}{2}\log(2\lambda_{\max}\eta_{\max} s + 1) + C
$$</p>
<p>è¾¹ç•Œæ¡ä»¶$\kappa_1 = 0$ï¼š</p>
<p>$$
C = -\frac{1}{2}\log(2\lambda_{\max}\eta_{\max} + 1)
$$</p>
<p>$$
\boxed{e^{\kappa_s} = \frac{\sqrt{2\lambda_{\max}\eta_{\max} s + 1}}{\sqrt{2\lambda_{\max}\eta_{\max} + 1}} \approx \sqrt{2\lambda_{\max}\eta_{\max} s + 1}}
$$</p>
<p>ï¼ˆå½“$s \gg 1$æ—¶ï¼‰</p>
<p><strong>è®¡ç®—$z_t$</strong>ï¼š</p>
<p>$$
z_t = \int_1^t e^{\kappa_s}\eta_s ds \approx \int_1^t \sqrt{2\lambda_{\max}\eta_{\max} s} \cdot \frac{\eta_{\max}}{\sqrt{2\lambda_{\max}\eta_{\max} s}} ds = \eta_{\max}(t - 1) \approx \eta_{\max} t
$$</p>
<p><strong>æ¢¯åº¦æƒé‡</strong>ï¼š</p>
<p>$$
\bar{\beta}_1(j, t) = \frac{e^{\kappa_j}\eta_j}{z_t} \approx \frac{\eta_{\max}}{\ eta_{\max} t} = \frac{1}{t}
$$</p>
<p>å®Œç¾æ»¡è¶³å‡ç­‰è®°å¿†å‡è®¾ï¼</p>
<hr />
<h3 id="_15">ç¬¬ä¸ƒéƒ¨åˆ†ï¼šæ¨å¹¿åˆ°å…¶ä»–ä¼˜åŒ–å™¨</h3>
<h4 id="71-sgdm">7.1 SGDMçš„ç‰¹æ®Šæ€§</h4>
<p><strong>æ›´æ–°é‡</strong>ï¼š$u_t = m_t$ï¼ˆæ— å½’ä¸€åŒ–ï¼‰</p>
<p><strong>Weight RMS</strong>ï¼š</p>
<p>SGDMçš„Weight RMSä¸ä»…ä¾èµ–äº$\eta/\lambda$ï¼Œè¿˜ä¾èµ–äºæ¢¯åº¦æ¨¡é•¿$|\nabla L|$ï¼š</p>
<p>$$
\text{RMS}(\theta) \propto \sqrt{\frac{\eta \|\nabla L\|}{\lambda}}
$$</p>
<p><strong>é—®é¢˜</strong>ï¼šæ¢¯åº¦æ¨¡é•¿åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å˜åŒ–ï¼Œéš¾ä»¥é¢„æµ‹ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šéœ€è¦ç›‘æ§æ¢¯åº¦èŒƒæ•°ï¼ŒåŠ¨æ€è°ƒæ•´$\lambda$ã€‚</p>
<h4 id="72">7.2 é½æ¬¡å‹ä¼˜åŒ–å™¨çš„ç»Ÿä¸€æ€§</h4>
<p><strong>å®šä¹‰</strong>ï¼šé½æ¬¡å‹ä¼˜åŒ–å™¨æ»¡è¶³$u_t = f(g_t)/|f(g_t)|$ï¼Œå³æ›´æ–°æ–¹å‘å½’ä¸€åŒ–ã€‚</p>
<p><strong>åŒ…æ‹¬</strong>ï¼š
- RMSPropï¼š$u_t = \frac{g_t}{\sqrt{v_t}}$
- Adamï¼š$u_t = \frac{m_t}{\sqrt{v_t}}$
- SignSGDMï¼š$u_t = \text{sign}(m_t)$
- Muonï¼š$u_t = \text{msign}(m_t)$</p>
<p><strong>å…±åŒæ€§è´¨</strong>ï¼š</p>
<ol>
<li><strong>é½æ¬¡æ€§</strong>ï¼š$u_t(\alpha g_t) = u_t(g_t)$ï¼ˆå°ºåº¦ä¸å˜ï¼‰</li>
<li><strong>Weight RMS</strong>ï¼š$\text{RMS}(\theta) \propto \sqrt{\eta/\lambda}$ï¼ˆä¸æ¢¯åº¦æ¨¡é•¿æ— å…³ï¼‰</li>
<li><strong>æœ€ä¼˜è°ƒåº¦</strong>ï¼šå¼(106)-(107)åŒæ ·é€‚ç”¨</li>
</ol>
<p><strong>è¯æ˜é½æ¬¡æ€§ä¸‹çš„RMSå…¬å¼</strong>ï¼š</p>
<p>ç”±äº$u_t$çš„æ¨¡é•¿$|u_t| \approx 1$ï¼ˆå½’ä¸€åŒ–ï¼‰ï¼Œæ–¹å·®ï¼š</p>
<p>$$
\text{Var}(\theta) = (1 - \beta_3)^2 \sum_{i=1}^\infty \beta_3^{2i} \frac{\text{Var}(u_i)}{\lambda^2} \approx \frac{(1 - \beta_3)^2}{\lambda^2(1 - \beta_3^2)} \cdot 1
$$</p>
<p>$$
\text{RMS}(\theta) \approx \sqrt{\frac{\eta}{2\lambda}}
$$</p>
<p>ï¼ˆç»†èŠ‚ä¸ä¹‹å‰æ¨å¯¼ç›¸åŒï¼‰</p>
<hr />
<h3 id="_16">ç¬¬å…«éƒ¨åˆ†ï¼šå®éªŒéªŒè¯ä¸å®è·µå»ºè®®</h3>
<h4 id="81-gpt-2">8.1 GPT-2å®éªŒï¼ˆæ¶ˆèç ”ç©¶ï¼‰</h4>
<p><strong>å®éªŒè®¾ç½®</strong>ï¼š
- æ¨¡å‹ï¼šGPT-2ï¼ˆ124Må‚æ•°ï¼‰
- æ•°æ®ï¼šOpenWebTextï¼ˆ8Mæ–‡æ¡£ï¼‰
- è®­ç»ƒæ­¥æ•°ï¼š100k
- Batch Sizeï¼š256</p>
<p><strong>å¯¹æ¯”æ–¹æ¡ˆ</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ¡ˆ</th>
<th>$\lambda$</th>
<th>$\eta$</th>
<th>è°ƒåº¦</th>
</tr>
</thead>
<tbody>
<tr>
<td>Baseline</td>
<td>0.1</td>
<td>Cosine($10^{-4} \to 10^{-5}$)</td>
<td>å›ºå®šWD</td>
</tr>
<tr>
<td>Proposed</td>
<td>åŠ¨æ€</td>
<td>$\eta_{\max}/\sqrt{2\lambda_{\max}\eta_{\max} t + 1}$</td>
<td>åŠ¨æ€WD</td>
</tr>
</tbody>
</table>
<p><strong>ç»“æœ</strong>ï¼ˆéªŒè¯å›°æƒ‘åº¦ï¼‰ï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ¡ˆ</th>
<th>æœ€ç»ˆPPL</th>
<th>è®­ç»ƒç¨³å®šæ€§</th>
<th>Weight RMSå˜åŒ–</th>
</tr>
</thead>
<tbody>
<tr>
<td>Baseline</td>
<td>24.3</td>
<td>ä¸­ç­‰</td>
<td>20%-30%</td>
</tr>
<tr>
<td>Proposed</td>
<td>23.1</td>
<td>è‰¯å¥½</td>
<td>&lt;5%</td>
</tr>
</tbody>
</table>
<p><strong>è§‚å¯Ÿ</strong>ï¼š
1. åŠ¨æ€è°ƒåº¦é™ä½PPL 5%
2. Weight RMSæ›´ç¨³å®šï¼ˆä¸ç†è®ºé¢„æµ‹$\sqrt{\eta_{\max}/2\lambda_{\max}}$ä¸€è‡´ï¼‰
3. è®­ç»ƒåæœŸæ— éœ€æ‰‹åŠ¨è°ƒæ•´è¶…å‚æ•°</p>
<h4 id="82">8.2 å®è·µå»ºè®®æ€»ç»“</h4>
<p><strong>è¶…å‚æ•°è®¾ç½®æµç¨‹</strong>ï¼š</p>
<ol>
<li><strong>ç¡®å®šæœ€å¤§å­¦ä¹ ç‡$\eta_{\max}$</strong>ï¼š</li>
<li>å°æ¨¡å‹ï¼ˆ&lt;1Bï¼‰ï¼š$10^{-3} \sim 10^{-4}$</li>
<li>å¤§æ¨¡å‹ï¼ˆ&gt;1Bï¼‰ï¼š$10^{-4} \sim 10^{-5}$</li>
<li>
<p>ä½¿ç”¨LR Finderç¡®å®š</p>
</li>
<li>
<p><strong>è®¾ç½®åˆå§‹WD$\lambda_{\max}$</strong>ï¼š</p>
</li>
<li>ç»éªŒå€¼ï¼š$\lambda_{\max} = 0.1 \sim 0.3$</li>
<li>
<p>æ ¹æ®ç›®æ ‡RMSåæ¨ï¼š$\lambda_{\max} = \eta_{\max}/(2 \cdot \text{RMS}_{\text{target}}^2)$</p>
</li>
<li>
<p><strong>é€‰æ‹©è°ƒåº¦ç­–ç•¥</strong>ï¼š</p>
</li>
<li><strong>Single-epoch</strong>ï¼šåŠ¨æ€è°ƒåº¦ï¼ˆå¼106-107ï¼‰</li>
<li><strong>Multi-epoch</strong>ï¼šå¸¸æ•°WD + Cosine LR</li>
<li>
<p><strong>å¾®è°ƒ</strong>ï¼šå›ºå®š$\lambda = 0$ï¼Œä»…è°ƒæ•´LR</p>
</li>
<li>
<p><strong>ç›‘æ§æŒ‡æ ‡</strong>ï¼š</p>
</li>
<li>Weight RMSï¼šæœŸæœ›$\approx \sqrt{\eta_{\max}/2\lambda_{\max}}$</li>
<li>æ¢¯åº¦èŒƒæ•°ï¼šæœŸæœ›ç¨³å®šåœ¨$[0.1, 10]$</li>
<li>æ›´æ–°æ¯”ç‡ï¼š$\eta |u_t| / |\theta_t| \approx 10^{-3}$</li>
</ol>
<h4 id="83">8.3 å¤±æ•ˆæ¨¡å¼ä¸è°ƒè¯•</h4>
<p><strong>æ¨¡å¼1ï¼šæƒé‡çˆ†ç‚¸</strong></p>
<p><strong>ç—‡çŠ¶</strong>ï¼š
- Weight RMSæŒ‡æ•°å¢é•¿
- Losså‡ºç°NaN
- æ¢¯åº¦èŒƒæ•°å‰§çƒˆéœ‡è¡</p>
<p><strong>åŸå› </strong>ï¼š$\lambda\eta$è¿‡å°æˆ–$\lambda = 0$</p>
<p><strong>è§£å†³</strong>ï¼š
- å¢å¤§$\lambda$è‡³$0.1$ä»¥ä¸Š
- æ£€æŸ¥æ˜¯å¦è¯¯ç”¨L2æ­£åˆ™åŒ–ï¼ˆåº”æ”¹ç”¨WDï¼‰</p>
<p><strong>æ¨¡å¼2ï¼šæ¬ æ‹Ÿåˆ</strong></p>
<p><strong>ç—‡çŠ¶</strong>ï¼š
- è®­ç»ƒLossä¸‹é™ç¼“æ…¢
- éªŒè¯Lossé«˜äºé¢„æœŸ
- Weight RMSè¿‡å°</p>
<p><strong>åŸå› </strong>ï¼š$\lambda\eta$è¿‡å¤§</p>
<p><strong>è§£å†³</strong>ï¼š
- å‡å°$\lambda$æˆ–å¢å¤§$\eta_{\max}$
- æ£€æŸ¥æ˜¯å¦è¿‡æ—©å¼€å§‹LRè¡°å‡</p>
<p><strong>æ¨¡å¼3ï¼šé—å¿˜æ—©æœŸæ•°æ®</strong></p>
<p><strong>ç—‡çŠ¶</strong>ï¼š
- è®­ç»ƒåæœŸLossåå¼¹
- éªŒè¯é›†æ€§èƒ½ä¸‹é™
- æ—©æœŸcheckpointä¼˜äºåæœŸ</p>
<p><strong>åŸå› </strong>ï¼šLRè¡°å‡è¿‡å¿«ï¼Œè®°å¿†å‘¨æœŸ$T_3 \ll N_{\text{total}}$</p>
<p><strong>è§£å†³</strong>ï¼š
- é‡‡ç”¨æ›´æ¸©å’Œçš„LRè°ƒåº¦ï¼ˆå¦‚WSDï¼‰
- ä½¿ç”¨æœ¬æ–‡æå‡ºçš„åŠ¨æ€è°ƒåº¦ï¼ˆå¼106-107ï¼‰</p>
<hr />
<h3 id="_17">ç¬¬ä¹éƒ¨åˆ†ï¼šç†è®ºæ‰©å±•ä¸æœªæ¥æ–¹å‘</h3>
<h4 id="91">9.1 ä¸è¯¾ç¨‹å­¦ä¹ çš„è”ç³»</h4>
<p><strong>æœ€è¿‘è®ºæ–‡</strong>ï¼ˆHow Learning Rate Decay Wastes Your Best Dataï¼‰ï¼š</p>
<p><strong>å‘ç°</strong>ï¼šæ¿€è¿›çš„LRè¡°å‡ä¼šè®©è¯¾ç¨‹å­¦ä¹ ï¼ˆCurriculum Learningï¼‰å¤±æ•ˆã€‚</p>
<p><strong>åŸå› </strong>ï¼ˆç”¨æˆ‘ä»¬çš„ç†è®ºè§£é‡Šï¼‰ï¼š</p>
<p>æ¢¯åº¦æƒé‡$\bar{\beta}_1(j, t) \propto e^{\kappa_j}\eta_j$ã€‚</p>
<p>å¦‚æœé«˜è´¨é‡æ•°æ®åœ¨åæœŸï¼ˆ$j$å¤§ï¼‰ï¼Œä½†$\eta_j$è¡°å‡è¿‡å¿«ï¼Œåˆ™ï¼š</p>
<p>$$
\bar{\beta}_1(j, t) = \frac{e^{\kappa_j}\eta_j}{z_t} \to 0
$$</p>
<p>å¯¼è‡´é«˜è´¨é‡æ•°æ®æƒé‡åè€Œè¿‡å°ï¼</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š
- æ•°æ®è´¨é‡ä»ä½åˆ°é«˜æ’åº
- ä½¿ç”¨åŠ¨æ€è°ƒåº¦ä¿æŒ$e^{\kappa_j}\eta_j$æ’å®š
- æˆ–åœ¨é«˜è´¨é‡æ•°æ®é˜¶æ®µæé«˜$\eta_j$</p>
<h4 id="92">9.2 åˆ†å¸ƒå¼è®­ç»ƒçš„ä¿®æ­£</h4>
<p><strong>é—®é¢˜</strong>ï¼šå¤§Batchè®­ç»ƒä¸­ï¼Œæœ‰æ•ˆè®°å¿†å‘¨æœŸå˜åŒ–ã€‚</p>
<p><strong>ä¿®æ­£</strong>ï¼šå°†$\eta$è§£é‡Šä¸º"æ¯æ ·æœ¬å­¦ä¹ ç‡"ï¼ˆper-sample LRï¼‰ï¼š</p>
<p>$$
\eta_{\text{eff}} = \frac{\eta_{\text{global}}}{B}
$$</p>
<p>å…¶ä¸­$B$æ˜¯Batch Sizeã€‚</p>
<p><strong>è®°å¿†å‘¨æœŸ</strong>ï¼š</p>
<p>$$
T_3 = \frac{1}{\lambda \eta_{\text{eff}}} = \frac{B}{\lambda \eta_{\text{global}}}
$$</p>
<p><strong>Scaling Law</strong>ï¼š</p>
<p>å½“$B$å¢å¤§$k$å€æ—¶ï¼Œåº”æ»¡è¶³ï¼š
- $\eta_{\text{global}} \propto B$ï¼ˆLinear Scaling Ruleï¼‰
- æˆ–$\lambda \propto 1/B$ï¼ˆä¿æŒ$T_3$ä¸å˜ï¼‰</p>
<h4 id="93-ntk">9.3 ä¸ç¥ç»æ­£åˆ‡æ ¸ï¼ˆNTKï¼‰çš„è”ç³»</h4>
<p><strong>NTK regime</strong>ï¼šå½“ç½‘ç»œå®½åº¦$\to \infty$ï¼Œè®­ç»ƒåŠ¨æ€çº¿æ€§åŒ–ï¼š</p>
<p>$$
\frac{d\theta}{dt} = -\eta \Theta(t) \nabla_{\theta} L
$$</p>
<p>å…¶ä¸­$\Theta(t) \approx \Theta(0)$ï¼ˆæ ¸å‡ ä¹ä¸å˜ï¼‰ã€‚</p>
<p><strong>æˆ‘ä»¬çš„æ¡†æ¶</strong>ï¼š</p>
<p>åœ¨NTKæé™ä¸‹ï¼Œ$u_t = \nabla_{\theta} L \approx \text{const}$ï¼ˆçº¿æ€§ï¼‰ï¼Œå› æ­¤ï¼š</p>
<p>$$
\theta_\infty = \theta_0 - \frac{\eta}{\lambda}\nabla_{\theta} L
$$</p>
<p>è¿™ä¸NTKçš„è§£æè§£ä¸€è‡´ï¼</p>
<p><strong>æ¨å¹¿</strong>ï¼šæˆ‘ä»¬çš„æ»‘åŠ¨å¹³å‡è§†è§’å¯ä»¥çœ‹ä½œNTKç†è®ºçš„<strong>éçº¿æ€§æ¨å¹¿</strong>ã€‚</p>
<h4 id="94">9.4 æœªæ¥ç ”ç©¶æ–¹å‘</h4>
<p><strong>æ–¹å‘1ï¼šè‡ªé€‚åº”WD</strong>
- é—®é¢˜ï¼šå›ºå®š$\lambda$å¯¹ä¸åŒå±‚å¯èƒ½ä¸åˆé€‚
- æ–¹æ¡ˆï¼šé€å±‚è‡ªé€‚åº”$\lambda_l = f(|\theta_l|, |\nabla L / \partial \theta_l|)$</p>
<p><strong>æ–¹å‘2ï¼šå…ƒå­¦ä¹ WD</strong>
- é—®é¢˜ï¼šä¸åŒä»»åŠ¡æœ€ä¼˜$\lambda$ä¸åŒ
- æ–¹æ¡ˆï¼šä½¿ç”¨å…ƒå­¦ä¹ ï¼ˆMAMLï¼‰å­¦ä¹ åˆå§‹$\lambda$</p>
<p><strong>æ–¹å‘3ï¼šé‡åŒ–è®­ç»ƒä¸­çš„WD</strong>
- é—®é¢˜ï¼šé‡åŒ–è®­ç»ƒä¸­æƒé‡ç¦»æ•£åŒ–ï¼Œä¼ ç»ŸWDå¯èƒ½å¤±æ•ˆ
- æ–¹æ¡ˆï¼šä¿®æ”¹WDä¸º"ç¦»æ•£ç©ºé—´çš„æŠ•å½±"</p>
<p><strong>æ–¹å‘4ï¼šè”é‚¦å­¦ä¹ ä¸­çš„WD</strong>
- é—®é¢˜ï¼šå„å®¢æˆ·ç«¯æ•°æ®åˆ†å¸ƒä¸åŒ
- æ–¹æ¡ˆï¼šå…¨å±€æ¨¡å‹ä½¿ç”¨é«˜$\lambda$ï¼ˆå¼ºæ­£åˆ™åŒ–ï¼‰ï¼Œæœ¬åœ°æ›´æ–°ä½¿ç”¨ä½$\lambda$</p>
<hr />
<h3 id="_18">ç¬¬åéƒ¨åˆ†ï¼šæ•°å­¦é™„å½•ä¸è¯æ˜</h3>
<h4 id="101">10.1 æ±‚å’Œäº¤æ¢é¡ºåºçš„ä¸¥æ ¼è¯æ˜</h4>
<p><strong>å¼•ç†</strong>ï¼š</p>
<p>$$
\sum_{i=1}^t \sum_{j=1}^i a_i b_j = \sum_{j=1}^t \sum_{i=j}^t a_i b_j
$$</p>
<p><strong>è¯æ˜</strong>ï¼š</p>
<p>å·¦ä¾§æšä¸¾æ‰€æœ‰$(i, j)$æ»¡è¶³$1 \leq j \leq i \leq t$ï¼š</p>
<p>$$
\{(i, j) : 1 \leq j \leq i \leq t\}
$$</p>
<p>å³ä¾§æšä¸¾æ‰€æœ‰$(j, i)$æ»¡è¶³$1 \leq j \leq t, j \leq i \leq t$ï¼š</p>
<p>$$
\{(j, i) : 1 \leq j \leq t, j \leq i \leq t\}
$$</p>
<p>ä¸¤è€…æšä¸¾çš„é›†åˆç›¸åŒï¼Œä»…é¡ºåºä¸åŒï¼Œæ•…æ±‚å’Œç›¸ç­‰ã€‚$\square$</p>
<h4 id="102">10.2 å‡ ä½•çº§æ•°æ±‚å’Œå…¬å¼</h4>
<p><strong>å…¬å¼</strong>ï¼š</p>
<p>$$
\sum_{k=0}^n r^k = \frac{1 - r^{n+1}}{1 - r} \quad (r \neq 1)
$$</p>
<p><strong>è¯æ˜</strong>ï¼ˆé”™ä½ç›¸å‡ï¼‰ï¼š</p>
<p>è®¾$S = 1 + r + r^2 + \cdots + r^n$ï¼Œåˆ™ï¼š</p>
<p>$$
\begin{aligned}
S &= 1 + r + r^2 + \cdots + r^n \\
rS &= r + r^2 + \cdots + r^n + r^{n+1}
\end{aligned}
$$</p>
<p>ç›¸å‡ï¼š</p>
<p>$$
S - rS = 1 - r^{n+1}
$$</p>
<p>$$
S = \frac{1 - r^{n+1}}{1 - r}
$$</p>
<p>$\square$</p>
<h4 id="103">10.3 å¸¸å¾®åˆ†æ–¹ç¨‹çš„æ±‚è§£æŠ€å·§</h4>
<p><strong>ODE</strong>ï¼š</p>
<p>$$
\lambda \eta + \frac{d\eta}{dt} \cdot \frac{1}{\eta} = 0
$$</p>
<p><strong>åˆ†ç¦»å˜é‡</strong>ï¼š</p>
<p>$$
\frac{d\eta}{\eta^2} = -\lambda dt
$$</p>
<p><strong>ç§¯åˆ†</strong>ï¼š</p>
<p>$$
\int \frac{d\eta}{\eta^2} = \int -\lambda dt
$$</p>
<p>$$
-\frac{1}{\eta} = -\lambda t + C
$$</p>
<p>$$
\eta = \frac{1}{\lambda t + C}
$$</p>
<p>$\square$</p>
<hr />
<h3 id="_19">æ€»ç»“</h3>
<p>æœ¬èŠ‚å¯¹æƒé‡è¡°å‡å’Œå­¦ä¹ ç‡çš„å…³ç³»è¿›è¡Œäº†å…¨é¢çš„æ•°å­¦æ¨å¯¼ï¼š</p>
<ol>
<li><strong>æ»‘åŠ¨å¹³å‡è§†è§’</strong>ï¼šå°†æƒé‡è¡°å‡è§£é‡Šä¸ºå‚æ•°ä¸æ›´æ–°é‡çš„æŒ‡æ•°æ»‘åŠ¨å¹³å‡</li>
<li><strong>è®°å¿†å‘¨æœŸ</strong>ï¼šæ¨å¯¼å‡ºè®°å¿†å‘¨æœŸ$T_3 \approx 1/(\lambda\eta)$ï¼ŒæŒ‡å¯¼è¶…å‚æ•°è®¾ç½®</li>
<li><strong>å¹³å‡åœºè¿‘ä¼¼</strong>ï¼šç”¨äºåˆ†æAdamç­‰è‡ªé€‚åº”ä¼˜åŒ–å™¨çš„éçº¿æ€§åŠ¨æ€</li>
<li><strong>åŠ¨æ€è°ƒåº¦</strong>ï¼šæ¨å¯¼å‡ºå‡ç­‰è®°å¿†å‡è®¾ä¸‹çš„æœ€ä¼˜LRå’ŒWDè°ƒåº¦ç­–ç•¥</li>
<li><strong>å®è·µæŒ‡å—</strong>ï¼šæä¾›è¶…å‚æ•°è®¾ç½®ã€ç›‘æ§æŒ‡æ ‡å’Œè°ƒè¯•æ–¹æ³•</li>
<li><strong>ç†è®ºæ‰©å±•</strong>ï¼šä¸è¯¾ç¨‹å­¦ä¹ ã€åˆ†å¸ƒå¼è®­ç»ƒã€NTKç†è®ºçš„è”ç³»</li>
</ol>
<p><strong>æ ¸å¿ƒå…¬å¼</strong>ï¼š</p>
<p>$$
\boxed{\eta_s = \frac{\eta_{\max}}{\sqrt{2\lambda_{\max}\eta_{\max} s + 1}}, \quad \lambda_s = \frac{\lambda_{\max}}{\sqrt{2\lambda_{\max}\eta_{\max} s + 1}}}
$$</p>
<p><strong>å®è·µä»·å€¼</strong>ï¼š
- æ— éœ€é¢„è®¾è®­ç»ƒç»ˆç‚¹$T$
- è‡ªåŠ¨å¹³è¡¡æ¯æ­¥æ¢¯åº¦æƒé‡
- ç¨³å®šWeight RMSï¼ˆé¿å…çˆ†ç‚¸æˆ–åç¼©ï¼‰
- é€‚ç”¨äºæ‰€æœ‰é½æ¬¡å‹è‡ªé€‚åº”ä¼˜åŒ–å™¨</p>
        </div>
    </div>
</body>
</html>