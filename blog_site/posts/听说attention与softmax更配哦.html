<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¬è¯´Attentionä¸Softmaxæ›´é…å“¦ï½</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>å¬è¯´Attentionä¸Softmaxæ›´é…å“¦ï½</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-26 | ğŸ“„ å¤§å°: 27.0 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/9019">https://spaces.ac.cn/archives/9019</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>ä¸çŸ¥é“å¤§å®¶ç•™æ„åˆ°ä¸€ä¸ªç»†èŠ‚æ²¡æœ‰ï¼Œå°±æ˜¯å½“å‰NLPä¸»æµçš„é¢„è®­ç»ƒæ¨¡å¼éƒ½æ˜¯åœ¨ä¸€ä¸ªå›ºå®šé•¿åº¦ï¼ˆæ¯”å¦‚512ï¼‰ä¸Šè¿›è¡Œï¼Œç„¶åç›´æ¥å°†é¢„è®­ç»ƒå¥½çš„æ¨¡å‹ç”¨äºä¸åŒé•¿åº¦çš„ä»»åŠ¡ä¸­ã€‚å¤§å®¶ä¼¼ä¹ä¹Ÿæ²¡æœ‰å¯¹è¿™ç§æ¨¡å¼æœ‰è¿‡æ€€ç–‘ï¼Œä»¿ä½›æ¨¡å‹å¯ä»¥è‡ªåŠ¨æ³›åŒ–åˆ°ä¸åŒé•¿åº¦æ˜¯ä¸€ä¸ªâ€œç†æ‰€åº”å½“â€çš„èƒ½åŠ›ã€‚</p>
<p>å½“ç„¶ï¼Œç¬”è€…æ­¤å‰åŒæ ·ä¹Ÿæ²¡æœ‰è¿‡ç±»ä¼¼çš„è´¨ç–‘ï¼Œç›´åˆ°å‰å‡ å¤©ç¬”è€…åšäº†Baseç‰ˆçš„GAUå®éªŒåæ‰å‘ç°GAUçš„é•¿åº¦æ³›åŒ–èƒ½åŠ›å¹¶ä¸å¦‚æƒ³è±¡ä¸­å¥½ã€‚ç»è¿‡è¿›ä¸€æ­¥åˆ†æåï¼Œç¬”è€…æ‰æ˜ç™½åŸæ¥è¿™ç§é•¿åº¦æ³›åŒ–çš„èƒ½åŠ›å¹¶ä¸æ˜¯â€œç†æ‰€å½“ç„¶â€çš„......</p>
<h2 id="_1">æ¨¡å‹å›é¡¾</h2>
<p>åœ¨<a href="/archives/8934">ã€ŠFLASHï¼šå¯èƒ½æ˜¯è¿‘æ¥æœ€æœ‰æ„æ€çš„é«˜æ•ˆTransformerè®¾è®¡ã€‹</a>ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†â€œé—¨æ§æ³¨æ„åŠ›å•å…ƒGAUâ€ï¼Œå®ƒæ˜¯ä¸€ç§èåˆäº†GLUå’ŒAttentionçš„æ–°è®¾è®¡ã€‚</p>
<p>é™¤äº†æ•ˆæœï¼ŒGAUåœ¨è®¾è®¡ä¸Šç»™æˆ‘ä»¬å¸¦æ¥çš„å†²å‡»ä¸»è¦æœ‰ä¸¤ç‚¹ï¼šä¸€æ˜¯å®ƒæ˜¾ç¤ºäº†å•å¤´æ³¨æ„åŠ›æœªå¿…å°±é€Šè‰²äºå¤šå¤´æ³¨æ„åŠ›ï¼Œè¿™å¥ å®šäº†å®ƒâ€œå¿«â€ã€â€œçœâ€çš„åœ°ä½ï¼›äºŒæ˜¯å®ƒæ˜¯æ˜¾ç¤ºäº†æ³¨æ„åŠ›æœªå¿…éœ€è¦Softmaxå½’ä¸€åŒ–ï¼Œå¯ä»¥æ¢æˆç®€å•çš„$\text{relu}^2$é™¤ä»¥åºåˆ—é•¿åº¦ï¼š<br />
\begin{equation}\boldsymbol{A}=\frac{1}{n}\text{relu}^2\left(\frac{\mathcal{Q}(\boldsymbol{Z})\mathcal{K}(\boldsymbol{Z})^{\top}}{\sqrt{s}}\right)=\frac{1}{ns}\text{relu}^2\left(\mathcal{Q}(\boldsymbol{Z})\mathcal{K}(\boldsymbol{Z})^{\top}\right)\end{equation}<br />
è¿™ä¸ªå½¢å¼å¯¼è‡´äº†ä¸€ä¸ªæœ‰æ„æ€çš„é—®é¢˜ï¼šå¦‚æœæˆ‘ä»¬é¢„è®­ç»ƒçš„æ—¶å€™å°½é‡å°†æ ·æœ¬æ•´ç†æˆåŒä¸€é•¿åº¦ï¼ˆæ¯”å¦‚512ï¼‰ï¼Œé‚£ä¹ˆåœ¨é¢„è®­ç»ƒé˜¶æ®µ$n$å‡ ä¹ä¸€ç›´å°±æ˜¯512ï¼Œä¹Ÿå°±æ˜¯è¯´$n$ç›¸å½“äºä¸€ä¸ªå¸¸æ•°ï¼Œå¦‚æœæˆ‘ä»¬å°†å®ƒç”¨äºå…¶ä»–é•¿åº¦ï¼ˆæ¯”å¦‚64ã€128ï¼‰å¾®è°ƒï¼Œé‚£ä¹ˆè¿™ä¸ª$n$ç©¶ç«Ÿè¦è‡ªåŠ¨æ”¹ä¸ºæ ·æœ¬é•¿åº¦ï¼Œè¿˜æ˜¯ä¿æŒä¸º512å‘¢ï¼Ÿ</p>
<p>ç›´è§‰åº”è¯¥æ˜¯ç­‰äºæ ·æœ¬é•¿åº¦æ›´åŠ è‡ªé€‚åº”ä¸€äº›ï¼Œä½†ç­”æ¡ˆå¾ˆåç›´è§‰ï¼š$n$å›ºå®šä¸º512çš„å¾®è°ƒæ•ˆæœæ¯”$n$å–æ ·æœ¬é•¿åº¦çš„æ•ˆæœè¦æ˜æ˜¾å¥½ï¼è¿™å°±å¼•äººæ·±æ€äº†......</p>
<h2 id="_2">é—®é¢˜å®šä½</h2>
<p>å¦‚æœå•çœ‹GAUçš„é¢„è®­ç»ƒæ•ˆæœï¼Œå®ƒæ˜¯ä¼˜äºæ ‡å‡†Attentionçš„ï¼Œæ‰€ä»¥GAUæœ¬èº«çš„æ‹Ÿåˆèƒ½åŠ›åº”è¯¥æ˜¯æ²¡é—®é¢˜çš„ï¼Œåªæ˜¯$\frac{1}{n}\text{relu}^2(\cdot)$åœ¨æ ·æœ¬é•¿åº¦æ–¹é¢çš„è¿ç§»èƒ½åŠ›ä¸å¥½ã€‚ä¸ºäº†ç¡®è®¤è¿™ä¸€ç‚¹ï¼Œç¬”è€…ä¹Ÿå°è¯•äº†æ··åˆä¸åŒé•¿åº¦çš„æ ·æœ¬æ¥åšGAUçš„é¢„è®­ç»ƒï¼Œå‘ç°ç»“æœä¼šæœ‰æ˜æ˜¾çš„æ”¹å–„ã€‚</p>
<p>é‚£ä¹ˆï¼Œå¯èƒ½æ˜¯GAUçš„ä»€ä¹ˆåœ°æ–¹å‡ºäº†é—®é¢˜å‘¢ï¼Ÿå…¶å®è¿™ä¸éš¾çŒœæµ‹ï¼ŒGAUçš„æ•´ä½“è¿ç®—å¯ä»¥ç®€å†™æˆ$\boldsymbol{O}=(\boldsymbol{U}\odot\boldsymbol{A}\boldsymbol{V})\boldsymbol{W}_o$ï¼Œå…¶ä¸­$\boldsymbol{U},\boldsymbol{V},\boldsymbol{W}_o$éƒ½æ˜¯token-wiseçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬æ ¹æœ¬ä¸ä¼šå—åˆ°é•¿åº¦å˜åŒ–çš„å½±å“ï¼Œæ‰€ä»¥é—®é¢˜åªèƒ½æ˜¯å‡ºç°åœ¨$\boldsymbol{A}$ä¸­ã€‚</p>
<p>ä»¥å‰æˆ‘ä»¬ç”¨æ ‡å‡†çš„Attentionæ—¶ï¼Œå¹¶æ²¡æœ‰å‡ºç°ç±»ä¼¼çš„é—®é¢˜ï¼Œä»¥è‡³äºæˆ‘ä»¬ä»¥å‰éƒ½æ— æ„è¯†åœ°è§‰å¾—è¿™æ˜¯ä¸€ä¸ªâ€œç†æ‰€å½“ç„¶â€çš„æ€§è´¨ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦ä»GAUçš„Attentionä¸æ ‡å‡†Attentionçš„å·®å¼‚ä¸­å‘ç°é—®é¢˜ã€‚å‰é¢è¯´äº†ï¼Œä¸¤è€…ä¸åŒçš„åœ°æ–¹æœ‰ä¸¤ç‚¹ï¼Œå…¶ä¸€æ˜¯å¤šå¤´Attentionå˜æˆå•å¤´Attentionï¼Œä½†æ˜¯è¿™é¡¶å¤šä¼šè®©æ•ˆæœæœ‰ä¸€å®šæ³¢åŠ¨ï¼Œè€Œæˆ‘ä»¬æµ‹å‡ºæ¥çš„ç»“æœæ˜¯å¤§å¹…ä¸‹é™ï¼Œæ‰€ä»¥é—®é¢˜å°±åªèƒ½å‡ºç°åœ¨å¦ä¸€ç‚¹ï¼Œä¹Ÿå°±æ˜¯å½’ä¸€åŒ–æ–¹å¼ä¸Šï¼Œå³Attentionçš„$softmax$æ¢æˆ$\frac{1}{n}\text{relu}^2(\cdot)$æ‰€å¸¦æ¥çš„ã€‚</p>
<p>éªŒè¯è¿™ä¸ªçŒœæµ‹å¾ˆç®€å•ï¼Œç¬”è€…å°†GAUä¸­Attentionçš„å½’ä¸€åŒ–æ–¹å¼æ¢å›Softmaxåé‡æ–°è®­ç»ƒä¸€ä¸ªGAUæ¨¡å‹ï¼Œç„¶åå¾®è°ƒæµ‹è¯•ä¸åŒé•¿åº¦çš„ä»»åŠ¡ï¼Œå‘ç°å…¶æ•ˆæœæ¯”$\frac{1}{n}\text{relu}^2(\cdot)$æ—¶æ˜æ˜¾è¦å¥½ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¾—å‡ºç»“è®ºï¼šAttentionè¿˜æ˜¯ä¸Softmaxæ›´é…ï½</p>
<h2 id="_3">åŸå› åˆ†æ</h2>
<p>ä¸ºä»€ä¹ˆæ›´ç¬¦åˆç›´è§‰çš„ã€è‡ªé€‚åº”é•¿åº¦çš„$n$åè€Œè¡¨ç°ä¸å¦‚å›ºå®šçš„$n$å‘¢ï¼Ÿæ—¢ç„¶æˆ‘ä»¬å·²ç»ä»¥å¾€ç”¨Softmaxæ˜¯æ²¡æœ‰è¿™ä¸ªé—®é¢˜çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¦¨ä»Softmaxå‡ºå‘æ‰¾æ‰¾çµæ„Ÿã€‚Softmaxçš„æ“ä½œæ˜¯ï¼š<br />
\begin{equation}a_{i,j} = \frac{1}{Z_i}\exp\left(\frac{\boldsymbol{q}<em j="1">i\cdot\boldsymbol{k}_j}{\sqrt{d}}\right),\quad Z_i = \sum</em>}^n \exp\left(\frac{\boldsymbol{q}_i\cdot\boldsymbol{k}_j}{\sqrt{d}}\right)\end{equation<br />
ä¸€ä¸ªç›´æ¥çš„é—®é¢˜å°±æ˜¯ï¼š$Z_i$è·Ÿ$n$çš„å…³ç³»æ˜¯æ€æ ·çš„å‘¢ï¼Ÿå¦‚æœçœŸæœ‰$Z_i=\mathcal{O}(n)$ï¼Œé‚£ä¹ˆç†è®ºä¸Šå°†$Z_i$æ¢æˆ$n$åº”è¯¥èƒ½å–å¾—ç›¸è¿‘çš„æ•ˆæœï¼Œè‡³å°‘ä¸ä¼šæ˜¯ç‰¹åˆ«å·®çš„é‚£ç§ã€‚</p>
<p>ç„¶è€Œï¼Œæˆ‘ä»¬çŸ¥é“æ³¨æ„åŠ›çš„é‡ç‚¹æ˜¯â€œæ³¨æ„â€ï¼Œå®ƒåº”è¯¥æœ‰èƒ½åŠ›â€œèšç„¦â€åˆ°å®ƒè®¤ä¸ºæ¯”è¾ƒé‡è¦çš„å‡ ä¸ªtokenä¸Šã€‚åŒæ—¶ï¼Œä»¥å¾€å…³äºé«˜æ•ˆTransformerçš„ä¸€äº›å®éªŒç»“æœæ˜¾ç¤ºï¼ŒæŠŠæ ‡å‡†Attentionæ¢æˆLocal Attentionåç»“æœå¹¶ä¸ä¼šæ˜æ˜¾ä¸‹é™ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é¢„è®¡ä½ç½®ä¸º$i$çš„AttentionåŸºæœ¬ä¸Šå°±èšç„¦åœ¨$i$é™„è¿‘çš„è‹¥å¹²tokenä¸Šï¼Œè¶…å‡ºä¸€å®šè·ç¦»åå°±åŸºæœ¬ä¸º0äº†ã€‚äº‹å®ä¸Šï¼Œä¹Ÿæœ‰å¾ˆå¤šäº‹åçš„å¯è§†åŒ–ç»“æœæ˜¾ç¤ºè®­ç»ƒå¥½çš„AttentionçŸ©é˜µå…¶å®æ˜¯å¾ˆç¨€ç–çš„ã€‚</p>
<p>ç»¼åˆè¿™äº›ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼Œå­˜åœ¨æŸä¸ªå¸¸æ•°$k$ï¼Œä½¿å¾—$|j-i|\geq k$æ—¶$\exp\left(\frac{\boldsymbol{q}_i\cdot\boldsymbol{k}_j}{\sqrt{d}}\right)$éƒ½ç›¸å½“æ¥è¿‘äº0ï¼Œè¿™æ ·ä¸€æ¥$Z_i$åº”è¯¥æ›´æ¥è¿‘$\mathcal{O}(k)$è€Œä¸æ˜¯$\mathcal{O}(n)$ï¼Œè¿™å°±æ„å‘³ç€$Z_i$å¾ˆå¯èƒ½è·Ÿ$n$æ˜¯æ— å…³çš„ï¼Œæˆ–è€…è¯´è·Ÿ$n$çš„æ•°é‡çº§å…³ç³»è‡³å°‘æ˜¯å°äº$\mathcal{O}(n)$çš„ï¼å› æ­¤ï¼Œæˆ‘ä»¬å¦‚æœè¦å°†$Z_i$æ›¿æ¢æˆåˆ«çš„ä¸œè¥¿ï¼Œé‚£åº”è¯¥æ˜¯ä¸€ä¸ªæ¯”$n$çš„ä¸€æ¬¡æ–¹æ›´ä½é˜¶çš„å‡½æ•°ï¼Œç”šè‡³æ˜¯ä¸€ä¸ªå¸¸æ•°ã€‚</p>
<p>ç°åœ¨å›çœ‹GAUï¼Œå®ƒçš„æ¿€æ´»å‡½æ•°æ¢æˆäº†$\text{relu}^2(\cdot)$æ—¶ï¼Œå…¶Attentionæƒ…å†µæ˜¯ç±»ä¼¼çš„ï¼Œç”šè‡³ä¼šæ›´ç¨€ç–ã€‚è¿™æ˜¯å› ä¸º$\text{relu}$æ“ä½œæœ‰ç›´æ¥ç½®é›¶çš„ä½œç”¨ï¼Œä¸åƒ$\exp(\cdot)$æ€»æ˜¯æ­£çš„ï¼ŒåŒæ—¶GAUâ€œæ ‡é…â€æ—‹è½¬ä½ç½®ç¼–ç RoPEï¼Œåœ¨<a href="/archives/8265">ã€ŠTransformerå‡çº§ä¹‹è·¯ï¼š2ã€åšé‡‡ä¼—é•¿çš„æ—‹è½¬å¼ä½ç½®ç¼–ç ã€‹</a>ä¸­æˆ‘ä»¬å°±æ¨å¯¼è¿‡ï¼ŒRoPEæœ¬èº«è‡ªå¸¦ä¸€å®šçš„è¿œç¨‹è¡°å‡çš„èƒ½åŠ›ã€‚ç»¼åˆè¿™äº›æ¡ä»¶ï¼ŒGAUçš„å½’ä¸€åŒ–å› å­ä¹Ÿåº”è¯¥æ˜¯ä½äº$\mathcal{O}(n)$çš„é˜¶ç”šè‡³æ˜¯å¸¸æ•°çº§åˆ«çš„ã€‚</p>
<h2 id="_4">ç†µä¸å˜æ€§</h2>
<p>ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºGAUçš„ä¸‰ä¸ªè§£å†³æ–¹æ¡ˆï¼Œä¸€æ˜¯é¢„è®­ç»ƒå’Œå¾®è°ƒéƒ½ç”¨åŒä¸€ä¸ªå›ºå®šçš„$n$ï¼›äºŒæ˜¯ä¾ç„¶ä½¿ç”¨åŠ¨æ€çš„æ ·æœ¬é•¿åº¦$n$ï¼Œä½†æ˜¯é¢„è®­ç»ƒæ—¶éœ€è¦ç”¨ä¸åŒé•¿åº¦çš„æ ·æœ¬æ¥æ··åˆè®­ç»ƒï¼Œä¸èƒ½åªä½¿ç”¨å•ä¸€é•¿åº¦çš„æ ·æœ¬ï¼›ä¸‰å°±æ˜¯åƒSoftmaxé‚£æ ·è¡¥å……ä¸Šä¸€ä¸ªå½’ä¸€åŒ–å› å­ï¼Œè®©æ¨¡å‹è‡ªå·±å»å­¦ï¼š<br />
\begin{equation}a_{i,j} = \frac{1}{Z_i}\text{relu}^2\left(\frac{\boldsymbol{q}<em i="1">i\cdot\boldsymbol{k}_j}{\sqrt{d}}\right),\quad Z_i = \sum</em>}^n \text{relu}^2\left(\frac{\boldsymbol{q}_i\cdot\boldsymbol{k}_j}{\sqrt{d}}\right)\end{equation</p>
<p>æ—¢ç„¶å­˜åœ¨è¿™äº›è§£å†³æ–¹æ¡ˆï¼Œé‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜è¯´â€œAttentionä¸Softmaxæ›´é…â€å‘¢ï¼ŸGAUçš„$\text{relu}^2(\cdot)$å“ªé‡Œä¸å¤Ÿé…å‘¢ï¼Ÿé¦–å…ˆï¼Œæˆ‘ä»¬çœ‹GAUåŸè®ºæ–‡çš„æ¶ˆèå®éªŒï¼Œæ˜¾ç¤ºå‡º$\text{relu}^2(\cdot)$æ¢æˆSoftmaxï¼Œæ•ˆæœåŸºæœ¬æ˜¯ä¸€è‡´çš„ï¼š  </p>
<p><a href="/usr/uploads/2022/04/3734029708.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="GAUçš„squared_reluæ¢æˆsoftmaxæ•ˆæœæ˜¯ç›¸è¿‘çš„" src="/usr/uploads/2022/04/3734029708.png" /></a></p>
<p>GAUçš„squared_reluæ¢æˆsoftmaxæ•ˆæœæ˜¯ç›¸è¿‘çš„</p>
<p>æœ‰äº†è¿™ä¸ªåŸºæœ¬ä¿è¯ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹Softmaxæ¯”$\text{relu}^2(\cdot)$å¥½åœ¨å“ªé‡Œäº†ã€‚æˆ‘ä»¬çœ‹åˆšæ‰æåˆ°çš„GAUä¸‰ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæ–¹æ¡ˆä¸€æ€»è®©äººæ„Ÿè§‰ä¸å¤Ÿè‡ªé€‚åº”ï¼Œæ–¹æ¡ˆäºŒå¿…é¡»ç”¨å¤šç§é•¿åº¦è®­ç»ƒæ˜¾å¾—ä¸å¤Ÿä¼˜é›…ï¼Œè‡³äºæ–¹æ¡ˆä¸‰è¡¥å……äº†å½’ä¸€åŒ–å› å­åå½¢å¼ä¸Šç›¸æ¯”Softmaxåè€Œæ˜¾å¾—â€œè‡ƒè‚¿â€äº†ã€‚æ‰€ä»¥ï¼Œæ€»ä½“æ¥è¯´è¿˜æ˜¯ç”¨Softmaxæ˜¾å¾—æ›´ä¸ºä¼˜é›…æœ‰æ•ˆã€‚</p>
<p>æ­¤å¤–ï¼Œæ³›åŒ–èƒ½åŠ›å¯ä»¥ç®€å•åˆ†ä¸ºâ€œå†…æ’â€å’Œâ€œå¤–æ¨â€ä¸¤ç§ï¼Œåœ¨è¿™é‡Œå†…æ’ï¼ˆå¤–æ¨ï¼‰æŒ‡çš„æ˜¯æµ‹è¯•é•¿åº¦å°äºï¼ˆå¤§äºï¼‰è®­ç»ƒé•¿åº¦ã€‚æˆ‘ä»¬åˆšæ‰è¯´å½’ä¸€åŒ–å› å­æ˜¯å¸¸æ•°é‡çº§ï¼Œæ›´å¤šæ˜¯åœ¨å†…æ’èŒƒå›´å†…è¯´çš„ã€‚å¯¹äºå¤–æ¨æ¥è¯´ï¼Œå¦‚æœé•¿åº¦è¶³å¤Ÿé•¿ï¼Œ$\boldsymbol{q}<em 512="512">i,\boldsymbol{k}_j$éƒ½â€œæŒ¤â€åœ¨ä¸€èµ·ï¼Œæ‰€ä»¥å¾ˆéš¾ä¿æŒè·ç¦»è¶…è¿‡æŸä¸ªèŒƒå›´å°±å¾ˆæ¥è¿‘äº0çš„ç‰¹æ€§ã€‚è€Œå¦‚æœæˆ‘ä»¬ç”¨Softmaxçš„è¯ï¼Œå°±æ˜¯å®ƒå¯ä»¥æ¨å¯¼å‡ºä¸€ä¸ªâ€œç†µä¸å˜æ€§â€çš„ç‰ˆæœ¬ï¼Œæ¥å¢å¼ºæ¨¡å‹çš„å¤–æ¨èƒ½åŠ›ï¼š<br />
\begin{equation}Attention(Q,K,V) = softmax\left(\frac{\log</em>} n}{\sqrt{d}}QK^{\top}\right)V\end{equation<br />
åœ¨<a href="/archives/8823">ã€Šä»ç†µä¸å˜æ€§çœ‹Attentionçš„Scaleæ“ä½œã€‹</a>ä¸­æˆ‘ä»¬åšè¿‡ç®€å•çš„å¯¹æ¯”å®éªŒï¼Œæ˜¾ç¤ºè¯¥ç‰ˆæœ¬ç¡®å®èƒ½æé«˜æ¨¡å‹åœ¨è¶…å‡ºè®­ç»ƒé•¿åº¦å¤–çš„æ•ˆæœã€‚</p>
<p>é‚£ä¹ˆï¼Œ$\text{relu}^2(\cdot)$èƒ½å¦æ¨ä¸€ä¸ªâ€œç†µä¸å˜æ€§â€çš„ç‰ˆæœ¬å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¸èƒ½ï¼Œå› ä¸ºå®ƒç›¸å½“äºæ˜¯é€šè¿‡æ¸©åº¦å‚æ•°æ¥è°ƒèŠ‚åˆ†å¸ƒçš„ç†µï¼Œè¿™è¦æ±‚æ¿€æ´»å‡½æ•°ä¸èƒ½æ˜¯å…·å¤‡æ­£é½æ¬¡æ€§ï¼Œæ¯”å¦‚å¯¹äºå¹‚å‡½æ•°æœ‰$(\lambda \boldsymbol{q}_i\cdot\boldsymbol{k}_j)^n=\lambda^n (\boldsymbol{q}_i\cdot\boldsymbol{k}_j)^n$ï¼Œå½’ä¸€åŒ–å$\lambda^n$å°±æŠµæ¶ˆäº†ï¼Œä¸èµ·ä½œç”¨ã€‚æ¿€æ´»å‡½æ•°æœ€å¥½æ¯”å¹‚å‡½æ•°é«˜ä¸€é˜¶ï¼Œæ‰æ¯”è¾ƒå¥½å®ç°è¿™ä¸ªè°ƒæ§ï¼Œè€Œæ¯”å¹‚å‡½æ•°é«˜é˜¶çš„å‡½æ•°ï¼Œæœ€å¸¸è§å°±æ˜¯æŒ‡æ•°å‡½æ•°äº†ï¼Œè€ŒæŒ‡æ•°å½’ä¸€åŒ–æ­£å¥½å°±æ˜¯Softmaxã€‚</p>
<h2 id="_5">æœ¬æ–‡å°ç»“</h2>
<p>æœ¬æ–‡åˆ†æäº†GAUåœ¨å¾®è°ƒæ•ˆæœä¸ä½³çš„åŸå› ï¼Œå‘ç°Attentionçš„å½’ä¸€åŒ–å› å­åº”è¯¥æ˜¯æ¥è¿‘å¸¸æ•°é‡çº§çš„ï¼Œæ‰€ä»¥GAUç”¨$n$æˆ–è€…$n^2$åšå½’ä¸€åŒ–å› å­ä¼šè¡¨ç°ä¸ä½³ã€‚æ€»çš„æ¥è¯´ï¼Œç¬”è€…è®¤ä¸ºAttentionè¿˜æ˜¯è·ŸSoftmaxæ›´é…ï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸é”™çš„åŸºå‡†ï¼Œå¹¶ä¸”è¿˜å¯ä»¥é€šè¿‡â€œç†µä¸å˜æ€§â€çš„æ‹“å±•æ¥è¿›ä¸€æ­¥å¢å¼ºå¤–æ¨èƒ½åŠ›ã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/9019">https://spaces.ac.cn/archives/9019</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Apr. 07, 2022). ã€Šå¬è¯´Attentionä¸Softmaxæ›´é…å“¦ï½ ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/9019">https://spaces.ac.cn/archives/9019</a></p>
<p>@online{kexuefm-9019,<br />
title={å¬è¯´Attentionä¸Softmaxæ›´é…å“¦ï½},<br />
author={è‹å‰‘æ—},<br />
year={2022},<br />
month={Apr},<br />
url={\url{https://spaces.ac.cn/archives/9019}},<br />
} </p>
<hr />
<h2 id="_6">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<h3 id="softmax">ä¸€ã€Softmaxå‡½æ•°çš„æ•°å­¦åŸºç¡€</h3>
<h4 id="11-softmax">1.1 Softmaxå‡½æ•°å®šä¹‰ä¸æ€§è´¨</h4>
<p><strong>å®šä¹‰</strong>: ç»™å®šå‘é‡ $\boldsymbol{x} = (x_1, x_2, \ldots, x_n) \in \mathbb{R}^n$ï¼ŒSoftmaxå‡½æ•°å®šä¹‰ä¸ºï¼š
\begin{equation}
\text{softmax}(\boldsymbol{x})<em j="1">i = \frac{\exp(x_i)}{\sum</em>
\tag{1}
\end{equation}}^n \exp(x_j)} = \frac{e^{x_i}}{\sum_{j=1}^n e^{x_j}</p>
<p><strong>æ€§è´¨1ï¼ˆæ¦‚ç‡åˆ†å¸ƒï¼‰</strong>: Softmaxè¾“å‡ºæ»¡è¶³æ¦‚ç‡åˆ†å¸ƒçš„ä¸¤ä¸ªåŸºæœ¬æ¡ä»¶ï¼š
\begin{equation}
\text{softmax}(\boldsymbol{x})<em i="1">i \in (0, 1), \quad \sum</em>)_i = 1
\tag{2}
\end{equation}}^n \text{softmax}(\boldsymbol{x</p>
<p><strong>è¯æ˜</strong>:
- éè´Ÿæ€§æ˜¾ç„¶æˆç«‹ï¼š$\exp(x_i) &gt; 0, \forall x_i \in \mathbb{R}$
- å½’ä¸€æ€§ï¼š$\sum_{i=1}^n \frac{e^{x_i}}{\sum_j e^{x_j}} = \frac{\sum_i e^{x_i}}{\sum_j e^{x_j}} = 1$</p>
<p><strong>æ€§è´¨2ï¼ˆå¹³ç§»ä¸å˜æ€§ï¼‰</strong>: å¯¹ä»»æ„å¸¸æ•° $c \in \mathbb{R}$ï¼Œæœ‰ï¼š
\begin{equation}
\text{softmax}(\boldsymbol{x} + c\boldsymbol{1}) = \text{softmax}(\boldsymbol{x})
\tag{3}
\end{equation}</p>
<p><strong>è¯æ˜</strong>:
\begin{equation}
\text{softmax}(\boldsymbol{x} + c\boldsymbol{1})_i = \frac{e^{x_i+c}}{\sum_j e^{x_j+c}} = \frac{e^c \cdot e^{x_i}}{e^c \cdot \sum_j e^{x_j}} = \frac{e^{x_i}}{\sum_j e^{x_j}} = \text{softmax}(\boldsymbol{x})_i
\tag{4}
\end{equation}</p>
<p>è¿™ä¸ªæ€§è´¨å¯¹æ•°å€¼ç¨³å®šæ€§è‡³å…³é‡è¦ï¼Œå®è·µä¸­é€šå¸¸é€‰æ‹© $c = -\max_i x_i$ ä»¥é¿å…æŒ‡æ•°æº¢å‡ºã€‚</p>
<p><strong>æ€§è´¨3ï¼ˆå•è°ƒæ€§ï¼‰</strong>: Softmaxä¿æŒè¾“å…¥çš„ç›¸å¯¹é¡ºåºï¼Œå³ï¼š
\begin{equation}
x_i &gt; x_j \Rightarrow \text{softmax}(\boldsymbol{x})_i &gt; \text{softmax}(\boldsymbol{x})_j
\tag{5}
\end{equation}</p>
<p><strong>æ€§è´¨4ï¼ˆæ¸©åº¦å‚æ•°ï¼‰</strong>: å¼•å…¥æ¸©åº¦å‚æ•° $\tau &gt; 0$ï¼š
\begin{equation}
\text{softmax}<em j="1">\tau(\boldsymbol{x})_i = \frac{\exp(x_i/\tau)}{\sum</em>
\tag{6}
\end{equation}}^n \exp(x_j/\tau)</p>
<p>å½“ $\tau \to 0$ æ—¶ï¼ŒSoftmaxé€€åŒ–ä¸ºone-hotç¼–ç ï¼ˆé€‰æ‹©æœ€å¤§å€¼ï¼‰ï¼›å½“ $\tau \to \infty$ æ—¶ï¼ŒSoftmaxè¶‹å‘å‡åŒ€åˆ†å¸ƒã€‚</p>
<h4 id="12-softmax">1.2 Softmaxæ¢¯åº¦çš„å®Œæ•´æ¨å¯¼</h4>
<p><strong>å®šç†</strong>: Softmaxå‡½æ•°çš„JacobiançŸ©é˜µä¸ºï¼š
\begin{equation}
\frac{\partial \text{softmax}(\boldsymbol{x})<em ij="ij">i}{\partial x_j} = \text{softmax}(\boldsymbol{x})_i \cdot (\delta</em>)} - \text{softmax}(\boldsymbol{x<em ij="ij">j)
\tag{7}
\end{equation}
å…¶ä¸­ $\delta</em>$ æ˜¯Kronecker deltaå‡½æ•°ã€‚</p>
<p><strong>è¯¦ç»†è¯æ˜</strong>:</p>
<p>è®¾ $s_i = \text{softmax}(\boldsymbol{x})<em k="1">i = \frac{e^{x_i}}{Z}$ï¼Œå…¶ä¸­ $Z = \sum</em>$}^n e^{x_k</p>
<p><strong>æƒ…å†µ1</strong>: å½“ $i = j$ æ—¶ï¼š
\begin{align}
\frac{\partial s_i}{\partial x_i} &amp;= \frac{\partial}{\partial x_i}\left(\frac{e^{x_i}}{Z}\right) \tag{8}\
&amp;= \frac{e^{x_i} \cdot Z - e^{x_i} \cdot \frac{\partial Z}{\partial x_i}}{Z^2} \tag{9}\
&amp;= \frac{e^{x_i} \cdot Z - e^{x_i} \cdot e^{x_i}}{Z^2} \tag{10}\
&amp;= \frac{e^{x_i}}{Z} \cdot \frac{Z - e^{x_i}}{Z} \tag{11}\
&amp;= s_i \cdot (1 - s_i) \tag{12}
\end{align}</p>
<p><strong>æƒ…å†µ2</strong>: å½“ $i \neq j$ æ—¶ï¼š
\begin{align}
\frac{\partial s_i}{\partial x_j} &amp;= \frac{\partial}{\partial x_j}\left(\frac{e^{x_i}}{Z}\right) \tag{13}\
&amp;= \frac{0 \cdot Z - e^{x_i} \cdot \frac{\partial Z}{\partial x_j}}{Z^2} \tag{14}\
&amp;= \frac{-e^{x_i} \cdot e^{x_j}}{Z^2} \tag{15}\
&amp;= -\frac{e^{x_i}}{Z} \cdot \frac{e^{x_j}}{Z} \tag{16}\
&amp;= -s_i \cdot s_j \tag{17}
\end{align}</p>
<p>ç»¼åˆä¸¤ç§æƒ…å†µï¼Œå¾—åˆ°ï¼š
\begin{equation}
\frac{\partial s_i}{\partial x_j} = s_i \cdot (\delta_{ij} - s_j)
\tag{18}
\end{equation}</p>
<p><strong>çŸ©é˜µå½¢å¼</strong>: ä»¤ $\boldsymbol{s} = \text{softmax}(\boldsymbol{x})$ï¼ŒJacobiançŸ©é˜µä¸ºï¼š
\begin{equation}
\boldsymbol{J} = \text{diag}(\boldsymbol{s}) - \boldsymbol{s}\boldsymbol{s}^{\top}
\tag{19}
\end{equation}</p>
<p>è¿™æ˜¯ä¸€ä¸ªå¯¹ç§°çŸ©é˜µï¼Œä¸”åŠæ­£å®šï¼ˆæ‰€æœ‰ç‰¹å¾å€¼éè´Ÿï¼‰ã€‚</p>
<h4 id="13">1.3 åå‘ä¼ æ’­ä¸­çš„æ¢¯åº¦è®¡ç®—</h4>
<p>åœ¨ç¥ç»ç½‘ç»œä¸­ï¼Œè®¾æŸå¤±å‡½æ•°ä¸º $\mathcal{L}$ï¼Œåˆ™é€šè¿‡é“¾å¼æ³•åˆ™ï¼š
\begin{equation}
\frac{\partial \mathcal{L}}{\partial x_j} = \sum_{i=1}^n \frac{\partial \mathcal{L}}{\partial s_i} \cdot \frac{\partial s_i}{\partial x_j} = \sum_{i=1}^n \frac{\partial \mathcal{L}}{\partial s_i} \cdot s_i \cdot (\delta_{ij} - s_j)
\tag{20}
\end{equation}</p>
<p>å±•å¼€å¾—ï¼š
\begin{equation}
\frac{\partial \mathcal{L}}{\partial x_j} = \frac{\partial \mathcal{L}}{\partial s_j} \cdot s_j - s_j \sum_{i=1}^n \frac{\partial \mathcal{L}}{\partial s_i} \cdot s_i
\tag{21}
\end{equation}</p>
<p><strong>ç‰¹æ®Šæƒ…å†µï¼ˆäº¤å‰ç†µæŸå¤±ï¼‰</strong>: å½“ $\mathcal{L} = -\log s_y$ï¼ˆ$y$æ˜¯çœŸå®ç±»åˆ«ï¼‰æ—¶ï¼š
\begin{equation}
\frac{\partial \mathcal{L}}{\partial s_i} = -\frac{\delta_{iy}}{s_y}
\tag{22}
\end{equation}</p>
<p>ä»£å…¥å¾—ï¼š
\begin{align}
\frac{\partial \mathcal{L}}{\partial x_j} &amp;= -\frac{\delta_{jy}}{s_y} \cdot s_j - s_j \sum_{i=1}^n \left(-\frac{\delta_{iy}}{s_y}\right) \cdot s_i \tag{23}\
&amp;= -\delta_{jy} + s_j \tag{24}\
&amp;= s_j - \delta_{jy} \tag{25}
\end{align}</p>
<p>è¿™ä¸ªç®€æ´çš„å½¢å¼æ˜¯Softmaxä¸äº¤å‰ç†µæ­é…çš„ä¸€ä¸ªé‡è¦ä¼˜åŠ¿ã€‚</p>
<h3 id="attentionsoftmax">äºŒã€Attentionæœºåˆ¶ä¸­çš„Softmaxåˆ†æ</h3>
<h4 id="21-attention">2.1 æ ‡å‡†Attentionçš„æ•°å­¦å½¢å¼</h4>
<p>ç»™å®šQueryã€Keyã€ValueçŸ©é˜µ $Q, K, V \in \mathbb{R}^{n \times d}$ï¼Œæ ‡å‡†çš„Scaled Dot-Product Attentionå®šä¹‰ä¸ºï¼š
\begin{equation}
\text{Attention}(Q, K, V) = \text{softmax}\left(\frac{QK^{\top}}{\sqrt{d}}\right)V
\tag{26}
\end{equation}</p>
<p>å¯¹äºç¬¬ $i$ ä¸ªä½ç½®ï¼Œæ³¨æ„åŠ›æƒé‡ä¸ºï¼š
\begin{equation}
a_{i,j} = \frac{\exp\left(\frac{q_i \cdot k_j}{\sqrt{d}}\right)}{\sum_{j'=1}^n \exp\left(\frac{q_i \cdot k_{j'}}{\sqrt{d}}\right)}, \quad j = 1, \ldots, n
\tag{27}
\end{equation}</p>
<p>è¾“å‡ºä¸ºï¼š
\begin{equation}
o_i = \sum_{j=1}^n a_{i,j} v_j
\tag{28}
\end{equation}</p>
<h4 id="22">2.2 å½’ä¸€åŒ–å› å­çš„é‡çº§åˆ†æ</h4>
<p><strong>é—®é¢˜</strong>: å½’ä¸€åŒ–å› å­ $Z_i = \sum_{j=1}^n \exp\left(\frac{q_i \cdot k_j}{\sqrt{d}}\right)$ ä¸åºåˆ—é•¿åº¦ $n$ çš„å…³ç³»ï¼Ÿ</p>
<p><strong>åˆ†æ</strong>: å¦‚æœAttentionå…·æœ‰"èšç„¦"ç‰¹æ€§ï¼ˆå³åªå…³æ³¨å°‘æ•°å‡ ä¸ªtokenï¼‰ï¼Œå­˜åœ¨å¸¸æ•° $K$ ä½¿å¾—ï¼š
\begin{equation}
\exp\left(\frac{q_i \cdot k_j}{\sqrt{d}}\right) \approx 0, \quad \text{å½“ } |i-j| &gt; K
\tag{29}
\end{equation}</p>
<p>åˆ™ï¼š
\begin{equation}
Z_i \approx \sum_{j:|i-j|\leq K} \exp\left(\frac{q_i \cdot k_j}{\sqrt{d}}\right) = \mathcal{O}(K)
\tag{30}
\end{equation}</p>
<p>å› æ­¤ $Z_i$ ä¸ $n$ <strong>æ— å…³</strong>æˆ–å¼±ç›¸å…³ï¼Œè¿™æ˜¯ä¸€ä¸ªå…³é”®è§‚å¯Ÿã€‚</p>
<p><strong>å®è¯æ”¯æŒ</strong>:
1. Local Attentionçš„æˆåŠŸè¡¨æ˜å¤§éƒ¨åˆ†æƒé‡é›†ä¸­åœ¨å±€éƒ¨
2. AttentionçŸ©é˜µçš„ç¨€ç–æ€§å¯è§†åŒ–
3. RoPEç­‰ä½ç½®ç¼–ç çš„è¿œç¨‹è¡°å‡ç‰¹æ€§</p>
<h4 id="23-softmax-vs">2.3 Softmax vs. å…¶ä»–å½’ä¸€åŒ–æ–¹æ³•</h4>
<p><strong>æ–¹æ¡ˆ1</strong>: GAUä½¿ç”¨çš„å½’ä¸€åŒ–ï¼ˆåŸæ–‡æåˆ°ï¼‰ï¼š
\begin{equation}
\boldsymbol{A} = \frac{1}{n}\text{relu}^2\left(\frac{QK^{\top}}{\sqrt{d}}\right)
\tag{31}
\end{equation}</p>
<p><strong>é—®é¢˜åˆ†æ</strong>:
- å½’ä¸€åŒ–å› å­ $n$ æ˜¯åºåˆ—é•¿åº¦ï¼Œä¸ä½ç½®æ— å…³
- ä½†å®é™…æœ‰æ•ˆçš„æ³¨æ„åŠ›èŒƒå›´å¯èƒ½è¿œå°äº $n$
- å¯¼è‡´é•¿åº¦æ³›åŒ–èƒ½åŠ›å·®</p>
<p><strong>æ–¹æ¡ˆ2</strong>: åŠ¨æ€å½’ä¸€åŒ–ï¼š
\begin{equation}
a_{i,j} = \frac{\text{relu}^2\left(\frac{q_i \cdot k_j}{\sqrt{d}}\right)}{\sum_{j'=1}^n \text{relu}^2\left(\frac{q_i \cdot k_{j'}}{åŒ\sqrt{d}}\right)}
\tag{32}
\end{equation}</p>
<p>è¿™ä¸Softmaxåœ¨å½¢å¼ä¸Šç±»ä¼¼ï¼Œä½†ï¼š
- $\text{relu}^2$ å…·æœ‰æ­£é½æ¬¡æ€§ï¼š$\text{relu}^2(\lambda x) = \lambda^2 \text{relu}^2(x)$
- æ— æ³•é€šè¿‡æ¸©åº¦å‚æ•°çµæ´»è°ƒæ§</p>
<p><strong>æ–¹æ¡ˆ3</strong>: Softmaxï¼ˆæ ‡å‡†æ–¹æ¡ˆï¼‰ï¼š
\begin{equation}
a_{i,j} = \frac{\exp\left(\frac{q_i \cdot k_j}{\sqrt{d}}\right)}{\sum_{j'=1}^n \exp\left(\frac{q_i \cdot k_{j'}}{\sqrt{d}}\right)}
\tag{33}
\end{equation}</p>
<p>ä¼˜åŠ¿ï¼š
- å½’ä¸€åŒ–å› å­è‡ªé€‚åº”äºæœ‰æ•ˆæ³¨æ„åŠ›èŒƒå›´
- æ”¯æŒæ¸©åº¦å‚æ•°è°ƒæ§
- ä¸ä½ç½®ç¼–ç é…åˆè‰¯å¥½</p>
<h3 id="_7">ä¸‰ã€ç†µä¸å˜æ€§ç†è®º</h3>
<h4 id="31">3.1 ä¿¡æ¯ç†µçš„å®šä¹‰</h4>
<p>ç»™å®šç¦»æ•£æ¦‚ç‡åˆ†å¸ƒ $\boldsymbol{p} = (p_1, \ldots, p_n)$ï¼ŒShannonç†µå®šä¹‰ä¸ºï¼š
\begin{equation}
H(\boldsymbol{p}) = -\sum_{i=1}^n p_i \log p_i
\tag{34}
\end{equation}</p>
<p>å¯¹äºSoftmaxè¾“å‡ºçš„åˆ†å¸ƒï¼š
\begin{equation}
H(\text{softmax}(\boldsymbol{x})) = -\sum_{i=1}^n \frac{e^{x_i}}{\sum_j e^{x_j}} \cdot \log\frac{e^{x_i}}{\sum_j e^{x_j}}
\tag{35}
\end{equation}</p>
<p>åŒ–ç®€ï¼š
\begin{align}
H &amp;= -\sum_{i=1}^n \frac{e^{x_i}}{Z} \cdot \left(x_i - \log Z\right) \tag{36}\
&amp;= -\frac{1}{Z}\sum_{i=1}^n e^{x_i} x_i + \log Z \cdot \frac{1}{Z}\sum_{i=1}^n e^{x_i} \tag{37}\
&amp;= \log Z - \frac{1}{Z}\sum_{i=1}^n e^{x_i} x_i \tag{38}
\end{align}</p>
<p>å…¶ä¸­ $Z = \sum_j e^{x_j}$ æ˜¯é…åˆ†å‡½æ•°ã€‚</p>
<h4 id="32">3.2 æ¸©åº¦å‚æ•°å¯¹ç†µçš„å½±å“</h4>
<p>å¼•å…¥æ¸©åº¦å‚æ•° $\tau$ï¼š
\begin{equation}
H_\tau = \log Z_\tau - \frac{1}{\tau Z_\tau}\sum_{i=1}^n e^{x_i/\tau} x_i
\tag{39}
\end{equation}</p>
<p>å…¶ä¸­ $Z_\tau = \sum_j e^{x_j/\tau}$ã€‚</p>
<p><strong>å®šç†ï¼ˆç†µçš„å•è°ƒæ€§ï¼‰</strong>:
\begin{equation}
\frac{\partial H_\tau}{\partial \tau} &gt; 0
\tag{40}
\end{equation}</p>
<p>å³æ¸©åº¦è¶Šé«˜ï¼Œç†µè¶Šå¤§ï¼ˆåˆ†å¸ƒè¶Šå¹³æ»‘ï¼‰ã€‚</p>
<p><strong>æé™æƒ…å†µ</strong>:
- $\tau \to 0$: $H \to 0$ï¼ˆone-hotåˆ†å¸ƒï¼Œç†µæœ€å°ï¼‰
- $\tau \to \infty$: $H \to \log n$ï¼ˆå‡åŒ€åˆ†å¸ƒï¼Œç†µæœ€å¤§ï¼‰</p>
<h4 id="33">3.3 é•¿åº¦å¤–æ¨çš„ç†µä¸å˜æ€§æ–¹æ¡ˆ</h4>
<p><strong>é—®é¢˜</strong>: è®­ç»ƒé•¿åº¦ä¸º $n_0$ï¼Œæµ‹è¯•é•¿åº¦ä¸º $n$ï¼Œå¦‚ä½•ä¿æŒç†µçš„ä¸€è‡´æ€§ï¼Ÿ</p>
<p><strong>æ–¹æ¡ˆ</strong>: è°ƒæ•´æ¸©åº¦å‚æ•°ä½¿å¾—æœŸæœ›ç†µä¿æŒä¸å˜ï¼š
\begin{equation}
\text{Attention}(Q, K, V) = \text{softmax}\left(\frac{\log_{n_0} n}{\sqrt{d}} QK^{\top}\right)V
\tag{41}
\end{equation}</p>
<p><strong>ç†è®ºåˆ†æ</strong>: å‡è®¾æ³¨æ„åŠ›åˆ†æ•° $s_{ij} = \frac{q_i \cdot k_j}{\sqrt{d}}$ çš„åˆ†å¸ƒä¸é•¿åº¦æ— å…³ï¼Œåˆ™ï¼š</p>
<p>å½“åºåˆ—é•¿åº¦ä» $n_0$ å˜ä¸º $n$ æ—¶ï¼Œæœ‰æ•ˆçš„éé›¶é¡¹æ•°é‡ä» $\mathcal{O}(K)$ å¯èƒ½å¢åŠ ã€‚ä¸ºä¿æŒç†µçš„é‡çº§ï¼Œæˆ‘ä»¬éœ€è¦ï¼š
\begin{equation}
H_n \approx H_{n_0}
\tag{42}
\end{equation}</p>
<p>é€šè¿‡è°ƒæ•´æ¸©åº¦ $\tau = \frac{1}{\log_{n_0} n}$ï¼Œå¯ä»¥éƒ¨åˆ†è¡¥å¿é•¿åº¦å˜åŒ–å¸¦æ¥çš„ç†µå˜åŒ–ã€‚</p>
<p><strong>æ•°å€¼éªŒè¯</strong>: è®¾ $n_0 = 512, n = 2048$ï¼Œåˆ™ï¼š
\begin{equation}
\tau = \frac{1}{\log_{512} 2048} = \frac{1}{\frac{\log 2048}{\log 512}} = \frac{\log 512}{\log 2048} = \frac{9\log 2}{11\log 2} \approx 0.818
\tag{43}
\end{equation}</p>
<p>å³å¯¹äº4å€é•¿åº¦ï¼Œæ¸©åº¦ç¼©æ”¾åˆ°çº¦0.82å€ã€‚</p>
<h3 id="_8">å››ã€æ•°å€¼ç¨³å®šæ€§åˆ†æ</h3>
<h4 id="41-softmax">4.1 Softmaxçš„æ•°å€¼ç¨³å®šå®ç°</h4>
<p><strong>é—®é¢˜</strong>: ç›´æ¥è®¡ç®— $e^{x_i}$ å¯èƒ½å¯¼è‡´ï¼š
- ä¸Šæº¢ï¼š$x_i$ å¾ˆå¤§æ—¶ï¼Œ$e^{x_i} &gt; \text{FLOAT_MAX}$
- ä¸‹æº¢ï¼š$x_i$ å¾ˆå°æ—¶ï¼Œ$e^{x_i} \approx 0$</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>: åˆ©ç”¨å¹³ç§»ä¸å˜æ€§ $\eqref{eq:3}$ï¼Œå‡å»æœ€å¤§å€¼ï¼š
\begin{equation}
\tilde{x}_i = x_i - \max_j x_j
\tag{44}
\end{equation}</p>
<p>åˆ™ï¼š
\begin{equation}
\text{softmax}(\boldsymbol{x})_i = \frac{e^{\tilde{x}_i}}{\sum_j e^{\tilde{x}_j}}
\tag{45}
\end{equation}</p>
<p><strong>æ•°å€¼æ€§è´¨</strong>:
- $\tilde{x}_i \leq 0, \forall i$ï¼Œé¿å…ä¸Šæº¢
- $\max_i \tilde{x}_i = 0$ï¼Œè‡³å°‘æœ‰ä¸€é¡¹ä¸º $e^0 = 1$ï¼Œé¿å…å…¨éƒ¨ä¸‹æº¢</p>
<p><strong>ä¼ªä»£ç </strong>:</p>
<div class="codehilite"><pre><span></span><code>def stable_softmax(x):
    x_max = max(x)
    x_shifted = x - x_max
    exp_x = exp(x_shifted)
    return exp_x / sum(exp_x)
</code></pre></div>

<h4 id="42-log-softmax">4.2 Log-Softmaxçš„ç¨³å®šè®¡ç®—</h4>
<p>åœ¨è®¡ç®—äº¤å‰ç†µæŸå¤±æ—¶ï¼Œéœ€è¦ $\log(\text{softmax}(\boldsymbol{x})_i)$ï¼š
\begin{align}
\log(\text{softmax}(\boldsymbol{x})_i) &amp;= \log\frac{e^{x_i}}{\sum_j e^{x_j}} \tag{46}\
&amp;= x_i - \log\sum_j e^{x_j} \tag{47}
\end{align}</p>
<p><strong>Log-Sum-ExpæŠ€å·§</strong>:
\begin{align}
\log\sum_j e^{x_j} &amp;= \log\left(e^{x_{\max}}\sum_j e^{x_j - x_{\max}}\right) \tag{48}\
&amp;= x_{\max} + \log\sum_j e^{x_j - x_{\max}} \tag{49}
\end{align}</p>
<p>å…¶ä¸­ $x_{\max} = \max_j x_j$ã€‚</p>
<p><strong>å®Œæ•´çš„ç¨³å®šå®ç°</strong>:
\begin{equation}
\log(\text{softmax}(\boldsymbol{x})<em _max="\max">i) = (x_i - x</em>
\tag{50}
\end{equation}}) - \log\sum_j e^{x_j - x_{\max}</p>
<h4 id="43">4.3 æ¢¯åº¦çš„æ•°å€¼ç¨³å®šæ€§</h4>
<p>Softmaxçš„æ¢¯åº¦è®¡ç®— $\eqref{eq:18}$ æœ¬èº«æ˜¯æ•°å€¼ç¨³å®šçš„ï¼Œå› ä¸ºï¼š
- $s_i \in (0, 1)$ï¼Œä¸ä¼šæº¢å‡º
- $(1 - s_i) \in (0, 1)$ï¼ŒåŒæ ·ç¨³å®š</p>
<p>ä½†åœ¨åå‘ä¼ æ’­ä¸­ï¼Œéœ€è¦æ³¨æ„ï¼š
\begin{equation}
\frac{\partial \mathcal{L}}{\partial x_j} = s_j - \delta_{jy}
\tag{51}
\end{equation}</p>
<p>è¿™ä¸ªå½¢å¼éå¸¸ç¨³å®šï¼Œå› ä¸ºï¼š
- $s_j \in (0, 1)$
- $\delta_{jy} \in {0, 1}$
- å·®å€¼åœ¨ $(-1, 1)$ èŒƒå›´å†…</p>
<h3 id="_9">äº”ã€å¤æ‚åº¦åˆ†æ</h3>
<h4 id="51-attention">5.1 æ ‡å‡†Attentionçš„å¤æ‚åº¦</h4>
<p><strong>æ—¶é—´å¤æ‚åº¦</strong>:
\begin{equation}
\mathcal{O}(n^2 d + n^2 + nd) = \mathcal{O}(n^2 d)
\tag{52}
\end{equation}</p>
<p>è¯¦ç»†åˆ†è§£ï¼š
- è®¡ç®— $QK^{\top}$: $\mathcal{O}(n^2 d)$
- è®¡ç®—Softmax: $\mathcal{O}(n^2)$
- è®¡ç®—æ³¨æ„åŠ›è¾“å‡º: $\mathcal{O}(n^2 d)$</p>
<p><strong>ç©ºé—´å¤æ‚åº¦</strong>:
\begin{equation}
\mathcal{O}(n^2 + nd) = \mathcal{O}(n^2)
\tag{53}
\end{equation}</p>
<ul>
<li>å­˜å‚¨æ³¨æ„åŠ›çŸ©é˜µ: $\mathcal{O}(n^2)$</li>
<li>å­˜å‚¨ $Q, K, V$: $\mathcal{O}(nd)$</li>
</ul>
<h4 id="52">5.2 ä¼˜åŒ–æ–¹æ¡ˆçš„å¤æ‚åº¦å¯¹æ¯”</h4>
<p><strong>Flash Attention</strong>: é€šè¿‡åˆ†å—è®¡ç®—é¿å…å­˜å‚¨å®Œæ•´æ³¨æ„åŠ›çŸ©é˜µ
- æ—¶é—´: $\mathcal{O}(n^2 d)$ï¼ˆä¸å˜ï¼‰
- ç©ºé—´: $\mathcal{O}(nd)$ï¼ˆé™ä¸ºçº¿æ€§ï¼ï¼‰</p>
<p><strong>Linear Attention</strong>: ä½¿ç”¨æ ¸æ–¹æ³•è¿‘ä¼¼
- æ—¶é—´: $\mathcal{O}(nd^2)$
- ç©ºé—´: $\mathcal{O}(nd)$</p>
<p>å½“ $n \gg d$ æ—¶ï¼ŒLinear Attentionæ›´ä¼˜ã€‚</p>
<p><strong>Sparse Attention</strong>: åªè®¡ç®—éƒ¨åˆ†æ³¨æ„åŠ›æƒé‡
- æ—¶é—´: $\mathcal{O}(nkd)$ï¼Œå…¶ä¸­ $k \ll n$ æ˜¯æ¯ä¸ªä½ç½®å…³æ³¨çš„tokenæ•°
- ç©ºé—´: $\mathcal{O}(nk)$</p>
<h3 id="_10">å…­ã€æ¿€æ´»å‡½æ•°å¯¹æ¯”å®éªŒ</h3>
<h4 id="61">6.1 ç†è®ºå¯¹æ¯”</h4>
<table>
<thead>
<tr>
<th>æ¿€æ´»å‡½æ•°</th>
<th>å…¬å¼</th>
<th>å½’ä¸€åŒ–æ€§è´¨</th>
<th>æ¸©åº¦è°ƒæ§</th>
<th>æ¢¯åº¦æ€§è´¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>Softmax</td>
<td>$\frac{e^{x_i}}{\sum_j e^{x_j}}$</td>
<td>è‡ªé€‚åº”</td>
<td>æ”¯æŒ</td>
<td>å…‰æ»‘</td>
</tr>
<tr>
<td>ReLUÂ²</td>
<td>$\frac{\text{relu}^2(x_i)}{\sum_j \text{relu}^2(x_j)}$</td>
<td>éœ€æ‰‹åŠ¨è®¾ç½®</td>
<td>ä¸æ”¯æŒ</td>
<td>éå…‰æ»‘</td>
</tr>
<tr>
<td>Sigmoid</td>
<td>$\sigma(x_i) = \frac{1}{1+e^{-x_i}}$</td>
<td>æ— ï¼ˆä¸å½’ä¸€ï¼‰</td>
<td>æ”¯æŒ</td>
<td>å…‰æ»‘ä½†é¥±å’Œ</td>
</tr>
<tr>
<td>Tanh</td>
<td>$\tanh(x_i)$</td>
<td>æ— ï¼ˆä¸å½’ä¸€ï¼‰</td>
<td>æ”¯æŒ</td>
<td>å…‰æ»‘ä½†é¥±å’Œ</td>
</tr>
</tbody>
</table>
<h4 id="62">6.2 é½æ¬¡æ€§åˆ†æ</h4>
<p><strong>Softmax</strong>: ä¸å…·æœ‰é½æ¬¡æ€§
\begin{equation}
\text{softmax}(\lambda \boldsymbol{x}) \neq \lambda^k \text{softmax}(\boldsymbol{x})
\tag{54}
\end{equation}</p>
<p>è¿™ä½¿å¾—æ¸©åº¦å‚æ•°æœ‰æ•ˆã€‚</p>
<p><strong>ReLUÂ²</strong>: å…·æœ‰2æ¬¡é½æ¬¡æ€§
\begin{equation}
\text{relu}^2(\lambda x) = \lambda^2 \text{relu}^2(x)
\tag{55}
\end{equation}</p>
<p>å½’ä¸€åŒ–åï¼š
\begin{equation}
\frac{\text{relu}^2(\lambda x_i)}{\sum_j \text{relu}^2(\lambda x_j)} = \frac{\lambda^2 \text{relu}^2(x_i)}{\sum_j \lambda^2 \text{relu}^2(x_j)} = \frac{\text{relu}^2(x_i)}{\sum_j \text{relu}^2(x_j)}
\tag{56}
\end{equation}</p>
<p>æ¸©åº¦å‚æ•°è¢«æŠµæ¶ˆï¼Œæ— æ³•è°ƒæ§ï¼</p>
<h4 id="63">6.3 æ¢¯åº¦ç‰¹æ€§å¯¹æ¯”</h4>
<p><strong>Softmaxæ¢¯åº¦</strong> $\eqref{eq:18}$:
- å¤„å¤„å¯å¯¼
- æ¢¯åº¦æœ‰ç•Œï¼š$|s_i(1-s_i)| \leq 1/4$
- è‡ªåŠ¨å½’ä¸€åŒ–ï¼ˆæ¢¯åº¦å’Œä¸º0ï¼‰</p>
<p><strong>ReLUÂ²æ¢¯åº¦</strong>:
\begin{equation}
\frac{\partial \text{relu}^2(x)}{\partial x} = \begin{cases}
2x, &amp; x &gt; 0 \
0, &amp; x \leq 0
\end{cases}
\tag{57}
\end{equation}</p>
<ul>
<li>åœ¨0ç‚¹ä¸å¯å¯¼</li>
<li>æ¢¯åº¦æ— ç•Œï¼ˆå¯èƒ½å¯¼è‡´æ¢¯åº¦çˆ†ç‚¸ï¼‰</li>
<li>ç¨€ç–æ€§ï¼ˆè´Ÿå€¼æ¢¯åº¦ä¸º0ï¼‰</li>
</ul>
<h3 id="_11">ä¸ƒã€å®è·µå»ºè®®ä¸è¶…å‚æ•°é€‰æ‹©</h3>
<h4 id="71-attention">7.1 æ ‡å‡†Attentionçš„æœ€ä½³å®è·µ</h4>
<p><strong>1. Scaleå› å­é€‰æ‹©</strong>:
\begin{equation}
\alpha = \frac{1}{\sqrt{d_k}}
\tag{58}
\end{equation}</p>
<p><strong>ç†è®ºä¾æ®</strong>: å‡è®¾ $q_i, k_j$ çš„æ¯ä¸ªåˆ†é‡ç‹¬ç«‹åŒåˆ†å¸ƒï¼Œå‡å€¼ä¸º0ï¼Œæ–¹å·®ä¸º $\sigma^2$ï¼Œåˆ™ï¼š
\begin{equation}
\mathbb{E}[q_i \cdot k_j] = 0, \quad \text{Var}(q_i \cdot k_j) = d_k \sigma^2
\tag{59}
\end{equation}</p>
<p>é™¤ä»¥ $\sqrt{d_k}$ ä½¿æ–¹å·®å½’ä¸€åŒ–ï¼š
\begin{equation}
\text{Var}\left(\frac{q_i \cdot k_j}{\sqrt{d_k}}\right) = \sigma^2
\tag{60}
\end{equation}</p>
<p>è¿™é¿å…äº†Softmaxè¾“å…¥æ–¹å·®éšç»´åº¦å¢é•¿ã€‚</p>
<p><strong>2. æ¸©åº¦å‚æ•°è°ƒæ•´</strong>:</p>
<p>å¯¹äºé•¿åº¦å¤–æ¨ï¼Œä½¿ç”¨ï¼š
\begin{equation}
\tau = \frac{\log n_{\text{train}}}{\log n_{\text{test}}}
\tag{61}
\end{equation}</p>
<p><strong>3. Dropoutä½ç½®</strong>:</p>
<p>æ¨èåœ¨Attentionæƒé‡ä¸Šåº”ç”¨Dropoutï¼š
\begin{equation}
\text{Attention}(Q,K,V) = \text{Dropout}(\text{softmax}(QK^{\top}/\sqrt{d}))V
\tag{62}
\end{equation}</p>
<p>å…¸å‹å€¼ï¼š$p_{\text{dropout}} = 0.1$</p>
<h4 id="72">7.2 æ•°å€¼ç¨³å®šæ€§æ£€æŸ¥æ¸…å•</h4>
<ol>
<li>ä½¿ç”¨Log-Softmaxè®¡ç®—äº¤å‰ç†µæŸå¤±</li>
<li>æ¢¯åº¦è£å‰ªï¼š<code>clip_grad_norm_(parameters, max_norm=1.0)</code></li>
<li>æ··åˆç²¾åº¦è®­ç»ƒæ—¶æ³¨æ„Softmaxç²¾åº¦</li>
<li>æ£€æŸ¥AttentionçŸ©é˜µçš„æœ€å¤§å€¼/æœ€å°å€¼</li>
</ol>
<h4 id="73">7.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®</h4>
<p><strong>å†…å­˜ä¼˜åŒ–</strong>:
- ä½¿ç”¨Flash Attentionå‡å°‘æ˜¾å­˜å ç”¨
- Gradient Checkpointingç‰ºç‰²è®¡ç®—æ¢æ˜¾å­˜</p>
<p><strong>è®¡ç®—ä¼˜åŒ–</strong>:
- ä½¿ç”¨fused kernelsï¼ˆSoftmaxä¸Scaleåˆå¹¶ï¼‰
- åˆ©ç”¨ç¡¬ä»¶åŠ é€Ÿï¼ˆTensor Coresï¼‰</p>
<p><strong>å¤šå¤´æ³¨æ„åŠ›é…ç½®</strong>:
\begin{equation}
h \times d_k = d_{\text{model}}
\tag{63}
\end{equation}</p>
<p>å¸¸è§é…ç½®ï¼š
- å°æ¨¡å‹ï¼š$h=8, d_k=64, d_{\text{model}}=512$
- å¤§æ¨¡å‹ï¼š$h=16, d_k=64, d_{\text{model}}=1024$</p>
<h3 id="_12">å…«ã€æ€»ç»“ä¸å±•æœ›</h3>
<h4 id="81">8.1 æ ¸å¿ƒç»“è®º</h4>
<ol>
<li><strong>Softmaxçš„ç†è®ºä¼˜åŠ¿</strong>:</li>
<li>è‡ªé€‚åº”çš„å½’ä¸€åŒ–å› å­ï¼Œä¸æœ‰æ•ˆæ³¨æ„åŠ›èŒƒå›´åŒ¹é…</li>
<li>æ”¯æŒæ¸©åº¦å‚æ•°è°ƒæ§ï¼Œå®ç°ç†µçš„çµæ´»æ§åˆ¶</li>
<li>
<p>æ•°å­¦æ€§è´¨ä¼˜è‰¯ï¼ˆå…‰æ»‘ã€å¯å¯¼ã€æœ‰ç•Œï¼‰</p>
</li>
<li>
<p><strong>ä¸å…¶ä»–æ¿€æ´»å‡½æ•°çš„å¯¹æ¯”</strong>:</p>
</li>
<li>ReLUÂ²ç­‰å¹‚å‡½æ•°å› é½æ¬¡æ€§æ— æ³•æœ‰æ•ˆè°ƒæ§æ¸©åº¦</li>
<li>
<p>Softmaxçš„æŒ‡æ•°å½¢å¼æ˜¯å®ç°æ¸©åº¦è°ƒæ§çš„æœ€è‡ªç„¶é€‰æ‹©</p>
</li>
<li>
<p><strong>é•¿åº¦æ³›åŒ–çš„å…³é”®</strong>:</p>
</li>
<li>å½’ä¸€åŒ–å› å­åº”ä¸å®é™…æ³¨æ„åŠ›èŒƒå›´åŒ¹é…</li>
<li>ç†µä¸å˜æ€§æä¾›äº†ä¸€ä¸ªç†è®ºæ¡†æ¶</li>
</ol>
<h4 id="82">8.2 å¼€æ”¾é—®é¢˜</h4>
<ol>
<li>æ˜¯å¦å­˜åœ¨æ¯”Softmaxæ›´ä¼˜çš„å½’ä¸€åŒ–æ–¹æ¡ˆï¼Ÿ</li>
<li>å¦‚ä½•ç†è®ºåŒ–åœ°é¢„æµ‹æœ€ä¼˜æ¸©åº¦å‚æ•°ï¼Ÿ</li>
<li>ç†µä¸å˜æ€§æ˜¯å¦æ˜¯é•¿åº¦å¤–æ¨çš„å……åˆ†æ¡ä»¶ï¼Ÿ</li>
</ol>
<h4 id="83">8.3 æ‰©å±•é˜…è¯»</h4>
<ul>
<li>Flash Attention: é«˜æ•ˆçš„æ³¨æ„åŠ›è®¡ç®—</li>
<li>Linformer: çº¿æ€§å¤æ‚åº¦çš„è¿‘ä¼¼æ–¹æ³•</li>
<li>ALiBi: åŸºäºåç½®çš„ä½ç½®ç¼–ç æ–¹æ¡ˆ</li>
</ul>
        </div>
    </div>
</body>
</html>