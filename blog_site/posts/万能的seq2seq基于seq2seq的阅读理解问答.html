<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>万能的seq2seq：基于seq2seq的阅读理解问答</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">← 返回首页</a>
        <header>
            <h1>万能的seq2seq：基于seq2seq的阅读理解问答</h1>
            <div class="meta">📅 最后更新: 2025-12-31 | 📄 大小: 6.3 KB</div>
        </header>
        <div class="content">
            <p><strong>原文链接</strong>: <a href="https://spaces.ac.cn/archives/7115">https://spaces.ac.cn/archives/7115</a></p>
<p><strong>发布日期</strong>: </p>
<hr />
<p>今天给<a href="https://github.com/bojone/bert4keras">bert4keras</a>新增加了一个例子：阅读理解式问答（<a href="https://github.com/bojone/bert4keras/blob/master/examples/task_reading_comprehension_by_seq2seq.py">task_reading_comprehension_by_seq2seq.py</a>），语料跟之前一样，都是用<a href="/archives/6906">WebQA和SogouQA</a>，最终的得分在0.77左右（单模型，没精调）。</p>
<h2 id="_1">方法简述</h2>
<p>由于这次主要目的是给bert4keras增加demo，因此效率就不是主要关心的目标了。这次的目标主要是通用性和易用性，所以用了最万能的方案——seq2seq来实现做阅读理解。</p>
<p>用seq2seq做的话，基本不用怎么关心模型设计，只要把篇章和问题拼接起来，然后预测答案就行了。此外，seq2seq的方案还自然地包括了判断篇章有无答案的方法，以及自然地导出一种多篇章投票的思路。总而言之，不考虑效率的话，seq2seq做阅读理解是一种相当优雅的方案。</p>
<p>这次实现seq2seq还是用UNILM的方案，如果还不了解的读者，可以先阅读<a href="/archives/6933">《从语言模型到Seq2Seq：Transformer如戏，全靠Mask》</a>了解相应内容。</p>
<h2 id="_2">模型细节</h2>
<p>用UNILM方案搭建一个seq2seq模型在bert4keras中基本就是一行代码的事情，所以这个例子的主要工作在并不在模型的建立上，而是在输入输出的处理上面。</p>
<h3 id="_3">输入格式</h3>
<p>首先是输入，输入格式很简单，一张图可以表达清楚：  </p>
<p><a href="/usr/uploads/2019/12/4085505815.png" title="点击查看原图"><img alt="用seq2seq做阅读理解的模型图示" src="/usr/uploads/2019/12/4085505815.png" /></a></p>
<p>用seq2seq做阅读理解的模型图示</p>
<h3 id="_4">输出处理</h3>
<p>如果输入单个篇章和单个问题进行回答，那么直接按照seq2seq常规的处理方案——即beam search——来解码即可。</p>
<p>但是，WebQA和SogouQA面对的是搜索场景，即同时存在多篇文章来对同一个问题进行回答，这就涉及到投票方案的选择了。一种朴素的思路是：每个篇章结合问题单独用beam search解码，并且给出置信度，最后再按照<a href="/archives/5409">《基于CNN的阅读理解式问答模型：DGCNN》</a>的投票方式进行。这种方式的困难之处在于对每个答案给出一个合理的置信度，它相比我们后面给出的思路则显得不够自然，并且效率也稍低些。</p>
<p>这里我们给出一种跟beam search更加“契合”的方案：</p>
<blockquote>
<p>先排除没有答案的篇章，然后在解码答案的每一个字时，直接将所有篇章预测的概率值（按照某种方式）取平均。</p>
</blockquote>
<p>具体来说，所有篇章分别和问题拼接起来，然后给出各自的第一个字的概率分布。那些第一个字就给出[SEP]的篇章意味着它是没有答案的，排除掉它们。排除掉之后，将剩下的篇章的第一个字的概率分布取平均，然后再保留topk（beam search的标准流程）。预测第二个字时，每个篇章与topk个候选值分别组合，预测各自的第二个字的概率分布，然后再按照篇章将概率平均后，再给出topk。依此类推，直到出现[SEP]。（其实就是在普通的beam search基础上加上按篇章平均，如果实在弄不明白，那就只能去看源码了～）</p>
<p>此外，生成答案的方式应该有两种，一种是抽取式的，这种模式下答案只能是篇章的一个片段，另外一种是生成式的，即不需要考虑答案是不是篇章的片段，直接解码生成答案即可。这两种方式在本文的解码中都有相应的判断处理。</p>
<h2 id="_5">实验代码</h2>
<p>代码链接：<a href="https://github.com/bojone/bert4keras/blob/master/examples/task_reading_comprehension_by_seq2seq.py">task_reading_comprehension_by_seq2seq.py</a></p>
<p>最终在<a href="https://github.com/bojone/dgcnn_for_reading_comprehension">SogouQA自带的评估脚本</a>上，valid集的分数大概是0.77 (Accuracy=0.7259005836184343，F1=0.813860036706151，Final=0.7698803101622926)，单模型成绩远超过了之前的<a href="/archives/6906">《开源一版DGCNN阅读理解问答模型（Keras版）》</a>模型。当然，提升是有代价的——预测速度大大降低，每秒只能预测2条数据左右。</p>
<p>（模型没精细调优，估计还有提升空间，当前还是以demo为主。）</p>
<h2 id="_6">文章小结</h2>
<p>本文主要是给出了一个基于bert和seq2seq思路的阅读理解例子，并且给出了一种多篇章投票的beam search策略，供读者参考和测试～</p>
<p><em><strong>转载到请包括本文地址：</strong><a href="https://spaces.ac.cn/archives/7115">https://spaces.ac.cn/archives/7115</a></em></p>
<p><em><strong>更详细的转载事宜请参考：</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="《科学空间FAQ》">《科学空间FAQ》</a></p>
<p><strong>如果您还有什么疑惑或建议，欢迎在下方评论区继续讨论。</strong></p>
<p><strong>如果您觉得本文还不错，欢迎分享/打赏本文。打赏并非要从中获得收益，而是希望知道科学空间获得了多少读者的真心关注。当然，如果你无视它，也不会影响你的阅读。再次表示欢迎和感谢！</strong></p>
<p>打赏</p>
<p><img alt="科学空间" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>微信打赏</p>
<p><img alt="科学空间" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>支付宝打赏</p>
<p>因为网站后台对打赏并无记录，因此欢迎在打赏时候备注留言。你还可以<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>点击这里</strong></a>或在下方评论区留言来告知你的建议或需求。</p>
<p><strong>如果您需要引用本文，请参考：</strong></p>
<p>苏剑林. (Dec. 05, 2019). 《万能的seq2seq：基于seq2seq的阅读理解问答 》[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/7115">https://spaces.ac.cn/archives/7115</a></p>
<p>@online{kexuefm-7115,<br />
title={万能的seq2seq：基于seq2seq的阅读理解问答},<br />
author={苏剑林},<br />
year={2019},<br />
month={Dec},<br />
url={\url{https://spaces.ac.cn/archives/7115}},<br />
} </p>
<hr />
<h2 id="_7">公式推导与注释</h2>
<p>TODO: 添加详细的数学公式推导和注释</p>
        </div>
    </div>
</body>
</html>