<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoEç¯æ¸¸è®°ï¼š4ã€éš¾å¤„åº”å½“å¤šæŠ•å…¥</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>MoEç¯æ¸¸è®°ï¼š4ã€éš¾å¤„åº”å½“å¤šæŠ•å…¥</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-24 | ğŸ“„ å¤§å°: 44.1 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/10815">https://spaces.ac.cn/archives/10815</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>å‰ä¸¤ç¯‡æ–‡ç« æˆ‘ä»¬éƒ½åœ¨è®¨è®ºè´Ÿè½½å‡è¡¡ï¼Œå…¶ä¸­åœ¨<a href="/archives/10757">ã€ŠMoEç¯æ¸¸è®°ï¼š3ã€æ¢ä¸ªæ€è·¯æ¥åˆ†é…ã€‹</a>ä»‹ç»Loss-Freeæ–¹æ¡ˆæ—¶ï¼Œç¬”è€…ç•™äº†ä¸€ä¸ªæ‚¬å¿µï¼šå®ƒå¼•å…¥çš„Biasé¡¹æœ‰ä¸€ä¸ªå†—ä½™çš„è‡ªç”±åº¦ï¼Œè¿™ä¸ªè‡ªç”±åº¦å¯ä»¥ç”¨æ¥åšå¦å¤–æœ‰è¶£çš„äº‹æƒ…ã€‚è¿™ç¯‡æ–‡ç« æˆ‘ä»¬å°±æ¥è®¨è®ºè¿™ä»¶äº‹ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼ŒMoEæ˜¯ä¸ºæ¯ä¸ªTokenåªé€‰æ‹©æœ€åŒ¹é…çš„$k$ä¸ªExpertæ¥è¿›è¡Œè®¡ç®—ï¼Œä»è€Œåœ¨å¢å¤§å‚æ•°é‡çš„åŒæ—¶è¿˜èŠ‚çœäº†è®¡ç®—é‡ã€‚ç„¶è€Œï¼Œå½“æˆ‘ä»¬ä»”ç»†æ€è€ƒå°±ä¼šå‘ç°ï¼Œè¿™ä¸ªç­–ç•¥å®é™…ä¸Šæœ‰æ˜æ˜¾çš„å¯æ”¹è¿›ä¹‹å¤„ï¼šç›´è§‚æ¥çœ‹ï¼Œæ¯ä¸ªTokençš„éš¾åº¦å¹¶ä¸ä¸€æ ·ï¼Œæ‰€ä»¥æ›´åˆç†çš„æ–¹æ¡ˆåº”è¯¥æ˜¯éš¾çš„Tokenåˆ†é…æ›´å¤šçš„è®¡ç®—èµ„æºï¼Œç®€å•çš„tokenåˆ†é…æ›´å°‘çš„èµ„æºï¼Œè¿™æ ·æˆ–è®¸èƒ½åœ¨åŒæ ·æœ‰é™çš„èµ„æºä¸‹å°†æ•ˆæœæœ€å¤§åŒ–ã€‚</p>
<p>è€Œåˆšæ‰æåˆ°çš„Biasçš„é¢å¤–è‡ªç”±åº¦ï¼Œæ°å¥½å¯ä»¥ç”¨æ¥ç®€å•åœ°å®ç°è¿™ä¸ªç›®æ ‡ã€‚</p>
<h2 id="_1">è®¾è®¡æ€æƒ³</h2>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å›é¡¾ä¸€ä¸‹ï¼ŒMoEçš„åŸºæœ¬å½¢å¼æ˜¯<br />
\begin{equation}\boldsymbol{y} = \sum_{i\in \mathop{\text{argtop}}<em _mathop_text_argtop="\mathop{\text{argtop" i_in="i\in">k \boldsymbol{\rho}} \rho_i \boldsymbol{e}_i\end{equation}<br />
è´Ÿè½½ä¸å‡è¡¡æ˜¯MoEè®­ç»ƒå¸¸è§çš„é—®é¢˜ï¼Œå¯¹æ­¤ç ”ç©¶äººå‘˜æå‡ºäº†Aux Lossï¼Œè¿™éƒ¨åˆ†å·¥ä½œæˆ‘ä»¬ä»‹ç»äº<a href="/archives/10735">ã€ŠMoEç¯æ¸¸è®°ï¼š2ã€ä¸æ‚£å¯¡è€Œæ‚£ä¸å‡ã€‹</a>ã€‚æ­¤å¤–ï¼Œåœ¨<a href="/archives/10757">ã€ŠMoEç¯æ¸¸è®°ï¼š3ã€æ¢ä¸ªæ€è·¯æ¥åˆ†é…ã€‹</a>æˆ‘ä»¬ä»‹ç»äº†DeepSeekæå‡ºçš„Loss-Freeæ–¹æ¡ˆï¼Œå®ƒå°†MoEæ”¹ä¸º<br />
\begin{equation}\boldsymbol{y} = \sum</em>}<em _mathop_text_argwhere="\mathop{\text{argwhere" i_in="i\in">k \boldsymbol{\rho} + \boldsymbol{b}} \rho_i \boldsymbol{e}_i\end{equation}<br />
ç„¶åé€šè¿‡è°ƒèŠ‚æ–°å¼•å…¥çš„Biasé¡¹$\boldsymbol{b}$æ¥å®ç°è´Ÿè½½å‡è¡¡ã€‚ä¸ºäº†å®ç°æ¯ä¸ªTokenå¯ä»¥é€‰æ‹©åŠ¨æ€æ•°é‡çš„Expertï¼Œç¬”è€…æå‡ºçš„åšæ³•æ˜¯å°†Loss-Freeçš„å½¢å¼ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ï¼š<br />
\begin{equation}\boldsymbol{y} = \sum</em>}} \boldsymbol{\rho} + \boldsymbol{b} &gt; 0} \rho_i \boldsymbol{e}_i\end{equation<br />
å³åªè¦æ»¡è¶³$\rho_i + b_i &gt; 0$çš„Expertå°±è¢«é€‰ä¸­ï¼Œè¿™æ ·æ¯ä¸ªTokené€‰å‡ºçš„Expertæ•°é‡è‡ªç„¶æ˜¯åŠ¨æ€çš„ï¼Œå¹¶ä¸”å…é™¤äº†æ’åºçš„éœ€æ±‚ï¼ŒæŸç§ç¨‹åº¦ä¸Šçœ‹è¿˜å˜å¾—æ›´ç®€åŒ–äº†ã€‚</p>
<h2 id="_2">ä¼˜åŒ–ç›®æ ‡</h2>
<p>$\boldsymbol{b}$çš„ä¼˜åŒ–ç›®æ ‡æœ‰ä¸¤ä¸ªï¼šä¸€æ˜¯è·ŸLoss-Freeä¸€æ ·ï¼Œè¦å®ç°<strong>è´Ÿè½½å‡åŒ€</strong> ï¼›äºŒæ˜¯è¦æ§åˆ¶æ¯ä¸ªTokenè¢«é€‰ä¸­çš„<strong>å¹³å‡</strong> Expertæ•°ä¸º$k$ï¼Œè¿™æˆ‘ä»¬å¯ä»¥ç§°ä¸º<strong>é¢„ç®—æ§åˆ¶</strong> ï¼Œè¦ä¸ç„¶ç›´æ¥$b_i = \infty$å°†æ‰€æœ‰Expertéƒ½é€‰å‡ºæ¥å°±è¡Œäº†ï¼Œä½†è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p>
<p>è´Ÿè½½å‡è¡¡ä¾ç„¶é‡‡æ ·Loss-Freeçš„è®­ç»ƒæ–¹å¼ã€‚å®šä¹‰è®°å·$\boldsymbol{f} = [f_1, f_2, \cdots, f_n]$<br />
\begin{equation}f_i = \left\{\begin{aligned}1, \quad \rho_i + b_i &gt; 0 \\\<br />
0, \quad \rho_i + b_i \leq 0\end{aligned}\right.\end{equation}<br />
ç„¶åè®°$\tilde{\boldsymbol{F}}=\mathbb{E}[\boldsymbol{f}]$ï¼Œé‚£ä¹ˆ$\boldsymbol{F} = \tilde{\boldsymbol{F}}/|\tilde{\boldsymbol{F}}|$å°±æ˜¯å½“å‰Expertåˆ†å¸ƒï¼Œå…¶ä¸­$|\tilde{\boldsymbol{F}}|$æ˜¯$\tilde{\boldsymbol{F}}$çš„å„åˆ†é‡ä¹‹å’Œã€‚Loss-Freeæå‡ºçš„æ›´æ–°å…¬å¼æ˜¯ï¼š<br />
\begin{equation}\boldsymbol{b}\leftarrow \boldsymbol{b} - \alpha \mathop{\text{sign}}(\boldsymbol{F} - \boldsymbol{Q})\label{eq:aux-loss-free}\end{equation}<br />
å…¶ä¸­$\boldsymbol{Q}=(1/n, 1/n, \cdots, 1/n)$æ˜¯ç›®æ ‡çš„å‡åŒ€åˆ†å¸ƒã€‚æˆ‘ä»¬æåˆ°å¤šæ¬¡ï¼Œ$\boldsymbol{b}$å­˜åœ¨ä¸€ä¸ªå†—ä½™çš„è‡ªç”±åº¦ï¼Œä½“ç°åœ¨å¯¹$\boldsymbol{b}$æ‰€æœ‰åˆ†é‡åŠ ä¸ŠåŒä¸€ä¸ªå¸¸æ•°ï¼Œæ’åºç»“æœä¸å˜ã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ›´æ–°è§„åˆ™$\eqref{eq:aux-loss-free}$æ”¹ä¸º<br />
\begin{equation}\boldsymbol{b}\leftarrow \boldsymbol{b} - \alpha \left[\mathop{\text{sign}}(\boldsymbol{F} - \boldsymbol{Q}) - \overline{\mathop{\text{sign}}(\boldsymbol{F} - \boldsymbol{Q})}\right]\label{eq:aux-loss-free-2}\end{equation}<br />
è¿™é‡Œå‘é‡ä¸Šé¢åŠ ä¸€æ¨ªä»£è¡¨è¯¥å‘é‡çš„å…¨ä½“åˆ†é‡çš„å‡å€¼ï¼Œæ˜¯ä¸€ä¸ªæ ‡é‡ï¼Œå‘é‡å‡æ ‡é‡ä»£è¡¨æ¯ä¸ªåˆ†é‡éƒ½å‡å»è¿™ä¸ªæ ‡é‡ã€‚è¿™æ ·ä¸€æ¥å‡ºæ¥çš„$\boldsymbol{b}$å¿…ç„¶æ»¡è¶³$\overline{\boldsymbol{b}}=0$ï¼Œä½†ä¸æ”¹å˜è´Ÿè½½å‡è¡¡çš„æ•ˆæœã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥$\overline{\boldsymbol{b}}$è¿™ä¸ªè‡ªç”±åº¦ç•™ç»™é¢„ç®—æ§åˆ¶ã€‚</p>
<p>æ€ä¹ˆç†è§£å‘¢ï¼Ÿå¾ˆæ˜æ˜¾ï¼Œå¦‚æœç»™å…¨ä½“$b_i$éƒ½åŠ ä¸ŠåŒä¸€ä¸ªæ­£æ•°ï¼Œé‚£ä¹ˆæ»¡è¶³$\rho_i + b_i &gt; 0$çš„å‡ ç‡å°†ä¼šå˜å¤§ï¼Œä»è€Œæ€»é¢„ç®—ä¹Ÿä¼šå¢å¤§ã€‚æ‰€ä»¥åšæ³•å¾ˆç®€å•ï¼Œå…ˆç®—å‡ºå½“å‰å¹³å‡é¢„ç®—ï¼Œä¸éš¾å‘ç°æ­£å¥½æ˜¯$|\tilde{\boldsymbol{F}}|$ï¼Œå¦‚æœå®ƒå¤§äº$k$ï¼Œé‚£ä¹ˆå°±è°ƒå°ä¸€ç‚¹$\boldsymbol{b}$ï¼Œåä¹‹åˆ™å¢å¤§ã€‚æ•´åˆåˆ°å¼$\eqref{eq:aux-loss-free-2}$æ˜¯<br />
\begin{equation}\boldsymbol{b}\leftarrow \boldsymbol{b} - \alpha \left[\mathop{\text{sign}}(\boldsymbol{F} - \boldsymbol{Q}) - \overline{\mathop{\text{sign}}(\boldsymbol{F} - \boldsymbol{Q})} + \mathop{\text{sign}}(|\tilde{\boldsymbol{F}}|- k)\right]\label{eq:aux-loss-free-3}\end{equation}<br />
å¦‚æœåªæƒ³ä¿è¯é¢„ç®—ä¸è¶…è¿‡$k$ï¼Œè€Œä¸éè¦ç­‰äº$k$ï¼Œé‚£ä¹ˆå¯ä»¥æ”¹ä¸ºå½“$|\tilde{\boldsymbol{F}}| &lt; k$æ—¶ä¸ä½œæ”¹å˜<br />
\begin{equation}\boldsymbol{b}\leftarrow \boldsymbol{b} - \alpha \left[\mathop{\text{sign}}(\boldsymbol{F} - \boldsymbol{Q}) - \overline{\mathop{\text{sign}}(\boldsymbol{F} - \boldsymbol{Q})} + \mathop{\text{sign}}(\max(|\tilde{\boldsymbol{F}}|- k,0))\right]\label{eq:aux-loss-free-4}\end{equation}</p>
<h2 id="_3">å°è¯•ç®€åŒ–</h2>
<p>ç»†ç»†å“å‘³å¼$\eqref{eq:aux-loss-free-3}$ï¼Œæˆ‘ä»¬ä¼šå‘ç°å®ƒåšäº†ä¸¤ä»¶äº‹ï¼Œä¸€æ˜¯è®©$\boldsymbol{F}=\tilde{\boldsymbol{F}}/|\tilde{\boldsymbol{F}}|$é€¼è¿‘$\boldsymbol{Q}$ï¼ŒäºŒæ˜¯è®©$|\tilde{\boldsymbol{F}}|$é€¼è¿‘$k$ã€‚è¿™çœ‹èµ·æ¥å¯ä»¥åˆå¹¶æˆä¸€ä»¶äº‹ï¼šè®©$\tilde{\boldsymbol{F}}$é€¼è¿‘$\tilde{\boldsymbol{Q}}=k\boldsymbol{Q}=(k/n,k/n,\cdots,k/n)$ã€‚äºæ˜¯å¼$\eqref{eq:aux-loss-free-3}$å¯ä»¥ç®€åŒ–ä¸º<br />
\begin{equation}\boldsymbol{b}\leftarrow \boldsymbol{b} - \alpha \mathop{\text{sign}}(\tilde{\boldsymbol{F}} - \tilde{\boldsymbol{Q}})\label{eq:aux-loss-free-5}\end{equation}</p>
<p>ç¬”è€…å°†å¼$\eqref{eq:aux-loss-free-3}$å’Œå¼$\eqref{eq:aux-loss-free-5}$éƒ½åšäº†å®éªŒï¼Œå‘ç°å®ƒä»¬åœ¨æ•ˆæœä¸Šå¤§åŒå°å¼‚ï¼Œä½†æ˜¯å¼$\eqref{eq:aux-loss-free-5}$çš„è´Ÿè½½å‡è¡¡å’Œé¢„ç®—æ§åˆ¶ä¸¤ä¸ªæŒ‡æ ‡åœ¨è®­ç»ƒå‰æœŸçš„æŠ–åŠ¨éƒ½å¤§å¾ˆå¤šï¼Œæ‰€ä»¥è¿½æ±‚ç¨³å®šæ€§çš„è¯»è€…å¯ä»¥ä¼˜å…ˆè€ƒè™‘å¼$\eqref{eq:aux-loss-free-3}$æˆ–$\eqref{eq:aux-loss-free-4}$ï¼Œè¿½æ±‚ç®€æ´çš„è¯»è€…åˆ™å¯ä»¥è€ƒè™‘å¼$\eqref{eq:aux-loss-free-5}$ã€‚</p>
<p>è€ƒè™‘åˆ°$\mathop{\text{sign}}$åªä¿ç•™äº†$\tilde{F}<em RMS="RMS">i - \tilde{Q}_i$çš„ç¬¦å·è€Œå¿½ç•¥äº†ç»å¯¹å€¼çš„å¤§å°ï¼Œç¬”è€…ä¹Ÿå°è¯•RMS Normæ›¿ä»£$\mathop{\text{sign}}$ï¼š<br />
\begin{equation}\boldsymbol{b}\leftarrow \boldsymbol{b} - \alpha (\tilde{\boldsymbol{F}} - \tilde{\boldsymbol{Q}})/\Vert\tilde{\boldsymbol{F}} - \tilde{\boldsymbol{Q}}\Vert</em>}\end{equation<br />
å…¶ä¸­å‘é‡çš„$\Vert\cdot\Vert_{RMS}$æ˜¯æŒ‡åˆ†é‡çš„å¹³æ–¹å’Œçš„å¹³æ–¹æ ¹ã€‚å¾ˆæ˜æ˜¾$\mathop{\text{sign}}$çš„RMSæ˜¯1ï¼Œè€ŒRMS Normä¹‹åRMSä¹Ÿä¸º1ï¼Œæ‰€ä»¥ä¸¤è€…æ›´æ–°çš„æ•°é‡çº§ç›¸åŒï¼Œå¯ä»¥ç”¨åŒä¸€ä¸ª$\alpha$ã€‚ç”±äºRMS Normä¿ç•™äº†$\tilde{F}_i - \tilde{Q}_i$çš„ç›¸å¯¹å¤§å°ï¼Œå¯ä»¥åšåˆ°è¯¯å·®å°çš„æ›´æ–°ä¹Ÿå°ï¼Œæ‰€ä»¥åœ¨æ³¢åŠ¨ç¨‹åº¦ä¸Šæ¯”$\mathop{\text{sign}}$ç•¥å°ï¼Œä½†ä¹Ÿå¥½å¾—ä¸å¤šã€‚</p>
<p>å½“ç„¶ï¼Œç”¨RMS Normæ›¿æ¢$\mathop{\text{sign}}$æ¥å¢åŠ ç¨³å®šæ€§æ˜¯ä¸€ä¸ªé€šç”¨æŠ€å·§ï¼Œå¼$\eqref{eq:aux-loss-free}$ã€$\eqref{eq:aux-loss-free-2}$ã€$\eqref{eq:aux-loss-free-3}$æˆ–$\eqref{eq:aux-loss-free-4}$éƒ½å¯ä»¥åšè¿™æ ·çš„æ›¿æ¢ï¼Œè¿™å°±çœ‹ä¸ªäººå®¡ç¾äº†ï¼Œæ€»ä¹‹åªæ˜¯ç•¥ç¨³ä½†ä¸å¤šã€‚</p>
<h2 id="_4">åˆå§‹æ–¹å¼</h2>
<p>è§£å†³å®Œ$\boldsymbol{b}$çš„æ›´æ–°è§„åˆ™ï¼Œæˆ‘ä»¬æ¥è€ƒè™‘$\boldsymbol{b}$çš„åˆå§‹åŒ–ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰æ„æ€ä½†ä¸ç®—ååˆ†å…³é”®çš„é—®é¢˜ã€‚</p>
<p>æŒ‰ç…§å¸¸è§„åšæ³•ï¼Œ$\boldsymbol{b}$å…¨é›¶åˆå§‹åŒ–ä¸”$\boldsymbol{\rho}$ç”¨Sigmoidæ¿€æ´»ï¼Œé‚£ä¹ˆåˆå§‹é˜¶æ®µä¼šæŠŠ$n$ä¸ªExpertéƒ½é€‰å‡ºæ¥ï¼Œæ˜æ˜¾è¶…å‡º$\leq k$çš„é¢„ç®—ï¼Œè¿™å°†ä¼šå¯¼è‡´éå¸¸å¤šçš„Token Dropã€‚ä¸è¿‡ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰å¼ºè¿«ç—‡çš„è¯ï¼Œè¿™å¹¶ä¸æ˜¯å¾ˆä¸¥é‡çš„é—®é¢˜ï¼Œå› ä¸ºæ¨¡å‹å…¶ä»–å‚æ•°é€šå¸¸ä¼šåŠ Warmupä½†$\boldsymbol{b}$é€šå¸¸ä¸åŠ ï¼Œæ‰€ä»¥åœ¨Warmupçš„å‰å‡ æ­¥æ¨¡å‹å°±ä¼šè‡ªåŠ¨æŠŠè¿™ä¸ªé—®é¢˜è§£å†³äº†ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬ä»‹æ„è¿™ä¸€ç‚¹ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡è°ƒæ•´$\boldsymbol{b}$åˆå§‹åŒ–æ¥æ§åˆ¶åˆå§‹é¢„ç®—ã€‚å‡è®¾Routerçš„è¾“å…¥æ˜¯$d$ç»´å‘é‡ï¼Œæ»¡è¶³é›¶å‡å€¼ã€å•ä½æ–¹å·®ï¼ˆæœ‰RMSNormåœ¨ï¼Œè¿‘ä¼¼æˆç«‹ï¼‰ï¼ŒRouterçš„æƒé‡åˆå§‹åŒ–æ–¹å·®ä¸º$\sigma^2$ï¼Œé‚£ä¹ˆRouterçš„Logitsè¿‘ä¼¼ä¸ºé›¶å‡å€¼ã€$\sigma^2 d$æ–¹å·®ã€‚æœ‰äº†è¿™äº›æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ­£æ€è¿‘ä¼¼æ¨¡æ‹ŸåŠ äºŒåˆ†æ³•ä¼°ç®—ä¸€ä¸ªåˆå§‹$\boldsymbol{b}$ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="kp">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">b_init</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
    <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
    <span class="kp">std</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">d</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">logits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="kp">std</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">logits</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">b1</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="n">c</span> <span class="o">=</span> <span class="p">((</span><span class="n">scores</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="kp">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="kp">mean</span><span class="p">()</span>
        <span class="k">if</span> <span class="o">-</span><span class="n">eps</span> <span class="o">&lt;</span> <span class="n">c</span> <span class="o">-</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">b</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">:</span>
            <span class="n">b2</span> <span class="o">=</span> <span class="n">b</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">b1</span> <span class="o">=</span> <span class="n">b</span>

<span class="n">b_init</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mf">6e-3</span><span class="p">)</span>
</code></pre></div>

<p>ä»£ç ä¸­è€ƒè™‘çš„æ˜¯Sigmoidæ¿€æ´»ï¼Œæ‰€ä»¥æœç´¢åŒºé—´æ˜¯$[-1, 0]$ï¼Œå¦‚æœæ˜¯å…¶ä»–æ¿€æ´»å‡½æ•°è¯·è‡ªè¡Œè°ƒæ•´ã€‚ä¸è¿‡è¿™é‡Œçš„å»ºè®®è·Ÿ<a href="/archives/10757">ã€ŠMoEç¯æ¸¸è®°ï¼š3ã€æ¢ä¸ªæ€è·¯æ¥åˆ†é…ã€‹</a>ä¸€æ–‡æ˜¯ç›¸åŒçš„ï¼Œå³åŠ $\boldsymbol{b}$çš„$\boldsymbol{\rho}$å¯ä»¥ç»Ÿä¸€ç”¨Sigmoidæ¿€æ´»ï¼Œä¹˜ä¸ŠExpertçš„$\boldsymbol{\rho}$æ‰è€ƒè™‘ç”¨åˆ«çš„æ¿€æ´»å‡½æ•°ã€‚</p>
<h2 id="_5">ç›¸å…³å·¥ä½œ</h2>
<p>è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œå·²ç»æœ‰ä¸€äº›å·¥ä½œå°è¯•è¿‡åŠ¨æ€é€‰æ‹©Expertæ•°ç›®çš„MoEè®¾è®¡ï¼Œä¸‹é¢ç®€å•åˆ—ä¸¾ä¸€äº›ç¬”è€…æœåˆ°çš„å·¥ä½œï¼Œå¹¶ä»ä¸ªäººçš„å®¡ç¾è§’åº¦åšä¸€äº›ç®€å•çš„è¯„æã€‚</p>
<p>æ¯”è¾ƒæœ´ç´ çš„åšæ³•æ˜¯<a href="https://papers.cool/arxiv/2406.13233">AdaMoE</a>å’Œ<a href="https://papers.cool/arxiv/2410.07348">MoE++</a>ï¼Œå®ƒä»¬åœ¨Expertä¸­æ··å…¥äº†ä¸€äº›ä½è®¡ç®—æˆæœ¬çš„Expertï¼Œå¦‚ç©ºç™½Expertã€å¤åˆ¶Expertã€å¸¸æ•°Expertï¼ŒåŒæ—¶ä¹Ÿé¼“åŠ±è´Ÿè½½å‡è¡¡ï¼Œè¿™æ ·å½“Tokené€‰ä¸­è¿™äº›ç®€å•Expertæ—¶ï¼Œç­‰ä»·äºå°‘é€‰æ‹©äº†å…¶ä»–æ ‡å‡†çš„Expertï¼Œä»è€Œé—´æ¥åœ°å®ç°äº†åŠ¨æ€æ•°ç›®ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥å¤ç”¨åŸæœ¬Top-$k$ MoEçš„åŸºå»ºï¼Œä½†åŒæ—¶ä¹Ÿæ¬ ç¼ºäº†ä¸€äº›çµæ´»æ€§ã€‚</p>
<p>å¦å¤–ä¸€ä¸ªæœ´ç´ çš„æƒ³æ³•æ˜¯å°†Top-$k$é€‰æ‹©æ”¹ä¸ºTop-$p$ï¼Œå‡ºè‡ª<a href="https://papers.cool/arxiv/2403.07652">ã€ŠHarder Tasks Need More Experts: Dynamic Routing in MoE Modelsã€‹</a>ã€‚è¿™ä¸ªè½¬æ¢çœ‹ä¸Šå»å¾ˆè‡ªç„¶ï¼Œä½†å®é™…ä¸Šæœ‰é¢‡å¤šé—®é¢˜ï¼Œæ¯”å¦‚æ— æ³•å‡†ç¡®æ§åˆ¶å¹³å‡é¢„ç®—ï¼Œå› ä¸ºå½“$\boldsymbol{\rho}$æ¥è¿‘å‡åŒ€åˆ†å¸ƒæ—¶Top-$p$çš„æ¯”ä¾‹ä¼šéå¸¸å¤§ï¼Œæ‰€ä»¥åŸè®ºæ–‡åˆæ–°å¢äº†ä¸€é¡¹ç†µæŸå¤±æ¥è®©$\boldsymbol{\rho}$è¿œç¦»å‡åŒ€åˆ†å¸ƒã€‚æ€»çš„æ¥è¯´ï¼Œä¸ªäººæ„Ÿè§‰å®ƒå¼•å…¥çš„é—®é¢˜æ¯”æ”¶ç›Šæ›´æ˜æ˜¾ã€‚</p>
<p>ä¸€ä¸ªæ¯”è¾ƒç‹¬ç‰¹çš„åšæ³•æ˜¯<a href="https://papers.cool/arxiv/2410.10456">Ada-K Routing</a>ï¼Œå®ƒæ–°å¢ä¸€ä¸ªæ¨¡å—æ¥é¢„æµ‹è¦æ¿€æ´»çš„Expertæ•°ï¼Œç„¶åç”¨å¼ºåŒ–å­¦ä¹ æ¥è®­ç»ƒï¼Œè¿™æ ·åšåœ¨åŸç†ä¸Šæ²¡é—®é¢˜ï¼Œä½†å¼•å…¥å¼ºåŒ–å­¦ä¹ æ— ç–‘ä¼šå¢åŠ è®­ç»ƒå¤æ‚æ€§ã€‚<a href="https://papers.cool/arxiv/2409.06669">DA-MoE</a>åˆ™åˆ©ç”¨Attentionåˆ†æ•°æ¥è¯†åˆ«é‡è¦Tokenï¼Œä¸ºå…¶åˆ†é…æ›´å¤šExpertï¼Œä½†æ„Ÿè§‰ä¸å¤Ÿæœ¬è´¨ï¼Œå› ä¸ºâ€œMoEâ€åŸåˆ™ä¸Šä¸å±€é™äºFFNå±‚ï¼Œä¸€æ—¦ç”¨åˆ°Attentionä¸Šï¼Œä¸å°±æ²¡æœ‰Attentionåˆ†æ•°å¯ç”¨äº†ï¼Ÿ</p>
<p>å½¢å¼ä¸Šè·Ÿæœ¬æ–‡åšæ³•æœ€ç›¸ä¼¼çš„å¯èƒ½æ˜¯<a href="https://papers.cool/arxiv/2412.14711">ReMoE</a>ï¼Œå®ƒåŒæ ·æ˜¯åŸºäºé›¶é˜ˆå€¼æ¥é€‰æ‹©Expertï¼Œä½†é€‰æ‹©äº†Aux Lossçš„æ–¹å¼æ¥å®ç°è´Ÿè½½å‡åŒ€ä»¥åŠé¢„ç®—æ§åˆ¶ï¼ŒåŒæ—¶åˆæ··åˆäº†æ‰‹æ“æ¢¯åº¦çš„æ€æƒ³æ¥æ§åˆ¶Aux Lossæƒé‡ï¼Œæ€»ä½“æ¥çœ‹å¤šäº†ç‚¹ç³…åˆæ„Ÿã€‚æœ¬æ–‡åˆ™å»¶ç»­äº†Loss-Freeçš„æ€æƒ³ï¼Œåˆ©ç”¨$\boldsymbol{b}$çš„é¢å¤–è‡ªç”±åº¦æ¥è°ƒæ§è¿™ä¸ªé˜ˆå€¼ï¼Œä»è€Œä»¥æœ€å°çš„æ”¹åŠ¨å®ç°äº†åŠ¨æ€Expertæ•°ç›®ã€‚</p>
<h2 id="_6">æ–‡ç« å°ç»“</h2>
<p>æœ¬æ–‡æå‡ºäº†ä¸€ç§åŠ¨æ€é€‰æ‹©Expertæ•°ç›®çš„MoEè®¾è®¡ï¼Œä¸»è¦æ€æƒ³æ˜¯å¯¹Loss-Freeçš„MoEå½¢å¼ç¨ä½œä¿®æ”¹ï¼Œç„¶åè°ƒæ•´Biasé¡¹çš„æ›´æ–°è§„åˆ™ï¼Œåˆ©ç”¨å®ƒçš„é¢å¤–è‡ªç”±åº¦æ¥åŒæ—¶å®ç°è´Ÿè½½å‡è¡¡å’Œé¢„ç®—æ§åˆ¶ã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/10815">https://spaces.ac.cn/archives/10815</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Mar. 28, 2025). ã€ŠMoEç¯æ¸¸è®°ï¼š4ã€éš¾å¤„åº”å½“å¤šæŠ•å…¥ ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/10815">https://spaces.ac.cn/archives/10815</a></p>
<p>@online{kexuefm-10815,<br />
title={MoEç¯æ¸¸è®°ï¼š4ã€éš¾å¤„åº”å½“å¤šæŠ•å…¥},<br />
author={è‹å‰‘æ—},<br />
year={2025},<br />
month={Mar},<br />
url={\url{https://spaces.ac.cn/archives/10815}},<br />
} </p>
<hr />
<h2 id="_7">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<h3 id="1">ç¬¬1éƒ¨åˆ†ï¼šæ ¸å¿ƒç†è®ºã€å…¬ç†ä¸å†å²åŸºç¡€</h3>
<h4 id="11">1.1 ç†è®ºèµ·æºä¸å†å²å‘å±•</h4>
<p><strong>åŠ¨æ€èµ„æºåˆ†é…çš„ç†è®ºæ ¹æº</strong>ï¼š</p>
<div class="theorem-box">

**å¤šé¢†åŸŸèåˆ**ï¼š
- **è¯¾ç¨‹å­¦ä¹ ** (Curriculum Learning, 2009, Bengio)ï¼šä»æ˜“åˆ°éš¾è®­ç»ƒæ¨¡å‹
- **è‡ªé€‚åº”å­¦ä¹ ** (Self-Paced Learning, 2010)ï¼šåŠ¨æ€è°ƒæ•´æ ·æœ¬æƒé‡
- **éš¾åº¦æ„ŸçŸ¥è®­ç»ƒ** (Hardness-Aware Training)ï¼šå›°éš¾æ ·æœ¬éœ€è¦æ›´å¤šattention
- **è®¡ç®—èµ„æºåˆ†é…** (Computational Resource Allocation)ï¼šç»æµå­¦ä¸­çš„ç¨€ç¼ºèµ„æºæœ€ä¼˜åˆ†é…
- **åŠ¨æ€ç¥ç»ç½‘ç»œ** (Dynamic Neural Networks, 2016+)ï¼šæ ¹æ®è¾“å…¥è°ƒæ•´æ¨¡å‹å®¹é‡

</div>

<p><strong>å…³é”®é‡Œç¨‹ç¢‘</strong>ï¼š
1. <strong>2009 - Bengioè¯¾ç¨‹å­¦ä¹ </strong>ï¼šæå‡ºä»æ˜“åˆ°éš¾è®­ç»ƒçš„ç†å¿µ
2. <strong>2017 - MoE in Transformer</strong>ï¼šShazeerç­‰äººå°†MoEå¼•å…¥å¤§è§„æ¨¡æ¨¡å‹
3. <strong>2021 - Switch Transformer</strong>ï¼šç®€åŒ–ä¸ºTop-1ä½†fixed $k$
4. <strong>2024 - Loss-Free (DeepSeek)</strong>ï¼šå¼•å…¥Biasè§£å†³è´Ÿè½½å‡è¡¡
5. <strong>2024 - æœ¬æ–‡æ–¹æ³•</strong>ï¼šåˆ©ç”¨Biasçš„è‡ªç”±åº¦å®ç°åŠ¨æ€Expertæ•°</p>
<h4 id="12">1.2 æ•°å­¦å…¬ç†ä¸åŸºç¡€å‡è®¾</h4>
<div class="theorem-box">

### å…¬ç†1ï¼šæ ·æœ¬éš¾åº¦å¼‚è´¨æ€§ï¼ˆSample Difficulty Heterogeneityï¼‰

ä¸åŒæ ·æœ¬å…·æœ‰ä¸åŒçš„å†…åœ¨éš¾åº¦ï¼Œéœ€è¦ä¸åŒçš„è®¡ç®—èµ„æºï¼š

$$\exists d: \mathcal{X} \to \mathbb{R}_+, \quad d(\boldsymbol{x}_1) \neq d(\boldsymbol{x}_2) \text{ in general}$$

</div>

<div class="theorem-box">

### å…¬ç†2ï¼šè®¡ç®—èµ„æºä¸æ€§èƒ½çš„å•è°ƒå…³ç³»

æ›´å¤šè®¡ç®—èµ„æºï¼ˆExpertï¼‰å¯¼è‡´æ›´å¥½æ€§èƒ½ï¼Œä½†è¾¹é™…æ”¶ç›Šé€’å‡ï¼š

$$\mathcal{L}(k+1) \leq \mathcal{L}(k), \quad \frac{\partial^2 \mathcal{L}}{\partial k^2} > 0$$

</div>

<div class="theorem-box">

### å…¬ç†3ï¼šBiasçš„å¹³ç§»ä¸å˜æ€§

å¯¹Biasæ‰€æœ‰åˆ†é‡åŠ ç›¸åŒå¸¸æ•°$c$ï¼Œä¼šæ”¹å˜é€‰æ‹©çš„Expertæ€»æ•°ï¼Œä½†ä¸æ”¹å˜è´Ÿè½½åˆ†å¸ƒå½¢çŠ¶ã€‚

</div>

<h4 id="13">1.3 è®¾è®¡å“²å­¦</h4>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š"éš¾é¢˜å¤šæŠ•å…¥ï¼Œæ˜“é¢˜çœèµ„æº"ï¼ˆMore for Hard, Less for Easyï¼‰</p>
<ul>
<li><strong>èµ„æºåˆ†é…å…¬å¹³æ€§</strong>ï¼šä¸æ˜¯å‡åˆ†èµ„æºï¼Œè€Œæ˜¯æŒ‰éœ€åˆ†é…</li>
<li><strong>æ•ˆç”¨æœ€å¤§åŒ–</strong>ï¼šåœ¨å›ºå®šé¢„ç®—ä¸‹æœ€å¤§åŒ–æ•´ä½“æ€§èƒ½</li>
<li><strong>è‡ªé€‚åº”æ€§</strong>ï¼šç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«å¹¶é€‚åº”æ ·æœ¬éš¾åº¦</li>
</ul>
<hr />
<h3 id="2">ç¬¬2éƒ¨åˆ†ï¼šä¸¥è°¨çš„æ ¸å¿ƒæ•°å­¦æ¨å¯¼</h3>
<p>æœ¬èŠ‚å°†æ·±å…¥æ¨å¯¼åŠ¨æ€Experté€‰æ‹©çš„MoEæœºåˆ¶ï¼ŒåŒ…æ‹¬æ ·æœ¬éš¾åº¦çš„æ•°å­¦å®šä¹‰ã€åŠ¨æ€è·¯ç”±çš„ç†è®ºæ¡†æ¶ã€éš¾åº¦æ„ŸçŸ¥æŸå¤±å‡½æ•°çš„è®¾è®¡ã€å®Œæ•´çš„æ¢¯åº¦æ¨å¯¼ã€èµ„æºåˆ†é…çš„æœ€ä¼˜æ€§è¯æ˜ã€ä¸è¯¾ç¨‹å­¦ä¹ çš„ç†è®ºè”ç³»ï¼Œä»¥åŠç†è®ºä¿è¯ä¸å®è·µéªŒè¯ã€‚</p>
<h3 id="1_1">1. æ ·æœ¬éš¾åº¦çš„æ•°å­¦å®šä¹‰</h3>
<h4 id="11_1">1.1 åŸºäºæŸå¤±çš„éš¾åº¦åº¦é‡</h4>
<p><strong>æ¨å¯¼1ï¼šç¬æ—¶æŸå¤±ä½œä¸ºéš¾åº¦æŒ‡æ ‡</strong></p>
<p>å¯¹äºè¾“å…¥æ ·æœ¬$\boldsymbol{x}$å’Œç›®æ ‡$\boldsymbol{y}$ï¼Œå®šä¹‰æ ·æœ¬éš¾åº¦ä¸ºæ¨¡å‹çš„é¢„æµ‹æŸå¤±ï¼š</p>
<p>$$
d(\boldsymbol{x}, \boldsymbol{y}) = \mathcal{L}(\boldsymbol{f}(\boldsymbol{x}), \boldsymbol{y})
$$</p>
<p>å…¶ä¸­$\boldsymbol{f}$æ˜¯æ¨¡å‹é¢„æµ‹å‡½æ•°ï¼Œ$\mathcal{L}$æ˜¯æŸå¤±å‡½æ•°ï¼ˆå¦‚äº¤å‰ç†µï¼‰ã€‚</p>
<p>å¯¹äºè¯­è¨€æ¨¡å‹ï¼ŒTokençº§åˆ«çš„éš¾åº¦ä¸ºï¼š</p>
<p>$$
d_t = -\log p(y_t | y_{<t}, \boldsymbol{x})
$$</p>
<p>å…¶ä¸­$p(y_t | y_{&lt;t}, \boldsymbol{x})$æ˜¯æ¨¡å‹é¢„æµ‹çš„çœŸå®Tokençš„æ¦‚ç‡ã€‚</p>
<p><strong>æ¨å¯¼2ï¼šéš¾åº¦çš„ç»Ÿè®¡ç‰¹æ€§</strong></p>
<p>åœ¨è®­ç»ƒé›†$\mathcal{D}$ä¸Šï¼Œæ ·æœ¬éš¾åº¦çš„åˆ†å¸ƒå¯ä»¥ç”¨ç»éªŒåˆ†å¸ƒæè¿°ï¼š</p>
<p>$$
\hat{P}(d) = \frac{1}{|\mathcal{D}|} \sum_{(\boldsymbol{x}, \boldsymbol{y}) \in \mathcal{D}} \delta(d - d(\boldsymbol{x}, \boldsymbol{y}))
$$</p>
<p>å…¶ä¸­$\delta$æ˜¯Dirac deltaå‡½æ•°ã€‚</p>
<p>éš¾åº¦çš„æœŸæœ›å€¼ï¼š</p>
<p>$$
\mathbb{E}[d] = \frac{1}{|\mathcal{D}|} \sum_{(\boldsymbol{x}, \boldsymbol{y}) \in \mathcal{D}} d(\boldsymbol{x}, \boldsymbol{y})
$$</p>
<p>éš¾åº¦çš„æ–¹å·®ï¼š</p>
<p>$$
\text{Var}(d) = \mathbb{E}[d^2] - (\mathbb{E}[d])^2
$$</p>
<p>é«˜æ–¹å·®æ„å‘³ç€æ ·æœ¬éš¾åº¦å·®å¼‚å¤§ï¼Œæ›´éœ€è¦åŠ¨æ€èµ„æºåˆ†é…ã€‚</p>
<h4 id="12_1">1.2 åŸºäºæ¢¯åº¦çš„éš¾åº¦åº¦é‡</h4>
<p><strong>æ¨å¯¼3ï¼šæ¢¯åº¦èŒƒæ•°ä½œä¸ºéš¾åº¦</strong></p>
<p>å¦ä¸€ç§éš¾åº¦å®šä¹‰åŸºäºæ¢¯åº¦çš„å¤§å°ï¼š</p>
<p>$$
d_{\text{grad}}(\boldsymbol{x}, \boldsymbol{y}) = \|\nabla_{\boldsymbol{\theta}} \mathcal{L}(\boldsymbol{f}(\boldsymbol{x}), \boldsymbol{y})\|
$$</p>
<p>æ¢¯åº¦å¤§çš„æ ·æœ¬å¯¹æ¨¡å‹æ›´æ–°å½±å“å¤§ï¼Œå¯ä»¥è§†ä¸º"é‡è¦"æˆ–"å›°éš¾"çš„æ ·æœ¬ã€‚</p>
<p><strong>æ¨å¯¼4ï¼šæ¢¯åº¦éš¾åº¦ä¸æŸå¤±éš¾åº¦çš„å…³ç³»</strong></p>
<p>å¯¹äºå‡¸æŸå¤±å‡½æ•°ï¼Œæ¢¯åº¦èŒƒæ•°ä¸æŸå¤±å€¼é€šå¸¸æ­£ç›¸å…³ã€‚å¯¹äºLipschitzè¿ç»­çš„æŸå¤±ï¼š</p>
<p>$$
\|\nabla_{\boldsymbol{\theta}} \mathcal{L}\| \leq L \cdot \mathcal{L}
$$</p>
<p>å…¶ä¸­$L$æ˜¯Lipschitzå¸¸æ•°ã€‚</p>
<p>ä½†å¯¹äºç¥ç»ç½‘ç»œï¼Œè¿™ä¸ªå…³ç³»æ›´å¤æ‚ã€‚åœ¨æŸå¤±æ›²é¢çš„å¹³å¦åŒºåŸŸï¼Œå³ä½¿æŸå¤±å¤§ï¼Œæ¢¯åº¦ä¹Ÿå¯èƒ½å°ã€‚</p>
<h4 id="13_1">1.3 åŸºäºé¢„æµ‹ä¸ç¡®å®šæ€§çš„éš¾åº¦</h4>
<p><strong>æ¨å¯¼5ï¼šç†µä½œä¸ºéš¾åº¦åº¦é‡</strong></p>
<p>å¯¹äºåˆ†ç±»é—®é¢˜ï¼Œé¢„æµ‹åˆ†å¸ƒçš„ç†µå¯ä»¥è¡¡é‡ä¸ç¡®å®šæ€§ï¼š</p>
<p>$$
d_{\text{entropy}}(\boldsymbol{x}) = -\sum_{c=1}^{C} p(y=c|\boldsymbol{x}) \log p(y=c|\boldsymbol{x})
$$</p>
<p>å…¶ä¸­$C$æ˜¯ç±»åˆ«æ•°ã€‚ç†µå¤§è¡¨ç¤ºæ¨¡å‹å¯¹é¢„æµ‹ä¸ç¡®å®šï¼Œæ ·æœ¬å¯èƒ½è¾ƒéš¾ã€‚</p>
<p><strong>æ¨å¯¼6ï¼šæœ€å¤§æ¦‚ç‡çš„äº’è¡¥ä½œä¸ºéš¾åº¦</strong></p>
<p>æ›´ç®€å•çš„åº¦é‡æ˜¯æœ€å¤§é¢„æµ‹æ¦‚ç‡çš„äº’è¡¥ï¼š</p>
<p>$$
d_{\text{conf}}(\boldsymbol{x}) = 1 - \max_{c} p(y=c|\boldsymbol{x})
$$</p>
<p>è¿™ä¸ªå€¼è¶Šå¤§ï¼Œæ¨¡å‹è¶Šä¸ç¡®å®šï¼Œæ ·æœ¬è¶Šéš¾ã€‚</p>
<h3 id="2_1">2. åŠ¨æ€è·¯ç”±çš„æ•°å­¦æ¡†æ¶</h3>
<h4 id="21-expertmoe">2.1 åŠ¨æ€Expertæ•°çš„MoE</h4>
<p><strong>æ¨å¯¼7ï¼šé˜ˆå€¼åŒ–é€‰æ‹©æœºåˆ¶</strong></p>
<p>æ ‡å‡†Top-K MoEå›ºå®šé€‰æ‹©$k$ä¸ªExpertï¼š</p>
<p>$$
\boldsymbol{y}_{\text{static}} = \sum_{i \in \mathop{\text{argtop}}_k \boldsymbol{\rho}} \rho_i \boldsymbol{e}_i
$$</p>
<p>åŠ¨æ€MoEå¼•å…¥Biasé¡¹$\boldsymbol{b}$å’Œé˜ˆå€¼åˆ¤æ–­ï¼š</p>
<p>$$
\boldsymbol{y}_{\text{dynamic}} = \sum_{i : \rho_i + b_i > 0} \rho_i \boldsymbol{e}_i
$$</p>
<p>æ¯ä¸ªTokené€‰æ‹©çš„Expertæ•°ä¸å›ºå®šï¼Œå–å†³äºæœ‰å¤šå°‘ä¸ª$i$æ»¡è¶³$\rho_i + b_i &gt; 0$ã€‚</p>
<p><strong>æ¨å¯¼8ï¼šé€‰æ‹©å‡½æ•°çš„æ•°å­¦è¡¨ç¤º</strong></p>
<p>å®šä¹‰é€‰æ‹©æŒ‡ç¤ºå‡½æ•°ï¼š</p>
<p>$$
s_i(\boldsymbol{\rho}, \boldsymbol{b}) = \mathbb{1}_{\rho_i + b_i > 0} = \begin{cases}
1, & \rho_i + b_i > 0 \\
0, & \rho_i + b_i \leq 0
\end{cases}
$$</p>
<p>åˆ™é€‰æ‹©çš„Expertæ•°ä¸ºï¼š</p>
<p>$$
K(\boldsymbol{\rho}, \boldsymbol{b}) = \sum_{i=1}^{n} s_i(\boldsymbol{\rho}, \boldsymbol{b})
$$</p>
<p>è¿™æ˜¯ä¸€ä¸ªå…³äº$\boldsymbol{\rho}$å’Œ$\boldsymbol{b}$çš„å‡½æ•°ï¼Œå¯ä»¥åŠ¨æ€å˜åŒ–ã€‚</p>
<p><strong>æ¨å¯¼9ï¼šBiasçš„å†—ä½™è‡ªç”±åº¦</strong></p>
<p>å¯¹äºä»»æ„å¸¸æ•°$c \in \mathbb{R}$ï¼Œæœ‰ï¼š</p>
<p>$$
\mathbb{1}_{\rho_i + b_i > 0} = \mathbb{1}_{\rho_i + (b_i + c) > c}
$$</p>
<p>å¦‚æœé˜ˆå€¼ä»0å˜ä¸º$c$ï¼Œåªéœ€è¦ç›¸åº”è°ƒæ•´Biaså³å¯ã€‚ä½†åœ¨é˜ˆå€¼å›ºå®šä¸º0æ—¶ï¼Œå¯¹æ‰€æœ‰$b_i$åŠ ç›¸åŒå¸¸æ•°ä¼šæ”¹å˜é€‰æ‹©ç»“æœï¼š</p>
<p>$$
K(\boldsymbol{\rho}, \boldsymbol{b} + c) = \sum_{i=1}^{n} \mathbb{1}_{\rho_i + b_i + c > 0}
$$</p>
<p>å½“$c &gt; 0$æ—¶ï¼Œæ›´å¤šExpertè¢«é€‰ä¸­ï¼›$c &lt; 0$æ—¶ï¼Œæ›´å°‘Expertè¢«é€‰ä¸­ã€‚</p>
<h4 id="22">2.2 é¢„ç®—æ§åˆ¶æœºåˆ¶</h4>
<p><strong>æ¨å¯¼10ï¼šæœŸæœ›Expertæ•°</strong></p>
<p>å®šä¹‰æ¯ä¸ªTokençš„æœŸæœ›Expertæ•°ï¼š</p>
<p>$$
\bar{K} = \mathbb{E}_{\boldsymbol{x}}[K(\boldsymbol{\rho}(\boldsymbol{x}), \boldsymbol{b})]
$$</p>
<p>ä¸ºäº†æ§åˆ¶è®¡ç®—æˆæœ¬ï¼Œæˆ‘ä»¬å¸Œæœ›$\bar{K} \approx k$ï¼Œå…¶ä¸­$k$æ˜¯ç›®æ ‡é¢„ç®—ã€‚</p>
<p><strong>æ¨å¯¼11ï¼šé¢„ç®—çº¦æŸçš„è½¯åŒ–</strong></p>
<p>ä¸¥æ ¼çº¦æŸ$\bar{K} = k$å¯èƒ½éš¾ä»¥æ»¡è¶³ï¼Œå¯ä»¥è½¯åŒ–ä¸ºæƒ©ç½šé¡¹ï¼š</p>
<p>$$
\mathcal{L}_{\text{budget}} = \lambda_{\text{budget}} (\bar{K} - k)^2
$$</p>
<p>æˆ–è€…åªæƒ©ç½šè¶…é¢„ç®—æƒ…å†µï¼š</p>
<p>$$
\mathcal{L}_{\text{budget}} = \lambda_{\text{budget}} \max(0, \bar{K} - k)^2
$$</p>
<p><strong>æ¨å¯¼12ï¼šLoadç»Ÿè®¡é‡</strong></p>
<p>å¯¹äºæ‰¹é‡æ•°æ®ï¼Œå®šä¹‰å…¨å±€Loadç»Ÿè®¡ï¼š</p>
<p>$$
\tilde{F}_i = \mathbb{E}_{\boldsymbol{x}}[s_i(\boldsymbol{\rho}(\boldsymbol{x}), \boldsymbol{b})]
$$</p>
<p>è¿™æ˜¯Expert $i$è¢«é€‰ä¸­çš„é¢‘ç‡ã€‚æ€»Loadä¸ºï¼š</p>
<p>$$
|\tilde{\boldsymbol{F}}| = \sum_{i=1}^{n} \tilde{F}_i = \mathbb{E}_{\boldsymbol{x}}[K(\boldsymbol{\rho}(\boldsymbol{x}), \boldsymbol{b})] = \bar{K}
$$</p>
<h3 id="3">3. éš¾åº¦æ„ŸçŸ¥æŸå¤±å‡½æ•°</h3>
<h4 id="31-expert">3.1 éš¾åº¦ä¸Expertæ•°çš„å…³ç³»</h4>
<p><strong>æ¨å¯¼13ï¼šéš¾åº¦ç›¸å…³çš„ç›®æ ‡Expertæ•°</strong></p>
<p>æˆ‘ä»¬å¸Œæœ›éš¾æ ·æœ¬åˆ†é…æ›´å¤šExpertã€‚å®šä¹‰ç›®æ ‡Expertæ•°ä¸ºéš¾åº¦çš„å‡½æ•°ï¼š</p>
<p>$$
k^*(\boldsymbol{x}) = k_{\min} + (k_{\max} - k_{\min}) \cdot \phi(d(\boldsymbol{x}))
$$</p>
<p>å…¶ä¸­ï¼š
- $k_{\min}$ï¼šæœ€å°‘Expertæ•°
- $k_{\max}$ï¼šæœ€å¤šExpertæ•°
- $\phi: \mathbb{R}_+ \to [0, 1]$ï¼šéš¾åº¦æ˜ å°„å‡½æ•°</p>
<p><strong>æ¨å¯¼14ï¼šéš¾åº¦æ˜ å°„å‡½æ•°çš„è®¾è®¡</strong></p>
<p>ä¸€ä¸ªç®€å•çš„çº¿æ€§æ˜ å°„ï¼š</p>
<p>$$
\phi(d) = \frac{\min(\max(d, d_{\min}), d_{\max}) - d_{\min}}{d_{\max} - d_{\min}}
$$</p>
<p>å…¶ä¸­$d_{\min}, d_{\max}$æ˜¯éš¾åº¦çš„ä¸‹ç•Œå’Œä¸Šç•Œã€‚</p>
<p>æˆ–è€…ä½¿ç”¨Sigmoidæ˜ å°„ä¿è¯å¹³æ»‘æ€§ï¼š</p>
<p>$$
\phi(d) = \sigma(\alpha(d - d_0)) = \frac{1}{1 + e^{-\alpha(d - d_0)}}
$$</p>
<p>å…¶ä¸­$d_0$æ˜¯ä¸­ç­‰éš¾åº¦ï¼Œ$\alpha$æ§åˆ¶æ˜ å°„çš„é™¡å³­ç¨‹åº¦ã€‚</p>
<p><strong>æ¨å¯¼15ï¼šéš¾åº¦æ„ŸçŸ¥é¢„ç®—æŸå¤±</strong></p>
<p>å°†å›ºå®šé¢„ç®—$k$æ›¿æ¢ä¸ºéš¾åº¦ç›¸å…³çš„$k^*(\boldsymbol{x})$ï¼š</p>
<p>$$
\mathcal{L}_{\text{difficulty-budget}} = \mathbb{E}_{\boldsymbol{x}}\left[(K(\boldsymbol{\rho}(\boldsymbol{x}), \boldsymbol{b}) - k^*(\boldsymbol{x}))^2\right]
$$</p>
<p>è¿™é¼“åŠ±æ¨¡å‹ä¸ºéš¾æ ·æœ¬åˆ†é…æ›´å¤šExpertï¼Œä¸ºæ˜“æ ·æœ¬åˆ†é…æ›´å°‘Expertã€‚</p>
<h4 id="32-loss-free">3.2 Loss-Freeæ¡†æ¶ä¸‹çš„éš¾åº¦æ„ŸçŸ¥</h4>
<p><strong>æ¨å¯¼16ï¼šBiasæ›´æ–°è§„åˆ™çš„æ‰©å±•</strong></p>
<p>æ ‡å‡†Loss-Freeæ›´æ–°ï¼ˆå‡åŒ€ç›®æ ‡ï¼‰ï¼š</p>
<p>$$
\boldsymbol{b} \leftarrow \boldsymbol{b} - \alpha \mathop{\text{sign}}(\boldsymbol{F} - \boldsymbol{Q})
$$</p>
<p>å…¶ä¸­$\boldsymbol{Q} = (\frac{1}{n}, \ldots, \frac{1}{n})$ã€‚</p>
<p>å¼•å…¥éš¾åº¦æ„ŸçŸ¥åï¼Œç›®æ ‡åˆ†å¸ƒä¿æŒå‡åŒ€ï¼Œä½†æ€»é¢„ç®—å˜ä¸ºåŠ¨æ€çš„ã€‚åˆ†è§£æ›´æ–°ä¸ºä¸¤éƒ¨åˆ†ï¼š</p>
<ol>
<li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼š$\boldsymbol{b} \leftarrow \boldsymbol{b} - \alpha_1 [\mathop{\text{sign}}(\boldsymbol{F} - \boldsymbol{Q}) - \overline{\mathop{\text{sign}}(\boldsymbol{F} - \boldsymbol{Q})}]$</li>
<li><strong>é¢„ç®—æ§åˆ¶</strong>ï¼š$\boldsymbol{b} \leftarrow \boldsymbol{b} - \alpha_2 \mathop{\text{sign}}(|\tilde{\boldsymbol{F}}| - k^*(\boldsymbol{x}))$</li>
</ol>
<p><strong>æ¨å¯¼17ï¼šç»Ÿä¸€çš„éš¾åº¦æ„ŸçŸ¥æ›´æ–°</strong></p>
<p>å¯ä»¥åˆå¹¶ä¸ºå•ä¸€æ›´æ–°è§„åˆ™ï¼š</p>
<p>$$
\boldsymbol{b} \leftarrow \boldsymbol{b} - \alpha \left[\mathop{\text{sign}}(\tilde{\boldsymbol{F}} - \tilde{\boldsymbol{Q}}^*)\right]
$$</p>
<p>å…¶ä¸­$\tilde{\boldsymbol{Q}}^<em> = k^</em>(\boldsymbol{x}) \boldsymbol{Q} = (\frac{k^<em>(\boldsymbol{x})}{n}, \ldots, \frac{k^</em>(\boldsymbol{x})}{n})$ã€‚</p>
<p>è¿™ä¸ªå½¢å¼ä¼˜é›…åœ°ç»Ÿä¸€äº†è´Ÿè½½å‡è¡¡å’Œéš¾åº¦æ„ŸçŸ¥é¢„ç®—æ§åˆ¶ã€‚</p>
<h3 id="4">4. æ¢¯åº¦çš„å®Œæ•´æ¨å¯¼</h3>
<h4 id="41">4.1 åŠ¨æ€é€‰æ‹©çš„æ¢¯åº¦é—®é¢˜</h4>
<p><strong>æ¨å¯¼18ï¼šé˜ˆå€¼å‡½æ•°çš„ä¸å¯å¾®æ€§</strong></p>
<p>é€‰æ‹©å‡½æ•°$s_i(\boldsymbol{\rho}, \boldsymbol{b}) = \mathbb{1}_{\rho_i + b_i &gt; 0}$æ˜¯ä¸å¯å¾®çš„ï¼š</p>
<p>$$
\frac{\partial s_i}{\partial \rho_i} = \begin{cases}
\text{undefined}, & \rho_i + b_i = 0 \\
0, & \text{otherwise}
\end{cases}
$$</p>
<p>è¿™å¯¼è‡´æ ‡å‡†åå‘ä¼ æ’­æ— æ³•åº”ç”¨ã€‚</p>
<p><strong>æ¨å¯¼19ï¼šç›´é€šä¼°è®¡å™¨ï¼ˆSTEï¼‰è¿‘ä¼¼</strong></p>
<p>ä½¿ç”¨STEæŠ€å·§ï¼Œå‰å‘ä¼ æ’­ä¿æŒä¸å˜ï¼Œåå‘ä¼ æ’­ç”¨Sigmoidè¿‘ä¼¼ï¼š</p>
<p>$$
\frac{\partial s_i}{\partial \rho_i} \approx \sigma'(\tau(\rho_i + b_i))
$$</p>
<p>å…¶ä¸­$\tau$æ˜¯æ¸©åº¦å‚æ•°ï¼Œ$\sigma'(x) = \sigma(x)(1-\sigma(x))$ã€‚</p>
<p>å½“$\tau \to \infty$æ—¶ï¼Œ$\sigma(\tau x)$é€¼è¿‘é˜¶è·ƒå‡½æ•°ï¼›åå‘ä¼ æ’­æ—¶ä½¿ç”¨æœ‰é™çš„$\tau$ä¿è¯æ¢¯åº¦å­˜åœ¨ã€‚</p>
<p><strong>æ¨å¯¼20ï¼šGumbel-Softmaxæ¾å¼›</strong></p>
<p>å¦ä¸€ç§æ–¹æ³•æ˜¯ç”¨Gumbel-Softmaxæ¾å¼›åŒ–é€‰æ‹©è¿‡ç¨‹ã€‚å¯¹äºäºŒå…ƒé€‰æ‹©ï¼ˆé€‰æˆ–ä¸é€‰ï¼‰ï¼ŒGumbel-Softmaxä¸ºï¼š</p>
<p>$$
\tilde{s}_i = \frac{\exp((\log \pi_i + g_i)/\tau)}{\exp((\log \pi_i + g_i)/\tau) + \exp((\log(1-\pi_i) + g_i')/\tau)}
$$</p>
<p>å…¶ä¸­ï¼š
- $\pi_i = \sigma(\rho_i + b_i)$æ˜¯é€‰æ‹©æ¦‚ç‡
- $g_i, g_i' \sim \text{Gumbel}(0, 1)$æ˜¯Gumbelå™ªå£°
- $\tau$æ˜¯æ¸©åº¦å‚æ•°</p>
<h4 id="42-router">4.2 Routeræ¢¯åº¦æ¨å¯¼</h4>
<p><strong>æ¨å¯¼21ï¼šRouterè¾“å‡º$\boldsymbol{\rho}$çš„æ¢¯åº¦</strong></p>
<p>æ€»è¾“å‡ºä¸ºï¼š</p>
<p>$$
\boldsymbol{y} = \sum_{i=1}^{n} s_i(\boldsymbol{\rho}, \boldsymbol{b}) \rho_i \boldsymbol{e}_i
$$</p>
<p>æŸå¤±å‡½æ•°$\mathcal{L}$å…³äº$\rho_j$çš„æ¢¯åº¦ï¼š</p>
<p>$$
\frac{\partial \mathcal{L}}{\partial \rho_j} = \frac{\partial \mathcal{L}}{\partial \boldsymbol{y}} \cdot \frac{\partial \boldsymbol{y}}{\partial \rho_j}
$$</p>
<p>å±•å¼€ï¼š</p>
<p>$$
\frac{\partial \boldsymbol{y}}{\partial \rho_j} = \frac{\partial s_j}{\partial \rho_j} \rho_j \boldsymbol{e}_j + s_j \boldsymbol{e}_j + \sum_{i=1}^{n} s_i \rho_i \frac{\partial \boldsymbol{e}_i}{\partial \rho_j}
$$</p>
<p>å¦‚æœExpertä¸ä¾èµ–äºRouterï¼ˆé€šå¸¸æƒ…å†µï¼‰ï¼Œåˆ™$\frac{\partial \boldsymbol{e}_i}{\partial \rho_j} = 0$ï¼Œç®€åŒ–ä¸ºï¼š</p>
<p>$$
\frac{\partial \boldsymbol{y}}{\partial \rho_j} = \frac{\partial s_j}{\partial \rho_j} \rho_j \boldsymbol{e}_j + s_j \boldsymbol{e}_j
$$</p>
<p><strong>æ¨å¯¼22ï¼šä½¿ç”¨STEçš„æ¢¯åº¦ç®€åŒ–</strong></p>
<p>å¦‚æœåœ¨åå‘ä¼ æ’­æ—¶å¿½ç•¥$\frac{\partial s_j}{\partial \rho_j}$ï¼ˆæ ‡å‡†STEåšæ³•ï¼‰ï¼š</p>
<p>$$
\frac{\partial \mathcal{L}}{\partial \rho_j} \approx \frac{\partial \mathcal{L}}{\partial \boldsymbol{y}} \cdot s_j \boldsymbol{e}_j
$$</p>
<p>è¿™æ„å‘³ç€åªæœ‰è¢«é€‰ä¸­çš„Expertï¼ˆ$s_j = 1$ï¼‰æ‰ä¼šå¯¹Routeræ¢¯åº¦æœ‰è´¡çŒ®ã€‚</p>
<h4 id="43-bias">4.3 Biasæ¢¯åº¦æ¨å¯¼</h4>
<p><strong>æ¨å¯¼23ï¼šBiasçš„æ¢¯åº¦</strong></p>
<p>Bias $\boldsymbol{b}$é€šè¿‡å½±å“é€‰æ‹©$s_i$æ¥å½±å“è¾“å‡ºï¼š</p>
<p>$$
\frac{\partial \mathcal{L}}{\partial b_j} = \frac{\partial \mathcal{L}}{\partial \boldsymbol{y}} \cdot \frac{\partial \boldsymbol{y}}{\partial b_j} = \frac{\partial \mathcal{L}}{\partial \boldsymbol{y}} \cdot \frac{\partial \boldsymbol{y}}{\partial s_j} \frac{\partial s_j}{\partial b_j}
$$</p>
<p>å…¶ä¸­ï¼š</p>
<p>$$
\frac{\partial \boldsymbol{y}}{\partial s_j} = \rho_j \boldsymbol{e}_j
$$</p>
<p>å¦‚æœä½¿ç”¨Sigmoidè¿‘ä¼¼ï¼š</p>
<p>$$
\frac{\partial s_j}{\partial b_j} \approx \sigma'(\tau(b_j + \rho_j))
$$</p>
<p>å› æ­¤ï¼š</p>
<p>$$
\frac{\partial \mathcal{L}}{\partial b_j} \approx \frac{\partial \mathcal{L}}{\partial \boldsymbol{y}} \cdot \rho_j \boldsymbol{e}_j \cdot \sigma'(\tau(b_j + \rho_j))
$$</p>
<p>ä½†å®é™…ä¸Šï¼ŒLoss-Freeæ–¹æ³•ä¸é€šè¿‡æ¢¯åº¦æ›´æ–°$\boldsymbol{b}$ï¼Œè€Œæ˜¯ç”¨åŸºäºè§„åˆ™çš„æ›´æ–°ã€‚</p>
<h4 id="44-expert">4.4 Expertæ¢¯åº¦æ¨å¯¼</h4>
<p><strong>æ¨å¯¼24ï¼šExpertå‚æ•°çš„æ¢¯åº¦</strong></p>
<p>ç¬¬$j$ä¸ªExpertçš„å‚æ•°$\boldsymbol{\theta}_j^{(e)}$çš„æ¢¯åº¦ï¼š</p>
<p>$$
\frac{\partial \mathcal{L}}{\partial \boldsymbol{\theta}_j^{(e)}} = \frac{\partial \mathcal{L}}{\partial \boldsymbol{y}} \cdot \frac{\partial \boldsymbol{y}}{\partial \boldsymbol{e}_j} \cdot \frac{\partial \boldsymbol{e}_j}{\partial \boldsymbol{\theta}_j^{(e)}}
$$</p>
<p>å…¶ä¸­ï¼š</p>
<p>$$
\frac{\partial \boldsymbol{y}}{\partial \boldsymbol{e}_j} = s_j \rho_j
$$</p>
<p>å› æ­¤ï¼š</p>
<p>$$
\frac{\partial \mathcal{L}}{\partial \boldsymbol{\theta}_j^{(e)}} = s_j \rho_j \frac{\partial \mathcal{L}}{\partial \boldsymbol{y}} \cdot \frac{\partial \boldsymbol{e}_j}{\partial \boldsymbol{\theta}_j^{(e)}}
$$</p>
<p>åªæœ‰è¢«é€‰ä¸­çš„Expertï¼ˆ$s_j = 1$ï¼‰æ‰ä¼šæ”¶åˆ°æ¢¯åº¦å¹¶æ›´æ–°ã€‚</p>
<h3 id="5">5. èµ„æºåˆ†é…çš„æœ€ä¼˜æ€§è¯æ˜</h3>
<h4 id="51">5.1 èµ„æºåˆ†é…é—®é¢˜çš„å½¢å¼åŒ–</h4>
<p><strong>æ¨å¯¼25ï¼šä¼˜åŒ–ç›®æ ‡</strong></p>
<p>ç»™å®šå›ºå®šçš„æ€»è®¡ç®—é¢„ç®—$B$ï¼ˆæ€»Expertè°ƒç”¨æ¬¡æ•°ï¼‰ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨æ‰€æœ‰æ ·æœ¬ä¸Šæœ€å°åŒ–æ€»æŸå¤±ï¼š</p>
<p>$$
\min_{\{k_1, k_2, \ldots, k_N\}} \sum_{i=1}^{N} \mathcal{L}_i(k_i)
$$</p>
<p>çº¦æŸæ¡ä»¶ï¼š</p>
<p>$$
\sum_{i=1}^{N} k_i = B, \quad k_{\min} \leq k_i \leq k_{\max}
$$</p>
<p>å…¶ä¸­$\mathcal{L}_i(k)$æ˜¯æ ·æœ¬$i$ä½¿ç”¨$k$ä¸ªExpertæ—¶çš„æŸå¤±ã€‚</p>
<p><strong>æ¨å¯¼26ï¼šæŸå¤±å…³äºExpertæ•°çš„å•è°ƒæ€§</strong></p>
<p>åˆç†å‡è®¾ï¼šæ›´å¤šExpertå¯¼è‡´æ›´å°æŸå¤±ï¼ˆæ”¶ç›Šé€’å‡ï¼‰ï¼š</p>
<p>$$
\mathcal{L}_i(k+1) < \mathcal{L}_i(k), \quad \frac{\partial^2 \mathcal{L}_i}{\partial k^2} > 0
$$</p>
<p>å³æŸå¤±å…³äº$k$å•è°ƒé€’å‡ä½†å‡¸ï¼ˆè¾¹é™…æ”¶ç›Šé€’å‡ï¼‰ã€‚</p>
<p><strong>æ¨å¯¼27ï¼šæ‹‰æ ¼æœ—æ—¥æ–¹æ³•æ±‚è§£</strong></p>
<p>æ„å»ºæ‹‰æ ¼æœ—æ—¥å‡½æ•°ï¼š</p>
<p>$$
\mathcal{L}_{\text{Lagrange}} = \sum_{i=1}^{N} \mathcal{L}_i(k_i) + \lambda \left(\sum_{i=1}^{N} k_i - B\right)
$$</p>
<p>å¯¹$k_i$æ±‚åå¯¼å¹¶ä»¤å…¶ä¸ºé›¶ï¼š</p>
<p>$$
\frac{\partial \mathcal{L}_i}{\partial k_i} + \lambda = 0
$$</p>
<p>å³ï¼š</p>
<p>$$
\frac{\partial \mathcal{L}_i}{\partial k_i} = -\lambda, \quad \forall i
$$</p>
<p><strong>æœ€ä¼˜æ¡ä»¶</strong>ï¼šæ‰€æœ‰æ ·æœ¬çš„è¾¹é™…æŸå¤±å‡å°‘é‡ç›¸ç­‰ï¼</p>
<p><strong>æ¨å¯¼28ï¼šéš¾åº¦ä¸æœ€ä¼˜åˆ†é…çš„å…³ç³»</strong></p>
<p>å¦‚æœ$\mathcal{L}_i(k) = L_i \cdot g(k)$ï¼Œå…¶ä¸­$L_i$æ˜¯æ ·æœ¬$i$çš„åŸºç¡€éš¾åº¦ï¼Œ$g(k)$æ˜¯å…±åŒçš„Expertæ•ˆç›Šå‡½æ•°ï¼Œåˆ™ï¼š</p>
<p>$$
\frac{\partial \mathcal{L}_i}{\partial k_i} = L_i g'(k_i)
$$</p>
<p>æœ€ä¼˜æ¡ä»¶å˜ä¸ºï¼š</p>
<p>$$
L_i g'(k_i) = -\lambda
$$</p>
<p>å³ï¼š</p>
<p>$$
g'(k_i) = -\frac{\lambda}{L_i}
$$</p>
<p>ç”±äº$g'$é€’å‡ï¼Œè¿™æ„å‘³ç€ï¼š$L_i$è¶Šå¤§ï¼ˆè¶Šéš¾ï¼‰ï¼Œ$k_i$è¶Šå¤§ï¼</p>
<p>è¿™ä»ç†è®ºä¸Šè¯æ˜äº†éš¾æ ·æœ¬åº”åˆ†é…æ›´å¤šExpertçš„åˆç†æ€§ã€‚</p>
<h4 id="52">5.2 è¿‘ä¼¼æœ€ä¼˜æ€§</h4>
<p><strong>æ¨å¯¼29ï¼šçº¿æ€§è¿‘ä¼¼ä¸‹çš„æœ€ä¼˜åˆ†é…</strong></p>
<p>åœ¨ä¸€é˜¶è¿‘ä¼¼ä¸‹ï¼Œå‡è®¾$\mathcal{L}<em k="k_0">i(k) \approx \mathcal{L}_i(k_0) - \beta_i (k - k_0)$ï¼Œå…¶ä¸­$\beta_i = -\frac{\partial \mathcal{L}_i}{\partial k}\big|</em>$æ˜¯è¾¹é™…æ”¶ç›Šã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜å˜ä¸ºçº¿æ€§è§„åˆ’ï¼š</p>
<p>$$
\max \sum_{i=1}^{N} \beta_i k_i \quad \text{s.t.} \quad \sum_{i=1}^{N} k_i = B
$$</p>
<p>æœ€ä¼˜è§£æ˜¯è´ªå¿ƒç­–ç•¥ï¼šæŒ‰$\beta_i$ä»å¤§åˆ°å°æ’åºï¼Œä¼˜å…ˆåˆ†é…ç»™è¾¹é™…æ”¶ç›Šå¤§çš„æ ·æœ¬ã€‚</p>
<p>å¦‚æœ$\beta_i \propto L_i$ï¼ˆè¾¹é™…æ”¶ç›Šæ­£æ¯”äºéš¾åº¦ï¼‰ï¼Œåˆ™åº”ä¼˜å…ˆåˆ†é…ç»™éš¾æ ·æœ¬ã€‚</p>
<h3 id="6">6. ä¸è¯¾ç¨‹å­¦ä¹ çš„è”ç³»</h3>
<h4 id="61">6.1 è¯¾ç¨‹å­¦ä¹ çš„åŸºæœ¬åŸç†</h4>
<p><strong>æ¨å¯¼30ï¼šè¯¾ç¨‹å­¦ä¹ çš„ä¼˜åŒ–è§†è§’</strong></p>
<p>è¯¾ç¨‹å­¦ä¹ ï¼ˆCurriculum Learningï¼‰ä¸»å¼ ä»æ˜“åˆ°éš¾è®­ç»ƒã€‚å®šä¹‰æ ·æœ¬æƒé‡$w_i(t)$éšæ—¶é—´å˜åŒ–ï¼š</p>
<p>$$
\mathcal{L}_{\text{curriculum}}(t) = \sum_{i=1}^{N} w_i(t) \mathcal{L}_i
$$</p>
<p>æ—©æœŸï¼š$w_i(t) \propto e^{-d_i}$ï¼ˆæ˜“æ ·æœ¬é«˜æƒé‡ï¼‰
åæœŸï¼š$w_i(t) \propto e^{d_i}$ï¼ˆéš¾æ ·æœ¬é«˜æƒé‡ï¼‰</p>
<p><strong>æ¨å¯¼31ï¼šéš¾åº¦æ„ŸçŸ¥MoEä½œä¸ºåŠ¨æ€è¯¾ç¨‹</strong></p>
<p>éš¾åº¦æ„ŸçŸ¥MoEä¸ºéš¾æ ·æœ¬åˆ†é…æ›´å¤šè®¡ç®—èµ„æºï¼Œæœ¬è´¨ä¸Šæ˜¯åŠ¨æ€è¯¾ç¨‹å­¦ä¹ ï¼š</p>
<p>$$
\text{è®¡ç®—èµ„æº} \equiv \text{æ ·æœ¬æƒé‡}
$$</p>
<p>æ›´å¤šExpert $\Leftrightarrow$ æ›´å¼ºçš„æ¨¡å‹èƒ½åŠ› $\Leftrightarrow$ æ›´é«˜çš„å­¦ä¹ æ•ˆç‡</p>
<p><strong>æ¨å¯¼32ï¼šSelf-Paced Learningçš„å¯¹å¶æ€§</strong></p>
<p>Self-Paced Learningï¼ˆè‡ªé€‚åº”å­¦ä¹ ï¼‰åŠ¨æ€è°ƒæ•´æ ·æœ¬æƒé‡ï¼š</p>
<p>$$
\min_{\boldsymbol{w}, \boldsymbol{\theta}} \sum_{i=1}^{N} w_i \mathcal{L}_i(\boldsymbol{\theta}) + \lambda \sum_{i=1}^{N} \Omega(w_i)
$$</p>
<p>å…¶ä¸­$\Omega$æ˜¯æ­£åˆ™åŒ–å™¨ã€‚</p>
<p>éš¾åº¦æ„ŸçŸ¥MoEå¯ä»¥è§†ä¸ºå¯¹å¶é—®é¢˜ï¼šä¸è°ƒæ•´æ ·æœ¬æƒé‡ï¼Œè€Œæ˜¯è°ƒæ•´æ¨¡å‹å®¹é‡ï¼ˆExpertæ•°ï¼‰ã€‚</p>
<h4 id="62">6.2 ç†è®ºä¼˜åŠ¿åˆ†æ</h4>
<p><strong>æ¨å¯¼33ï¼šæ–¹å·®å‡å°</strong></p>
<p>è¯¾ç¨‹å­¦ä¹ èƒ½å‡å°‘æ¢¯åº¦æ–¹å·®ã€‚å¦‚æœæ—©æœŸåªç”¨æ˜“æ ·æœ¬ï¼Œæ¢¯åº¦ä¼°è®¡çš„æ–¹å·®ï¼š</p>
<p>$$
\text{Var}_{\text{curriculum}} = \frac{1}{N_{\text{easy}}} \sum_{i \in \text{easy}} \|\nabla \mathcal{L}_i - \bar{\nabla}\|^2
$$</p>
<p>é€šå¸¸å°äºå…¨æ ·æœ¬æ–¹å·®ï¼š</p>
<p>$$
\text{Var}_{\text{all}} = \frac{1}{N} \sum_{i=1}^{N} \|\nabla \mathcal{L}_i - \bar{\nabla}\|^2
$$</p>
<p>å› ä¸ºæ˜“æ ·æœ¬çš„æ¢¯åº¦æ–¹å‘æ›´ä¸€è‡´ã€‚</p>
<p><strong>æ¨å¯¼34ï¼šéš¾åº¦æ„ŸçŸ¥MoEçš„æ–¹å·®åˆ†æ</strong></p>
<p>éš¾åº¦æ„ŸçŸ¥MoEä¸æ”¹å˜æ ·æœ¬åˆ†å¸ƒï¼Œä½†æ”¹å˜æ¨¡å‹åœ¨ä¸åŒæ ·æœ¬ä¸Šçš„å®¹é‡ã€‚ç­‰æ•ˆäºé‡è¦æ€§é‡‡æ ·ï¼š</p>
<p>$$
\mathbb{E}_{\text{éš¾åº¦æ„ŸçŸ¥}}[\nabla] = \sum_{i=1}^{N} \frac{k_i}{\sum_j k_j} \nabla \mathcal{L}_i(k_i)
$$</p>
<p>å¦‚æœéš¾æ ·æœ¬çš„$k_i$å¤§ï¼Œå®ƒä»¬çš„æ¢¯åº¦æƒé‡ä¹Ÿå¤§ï¼Œç¬¦åˆé‡è¦æ€§é‡‡æ ·åŸç†ã€‚</p>
<h3 id="7">7. ç†è®ºä¿è¯ä¸å®è·µéªŒè¯</h3>
<h4 id="71">7.1 æ”¶æ•›æ€§ä¿è¯</h4>
<p><strong>æ¨å¯¼35ï¼šåŠ¨æ€MoEçš„æ”¶æ•›æ€§</strong></p>
<p>å‡è®¾Bias $\boldsymbol{b}$çš„æ›´æ–°æ»¡è¶³ï¼š</p>
<p>$$
\mathbb{E}[\boldsymbol{b}_{t+1} - \boldsymbol{b}^*] \leq (1 - \mu) (\boldsymbol{b}_t - \boldsymbol{b}^*)
$$</p>
<p>å…¶ä¸­$\boldsymbol{b}^*$æ˜¯ç›®æ ‡Biasï¼Œ$\mu &gt; 0$æ˜¯æ”¶ç¼©ç‡ã€‚</p>
<p>é‚£ä¹ˆ$\boldsymbol{b}_t$ä»¥æŒ‡æ•°é€Ÿç‡æ”¶æ•›åˆ°$\boldsymbol{b}^*$ï¼š</p>
<p>$$
\|\boldsymbol{b}_t - \boldsymbol{b}^*\| \leq (1-\mu)^t \|\boldsymbol{b}_0 - \boldsymbol{b}^*\|
$$</p>
<p><strong>æ¨å¯¼36ï¼šæ¨¡å‹å‚æ•°çš„æ”¶æ•›</strong></p>
<p>å¯¹äºæ¨¡å‹å‚æ•°$\boldsymbol{\theta}$ï¼Œå‡è®¾æŸå¤±æ˜¯$L$-å…‰æ»‘çš„ï¼Œå­¦ä¹ ç‡$\eta &lt; \frac{2}{L}$ï¼Œåˆ™æ¢¯åº¦ä¸‹é™æ”¶æ•›ï¼š</p>
<p>$$
\mathcal{L}(\boldsymbol{\theta}_t) - \mathcal{L}(\boldsymbol{\theta}^*) \leq \frac{2L \|\boldsymbol{\theta}_0 - \boldsymbol{\theta}^*\|^2}{t}
$$</p>
<p>åŠ¨æ€MoEä¸æ”¹å˜è¿™ä¸ªæ”¶æ•›ç‡ï¼ˆåªè¦Biasæ›´æ–°ç¨³å®šï¼‰ã€‚</p>
<h4 id="72">7.2 æ³›åŒ–æ€§åˆ†æ</h4>
<p><strong>æ¨å¯¼37ï¼šRademacherå¤æ‚åº¦</strong></p>
<p>MoEæ¨¡å‹çš„Rademacherå¤æ‚åº¦ï¼š</p>
<p>$$
\mathcal{R}(\mathcal{F}_{\text{MoE}}) = \mathbb{E}_{\boldsymbol{\sigma}} \left[\sup_{f \in \mathcal{F}_{\text{MoE}}} \frac{1}{N} \sum_{i=1}^{N} \sigma_i f(\boldsymbol{x}_i)\right]
$$</p>
<p>å…¶ä¸­$\boldsymbol{\sigma} = (\sigma_1, \ldots, \sigma_N)$æ˜¯Rademacheréšæœºå˜é‡ã€‚</p>
<p>å¯¹äºåŠ¨æ€MoEï¼Œæ¨¡å‹å®¹é‡éšæ ·æœ¬å˜åŒ–ï¼Œå¯ä»¥è¯æ˜Rademacherå¤æ‚åº¦ä¸ä¼šæ˜¾è‘—å¢åŠ ï¼ˆç›¸æ¯”å›ºå®šTop-Kï¼‰ã€‚</p>
<p><strong>æ¨å¯¼38ï¼šæ³›åŒ–ç•Œ</strong></p>
<p>æ ¹æ®Rademacherå¤æ‚åº¦ï¼Œæ³›åŒ–è¯¯å·®ç•Œä¸ºï¼š</p>
<p>$$
\mathbb{E}[\mathcal{L}_{\text{test}}] \leq \mathbb{E}[\mathcal{L}_{\text{train}}] + 2\mathcal{R}(\mathcal{F}_{\text{MoE}}) + \sqrt{\frac{\log(1/\delta)}{2N}}
$$</p>
<p>éš¾åº¦æ„ŸçŸ¥MoEé€šè¿‡æ›´å¥½åœ°åˆ©ç”¨è®¡ç®—èµ„æºï¼Œå¯ä»¥é™ä½$\mathcal{L}_{\text{train}}$ï¼Œä»è€Œæ”¹å–„æ³›åŒ–ã€‚</p>
<h4 id="73">7.3 è®¡ç®—æ•ˆç‡åˆ†æ</h4>
<p><strong>æ¨å¯¼39ï¼šFLOPsè®¡ç®—</strong></p>
<p>æ ‡å‡†Top-K MoEæ¯ä¸ªTokençš„FLOPsï¼š</p>
<p>$$
\text{FLOPs}_{\text{static}} = k \cdot C_{\text{expert}}
$$</p>
<p>å…¶ä¸­$C_{\text{expert}}$æ˜¯å•ä¸ªExpertçš„è®¡ç®—é‡ã€‚</p>
<p>éš¾åº¦æ„ŸçŸ¥MoEçš„å¹³å‡FLOPsï¼š</p>
<p>$$
\text{FLOPs}_{\text{dynamic}} = \mathbb{E}[K(\boldsymbol{x})] \cdot C_{\text{expert}} = \bar{K} \cdot C_{\text{expert}}
$$</p>
<p>å¦‚æœ$\bar{K} = k$ï¼ˆé¢„ç®—æ§åˆ¶æˆåŠŸï¼‰ï¼Œåˆ™å¹³å‡FLOPsç›¸åŒï¼ä½†è®¡ç®—åˆ†é…æ›´åˆç†ã€‚</p>
<p><strong>æ¨å¯¼40ï¼šæ•ˆç‡-æ€§èƒ½æƒè¡¡çš„å¸•ç´¯æ‰˜æœ€ä¼˜</strong></p>
<p>å®šä¹‰ä¸¤ä¸ªç›®æ ‡ï¼š
- $J_1 = \mathcal{L}_{\text{task}}$ï¼ˆä»»åŠ¡æ€§èƒ½ï¼Œè¶Šå°è¶Šå¥½ï¼‰
- $J_2 = \text{FLOPs}$ï¼ˆè®¡ç®—æˆæœ¬ï¼Œè¶Šå°è¶Šå¥½ï¼‰</p>
<p>å›ºå®š$\bar{K}$çš„éš¾åº¦æ„ŸçŸ¥MoEå¯ä»¥è¾¾åˆ°æ›´å¥½çš„å¸•ç´¯æ‰˜å‰æ²¿ï¼šå¯¹äºç›¸åŒçš„FLOPsï¼Œæ€§èƒ½æ›´å¥½ï¼›æˆ–å¯¹äºç›¸åŒçš„æ€§èƒ½ï¼ŒFLOPsæ›´å°‘ã€‚</p>
<p>è¿™æ˜¯å› ä¸ºè®¡ç®—èµ„æºçš„åˆ†é…æ›´ç¬¦åˆæ ·æœ¬éœ€æ±‚ã€‚</p>
<h3 id="8">8. å®éªŒéªŒè¯çš„ç†è®ºè§£é‡Š</h3>
<h4 id="81-expert">8.1 ä¸ºä»€ä¹ˆéš¾æ ·æœ¬éœ€è¦æ›´å¤šExpertï¼Ÿ</h4>
<p><strong>æ¨å¯¼41ï¼šæ¨¡å‹å®¹é‡ä¸æ ·æœ¬éš¾åº¦</strong></p>
<p>æ ¹æ®VCç»´ç†è®ºï¼Œæ¨¡å‹å®¹é‡è¶Šå¤§ï¼Œèƒ½æ‹Ÿåˆçš„å‡½æ•°ç±»è¶Šå¤æ‚ã€‚éš¾æ ·æœ¬å¾€å¾€éœ€è¦æ›´å¤æ‚çš„å‡½æ•°æ¥å‡†ç¡®å»ºæ¨¡ã€‚</p>
<p>Expertæ•°$k$ä¸æ¨¡å‹æœ‰æ•ˆå®¹é‡çš„å…³ç³»ï¼ˆç®€åŒ–æ¨¡å‹ï¼‰ï¼š</p>
<p>$$
\text{Capacity}(k) \propto k \cdot \text{Capacity}_{\text{single}}
$$</p>
<p>æ›´å¤šExpert $\Rightarrow$ æ›´å¤§å®¹é‡ $\Rightarrow$ èƒ½å¤„ç†æ›´å¤æ‚ï¼ˆå›°éš¾ï¼‰çš„æ ·æœ¬ã€‚</p>
<p><strong>æ¨å¯¼42ï¼šä¿¡æ¯è®ºè§’åº¦</strong></p>
<p>ä»ä¿¡æ¯è®ºçœ‹ï¼Œéš¾æ ·æœ¬çš„æ¡ä»¶ç†µé«˜ï¼š</p>
<p>$$
H(Y|X=\boldsymbol{x}_{\text{hard}}) > H(Y|X=\boldsymbol{x}_{\text{easy}})
$$</p>
<p>éœ€è¦æ›´å¤šçš„æ¨¡å‹å®¹é‡ï¼ˆä¿¡æ¯é€šé“å®¹é‡ï¼‰æ¥ä¼ é€’è¿™äº›ä¿¡æ¯ã€‚</p>
<h4 id="82">8.2 åŠ¨æ€åˆ†é…çš„ç¨³å®šæ€§</h4>
<p><strong>æ¨å¯¼43ï¼šè´Ÿåé¦ˆæœºåˆ¶</strong></p>
<p>éš¾åº¦æ„ŸçŸ¥MoEæœ‰å†…åœ¨çš„è´Ÿåé¦ˆæœºåˆ¶ï¼š</p>
<ol>
<li>éš¾æ ·æœ¬åˆ†é…æ›´å¤šExpert</li>
<li>æ›´å¤šExpert $\Rightarrow$ æ›´å¥½çš„é¢„æµ‹</li>
<li>æ›´å¥½çš„é¢„æµ‹ $\Rightarrow$ éš¾åº¦é™ä½</li>
<li>éš¾åº¦é™ä½ $\Rightarrow$ åˆ†é…çš„Expertå‡å°‘</li>
</ol>
<p>è¿™å½¢æˆç¨³å®šçš„åŠ¨æ€å¹³è¡¡ã€‚</p>
<p>æ•°å­¦ä¸Šï¼Œå®šä¹‰éš¾åº¦æ¼”åŒ–ï¼š</p>
<p>$$
d_t(\boldsymbol{x}) = \mathcal{L}(\boldsymbol{f}_t(\boldsymbol{x}), \boldsymbol{y})
$$</p>
<p>Expertåˆ†é…ï¼š</p>
<p>$$
k_t(\boldsymbol{x}) = k_{\min} + (k_{\max} - k_{\min}) \phi(d_t(\boldsymbol{x}))
$$</p>
<p>å¹³è¡¡ç‚¹æ»¡è¶³ï¼š$d_t(\boldsymbol{x}) = d_{t+1}(\boldsymbol{x})$ã€‚</p>
<h3 id="9">9. æ€»ç»“ä¸å±•æœ›</h3>
<p>é€šè¿‡ä»¥ä¸Š43ä¸ªè¯¦ç»†æ¨å¯¼ï¼Œæˆ‘ä»¬å…¨é¢åˆ†æäº†éš¾åº¦æ„ŸçŸ¥åŠ¨æ€MoEçš„ç†è®ºåŸºç¡€ï¼š</p>
<ol>
<li><strong>éš¾åº¦å®šä¹‰</strong>ï¼šå»ºç«‹äº†åŸºäºæŸå¤±ã€æ¢¯åº¦ã€ä¸ç¡®å®šæ€§çš„å¤šç§éš¾åº¦åº¦é‡</li>
<li><strong>åŠ¨æ€è·¯ç”±</strong>ï¼šæ¨å¯¼äº†é˜ˆå€¼åŒ–é€‰æ‹©æœºåˆ¶å’ŒBiasçš„è‡ªç”±åº¦åˆ©ç”¨</li>
<li><strong>æŸå¤±å‡½æ•°</strong>ï¼šè®¾è®¡äº†éš¾åº¦æ„ŸçŸ¥çš„é¢„ç®—æ§åˆ¶æŸå¤±</li>
<li><strong>æ¢¯åº¦æ¨å¯¼</strong>ï¼šå®Œæ•´æ¨å¯¼äº†Routerã€Biasã€Expertçš„æ¢¯åº¦è®¡ç®—</li>
<li><strong>æœ€ä¼˜æ€§è¯æ˜</strong>ï¼šä»ä¼˜åŒ–ç†è®ºè¯æ˜äº†éš¾æ ·æœ¬åº”åˆ†é…æ›´å¤šèµ„æº</li>
<li><strong>è¯¾ç¨‹å­¦ä¹ </strong>ï¼šå»ºç«‹äº†ä¸è¯¾ç¨‹å­¦ä¹ ã€è‡ªé€‚åº”å­¦ä¹ çš„ç†è®ºè”ç³»</li>
<li><strong>ç†è®ºä¿è¯</strong>ï¼šåˆ†æäº†æ”¶æ•›æ€§ã€æ³›åŒ–æ€§ã€è®¡ç®—æ•ˆç‡</li>
<li><strong>å®éªŒè§£é‡Š</strong>ï¼šä»ç†è®ºè§’åº¦è§£é‡Šäº†å®éªŒç°è±¡</li>
</ol>
<p>è¿™äº›æ¨å¯¼ä¸ºè®¾è®¡å’Œæ”¹è¿›éš¾åº¦æ„ŸçŸ¥MoEæä¾›äº†åšå®çš„æ•°å­¦åŸºç¡€ï¼Œå¹¶æŒ‡æ˜äº†æœªæ¥ç ”ç©¶æ–¹å‘ï¼š
- æ›´ç²¾ç»†çš„éš¾åº¦ä¼°è®¡
- è‡ªé€‚åº”çš„éš¾åº¦æ˜ å°„å‡½æ•°
- å¤šä»»åŠ¡åœºæ™¯ä¸‹çš„èµ„æºåˆ†é…
- ä¸å…¶ä»–ç¨€ç–åŒ–æŠ€æœ¯çš„ç»“åˆ</p>
<hr />
<h3 id="3_1">ç¬¬3éƒ¨åˆ†ï¼šæ•°å­¦ç›´è§‰ã€å¤šè§’åº¦è§£é‡Šä¸ç±»æ¯”</h3>
<h4 id="31">3.1 ç”Ÿæ´»åŒ–ç±»æ¯”</h4>
<div class="intuition-box">

### ğŸ§  ç›´è§‰ç†è§£1ï¼šåŒ»ç”Ÿçœ‹ç—…çš„èµ„æºåˆ†é…

**åœºæ™¯**ï¼šæ€¥è¯Šå®¤æœ‰10ä½åŒ»ç”Ÿï¼ˆExpertï¼‰ï¼Œæ¥äº†100ä¸ªæ‚£è€…ï¼ˆTokenï¼‰ã€‚

**å›ºå®šæ–¹æ¡ˆï¼ˆä¼ ç»ŸTop-Kï¼‰**ï¼š
- æ¯ä¸ªæ‚£è€…å›ºå®šåˆ†é…2ä½åŒ»ç”Ÿï¼Œæ— è®ºç—…æƒ…è½»é‡
- **é—®é¢˜**ï¼šé‡ç—‡æ‚£è€…å¯èƒ½éœ€è¦3-4ä½åŒ»ç”Ÿï¼Œè½»ç—‡æ‚£è€…1ä½å°±å¤Ÿ
- ç»“æœï¼šèµ„æºæµªè´¹ + é‡ç—‡æ‚£è€…æ²»ç–—ä¸è¶³

**åŠ¨æ€æ–¹æ¡ˆï¼ˆæœ¬æ–‡æ–¹æ³•ï¼‰**ï¼š
- é€šè¿‡"åˆ†è¯Šå°"ï¼ˆéš¾åº¦è¯„ä¼°ï¼‰åˆ¤æ–­ç—…æƒ…
- é‡ç—‡ â†’ 3-4ä½åŒ»ç”Ÿï¼›ä¸­ç—‡ â†’ 2ä½ï¼›è½»ç—‡ â†’ 1ä½
- **ç»“æœ**ï¼šå¹³å‡ä»æ˜¯æ¯äºº2ä½åŒ»ç”Ÿï¼Œä½†æ²»ç–—æ•ˆæœæ›´å¥½

**æ•°å­¦å¯¹åº”**ï¼š
$$k(\text{patient}) = \begin{cases}
1, & \text{è½»ç—‡ï¼ˆç®€å•æ ·æœ¬ï¼‰} \\
2, & \text{ä¸­ç—‡ï¼ˆä¸­ç­‰æ ·æœ¬ï¼‰} \\
4, & \text{é‡ç—‡ï¼ˆå›°éš¾æ ·æœ¬ï¼‰}
\end{cases}$$

</div>

<div class="intuition-box">

### ğŸ§  ç›´è§‰ç†è§£2ï¼šæ•™å¸ˆè¾…å¯¼å­¦ç”Ÿ

**åœºæ™¯**ï¼šè€å¸ˆè¾…å¯¼ç­ä¸Šçš„å­¦ç”Ÿ

**å›ºå®šæ¨¡å¼**ï¼š
- æ¯ä¸ªå­¦ç”Ÿåˆ†é…å›ºå®š20åˆ†é’Ÿè¾…å¯¼æ—¶é—´
- å­¦éœ¸å’Œå­¦å›°ç”Ÿéƒ½æ˜¯20åˆ†é’Ÿ

**åŠ¨æ€æ¨¡å¼**ï¼ˆæ›´åˆç†ï¼‰ï¼š
- å­¦éœ¸ï¼š10åˆ†é’Ÿï¼ˆå·²ç»å¾ˆæ‡‚äº†ï¼‰
- ä¸­ç­‰ç”Ÿï¼š20åˆ†é’Ÿ
- å­¦å›°ç”Ÿï¼š40åˆ†é’Ÿï¼ˆéœ€è¦æ›´å¤šå¸®åŠ©ï¼‰
- **å¹³å‡**ï¼šä»æ˜¯20åˆ†é’Ÿ/äººï¼Œä½†æ•´ä½“æ•ˆæœæ›´å¥½

**å…³é”®æ´å¯Ÿ**ï¼šèµ„æºæŒ‰éœ€åˆ†é…ï¼Œè€Œéå¹³å‡åˆ†é…ï¼

</div>

<h4 id="32">3.2 å‡ ä½•æ„ä¹‰</h4>
<p><strong>é˜ˆå€¼åŒ–é€‰æ‹©çš„å‡ ä½•å›¾æ™¯</strong></p>
<div class="intuition-box">

æƒ³è±¡$n$ç»´ç©ºé—´ä¸­ï¼ŒRouterè¾“å‡º$\boldsymbol{\rho} \in \mathbb{R}^n$æ˜¯ä¸€ä¸ªç‚¹ã€‚

**å›ºå®šTop-K**ï¼š
- ç”»ä¸€ä¸ªè¶…çƒé¢ï¼ŒåŠå¾„ä½¿å¾—æ°å¥½$k$ä¸ªExpertåœ¨çƒå†…
- æ¯ä¸ªæ ·æœ¬çš„çƒåŠå¾„ç›¸åŒ

**åŠ¨æ€é˜ˆå€¼**ï¼š
- è®¾å®šä¸€ä¸ªå›ºå®šè¶…å¹³é¢ï¼š$\{\boldsymbol{z}: \boldsymbol{z} + \boldsymbol{b} = \boldsymbol{0}\}$
- ä¸åŒæ ·æœ¬ç”±äº$\boldsymbol{\rho}$ä¸åŒï¼Œè½åœ¨è¶…å¹³é¢ä¸Šæ–¹çš„Expertæ•°ä¸åŒ
- é€šè¿‡è°ƒæ•´$\boldsymbol{b}$çš„æ•´ä½“åç§»ï¼ˆåŠ å¸¸æ•°$c$ï¼‰ï¼Œæ§åˆ¶å¹³å‡Expertæ•°

**ç›´è§‰**ï¼š
- Bias $\boldsymbol{b}$å®šä¹‰äº†ä¸€ä¸ª"é—¨æ§›"
- $\rho_i + b_i > 0$ çš„Expertæ‰è¢«é€‰ä¸­
- å…¨å±€æŠ¬é«˜$\boldsymbol{b}$ï¼ˆåŠ æ­£æ•°ï¼‰ â†’ æ›´å¤šExpertè¢«é€‰  
- å…¨å±€é™ä½$\boldsymbol{b}$ï¼ˆåŠ è´Ÿæ•°ï¼‰ â†’ æ›´å°‘Expertè¢«é€‰

</div>

<h4 id="33">3.3 å¤šè§’åº¦ç†è§£</h4>
<p><strong>ğŸ“Š ç»æµå­¦è§†è§’ï¼šèµ„æºçš„è¾¹é™…æ•ˆç”¨</strong></p>
<div class="intuition-box">

æ¯ä¸ªExpertæ˜¯ä¸€ç§"èµ„æº"ï¼Œåˆ†é…ç»™æ ·æœ¬æ—¶äº§ç”Ÿ"æ•ˆç”¨"ï¼ˆæ€§èƒ½æå‡ï¼‰ã€‚

**è¾¹é™…æ•ˆç”¨é€’å‡**ï¼š
- ç¬¬1ä¸ªExpertï¼šæ•ˆç”¨$+10$
- ç¬¬2ä¸ªExpertï¼šæ•ˆç”¨$+8$
- ç¬¬3ä¸ªExpertï¼šæ•ˆç”¨$+5$
- ç¬¬4ä¸ªExpertï¼šæ•ˆç”¨$+2$

**æœ€ä¼˜åˆ†é…**ï¼ˆç»æµå­¦åŸç†ï¼‰ï¼š
- å½“æ‰€æœ‰æ ·æœ¬çš„**è¾¹é™…æ•ˆç”¨ç›¸ç­‰**æ—¶ï¼Œæ€»æ•ˆç”¨æœ€å¤§
- å›°éš¾æ ·æœ¬çš„è¾¹é™…æ•ˆç”¨ä¸‹é™æ…¢ â†’ åº”åˆ†é…æ›´å¤šExpert
- ç®€å•æ ·æœ¬çš„è¾¹é™…æ•ˆç”¨ä¸‹é™å¿« â†’ åº”åˆ†é…æ›´å°‘Expert

**æ•°å­¦**ï¼š
$$\frac{\partial \mathcal{L}_i}{\partial k_i} = \lambda, \quad \forall i \quad \text{(æœ€ä¼˜æ¡ä»¶)}$$

</div>

<p><strong>ğŸ“ æ•™è‚²å­¦è§†è§’ï¼šå› ææ–½æ•™</strong></p>
<div class="intuition-box">

ä¼ ç»Ÿæ•™è‚²ï¼šä¸€åˆ€åˆ‡ï¼ˆæ‰€æœ‰å­¦ç”ŸåŒæ ·çš„æ•™å­¦å¼ºåº¦ï¼‰

ç°ä»£æ•™è‚²ï¼šåˆ†å±‚æ•™å­¦
- åŸºç¡€ç­ï¼šè½»é‡æ•™å­¦ï¼ˆå°‘Expertï¼‰
- æé«˜ç­ï¼šä¸­ç­‰æ•™å­¦ï¼ˆä¸­Expertï¼‰
- å°–å­ç­ï¼šæ·±åº¦æ•™å­¦ï¼ˆå¤šExpertï¼‰

MoEåŠ¨æ€èµ„æºåˆ†é… = è‡ªåŠ¨åŒ–çš„"å› ææ–½æ•™"

</div>

<hr />
<h3 id="4_1">ç¬¬4éƒ¨åˆ†ï¼šæ–¹æ³•è®ºå˜ä½“ã€æ‰¹åˆ¤æ€§æ¯”è¾ƒä¸ä¼˜åŒ–</h3>
<h4 id="41-expert">4.1 åŠ¨æ€Expertæ–¹æ³•å¯¹æ¯”è¡¨</h4>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>æ ¸å¿ƒæ€æƒ³</th>
<th>ä¼˜ç‚¹</th>
<th><strong>ç¼ºé™·</strong></th>
<th><strong>ä¼˜åŒ–æ–¹å‘</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>AdaMoE</strong></td>
<td>æ··å…¥ç©ºç™½/å¤åˆ¶Expert</td>
<td>âœ… å¤ç”¨Top-KåŸºå»º<br>âœ… å®ç°ç®€å•</td>
<td>âŒ <strong>çµæ´»æ€§å·®</strong><br>âŒ éœ€è¦é¢å¤–Expertç±»å‹<br>âŒ è´Ÿè½½å‡è¡¡å¤æ‚</td>
<td>âœ… æ›´ä¸°å¯Œçš„ç®€å•Expert<br>âœ… è‡ªé€‚åº”æ•°é‡</td>
</tr>
<tr>
<td><strong>Top-Pè·¯ç”±</strong></td>
<td>ç´¯ç§¯æ¦‚ç‡é˜ˆå€¼</td>
<td>âœ… æ€è·¯è‡ªç„¶</td>
<td>âŒ <strong>æ— æ³•ç²¾ç¡®æ§åˆ¶é¢„ç®—</strong><br>âŒ éœ€è¦é¢å¤–ç†µæŸå¤±<br>âŒ å‡åŒ€åˆ†å¸ƒæ—¶é€‰å¤ªå¤š</td>
<td>âœ… è‡ªé€‚åº”é˜ˆå€¼<br>âœ… åŠ¨æ€$p$å€¼</td>
</tr>
<tr>
<td><strong>Ada-K Routing</strong></td>
<td>RLé¢„æµ‹Expertæ•°</td>
<td>âœ… åŸç†æ­£ç¡®<br>âœ… è¡¨è¾¾èƒ½åŠ›å¼º</td>
<td>âŒ <strong>è®­ç»ƒå¤æ‚åº¦é«˜</strong><br>âŒ å¼•å…¥RLä¸ç¨³å®š<br>âŒ è¶…å‚æ•°å¤š</td>
<td>âœ… ç®€åŒ–RLç­–ç•¥<br>âœ… æ¨¡ä»¿å­¦ä¹ </td>
</tr>
<tr>
<td><strong>ReMoE</strong></td>
<td>é›¶é˜ˆå€¼+Aux Loss</td>
<td>âœ… å½¢å¼ç®€æ´</td>
<td>âŒ <strong>ä»éœ€è°ƒAuxæƒé‡</strong><br>âŒ ç³…åˆå¤šç§æ–¹æ³•<br>âŒ ç†è®ºä¸ç»Ÿä¸€</td>
<td>âœ… å®Œå…¨Loss-Free<br>âœ… ç»Ÿä¸€æ¡†æ¶</td>
</tr>
<tr>
<td><strong>æœ¬æ–‡æ–¹æ³•</strong></td>
<td>Biasè‡ªç”±åº¦</td>
<td>âœ… æœ€å°æ”¹åŠ¨<br>âœ… Loss-Freeç»§æ‰¿<br>âœ… ç†è®ºä¼˜é›…</td>
<td>âŒ <strong>åˆå§‹åŒ–æ•æ„Ÿ</strong><br>âŒ Biasæ¼‚ç§»å¯èƒ½<br>âŒ å¤§è§„æ¨¡æœªéªŒè¯</td>
<td>âœ… æ™ºèƒ½åˆå§‹åŒ–<br>âœ… Biasçº¦æŸ<br>âœ… å¤§è§„æ¨¡å®éªŒ</td>
</tr>
</tbody>
</table>
<h4 id="42-">4.2 æœ¬æ–‡æ–¹æ³• - æ‰¹åˆ¤æ€§åˆ†æ</h4>
<div class="analysis-box">

### **æ ¸å¿ƒç¼ºé™·**

**ç¼ºé™·1ï¼šBiasåˆå§‹åŒ–æ•æ„Ÿ**

**é—®é¢˜**ï¼š
- å…¨é›¶åˆå§‹åŒ– + Sigmoidæ¿€æ´» â†’ æ‰€æœ‰Expertéƒ½è¢«é€‰ï¼ˆé¢„ç®—çˆ†ç‚¸ï¼‰
- éœ€è¦ç²¾å¿ƒè®¾è®¡åˆå§‹åŒ–ç­–ç•¥

**ä¼˜åŒ–æ–¹å‘**ï¼š
- è®ºæ–‡æå‡ºçš„äºŒåˆ†æ³•åˆå§‹åŒ–
- åŸºäºæ•°æ®ç»Ÿè®¡çš„è‡ªé€‚åº”åˆå§‹åŒ–
- Warmupé˜¶æ®µè®©Biaså¿«é€Ÿæ”¶æ•›

---

**ç¼ºé™·2ï¼šBiasçš„ç»å¯¹å€¼å¯èƒ½æ¼‚ç§»**

**é—®é¢˜**ï¼š
- è™½ç„¶ç›¸å¯¹å€¼ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰ç¨³å®šï¼Œä½†ç»å¯¹å€¼å¯èƒ½æŒç»­å¢å¤§æˆ–å‡å°

**ä¼˜åŒ–æ–¹å‘**ï¼š
- å®šæœŸre-centerï¼š$\boldsymbol{b} \leftarrow \boldsymbol{b} - \bar{b}$
- é™åˆ¶$\boldsymbol{b}$çš„èŒƒå›´ï¼š$b_i \in [-B_{\max}, B_{\max}]$

---

**ç¼ºé™·3ï¼šéš¾åº¦ä¼°è®¡çš„å‡†ç¡®æ€§**

**é—®é¢˜**ï¼š
- å®æ—¶è®¡ç®—æ ·æœ¬éš¾åº¦ï¼ˆå¦‚æŸå¤±å€¼ï¼‰éœ€è¦å‰å‘ä¼ æ’­
- å¢åŠ è®¡ç®—å¼€é”€

**ä¼˜åŒ–æ–¹å‘**ï¼š
- ä½¿ç”¨Routerå¾—åˆ†çš„æ–¹å·®ä½œä¸ºéš¾åº¦ä»£ç†
- é¢„è®­ç»ƒä¸€ä¸ªè½»é‡çº§éš¾åº¦é¢„æµ‹å™¨
- åŸºäºå†å²ç»Ÿè®¡çš„éš¾åº¦ä¼°è®¡

</div>

<hr />
<h3 id="5_1">ç¬¬5éƒ¨åˆ†ï¼šå­¦ä¹ è·¯çº¿å›¾ä¸æœªæ¥å±•æœ›</h3>
<h4 id="51_1">5.1 å­¦ä¹ è·¯çº¿å›¾</h4>
<p><strong>å¿…å¤‡å‰ç½®çŸ¥è¯†</strong>ï¼š
- MoEåŸºç¡€ï¼ˆç¬¬1-3ç¯‡æ–‡ç« ï¼‰
- Loss-Freeæ–¹æ³•ï¼ˆç¬¬3ç¯‡æ–‡ç« ï¼‰
- è¯¾ç¨‹å­¦ä¹ ï¼ˆCurriculum Learningï¼‰
- èµ„æºåˆ†é…ç†è®º</p>
<p><strong>æ¨èå­¦ä¹ é¡ºåº</strong>ï¼š
1. ç†è§£å›ºå®šTop-K MoEçš„å±€é™
2. å­¦ä¹ è¯¾ç¨‹å­¦ä¹ å’Œéš¾åº¦æ„ŸçŸ¥è®­ç»ƒ
3. æŒæ¡Biasçš„å†—ä½™è‡ªç”±åº¦
4. å®ç°åŠ¨æ€Experté€‰æ‹©
5. å®éªŒéªŒè¯ä¸è°ƒä¼˜</p>
<p><strong>æ ¸å¿ƒè®ºæ–‡</strong>ï¼š
1. Bengio et al. (2009) - "Curriculum Learning"
2. Kumar et al. (2010) - "Self-Paced Learning"<br />
3. DeepSeek (2024) - "Auxiliary-Loss-Free Load Balancing"
4. æœ¬æ–‡ä½œè€… (2025) - åŠ¨æ€Expert MoE</p>
<hr />
<h4 id="52_1">5.2 ç ”ç©¶ç©ºç™½ä¸æœªæ¥æ–¹å‘</h4>
<h4 id="1_2"><strong>æ–¹å‘1ï¼šæ™ºèƒ½éš¾åº¦ä¼°è®¡</strong></h4>
<p><strong>ç ”ç©¶ç©ºç™½</strong>ï¼š
- å½“å‰éš¾åº¦ä¼°è®¡ä¾èµ–æŸå¤±å€¼ï¼Œè®¡ç®—å¼€é”€å¤§
- ç¼ºä¹é€šç”¨çš„éš¾åº¦åº¦é‡æ ‡å‡†</p>
<p><strong>å…·ä½“ç ”ç©¶é—®é¢˜</strong>ï¼š
1. èƒ½å¦è®¾è®¡æ— éœ€å‰å‘ä¼ æ’­çš„éš¾åº¦ä¼°è®¡ï¼Ÿ
   - åŸºäºè¾“å…¥ç‰¹å¾çš„é¢„æµ‹å™¨
   - åŸºäºRouterå¾—åˆ†åˆ†å¸ƒçš„ä»£ç†æŒ‡æ ‡
2. å¤šä»»åŠ¡åœºæ™¯ä¸‹çš„éš¾åº¦å®šä¹‰ï¼Ÿ
   - ä¸åŒä»»åŠ¡çš„éš¾åº¦ä¸å¯æ¯”
   - éœ€è¦ä»»åŠ¡ç‰¹å®šçš„å½’ä¸€åŒ–</p>
<p><strong>é‡åŒ–ç›®æ ‡</strong>ï¼š
- éš¾åº¦ä¼°è®¡æ—¶é—´&lt;1% æ€»æ—¶é—´
- ä¸çœŸå®æŸå¤±ç›¸å…³ç³»æ•°&gt;0.8</p>
<hr />
<h4 id="2_2"><strong>æ–¹å‘2ï¼šè‡ªé€‚åº”é¢„ç®—æ§åˆ¶</strong></h4>
<p><strong>ç ”ç©¶ç©ºç™½</strong>ï¼š
- å½“å‰é¢„ç®—$k$å›ºå®šï¼Œå¯èƒ½åœ¨è®­ç»ƒä¸åŒé˜¶æ®µéœ€æ±‚ä¸åŒ
- ç¼ºä¹ç†è®ºæŒ‡å¯¼å¦‚ä½•è®¾ç½®$k$</p>
<p><strong>å…·ä½“ç ”ç©¶é—®é¢˜</strong>ï¼š
1. è®­ç»ƒè¿‡ç¨‹ä¸­$k$åº”å¦‚ä½•å˜åŒ–ï¼Ÿ
   - æ—©æœŸï¼šå¤§$k$ï¼ˆæ¨¡å‹ä¸æˆç†Ÿï¼Œéƒ½éœ€è¦èµ„æºï¼‰
   - åæœŸï¼šå°$k$ï¼ˆæ¨¡å‹æˆç†Ÿï¼ŒåŒºåˆ†åº¦é«˜ï¼‰
2. å¦‚ä½•è‡ªåŠ¨ç¡®å®šæœ€ä¼˜$k$ï¼Ÿ
   - åŸºäºéªŒè¯é›†æ€§èƒ½çš„æœç´¢
   - å¼ºåŒ–å­¦ä¹ ä¼˜åŒ–é¢„ç®—åˆ†é…ç­–ç•¥</p>
<p><strong>é‡åŒ–ç›®æ ‡</strong>ï¼š
- è‡ªé€‚åº”$k$ç›¸æ¯”å›ºå®š$k$æ€§èƒ½æå‡5%
- æ— éœ€äººå·¥è°ƒå‚</p>
<hr />
<h4 id="3_2"><strong>æ–¹å‘3ï¼šå¤šæ¨¡æ€ä¸é•¿ä¸Šä¸‹æ–‡</strong></h4>
<p><strong>ç ”ç©¶ç©ºç™½</strong>ï¼š
- å›¾åƒã€æ–‡æœ¬ã€éŸ³é¢‘çš„éš¾åº¦å®šä¹‰ä¸åŒ
- é•¿ä¸Šä¸‹æ–‡ä¸­Tokené—´éš¾åº¦ç›¸å…³æ€§</p>
<p><strong>å…·ä½“ç ”ç©¶é—®é¢˜</strong>ï¼š
1. è·¨æ¨¡æ€éš¾åº¦å½’ä¸€åŒ–ï¼Ÿ
   - æ–‡æœ¬éš¾åº¦ vs å›¾åƒéš¾åº¦å¦‚ä½•æ¯”è¾ƒï¼Ÿ
2. ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„éš¾åº¦ä¼°è®¡ï¼Ÿ
   - å½“å‰Tokençš„éš¾åº¦ä¾èµ–äºå‰æ–‡</p>
<p><strong>é‡åŒ–ç›®æ ‡</strong>ï¼š
- å¤šæ¨¡æ€MoEä¸­å„æ¨¡æ€æ€§èƒ½å‡è¡¡
- é•¿ä¸Šä¸‹æ–‡ï¼ˆ128kï¼‰æ€§èƒ½æå‡10%</p>
<hr />
<h3 id="_8">æ€»ç»“</h3>
<p>æœ¬æ–‡æå‡ºäº†åˆ©ç”¨Loss-Freeä¸­Biasçš„å†—ä½™è‡ªç”±åº¦å®ç°åŠ¨æ€Experté€‰æ‹©çš„æ–¹æ³•ï¼Œæ ¸å¿ƒåˆ›æ–°åœ¨äºï¼š</p>
<ol>
<li><strong>æœ€å°æ”¹åŠ¨</strong>ï¼šåªéœ€ä¿®æ”¹Top-Kä¸ºé˜ˆå€¼åˆ¤æ–­$\rho_i + b_i &gt; 0$</li>
<li><strong>åŒé‡ç›®æ ‡</strong>ï¼šåŒæ—¶å®ç°è´Ÿè½½å‡è¡¡å’Œé¢„ç®—æ§åˆ¶</li>
<li><strong>ç†è®ºæ”¯æ’‘</strong>ï¼šä»æœ€ä¼˜èµ„æºåˆ†é…ç†è®ºå‡ºå‘ï¼Œè¯æ˜éš¾æ ·æœ¬åº”å¾—æ›´å¤šèµ„æº</li>
</ol>
<p><strong>æ ¸å¿ƒè¦ç‚¹</strong>ï¼š
- å›ºå®š$k$ â†’ åŠ¨æ€$k(\boldsymbol{x})$
- æŒ‰éš¾åº¦åˆ†é…èµ„æº
- Biasçš„è‡ªç”±åº¦å¦™ç”¨</p>
<p><strong>æœªæ¥æ–¹å‘</strong>ï¼š
- æ›´æ™ºèƒ½çš„éš¾åº¦ä¼°è®¡
- è‡ªé€‚åº”é¢„ç®—æ§åˆ¶
- å¤šæ¨¡æ€ä¸é•¿ä¸Šä¸‹æ–‡åº”ç”¨</p>
<p>è¿™ä¸€æ€æƒ³ä¸ä»…é€‚ç”¨äºMoEï¼Œä¹Ÿå¯æ¨å¹¿åˆ°ä»»ä½•éœ€è¦åŠ¨æ€èµ„æºåˆ†é…çš„åœºæ™¯ã€‚</p>
        </div>
    </div>
</body>
</html>