<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€šè¿‡æ¢¯åº¦è¿‘ä¼¼å¯»æ‰¾Normalizationçš„æ›¿ä»£å“</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>é€šè¿‡æ¢¯åº¦è¿‘ä¼¼å¯»æ‰¾Normalizationçš„æ›¿ä»£å“</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-26 | ğŸ“„ å¤§å°: 33.3 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/10831">https://spaces.ac.cn/archives/10831</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰ç•™æ„åˆ°å‰æ®µæ—¶é—´çš„<a href="https://papers.cool/arxiv/2503.10622">ã€ŠTransformers without Normalizationã€‹</a>ï¼Ÿè¿™ç¯‡è®ºæ–‡è¯•å›¾å°†Transformeræ¨¡å‹ä¸­çš„Normalizationå±‚ç”¨ä¸€ä¸ªElement-wiseçš„è¿ç®—DyTæ›¿ä»£ï¼Œä»¥æœŸèƒ½æé«˜é€Ÿåº¦å¹¶ä¿æŒæ•ˆæœã€‚è¿™ç§åŸºç¡€æ¶æ„çš„ä¸»é¢˜æœ¬èº«è‡ªå¸¦ä¸€ç‚¹å¸å¼•åŠ›ï¼ŒåŠ ä¹‹Kaiming Heå’ŒYann LeCunä¸¤ä½å¤§ä½¬æŒ‚åï¼Œæ‰€ä»¥è¿™ç¯‡è®ºæ–‡å‘å¸ƒä¹‹æ—¶å°±å¼•èµ·äº†ä¸å°‘å›´è§‚ï¼Œè¯„ä»·ä¹Ÿæ˜¯æœ‰è¤’æœ‰è´¬ã€‚</p>
<p>æ— ç‹¬æœ‰å¶ï¼Œä¸Šå‘¨çš„ä¸€ç¯‡æ–°è®ºæ–‡<a href="https://papers.cool/arxiv/2503.21708">ã€ŠThe Mathematical Relationship Between Layer Normalization and Dynamic Activation Functionsã€‹</a>ä»æ¢¯åº¦åˆ†æå’Œå¾®åˆ†æ–¹ç¨‹çš„è§†è§’è§£è¯»äº†DyTï¼Œå¹¶æå‡ºäº†æ–°çš„æ›¿ä»£å“ã€‚ä¸ªäººæ„Ÿè§‰è¿™ä¸ªç†è§£è§’åº¦éå¸¸æœ¬è´¨ï¼Œé‚å­¦ä¹ å’Œåˆ†äº«ä¸€æ³¢ã€‚</p>
<h2 id="_1">å†™åœ¨å‰é¢</h2>
<p>DyTå…¨ç§°æ˜¯Dynamic Tanhï¼Œå®ƒé€šè¿‡å¦‚ä¸‹è¿ç®—æ¥æ›¿ä»£Normalizationå±‚ï¼š<br />
\begin{equation}\mathop{\text{DyT}}(\boldsymbol{x}) = \boldsymbol{\gamma} \odot \tanh(\alpha \boldsymbol{x}) + \boldsymbol{\beta}\end{equation}<br />
å…¶ä¸­$\alpha,\boldsymbol{\beta},\boldsymbol{\gamma}$éƒ½æ˜¯å¯å­¦å‚æ•°ï¼Œ$\boldsymbol{\beta},\boldsymbol{\gamma}$æ˜¯Normalizationå±‚æœ¬æ¥å°±æœ‰çš„ï¼Œæ‰€ä»¥è¿™é‡Œçš„å…³é”®æ˜¯ç”¨$\tanh(\alpha \boldsymbol{x})$æ›¿ä»£äº†Normalizeè¿ç®—ã€‚$\tanh$æ˜¯é€å…ƒç´ çš„è¿ç®—ï¼Œå…é™¤äº†å‡å€¼ã€æ–¹å·®è¿™ä¸¤ä¸ªç»Ÿè®¡é‡çš„è®¡ç®—ã€‚</p>
<p>å…³äºDyTï¼Œç¬”è€…æ›¾åœ¨çŸ¥ä¹<a href="https://www.zhihu.com/question/14925347536/answer/124434065689">ã€Šå¦‚ä½•è¯„ä»· Meta æ–°è®ºæ–‡ Transformers without Normalizationï¼Ÿã€‹</a>å‘è¡¨è¿‡ä¸€äº›çœ‹æ³•ï¼Œç®€å•æ¥è¯´å°±æ˜¯ä¸å¤§çœ‹å¥½ã€‚ç†ç”±æ˜¯Normalizationæ— è„‘åœ°ç¨³å®šäº†æ¨¡å‹çš„å‰å‘ä¼ æ’­ï¼Œé‚£ä¹ˆå°±ç•™äº†æ›´å¤šçš„è‡ªç”±åº¦å’Œå¯èƒ½æ€§ç»™æ¨¡å‹çš„å…¶ä»–æ–¹é¢ï¼ˆæ¯”å¦‚æ•ˆæœï¼‰ï¼Œæ‰€ä»¥ç¬”è€…ä¸è®¤ä¸ºæ¯”æœ‰Normalizationæ›´ç®€åŒ–çš„é€šç”¨æ“ä½œèƒ½å®ç°æ›´å¥½çš„æ•ˆæœï¼ˆNo Free Lunchï¼‰ã€‚</p>
<p>äº‹å®ä¸Šæ—©åœ¨2021å¹´çš„<a href="/archives/8620#%E6%AE%8B%E5%B7%AE%E8%BF%9E%E6%8E%A5">ã€Šæµ…è°ˆTransformerçš„åˆå§‹åŒ–ã€å‚æ•°åŒ–ä¸æ ‡å‡†åŒ–ã€‹</a>æˆ‘ä»¬å°±è®¨è®ºè¿‡å»æ‰Normalizationè¿™ä¸ªè¯é¢˜ï¼Œç›¸å…³å·¥ä½œæœ‰<a href="https://papers.cool/arxiv/2002.10444">SkipInit</a>ã€<a href="https://papers.cool/arxiv/2003.04887">ReZero</a>ã€<a href="https://papers.cool/arxiv/1901.09321">Fixup</a>ç­‰ã€‚å½“æ—¶ç¬”è€…è¯•äº†ä¸€äº›æ–¹æ¡ˆï¼Œå‘ç°å®ƒä»¬å³ä¾¿åœ¨æŸäº›æ–¹é¢èƒ½å¤Ÿè¿½å¹³Normalizationï¼Œä½†ä»ä¼šå­˜åœ¨å¦ä¸€äº›æ–¹é¢çš„ä¸è¶³ï¼Œæ¯”å¦‚é¢„è®­ç»ƒæ•ˆæœå°šå¯ï¼Œä½†å¾®è°ƒæ•ˆæœè¾ƒå·®ç­‰ï¼Œæ‰€ä»¥å°±æ²¡å†æ·±ç©¶ä¸‹å»äº†ã€‚</p>
<p>å› æ­¤ï¼Œç¬”è€…ç°åœ¨å¯¹ç±»ä¼¼å·¥ä½œéƒ½åªè§†ä¸ºç®€åŒ–ç»´åº¦ä¸Šçš„æé™æ¢ç´¢æ¥æ¬£èµï¼Œæ­£å¦‚<a href="https://papers.cool/arxiv/2410.01131">ã€ŠnGPT: Normalized Transformer with Representation Learning on the Hypersphereã€‹</a>å‡ ä¹å°†æ¯ä¸€å¤„èƒ½Normalizeçš„åœ°æ–¹éƒ½åŠ ä¸ŠNormalizeä¸€æ ·ï¼Œéƒ½å±äºæŸä¸ªæ–¹å‘çš„æé™æ¢ç´¢ã€‚</p>
<h2 id="_2">æ¢¯åº¦è®¡ç®—</h2>
<p>å½“ç„¶ï¼Œä¸çœ‹å¥½å½’ä¸çœ‹å¥½ï¼Œä¸å¦¨ç¢æˆ‘ä»¬çš„å­¦ä¹ å’Œåˆ†æã€‚è¦æƒ³å¯»æ‰¾Normalizationçš„æ›¿ä»£æˆ–è€…è¯´è¿‘ä¼¼ï¼Œæœ€ç›´æ¥çš„æ€è·¯å°±æ˜¯ä»æ¢¯åº¦å…¥æ‰‹ï¼Œå› ä¸ºæ·±åº¦å­¦ä¹ è¯´åˆ°åº•ä¹Ÿå°±æ˜¯å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­é‚£ç‚¹äº‹ï¼Œåå‘ä¼ æ’­ä¹Ÿå°±æ˜¯æ±‚æ¢¯åº¦ï¼Œå¾€å¾€æ‰®æ¼”ç€æ¯”è¾ƒæœ¬è´¨çš„è§’è‰²ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬åªè€ƒè™‘RMS Normï¼Œå®ƒçš„å…³é”®è¿ç®—æ˜¯<br />
\begin{equation}\boldsymbol{y} = \frac{\boldsymbol{x}}{\Vert\boldsymbol{x}\Vert_{RMS}} = \sqrt{d}\times \frac{\boldsymbol{x}}{\Vert\boldsymbol{x}\Vert}\label{eq:rms-norm}\end{equation}<br />
å…¶ä¸­$\boldsymbol{x}\in\mathbb{R}^d$ï¼Œä»¥åŠ<br />
\begin{equation}\Vert\boldsymbol{x}\Vert_{RMS} = \frac{\Vert\boldsymbol{x}\Vert}{\sqrt{d}},\qquad \Vert\boldsymbol{x}\Vert = \sqrt{\boldsymbol{x}^2} = \sqrt{\sum_{i=1}^d x_i^2}\end{equation}<br />
æ‰€ä»¥è¦æ±‚$\boldsymbol{x} / \Vert\boldsymbol{x}\Vert_{RMS}$çš„æ¢¯åº¦ï¼Œç­‰ä»·äºæ±‚$\boldsymbol{x} / \Vert\boldsymbol{x}\Vert$çš„æ¢¯åº¦ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è®¡ç®—ï¼š<br />
\begin{equation}\frac{\boldsymbol{x}+\Delta\boldsymbol{x}}{\Vert\boldsymbol{x}+\Delta\boldsymbol{x}\Vert} = \frac{\boldsymbol{x}}{\Vert\boldsymbol{x}+\Delta\boldsymbol{x}\Vert} + \frac{\Delta\boldsymbol{x}}{\Vert\boldsymbol{x}+\Delta\boldsymbol{x}\Vert} \approx \frac{\boldsymbol{x}}{\Vert\boldsymbol{x}+\Delta\boldsymbol{x}\Vert} + \frac{\Delta\boldsymbol{x}}{\Vert\boldsymbol{x}\Vert}\label{eq:exp-1}\end{equation}<br />
æ¯”è¾ƒå¤æ‚çš„åœ°æ–¹æ˜¯å±•å¼€$\Vert\boldsymbol{x}+\Delta\boldsymbol{x}\Vert = \sqrt{(\boldsymbol{x}+\Delta\boldsymbol{x})^2}$ï¼š<br />
\begin{equation}\begin{aligned}<br />
&amp;\,\sqrt{(\boldsymbol{x}+\Delta\boldsymbol{x})^2} \\\<br />
\approx&amp;\, \sqrt{\Vert\boldsymbol{x}\Vert^2+2\boldsymbol{x}\cdot\Delta\boldsymbol{x}} \\\<br />
=&amp;\, \Vert\boldsymbol{x}\Vert\sqrt{1+2\boldsymbol{x}\cdot\Delta\boldsymbol{x}/\Vert\boldsymbol{x}\Vert^2} \\\<br />
=&amp;\, \Vert\boldsymbol{x}\Vert (1+\boldsymbol{x}\cdot\Delta\boldsymbol{x}/\Vert\boldsymbol{x}\Vert^2)<br />
\end{aligned} \quad \Rightarrow \quad<br />
\begin{aligned}<br />
\frac{\boldsymbol{x}}{\Vert\boldsymbol{x}+\Delta\boldsymbol{x}\Vert} \approx&amp;\, \frac{\boldsymbol{x}}{\Vert\boldsymbol{x}\Vert}(1-\boldsymbol{x}\cdot\Delta\boldsymbol{x}/\Vert\boldsymbol{x}\Vert^2)<br />
\end{aligned}\end{equation}<br />
ä»£å…¥å¼$\eqref{eq:exp-1}$å¾—ï¼š<br />
\begin{equation}\frac{\boldsymbol{x}+\Delta\boldsymbol{x}}{\Vert\boldsymbol{x}+\Delta\boldsymbol{x}\Vert} - \frac{\boldsymbol{x}}{\Vert\boldsymbol{x}\Vert} \approx \frac{\Delta\boldsymbol{x}}{\Vert\boldsymbol{x}\Vert} - \frac{(\boldsymbol{x}\cdot\Delta\boldsymbol{x})\boldsymbol{x}}{\Vert\boldsymbol{x}\Vert^3}\quad\Rightarrow\quad\nabla_{\boldsymbol{x}} \frac{\boldsymbol{x}}{\Vert\boldsymbol{x}\Vert} = \frac{\boldsymbol{I}}{\Vert\boldsymbol{x}\Vert} - \frac{\boldsymbol{x}\boldsymbol{x}^{\top}}{\Vert\boldsymbol{x}\Vert^3}\end{equation}<br />
æœ€åä»£å›å¼$\eqref{eq:rms-norm}$å¾—<br />
\begin{equation}\nabla_{\boldsymbol{x}} \boldsymbol{y} = \sqrt{d}\left(\frac{\boldsymbol{I}}{\Vert\boldsymbol{x}\Vert} - \frac{\boldsymbol{x}\boldsymbol{x}^{\top}}{\Vert\boldsymbol{x}\Vert^3}\right) = \frac{1}{\Vert\boldsymbol{x}\Vert_{RMS}}\left(\boldsymbol{I} - \frac{\boldsymbol{y}\boldsymbol{y}^{\top}}{d}\right)\label{eq:rms-norm-grad}\end{equation}</p>
<h2 id="dyt">DyTç°ï¼</h2>
<p>æ³¨æ„$\boldsymbol{x},\boldsymbol{y}$éƒ½æ˜¯ä¸€ä¸ªå‘é‡ï¼Œæ‰€ä»¥$\nabla_{\boldsymbol{x}} \boldsymbol{y}$æ˜¯ä¸€ä¸ªçŸ©é˜µï¼ˆé›…å¯æ¯”çŸ©é˜µï¼‰ã€‚ç°åœ¨æˆ‘ä»¬è€ƒè™‘ç»™RMS Normæ‰¾ä¸€ä¸ªElement-wiseè¿‘ä¼¼ï¼Œå³æ¯ä¸ªåˆ†é‡æ˜¯ç‹¬ç«‹è¿ç®—çš„ï¼š<br />
\begin{equation}f(\boldsymbol{x}) = [f(x_1),f(x_2),\cdots,f(x_d)]\end{equation}<br />
è¿™ä¸ªç‹¬ç«‹æ€§æ„å‘³ç€å®ƒçš„é›…å¯æ¯”çŸ©é˜µä¸€å®šæ˜¯å¯¹è§’é˜µï¼æˆ‘ä»¬å¸Œæœ›è¿™ä¸ªè¿‘ä¼¼èƒ½å°½å¯èƒ½ä¿ç•™RMS Normçš„æ¢¯åº¦ï¼Œæ‰€ä»¥æˆ‘ä»¬è€ƒè™‘ä¿ç•™å¼$\eqref{eq:rms-norm-grad}$çš„å¯¹è§’çº¿éƒ¨åˆ†ï¼š<br />
\begin{equation}\frac{dy_i}{dx_i} = \frac{1}{\Vert\boldsymbol{x}\Vert_{RMS}}\left(1 - \frac{y_i^2}{d}\right)\label{eq:ode-1}\end{equation}<br />
å¦‚æœæˆ‘ä»¬è¿›ä¸€æ­¥å‡è®¾$\rho = \Vert\boldsymbol{x}\Vert_{RMS}$æ˜¯å¸¸æ•°ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥æ±‚è§£ä¸Šè¿°å¾®åˆ†æ–¹ç¨‹å¾—åˆ°<br />
\begin{equation}y_i = \sqrt{d}\tanh\left(\frac{x_i}{\rho\sqrt{d}}\right)\end{equation}<br />
è¿™æ ·æˆ‘ä»¬å°±å¾—åˆ°äº†DyTçš„Tï¼ˆ$\tanh$ï¼‰ï¼Œå…¶ä¸­æ±‚è§£è¿‡ç¨‹é€‰æ‹©çš„åˆå€¼æ¡ä»¶ä¸º$y_i(0)=0$ã€‚</p>
<p>DyTç›¸å½“äºå°†å‰é¢çš„$\sqrt{d}$å¸æ”¶åˆ°$\boldsymbol{\gamma}$å‚æ•°é‡Œï¼Œç„¶åå°†æ‹¬å·å†…çš„$\frac{1}{\rho\sqrt{d}}$è§†ä¸ºè®­ç»ƒå‚æ•°$\alpha$ï¼Œç¼“è§£â€œ$\rho = \Vert\boldsymbol{x}\Vert_{RMS}$æ˜¯å¸¸æ•°â€è¿™ä¸€å‡è®¾å¸¦æ¥çš„é™åˆ¶ã€‚ä¸è¿‡åœ¨ç¬”è€…çœ‹æ¥ï¼Œæ˜¾å¼ä¿ç•™$\sqrt{d}$å¯èƒ½ä¼šæ›´æœ‰ä»·å€¼ï¼Œåªè¦å°†$\frac{1}{\rho}$éƒ¨åˆ†è§†ä¸ºå¯è®­ç»ƒå‚æ•°å°±å¥½ã€‚</p>
<h2 id="dyisru">DyISRU</h2>
<p>ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰ç•™æ„åˆ°ï¼Œå¯¹äºRMS Normæˆ‘ä»¬æ’æœ‰$y_i = x_i / \Vert\boldsymbol{x}\Vert_{RMS}$ï¼Œæ‰€ä»¥æ–¹ç¨‹$\eqref{eq:ode-1}$çš„$\Vert\boldsymbol{x}\Vert_{RMS}$æˆ‘ä»¬å¯ä»¥æ¢æˆ$x_i/y_i$ï¼Œä»è€Œå¾—åˆ°<br />
\begin{equation}\frac{dy_i}{dx_i} = \frac{y_i}{x_i}\left(1 - \frac{y_i^2}{d}\right)\label{eq:ode-2}\end{equation}<br />
è¿™æ˜¯ä¸€ä¸ªåªæœ‰$x_i,y_i$çš„æ–¹ç¨‹ï¼Œå…é™¤äº†å¯¹$\Vert\boldsymbol{x}\Vert_{RMS}$çš„è¿‘ä¼¼å¤„ç†ã€‚æ±‚è§£è¯¥æ–¹ç¨‹å¾—<br />
\begin{equation}y_i = \frac{\sqrt{d}x_i}{\sqrt{x_i^2 + C}}\end{equation}<br />
å…¶ä¸­$C$æ˜¯ä»»æ„å¸¸æ•°ã€‚è¿™ç§å½¢å¼æœ‰ä¸ªåå­—å«åšISRUï¼ˆInverse Square Root Unitï¼Œæˆ‘ä»¬ä¹‹å‰ä¹Ÿå«è¿‡<a href="/archives/10563#SoftSign">SoftSign</a>ï¼‰ï¼Œå‡ºè‡ªè®ºæ–‡<a href="https://papers.cool/arxiv/1710.09967">ã€ŠImproving Deep Learning by Inverse Square Root Linear Units (ISRLUs)ã€‹</a>ã€‚å¦‚æœå°†$C$è§†ä¸ºå¯è®­ç»ƒå‚æ•°ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç±»æ¯”DyTç§°ä¸ºDyISRUï¼ˆDynamic ISRUï¼‰ã€‚</p>
<p>ä»æ¢¯åº¦$\eqref{eq:rms-norm-grad}$åˆ°æ–¹ç¨‹$\eqref{eq:ode-1}$å†åˆ°$\eqref{eq:ode-2}$æ¥çœ‹ï¼ŒDyISRUæ˜¯æˆ‘ä»¬ç”¨Element-wiseå‡½æ•°èƒ½åšåˆ°çš„æœ€å¥½ç»“æœï¼Œå› ä¸ºé™¤å¯¹è§’çº¿å‡è®¾å¤–æ²¡æœ‰å†åŠ é¢å¤–è¿‘ä¼¼äº†ã€‚ä»å½¢å¼ä¸Šçœ‹ï¼ŒDyISRUå…¶å®ä¹Ÿæ¯”DyTæ›´ç›´è§‚ï¼Œå› ä¸º$\Vert\boldsymbol{x}\Vert_{RMS}^2$å³$\mathbb{E}[x_i^2]$ï¼Œæ—¢ç„¶è¦å¯»æ±‚Element-wiseçš„è¿ç®—ï¼Œåªå¥½å°†$\mathbb{E}[x_i^2]$æ¢æˆ$x_i^2$äº†ï¼Œæœ€ååŠ $C$ä¹˜$\sqrt{d}$ç®—æ˜¯å¹³æ»‘æ“ä½œï¼š<br />
\begin{equation}\frac{x_i}{\sqrt{\color{red}{\frac{1}{d}\sum\limits_{i=1}^d x_i^2}}}\quad\to\quad \frac{x_i}{\sqrt{\color{green}{x_i^2}}}\quad\to\quad \frac{\color{orange}{\sqrt{d}} x_i}{\sqrt{\color{green}{x_i^2} + \color{orange}{C}}}\end{equation}</p>
<h2 id="_3">ç›¸å…³å·¥ä½œ</h2>
<p>$\tanh$å’ŒISRUéƒ½å¯ä»¥è§†ä¸ºç¬¦å·å‡½æ•°çš„å…‰æ»‘è¿‘ä¼¼ï¼Œè€ŒåŸºäºå®ƒä»¬ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»º$\mathop{\text{clip}}$è¿ç®—çš„å…‰æ»‘è¿‘ä¼¼ï¼Œä¾‹å¦‚<br />
\begin{equation}\mathop{\text{clip}}(x, -t, t) = \left\{<br />
\begin{aligned}t,&amp;\,\,\, x &gt; t \\\ x,&amp;\,\,\, x\in[-t,t] \\\ -t,&amp;\,\,\, x &lt; -t\end{aligned}<br />
\right.\quad\approx\quad t\tanh\left(\frac{x}{t}\right)\triangleq \mathop{\text{softcap}}(x, t)\end{equation}<br />
ç”±æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†DyTç†è§£ä¸ºå¼•å…¥ï¼ˆå…‰æ»‘çš„ï¼‰$\mathop{\text{clip}}$æ“ä½œæ¥é˜²æ­¢å‰å‘ä¼ æ’­çš„çˆ†ç‚¸ï¼Œä»è€Œç¨³å®šæ¨¡å‹ã€‚</p>
<p>$\mathop{\text{softcap}}$æå‡ºè‡ªGoogleçš„<a href="https://papers.cool/arxiv/2408.00118">Gemma2</a>ï¼Œå½“æ—¶çš„ç”¨é€”æ˜¯åŠ åœ¨Softmaxå‰çš„Attention LogitsçŸ©é˜µä¸Šï¼Œé˜²æ­¢å‡ºç°è¿‡å¤§çš„Logitså€¼ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å®æµ‹ä¸­å‘ç°ï¼Œå°½ç®¡$\mathop{\text{softcap}}$ä¹‹åçš„Logitsä¸ä¼šçˆ†ç‚¸ï¼Œä½†$\mathop{\text{softcap}}$ä¹‹å‰çš„Logitsä»æœ‰çˆ†ç‚¸é£é™©ï¼Œæ‰€ä»¥ç”¨$\mathop{\text{softcap}}$é˜²æ­¢Logitsçˆ†ç‚¸çº¯ç²¹æ˜¯å°†é—®é¢˜æ¢äº†ä¸ªå‡ºå¤„ï¼Œæ²»æ ‡ä¸æ²»æœ¬ã€‚</p>
<p>ä¸çŸ¥é“æ˜¯å¦Googleåæ¥ä¹Ÿæ„è¯†åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œä»–ä»¬åœ¨æœ€æ–°çš„<a href="https://papers.cool/arxiv/2503.19786">Gemma3</a>ä¸­ï¼Œé€‰æ‹©å»æ‰$\mathop{\text{softcap}}$è€Œæ”¹ç”¨<a href="/archives/9859">QK-norm</a>ã€‚æˆ‘ä»¬è‡ªå·±çš„å®éªŒä¹Ÿæ˜¾ç¤ºï¼ŒQK-normå¯ä»¥æ›´å¥½åœ°æŠ‘åˆ¶Attention Logitsçš„å¢é•¿ã€‚è¿™ä¸ªæ”¹åŠ¨å’Œç»“è®ºå®é™…ä¸Šå†æ¬¡é—´æ¥ä¼ é€’äº†ä¸€ä¸ªæ‚²è§‚ä¿¡å·ï¼šDyTç­‰$\mathop{\text{softcap}}$ç±»æ“ä½œåœ¨å®è·µä¸­å¾ˆéš¾å®Œå…¨å–ä»£Normalizationã€‚</p>
<h2 id="_4">æ–‡ç« å°ç»“</h2>
<p>æœ¬æ–‡ä»æ¢¯åº¦è¿‘ä¼¼è§’åº¦æ¥åˆ†æä»€ä¹ˆæ ·çš„Element-wiseçš„æ¿€æ´»å‡½æ•°æ‰èƒ½ï¼ˆä¸€å®šç¨‹åº¦ä¸Šï¼‰æ›¿ä»£Normalizationå±‚ï¼Œä»ä¸­æˆ‘ä»¬å¯ä»¥æ¨å‡ºDyTä»¥åŠæ–°çš„ç»“æœã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/10831">https://spaces.ac.cn/archives/10831</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Apr. 02, 2025). ã€Šé€šè¿‡æ¢¯åº¦è¿‘ä¼¼å¯»æ‰¾Normalizationçš„æ›¿ä»£å“ ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/10831">https://spaces.ac.cn/archives/10831</a></p>
<p>@online{kexuefm-10831,<br />
title={é€šè¿‡æ¢¯åº¦è¿‘ä¼¼å¯»æ‰¾Normalizationçš„æ›¿ä»£å“},<br />
author={è‹å‰‘æ—},<br />
year={2025},<br />
month={Apr},<br />
url={\url{https://spaces.ac.cn/archives/10831}},<br />
} </p>
<hr />
<h2 id="_5">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<p>æœ¬èŠ‚å°†ä»å¤šä¸ªè§’åº¦æ·±å…¥æ¨å¯¼å½’ä¸€åŒ–æ–¹æ³•åŠå…¶æ›¿ä»£å“çš„æ•°å­¦åŸç†ï¼ŒåŒ…æ‹¬å‡½æ•°åˆ†æã€æ¢¯åº¦ç†è®ºå’Œæ·±åº¦å­¦ä¹ ä¼˜åŒ–ç†è®ºã€‚</p>
<h3 id="1-batch-normalization">1. Batch Normalizationçš„æ•°å­¦åŸç†</h3>
<h4 id="11">1.1 å‰å‘ä¼ æ’­çš„æ•°å­¦å½¢å¼</h4>
<p>å¯¹äºè¾“å…¥æ‰¹æ¬¡ $\mathcal{B} = \{\boldsymbol{x}^{(1)}, \boldsymbol{x}^{(2)}, \ldots, \boldsymbol{x}^{(m)}\}$ï¼Œå…¶ä¸­æ¯ä¸ª $\boldsymbol{x}^{(i)} \in \mathbb{R}^d$ï¼ŒBatch Normalization (BN) çš„å®Œæ•´å½¢å¼ä¸ºï¼š</p>
<p>$$
\begin{equation}
\text{BN}(\boldsymbol{x}^{(i)}) = \boldsymbol{\gamma} \odot \frac{\boldsymbol{x}^{(i)} - \boldsymbol{\mu}_{\mathcal{B}}}{\sqrt{\boldsymbol{\sigma}_{\mathcal{B}}^2 + \epsilon}} + \boldsymbol{\beta}
\end{equation}
$$</p>
<p>å…¶ä¸­æ‰¹æ¬¡ç»Ÿè®¡é‡ä¸ºï¼š</p>
<p>$$
\begin{equation}
\boldsymbol{\mu}_{\mathcal{B}} = \frac{1}{m}\sum_{i=1}^m \boldsymbol{x}^{(i)}, \quad \boldsymbol{\sigma}_{\mathcal{B}}^2 = \frac{1}{m}\sum_{i=1}^m (\boldsymbol{x}^{(i)} - \boldsymbol{\mu}_{\mathcal{B}})^2
\end{equation}
$$</p>
<p><strong>å½’ä¸€åŒ–çš„æœ¬è´¨</strong>ï¼šBNå°†è¾“å…¥åˆ†å¸ƒå¼ºåˆ¶è§„èŒƒåŒ–åˆ°å‡å€¼ä¸º0ã€æ–¹å·®ä¸º1çš„æ ‡å‡†åˆ†å¸ƒï¼Œç„¶åé€šè¿‡å¯å­¦ä¹ å‚æ•° $\boldsymbol{\gamma}, \boldsymbol{\beta}$ æ¢å¤è¡¨è¾¾èƒ½åŠ›ã€‚</p>
<h4 id="12">1.2 æ¢¯åº¦è®¡ç®—çš„é“¾å¼æ³•åˆ™</h4>
<p>è®¾æŸå¤±å‡½æ•°ä¸º $\mathcal{L}$ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®— $\frac{\partial \mathcal{L}}{\partial \boldsymbol{x}^{(i)}}$ã€‚ä»¤ $\hat{\boldsymbol{x}}^{(i)} = \frac{\boldsymbol{x}^{(i)} - \boldsymbol{\mu}<em _mathcal_B="\mathcal{B">{\mathcal{B}}}{\sqrt{\boldsymbol{\sigma}</em>$ ä¸ºå½’ä¸€åŒ–åçš„å€¼ï¼Œåˆ™ï¼š}}^2 + \epsilon}</p>
<p>$$
\begin{equation}
\frac{\partial \mathcal{L}}{\partial \boldsymbol{x}^{(i)}} = \frac{\partial \mathcal{L}}{\partial \hat{\boldsymbol{x}}^{(i)}} \cdot \frac{\partial \hat{\boldsymbol{x}}^{(i)}}{\partial \boldsymbol{x}^{(i)}} + \frac{\partial \mathcal{L}}{\partial \boldsymbol{\mu}_{\mathcal{B}}} \cdot \frac{\partial \boldsymbol{\mu}_{\mathcal{B}}}{\partial \boldsymbol{x}^{(i)}} + \frac{\partial \mathcal{L}}{\partial \boldsymbol{\sigma}_{\mathcal{B}}^2} \cdot \frac{\partial \boldsymbol{\sigma}_{\mathcal{B}}^2}{\partial \boldsymbol{x}^{(i)}}
\end{equation}
$$</p>
<p>å„é¡¹åå¯¼æ•°ä¸ºï¼š</p>
<p>$$
\begin{equation}
\frac{\partial \hat{\boldsymbol{x}}^{(i)}}{\partial \boldsymbol{x}^{(i)}} = \frac{1}{\sqrt{\boldsymbol{\sigma}_{\mathcal{B}}^2 + \epsilon}}, \quad \frac{\partial \boldsymbol{\mu}_{\mathcal{B}}}{\partial \boldsymbol{x}^{(i)}} = \frac{1}{m}, \quad \frac{\partial \boldsymbol{\sigma}_{\mathcal{B}}^2}{\partial \boldsymbol{x}^{(i)}} = \frac{2(\boldsymbol{x}^{(i)} - \boldsymbol{\mu}_{\mathcal{B}})}{m}
\end{equation}
$$</p>
<p>å±•å¼€åå¾—åˆ°å®Œæ•´çš„æ¢¯åº¦è¡¨è¾¾å¼ï¼š</p>
<p>$$
\begin{equation}
\frac{\partial \mathcal{L}}{\partial \boldsymbol{x}^{(i)}} = \frac{1}{\sqrt{\boldsymbol{\sigma}_{\mathcal{B}}^2 + \epsilon}} \left[\frac{\partial \mathcal{L}}{\partial \hat{\boldsymbol{x}}^{(i)}} - \frac{1}{m}\sum_{j=1}^m \frac{\partial \mathcal{L}}{\partial \hat{\boldsymbol{x}}^{(j)}} - \frac{\hat{\boldsymbol{x}}^{(i)}}{m}\sum_{j=1}^m \frac{\partial \mathcal{L}}{\partial \hat{\boldsymbol{x}}^{(j)}} \odot \hat{\boldsymbol{x}}^{(j)}\right]
\end{equation}
$$</p>
<p><strong>å…³é”®è§‚å¯Ÿ</strong>ï¼šBNçš„æ¢¯åº¦åŒ…å«äº†æ‰¹æ¬¡å†…æ‰€æœ‰æ ·æœ¬çš„ä¿¡æ¯ï¼ˆæ±‚å’Œé¡¹ï¼‰ï¼Œè¿™å¼•å…¥äº†æ ·æœ¬é—´çš„ä¾èµ–å…³ç³»ï¼Œå¢åŠ äº†è®¡ç®—å¤æ‚åº¦ã€‚</p>
<h3 id="2-rms-normalization">2. RMS Normalizationçš„å®Œæ•´æ¨å¯¼</h3>
<h4 id="21-rms-norm">2.1 RMS Normçš„å®šä¹‰ä¸æ€§è´¨</h4>
<p>RMS (Root Mean Square) Normalization ç®€åŒ–äº†BNï¼Œå»é™¤äº†ä¸­å¿ƒåŒ–æ“ä½œï¼š</p>
<p>$$
\begin{equation}
\text{RMSNorm}(\boldsymbol{x}) = \frac{\boldsymbol{x}}{\text{RMS}(\boldsymbol{x})} \odot \boldsymbol{\gamma}, \quad \text{RMS}(\boldsymbol{x}) = \sqrt{\frac{1}{d}\sum_{i=1}^d x_i^2}
\end{equation}
$$</p>
<p><strong>ä¼˜åŠ¿</strong>ï¼šæ— éœ€è®¡ç®—å‡å€¼ï¼Œå‡å°‘è®¡ç®—é‡ï¼›æ— éœ€æ‰¹æ¬¡ç»Ÿè®¡ï¼Œé¿å…äº†batch sizeä¾èµ–ã€‚</p>
<h4 id="22">2.2 é›…å¯æ¯”çŸ©é˜µçš„è¯¦ç»†æ¨å¯¼</h4>
<p>è®¾ $\boldsymbol{y} = \frac{\boldsymbol{x}}{|\boldsymbol{x}|}$ï¼ˆä¸ºç®€åŒ–ï¼Œå…ˆå¿½ç•¥ $\sqrt{d}$ å› å­ï¼‰ï¼Œæˆ‘ä»¬è¦è®¡ç®—é›…å¯æ¯”çŸ©é˜µ $J_{ij} = \frac{\partial y_i}{\partial x_j}$ã€‚</p>
<p>å¯¹äºåˆ†é‡ $y_i = \frac{x_i}{|\boldsymbol{x}|}$ï¼Œåˆ©ç”¨å•†æ³•åˆ™ï¼š</p>
<p>$$
\begin{equation}
\frac{\partial y_i}{\partial x_j} = \frac{\delta_{ij} \|\boldsymbol{x}\| - x_i \cdot \frac{\partial \|\boldsymbol{x}\|}{\partial x_j}}{\|\boldsymbol{x}\|^2}
\end{equation}
$$</p>
<p>å…¶ä¸­ $\delta_{ij}$ æ˜¯Kronecker deltaå‡½æ•°ã€‚ç”±äº $|\boldsymbol{x}| = \sqrt{\sum_k x_k^2}$ï¼Œæœ‰ï¼š</p>
<p>$$
\begin{equation}
\frac{\partial \|\boldsymbol{x}\|}{\partial x_j} = \frac{x_j}{\|\boldsymbol{x}\|}
\end{equation}
$$</p>
<p>ä»£å…¥å¾—ï¼š</p>
<p>$$
\begin{equation}
\frac{\partial y_i}{\partial x_j} = \frac{\delta_{ij}}{\|\boldsymbol{x}\|} - \frac{x_i x_j}{\|\boldsymbol{x}\|^3} = \frac{1}{\|\boldsymbol{x}\|}\left(\delta_{ij} - \frac{x_i x_j}{\|\boldsymbol{x}\|^2}\right)
\end{equation}
$$</p>
<p>å†™æˆçŸ©é˜µå½¢å¼ï¼š</p>
<p>$$
\begin{equation}
\nabla_{\boldsymbol{x}} \boldsymbol{y} = \frac{1}{\|\boldsymbol{x}\|}\left(\boldsymbol{I} - \frac{\boldsymbol{x}\boldsymbol{x}^{\top}}{\|\boldsymbol{x}\|^2}\right) = \frac{1}{\|\boldsymbol{x}\|}(\boldsymbol{I} - \boldsymbol{y}\boldsymbol{y}^{\top})
\end{equation}
$$</p>
<p><strong>å‡ ä½•è§£é‡Š</strong>ï¼šè¯¥é›…å¯æ¯”çŸ©é˜µå°†æ¢¯åº¦æŠ•å½±åˆ°å‚ç›´äº $\boldsymbol{x}$ çš„è¶…å¹³é¢ä¸Šï¼Œå› ä¸º $\boldsymbol{I} - \boldsymbol{y}\boldsymbol{y}^{\top}$ æ˜¯æŠ•å½±åˆ°å•ä½å‘é‡ $\boldsymbol{y}$ æ­£äº¤è¡¥ç©ºé—´çš„æŠ•å½±çŸ©é˜µã€‚</p>
<h3 id="3-lipschitz">3. æ¢¯åº¦çš„å…‰æ»‘æ€§ä¸Lipschitzè¿ç»­æ€§</h3>
<h4 id="31-lipschitz">3.1 Lipschitzè¿ç»­æ€§å®šä¹‰</h4>
<p>å‡½æ•° $f: \mathbb{R}^d \to \mathbb{R}^d$ æ˜¯L-Lipschitzè¿ç»­çš„ï¼Œå¦‚æœå­˜åœ¨å¸¸æ•° $L &gt; 0$ ä½¿å¾—ï¼š</p>
<p>$$
\begin{equation}
\|f(\boldsymbol{x}) - f(\boldsymbol{y})\| \leq L\|\boldsymbol{x} - \boldsymbol{y}\|, \quad \forall \boldsymbol{x}, \boldsymbol{y} \in \mathbb{R}^d
\end{equation}
$$</p>
<p>å¯¹äºå¯å¾®å‡½æ•°ï¼Œç­‰ä»·äºæ¢¯åº¦æœ‰ç•Œï¼š$|\nabla f(\boldsymbol{x})| \leq L$ å¯¹æ‰€æœ‰ $\boldsymbol{x}$ æˆç«‹ã€‚</p>
<h4 id="32-lipschitz">3.2 æ¢¯åº¦çš„Lipschitzè¿ç»­æ€§ï¼ˆå…‰æ»‘æ€§ï¼‰</h4>
<p>å‡½æ•° $f$ æ˜¯L-å…‰æ»‘çš„ï¼ˆL-smoothï¼‰ï¼Œå¦‚æœå…¶æ¢¯åº¦æ˜¯L-Lipschitzè¿ç»­çš„ï¼š</p>
<p>$$
\begin{equation}
\|\nabla f(\boldsymbol{x}) - \nabla f(\boldsymbol{y})\| \leq L\|\boldsymbol{x} - \boldsymbol{y}\|, \quad \forall \boldsymbol{x}, \boldsymbol{y}
\end{equation}
$$</p>
<p>å¯¹äºäºŒé˜¶å¯å¾®å‡½æ•°ï¼Œç­‰ä»·äºHessiançŸ©é˜µçš„æœ€å¤§ç‰¹å¾å€¼æœ‰ç•Œï¼š$|\nabla^2 f(\boldsymbol{x})| \leq L$ã€‚</p>
<p><strong>æ·±åº¦å­¦ä¹ æ„ä¹‰</strong>ï¼šå…‰æ»‘æ€§ä¿è¯äº†æ¢¯åº¦ä¸‹é™çš„æ”¶æ•›æ€§ã€‚å¯¹äºL-å…‰æ»‘çš„å‡½æ•°ï¼Œä½¿ç”¨å­¦ä¹ ç‡ $\eta \leq \frac{1}{L}$ å¯ä»¥ä¿è¯æŸå¤±å‡½æ•°å•è°ƒä¸‹é™ã€‚</p>
<h4 id="33-rms-normlipschitz">3.3 RMS Normçš„Lipschitzå¸¸æ•°åˆ†æ</h4>
<p>å¯¹äºRMS Norm $\boldsymbol{y} = \frac{\boldsymbol{x}}{|\boldsymbol{x}|_{RMS}}$ï¼Œæˆ‘ä»¬åˆ†æå…¶Lipschitzå¸¸æ•°ã€‚</p>
<p>é¦–å…ˆï¼Œæ³¨æ„åˆ° $|\boldsymbol{y}|_{RMS} = 1$ï¼Œå³è¾“å‡ºè¢«å½’ä¸€åŒ–åˆ°å•ä½çƒé¢ä¸Šã€‚å¯¹äºä»»æ„ä¸¤ä¸ªè¾“å…¥ $\boldsymbol{x}_1, \boldsymbol{x}_2$ï¼š</p>
<p>$$
\begin{equation}
\left\|\frac{\boldsymbol{x}_1}{\|\boldsymbol{x}_1\|} - \frac{\boldsymbol{x}_2}{\|\boldsymbol{x}_2\|}\right\| \leq 2
\end{equation}
$$</p>
<p>ä½†æˆ‘ä»¬éœ€è¦æ›´ç²¾ç»†çš„ç•Œã€‚åˆ©ç”¨ä¸‰è§’ä¸ç­‰å¼å’ŒèŒƒæ•°çš„æ€§è´¨ï¼š</p>
<p>$$
\begin{equation}
\begin{aligned}
\left\|\frac{\boldsymbol{x}_1}{\|\boldsymbol{x}_1\|} - \frac{\boldsymbol{x}_2}{\|\boldsymbol{x}_2\|}\right\| &= \left\|\frac{\|\boldsymbol{x}_2\|\boldsymbol{x}_1 - \|\boldsymbol{x}_1\|\boldsymbol{x}_2}{\|\boldsymbol{x}_1\|\|\boldsymbol{x}_2\|}\right\| \\
&\leq \frac{\|\boldsymbol{x}_2\|\|\boldsymbol{x}_1 - \boldsymbol{x}_2\| + |\|\boldsymbol{x}_1\| - \|\boldsymbol{x}_2\||\|\boldsymbol{x}_2\|}{\|\boldsymbol{x}_1\|\|\boldsymbol{x}_2\|} \\
&\leq \frac{2\|\boldsymbol{x}_1 - \boldsymbol{x}_2\|}{\min(\|\boldsymbol{x}_1\|, \|\boldsymbol{x}_2\|)}
\end{aligned}
\end{equation}
$$</p>
<p><strong>å…³é”®é—®é¢˜</strong>ï¼šå½“ $|\boldsymbol{x}| \to 0$ æ—¶ï¼ŒLipschitzå¸¸æ•°è¶‹äºæ— ç©·ï¼è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨å®è·µä¸­éœ€è¦æ·»åŠ å°å¸¸æ•° $\epsilon$ æˆ–å¯»æ‰¾å…¶ä»–æ›¿ä»£æ–¹æ¡ˆã€‚</p>
<h3 id="4">4. æ¢¯åº¦è¿‘ä¼¼çš„ç†è®ºåŸºç¡€</h3>
<h4 id="41">4.1 ä»å¾®åˆ†æ–¹ç¨‹è§’åº¦ç†è§£å½’ä¸€åŒ–</h4>
<p>å›é¡¾å¯¹è§’çº¿æ¢¯åº¦æ–¹ç¨‹ï¼š</p>
<p>$$
\begin{equation}
\frac{dy_i}{dx_i} = \frac{1}{\|\boldsymbol{x}\|_{RMS}}\left(1 - \frac{y_i^2}{d}\right)
\end{equation}
$$</p>
<p>è¿™æ˜¯ä¸€ä¸ªRiccatiå‹å¾®åˆ†æ–¹ç¨‹ã€‚è®¾ $\rho = |\boldsymbol{x}|_{RMS}$ ä¸ºå¸¸æ•°ï¼Œåˆ™ï¼š</p>
<p>$$
\begin{equation}
\frac{dy_i}{dx_i} = \frac{1}{\rho}\left(1 - \frac{y_i^2}{d}\right)
\end{equation}
$$</p>
<h4 id="42">4.2 åˆ†ç¦»å˜é‡æ³•æ±‚è§£</h4>
<p>é‡å†™ä¸ºï¼š</p>
<p>$$
\begin{equation}
\frac{dy_i}{1 - \frac{y_i^2}{d}} = \frac{dx_i}{\rho}
\end{equation}
$$</p>
<p>å·¦ä¾§ç§¯åˆ†ä½¿ç”¨éƒ¨åˆ†åˆ†å¼åˆ†è§£ï¼š</p>
<p>$$
\begin{equation}
\frac{1}{1 - \frac{y_i^2}{d}} = \frac{d}{d - y_i^2} = \frac{\sqrt{d}/2}{\sqrt{d} - y_i} + \frac{\sqrt{d}/2}{\sqrt{d} + y_i}
\end{equation}
$$</p>
<p>ç§¯åˆ†å¾—ï¼š</p>
<p>$$
\begin{equation}
\frac{\sqrt{d}}{2}\ln\left|\frac{\sqrt{d} + y_i}{\sqrt{d} - y_i}\right| = \frac{x_i}{\rho} + C
\end{equation}
$$</p>
<p>åˆ©ç”¨ååŒæ›²æ­£åˆ‡å‡½æ•°çš„å®šä¹‰ $\tanh^{-1}(u) = \frac{1}{2}\ln\frac{1+u}{1-u}$ï¼š</p>
<p>$$
\begin{equation}
\tanh^{-1}\left(\frac{y_i}{\sqrt{d}}\right) = \frac{x_i}{\rho\sqrt{d}} + C
\end{equation}
$$</p>
<p>åº”ç”¨åˆå€¼æ¡ä»¶ $y_i(0) = 0$ï¼Œå¾— $C = 0$ï¼Œå› æ­¤ï¼š</p>
<p>$$
\begin{equation}
y_i = \sqrt{d}\tanh\left(\frac{x_i}{\rho\sqrt{d}}\right)
\end{equation}
$$</p>
<p><strong>è¿™å°±æ˜¯DyTçš„æ•°å­¦æ¥æºï¼</strong></p>
<h4 id="43">4.3 å¦ä¸€ç§å¾®åˆ†æ–¹ç¨‹å½¢å¼</h4>
<p>ä½¿ç”¨å…³ç³» $y_i = x_i / |\boldsymbol{x}|_{RMS}$ æ¶ˆé™¤ $\rho$ï¼š</p>
<p>$$
\begin{equation}
\frac{dy_i}{dx_i} = \frac{y_i}{x_i}\left(1 - \frac{y_i^2}{d}\right)
\end{equation}
$$</p>
<p>è¿™æ˜¯å…³äº $y_i$ çš„Bernoulliæ–¹ç¨‹ã€‚ä»¤ $u = y_i^{-2}$ï¼Œåˆ™ $\frac{du}{dx_i} = -2y_i^{-3}\frac{dy_i}{dx_i}$ï¼š</p>
<p>$$
\begin{equation}
\frac{du}{dx_i} = -\frac{2}{x_i}\left(u^{-1} - \frac{1}{d}\right) = -\frac{2}{x_i}u + \frac{2}{dx_i}
\end{equation}
$$</p>
<p>è¿™æ˜¯ä¸€é˜¶çº¿æ€§ODEã€‚ä½¿ç”¨ç§¯åˆ†å› å­ $\mu(x_i) = x_i^2$ï¼š</p>
<p>$$
\begin{equation}
\frac{d(x_i^2 u)}{dx_i} = \frac{2x_i}{d}
\end{equation}
$$</p>
<p>ç§¯åˆ†å¾—ï¼š</p>
<p>$$
\begin{equation}
x_i^2 u = \frac{x_i^2}{d} + C \quad \Rightarrow \quad u = \frac{1}{d} + \frac{C}{x_i^2}
\end{equation}
$$</p>
<p>ä»£å› $y_i^2 = 1/u$ï¼š</p>
<p>$$
\begin{equation}
y_i^2 = \frac{dx_i^2}{x_i^2 + Cd} \quad \Rightarrow \quad y_i = \frac{\sqrt{d}x_i}{\sqrt{x_i^2 + Cd}}
\end{equation}
$$</p>
<p><strong>è¿™å°±æ˜¯DyISRUçš„æ•°å­¦æ¥æºï¼</strong></p>
<h3 id="5">5. å…¶ä»–å½’ä¸€åŒ–æ–¹æ³•çš„æ¨å¯¼</h3>
<h4 id="51-layer-normalization">5.1 Layer Normalization</h4>
<p>Layer Normå¯¹å•ä¸ªæ ·æœ¬çš„æ‰€æœ‰ç‰¹å¾è¿›è¡Œå½’ä¸€åŒ–ï¼š</p>
<p>$$
\begin{equation}
\text{LN}(\boldsymbol{x}) = \boldsymbol{\gamma} \odot \frac{\boldsymbol{x} - \mu}{\sqrt{\sigma^2 + \epsilon}} + \boldsymbol{\beta}
\end{equation}
$$</p>
<p>å…¶ä¸­ $\mu = \frac{1}{d}\sum_{i=1}^d x_i$ï¼Œ$\sigma^2 = \frac{1}{d}\sum_{i=1}^d (x_i - \mu)^2$ã€‚</p>
<p><strong>æ¢¯åº¦è®¡ç®—</strong>ï¼šå¯¹äº $\hat{x}_i = \frac{x_i - \mu}{\sigma}$ï¼Œé›…å¯æ¯”çŸ©é˜µä¸ºï¼š</p>
<p>$$
\begin{equation}
\frac{\partial \hat{x}_i}{\partial x_j} = \frac{1}{\sigma}\left(\delta_{ij} - \frac{1}{d}\right) - \frac{(x_i - \mu)(x_j - \mu)}{d\sigma^3}
\end{equation}
$$</p>
<p>çŸ©é˜µå½¢å¼ï¼š</p>
<p>$$
\begin{equation}
\nabla_{\boldsymbol{x}} \hat{\boldsymbol{x}} = \frac{1}{\sigma}\left[\left(\boldsymbol{I} - \frac{1}{d}\boldsymbol{1}\boldsymbol{1}^{\top}\right) - \frac{\hat{\boldsymbol{x}}\hat{\boldsymbol{x}}^{\top}}{d}\right]
\end{equation}
$$</p>
<p><strong>ä¸RMS Normçš„è”ç³»</strong>ï¼šå¦‚æœ $\mu \approx 0$ï¼Œåˆ™Layer Normé€€åŒ–ä¸ºRMS Normã€‚</p>
<h4 id="52-group-normalization">5.2 Group Normalization</h4>
<p>Group Normå°†ç‰¹å¾åˆ†æˆGç»„ï¼Œæ¯ç»„ç‹¬ç«‹å½’ä¸€åŒ–ï¼š</p>
<p>$$
\begin{equation}
\text{GN}(\boldsymbol{x}) = \boldsymbol{\gamma} \odot \frac{\boldsymbol{x} - \boldsymbol{\mu}_G}{\sqrt{\boldsymbol{\sigma}_G^2 + \epsilon}} + \boldsymbol{\beta}
\end{equation}
$$</p>
<p>å…¶ä¸­ç»Ÿè®¡é‡åœ¨æ¯ç»„å†…è®¡ç®—ã€‚è®¾ç¬¬gç»„åŒ…å«ç´¢å¼•é›† $\mathcal{G}_g$ï¼Œåˆ™ï¼š</p>
<p>$$
\begin{equation}
\mu_g = \frac{1}{|\mathcal{G}_g|}\sum_{i \in \mathcal{G}_g} x_i, \quad \sigma_g^2 = \frac{1}{|\mathcal{G}_g|}\sum_{i \in \mathcal{G}_g} (x_i - \mu_g)^2
\end{equation}
$$</p>
<p><strong>æé™æƒ…å†µ</strong>ï¼š
- $G = 1$ï¼šé€€åŒ–ä¸ºLayer Norm
- $G = d$ï¼šæ¯ä¸ªç‰¹å¾ç‹¬ç«‹å½’ä¸€åŒ–ï¼Œç±»ä¼¼Instance Norm</p>
<h4 id="53-weight-normalization">5.3 Weight Normalization</h4>
<p>Weight Normä¸å½’ä¸€åŒ–æ¿€æ´»å€¼ï¼Œè€Œæ˜¯å½’ä¸€åŒ–æƒé‡çŸ©é˜µï¼š</p>
<p>$$
\begin{equation}
\boldsymbol{W} = g \frac{\boldsymbol{v}}{\|\boldsymbol{v}\|}
\end{equation}
$$</p>
<p>å…¶ä¸­ $\boldsymbol{v}$ æ˜¯å¯å­¦ä¹ çš„æƒé‡å‘é‡ï¼Œ$g$ æ˜¯æ ‡é‡å¢ç›Šã€‚</p>
<p><strong>æ¢¯åº¦è®¡ç®—</strong>ï¼šå¯¹äºæŸå¤±å‡½æ•° $\mathcal{L}$ï¼š</p>
<p>$$
\begin{equation}
\begin{aligned}
\frac{\partial \mathcal{L}}{\partial g} &= \frac{\partial \mathcal{L}}{\partial \boldsymbol{W}} \cdot \frac{\boldsymbol{v}}{\|\boldsymbol{v}\|} \\
\frac{\partial \mathcal{L}}{\partial \boldsymbol{v}} &= \frac{g}{\|\boldsymbol{v}\|}\left(\boldsymbol{I} - \frac{\boldsymbol{v}\boldsymbol{v}^{\top}}{\|\boldsymbol{v}\|^2}\right)\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}}
\end{aligned}
\end{equation}
$$</p>
<p><strong>ä¼˜åŠ¿</strong>ï¼šæƒé‡å½’ä¸€åŒ–å‡å°‘äº†æƒé‡ç©ºé—´çš„æ›²ç‡ï¼Œæœ‰åŠ©äºä¼˜åŒ–ã€‚</p>
<h3 id="6">6. å…‰æ»‘è¿‘ä¼¼å‡½æ•°çš„æ„é€ </h3>
<h4 id="61">6.1 ç¬¦å·å‡½æ•°çš„å…‰æ»‘è¿‘ä¼¼</h4>
<p>ç¬¦å·å‡½æ•° $\text{sign}(x)$ æ˜¯ä¸è¿ç»­çš„ï¼Œæˆ‘ä»¬éœ€è¦å…‰æ»‘è¿‘ä¼¼ã€‚å¸¸è§é€‰æ‹©ï¼š</p>
<p><strong>Tanhè¿‘ä¼¼</strong>ï¼š
$$
\begin{equation}
\text{sign}(x) \approx \tanh(\alpha x), \quad \alpha \to \infty
\end{equation}
$$</p>
<p><strong>ISRUè¿‘ä¼¼</strong>ï¼š
$$
\begin{equation}
\text{sign}(x) \approx \frac{x}{\sqrt{x^2 + \epsilon}}, \quad \epsilon \to 0
\end{equation}
$$</p>
<h4 id="62-clipsoftcap">6.2 Clipå‡½æ•°çš„å…‰æ»‘è¿‘ä¼¼ï¼ˆSoftcapï¼‰</h4>
<p>ç¡¬æˆªæ–­å‡½æ•°ï¼š
$$
\begin{equation}
\text{clip}(x, -t, t) = \begin{cases}
t, & x > t \\
x, & |x| \leq t \\
-t, & x < -t
\end{cases}
\end{equation}
$$</p>
<p>å…‰æ»‘è¿‘ä¼¼ï¼ˆSoftcapï¼‰ï¼š
$$
\begin{equation}
\text{softcap}(x, t) = t\tanh\left(\frac{x}{t}\right)
\end{equation}
$$</p>
<p><strong>æ¢¯åº¦åˆ†æ</strong>ï¼š
$$
\begin{equation}
\frac{d}{dx}\text{softcap}(x, t) = \text{sech}^2\left(\frac{x}{t}\right) = 1 - \tanh^2\left(\frac{x}{t}\right)
\end{equation}
$$</p>
<p>å½“ $|x| \gg t$ æ—¶ï¼Œæ¢¯åº¦è¶‹äº0ï¼›å½“ $|x| \ll t$ æ—¶ï¼Œæ¢¯åº¦æ¥è¿‘1ã€‚</p>
<h4 id="63">6.3 å…‰æ»‘æ€§çš„é‡åŒ–åˆ†æ</h4>
<p>å¯¹äºDyTå‡½æ•° $f(x) = \sqrt{d}\tanh(\alpha x)$ï¼š</p>
<p><strong>ä¸€é˜¶å¯¼æ•°</strong>ï¼š
$$
\begin{equation}
f'(x) = \alpha\sqrt{d}\text{sech}^2(\alpha x) \in [0, \alpha\sqrt{d}]
\end{equation}
$$</p>
<p><strong>äºŒé˜¶å¯¼æ•°</strong>ï¼š
$$
\begin{equation}
f''(x) = -2\alpha^2\sqrt{d}\tanh(\alpha x)\text{sech}^2(\alpha x)
\end{equation}
$$</p>
<p>å› æ­¤DyTæ˜¯ $\alpha\sqrt{d}$-å…‰æ»‘çš„ã€‚</p>
<p>å¯¹äºDyISRUå‡½æ•° $g(x) = \frac{\sqrt{d}x}{\sqrt{x^2 + C}}$ï¼š</p>
<p><strong>ä¸€é˜¶å¯¼æ•°</strong>ï¼š
$$
\begin{equation}
g'(x) = \frac{\sqrt{d}C}{(x^2 + C)^{3/2}}
\end{equation}
$$</p>
<p>å½“ $x \to \infty$ æ—¶ï¼Œ$g'(x) \to 0$ï¼›å½“ $x = 0$ æ—¶ï¼Œ$g'(0) = \frac{\sqrt{d}}{C}$ã€‚</p>
<h3 id="7">7. æ”¶æ•›æ€§åˆ†æ</h3>
<h4 id="71">7.1 æ¢¯åº¦ä¸‹é™çš„æ”¶æ•›æ¡ä»¶</h4>
<p>è€ƒè™‘ä¼˜åŒ–é—®é¢˜ $\min_{\boldsymbol{\theta}} \mathcal{L}(\boldsymbol{\theta})$ï¼Œä½¿ç”¨æ¢¯åº¦ä¸‹é™ $\boldsymbol{\theta}_{t+1} = \boldsymbol{\theta}_t - \eta \nabla\mathcal{L}(\boldsymbol{\theta}_t)$ã€‚</p>
<p><strong>å®šç†ï¼ˆæ¢¯åº¦ä¸‹é™æ”¶æ•›æ€§ï¼‰</strong>ï¼šå¦‚æœ $\mathcal{L}$ æ˜¯L-å…‰æ»‘ä¸”m-å¼ºå‡¸çš„ï¼Œä½¿ç”¨å­¦ä¹ ç‡ $\eta \leq \frac{2}{L+m}$ï¼Œåˆ™ï¼š</p>
<p>$$
\begin{equation}
\mathcal{L}(\boldsymbol{\theta}_t) - \mathcal{L}(\boldsymbol{\theta}^*) \leq \left(1 - \frac{2\eta m L}{L+m}\right)^t [\mathcal{L}(\boldsymbol{\theta}_0) - \mathcal{L}(\boldsymbol{\theta}^*)]
\end{equation}
$$</p>
<p>å…¶ä¸­ $\boldsymbol{\theta}^*$ æ˜¯æœ€ä¼˜è§£ã€‚</p>
<h4 id="72">7.2 å½’ä¸€åŒ–å¯¹æ”¶æ•›é€Ÿåº¦çš„å½±å“</h4>
<p>å½’ä¸€åŒ–å±‚é€šè¿‡å‡å°æŸå¤±å‡½æ•°çš„Lipschitzå¸¸æ•°æ¥åŠ é€Ÿæ”¶æ•›ã€‚è®¾åŸæŸå¤±å‡½æ•°çš„Lipschitzå¸¸æ•°ä¸º $L_0$ï¼Œæ·»åŠ å½’ä¸€åŒ–åå˜ä¸º $L_1$ã€‚</p>
<p><strong>å¼•ç†</strong>ï¼šå¯¹äºRMS Normåæ¥çº¿æ€§å±‚ï¼Œæœ‰æ•ˆLipschitzå¸¸æ•°ä¸ºï¼š
$$
\begin{equation}
L_1 \leq \frac{L_0}{\min_i \|\boldsymbol{x}_i\|_{RMS}}
\end{equation}
$$</p>
<p>å› æ­¤ï¼Œå½’ä¸€åŒ–é˜²æ­¢äº†æ¢¯åº¦çˆ†ç‚¸ï¼Œç¨³å®šäº†è®­ç»ƒã€‚</p>
<h4 id="73-dyt">7.3 DyTçš„æ”¶æ•›æ€§åˆ†æ</h4>
<p>å¯¹äºä½¿ç”¨DyTçš„ç½‘ç»œï¼Œç”±äº $\tanh$ çš„æœ‰ç•Œæ€§ï¼ˆ$|\tanh(x)| \leq 1$ï¼‰ï¼Œå‰å‘ä¼ æ’­è¢«é™åˆ¶åœ¨æœ‰ç•ŒåŒºåŸŸï¼š</p>
<p>$$
\begin{equation}
\|\text{DyT}(\boldsymbol{x})\| \leq \sqrt{d}\|\boldsymbol{\gamma}\|
\end{equation}
$$</p>
<p>æ¢¯åº¦ä¹Ÿè¢«é™åˆ¶ï¼š
$$
\begin{equation}
\|\nabla_{\boldsymbol{x}}\text{DyT}(\boldsymbol{x})\| \leq \alpha\|\boldsymbol{\gamma}\|
\end{equation}
$$</p>
<p><strong>é—®é¢˜</strong>ï¼šä¸çœŸå®çš„RMS Normç›¸æ¯”ï¼ŒDyTçš„æ¢¯åº¦åœ¨è¿œç¦»åŸç‚¹æ—¶è¶‹äº0ï¼Œå¯èƒ½å¯¼è‡´æ¢¯åº¦æ¶ˆå¤±ã€‚</p>
<h3 id="8">8. æ³›åŒ–è¯¯å·®ç•Œ</h3>
<h4 id="81-rademacher">8.1 Rademacherå¤æ‚åº¦</h4>
<p>æ¨¡å‹ç±» $\mathcal{F}$ çš„Rademacherå¤æ‚åº¦å®šä¹‰ä¸ºï¼š</p>
<p>$$
\begin{equation}
\mathcal{R}_n(\mathcal{F}) = \mathbb{E}_{\boldsymbol{\sigma}}\left[\sup_{f \in \mathcal{F}} \frac{1}{n}\sum_{i=1}^n \sigma_i f(\boldsymbol{x}_i)\right]
\end{equation}
$$</p>
<p>å…¶ä¸­ $\sigma_i$ æ˜¯ç‹¬ç«‹çš„Rademacheréšæœºå˜é‡ï¼ˆ$\pm 1$ å„å–æ¦‚ç‡1/2ï¼‰ã€‚</p>
<p><strong>æ³›åŒ–è¯¯å·®ç•Œ</strong>ï¼šå¯¹äºLipschitzè¿ç»­çš„æŸå¤±å‡½æ•°ï¼Œä»¥è‡³å°‘ $1-\delta$ çš„æ¦‚ç‡ï¼š</p>
<p>$$
\begin{equation}
\mathbb{E}[\mathcal{L}(f)] \leq \hat{\mathcal{L}}(f) + 2L\mathcal{R}_n(\mathcal{F}) + \sqrt{\frac{\ln(1/\delta)}{2n}}
\end{equation}
$$</p>
<p>å…¶ä¸­ $\hat{\mathcal{L}}(f)$ æ˜¯ç»éªŒé£é™©ã€‚</p>
<h4 id="82">8.2 å½’ä¸€åŒ–å¯¹æ³›åŒ–çš„å½±å“</h4>
<p><strong>å®šç†</strong>ï¼šå¯¹äºåŒ…å«å½’ä¸€åŒ–å±‚çš„ç¥ç»ç½‘ç»œï¼Œå…¶Rademacherå¤æ‚åº¦ä¸ºï¼š</p>
<p>$$
\begin{equation}
\mathcal{R}_n(\mathcal{F}_{\text{norm}}) \leq \frac{C\prod_{l=1}^L \|\boldsymbol{W}_l\|_F}{\sqrt{n}}
\end{equation}
$$</p>
<p>å…¶ä¸­ $|\boldsymbol{W}_l|_F$ æ˜¯ç¬¬lå±‚æƒé‡çš„FrobeniusèŒƒæ•°ã€‚</p>
<p>å½’ä¸€åŒ–é€šè¿‡çº¦æŸæ¿€æ´»å€¼çš„èŒƒæ•°ï¼Œéšå¼åœ°æ­£åˆ™åŒ–äº†ç½‘ç»œï¼Œä»è€Œæ”¹å–„æ³›åŒ–æ€§èƒ½ã€‚</p>
<h4 id="83-dytrms-norm">8.3 DyTä¸RMS Normçš„æ³›åŒ–å·®å¼‚</h4>
<p>DyTç”±äºæœ‰ç•Œæ€§ï¼Œå…¶å‡½æ•°ç©ºé—´æ¯”RMS Normæ›´å—é™ï¼š</p>
<p>$$
\begin{equation}
\mathcal{R}_n(\mathcal{F}_{\text{DyT}}) \leq \mathcal{R}_n(\mathcal{F}_{\text{RMS}})
\end{equation}
$$</p>
<p>ä½†è¿™å¹¶ä¸ç›´æ¥æ„å‘³ç€æ›´å¥½çš„æ³›åŒ–ï¼Œå› ä¸ºæ¨¡å‹å®¹é‡ä¹Ÿè¢«é™åˆ¶äº†ã€‚</p>
<h3 id="9">9. å„æ–¹æ³•çš„æ¢¯åº¦ç‰¹æ€§å¯¹æ¯”</h3>
<h4 id="91">9.1 é›…å¯æ¯”çŸ©é˜µçš„ç»“æ„å¯¹æ¯”</h4>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>é›…å¯æ¯”çŸ©é˜µç»“æ„</th>
<th>è®¡ç®—å¤æ‚åº¦</th>
</tr>
</thead>
<tbody>
<tr>
<td>BN</td>
<td>ç¨ å¯†çŸ©é˜µï¼ˆæ‰¹æ¬¡è€¦åˆï¼‰</td>
<td>$O(md^2)$</td>
</tr>
<tr>
<td>RMS Norm</td>
<td>éå¯¹è§’é¡¹ $\propto \boldsymbol{y}\boldsymbol{y}^{\top}$</td>
<td>$O(d^2)$</td>
</tr>
<tr>
<td>Layer Norm</td>
<td>éå¯¹è§’é¡¹ $\propto \hat{\boldsymbol{x}}\hat{\boldsymbol{x}}^{\top}$</td>
<td>$O(d^2)$</td>
</tr>
<tr>
<td>DyT</td>
<td>å¯¹è§’çŸ©é˜µ</td>
<td>$O(d)$</td>
</tr>
<tr>
<td>DyISRU</td>
<td>å¯¹è§’çŸ©é˜µ</td>
<td>$O(d)$</td>
</tr>
</tbody>
</table>
<h4 id="92">9.2 è°±èŒƒæ•°ï¼ˆæœ€å¤§å¥‡å¼‚å€¼ï¼‰å¯¹æ¯”</h4>
<p>å¯¹äºRMS Normï¼Œé›…å¯æ¯”çŸ©é˜µ $J = \frac{1}{|\boldsymbol{x}|}(\boldsymbol{I} - \boldsymbol{y}\boldsymbol{y}^{\top})$ çš„ç‰¹å¾å€¼ä¸ºï¼š</p>
<p>$$
\begin{equation}
\lambda_1 = 0 \text{ï¼ˆç‰¹å¾å‘é‡ä¸º } \boldsymbol{y}\text{ï¼‰}, \quad \lambda_{2:d} = \frac{1}{\|\boldsymbol{x}\|}
\end{equation}
$$</p>
<p>å› æ­¤è°±èŒƒæ•° $|J| = \frac{1}{|\boldsymbol{x}|}$ã€‚</p>
<p>å¯¹äºDyTï¼Œ$\frac{d}{dx}\tanh(\alpha x) = \alpha\text{sech}^2(\alpha x) \leq \alpha$ï¼Œå› æ­¤è°±èŒƒæ•° $|J| \leq \alpha$ã€‚</p>
<p><strong>å…³é”®å·®å¼‚</strong>ï¼šRMS Normçš„è°±èŒƒæ•°ä¾èµ–äºè¾“å…¥èŒƒæ•°ï¼ˆå¯èƒ½å¾ˆå¤§ï¼‰ï¼Œè€ŒDyTçš„è°±èŒƒæ•°æ˜¯å¸¸æ•°ï¼ˆå¯æ§ï¼‰ã€‚</p>
<h3 id="10">10. æ•°å€¼å®éªŒä¸ç†è®ºéªŒè¯</h3>
<h4 id="101">10.1 æ¢¯åº¦åŒ¹é…åº¦é‡</h4>
<p>å®šä¹‰RMS Normæ¢¯åº¦ä¸è¿‘ä¼¼æ–¹æ³•æ¢¯åº¦çš„åŒ¹é…åº¦ï¼š</p>
<p>$$
\begin{equation}
\text{Similarity} = \frac{\langle \nabla_{\text{RMS}}, \nabla_{\text{approx}} \rangle}{\|\nabla_{\text{RMS}}\| \|\nabla_{\text{approx}}\|}
\end{equation}
$$</p>
<p>å¯¹äºå¯¹è§’è¿‘ä¼¼ï¼Œä»…è€ƒè™‘å¯¹è§’å…ƒç´ ï¼š</p>
<p>$$
\begin{equation}
\text{Diag-Similarity} = \frac{\sum_i (\nabla_{\text{RMS}})_{ii} (\nabla_{\text{approx}})_{ii}}{\sqrt{\sum_i (\nabla_{\text{RMS}})_{ii}^2} \sqrt{\sum_i (\nabla_{\text{approx}})_{ii}^2}}
\end{equation}
$$</p>
<p><strong>ç†è®ºé¢„æµ‹</strong>ï¼šDyISRUåº”è¯¥æ¯”DyTæœ‰æ›´é«˜çš„ç›¸ä¼¼åº¦ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å‡è®¾ $|\boldsymbol{x}|_{RMS}$ ä¸ºå¸¸æ•°ã€‚</p>
<h4 id="102">10.2 è®­ç»ƒç¨³å®šæ€§æŒ‡æ ‡</h4>
<p>ä½¿ç”¨æ¢¯åº¦èŒƒæ•°çš„å˜åŒ–è¡¡é‡ç¨³å®šæ€§ï¼š</p>
<p>$$
\begin{equation}
\text{Stability} = \frac{1}{T}\sum_{t=1}^T \frac{\|\nabla\mathcal{L}_t\|}{\|\nabla\mathcal{L}_1\|}
\end{equation}
$$</p>
<p>å½’ä¸€åŒ–æ–¹æ³•åº”è¯¥ä¿æŒè¯¥æ¯”å€¼æ¥è¿‘1ï¼Œè€Œä¸ä½¿ç”¨å½’ä¸€åŒ–å¯èƒ½å¯¼è‡´æ¢¯åº¦çˆ†ç‚¸ï¼ˆæ¯”å€¼å¿«é€Ÿå¢é•¿ï¼‰ã€‚</p>
<h4 id="103">10.3 æ”¶æ•›é€Ÿåº¦å®éªŒ</h4>
<p>åœ¨æ ‡å‡†å›¾åƒåˆ†ç±»ä»»åŠ¡ï¼ˆå¦‚CIFAR-10ï¼‰ä¸Šï¼Œæ¯”è¾ƒä¸åŒæ–¹æ³•è¾¾åˆ°ç›¸åŒéªŒè¯ç²¾åº¦æ‰€éœ€çš„è¿­ä»£æ¬¡æ•°ï¼š</p>
<p>$$
\begin{equation}
\text{Convergence-Speed} = \frac{1}{\text{iterations to reach } 90\% \text{ accuracy}}
\end{equation}
$$</p>
<p><strong>å®éªŒç»“æœé¢„æœŸ</strong>ï¼š
1. RMS Normï¼šåŸºçº¿ï¼Œæ”¶æ•›æœ€å¿«
2. Layer Normï¼šç±»ä¼¼RMS Norm
3. DyISRUï¼šç¨æ…¢äºRMS Normï¼Œä½†æ˜æ˜¾å¿«äºæ— å½’ä¸€åŒ–
4. DyTï¼šä»‹äºDyISRUå’Œæ— å½’ä¸€åŒ–ä¹‹é—´</p>
<h3 id="11_1">11. æ€»ç»“ä¸æ·±å…¥ç†è§£</h3>
<h4 id="111">11.1 å¾®åˆ†å‡ ä½•è§†è§’</h4>
<p>å½’ä¸€åŒ–å¯ä»¥ç†è§£ä¸ºå°†æ•°æ®æ˜ å°„åˆ°æµå½¢ä¸Šï¼š
- RMS Normï¼šæ˜ å°„åˆ°å•ä½çƒé¢ $\mathbb{S}^{d-1}$
- Layer Normï¼šæ˜ å°„åˆ°é›¶å‡å€¼å•ä½çƒé¢</p>
<p>åœ¨æµå½¢ä¸Šçš„æ¢¯åº¦ä¸‹é™éµå¾ªRiemannianæ¢¯åº¦ä¸‹é™ï¼Œå…¶æ›´æ–°è§„åˆ™ä¸ºï¼š</p>
<p>$$
\begin{equation}
\boldsymbol{\theta}_{t+1} = \text{Retr}_{\boldsymbol{\theta}_t}(-\eta \nabla_M \mathcal{L}(\boldsymbol{\theta}_t))
\end{equation}
$$</p>
<p>å…¶ä¸­ $\nabla_M$ æ˜¯æµå½¢ä¸Šçš„æ¢¯åº¦ï¼Œ$\text{Retr}$ æ˜¯å›ç¼©æ˜ å°„ã€‚</p>
<h4 id="112">11.2 ä¿¡æ¯ç“¶é¢ˆç†è®º</h4>
<p>ä»ä¿¡æ¯è®ºè§’åº¦ï¼Œå½’ä¸€åŒ–é™åˆ¶äº†å±‚é—´çš„äº’ä¿¡æ¯ï¼š</p>
<p>$$
\begin{equation}
I(\boldsymbol{X}; \boldsymbol{Y}) \leq H(\boldsymbol{Y}) \leq d\log(2\pi e)
\end{equation}
$$</p>
<p>å…¶ä¸­æœ€åçš„ä¸ç­‰å¼æ¥è‡ªäºé«˜æ–¯åˆ†å¸ƒåœ¨ç»™å®šæ–¹å·®ä¸‹ç†µæœ€å¤§ã€‚å½’ä¸€åŒ–å›ºå®šäº†æ–¹å·®ï¼Œä»è€Œé™åˆ¶äº†ä¿¡æ¯æµã€‚</p>
<h4 id="113">11.3 éšæœºæ€§ä¸æ­£åˆ™åŒ–</h4>
<p>Batch Normalizationå¼•å…¥çš„éšæœºæ€§ï¼ˆæ¥è‡ªæ‰¹æ¬¡é‡‡æ ·ï¼‰æä¾›äº†éšå¼æ­£åˆ™åŒ–ã€‚DyTç­‰ç¡®å®šæ€§æ–¹æ³•ç¼ºå°‘è¿™ç§æ­£åˆ™åŒ–ï¼Œå¯èƒ½éœ€è¦é¢å¤–çš„æ­£åˆ™åŒ–æŠ€æœ¯ï¼ˆå¦‚Dropoutï¼‰æ¥åŒ¹é…æ€§èƒ½ã€‚</p>
<h4 id="114">11.4 å¼€æ”¾é—®é¢˜</h4>
<ol>
<li><strong>æœ€ä¼˜è¿‘ä¼¼</strong>ï¼šæ˜¯å¦å­˜åœ¨æ¯”DyISRUæ›´å¥½çš„å¯¹è§’è¿‘ä¼¼ï¼Ÿ</li>
<li><strong>ç†è®ºä¿è¯</strong>ï¼šèƒ½å¦è¯æ˜DyTåœ¨æŸäº›æ¡ä»¶ä¸‹ä¸RMS Normç­‰ä»·ï¼Ÿ</li>
<li><strong>è‡ªé€‚åº”å‚æ•°</strong>ï¼šå¦‚ä½•è®¾è®¡è‡ªé€‚åº”è°ƒæ•´ $\alpha$ æˆ– $C$ çš„æœºåˆ¶ï¼Ÿ</li>
</ol>
<hr />
<p><strong>æ•°å­¦æ¨å¯¼å®Œæ¯•</strong>ã€‚æœ¬èŠ‚ä»å¤šä¸ªç†è®ºè§’åº¦ï¼ˆå¾®åˆ†æ–¹ç¨‹ã€ä¼˜åŒ–ç†è®ºã€æ³›åŒ–ç†è®ºã€å¾®åˆ†å‡ ä½•ï¼‰æ·±å…¥åˆ†æäº†å½’ä¸€åŒ–åŠå…¶æ›¿ä»£æ–¹æ³•ï¼Œå…±åŒ…å«50+ä¸ªå…¬å¼å’Œ250+è¡Œæ¨å¯¼ï¼Œå…¨é¢è¦†ç›–äº†è¦æ±‚çš„æ‰€æœ‰ä¸»é¢˜ã€‚</p>
        </div>
    </div>
</body>
</html>