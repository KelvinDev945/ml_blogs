<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯­è¨€æ¨¡å‹è¾“å‡ºç«¯å…±äº«Embeddingçš„é‡æ–°æ¢ç´¢</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>è¯­è¨€æ¨¡å‹è¾“å‡ºç«¯å…±äº«Embeddingçš„é‡æ–°æ¢ç´¢</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-26 | ğŸ“„ å¤§å°: 37.7 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/9698">https://spaces.ac.cn/archives/9698</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>é¢„è®­ç»ƒåˆšå…´èµ·æ—¶ï¼Œåœ¨è¯­è¨€æ¨¡å‹çš„è¾“å‡ºç«¯é‡ç”¨Embeddingæƒé‡æ˜¯å¾ˆå¸¸è§çš„æ“ä½œï¼Œæ¯”å¦‚BERTã€ç¬¬ä¸€ç‰ˆçš„T5ã€æ—©æœŸçš„GPTï¼Œéƒ½ä½¿ç”¨äº†è¿™ä¸ªæ“ä½œï¼Œè¿™æ˜¯å› ä¸ºå½“æ¨¡å‹ä¸»å¹²éƒ¨åˆ†ä¸å¤§ä¸”è¯è¡¨å¾ˆå¤§æ—¶ï¼ŒEmbeddingå±‚çš„å‚æ•°é‡å¾ˆå¯è§‚ï¼Œå¦‚æœè¾“å‡ºç«¯å†æ–°å¢ä¸€ä¸ªç‹¬ç«‹çš„åŒæ ·å¤§å°çš„æƒé‡çŸ©é˜µçš„è¯ï¼Œä¼šå¯¼è‡´æ˜¾å­˜æ¶ˆè€—çš„æ¿€å¢ã€‚ä¸è¿‡éšç€æ¨¡å‹å‚æ•°è§„æ¨¡çš„å¢å¤§ï¼ŒEmbeddingå±‚çš„å æ¯”ç›¸å¯¹å˜å°äº†ï¼ŒåŠ ä¹‹<a href="https://papers.cool/arxiv/2010.12821">ã€ŠRethinking embedding coupling in pre-trained language modelsã€‹</a>ç­‰ç ”ç©¶è¡¨æ˜å…±äº«Embeddingå¯èƒ½ä¼šæœ‰äº›è´Ÿé¢å½±å“ï¼Œæ‰€ä»¥ç°åœ¨å…±äº«Embeddingçš„åšæ³•å·²ç»è¶Šæ¥è¶Šå°‘äº†ã€‚</p>
<p>æœ¬æ–‡æ—¨åœ¨åˆ†æåœ¨å…±äº«Embeddingæƒé‡æ—¶å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼Œå¹¶æ¢ç´¢å¦‚ä½•æ›´æœ‰æ•ˆåœ°è¿›è¡Œåˆå§‹åŒ–å’Œå‚æ•°åŒ–ã€‚å°½ç®¡å…±äº«Embeddingçœ‹èµ·æ¥å·²ç»â€œè¿‡æ—¶â€ï¼Œä½†è¿™ä¾ç„¶ä¸å¤±ä¸ºä¸€é“æœ‰è¶£çš„ç ”ç©¶é¢˜ç›®ã€‚</p>
<h2 id="_1">å…±äº«æƒé‡</h2>
<p>åœ¨è¯­è¨€æ¨¡å‹çš„è¾“å‡ºç«¯é‡ç”¨Embeddingæƒé‡çš„åšæ³•ï¼Œè‹±æ–‡ç§°ä¹‹ä¸ºâ€œTied Embeddingsâ€æˆ–è€…â€œCoupled Embeddingsâ€ï¼Œå…¶æ€æƒ³ä¸»è¦æ˜¯EmbeddingçŸ©é˜µè·Ÿè¾“å‡ºç«¯è½¬æ¢åˆ°logitsçš„æŠ•å½±çŸ©é˜µå¤§å°æ˜¯ç›¸åŒçš„ï¼ˆåªå·®ä¸ªè½¬ç½®ï¼‰ï¼Œå¹¶ä¸”ç”±äºè¿™ä¸ªå‚æ•°çŸ©é˜µæ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥ä¸ºäº†é¿å…ä¸å¿…è¦çš„æµªè´¹ï¼Œå¹²è„†å…±ç”¨åŒä¸€ä¸ªæƒé‡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š  </p>
<p><a href="/usr/uploads/2023/07/505779550.png" title="ç‚¹å‡»æŸ¥çœ‹åŸå›¾"><img alt="å…±äº«Embeddingæƒé‡çš„Transformerç¤ºæ„å›¾" src="/usr/uploads/2023/07/505779550.png" /></a></p>
<p>å…±äº«Embeddingæƒé‡çš„Transformerç¤ºæ„å›¾</p>
<p>å…±äº«Embeddingæœ€ç›´æ¥çš„åæœå¯èƒ½æ˜¯â€”â€”å®ƒä¼šå¯¼è‡´é¢„è®­ç»ƒçš„åˆå§‹æŸå¤±éå¸¸å¤§ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨ç±»ä¼¼<a href="/archives/8978">DeepNorm</a>çš„æŠ€æœ¯æ¥é™ä½è®­ç»ƒéš¾åº¦ï¼Œå®ƒä»¬éƒ½æ˜¯å°†æ¨¡å‹çš„æ®‹å·®åˆ†æ”¯åˆå§‹åŒ–å¾—æ¥è¿‘äºé›¶ã€‚æ¢è¨€ä¹‹ï¼Œæ¨¡å‹åœ¨åˆå§‹é˜¶æ®µè¿‘ä¼¼äºä¸€ä¸ªæ’ç­‰å‡½æ•°ï¼Œè¿™ä½¿å¾—åˆå§‹æ¨¡å‹ç›¸å½“äºå…±äº«Embeddingçš„2-gramæ¨¡å‹ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†æ¨å¯¼è¿™æ ·çš„2-gramæ¨¡å‹æŸå¤±å¤§çš„åŸå› ï¼Œä»¥åŠåˆ†æä¸€äº›è§£å†³æ–¹æ¡ˆã€‚</p>
<h2 id="_2">å‡†å¤‡å·¥ä½œ</h2>
<p>åœ¨æ­£å¼å¼€å§‹æ¨å¯¼ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å‡†å¤‡ä¸€äº›åŸºç¡€ç»“è®ºã€‚</p>
<p>é¦–å…ˆï¼Œè¦æ˜ç¡®çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸»è¦å¯¹åˆå§‹é˜¶æ®µçš„ç»“æœè¿›è¡Œåˆ†æï¼Œæ­¤æ—¶çš„æƒé‡éƒ½æ˜¯ä»æŸä¸ªâ€œå‡å€¼ä¸º0ã€æ–¹å·®ä¸º$\sigma^2$â€çš„åˆ†å¸ƒä¸­ <em>ç‹¬ç«‹åŒåˆ†å¸ƒ</em> åœ°é‡‡æ ·å‡ºæ¥çš„ï¼Œè¿™å…è®¸æˆ‘ä»¬é€šè¿‡æœŸæœ›æ¥ä¼°è®¡æŸäº›æ±‚å’Œç»“æœã€‚æ¯”å¦‚å¯¹äº$\boldsymbol{w}=(w_1,w_2,\cdots,w_d)$ï¼Œæˆ‘ä»¬æœ‰<br />
\begin{equation}\mathbb{E}\left[\Vert \boldsymbol{w}\Vert^2\right] = \mathbb{E}\left[\sum_i w_i^2\right] = \sum_i \mathbb{E}\left[w_i^2\right] = d\sigma^2\label{eq:norm}\end{equation}<br />
å› æ­¤å¯ä»¥å–$\Vert \boldsymbol{w}\Vert\approx \sqrt{d}\sigma$ã€‚é‚£ä¹ˆè¯¯å·®æœ‰å¤šå¤§å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒçš„æ–¹å·®æ¥æ„ŸçŸ¥ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å…ˆæ±‚å®ƒçš„äºŒé˜¶çŸ©ï¼š<br />
\begin{equation}\begin{aligned}\mathbb{E}\left[\Vert \boldsymbol{w}\Vert^4\right] =&amp;\, \mathbb{E}\left[\left(\sum_i w_i^2\right)^2\right] = \mathbb{E}\left[\sum_i w_i^4 + \sum_{i,j|i\neq j} w_i^2 w_j^2\right] \\\<br />
=&amp;\, \sum_i \mathbb{E}\left[w_i^4\right] + \sum_{i,j|i\neq j} \mathbb{E}\left[w_i^2\right] \mathbb{E}\left[w_j^2\right] \\\<br />
=&amp;\, d\,\mathbb{E}\left[w^4\right] + d(d-1) \sigma^4 \\\<br />
\end{aligned}\end{equation}<br />
å¦‚æœé‡‡æ ·åˆ†å¸ƒæ˜¯æ­£æ€åˆ†å¸ƒï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥ç®—å‡º$\mathbb{E}\left[w^4\right]=3\sigma^4$ï¼Œæ‰€ä»¥<br />
\begin{equation}\mathbb{V}ar\left[\Vert \boldsymbol{w}\Vert^2\right] = \mathbb{E}\left[\Vert \boldsymbol{w}\Vert^4\right] - \mathbb{E}\left[\Vert \boldsymbol{w}\Vert^2\right]^2 = 2d\sigma^4\end{equation}<br />
è¿™ä¸ªæ–¹å·®å¤§å°ä¹Ÿä»£è¡¨ç€$\Vert \boldsymbol{w}\Vert\approx \sqrt{d}\sigma$çš„è¿‘ä¼¼ç¨‹åº¦ï¼Œä¹Ÿå°±æ˜¯è¯´åŸæœ¬çš„é‡‡æ ·æ–¹å·®$\sigma^2$è¶Šå°ï¼Œé‚£ä¹ˆè¿‘ä¼¼ç¨‹åº¦è¶Šé«˜ã€‚ç‰¹åˆ«åœ°ï¼Œå¸¸è§çš„é‡‡æ ·æ–¹å·®æ˜¯$1/d$ï¼ˆå¯¹åº”$\Vert \boldsymbol{w}\Vert\approx 1$ï¼Œå³å•ä½å‘é‡ï¼‰ï¼Œé‚£ä¹ˆä»£å…¥ä¸Šå¼å¾—åˆ°$2/d$ï¼Œæ„å‘³ç€ç»´åº¦è¶Šé«˜è¿‘ä¼¼ç¨‹åº¦è¶Šé«˜ã€‚æ­¤å¤–ï¼Œå¦‚æœé‡‡æ ·åˆ†å¸ƒä¸æ˜¯æ­£æ€åˆ†å¸ƒï¼Œå¯ä»¥å¦å¤–é‡æ–°è®¡ç®—$\mathbb{E}\left[w^4\right]$ï¼Œæˆ–è€…ç›´æ¥å°†æ­£æ€åˆ†å¸ƒçš„ç»“æœä½œä¸ºå‚è€ƒç»“æœï¼Œåæ­£éƒ½åªæ˜¯ä¸€ä¸ªä¼°ç®—ç½¢äº†ã€‚</p>
<p>å¦‚æœ$\boldsymbol{v}=(v_1,v_2,\cdots,v_d)$æ˜¯å¦ä¸€ä¸ªç‹¬ç«‹åŒåˆ†å¸ƒå‘é‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•ä¼°è®¡å†…ç§¯ï¼Œç»“æœæ˜¯<br />
\begin{equation}\mathbb{E}\left[\boldsymbol{w}\cdot\boldsymbol{v}\right] = \mathbb{E}\left[\sum_i w_i v_i\right] = \sum_i \mathbb{E}\left[w_i\right] \mathbb{E}\left[v_i\right] = 0\label{eq:dot}\end{equation}<br />
ä»¥åŠ<br />
\begin{equation}\begin{aligned}\mathbb{E}\left[(\boldsymbol{w}\cdot\boldsymbol{v})^2\right] =&amp;\, \mathbb{E}\left[\left(\sum_i w_i v_i\right)^2\right] = \mathbb{E}\left[\sum_i w_i^2 v_i^2 + \sum_{i,j|i\neq j} w_i v_i w_j v_j\right] \\\<br />
=&amp;\, \sum_i \mathbb{E}\left[w_i^2\right]\mathbb{E}\left[w_j^2\right] + \sum_{i,j|i\neq j} \mathbb{E}\left[w_i\right]\mathbb{E}\left[v_i\right]\mathbb{E}\left[w_j\right]\mathbb{E}\left[v_j\right] \\\<br />
=&amp;\, d \sigma^4 \\\<br />
\end{aligned}\end{equation}<br />
åŒæ ·åœ°ï¼Œå–$\sigma^2=1/d$çš„è¯ï¼Œé‚£ä¹ˆæ–¹å·®æ˜¯$1/d^3$ï¼Œç»´åº¦è¶Šé«˜è¿‘ä¼¼ç¨‹åº¦è¶Šé«˜ã€‚ä»¥ä¸Šä¸¤ä¸ªç»“æœå¯ä»¥è¯´æ˜¯<a href="/archives/7076">ã€Šnç»´ç©ºé—´ä¸‹ä¸¤ä¸ªéšæœºå‘é‡çš„å¤¹è§’åˆ†å¸ƒã€‹</a>ã€<a href="/archives/8679">ã€Šè®©äººæƒŠå¹çš„Johnson-Lindenstrausså¼•ç†ï¼šç†è®ºç¯‡ã€‹</a>ä¸­çš„ç»“è®ºçš„ç»Ÿè®¡ç‰ˆæœ¬ã€‚</p>
<h2 id="_3">æŸå¤±åˆ†æ</h2>
<p>å¯¹è¯­è¨€æ¨¡å‹æ¥è¯´ï¼Œæœ€ç»ˆè¦è¾“å‡ºä¸€ä¸ªé€tokençš„$n$å…ƒåˆ†å¸ƒï¼Œè¿™é‡Œ$n$æ˜¯è¯è¡¨å¤§å°ã€‚å‡è®¾æˆ‘ä»¬ç›´æ¥è¾“å‡ºå‡åŒ€åˆ†å¸ƒï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªtokençš„æ¦‚ç‡éƒ½æ˜¯$1/n$ï¼Œé‚£ä¹ˆä¸éš¾è®¡ç®—äº¤å‰ç†µæŸå¤±å°†ä¼šæ˜¯$\log n$ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œåˆç†çš„åˆå§‹åŒ–ä¸åº”è¯¥ä½¿å¾—åˆå§‹æŸå¤±æ˜æ˜¾è¶…è¿‡$\log n$ï¼Œå› ä¸º$\log n$ä»£è¡¨äº†æœ€æœ´ç´ çš„å‡åŒ€åˆ†å¸ƒï¼Œæ˜æ˜¾è¶…è¿‡$\log n$ç­‰ä»·äºè¯´è¿œè¿œä¸å¦‚å‡åŒ€åˆ†å¸ƒï¼Œå°±å¥½æ¯”æ˜¯æ•…æ„çŠ¯é”™ï¼Œå¹¶ä¸åˆç†ã€‚</p>
<p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆå…±äº«Embeddingä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿå‡è®¾åˆå§‹Embeddingæ˜¯$\{\boldsymbol{w}<em i="i" k_k_neq="k|k\neq">1,\boldsymbol{w}_2,\cdots,\boldsymbol{w}_n\}$ï¼Œå‰é¢å·²ç»è¯´äº†ï¼Œåˆå§‹é˜¶æ®µæ®‹å·®åˆ†æ”¯æ¥è¿‘äºé›¶ï¼Œæ‰€ä»¥è¾“å…¥è¾“å…¥token $i$ï¼Œæ¨¡å‹è¾“å‡ºå°±æ˜¯ç»è¿‡Normalizationä¹‹åçš„Embedding $\boldsymbol{w}_i$ã€‚å¸¸è§çš„Normalizationå°±æ˜¯Layer Normæˆ–è€…RMS Normï¼Œç”±äºåˆå§‹åŒ–åˆ†å¸ƒæ˜¯é›¶å‡å€¼çš„ï¼Œæ‰€ä»¥Layer Normè·ŸRMS Normå¤§è‡´ç­‰ä»·ï¼Œå› æ­¤è¾“å‡ºæ˜¯<br />
\begin{equation}\frac{\boldsymbol{w}_i}{\Vert\boldsymbol{w}_i\Vert \big/\sqrt{d}} = \frac{\boldsymbol{w}_i}{\sigma}\end{equation}<br />
æ¥ä¸‹æ¥é‡ç”¨Embeddingï¼Œå†…ç§¯ç„¶åSoftmaxï¼Œæ‰€å»ºç«‹çš„åˆ†å¸ƒå®è´¨æ˜¯<br />
\begin{equation}p(j|i) = \frac{e^{\boldsymbol{w}_i\cdot \boldsymbol{w}_j / \sigma}}{\sum\limits_k e^{\boldsymbol{w}_i\cdot \boldsymbol{w}_k / \sigma}}\end{equation}<br />
å¯¹åº”çš„æŸå¤±å‡½æ•°å°±æ˜¯<br />
\begin{equation}-\log p(j|i) = \log \sum\limits_k e^{\boldsymbol{w}_i\cdot \boldsymbol{w}_k / \sigma} - \boldsymbol{w}_i\cdot \boldsymbol{w}_j \big/ \sigma\end{equation}<br />
è¯­è¨€æ¨¡å‹ä»»åŠ¡æ˜¯ä¸ºäº†é¢„æµ‹ä¸‹ä¸€ä¸ªtokenï¼Œè€Œæˆ‘ä»¬çŸ¥é“è‡ªç„¶å¥å­ä¸­å è¯çš„æ¯”ä¾‹å¾ˆå°ï¼Œæ‰€ä»¥åŸºæœ¬ä¸Šå¯ä»¥è®¤ä¸º$j\neq i$ï¼Œé‚£ä¹ˆæ ¹æ®ç»“æœ$\eqref{eq:dot}$å°±æœ‰$\boldsymbol{w}_i\cdot \boldsymbol{w}_j\approx 0$ã€‚æ‰€ä»¥ï¼Œåˆå§‹æŸå¤±å‡½æ•°æ˜¯<br />
\begin{equation}-\log p(j|i) \approx \log \sum_k e^{\boldsymbol{w}_i\cdot \boldsymbol{w}_k / \sigma}=\log \left(e^{\boldsymbol{w}_i\cdot \boldsymbol{w}_i / \sigma} + \sum\limits</em>} e^{\boldsymbol{w}_i\cdot \boldsymbol{w}_k / \sigma}\right)\approx\log \left(e^{d \sigma} + (n-1)\right)\label{eq:loss}\end{equation<br />
åé¢çš„$\approx$å†æ¬¡ç”¨åˆ°äº†å¼$\eqref{eq:norm}$å’Œå¼$\eqref{eq:dot}$ã€‚å¸¸è§çš„åˆå§‹åŒ–æ–¹å·®$\sigma^2$ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œæˆ–è€…æ˜¯$1/d$ï¼ˆæ­¤æ—¶$e^{d \sigma}=e^{\sqrt{d}}$ï¼‰ï¼Œä¸ç®¡æ˜¯å“ªä¸€ç§ï¼Œå½“$d$è¾ƒå¤§æ—¶ï¼Œéƒ½å¯¼è‡´$e^{d \sigma}$å ä¸»å¯¼ï¼Œäºæ˜¯æŸå¤±å°†ä¼šæ˜¯$\log e^{d\sigma}=d\sigma$çº§åˆ«ï¼Œè¿™å¾ˆå®¹æ˜“å°±è¶…è¿‡äº†å‡åŒ€åˆ†å¸ƒçš„$\log n$ã€‚</p>
<h2 id="_4">ä¸€äº›å¯¹ç­–</h2>
<p>æ ¹æ®ä¸Šè¿°æ¨å¯¼ç»“æœï¼Œæˆ‘ä»¬å°±å¯ä»¥é’ˆå¯¹æ€§åœ°è®¾è®¡ä¸€äº›å¯¹ç­–äº†ã€‚æ¯”è¾ƒç›´æ¥çš„æ–¹æ¡ˆæ˜¯è°ƒæ•´åˆå§‹åŒ–ï¼Œæ ¹æ®å¼$\eqref{eq:loss}$ï¼Œæˆ‘ä»¬åªéœ€è¦è®©$e^{d\sigma}=n$ï¼Œé‚£ä¹ˆåˆå§‹æŸå¤±å°±æ˜¯å˜æˆ$\log n$çº§åˆ«çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åˆå§‹åŒ–çš„æ ‡å‡†å·®è¦æ”¹ä¸º$\sigma=(\log n)/d$ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šå¸Œæœ›å‚æ•°çš„åˆå§‹åŒ–æ–¹å·®å°½é‡å¤§ä¸€äº›ï¼Œè¿™æ ·æ¢¯åº¦ç›¸å¯¹æ¥è¯´æ²¡é‚£ä¹ˆå®¹æ˜“ä¸‹æº¢ï¼Œè€Œ$\sigma=(\log n)/d$æœ‰æ—¶å€™ä¼šæ˜¾å¾—è¿‡å°äº†ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ¢ä¸€ç§æ€è·¯ï¼šå¾ˆæ˜æ˜¾ï¼Œå¼$\eqref{eq:loss}$ä¹‹æ‰€ä»¥ä¼šåå¤§ï¼Œæ˜¯å› ä¸ºå‡ºç°äº†$e^{\boldsymbol{w}_i\cdot \boldsymbol{w}_i / \sigma}$ï¼Œç”±äºä¸¤ä¸ª$\boldsymbol{w}_i$ç›¸åŒï¼Œå®ƒä»¬å†…ç§¯å˜æˆäº†æ¨¡é•¿ï¼Œä»è€Œå˜å¾—å¾ˆå¤§ï¼Œå¦‚æœèƒ½è®©å®ƒä»¬ä¸åŒï¼Œé‚£ä¹ˆå°±ä¸ä¼šå‡ºç°è¿™ä¸€ä¸ªå ä¸»å¯¼çš„é¡¹äº†ã€‚</p>
<p>ä¸ºæ­¤ï¼Œæœ€ç®€å•çš„æ–¹æ³•è‡ªç„¶æ˜¯å¹²è„†ä¸å…±äº«Embeddingï¼Œæ­¤æ—¶æ˜¯$e^{\boldsymbol{w}_i\cdot \boldsymbol{v}_i / \sigma}$è€Œä¸æ˜¯$e^{\boldsymbol{w}_i\cdot \boldsymbol{w}_i / \sigma}$ï¼Œç”¨$\eqref{eq:dot}$è€Œä¸æ˜¯$\eqref{eq:norm}$ä½œä¸ºè¿‘ä¼¼ï¼Œäºæ˜¯å¼$\eqref{eq:loss}$æ¸è¿‘äº$\log n$ã€‚å¦‚æœè¿˜æƒ³ä¿ç•™å…±äº«Embeddingï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœ€åçš„Normalizationä¹‹åï¼Œå†æ¥ä¸€ä¸ªæ­£äº¤åˆå§‹åŒ–çš„æŠ•å½±å±‚ï¼Œè¿™æ ·$e^{\boldsymbol{w}_i\cdot \boldsymbol{w}_i / \sigma}$å˜æˆäº†$e^{(\boldsymbol{w}_i\boldsymbol{P})\cdot \boldsymbol{w}_i / \sigma}$ï¼Œæ ¹æ®<a href="/archives/8679">Johnson-Lindenstrausså¼•ç†</a>ï¼Œç»è¿‡éšæœºæŠ•å½±çš„å‘é‡è¿‘ä¼¼äºç‹¬ç«‹å‘é‡äº†ï¼Œæ‰€ä»¥ä¹Ÿè¿‘ä¼¼äºä¸å…±äº«çš„æƒ…å†µï¼Œè¿™å…¶å®å°±æ˜¯BERTçš„è§£å†³åŠæ³•ã€‚ç‰¹åˆ«åœ°ï¼Œè¿™ä¸ªæŠ•å½±å±‚è¿˜å¯ä»¥ä¸€èˆ¬åŒ–åœ°åŠ ä¸Šbiaså’Œæ¿€æ´»å‡½æ•°ã€‚</p>
<p>å¦‚æœä¸€ä¸ç‚¹é¢å¤–å‚æ•°éƒ½ä¸æƒ³å¼•å…¥ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘åœ¨Normalizationä¹‹åâ€œæ‰“ä¹±â€$\boldsymbol{w}_i$çš„å„ä¸ªç»´åº¦ï¼Œæ¯”å¦‚<br />
\begin{equation}\mathcal{S}[\boldsymbol{w}] = \boldsymbol{w}[d/2:]\circ\boldsymbol{w}[:d/2]\end{equation}<br />
è¿™é‡Œçš„$\circ$æ˜¯æ‹¼æ¥æ“ä½œï¼Œé‚£ä¹ˆ$\mathcal{S}[\boldsymbol{w}_i]$å’Œ$\boldsymbol{w}_i$ä¹Ÿæ¥è¿‘æ­£äº¤äº†ï¼Œå†…ç§¯è‡ªç„¶ä¹Ÿçº¦ç­‰äº0ã€‚è¿™ç›¸å½“äºï¼ˆåœ¨åˆå§‹é˜¶æ®µï¼‰å°†åŸæ¥çš„$n\times d$çš„EmbeddingçŸ©é˜µåŠˆå¼€ä¸ºä¸¤ä¸ª$n\times (d/2)$çš„çŸ©é˜µç„¶åæ„å»ºä¸å…±äº«Embeddingçš„2-gramæ¨¡å‹ã€‚å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è€ƒè™‘å…¶ä»–æ‰“ä¹±æ“ä½œï¼Œæ¯”å¦‚<a href="https://papers.cool/arxiv/1707.01083">ShuffleNet</a>ä¸­çš„å…ˆreshapeï¼Œç„¶åtransposeå†reshapeå›æ¥ã€‚</p>
<p>åœ¨ç¬”è€…çš„å®éªŒä¸­ï¼Œç›´æ¥æ”¹åˆå§‹åŒ–æ ‡å‡†å·®ä¸º$\sigma=(\log n)/d$æ”¶æ•›é€Ÿåº¦æ˜¯æœ€æ…¢çš„ï¼Œå…¶ä½™æ–¹æ³•æ”¶æ•›é€Ÿåº¦å·®ä¸å¤šï¼Œè‡³äºæœ€ç»ˆæ•ˆæœï¼Œæ‰€æœ‰æ–¹æ³•ä¼¼ä¹éƒ½å·®ä¸å¤šã€‚</p>
<h2 id="_5">æ–‡ç« å°ç»“</h2>
<p>æœ¬æ–‡é‡æ¸©äº†è¯­è¨€æ¨¡å‹è¾“å‡ºç«¯å…±äº«Embeddingæƒé‡çš„æ“ä½œï¼Œæ¨å¯¼äº†ç›´æ¥é‡ç”¨Embeddingæ¥æŠ•å½±è¾“å‡ºå¯èƒ½ä¼šå¯¼è‡´æŸå¤±è¿‡å¤§çš„å¯èƒ½æ€§ï¼Œå¹¶æ¢è®¨äº†ä¸€äº›è§£å†³åŠæ³•ã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/9698">https://spaces.ac.cn/archives/9698</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Jul. 20, 2023). ã€Šè¯­è¨€æ¨¡å‹è¾“å‡ºç«¯å…±äº«Embeddingçš„é‡æ–°æ¢ç´¢ ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/9698">https://spaces.ac.cn/archives/9698</a></p>
<p>@online{kexuefm-9698,<br />
title={è¯­è¨€æ¨¡å‹è¾“å‡ºç«¯å…±äº«Embeddingçš„é‡æ–°æ¢ç´¢},<br />
author={è‹å‰‘æ—},<br />
year={2023},<br />
month={Jul},<br />
url={\url{https://spaces.ac.cn/archives/9698}},<br />
} </p>
<hr />
<h2 id="_6">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<h3 id="1">1. éšæœºåˆå§‹åŒ–å‘é‡çš„ç»Ÿè®¡æ€§è´¨</h3>
<h4 id="11">1.1 å‘é‡æ¨¡é•¿çš„æœŸæœ›ä¸æ–¹å·®</h4>
<p>å¯¹äºä» $\mathcal{N}(0, \sigma^2)$ ç‹¬ç«‹åŒåˆ†å¸ƒé‡‡æ ·çš„å‘é‡ $\boldsymbol{w} = (w_1, w_2, \ldots, w_d)$ï¼š</p>
<p><strong>æ¨¡é•¿çš„å¹³æ–¹</strong>ï¼š</p>
<p>\begin{equation}
|\boldsymbol{w}|^2 = \sum_{i=1}^d w_i^2
\tag{1}
\end{equation}</p>
<p><strong>æœŸæœ›</strong>ï¼š</p>
<p>\begin{equation}
\mathbb{E}[|\boldsymbol{w}|^2] = \sum_{i=1}^d \mathbb{E}[w_i^2] = d\sigma^2
\tag{2}
\end{equation}</p>
<p><strong>æ–¹å·®çš„è®¡ç®—</strong>ï¼š</p>
<p>å¯¹äºæ­£æ€åˆ†å¸ƒï¼Œ$w_i^2 \sim \sigma^2 \chi^2(1)$ï¼Œæœ‰ $\mathbb{E}[w_i^4] = 3\sigma^4$ï¼š</p>
<p>\begin{equation}
\begin{aligned}
\mathbb{E}[|\boldsymbol{w}|^4] &amp;= \mathbb{E}\left[\left(\sum_i w_i^2\right)^2\right] \
&amp;= \sum_i \mathbb{E}[w_i^4] + \sum_{i \neq j} \mathbb{E}[w_i^2]\mathbb{E}[w_j^2] \
&amp;= d \cdot 3\sigma^4 + d(d-1)\sigma^4 \
&amp;= (d^2 + 2d)\sigma^4
\end{aligned}
\tag{3}
\end{equation}</p>
<p><strong>æ–¹å·®</strong>ï¼š</p>
<p>\begin{equation}
\text{Var}[|\boldsymbol{w}|^2] = \mathbb{E}[|\boldsymbol{w}|^4] - \mathbb{E}[|\boldsymbol{w}|^2]^2 = 2d\sigma^4
\tag{4}
\end{equation}</p>
<p><strong>æ ‡å‡†å·®</strong>ï¼š</p>
<p>\begin{equation}
\text{Std}[|\boldsymbol{w}|^2] = \sigma^2\sqrt{2d}
\tag{5}
\end{equation}</p>
<p><strong>ç›¸å¯¹æ ‡å‡†å·®</strong>ï¼š</p>
<p>\begin{equation}
\frac{\text{Std}[|\boldsymbol{w}|^2]}{\mathbb{E}[|\boldsymbol{w}|^2]} = \frac{\sigma^2\sqrt{2d}}{d\sigma^2} = \sqrt{\frac{2}{d}}
\tag{6}
\end{equation}</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>ï¼šå½“ $d$ è¾ƒå¤§æ—¶ï¼ˆå¦‚768ï¼‰ï¼Œç›¸å¯¹æ³¢åŠ¨å¾ˆå°ï¼ˆçº¦1.6%ï¼‰ï¼Œå› æ­¤å¯ä»¥ç”¨æœŸæœ›è¿‘ä¼¼ï¼š</p>
<p>\begin{equation}
|\boldsymbol{w}|^2 \approx d\sigma^2 \quad \Rightarrow \quad |\boldsymbol{w}| \approx \sigma\sqrt{d}
\tag{7}
\end{equation}</p>
<h4 id="12">1.2 å‘é‡å†…ç§¯çš„æœŸæœ›ä¸æ–¹å·®</h4>
<p>å¯¹äºä¸¤ä¸ªç‹¬ç«‹çš„éšæœºå‘é‡ $\boldsymbol{w}, \boldsymbol{v} \sim \mathcal{N}(0, \sigma^2\boldsymbol{I})$ï¼š</p>
<p><strong>å†…ç§¯çš„æœŸæœ›</strong>ï¼š</p>
<p>\begin{equation}
\mathbb{E}[\boldsymbol{w} \cdot \boldsymbol{v}] = \sum_{i=1}^d \mathbb{E}[w_i]\mathbb{E}[v_i] = 0
\tag{8}
\end{equation}</p>
<p><strong>å†…ç§¯å¹³æ–¹çš„æœŸæœ›</strong>ï¼š</p>
<p>\begin{equation}
\begin{aligned}
\mathbb{E}[(\boldsymbol{w} \cdot \boldsymbol{v})^2] &amp;= \mathbb{E}\left[\left(\sum_i w_i v_i\right)^2\right] \
&amp;= \sum_i \mathbb{E}[w_i^2 v_i^2] + \sum_{i \neq j} \mathbb{E}[w_i v_i]\mathbb{E}[w_j v_j] \
&amp;= d\sigma^4
\end{aligned}
\tag{9}
\end{equation}</p>
<p><strong>æ–¹å·®</strong>ï¼š</p>
<p>\begin{equation}
\text{Var}[\boldsymbol{w} \cdot \boldsymbol{v}] = \mathbb{E}[(\boldsymbol{w} \cdot \boldsymbol{v})^2] = d\sigma^4
\tag{10}
\end{equation}</p>
<p><strong>æ ‡å‡†å·®</strong>ï¼š</p>
<p>\begin{equation}
\text{Std}[\boldsymbol{w} \cdot \boldsymbol{v}] = \sigma^2\sqrt{d}
\tag{11}
\end{equation}</p>
<h4 id="13">1.3 è‡ªå†…ç§¯ä¸äº’å†…ç§¯çš„å¯¹æ¯”</h4>
<p><strong>è‡ªå†…ç§¯</strong>ï¼ˆåŒä¸€å‘é‡ï¼‰ï¼š</p>
<p>\begin{equation}
\boldsymbol{w} \cdot \boldsymbol{w} = |\boldsymbol{w}|^2 \approx d\sigma^2
\tag{12}
\end{equation}</p>
<p><strong>äº’å†…ç§¯</strong>ï¼ˆä¸åŒå‘é‡ï¼‰ï¼š</p>
<p>\begin{equation}
\boldsymbol{w} \cdot \boldsymbol{v} \approx 0 \quad \text{ï¼ˆæœŸæœ›ä¸º0ï¼Œæ ‡å‡†å·®ä¸º $\sigma^2\sqrt{d}$ï¼‰}
\tag{13}
\end{equation}</p>
<p><strong>æ¯”å€¼</strong>ï¼š</p>
<p>\begin{equation}
\frac{\mathbb{E}[\boldsymbol{w} \cdot \boldsymbol{w}]}{\mathbb{E}[\boldsymbol{w} \cdot \boldsymbol{v}]} = \frac{d\sigma^2}{0} \to \infty
\tag{14}
\end{equation}</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>ï¼šè‡ªå†…ç§¯æ˜¾è‘—å¤§äºäº’å†…ç§¯ï¼Œè¿™æ˜¯å…±äº«Embeddingé—®é¢˜çš„æ ¹æºã€‚</p>
<h3 id="2-embedding">2. å…±äº«Embeddingçš„åˆå§‹æŸå¤±åˆ†æ</h3>
<h4 id="21-softmax">2.1 è¯­è¨€æ¨¡å‹çš„Softmaxè¾“å‡º</h4>
<p>å‡è®¾ç»è¿‡Normalizationåçš„éšè—çŠ¶æ€ä¸º $\boldsymbol{h}_i$ï¼ŒEmbeddingçŸ©é˜µä¸º $\boldsymbol{W} = [\boldsymbol{w}_1, \boldsymbol{w}_2, \ldots, \boldsymbol{w}_n]^{\top} \in \mathbb{R}^{n \times d}$ã€‚</p>
<p>Normalizationåçš„éšè—çŠ¶æ€ï¼š</p>
<p>\begin{equation}
\boldsymbol{h}_i = \frac{\tilde{\boldsymbol{h}}_i}{|\tilde{\boldsymbol{h}}_i|} \cdot \sqrt{d}
\tag{15}
\end{equation}</p>
<p>ä½¿å¾— $|\boldsymbol{h}_i|^2 \approx d$ï¼ˆæ¯ä¸ªåˆ†é‡æ–¹å·®çº¦ä¸º1ï¼‰ã€‚</p>
<p><strong>Logitsè®¡ç®—</strong>ï¼ˆå…±äº«Embeddingï¼‰ï¼š</p>
<p>\begin{equation}
\text{logit}_j = \boldsymbol{w}_j \cdot \boldsymbol{h}_i
\tag{16}
\end{equation}</p>
<p><strong>æ¦‚ç‡åˆ†å¸ƒ</strong>ï¼š</p>
<p>\begin{equation}
p(j|i) = \frac{\exp(\boldsymbol{w}<em k="1">j \cdot \boldsymbol{h}_i / \sigma)}{\sum</em>
\tag{17}
\end{equation}}^n \exp(\boldsymbol{w}_k \cdot \boldsymbol{h}_i / \sigma)</p>
<p>å…¶ä¸­ $\sigma$ æ˜¯åˆå§‹åŒ–æ ‡å‡†å·®æˆ–æ¸©åº¦å‚æ•°ã€‚</p>
<h4 id="22">2.2 åˆå§‹é˜¶æ®µçš„è¿‘ä¼¼åˆ†æ</h4>
<p>åœ¨åˆå§‹é˜¶æ®µï¼Œæ¨¡å‹è¿‘ä¼¼æ’ç­‰å‡½æ•°ï¼ˆDeepNormç­‰æŠ€æœ¯ï¼‰ï¼Œè¾“å…¥token $i$ å¯¹åº”çš„éšè—çŠ¶æ€ï¼š</p>
<p>\begin{equation}
\boldsymbol{h}_i \approx \frac{\boldsymbol{w}_i}{|\boldsymbol{w}_i|} \cdot \sqrt{d} \approx \frac{\boldsymbol{w}_i}{\sigma\sqrt{d}} \cdot \sqrt{d} = \frac{\boldsymbol{w}_i}{\sigma}
\tag{18}
\end{equation}</p>
<p><strong>è‡ªå†…ç§¯</strong>ï¼ˆ$j = i$ï¼‰ï¼š</p>
<p>\begin{equation}
\boldsymbol{w}_i \cdot \boldsymbol{h}_i = \boldsymbol{w}_i \cdot \frac{\boldsymbol{w}_i}{\sigma} = \frac{|\boldsymbol{w}_i|^2}{\sigma} \approx \frac{d\sigma^2}{\sigma} = d\sigma
\tag{19}
\end{equation}</p>
<p><strong>äº’å†…ç§¯</strong>ï¼ˆ$j \neq i$ï¼‰ï¼š</p>
<p>\begin{equation}
\boldsymbol{w}_j \cdot \boldsymbol{h}_i = \boldsymbol{w}_j \cdot \frac{\boldsymbol{w}_i}{\sigma} \approx \frac{0}{\sigma} = 0
\tag{20}
\end{equation}</p>
<p>ï¼ˆæœŸæœ›ä¸º0ï¼Œæ ‡å‡†å·®ä¸º $\sigma\sqrt{d}$ï¼‰</p>
<h4 id="23-softmax">2.3 Softmaxåˆ†å¸ƒçš„åˆå§‹å½¢å¼</h4>
<p>å°†å¼(19)å’Œ(20)ä»£å…¥å¼(17)ï¼š</p>
<p>\begin{equation}
p(j|i) \approx \begin{cases}
\frac{\exp(d\sigma/\sigma)}{\exp(d) + (n-1)} = \frac{e^d}{e^d + n - 1}, &amp; j = i \
\frac{\exp(0)}{\exp(d) + (n-1)} = \frac{1}{e^d + n - 1}, &amp; j \neq i
\end{cases}
\tag{21}
\end{equation}</p>
<p><strong>è¿‘ä¼¼</strong>ï¼ˆå½“ $d$ è¾ƒå¤§æ—¶ï¼Œå¦‚768ï¼‰ï¼š</p>
<p>\begin{equation}
p(i|i) \approx \frac{e^d}{e^d} = 1, \quad p(j|i) \approx 0 \quad (j \neq i)
\tag{22}
\end{equation}</p>
<h4 id="24">2.4 åˆå§‹æŸå¤±çš„è®¡ç®—</h4>
<p>è¯­è¨€æ¨¡å‹çš„æŸå¤±å‡½æ•°ï¼ˆé¢„æµ‹ä¸‹ä¸€ä¸ªtokenï¼‰ï¼š</p>
<p>\begin{equation}
\mathcal{L} = -\log p(\text{target}|i)
\tag{23}
\end{equation}</p>
<p><strong>æƒ…å†µ1</strong>ï¼šå¦‚æœç›®æ ‡tokenæ°å¥½æ˜¯ $i$ï¼ˆå è¯ï¼‰ï¼š</p>
<p>\begin{equation}
\mathcal{L}_{\text{same}} = -\log p(i|i) \approx -\log 1 = 0
\tag{24}
\end{equation}</p>
<p><strong>æƒ…å†µ2</strong>ï¼šå¦‚æœç›®æ ‡tokenæ˜¯ $j \neq i$ï¼ˆå¸¸è§æƒ…å†µï¼‰ï¼š</p>
<p>\begin{equation}
\mathcal{L}_{\text{diff}} = -\log p(j|i) \approx -\log \frac{1}{e^d + n - 1} = \log(e^d + n - 1) \approx d
\tag{25}
\end{equation}</p>
<p>å¯¹äº $d = 768$ï¼š</p>
<p>\begin{equation}
\mathcal{L}_{\text{diff}} \approx 768
\tag{26}
\end{equation}</p>
<p><strong>å¯¹æ¯”å‡åŒ€åˆ†å¸ƒçš„æŸå¤±</strong>ï¼š</p>
<p>\begin{equation}
\mathcal{L}_{\text{uniform}} = \log n
\tag{27}
\end{equation}</p>
<p>å¯¹äºè¯è¡¨å¤§å° $n = 30000$ï¼š</p>
<p>\begin{equation}
\mathcal{L}_{\text{uniform}} \approx 10.3
\tag{28}
\end{equation}</p>
<p><strong>ç»“è®º</strong>ï¼š</p>
<p>\begin{equation}
\mathcal{L}<em _text_uniform="\text{uniform">{\text{diff}} \approx 768 \gg \mathcal{L}</em> \approx 10.3
\tag{29}
\end{equation}}</p>
<p>åˆå§‹æŸå¤±æ˜¯å‡åŒ€åˆ†å¸ƒçš„çº¦75å€ï¼Œè¿™æ˜¯ä¸åˆç†çš„ã€‚</p>
<h3 id="3-embedding">3. ä¸å…±äº«Embeddingçš„æƒ…å†µ</h3>
<h4 id="31">3.1 ç‹¬ç«‹åˆå§‹åŒ–</h4>
<p>å¦‚æœè¾“å…¥Embedding $\boldsymbol{W}<em out="out">{in}$ å’Œè¾“å‡ºæŠ•å½±çŸ©é˜µ $\boldsymbol{W}</em>$ ç‹¬ç«‹åˆå§‹åŒ–ï¼š</p>
<p>\begin{equation}
\boldsymbol{W}<em out="out">{in}, \boldsymbol{W}</em>)
\tag{30}
\end{equation}} \sim \mathcal{N}(0, \sigma^2\boldsymbol{I</p>
<p>éšè—çŠ¶æ€ï¼š</p>
<p>\begin{equation}
\boldsymbol{h}<em in="in">i \approx \frac{\boldsymbol{W}</em>
\tag{31}
\end{equation}}[i, :]}{\sigma</p>
<p>Logitï¼ˆå¯¹äºä»»æ„ $j$ï¼‰ï¼š</p>
<p>\begin{equation}
\text{logit}<em out="out">j = \boldsymbol{W}</em>}[j, :] \cdot \boldsymbol{h<em out="out">i \approx \boldsymbol{W}</em>
\tag{32}
\end{equation}}[j, :] \cdot \frac{\boldsymbol{W}_{in}[i, :]}{\sigma</p>
<p>ç”±äº $\boldsymbol{W}<em in="in">{out}[j, :]$ å’Œ $\boldsymbol{W}</em>[i, :]$ ç‹¬ç«‹ï¼Œæ ¹æ®å¼(8)ï¼š</p>
<p>\begin{equation}
\mathbb{E}[\text{logit}_j] = 0, \quad \text{Var}[\text{logit}_j] = d\sigma^2
\tag{33}
\end{equation}</p>
<p><strong>æ‰€æœ‰logitsåŒåˆ†å¸ƒ</strong>ï¼ˆæ— è®º $j$ æ˜¯å¦ç­‰äº $i$ï¼‰ã€‚</p>
<h4 id="32-softmax">3.2 Softmaxåˆ†å¸ƒ</h4>
<p>æ‰€æœ‰logitsè¿‘ä¼¼ä¸º $\mathcal{N}(0, d\sigma^2)$ï¼ŒSoftmaxåè¿‘ä¼¼å‡åŒ€åˆ†å¸ƒï¼š</p>
<p>\begin{equation}
p(j|i) \approx \frac{1}{n}
\tag{34}
\end{equation}</p>
<p><strong>åˆå§‹æŸå¤±</strong>ï¼š</p>
<p>\begin{equation}
\mathcal{L}_{\text{no-tie}} \approx \log n
\tag{35}
\end{equation}</p>
<p>è¿™æ˜¯åˆç†çš„åˆå§‹å€¼ã€‚</p>
<h3 id="4-1">4. è§£å†³æ–¹æ¡ˆ1ï¼šè°ƒæ•´åˆå§‹åŒ–æ ‡å‡†å·®</h3>
<h4 id="41">4.1 ç†è®ºæ¨å¯¼</h4>
<p>ä¸ºäº†è®©å…±äº«Embeddingçš„åˆå§‹æŸå¤±æ¥è¿‘ $\log n$ï¼Œéœ€è¦ï¼š</p>
<p>\begin{equation}
\log(e^d + n - 1) \approx \log n
\tag{36}
\end{equation}</p>
<p>å³ï¼š</p>
<p>\begin{equation}
e^d \approx n \quad \Rightarrow \quad d \approx \log n
\tag{37}
\end{equation}</p>
<p>ä½†è¿™é‡Œçš„ $d$ ä¸æ˜¯ç»´åº¦ï¼Œè€Œæ˜¯æŒ‡æ•°éƒ¨åˆ† $d\sigma/\sigma = d$ã€‚å›é¡¾å¼(19)ï¼š</p>
<p>\begin{equation}
\boldsymbol{w}_i \cdot \boldsymbol{h}_i \approx d\sigma
\tag{38}
\end{equation}</p>
<p>ä¸ºäº†è®© $\exp(d\sigma/\sigma) = \exp(d) \approx n$ï¼Œéœ€è¦è°ƒæ•´ä¸ºï¼š</p>
<p>\begin{equation}
d\sigma_{\text{new}} = \log n \quad \Rightarrow \quad \sigma_{\text{new}} = \frac{\log n}{d}
\tag{39}
\end{equation}</p>
<p>å¯¹äº $n = 30000$ï¼Œ$d = 768$ï¼š</p>
<p>\begin{equation}
\sigma_{\text{new}} = \frac{\log 30000}{768} \approx \frac{10.3}{768} \approx 0.0134
\tag{40}
\end{equation}</p>
<h4 id="42">4.2 ä¸æ ‡å‡†åˆå§‹åŒ–çš„å¯¹æ¯”</h4>
<p>æ ‡å‡†Xavieråˆå§‹åŒ–ï¼š</p>
<p>\begin{equation}
\sigma_{\text{xavier}} = \frac{1}{\sqrt{768}} \approx 0.0361
\tag{41}
\end{equation}</p>
<p>æ–°çš„åˆå§‹åŒ–ï¼š</p>
<p>\begin{equation}
\frac{\sigma_{\text{new}}}{\sigma_{\text{xavier}}} = \frac{0.0134}{0.0361} \approx 0.37
\tag{42}
\end{equation}</p>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ol>
<li>æ ‡å‡†å·®è¿‡å°ï¼Œå¯èƒ½å¯¼è‡´æ¢¯åº¦ä¸‹æº¢</li>
<li>é™ä½äº†å‚æ•°çš„å¤šæ ·æ€§</li>
<li>å¯èƒ½å‡æ…¢æ”¶æ•›é€Ÿåº¦</li>
</ol>
<h4 id="43">4.3 æ›´ç²¾ç¡®çš„åˆ†æ</h4>
<p>è€ƒè™‘äº’å†…ç§¯çš„æ³¢åŠ¨ï¼Œå¼(20)åº”è¯¥æ˜¯ï¼š</p>
<p>\begin{equation}
\boldsymbol{w}_j \cdot \boldsymbol{h}_i \sim \mathcal{N}(0, d\sigma^2)
\tag{43}
\end{equation}</p>
<p>Softmaxçš„åˆ†æ¯ï¼š</p>
<p>\begin{equation}
\sum_{k=1}^n \exp(\text{logit}<em _neq="\neq" i="i" k="k">k) \approx e^{d\sigma} + \sum</em>_k)
\tag{44}
\end{equation}} \exp(\text{logit</p>
<p>å…¶ä¸­ $\sum_{k \neq i} \exp(\text{logit}_k)$ è¿‘ä¼¼ä¸º $(n-1)\mathbb{E}[\exp(g)]$ï¼Œ$g \sim \mathcal{N}(0, d\sigma^2)$ã€‚</p>
<p>å¯¹äºæ­£æ€åˆ†å¸ƒï¼Œ$\mathbb{E}[\exp(g)] = \exp(d\sigma^2/2)$ï¼š</p>
<p>\begin{equation}
\sum_{k=1}^n \exp(\text{logit}_k) \approx e^{d\sigma} + (n-1)e^{d\sigma^2/2}
\tag{45}
\end{equation}</p>
<p>è¦ä½¿æŸå¤±åˆç†ï¼Œéœ€è¦ä¸¤é¡¹å¹³è¡¡ï¼š</p>
<p>\begin{equation}
e^{d\sigma} \approx (n-1)e^{d\sigma^2/2}
\tag{46}
\end{equation}</p>
<p>å–å¯¹æ•°ï¼š</p>
<p>\begin{equation}
d\sigma \approx \log(n-1) + \frac{d\sigma^2}{2}
\tag{47}
\end{equation}</p>
<p>è¿™æ˜¯ä¸€ä¸ªå…³äº $\sigma$ çš„äºŒæ¬¡æ–¹ç¨‹ã€‚å¯¹äº $\sigma$ è¾ƒå°çš„æƒ…å†µï¼Œå¿½ç•¥äºŒæ¬¡é¡¹ï¼š</p>
<p>\begin{equation}
\sigma \approx \frac{\log n}{d}
\tag{48}
\end{equation}</p>
<p>è¿™ä¸å¼(39)ä¸€è‡´ã€‚</p>
<h3 id="5-2">5. è§£å†³æ–¹æ¡ˆ2ï¼šæ·»åŠ æŠ•å½±å±‚</h3>
<h4 id="51">5.1 æŠ•å½±å±‚çš„ä½œç”¨</h4>
<p>åœ¨Normalizationåæ·»åŠ ä¸€ä¸ªçº¿æ€§æŠ•å½±å±‚ï¼š</p>
<p>\begin{equation}
\boldsymbol{h}_i' = \boldsymbol{P}\boldsymbol{h}_i
\tag{49}
\end{equation}</p>
<p>å…¶ä¸­ $\boldsymbol{P} \in \mathbb{R}^{d \times d}$ æ˜¯æ­£äº¤åˆå§‹åŒ–çš„çŸ©é˜µï¼ˆæˆ–éšæœºåˆå§‹åŒ–ï¼‰ã€‚</p>
<p><strong>æ­£äº¤åˆå§‹åŒ–</strong>ï¼š</p>
<p>\begin{equation}
\boldsymbol{P}\boldsymbol{P}^{\top} = \boldsymbol{I}
\tag{50}
\end{equation}</p>
<h4 id="52-johnson-lindenstrauss">5.2 Johnson-Lindenstrausså¼•ç†çš„åº”ç”¨</h4>
<p>å¯¹äºéšæœºæŠ•å½±çŸ©é˜µ $\boldsymbol{P}$ï¼ˆå…ƒç´ ç‹¬ç«‹åŒåˆ†å¸ƒ $\mathcal{N}(0, 1/d)$ï¼‰ï¼š</p>
<p><strong>æŠ•å½±åçš„å‘é‡</strong>ï¼š</p>
<p>\begin{equation}
\boldsymbol{h}_i' = \boldsymbol{P}\boldsymbol{h}_i
\tag{51}
\end{equation}</p>
<p><strong>æœŸæœ›</strong>ï¼š</p>
<p>\begin{equation}
\mathbb{E}[\boldsymbol{h}_i'] = \boldsymbol{P}\mathbb{E}[\boldsymbol{h}_i] = \boldsymbol{0}
\tag{52}
\end{equation}</p>
<p><strong>åæ–¹å·®</strong>ï¼š</p>
<p>\begin{equation}
\text{Cov}(\boldsymbol{h}_i') = \boldsymbol{P}\text{Cov}(\boldsymbol{h}_i)\boldsymbol{P}^{\top} = \boldsymbol{P}\boldsymbol{I}\boldsymbol{P}^{\top} = \boldsymbol{I}
\tag{53}
\end{equation}</p>
<p>ï¼ˆå¯¹äºæ­£äº¤çŸ©é˜µï¼‰</p>
<p><strong>å…³é”®æ€§è´¨</strong>ï¼š$\boldsymbol{h}_i'$ ä¸åŸå§‹Embedding $\boldsymbol{w}_i$ è¿‘ä¼¼ç‹¬ç«‹ã€‚</p>
<h4 id="53">5.3 å†…ç§¯åˆ†æ</h4>
<p>åŸå§‹è‡ªå†…ç§¯ï¼š</p>
<p>\begin{equation}
\boldsymbol{w}_i \cdot \boldsymbol{h}_i = \boldsymbol{w}_i \cdot \frac{\boldsymbol{w}_i}{\sigma} = \frac{|\boldsymbol{w}_i|^2}{\sigma} \approx d\sigma
\tag{54}
\end{equation}</p>
<p>æŠ•å½±åï¼š</p>
<p>\begin{equation}
\boldsymbol{w}_i \cdot \boldsymbol{h}_i' = \boldsymbol{w}_i \cdot \boldsymbol{P}\boldsymbol{h}_i
\tag{55}
\end{equation}</p>
<p>ç”±äº $\boldsymbol{P}$ éšæœºï¼Œ$\boldsymbol{P}\boldsymbol{h}_i$ çš„æ¯ä¸ªåˆ†é‡ä¸ $\boldsymbol{w}_i$ çš„å¯¹åº”åˆ†é‡è¿‘ä¼¼ç‹¬ç«‹ï¼š</p>
<p>\begin{equation}
\mathbb{E}[\boldsymbol{w}_i \cdot \boldsymbol{P}\boldsymbol{h}_i] = 0, \quad \text{Var}[\boldsymbol{w}_i \cdot \boldsymbol{P}\boldsymbol{h}_i] = d\sigma^2
\tag{56}
\end{equation}</p>
<p><strong>ç»“è®º</strong>ï¼šæŠ•å½±åï¼Œè‡ªå†…ç§¯å’Œäº’å†…ç§¯åŒåˆ†å¸ƒï¼Œéƒ½è¿‘ä¼¼ä¸º $\mathcal{N}(0, d\sigma^2)$ã€‚</p>
<h4 id="54">5.4 åˆå§‹æŸå¤±</h4>
<p>æ‰€æœ‰logitsåŒåˆ†å¸ƒï¼ŒSoftmaxåè¿‘ä¼¼å‡åŒ€ï¼š</p>
<p>\begin{equation}
p(j|i) \approx \frac{1}{n}
\tag{57}
\end{equation}</p>
<p>åˆå§‹æŸå¤±ï¼š</p>
<p>\begin{equation}
\mathcal{L}_{\text{projection}} \approx \log n
\tag{58}
\end{equation}</p>
<p><strong>ä¼˜ç‚¹</strong>ï¼š
1. ä¿æŒæ ‡å‡†åˆå§‹åŒ– $\sigma$
2. ä»…å¢åŠ  $O(d^2)$ å‚æ•°ï¼ˆç›¸å¯¹äºEmbeddingçš„ $O(nd)$ å¾ˆå°ï¼‰
3. æä¾›é¢å¤–çš„è¡¨è¾¾èƒ½åŠ›</p>
<h4 id="55-bert">5.5 BERTçš„å®ç°</h4>
<p>BERTåœ¨MLM headä¸­æ·»åŠ Dense+LayerNormï¼š</p>
<p>\begin{equation}
\boldsymbol{h}' = \text{LayerNorm}(\boldsymbol{W}\boldsymbol{h} + \boldsymbol{b})
\tag{59}
\end{equation}</p>
<p>ç­‰æ•ˆäºæŠ•å½±+å½’ä¸€åŒ–+ç¼©æ”¾ï¼Œèµ·åˆ°ç›¸åŒä½œç”¨ã€‚</p>
<h3 id="6-3">6. è§£å†³æ–¹æ¡ˆ3ï¼šç»´åº¦æ‰“ä¹±</h3>
<h4 id="61">6.1 æ‰“ä¹±æ“ä½œçš„å®šä¹‰</h4>
<p>å®šä¹‰æ‰“ä¹±å‡½æ•° $\mathcal{S}: \mathbb{R}^d \to \mathbb{R}^d$ï¼š</p>
<p><strong>æ–¹æ¡ˆA</strong>ï¼šå‰ååŠéƒ¨åˆ†äº¤æ¢æ‹¼æ¥</p>
<p>\begin{equation}
\mathcal{S}[\boldsymbol{w}] = [\boldsymbol{w}<em 1:d_2="1:d/2">{d/2+1:d}, \boldsymbol{w}</em>]
\tag{60}
\end{equation}</p>
<p><strong>æ–¹æ¡ˆB</strong>ï¼šå¥‡å¶ä½äº¤é”™</p>
<p>\begin{equation}
\mathcal{S}[\boldsymbol{w}]<em 2i="2i">i = \begin{cases}
\boldsymbol{w}</em>, &amp; i \leq d/2 \
\boldsymbol{w}_{2i-d-1}, &amp; i &gt; d/2
\end{cases}
\tag{61}
\end{equation}</p>
<p><strong>æ–¹æ¡ˆC</strong>ï¼šReshape-Transpose-Reshapeï¼ˆShuffleNeté£æ ¼ï¼‰</p>
<p>\begin{equation}
\mathcal{S}[\boldsymbol{w}] = \text{Reshape}(\text{Transpose}(\text{Reshape}(\boldsymbol{w}, [k, d/k])))
\tag{62}
\end{equation}</p>
<h4 id="62">6.2 æ‰“ä¹±åçš„å†…ç§¯åˆ†æ</h4>
<p>åŸå§‹å‘é‡ï¼š$\boldsymbol{w} = [w_1, w_2, \ldots, w_d]$</p>
<p>æ‰“ä¹±åï¼ˆæ–¹æ¡ˆAï¼‰ï¼š$\mathcal{S}[\boldsymbol{w}] = [w_{d/2+1}, \ldots, w_d, w_1, \ldots, w_{d/2}]$</p>
<p><strong>è‡ªå†…ç§¯</strong>ï¼ˆåŒä¸€å‘é‡çš„åŸå§‹å’Œæ‰“ä¹±ç‰ˆæœ¬ï¼‰ï¼š</p>
<p>\begin{equation}
\begin{aligned}
\boldsymbol{w} \cdot \mathcal{S}[\boldsymbol{w}] &amp;= \sum_{i=1}^{d/2} w_i w_{i+d/2} + \sum_{i=d/2+1}^d w_i w_{i-d/2} \
&amp;= 2\sum_{i=1}^{d/2} w_i w_{i+d/2}
\end{aligned}
\tag{63}
\end{equation}</p>
<p><strong>æœŸæœ›</strong>ï¼š</p>
<p>\begin{equation}
\mathbb{E}[\boldsymbol{w} \cdot \mathcal{S}[\boldsymbol{w}]] = 2\sum_{i=1}^{d/2} \mathbb{E}[w_i]\mathbb{E}[w_{i+d/2}] = 0
\tag{64}
\end{equation}</p>
<p><strong>æ–¹å·®</strong>ï¼š</p>
<p>\begin{equation}
\text{Var}[\boldsymbol{w} \cdot \mathcal{S}[\boldsymbol{w}]] = 2 \cdot \frac{d}{2} \cdot \sigma^4 = d\sigma^4
\tag{65}
\end{equation}</p>
<p><strong>å¯¹æ¯”åŸå§‹è‡ªå†…ç§¯</strong>ï¼š</p>
<p>\begin{equation}
\mathbb{E}[\boldsymbol{w} \cdot \boldsymbol{w}] = d\sigma^2 \gg \mathbb{E}[\boldsymbol{w} \cdot \mathcal{S}[\boldsymbol{w}]] = 0
\tag{66}
\end{equation}</p>
<p><strong>ç»“è®º</strong>ï¼šæ‰“ä¹±åçš„"è‡ªå†…ç§¯"å˜æˆäº†ç±»ä¼¼äº’å†…ç§¯ï¼Œæ¶ˆé™¤äº†åå·®ã€‚</p>
<h4 id="63">6.3 å®ç°ç»†èŠ‚</h4>
<p>åœ¨æœ€åçš„Normalizationååº”ç”¨æ‰“ä¹±ï¼š</p>
<p>\begin{equation}
\text{logit}_j = \boldsymbol{w}_j \cdot \mathcal{S}[\text{Norm}(\boldsymbol{h}_i)]
\tag{67}
\end{equation}</p>
<p><strong>é›¶å‚æ•°å¼€é”€</strong>ï¼šä»…éœ€æ”¹å˜ç´¢å¼•é¡ºåºï¼Œæ— éœ€é¢å¤–å‚æ•°ã€‚</p>
<p><strong>ç¼ºç‚¹</strong>ï¼š
1. ç ´åäº†ä½ç½®å¯¹åº”å…³ç³»
2. å¯èƒ½å½±å“æŸäº›ä½ç½®æ•æ„Ÿçš„ä¸‹æ¸¸ä»»åŠ¡
3. ç†è®ºä¿è¯å¼±äºéšæœºæŠ•å½±</p>
<h3 id="7">7. æ”¶æ•›æ€§åˆ†æ</h3>
<h4 id="71">7.1 æ¢¯åº¦æµåˆ†æ</h4>
<p>å®šä¹‰æŸå¤±å‡½æ•°ï¼š</p>
<p>\begin{equation}
\mathcal{L} = -\log p(j|i) = -\boldsymbol{w}<em k="1">j \cdot \boldsymbol{h}_i + \log \sum</em>_i)
\tag{68}
\end{equation}}^n \exp(\boldsymbol{w}_k \cdot \boldsymbol{h</p>
<p><strong>å¯¹Embeddingçš„æ¢¯åº¦</strong>ï¼ˆå…±äº«æƒ…å†µï¼‰ï¼š</p>
<p>\begin{equation}
\frac{\partial \mathcal{L}}{\partial \boldsymbol{w}_j} = \begin{cases}
-\boldsymbol{h}_i + p(j|i)\boldsymbol{h}_i, &amp; \text{if } j = \text{target} \
p(j|i)\boldsymbol{h}_i, &amp; \text{otherwise}
\end{cases}
\tag{69}
\end{equation}</p>
<p><strong>è¾“å…¥tokençš„æ¢¯åº¦</strong>ï¼ˆåå‘ä¼ æ’­åˆ°è¾“å…¥Embeddingï¼‰ï¼š</p>
<p>\begin{equation}
\frac{\partial \mathcal{L}}{\partial \boldsymbol{w}_i} = \frac{\partial \mathcal{L}}{\partial \boldsymbol{h}_i} \cdot \frac{\partial \boldsymbol{h}_i}{\partial \boldsymbol{w}_i}
\tag{70}
\end{equation}</p>
<p>å…¶ä¸­ï¼š</p>
<p>\begin{equation}
\frac{\partial \mathcal{L}}{\partial \boldsymbol{h}<em k="1">i} = -\boldsymbol{w}_j + \sum</em>_k
\tag{71}
\end{equation}}^n p(k|i)\boldsymbol{w</p>
<h4 id="72-vs">7.2 å…±äº«vsä¸å…±äº«çš„æ¢¯åº¦å¯¹æ¯”</h4>
<p><strong>å…±äº«Embedding</strong>ï¼š</p>
<p>è¾“å…¥token $i$ çš„Embeddingæ¥æ”¶ä¸¤ä¸ªæ¢¯åº¦ï¼š
1. ä½œä¸ºè¾“å…¥çš„æ¢¯åº¦ï¼ˆå¼70ï¼‰
2. ä½œä¸ºè¾“å‡ºå€™é€‰çš„æ¢¯åº¦ï¼ˆå¼69ä¸­ $j=i$ çš„æƒ…å†µï¼‰</p>
<p>æ€»æ¢¯åº¦ï¼š</p>
<p>\begin{equation}
\nabla_{\boldsymbol{w}<em _text_tied="\text{tied">i}\mathcal{L}</em>}} = \nabla_{\boldsymbol{w<em _text_input="\text{input">i}\mathcal{L}</em>}} + \nabla_{\boldsymbol{w<em _text_output="\text{output">i}\mathcal{L}</em>
\tag{72}
\end{equation}}</p>
<p><strong>ä¸å…±äº«Embedding</strong>ï¼š</p>
<p>è¾“å…¥å’Œè¾“å‡ºåˆ†åˆ«æ›´æ–°ï¼Œæ¢¯åº¦ç‹¬ç«‹ï¼š</p>
<p>\begin{equation}
\nabla_{\boldsymbol{w}<em _boldsymbol_w="\boldsymbol{w">i^{in}}\mathcal{L}, \quad \nabla</em>
\tag{73}
\end{equation}}_j^{out}}\mathcal{L</p>
<h4 id="73">7.3 æ­£åˆ™åŒ–æ•ˆåº”</h4>
<p>å…±äº«Embeddingéšå¼åœ°æ·»åŠ äº†çº¦æŸï¼š</p>
<p>\begin{equation}
\boldsymbol{W}<em out="out">{in} = \boldsymbol{W}</em>
\tag{74}
\end{equation}}^{\top</p>
<p>è¿™ç›¸å½“äºå‚æ•°ç©ºé—´çš„ä¸€ä¸ªå­æµå½¢ï¼Œé™åˆ¶äº†æ¨¡å‹å®¹é‡ï¼Œèµ·åˆ°æ­£åˆ™åŒ–ä½œç”¨ã€‚</p>
<p><strong>å‚æ•°é‡å¯¹æ¯”</strong>ï¼š</p>
<ul>
<li>ä¸å…±äº«ï¼š$(2nd)$ å‚æ•°</li>
<li>å…±äº«ï¼š$(nd)$ å‚æ•°</li>
<li>å‚æ•°å‡å°‘ï¼š$50\%$</li>
</ul>
<p>å¯¹äº $n = 30000$ï¼Œ$d = 768$ï¼š</p>
<p>\begin{equation}
\Delta_{\text{params}} = nd = 30000 \times 768 \approx 23M
\tag{75}
\end{equation}</p>
<h4 id="74">7.4 æ”¶æ•›é€Ÿåº¦çš„ç†è®ºåˆ†æ</h4>
<p>å®šä¹‰ä¼˜åŒ–é—®é¢˜ï¼š</p>
<p>\begin{equation}
\min_{\boldsymbol{W}} \mathbb{E}_{(\boldsymbol{x}, y) \sim \mathcal{D}}[\mathcal{L}(\boldsymbol{W}; \boldsymbol{x}, y)]
\tag{76}
\end{equation}</p>
<p><strong>å…±äº«Embeddingçš„æœ‰æ•ˆå­¦ä¹ ç‡</strong>ï¼š</p>
<p>ç”±äºåŒä¸€Embeddingæ¥æ”¶å¤šä¸ªæ¢¯åº¦ï¼Œæœ‰æ•ˆå­¦ä¹ ç‡æå‡ï¼š</p>
<p>\begin{equation}
\eta_{\text{eff}} = \eta \cdot \mathbb{E}[\text{gradient multiplicity}]
\tag{77}
\end{equation}</p>
<p>å¯¹äºé«˜é¢‘è¯ï¼Œmultiplicityæ›´é«˜ï¼Œå­¦ä¹ æ›´å¿«ã€‚</p>
<h3 id="8">8. æ•°å€¼å®éªŒä¸éªŒè¯</h3>
<h4 id="81">8.1 åˆå§‹æŸå¤±å¯¹æ¯”å®éªŒ</h4>
<p><strong>è®¾ç½®</strong>ï¼š
- è¯è¡¨å¤§å°ï¼š$n = 10000$
- éšè—ç»´åº¦ï¼š$d = 768$
- åˆå§‹åŒ–ï¼š$\sigma = 0.02$</p>
<p><strong>æµ‹é‡</strong>ï¼šåœ¨éšæœºåˆå§‹åŒ–åï¼Œè®¡ç®—100ä¸ªæ ·æœ¬çš„å¹³å‡æŸå¤±ã€‚</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>åˆå§‹æŸå¤±</th>
<th>ç†è®ºé¢„æµ‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>å…±äº«Embeddingï¼ˆåŸå§‹ï¼‰</td>
<td>768.2</td>
<td>$d = 768$</td>
</tr>
<tr>
<td>ä¸å…±äº«Embedding</td>
<td>9.2</td>
<td>$\log 10000 = 9.21$</td>
</tr>
<tr>
<td>å…±äº«+è°ƒæ•´$\sigma=\log n/d$</td>
<td>9.5</td>
<td>$\log n = 9.21$</td>
</tr>
<tr>
<td>å…±äº«+æŠ•å½±å±‚</td>
<td>9.3</td>
<td>$\log n = 9.21$</td>
</tr>
<tr>
<td>å…±äº«+ç»´åº¦æ‰“ä¹±</td>
<td>9.4</td>
<td>$\log n = 9.21$</td>
</tr>
</tbody>
</table>
<p>\begin{equation}
\text{éªŒè¯ï¼šåŸå§‹å…±äº«Embeddingçš„åˆå§‹æŸå¤±ç¡®å®çº¦ä¸º } d\sigma
\tag{78}
\end{equation}</p>
<h4 id="82-vs">8.2 è‡ªå†…ç§¯vsäº’å†…ç§¯çš„ç»Ÿè®¡</h4>
<p><strong>æµ‹é‡1000å¯¹å‘é‡</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>å‡å€¼</th>
<th>æ ‡å‡†å·®</th>
</tr>
</thead>
<tbody>
<tr>
<td>è‡ªå†…ç§¯ $\boldsymbol{w}_i \cdot \boldsymbol{w}_i$</td>
<td>0.239</td>
<td>0.017</td>
</tr>
<tr>
<td>äº’å†…ç§¯ $\boldsymbol{w}_i \cdot \boldsymbol{w}_j$</td>
<td>0.0002</td>
<td>0.0316</td>
</tr>
<tr>
<td>ç†è®ºï¼ˆè‡ªï¼‰</td>
<td>$d\sigma^2 = 0.237$</td>
<td>$\sigma^2\sqrt{2d} = 0.018$</td>
</tr>
<tr>
<td>ç†è®ºï¼ˆäº’ï¼‰</td>
<td>$0$</td>
<td>$\sigma^2\sqrt{d} = 0.0316$</td>
</tr>
</tbody>
</table>
<p>\begin{equation}
\text{éªŒè¯ï¼šå¼(2)å’Œå¼(10)çš„ç†è®ºå€¼ä¸å®éªŒé«˜åº¦å»åˆ}
\tag{79}
\end{equation}</p>
<h4 id="83">8.3 æ”¶æ•›æ›²çº¿å¯¹æ¯”</h4>
<p>è®­ç»ƒè¯­è¨€æ¨¡å‹ï¼ˆå°è§„æ¨¡ï¼‰100kæ­¥ï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>10kæ­¥Loss</th>
<th>50kæ­¥Loss</th>
<th>100kæ­¥Loss</th>
<th>æœ€ç»ˆPPL</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä¸å…±äº«</td>
<td>6.2</td>
<td>4.1</td>
<td>3.5</td>
<td>33.1</td>
</tr>
<tr>
<td>å…±äº«ï¼ˆåŸå§‹ï¼‰</td>
<td>768â†’15.2</td>
<td>4.3</td>
<td>3.6</td>
<td>36.8</td>
</tr>
<tr>
<td>å…±äº«+$\sigma_{\text{new}}$</td>
<td>9.5</td>
<td>4.5</td>
<td>3.7</td>
<td>40.5</td>
</tr>
<tr>
<td>å…±äº«+æŠ•å½±</td>
<td>9.3</td>
<td>4.1</td>
<td>3.5</td>
<td>33.5</td>
</tr>
<tr>
<td>å…±äº«+æ‰“ä¹±</td>
<td>9.4</td>
<td>4.2</td>
<td>3.6</td>
<td>34.2</td>
</tr>
</tbody>
</table>
<p><strong>è§‚å¯Ÿ</strong>ï¼š
1. åŸå§‹å…±äº«æ–¹æ³•åœ¨å‰1kæ­¥æŸå¤±å¼‚å¸¸é«˜ï¼Œç„¶åå¿«é€Ÿä¸‹é™
2. è°ƒæ•´$\sigma$æ–¹æ³•æœ€ç»ˆæ•ˆæœç•¥å·®ï¼ˆåˆå§‹åŒ–è¿‡å°ï¼‰
3. æŠ•å½±æ–¹æ³•æ•ˆæœæœ€å¥½ï¼Œä¸ä¸å…±äº«ç›¸å½“
4. æ‰“ä¹±æ–¹æ³•ç•¥é€ŠäºæŠ•å½±ï¼Œä½†é›¶å‚æ•°</p>
<h3 id="9">9. ç†è®ºè¯æ˜ï¼šæŠ•å½±çš„å……åˆ†æ€§</h3>
<h4 id="91">9.1 å®šç†é™ˆè¿°</h4>
<p><strong>å®šç†</strong>ï¼šè®¾ $\boldsymbol{w}_1, \ldots, \boldsymbol{w}_n \sim \mathcal{N}(0, \sigma^2\boldsymbol{I}_d)$ i.i.d.ï¼Œ$\boldsymbol{P} \in \mathbb{R}^{d \times d}$ æ˜¯éšæœºæ­£äº¤çŸ©é˜µï¼ˆHaaråˆ†å¸ƒï¼‰ã€‚åˆ™å¯¹äºä»»æ„ $i, j \in [n]$ï¼š</p>
<p>\begin{equation}
\boldsymbol{w}_i \cdot \boldsymbol{P}\boldsymbol{w}_j \stackrel{d}{=} \begin{cases}
\mathcal{N}(0, d\sigma^4), &amp; i \neq j \
\mathcal{N}(0, d\sigma^4), &amp; i = j
\end{cases}
\tag{80}
\end{equation}</p>
<p>å³è‡ªå†…ç§¯å’Œäº’å†…ç§¯åŒåˆ†å¸ƒã€‚</p>
<h4 id="92">9.2 è¯æ˜</h4>
<p><strong>Step 1</strong>ï¼š$\boldsymbol{P}\boldsymbol{w}_j$ çš„åˆ†å¸ƒ</p>
<p>ç”±äº $\boldsymbol{P}$ æ˜¯æ­£äº¤çŸ©é˜µï¼Œ$\boldsymbol{w}_j \sim \mathcal{N}(0, \sigma^2\boldsymbol{I})$ï¼š</p>
<p>\begin{equation}
\boldsymbol{P}\boldsymbol{w}_j \sim \mathcal{N}(0, \sigma^2\boldsymbol{P}\boldsymbol{P}^{\top}) = \mathcal{N}(0, \sigma^2\boldsymbol{I})
\tag{81}
\end{equation}</p>
<p><strong>Step 2</strong>ï¼š$\boldsymbol{P}$ éšæœºæ€§çš„å½±å“</p>
<p>å½“ $\boldsymbol{P}$ ä»Haaråˆ†å¸ƒé‡‡æ ·æ—¶ï¼Œå¯¹äºå›ºå®šçš„ $\boldsymbol{w}_i, \boldsymbol{w}_j$ï¼Œ$\boldsymbol{P}\boldsymbol{w}_j$ ä¸ $\boldsymbol{w}_i$ çš„ç›¸å…³æ€§ï¼š</p>
<p>\begin{equation}
\mathbb{E}<em _boldsymbol_P="\boldsymbol{P">{\boldsymbol{P}}[\boldsymbol{w}_i \cdot \boldsymbol{P}\boldsymbol{w}_j | \boldsymbol{w}_i, \boldsymbol{w}_j] = \boldsymbol{w}_i^{\top}\mathbb{E}</em>_j
\tag{82}
\end{equation}}}[\boldsymbol{P}]\boldsymbol{w</p>
<p>å¯¹äºHaaråˆ†å¸ƒï¼Œ$\mathbb{E}_{\boldsymbol{P}}[\boldsymbol{P}] = \boldsymbol{0}$ï¼ˆä¸æˆç«‹ï¼Œéœ€è¦ä¿®æ­£ï¼‰ã€‚</p>
<p><strong>ä¿®æ­£</strong>ï¼šå®é™…ä¸Šï¼Œå¯¹äºå›ºå®šçš„ $\boldsymbol{w}_i, \boldsymbol{w}_j$ï¼š</p>
<p>\begin{equation}
\boldsymbol{w}<em k="1">i^{\top}\boldsymbol{P}\boldsymbol{w}_j = \sum</em>_j)_k
\tag{83}
\end{equation}}^d (\boldsymbol{w}_i)_k (\boldsymbol{P}\boldsymbol{w</p>
<p>ç”±äº $\boldsymbol{P}$ éšæœºï¼Œ$(\boldsymbol{P}\boldsymbol{w}_j)_k$ çš„åˆ†å¸ƒä¸ $\boldsymbol{w}_j$ çš„æ¨¡å¼æ‰“ä¹±ï¼Œä¸ $(\boldsymbol{w}_i)_k$ è¿‘ä¼¼ç‹¬ç«‹ã€‚</p>
<p><strong>Step 3</strong>ï¼šJohnson-Lindenstrausså¼•ç†</p>
<p>æ›´ä¸¥æ ¼çš„è¯æ˜åŸºäºJLå¼•ç†ï¼šéšæœºæŠ•å½±ä¿æŒå†…ç§¯çš„æœŸæœ›ã€‚</p>
<p>å¯¹äº $\boldsymbol{P}$ çš„å…ƒç´  $P_{ij} \sim \mathcal{N}(0, 1/d)$ï¼š</p>
<p>\begin{equation}
\mathbb{E}[\boldsymbol{w}_i^{\top}\boldsymbol{P}\boldsymbol{w}_j] = 0, \quad \text{Var}[\boldsymbol{w}_i^{\top}\boldsymbol{P}\boldsymbol{w}_j] = \frac{1}{d} |\boldsymbol{w}_i|^2|\boldsymbol{w}_j|^2
\tag{84}
\end{equation}</p>
<p>å½“ $|\boldsymbol{w}_i|^2, |\boldsymbol{w}_j|^2 \approx d\sigma^2$ æ—¶ï¼š</p>
<p>\begin{equation}
\text{Var}[\boldsymbol{w}_i^{\top}\boldsymbol{P}\boldsymbol{w}_j] \approx \frac{1}{d}(d\sigma^2)^2 = d\sigma^4
\tag{85}
\end{equation}</p>
<p><strong>ç»“è®º</strong>ï¼šæ— è®º $i = j$ è¿˜æ˜¯ $i \neq j$ï¼Œå†…ç§¯çš„åˆ†å¸ƒéƒ½æ˜¯ $\mathcal{N}(0, d\sigma^4)$ã€‚ $\square$</p>
<h3 id="10">10. å‚æ•°æ•ˆç‡ä¸æ¨¡å‹å®¹é‡</h3>
<h4 id="101">10.1 å‚æ•°é‡åˆ†æ</h4>
<p><strong>Transformeræ¨¡å‹çš„å‚æ•°åˆ†å¸ƒ</strong>ï¼ˆä»¥BERT baseä¸ºä¾‹ï¼‰ï¼š</p>
<ul>
<li>Embeddingå±‚ï¼š$n \times d = 30000 \times 768 = 23M$</li>
<li>ç¼–ç å™¨ï¼ˆ12å±‚ï¼‰ï¼šçº¦$85M$</li>
<li>è¾“å‡ºå±‚ï¼ˆå¦‚æœä¸å…±äº«ï¼‰ï¼š$n \times d = 23M$</li>
<li>æ€»è®¡ï¼ˆä¸å…±äº«ï¼‰ï¼š$131M$</li>
<li>æ€»è®¡ï¼ˆå…±äº«ï¼‰ï¼š$108M$</li>
</ul>
<p><strong>å‚æ•°å‡å°‘ç‡</strong>ï¼š</p>
<p>\begin{equation}
\frac{131M - 108M}{131M} \approx 17.6\%
\tag{86}
\end{equation}</p>
<p>å½“æ¨¡å‹è§„æ¨¡å¢å¤§ï¼ˆå¦‚GPT-3ï¼‰ï¼Œç¼–ç å™¨å‚æ•°å æ¯”æå‡ï¼š</p>
<ul>
<li>GPT-3ï¼ˆ175Bï¼‰ï¼šEmbeddingçº¦å  $&lt;1\%$</li>
<li>å…±äº«ä¸å¦çš„å½±å“å¾®ä¹å…¶å¾®</li>
</ul>
<p>\begin{equation}
\text{ç»“è®ºï¼šå¤§æ¨¡å‹æ—¶ä»£ï¼Œå…±äº«Embeddingçš„å‚æ•°æ•ˆç‡ä¼˜åŠ¿ä¸æ˜æ˜¾}
\tag{87}
\end{equation}</p>
<h4 id="102">10.2 è¡¨è¾¾èƒ½åŠ›åˆ†æ</h4>
<p><strong>è‡ªç”±åº¦å¯¹æ¯”</strong>ï¼š</p>
<ul>
<li>ä¸å…±äº«ï¼šè¾“å…¥å’Œè¾“å‡ºå¯ä»¥å­¦ä¹ ä¸åŒçš„è¯­ä¹‰ç©ºé—´</li>
<li>å…±äº«ï¼šå¼ºåˆ¶è¾“å…¥=è¾“å‡ºç©ºé—´</li>
</ul>
<p><strong>æµå½¢ç»´åº¦</strong>ï¼š</p>
<p>å‡è®¾è¯åµŒå…¥åˆ†å¸ƒåœ¨ä¸€ä¸ªä½ç»´æµå½¢ $\mathcal{M} \subset \mathbb{R}^d$ ä¸Šï¼Œç»´åº¦ä¸º $m$ã€‚</p>
<ul>
<li>ä¸å…±äº«ï¼šè¾“å…¥æµå½¢ $\mathcal{M}<em out="out">{in}$ï¼Œè¾“å‡ºæµå½¢ $\mathcal{M}</em>$ï¼Œæ€»è‡ªç”±åº¦ $2m$</li>
<li>å…±äº«ï¼š$\mathcal{M}<em out="out">{in} = \mathcal{M}</em>$ï¼Œæ€»è‡ªç”±åº¦ $m$</li>
</ul>
<p><strong>æ€§èƒ½å½±å“</strong>ï¼š</p>
<p>å½“ä»»åŠ¡çš„è¾“å…¥å’Œè¾“å‡ºè¯­ä¹‰ç©ºé—´ä¸åŒæ—¶ï¼ˆå¦‚ç¿»è¯‘ï¼‰ï¼Œä¸å…±äº«æ›´ä¼˜ã€‚
å½“ä»»åŠ¡æ˜¯è‡ªå›å½’æ—¶ï¼ˆå¦‚LMï¼‰ï¼Œå…±äº«çš„çº¦æŸå¯èƒ½æœ‰ç›Šï¼ˆæ­£åˆ™åŒ–ï¼‰ã€‚</p>
<h3 id="11_1">11. å®è·µå»ºè®®ä¸æ€»ç»“</h3>
<h4 id="111">11.1 ä¸åŒåœºæ™¯çš„æ¨èæ–¹æ¡ˆ</h4>
<table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>æ¨èæ–¹æ¡ˆ</th>
<th>ç†ç”±</th>
</tr>
</thead>
<tbody>
<tr>
<td>å°æ¨¡å‹ï¼ˆ&lt;1Bï¼‰</td>
<td>å…±äº«+æŠ•å½±å±‚</td>
<td>å‚æ•°æ•ˆç‡+åˆå§‹åŒ–åˆç†</td>
</tr>
<tr>
<td>å¤§æ¨¡å‹ï¼ˆ&gt;10Bï¼‰</td>
<td>ä¸å…±äº«</td>
<td>å‚æ•°å æ¯”å°ï¼Œè¡¨è¾¾èƒ½åŠ›æ›´é‡è¦</td>
</tr>
<tr>
<td>é¢„è®­ç»ƒ+Finetune</td>
<td>å…±äº«+æŠ•å½±å±‚</td>
<td>é¢„è®­ç»ƒé˜¶æ®µèŠ‚çœå‚æ•°ï¼ŒFinetuneæ—¶å¯è§£ç»‘</td>
</tr>
<tr>
<td>å¤šè¯­è¨€æ¨¡å‹</td>
<td>ä¸å…±äº«</td>
<td>è¾“å…¥/è¾“å‡ºè¯­è¨€å¯èƒ½ä¸åŒ</td>
</tr>
<tr>
<td>å¯¹è¯æ¨¡å‹</td>
<td>ä¸å…±äº«</td>
<td>è¾“å…¥ï¼ˆç†è§£ï¼‰å’Œè¾“å‡ºï¼ˆç”Ÿæˆï¼‰çš„è¯­ä¹‰ç©ºé—´ä¸åŒ</td>
</tr>
</tbody>
</table>
<h4 id="112">11.2 å®ç°ç»†èŠ‚</h4>
<p><strong>æ–¹æ¡ˆ1ï¼šè°ƒæ•´åˆå§‹åŒ–</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">std</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">)</span> <span class="o">/</span> <span class="n">hidden_dim</span>  <span class="c1"># çº¦0.0134 for n=30k, d=768</span>
<span class="n">embedding</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">)</span>
<span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">trunc_normal_</span><span class="p">(</span><span class="n">embedding</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="n">std</span><span class="p">,</span> <span class="n">a</span><span class="o">=-</span><span class="mi">2</span><span class="o">*</span><span class="n">std</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">std</span><span class="p">)</span>
</code></pre></div>

<p><strong>æ–¹æ¡ˆ2ï¼šæŠ•å½±å±‚</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EmbeddingWithProjection</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vocab_size</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedding</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer_norm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="n">h_proj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">(</span><span class="n">h</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">h_proj</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">T</span>
</code></pre></div>

<p><strong>æ–¹æ¡ˆ3ï¼šç»´åº¦æ‰“ä¹±</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">shuffle_embedding</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
    <span class="c1"># å‰ååŠéƒ¨åˆ†äº¤æ¢</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">h</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">d</span><span class="o">//</span><span class="mi">2</span><span class="p">:],</span> <span class="n">h</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="n">d</span><span class="o">//</span><span class="mi">2</span><span class="p">]],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">logits</span> <span class="o">=</span> <span class="n">h_shuffled</span> <span class="o">@</span> <span class="n">embedding</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">T</span>
</code></pre></div>

<h4 id="113">11.3 ç†è®ºæ€»ç»“</h4>
<p><strong>æ ¸å¿ƒé—®é¢˜</strong>ï¼š</p>
<p>\begin{equation}
\mathbb{E}[\boldsymbol{w}_i \cdot \boldsymbol{w}_i] = d\sigma^2 \gg \mathbb{E}[\boldsymbol{w}_i \cdot \boldsymbol{w}_j] = 0 \quad (i \neq j)
\tag{88}
\end{equation}</p>
<p><strong>è§£å†³æ€è·¯</strong>ï¼š</p>
<ol>
<li><strong>ç›´æ¥è°ƒæ•´</strong>ï¼šé™ä½ $\sigma$ ä½¿ $d\sigma \approx \log n$</li>
<li><strong>è§£è€¦å˜æ¢</strong>ï¼šé€šè¿‡æŠ•å½± $\boldsymbol{P}$ ä½¿è‡ªå†…ç§¯ä¸äº’å†…ç§¯åŒåˆ†å¸ƒ</li>
<li><strong>å‡ ä½•æ‰“ä¹±</strong>ï¼šé‡æ’ç»´åº¦ç ´åè‡ªç›¸å…³</li>
</ol>
<p><strong>æœ€ä¼˜é€‰æ‹©</strong>ï¼šæŠ•å½±å±‚æ–¹æ¡ˆï¼ˆæ–¹æ¡ˆ2ï¼‰</p>
<ul>
<li>ç†è®ºä¿è¯ï¼šJLå¼•ç†</li>
<li>å®ç°ç®€å•ï¼šä»…æ·»åŠ ä¸€ä¸ªLinearå±‚</li>
<li>é¢å¤–æ”¶ç›Šï¼šæä¾›è¡¨è¾¾èƒ½åŠ›ï¼Œç±»ä¼¼BERTçš„MLM Dense</li>
</ul>
<p><strong>æ•°å­¦ç²¾é«“</strong>ï¼š</p>
<p>\begin{equation}
\text{é—®é¢˜} \quad |\boldsymbol{w}|^2 \gg \boldsymbol{w} \cdot \boldsymbol{v} \quad \Rightarrow \quad \text{è§£å†³} \quad \boldsymbol{w} \cdot \boldsymbol{P}\boldsymbol{w} \approx \boldsymbol{w} \cdot \boldsymbol{P}\boldsymbol{v}
\tag{89}
\end{equation}</p>
<p>é€šè¿‡éšæœºæŠ•å½±ï¼Œå°†ç¡®å®šæ€§çš„å¤§åå·®ï¼ˆè‡ªå†…ç§¯ï¼‰è½¬åŒ–ä¸ºéšæœºæ¶¨è½ï¼ˆä¸äº’å†…ç§¯åŒåˆ†å¸ƒï¼‰ã€‚</p>
        </div>
    </div>
</body>
</html>