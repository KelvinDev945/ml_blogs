<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆä¸‰åï¼‰ï¼šä»ç¬æ—¶é€Ÿåº¦åˆ°å¹³å‡é€Ÿåº¦</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆä¸‰åï¼‰ï¼šä»ç¬æ—¶é€Ÿåº¦åˆ°å¹³å‡é€Ÿåº¦</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-26 | ğŸ“„ å¤§å°: 59.0 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/10958">https://spaces.ac.cn/archives/10958</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œç”Ÿæˆé€Ÿåº¦æ…¢æ˜¯æ‰©æ•£æ¨¡å‹ä¸€ç›´ä»¥æ¥çš„ç—›ç‚¹ï¼Œè€Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¤§å®¶å¯è°“â€œå…«ä»™è¿‡æµ·ï¼Œå„æ˜¾ç¥é€šâ€ï¼Œæå‡ºäº†å„å¼å„æ ·çš„è§£å†³æ–¹æ¡ˆï¼Œç„¶è€Œé•¿ä¹…ä»¥æ¥å¹¶æ²¡ä¸€é¡¹å·¥ä½œèƒ½å¤Ÿè„±é¢–è€Œå‡ºï¼Œæˆä¸ºæ ‡é…ã€‚ä»€ä¹ˆæ ·çš„å·¥ä½œèƒ½å¤Ÿè¾¾åˆ°è¿™ä¸ªæ ‡å‡†å‘¢ï¼Ÿåœ¨ç¬”è€…çœ‹æ¥ï¼Œå®ƒè‡³å°‘æ»¡è¶³å‡ ä¸ªæ¡ä»¶ï¼š</p>
<blockquote>
<p>1ã€æ•°å­¦åŸç†æ¸…æ™°ï¼Œèƒ½å¤Ÿæ­ç¤ºå‡ºå¿«é€Ÿç”Ÿæˆçš„æœ¬è´¨æ‰€åœ¨ï¼›</p>
<p>2ã€èƒ½å¤Ÿå•ç›®æ ‡ä»é›¶è®­ç»ƒï¼Œä¸éœ€è¦å¯¹æŠ—ã€è’¸é¦ç­‰é¢å¤–æ‰‹æ®µï¼›</p>
<p>3ã€å•æ­¥ç”Ÿæˆæ¥è¿‘SOTAï¼Œå¯ä»¥é€šè¿‡å¢åŠ æ­¥æ•°æå‡æ•ˆæœã€‚</p>
</blockquote>
<p>æ ¹æ®ç¬”è€…çš„é˜…è¯»ç»å†ï¼Œå‡ ä¹æ²¡æœ‰ä¸€é¡¹å·¥ä½œèƒ½åŒæ—¶æ»¡è¶³è¿™ä¸‰ä¸ªæ ‡å‡†ã€‚ç„¶è€Œï¼Œå°±åœ¨å‡ å¤©å‰ï¼ŒarXivå‡ºäº†ä¸€ç¯‡<a href="https://papers.cool/arxiv/2505.13447">ã€ŠMean Flows for One-step Generative Modelingã€‹</a>ï¼ˆç®€ç§°â€œMeanFlowâ€ï¼‰ï¼Œçœ‹ä¸Šå»éå¸¸æœ‰æ½œåŠ›ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä»¥æ­¤ä¸ºå¥‘æœºï¼Œè®¨è®ºä¸€ä¸‹ç›¸å…³æ€è·¯å’Œè¿›å±•ã€‚</p>
<h2 id="_1">ç°æœ‰æ€è·¯</h2>
<p>æ‰©æ•£æ¨¡å‹çš„ç”ŸæˆåŠ é€Ÿå·¥ä½œå·²ç»æœ‰éå¸¸å¤šï¼Œæœ¬åšå®¢å‰é¢ä¹Ÿç®€å•ä»‹ç»è¿‡ä¸€äº›ã€‚æ€»çš„æ¥è¯´ï¼ŒåŠ é€Ÿæ€è·¯å¤§ä½“ä¸Šå¯ä»¥åˆ†ä¸ºä¸‰ç±»ã€‚</p>
<p>ç¬¬ä¸€ï¼Œå°†æ‰©æ•£æ¨¡å‹è½¬åŒ–ä¸ºSDE/ODEï¼Œç„¶åç ”ç©¶æ›´é«˜æ•ˆçš„æ±‚è§£å™¨ï¼Œä»£è¡¨ä½œæ˜¯<a href="https://papers.cool/arxiv/2206.00927">DPM-Solver</a>åŠå…¶ä¸€ç³»åˆ—åç»­æ”¹è¿›ã€‚ç„¶è€Œï¼Œè¿™ä¸ªæ€è·¯é€šå¸¸åªèƒ½å°†ç”Ÿæˆçš„NFEï¼ˆNumber of Function Evaluationsï¼‰é™åˆ°10å·¦å³ï¼Œå†ä½å°±ä¼šæ˜æ˜¾é™ä½ç”Ÿæˆè´¨é‡ã€‚è¿™æ˜¯å› ä¸ºæ±‚è§£å™¨çš„æ”¶æ•›é€Ÿåº¦é€šå¸¸éƒ½æ˜¯æ­£æ¯”äºæ­¥é•¿çš„è‹¥å¹²æ¬¡æ–¹ï¼Œå½“NFEå¾ˆå°æ—¶æ­¥é•¿å°±æ— æ³•å¾ˆå°ï¼Œæ‰€ä»¥æ”¶æ•›ä¸å¤Ÿå¿«ä»¥è‡³äºæ²¡æ³•ç”¨ã€‚</p>
<p>ç¬¬äºŒï¼Œé€šè¿‡è’¸é¦å°†è®­ç»ƒå¥½çš„æ‰©æ•£æ¨¡å‹è½¬åŒ–ä¸ºæ›´å°‘æ­¥æ•°çš„ç”Ÿæˆå™¨ï¼Œç”±æ­¤è¡ç”Ÿå‡ºæ¥çš„å·¥ä½œå’Œæ–¹æ¡ˆä¹Ÿéå¸¸å¤šï¼Œæˆ‘ä»¬æ­¤å‰ä»‹ç»è¿‡å…¶ä¸­çš„ä¸€ç§åä¸º<a href="/archives/10085">SiD</a>çš„æ–¹æ¡ˆã€‚è’¸é¦ç®—æ˜¯æ¯”è¾ƒå¸¸è§„å’Œé€šç”¨çš„æ€è·¯ï¼Œä½†ç¼ºç‚¹ä¹Ÿæ˜¯å…±åŒçš„ï¼Œå³éœ€è¦é¢å¤–çš„è®­ç»ƒæˆæœ¬ï¼Œå¹¶éä»é›¶è®­ç»ƒçš„æ–¹æ¡ˆã€‚æœ‰äº›å·¥ä½œä¸ºäº†è’¸é¦åˆ°å•æ­¥ç”Ÿæˆå™¨ï¼Œè¿˜åŠ ä¸Šäº†å¯¹æŠ—è®­ç»ƒç­‰å¤šé‡ä¼˜åŒ–ç­–ç•¥ï¼Œæ•´ä¸ªæ–¹æ¡ˆå¾€å¾€è¿‡äºå¤æ‚ã€‚</p>
<p>ç¬¬äºŒï¼ŒåŸºäºä¸€è‡´æ€§æ¨¡å‹ï¼ˆConsistency Modelï¼ŒCMï¼‰ï¼ŒåŒ…æ‹¬æˆ‘ä»¬åœ¨<a href="/archives/10633">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆäºŒåå…«ï¼‰ï¼šåˆ†æ­¥ç†è§£ä¸€è‡´æ€§æ¨¡å‹ã€‹</a>ç®€å•ä»‹ç»çš„CMã€å®ƒçš„è¿ç»­ç‰ˆæœ¬<a href="https://papers.cool/arxiv/2410.11081">sCM</a>ä»¥åŠ<a href="https://papers.cool/arxiv/2310.02279">CTM</a>ç­‰ã€‚CMæ˜¯è‡ªæˆä¸€æ´¾çš„æ€è·¯ï¼Œå¯ä»¥ä»é›¶è®­ç»ƒå¾—åˆ°NFEå¾ˆå°çš„æ¨¡å‹ï¼Œä¹Ÿå¯ä»¥ç”¨äºè’¸é¦ï¼Œä½†CMçš„ç›®æ ‡ä¾èµ–äºEMAæˆ–è€…stop_gradientè¿ç®—ï¼Œæ„å‘³ç€å®ƒè€¦åˆäº†ä¼˜åŒ–å™¨åŠ¨åŠ›å­¦ï¼Œè¿™é€šå¸¸ç»™äººä¸€ç§è¯´ä¸æ¸…é“ä¸æ˜çš„æ„Ÿè§‰ã€‚</p>
<h2 id="_2">ç¬æ—¶é€Ÿåº¦</h2>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œç”ŸæˆNFEæœ€å°çš„æ‰©æ•£æ¨¡å‹ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ODEï¼Œå› ä¸ºç¡®å®šæ€§æ¨¡å‹å¾€å¾€æ›´å®¹æ˜“åˆ†æå’Œæ±‚è§£ã€‚æœ¬æ–‡åŒæ ·åªå…³æ³¨ODEå¼æ‰©æ•£ï¼Œæ‰€ç”¨æ¡†æ¶æ˜¯<a href="/archives/9497">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆåä¸ƒï¼‰ï¼šæ„å»ºODEçš„ä¸€èˆ¬æ­¥éª¤ï¼ˆä¸‹ï¼‰ã€‹</a>ä»‹ç»çš„ReFlowï¼Œå®ƒè·Ÿ<a href="https://papers.cool/arxiv/2210.02747">Flow Matching</a>æœ¬è´¨æ˜¯ç›¸é€šçš„ï¼Œä½†æ›´åŠ ç›´è§‚ã€‚</p>
<p>ODEå¼æ‰©æ•£ï¼Œæ˜¯å¸Œæœ›å­¦ä¹ ä¸€ä¸ªODE<br />
\begin{equation}\frac{d\boldsymbol{x}<em _boldsymbol_theta="\boldsymbol{\theta">t}{dt} = \boldsymbol{v}</em>}}(\boldsymbol{x}_t,t)\label{eq:ode}\end{equation<br />
æ¥æ„å»ºä¸€ä¸ª$\boldsymbol{x}_1\to \boldsymbol{x}_0$çš„å˜æ¢ã€‚å…·ä½“æ¥è¯´ï¼Œè®¾$\boldsymbol{x}_1\sim p_1(\boldsymbol{x}_1)$æ˜¯æŸä¸ªå®¹æ˜“é‡‡æ ·çš„éšæœºå™ªå£°ï¼Œ$\boldsymbol{x}_0\sim p_0(\boldsymbol{x}_0)$åˆ™æ˜¯ç›®æ ‡åˆ†å¸ƒçš„çœŸå®æ ·æœ¬ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿé€šè¿‡ä¸Šè¿°ODEï¼Œå®ç°éšæœºå™ªå£°åˆ°ç›®æ ‡æ ·æœ¬çš„å˜æ¢ï¼Œå³éšæœºé‡‡æ ·ä¸€ä¸ª$\boldsymbol{x}_1\sim p_1(\boldsymbol{x}_1)$ä½œä¸ºåˆå€¼ï¼Œæ±‚è§£ä¸Šè¿°ODEå¾—åˆ°çš„$\boldsymbol{x}_0$å°±æ˜¯$p_0(\boldsymbol{x}_0)$çš„æ ·æœ¬ã€‚</p>
<p>å¦‚æœå°†$t$çœ‹æˆæ—¶é—´ï¼Œ$\boldsymbol{x}<em _boldsymbol_theta="\boldsymbol{\theta">t$çœ‹æˆä½ç§»ï¼Œé‚£ä¹ˆ$d\boldsymbol{x}_t/dt$å°±æ˜¯ç¬æ—¶é€Ÿåº¦ï¼Œæ‰€ä»¥ODEå¼æ‰©æ•£å°±æ˜¯ç¬æ—¶é€Ÿåº¦çš„å»ºæ¨¡ã€‚é‚£æ€ä¹ˆè®­ç»ƒ$\boldsymbol{v}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t,t)$å‘¢ï¼ŸReFlowæå‡ºäº†ä¸€ç§éå¸¸ç›´è§‚çš„æ–¹æ³•ï¼šé¦–å…ˆæ„å»º$\boldsymbol{x}_0$ä¸$\boldsymbol{x}_1$çš„ä»»æ„æ’å€¼æ–¹å¼ï¼Œå¦‚æœ€ç®€å•çš„çº¿æ€§æ’å€¼$\boldsymbol{x}_t=(1-t)\boldsymbol{x}_0 + t \boldsymbol{x}_1$ï¼Œé‚£ä¹ˆå¯¹$t$æ±‚å¯¼å¾—<br />
\begin{equation}\frac{d\boldsymbol{x}_t}{dt} = \boldsymbol{x}_1 - \boldsymbol{x}_0\end{equation}<br />
è¿™æ˜¯ä¸ªæç®€å•çš„ODEï¼Œä½†ä¸ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ï¼Œå› ä¸º$\boldsymbol{x}_0$æ˜¯æˆ‘ä»¬çš„ç›®æ ‡ï¼Œå®ƒä¸åº”è¯¥å‡ºç°åœ¨ODEä¸­ã€‚å¯¹æ­¤ï¼ŒReFlowæå‡ºä¸€ä¸ªéå¸¸ç¬¦åˆç›´è§‰çš„æƒ³æ³•â€”â€”ç”¨$\boldsymbol{v}</em>}}(\boldsymbol{x<em t_boldsymbol_x="t,\boldsymbol{x">t,t)$å»é€¼è¿‘$\boldsymbol{x}_1 - \boldsymbol{x}_0$ï¼š<br />
\begin{equation}\mathbb{E}</em><em _boldsymbol_theta="\boldsymbol{\theta">0,\boldsymbol{x}_1}\left[\Vert\boldsymbol{v}</em>}}(\boldsymbol{x}_t,t) - (\boldsymbol{x}_1 - \boldsymbol{x}_0)\Vert^2\right]\label{eq:loss-reflow}\end{equation<br />
è¿™å°±æ˜¯ReFlowçš„ç›®æ ‡å‡½æ•°ã€‚å€¼å¾—æŒ‡å‡ºçš„æ˜¯ï¼š1ï¼‰ReFlowç†è®ºä¸Šå…è®¸$\boldsymbol{x}_0$ä¸$\boldsymbol{x}_1$çš„ä»»æ„æ’å€¼æ–¹å¼ï¼›2ï¼‰ReFlowè™½ç„¶ç›´è§‚ï¼Œä½†ç†è®ºä¸Šä¹Ÿæ˜¯ä¸¥æ ¼çš„ï¼Œå¯ä»¥è¯æ˜å®ƒçš„æœ€ä¼˜è§£ç¡®å®æ˜¯æˆ‘ä»¬æ‰€æ±‚çš„ODEã€‚ç›¸å…³ç»†èŠ‚å¤§å®¶è¯·å‚è€ƒ<a href="/archives/9497">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆåä¸ƒï¼‰ï¼šæ„å»ºODEçš„ä¸€èˆ¬æ­¥éª¤ï¼ˆä¸‹ï¼‰ã€‹</a>ä»¥åŠåŸè®ºæ–‡ã€‚</p>
<h2 id="_3">å¹³å‡é€Ÿåº¦</h2>
<p>ç„¶è€Œï¼ŒODEä»…ä»…æ˜¯ä¸€ä¸ªçº¯æ•°å­¦å½¢å¼ï¼Œå®é™…æ±‚è§£è¿˜æ˜¯éœ€è¦ç¦»æ•£åŒ–ï¼Œæ¯”å¦‚æœ€ç®€å•çš„æ¬§æ‹‰æ ¼å¼ï¼š<br />
\begin{equation}\boldsymbol{x}<em _boldsymbol_theta="\boldsymbol{\theta">{t - \Delta t} = \boldsymbol{x}_t - \boldsymbol{v}</em>}}(\boldsymbol{x}_t,t) \Delta t\end{equation<br />
ä»$1$åˆ°$0$çš„NFEæ˜¯$1/\Delta t$ï¼Œæƒ³è¦NFEå°ç­‰ä»·äº$\Delta t$å¤§ã€‚ç„¶è€Œï¼ŒReFlowçš„ç†è®ºåŸºç¡€æ˜¯ç²¾ç¡®çš„ODEï¼Œå³ç²¾ç¡®æ±‚è§£ODEæ—¶æ‰èƒ½å®ç°ç›®æ ‡æ ·æœ¬çš„ç”Ÿæˆï¼Œè¿™æ„å‘³ç€$\Delta t$è¶Šå°è¶Šå¥½ï¼Œè·Ÿæˆ‘ä»¬çš„æœŸæœ›ç›¸èƒŒã€‚å°½ç®¡ReFlowå£°ç§°ä½¿ç”¨ç›´çº¿æ’å€¼å¯ä»¥è®©ODEçš„è½¨è¿¹å˜å¾—æ›´ç›´ï¼Œä»è€Œå…è®¸æ›´å¤§çš„$\Delta t$ï¼Œä½†å®é™…è½¨è¿¹ç»ˆç©¶æ˜¯å¼¯æ›²çš„ï¼Œ$\Delta t$å¾ˆéš¾æ¥è¿‘1ï¼Œæ‰€ä»¥ReFlowå¾ˆéš¾å®ç°ä¸€æ­¥ç”Ÿæˆã€‚</p>
<p>å½’æ ¹ç»“åº•ï¼ŒODEæœ¬æ¥å°±æ˜¯$\Delta t\to 0$çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬éè¦å°†å®ƒç”¨äº$\Delta t \to 1$ï¼Œè¿˜è¦æ±‚å®ƒæ•ˆæœå¥½ï¼Œè¿™æœ¬èº«å°±æ˜¯â€œå¼ºæ¨¡å‹æ‰€éš¾â€äº†ã€‚æ‰€ä»¥è¯´ï¼Œæ›´æ¢å»ºæ¨¡ç›®æ ‡ï¼Œè€Œä¸æ˜¯ç»§ç»­â€œä¸ºéš¾â€æ¨¡å‹ï¼Œæ‰æ˜¯å®ç°æ›´å¿«ç”Ÿæˆçš„æœ¬è´¨æ€è·¯ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬è€ƒè™‘å¯¹å¼$\eqref{eq:ode}$ä¸¤ç«¯è¿›è¡Œç§¯åˆ†<br />
\begin{equation}\boldsymbol{x}<em _boldsymbol_theta="\boldsymbol{\theta">t - \boldsymbol{x}_r = \int_r^t \boldsymbol{v}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">{\tau},\tau) d\tau = (t-r)\times \frac{1}{t-r}\int_r^t \boldsymbol{v}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">{\tau},\tau) d\tau\end{equation}<br />
å¦‚æœæˆ‘ä»¬å¯ä»¥å»ºæ¨¡<br />
\begin{equation} \boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) \triangleq \frac{1}{t-r}\int_r^t \boldsymbol{v}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">{\tau},\tau) d\tau\end{equation}<br />
é‚£ä¹ˆå°±æœ‰$\boldsymbol{x}_0 = \boldsymbol{x}_1 - \boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">1, 0, 1)$ï¼Œå³ç†è®ºä¸Šå¯ä»¥ç²¾å‡†åœ°å®ç°ä¸€æ­¥ç”Ÿæˆï¼Œè€Œä¸å¿…æ±‚è¯¸äºè¿‘ä¼¼å…³ç³»ã€‚å¦‚æœè¯´$\boldsymbol{v}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t,t)$æ˜¯$t$æ—¶åˆ»çš„ç¬æ—¶é€Ÿåº¦ï¼Œé‚£ä¹ˆå¾ˆæ˜¾ç„¶$\boldsymbol{u}</em>_t, r, t)$æ˜¯$[r,t]$æ—¶é—´æ®µå†…çš„å¹³å‡é€Ÿåº¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ºäº†åŠ é€Ÿç”Ÿæˆç”šè‡³ä¸€æ­¥ç”Ÿæˆï¼Œæˆ‘ä»¬çš„å»ºæ¨¡ç›®æ ‡åº”è¯¥æ˜¯å¹³å‡é€Ÿåº¦ï¼Œè€Œä¸æ˜¯ODEçš„ç¬æ—¶é€Ÿåº¦ã€‚}}(\boldsymbol{x</p>
<h2 id="_4">æ’ç­‰å˜æ¢</h2>
<p>å½“ç„¶ï¼Œä»ç¬æ—¶é€Ÿåº¦åˆ°å¹³å‡é€Ÿåº¦çš„è½¬å˜å¹¶ä¸éš¾æƒ³ï¼ŒçœŸæ­£éš¾çš„åœ°æ–¹æ˜¯å¦‚ä½•ç»™å®ƒæ„å»ºæŸå¤±å‡½æ•°ã€‚ReFlowåªå‘Šè¯‰æˆ‘ä»¬å¦‚ä½•ç»™ç¬æ—¶é€Ÿåº¦æ„å»ºæŸå¤±å‡½æ•°ï¼Œå¯¹å¹³å‡é€Ÿåº¦çš„è®­ç»ƒæˆ‘ä»¬æ˜¯ä¸€æ— æ‰€çŸ¥ã€‚</p>
<p>æ¥ä¸‹æ¥å¾ˆè‡ªç„¶çš„æƒ³æ³•æ˜¯â€œåŒ–æœªçŸ¥ä¸ºå·²çŸ¥â€ï¼Œå³ä»¥å¹³å‡é€Ÿåº¦$\boldsymbol{u}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t)$æ¥ä¸ºå‡ºå‘ç‚¹æ¥æ„å»ºç¬æ—¶é€Ÿåº¦$\boldsymbol{v}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t,t)$ï¼Œç„¶åä»£å…¥ReFlowçš„ç›®æ ‡å‡½æ•°ï¼Œè¿™éœ€è¦æˆ‘ä»¬å»æ¨å¯¼ä¸¤è€…ä¹‹é—´çš„æ’ç­‰å˜æ¢ã€‚ä»$\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t)$çš„å®šä¹‰æˆ‘ä»¬å¾—åˆ°<br />
\begin{equation} \int_r^t \boldsymbol{v}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">{\tau},\tau) d\tau = (t-r)\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) \end{equation}<br />
ä¸¤è¾¹å¯¹$t$æ±‚å¯¼ï¼Œå¾—åˆ°<br />
\begin{equation}\begin{aligned}<br />
\boldsymbol{v}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t,t) =&amp;\, \boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) + (t-r)\frac{d}{dt}\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) \\\<br />
=&amp;\, \boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) + (t-r)\left[\frac{d\boldsymbol{x}_t}{dt}\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) + \frac{\partial}{\partial t}\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t)\right]<br />
\end{aligned}\label{eq:id1}\end{equation}<br />
è¿™ä¾¿æ˜¯$\boldsymbol{v}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t,t)$è·Ÿ$\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t)$çš„ç¬¬ä¸€ä¸ªæ’ç­‰å…³ç³»ã€‚æœ‰ç¬¬ä¸€è‡ªç„¶å°±æœ‰ç¬¬äºŒï¼Œç¬¬äºŒä¸ªæ’ç­‰å…³ç³»ç”±å¹³å‡é€Ÿåº¦çš„å®šä¹‰å¾—åˆ°ï¼š<br />
\begin{equation}\boldsymbol{v}</em>}}(\boldsymbol{x<em r_to="r\to" t="t">t,t) = \lim</em>}\frac{1}{t-r}\int_r^t \boldsymbol{v<em _tau="\tau">{\boldsymbol{\theta}}(\boldsymbol{x}</em>},\tau) d\tau = \boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t, t)\label{eq:id2}\end{equation<br />
è¯´ç™½äº†ï¼Œæ— é™å°åŒºé—´å†…çš„å¹³å‡é€Ÿåº¦ï¼Œå°±ç­‰äºç¬æ—¶é€Ÿåº¦ã€‚</p>
<h2 id="_5">ç¬¬ä¸€ç›®æ ‡</h2>
<p>æ ¹æ®$d\boldsymbol{x}<em _boldsymbol_theta="\boldsymbol{\theta">t/dt = \boldsymbol{v}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t,t)$ä»¥åŠæ’ç­‰å¼$\eqref{eq:id2}$ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ’ç­‰å¼$\eqref{eq:id1}$çš„$d\boldsymbol{x}_t/dt$æ¢æˆ$\boldsymbol{v}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t,t)$æˆ–è€…$\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, t, t)$ï¼Œå‰è€…æ˜¯éšå¼å…³ç³»ï¼Œæˆ‘ä»¬åé¢å†è°ˆï¼Œæˆ‘ä»¬å…ˆçœ‹åè€…ï¼Œæ­¤æ—¶æœ‰ï¼š<br />
\begin{equation}\boldsymbol{v}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t,t) = \boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) + (t-r)\left[\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, t, t)\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) + \frac{\partial}{\partial t}\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t)\right]\end{equation}<br />
ä»£å…¥ReFlowï¼Œæˆ‘ä»¬å¾—åˆ°å¯ä»¥ç”¨æ¥è®­ç»ƒ$\boldsymbol{u}</em>}}(\boldsymbol{x<em r_t_boldsymbol_x="r,t,\boldsymbol{x">t, r, t)$çš„ç¬¬ä¸€ä¸ªç›®æ ‡å‡½æ•°ï¼š<br />
\begin{equation}\mathbb{E}</em><em _boldsymbol_theta="\boldsymbol{\theta">0,\boldsymbol{x}_1}\left[\left\Vert\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) + (t-r)\left[\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, t, t)\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) + \frac{\partial}{\partial t}\boldsymbol{u}</em>}}(\boldsymbol{x}_t, r, t)\right] - (\boldsymbol{x}_1 - \boldsymbol{x}_0)\right\Vert^2\right]\label{eq:loss-1}\end{equation<br />
è¿™æ˜¯ä¸€ä¸ªéå¸¸ç†æƒ³çš„ç»“æœï¼Œå®ƒæ»¡è¶³æˆ‘ä»¬å¯¹ç”Ÿæˆæ¨¡å‹ç›®æ ‡å‡½æ•°çš„æ‰€æœ‰æœŸæœ›ï¼š</p>
<blockquote>
<p>1ã€å•ä¸ªæ˜¾å¼çš„æœ€å°åŒ–ç›®æ ‡ï¼›</p>
<p>2ã€æ²¡æœ‰EMAã€stop_gradientç­‰è¿ç®—ï¼›</p>
<p>3ã€ç†è®ºä¸Šæœ‰ä¿è¯ï¼ˆReFlowï¼‰ã€‚</p>
</blockquote>
<p>è¿™äº›ç‰¹æ€§æ„å‘³ç€ï¼Œä¸ç®¡æˆ‘ä»¬ç”¨ä»€ä¹ˆä¼˜åŒ–ç®—æ³•ï¼Œåªè¦æˆ‘ä»¬èƒ½æ‰¾åˆ°ä¸Šå¼çš„æœ€å°å€¼ç‚¹ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„å¹³å‡é€Ÿåº¦æ¨¡å‹ï¼Œå³ç†è®ºä¸Šèƒ½å¤Ÿå®ç°ä¸€æ­¥ç”Ÿæˆçš„ç”Ÿæˆæ¨¡å‹ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒå…·å¤‡äº†æ‰©æ•£æ¨¡å‹çš„è®­ç»ƒç®€å•å’Œç†è®ºä¿è¯ï¼Œåˆèƒ½åƒGANé‚£æ ·ä¸€æ­¥ç”Ÿæˆï¼Œè¿˜ä¸ç”¨æ±‚ç¥æ‹œä½›ä¿ä½‘æ¨¡å‹åˆ«â€œæƒ³ä¸å¼€â€è€Œè®­å´©ã€‚</p>
<h2 id="jvp">JVPè¿ç®—</h2>
<p>ä¸è¿‡ï¼Œå¯¹äºéƒ¨åˆ†è¯»è€…æ¥è¯´ï¼Œç›®æ ‡å‡½æ•°$\eqref{eq:loss-1}$çš„å®ç°è¿˜æ˜¯æœ‰ç‚¹å›°éš¾çš„ï¼Œå› ä¸ºå®ƒæ¶‰åŠåˆ°æ™®é€šç”¨æˆ·æ¯”è¾ƒå°‘è§çš„â€œé›…å¯æ¯”å‘é‡ç§¯ï¼ˆJacobian-Vector Productï¼ŒJVPï¼‰â€ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç›®æ ‡å‡½æ•°å†…æ–¹æ‹¬å·éƒ¨åˆ†å†™æˆï¼š<br />
\begin{equation}\underbrace{\left[\boldsymbol{u}<em _text_å‘é‡="\text{å‘é‡">{\boldsymbol{\theta}}(\boldsymbol{x}_t, t, t),0,1\right] \\\[10pt]}</em>}}\cdot\underbrace{\left[\frac{\partial}{\partial \boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t}\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t), \frac{\partial}{\partial r}\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t), \frac{\partial}{\partial t}\boldsymbol{u}</em>}}(\boldsymbol{x<em _text_é›…å¯æ¯”çŸ©é˜µ="\text{é›…å¯æ¯”çŸ©é˜µ">t, r, t)\right] \\\[10pt]}</em>}}\end{equation<br />
å³$\boldsymbol{u}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t)$çš„é›…å¯æ¯”çŸ©é˜µä¸ç»™å®šå‘é‡$[\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, t, t),0,1]$çš„ä¹˜æ³•ï¼Œç»“æœæ˜¯ä¸€ä¸ªè·Ÿ$\boldsymbol{u}</em>_t, r, t)$å¤§å°ä¸€è‡´çš„å‘é‡ï¼Œè¿™ç§è¿ç®—å°±å«åšJVPï¼Œåœ¨Jaxã€Torché‡Œè¾¹éƒ½æœ‰ç°æˆå®ç°ï¼Œæ¯”å¦‚Jaxçš„å‚è€ƒä»£ç æ˜¯ï¼š}}(\boldsymbol{x</p>
<div class="codehilite"><pre><span></span><code>u = lambda xt, r, t: diffusion_model(weights, [xt, r, t])
urt, durt = jax.jvp(u, (xt, r, t), (u(xt, t, t), r <span class="gs">* 0, t *</span> 0 + 1))
</code></pre></div>

<p>å…¶ä¸­<code>urt</code>å°±æ˜¯$\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t)$ï¼Œè€Œ<code>durt</code>å°±æ˜¯å¯¹åº”çš„JVPç»“æœï¼ŒTorchçš„ç”¨æ³•ä¹Ÿç±»ä¼¼ã€‚äº†è§£JVPè¿ç®—åï¼Œç›®æ ‡å‡½æ•°$\eqref{eq:loss-1}$çš„å®ç°å°±åŸºæœ¬ä¸Šæ²¡æœ‰éš¾åº¦äº†ã€‚</p>
<h2 id="_6">ç¬¬äºŒç›®æ ‡</h2>
<p>å¦‚æœè¦è¯´ç›®æ ‡å‡½æ•°$\eqref{eq:loss-1}$çš„ç¼ºç‚¹ï¼Œåœ¨ç¬”è€…çœ‹æ¥åªæœ‰ä¸€ä¸ªï¼Œé‚£å°±æ˜¯è®¡ç®—é‡ç›¸å¯¹åå¤§ã€‚è¿™æ˜¯å› ä¸ºå®ƒè¦è¿›è¡Œä¸¤æ¬¡ä¸åŒçš„å‰å‘ä¼ æ’­$\boldsymbol{u}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t)$å’Œ$\boldsymbol{u}</em>_t, t, t)$ï¼Œç„¶åJVPæ±‚äº†ä¸€æ¬¡æ¢¯åº¦ï¼Œç”¨åŸºäºæ¢¯åº¦ä¸‹é™ä¼˜åŒ–æ—¶è¿˜è¦å†æ±‚ä¸€æ¬¡æ¢¯åº¦ï¼Œæ‰€ä»¥å®ƒæœ¬è´¨ä¸Šè¦æ±‚äºŒé˜¶æ¢¯åº¦ï¼Œè·Ÿä»¥å¾€çš„}}(\boldsymbol{x<a href="/archives/4439">WGAN-GP</a>ç±»ä¼¼ã€‚</p>
<p>ä¸ºäº†é™ä½è®¡ç®—é‡ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ç»™JVPéƒ¨åˆ†åŠ ä¸Šstop_gradientè¿ç®—ï¼ˆ$\newcommand{\sg}[1]{\color{skyblue}{\mathop{\text{sg}}\left[\color{blue}{#1}\right]}}\sg{\cdot}$ï¼‰ï¼š<br />
\begin{equation}\mathbb{E}<em _boldsymbol_theta="\boldsymbol{\theta">{r,t,\boldsymbol{x}_0,\boldsymbol{x}_1}\left[\left\Vert\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) + (t-r)\sg{\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, t, t)\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) + \frac{\partial}{\partial t}\boldsymbol{u}</em>}}(\boldsymbol{x}_t, r, t)} - (\boldsymbol{x}_1 - \boldsymbol{x}_0)\right\Vert^2\right]\label{eq:loss-2}\end{equation<br />
è¿™æ ·å°±é¿å…äº†å¯¹JVPå†æ¬¡æ±‚æ¢¯åº¦ï¼ˆä½†ä¾ç„¶éœ€è¦ä¸¤æ¬¡å‰å‘ä¼ æ’­ï¼‰ã€‚å®æµ‹ç»“æœæ˜¾ç¤ºï¼Œç›¸æ¯”ç¬¬ä¸€ç›®æ ‡$\eqref{eq:loss-1}$ï¼Œä¸Šè¿°ç›®æ ‡åœ¨æ¢¯åº¦ä¼˜åŒ–å™¨ä¸‹è®­ç»ƒé€Ÿåº¦èƒ½å¤Ÿå¿«å°†è¿‘ä¸€å€ï¼Œå¹¶ä¸”æ•ˆæœç›®æµ‹æ— æŸã€‚</p>
<p>æ³¨æ„ï¼Œè¿™é‡Œçš„stop_gradientå•çº¯æ˜¯å‡ºäºå‡å°‘è®¡ç®—é‡çš„ç›®çš„ï¼Œå®é™…ä¼˜åŒ–æ–¹å‘ä¾ç„¶æ˜¯æŸå¤±å‡½æ•°å€¼è¶Šå°è¶Šå¥½ï¼Œè¿™è·ŸCMç³»åˆ—æ¨¡å‹å°¤å…¶æ˜¯sCMæ˜¯ä¸ä¸€æ ·çš„ï¼Œå®ƒä»¬çš„æŸå¤±å‡½æ•°åªæ˜¯å…·æœ‰ç­‰æ•ˆæ¢¯åº¦çš„ç­‰æ•ˆæŸå¤±ï¼Œå¹¶ä¸ä¸€å®šæ˜¯è¶Šå°è¶Šå¥½ï¼Œå®ƒä»¬çš„stop_gradientå¾€å¾€æ˜¯å¿…é¡»çš„ï¼Œä¸€æ—¦å»æ‰å‡ ä¹å¯ä»¥è‚¯å®šä¼šè®­ç»ƒå´©æºƒã€‚</p>
<h2 id="_7">ç¬¬ä¸‰ç›®æ ‡</h2>
<p>å‰é¢æˆ‘ä»¬æåˆ°ï¼Œå¤„ç†æ’ç­‰å¼$\eqref{eq:id1}$ä¸­çš„$d\boldsymbol{x}<em _boldsymbol_theta="\boldsymbol{\theta">t/dt$çš„å¦ä¸€ä¸ªæ–¹æ¡ˆæ˜¯å°†å…¶æ¢æˆ$\boldsymbol{v}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t,t)$ï¼Œè¿™å°†å¯¼è‡´<br />
\begin{equation}\boldsymbol{v}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t,t) = \boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) + (t-r)\left[\boldsymbol{v}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t,t)\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) + \frac{\partial}{\partial t}\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t)\right]\end{equation}<br />
å¦‚æœè¦ä»ä¸­è§£å‡º$\boldsymbol{v}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t,t)$ï¼Œç»“æœå°†æ˜¯<br />
\begin{equation}\boldsymbol{v}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t,t) = \left[\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) + (t-r)\frac{\partial}{\partial t}\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t)\right]\cdot\left[\boldsymbol{I} - (t-r)\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t)\right]^{-1}\end{equation}<br />
è¿™æ¶‰åŠåˆ°äº†éå¸¸åºå¤§çš„çŸ©é˜µæ±‚é€†ï¼Œå› æ­¤å¹¶ä¸ç°å®ã€‚MeanFlowç»™å‡ºäº†ä¸€ä¸ªæŠ˜ä¸­æ–¹æ¡ˆï¼šæ—¢ç„¶$d\boldsymbol{x}_t/dt = \boldsymbol{v}</em>}}(\boldsymbol{x<em r_t_boldsymbol_x="r,t,\boldsymbol{x">t,t)$çš„å›å½’ç›®æ ‡æ˜¯$\boldsymbol{x}_1-\boldsymbol{x}_0$ï¼Œé‚£å¹²è„†æŠŠ$d\boldsymbol{x}_t/dt$æ¢æˆ$\boldsymbol{x}_1-\boldsymbol{x}_0$å¥½äº†ï¼Œäºæ˜¯ç›®æ ‡å‡½æ•°å˜æˆ<br />
\begin{equation}\mathbb{E}</em><em _boldsymbol_theta="\boldsymbol{\theta">0,\boldsymbol{x}_1}\left[\left\Vert\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) + (t-r)\left[(\boldsymbol{x}_1-\boldsymbol{x}_0)\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) + \frac{\partial}{\partial t}\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t)\right] - (\boldsymbol{x}_1 - \boldsymbol{x}_0)\right\Vert^2\right]\end{equation}<br />
ç„¶è€Œï¼Œæ­¤æ—¶çš„$\boldsymbol{x}_1-\boldsymbol{x}_0$æ—¢æ˜¯å›å½’ç›®æ ‡ï¼Œåˆå‡ºç°åœ¨æ¨¡å‹$\boldsymbol{v}</em>}}(\boldsymbol{x<em r_t_boldsymbol_x="r,t,\boldsymbol{x">t,t)$çš„å®šä¹‰ä¸­ï¼Œéš¾å…ä¼šæœ‰ä¸€ç§â€œæ ‡ç­¾æ³„æ¼â€çš„æ„Ÿè§‰ã€‚ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼ŒMeanFlowé‡‡å–çš„åŠæ³•åŒæ ·æ˜¯ç»™JVPéƒ¨åˆ†åŠ ä¸Šstop_gradientï¼š<br />
\begin{equation}\mathbb{E}</em><em _boldsymbol_theta="\boldsymbol{\theta">0,\boldsymbol{x}_1}\left[\left\Vert\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) + (t-r)\sg{(\boldsymbol{x}_1-\boldsymbol{x}_0)\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) + \frac{\partial}{\partial t}\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t)} - (\boldsymbol{x}_1 - \boldsymbol{x}_0)\right\Vert^2\right]\label{eq:loss-3}\end{equation}<br />
è¿™å°±æ˜¯MeanFlowæœ€ç»ˆæ‰€ç”¨çš„æŸå¤±å‡½æ•°ï¼Œè¿™é‡Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œç¬¬ä¸‰ç›®æ ‡â€ã€‚ç›¸æ¯”ç¬¬äºŒç›®æ ‡$\eqref{eq:loss-2}$ï¼Œå®ƒå°‘äº†ä¸€æ¬¡å‰å‘ä¼ æ’­$\boldsymbol{u}</em>_t, t, t)$ï¼Œæ‰€ä»¥è®­ç»ƒé€Ÿåº¦ä¼šæ›´å¿«ä¸€äº›ã€‚ä½†æ­¤æ—¶â€œæ ‡ç­¾æ³„æ¼â€çš„å¼•å…¥å’Œstop_gradientçš„å¯¹ç­–ï¼Œä½¿å¾—ç¬¬ä¸‰ç›®æ ‡çš„è®­ç»ƒè·Ÿæ¢¯åº¦ä¼˜åŒ–å™¨æ˜¯è€¦åˆçš„ï¼Œè¿™å°±è·ŸCMä¸€æ ·ï¼Œå¤šäº†ä¸€äº›è¯´ä¸æ¸…é“ä¸æ˜çš„ç¥ç§˜æ„Ÿã€‚}}(\boldsymbol{x</p>
<p>è®ºæ–‡å®éªŒç»“æœè¡¨æ˜ï¼ŒåŠ ä¸Š$\sg{\cdot}$çš„ç›®æ ‡$\eqref{eq:loss-3}$æ˜¯èƒ½è®­å‡ºåˆç†ç»“æœçš„ï¼Œé‚£å¦‚æœå»æ‰å®ƒå‘¢ï¼Ÿç¬”è€…å‘ä½œè€…è¯·æ•™è¿‡ï¼Œä»–è¡¨æ˜å»æ‰$\sg{\cdot}$åï¼Œè®­ç»ƒä¾ç„¶èƒ½æ”¶æ•›ï¼Œèƒ½å¤šæ­¥ç”Ÿæˆï¼Œä½†æ²¡æœ‰ä¸€æ­¥ç”Ÿæˆèƒ½åŠ›äº†ã€‚å…¶å®è¿™ä¹Ÿä¸éš¾ç†è§£ï¼Œå› ä¸º$r=t$æ—¶ä¸ç®¡æœ‰æ²¡æœ‰$\sg{\cdot}$ï¼Œç›®æ ‡å‡½æ•°éƒ½é€€åŒ–ä¸ºReFlowï¼š<br />
\begin{equation}\mathbb{E}<em _boldsymbol_theta="\boldsymbol{\theta">{t,\boldsymbol{x}_0,\boldsymbol{x}_1}\left[\Vert\boldsymbol{u}</em>}}(\boldsymbol{x}_t, t, t) - (\boldsymbol{x}_1 - \boldsymbol{x}_0)\Vert^2\right]\label{eq:loss-reflow-2}\end{equation<br />
ä¹Ÿå°±æ˜¯è¯´MeanFlowæ€»æœ‰ReFlowåœ¨èƒŒåâ€œå…œåº•â€ï¼Œå› æ­¤æ€æ ·ä¹Ÿä¸è‡³äºå¤ªå·®ã€‚è€Œå»æ‰$\sg{\cdot}$åï¼Œâ€œæ ‡ç­¾æ³„æ¼â€çš„è´Ÿé¢å½±å“åŠ å‰§ï¼Œå› æ­¤å°±ä¸å¦‚åŠ ä¸Šå®ƒäº†ã€‚</p>
<h2 id="_8">è¯æ˜ä¸€ä¸‹</h2>
<p>æˆ‘ä»¬èƒ½å¦åƒReFlowä¸€æ ·ï¼Œä»ç†è®ºä¸Šè¯æ˜ç¬¬ä¸‰ç›®æ ‡$\eqref{eq:loss-3}$çš„æœ€ä¼˜è§£ç¡®å®æ˜¯æˆ‘ä»¬æœŸæœ›çš„å¹³å‡é€Ÿåº¦æ¨¡å‹å‘¢ï¼Ÿè®©æˆ‘ä»¬å°è¯•ä¸€ä¸‹ã€‚é¦–å…ˆæˆ‘ä»¬å›é¡¾è¯æ˜ReFlowçš„ä¸¤ä¸ªå…³é”®å¼•ç†ï¼š</p>
<blockquote>
<p>1ã€$\mathop{\text{argmin}}_{\boldsymbol{\mu}}\mathbb{E}[\Vert\boldsymbol{\mu} - \boldsymbol{x}\Vert^2] = \mathbb{E}[\boldsymbol{x}]$ï¼Œå³æœ€å°åŒ–$\boldsymbol{\mu}$ä¸$\boldsymbol{x}$çš„å¹³æ–¹è¯¯å·®ï¼Œæœ€ä¼˜è§£æ˜¯$\boldsymbol{x}$çš„å‡å€¼ï¼›</p>
<p>2ã€æŒ‰ç…§åˆ†å¸ƒè½¨è¿¹$\boldsymbol{x}<em _boldsymbol_x="\boldsymbol{x">t=(1-t)\boldsymbol{x}_0 + t \boldsymbol{x}_1$å°†$\boldsymbol{x}_1$å˜åˆ°$\boldsymbol{x}_0$çš„ODEå½¢å¼è§£æ˜¯$d\boldsymbol{x}_t/dt = \mathbb{E}</em>_0]$ã€‚}_0|\boldsymbol{x}_t}[\boldsymbol{x}_1-\boldsymbol{x</p>
</blockquote>
<p>å…¶ä¸­ï¼Œå¼•ç†1çš„è¯æ˜æ¯”è¾ƒç®€å•ï¼Œç›´æ¥å¯¹$\boldsymbol{\mu}$æ±‚æ¢¯åº¦å¾—$\mathbb{E}[\boldsymbol{\mu} - \boldsymbol{x}] = \boldsymbol{\mu} - \mathbb{E}[\boldsymbol{x}]$ï¼Œä»¤å®ƒç­‰äºé›¶å³å¯ï¼›å¼•ç†2çš„è¯æ˜ç»†èŠ‚åˆ™éœ€è¦çœ‹<a href="/archives/9497">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆåä¸ƒï¼‰ï¼šæ„å»ºODEçš„ä¸€èˆ¬æ­¥éª¤ï¼ˆä¸‹ï¼‰ã€‹</a>ï¼Œå…¶ä¸­$\mathbb{E}_{\boldsymbol{x}_0|\boldsymbol{x}_t}[\boldsymbol{x}_1-\boldsymbol{x}_0]$æ˜¯éœ€è¦å…ˆåˆ©ç”¨$\boldsymbol{x}_t=(1-t)\boldsymbol{x}_0 + t \boldsymbol{x}_1$æ¶ˆå»$\boldsymbol{x}_1$ï¼Œå¾—åˆ°ä¸€ä¸ª$\boldsymbol{x}_0,\boldsymbol{x}_t$çš„å‡½æ•°ï¼Œç„¶åå¯¹åˆ†å¸ƒ$p_t(\boldsymbol{x}_0|\boldsymbol{x}_t)$æ±‚æœŸæœ›ï¼Œç»“æœæ˜¯å…³äº$t,\boldsymbol{x}_t$çš„å‡½æ•°ã€‚</p>
<p>åˆ©ç”¨å¼•ç†1ï¼Œæˆ‘ä»¬å¯ä»¥è¯æ˜ReFlowçš„ç›®æ ‡å‡½æ•°$\eqref{eq:loss-reflow}$çš„ç†è®ºæœ€ä¼˜è§£å°±æ˜¯$\boldsymbol{v}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}^<em>}(\boldsymbol{x}<em _boldsymbol_x="\boldsymbol{x">t,t) = \mathbb{E}</em><em _boldsymbol_theta="\boldsymbol{\theta">0|\boldsymbol{x}_t}[\boldsymbol{x}_1-\boldsymbol{x}_0]$ï¼Œç»“åˆå¼•ç†2å°±å¾—åˆ°$d\boldsymbol{x}_t/dt=\boldsymbol{v}</em>^</em>}(\boldsymbol{x}_t,t)$æ˜¯æˆ‘ä»¬æ‰€æ±‚çš„ODEã€‚ç¬¬ä¸‰ç›®æ ‡$\eqref{eq:loss-3}$çš„è¯æ˜ç±»ä¼¼ï¼Œç”±äºé‡Œè¾¹æœ‰$\sg{\cdot}$ï¼Œå¯¹$\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t)$æ±‚æ¢¯åº¦å¹¶è®©å®ƒç­‰äºé›¶çš„ç»“æœæ˜¯<br />
\begin{equation}\begin{aligned}<br />
\boldsymbol{0} =&amp;\, \boldsymbol{u}</em>^<em>}(\boldsymbol{x}<em _boldsymbol_x="\boldsymbol{x">t, r, t) + \mathbb{E}</em><em _boldsymbol_theta="\boldsymbol{\theta">0|\boldsymbol{x}_t}\left[(t-r)\left[(\boldsymbol{x}_1-\boldsymbol{x}_0)\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}</em>^</em>}(\boldsymbol{x}<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) + \frac{\partial}{\partial t}\boldsymbol{u}</em>^<em>}(\boldsymbol{x}<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t)\right] - (\boldsymbol{x}_1 - \boldsymbol{x}_0)\right] \\\<br />
=&amp;\, \boldsymbol{u}</em>^</em>}(\boldsymbol{x}<em _boldsymbol_x="\boldsymbol{x">t, r, t) + (t-r)\left[\mathbb{E}</em><em _boldsymbol_theta="\boldsymbol{\theta">0|\boldsymbol{x}_t}[\boldsymbol{x}_1-\boldsymbol{x}_0]\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}</em>^<em>}(\boldsymbol{x}<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) + \frac{\partial}{\partial t}\boldsymbol{u}</em>^</em>}(\boldsymbol{x}<em _boldsymbol_x="\boldsymbol{x">t, r, t)\right] - \mathbb{E}</em><em _boldsymbol_theta="\boldsymbol{\theta">0|\boldsymbol{x}_t}[\boldsymbol{x}_1 - \boldsymbol{x}_0] \\\<br />
=&amp;\, \boldsymbol{u}</em>^<em>}(\boldsymbol{x}<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) + (t-r)\left[\frac{d\boldsymbol{x}_t}{dt}\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}</em>^</em>}(\boldsymbol{x}<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) + \frac{\partial}{\partial t}\boldsymbol{u}</em>^<em>}(\boldsymbol{x}<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t)\right] - \frac{d\boldsymbol{x}_t}{dt} \\\<br />
=&amp;\, \frac{d}{dt}\left[(t - r) \boldsymbol{u}</em>^</em>}(\boldsymbol{x}<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) - (\boldsymbol{x}_t - \boldsymbol{x}_r)\right] \\\<br />
\end{aligned}\end{equation}<br />
æ‰€ä»¥åœ¨é€‚å½“çš„è¾¹ç•Œæ¡ä»¶ä¸‹å°±æœ‰$\boldsymbol{x}_t - \boldsymbol{x}_r = (t - r) \boldsymbol{u}</em>_t, r, t)$ï¼Œå³æˆ‘ä»¬æœŸæœ›çš„å¹³å‡é€Ÿåº¦æ¨¡å‹ã€‚}^*}(\boldsymbol{x</p>
<p>è¿™ä¸ªè¿‡ç¨‹çš„å…³é”®æ˜¯$\sg{\cdot}$çš„å¼•å…¥é¿å…äº†å¯¹JVPéƒ¨åˆ†æ±‚æ¢¯åº¦ï¼Œä»è€Œç®€åŒ–äº†æ¢¯åº¦è¡¨è¾¾å¼å¹¶å¾—åˆ°äº†æ­£ç¡®çš„ç»“æœã€‚å¦‚æœå»æ‰$\sg{\cdot}$çš„è¯ï¼Œä¸Šå¼å³ç«¯å°±è¦å¤šä¹˜ä¸€é¡¹JVPéƒ¨åˆ†å¯¹$\boldsymbol{u}_{\boldsymbol{\theta}^<em>}(\boldsymbol{x}<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t)$çš„é›…å¯æ¯”çŸ©é˜µï¼Œç»“æœå°±æ˜¯æœ€åæ— æ³•å°†$\frac{d}{dt}\left[(t - r) \boldsymbol{u}</em>^</em>}(\boldsymbol{x}_t, r, t) - (\boldsymbol{x}_t - \boldsymbol{x}_r)\right]$è¿™ä¸€é¡¹åˆ†ç¦»å‡ºæ¥ï¼Œè€Œå¼•å…¥$\sg{\cdot}$çš„æ•°å­¦æ„ä¹‰ä¾¿æ˜¯ä¸ºäº†è§£å†³æ­¤é—®é¢˜ã€‚</p>
<p>å½“ç„¶ï¼Œç¬”è€…è¿˜æ˜¯é‚£å¥è¯ï¼Œ$\sg{\cdot}$çš„å¼•å…¥ä¹Ÿä½¿å¾—æ•´ä¸ªæ¨¡å‹çš„è®­ç»ƒè€¦åˆäº†æ¢¯åº¦ä¼˜åŒ–å™¨ï¼Œå¤šäº†ä¸€ä¸ä¸æ¸…æ™°çš„æ„Ÿè§‰ã€‚æ­¤æ—¶æ¢¯åº¦ç­‰äºé›¶çš„ç‚¹ï¼Œé¡¶å¤šç®—æ˜¯ä¸€ä¸ªé©»ç‚¹è€Œéï¼ˆå±€éƒ¨ï¼‰æœ€å°å€¼ç‚¹ï¼Œæ‰€ä»¥ç¨³å®šæ€§ä¹Ÿä¸æ˜æœ—ï¼Œè¿™å…¶å®ä¹Ÿæ˜¯æ‰€æœ‰è€¦åˆ$\sg{\cdot}$çš„æ¨¡å‹çš„å…±æ€§ã€‚</p>
<h2 id="_9">ç›¸å…³å·¥ä½œ</h2>
<p>éå¸¸æœ‰è¶£çš„æ˜¯ï¼Œæˆ‘ä»¬ä¹‹å‰ä»‹ç»è¿‡çš„ä¸¤ç¯‡åŠ é€Ÿç”Ÿæˆçš„æ–‡ç« <a href="/archives/9881">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆäºŒåä¸€ï¼‰ï¼šä¸­å€¼å®šç†åŠ é€ŸODEé‡‡æ ·ã€‹</a>å’Œ<a href="/archives/10617">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆäºŒåä¸ƒï¼‰ï¼šå°†æ­¥é•¿ä½œä¸ºæ¡ä»¶è¾“å…¥ã€‹</a>ï¼Œä¹Ÿéƒ½æ˜¯ä»¥å¹³å‡é€Ÿåº¦ä¸ºæ ¸å¿ƒçš„ï¼Œå¹¶ä¸”æ€æƒ³ä¸Šå¯ä»¥è¯´æ˜¯ä¸€è„‰ç›¸æ‰¿çš„ã€‚å°½ç®¡ä½œè€…ä¹‹é—´æœªå¿…ç›¸äº’æœ‰è”ç³»ï¼Œä½†ä»–ä»¬çš„å·¥ä½œå†…å®¹ä¸Šç¡®å®ç»™äººä¸€ç§æ‰¿å‰å¯åçš„è¿è´¯æ„Ÿã€‚</p>
<p>åœ¨ä¸­å€¼å®šç†ç¯‡ï¼Œä½œè€…å·²ç»æ„è¯†åˆ°äº†å¹³å‡é€Ÿåº¦<br />
\begin{equation}\frac{1}{t-r}\int_r^t \boldsymbol{v}<em _tau="\tau">{\boldsymbol{\theta}}(\boldsymbol{x}</em>},\tau) d\tau\end{equation<br />
çš„é‡è¦æ€§ï¼Œä½†ä»–çš„åšæ³•æ˜¯ç±»æ¯”ä¸€ç»´å‡½æ•°çš„ç§¯åˆ†ä¸­å€¼å®šç†ï¼Œè¯•å›¾å¯»æ‰¾$s\in[r,t]$ä½¿å¾—$\boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x}_s,s)$ç­‰äºå¹³å‡é€Ÿåº¦ã€‚è¿™æœ¬è´¨ä¸Šè¿˜æ˜¯å¯»æ‰¾é«˜é˜¶Solverçš„æ€æƒ³ï¼Œä½†ä¸å†æ˜¯Training-Freeï¼Œè€Œæ˜¯éœ€è¦å°‘é‡çš„è’¸é¦æ­¥éª¤ï¼Œå¯¹Solveræ¥è¯´ç®—æ˜¯ä¸€ä¸ªå°çªç ´ã€‚</p>
<p>è€Œæ­¥é•¿è¾“å…¥ç¯‡æ‰€æçš„Shortcutæ¨¡å‹ï¼Œåˆ™å‡ ä¹å·²ç»è§¦ç¢°åˆ°äº†MeanFlowï¼Œå› ä¸ºæ­¥é•¿ä½œä¸ºé¢å¤–è¾“å…¥ï¼Œè·ŸMeanFlowçš„åŒæ—¶é—´å‚æ•°$r,t$å®è´¨æ˜¯ç­‰ä»·çš„ï¼Œä¸åŒçš„æ˜¯å®ƒæ˜¯ç›´æ¥ä»¥å¹³å‡é€Ÿåº¦çš„æ€§è´¨ä½œä¸ºé¢å¤–çš„æ­£åˆ™é¡¹æ¥è®­ç»ƒæ¨¡å‹ã€‚ç”¨æœ¬æ–‡çš„è®°å·ï¼Œå¹³å‡é€Ÿåº¦åº”è¯¥æ»¡è¶³çš„æ€§è´¨æ˜¯<br />
\begin{equation}\boldsymbol{u}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) = \frac{1}{2}\left[\boldsymbol{u}</em>}}\left(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, s, t\right) + \boldsymbol{u}</em>}}\left(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">s, r, s\right)\right]\end{equation}<br />
å…¶ä¸­$s = (r+t)/2$ã€‚æ‰€ä»¥Shortcutå¹²è„†ä»¥å®ƒæ¥æ„å»ºæ­£åˆ™é¡¹<br />
\begin{equation}\left\Vert\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) - \frac{1}{2}\sg{\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, s, t) + \boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">s, r, s)}\right\Vert^2\end{equation}<br />
è·ŸReFlowçš„ç›®æ ‡$\eqref{eq:loss-reflow-2}$æ··åˆè®­ç»ƒï¼Œå®é™…è®­ç»ƒä¸­$\boldsymbol{x}_s = \boldsymbol{x}_t - (t-s)\boldsymbol{u}</em>$çš„å¼•å…¥åœ¨ç¬”è€…çœ‹æ¥ä¸»è¦ä¹Ÿæ˜¯ä¸ºäº†èŠ‚çœè®¡ç®—é‡ã€‚Shortcutæ¨¡å‹å…¶å®æ¯”MeanFlowæ›´ç›´è§‚ï¼Œä½†ç”±äºæ²¡æœ‰æ’ç­‰å˜æ¢å’ŒReFlowå¸¦æ¥çš„ä¸¥æ ¼ç†è®ºæ”¯æ’‘ï¼Œä½¿å¾—å®ƒçœ‹ä¸Šå»æ›´å¤šæ˜¯ä¸€ä¸ªè¿‡æ¸¡æœŸçš„ç»éªŒäº§ç‰©ã€‚}}(\boldsymbol{x}_t, s, t)$ï¼Œ$\sg{\cdot</p>
<h2 id="_10">ä¸€è‡´æ¨¡å‹</h2>
<p>æœ€åæˆ‘ä»¬å†æ¥è®¨è®ºä¸€ä¸‹ä¸€è‡´æ€§æ¨¡å‹ã€‚ç”±äºCMã€sCMç ç‰åœ¨å‰ï¼ŒMeanFlowçš„æˆåŠŸå®é™…ä¸Šä¹Ÿå€Ÿé‰´äº†å®ƒä»¬çš„ç»éªŒï¼Œå°¤å…¶æ˜¯ç»™JVPåŠ $\sg{\cdot}$çš„æ“ä½œï¼Œè¿™åœ¨åŸè®ºæ–‡ä¸­ä¹Ÿæœ‰æåˆ°ã€‚å½“ç„¶ï¼ŒMeanFlowä½œè€…ä¹‹ä¸€ä½•æºæ˜è€å¸ˆæœ¬èº«ä¹Ÿæ˜¯æ“æ§æ¢¯åº¦çš„å¤§å¸ˆï¼ˆæ¯”å¦‚<a href="/archives/7980">SimSiam</a>ï¼‰ï¼Œæ‰€ä»¥MeanFlowçš„å‡ºç°çœ‹èµ·æ¥æ˜¯éå¸¸æ°´åˆ°æ¸ æˆçš„ã€‚</p>
<p>ç¦»æ•£çš„CMæˆ‘ä»¬åœ¨<a href="/archives/10633">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆäºŒåå…«ï¼‰ï¼šåˆ†æ­¥ç†è§£ä¸€è‡´æ€§æ¨¡å‹ã€‹</a>ä»”ç»†åˆ†æè¿‡ï¼Œå¦‚æœå°†å…¶ä¸­CMçš„EMAç®—ç¬¦æ¢æˆstop_gradientï¼Œæ±‚æ¢¯åº¦å¹¶å–$\Delta t\to 0$çš„æé™ï¼Œé‚£ä¹ˆå°±å¾—åˆ°äº†<a href="https://papers.cool/arxiv/2410.11081">ã€ŠSimplifying, Stabilizing and Scaling Continuous-Time Consistency Modelsã€‹</a>ä¸­çš„sCMçš„ç›®æ ‡å‡½æ•°ï¼š<br />
\begin{equation}\boldsymbol{f}<em _sg_boldsymbol_theta="\sg{\boldsymbol{\theta">{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)\cdot \frac{d}{dt}\boldsymbol{f}</em>}}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, t) = \boldsymbol{f}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, t)\cdot\sg{\frac{d\boldsymbol{x}_t}{dt}\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{f}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, t) + \frac{\partial}{\partial t}\boldsymbol{f}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, t)}\label{eq:loss-scm}\end{equation}<br />
å¦‚æœå°†$\frac{d\boldsymbol{x}_t}{dt}$æ¢æˆ$\boldsymbol{x}_1 - \boldsymbol{x}_0$ï¼Œç„¶åè®°$\boldsymbol{f}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, t) = \boldsymbol{x}_t - t\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t , 0, t)$ï¼Œé‚£ä¹ˆå®ƒçš„æ¢¯åº¦è·Ÿ$r=0$æ—¶çš„MeanFlowç¬¬ä¸‰ç›®æ ‡$\eqref{eq:loss-3}$æ˜¯ç­‰ä»·çš„ï¼š<br />
\begin{equation}\begin{aligned}<br />
\nabla</em>}}\eqref{eq:loss-scm} =&amp;\, \nabla_{\boldsymbol{\theta}}\boldsymbol{f<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)\cdot \left[\frac{d\boldsymbol{x}_t}{dt}\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{f}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, t) + \frac{\partial}{\partial t}\boldsymbol{f}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, t)\right] \\\[10pt]<br />
=&amp;\, -t\nabla</em>}}\boldsymbol{u<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}(\boldsymbol{x}_t, 0, t)\cdot \left[\frac{d\boldsymbol{x}_t}{dt} - t\frac{d\boldsymbol{x}_t}{dt}\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, 0, t) - \boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, 0, t) - t\frac{\partial}{\partial t}\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, 0, t)\right] \\\[10pt]<br />
=&amp;\, t\nabla</em>}}\boldsymbol{u<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}(\boldsymbol{x}_t, 0, t)\cdot \left[\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, 0, t) + t\left[\frac{d\boldsymbol{x}_t}{dt}\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, 0, t) + \frac{\partial}{\partial t}\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, 0, t)\right]- \frac{d\boldsymbol{x}_t}{dt}\right] \\\[10pt]<br />
=&amp;\, \frac{t}{2}\nabla</em>}}\left\Vert\boldsymbol{u<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}(\boldsymbol{x}_t, 0, t) + t\sg{\frac{d\boldsymbol{x}_t}{dt}\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, 0, t) + \frac{\partial}{\partial t}\boldsymbol{u}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, 0, t)}- \frac{d\boldsymbol{x}_t}{dt}\right\Vert^2 \\\[10pt]<br />
\sim &amp;\, \left.\nabla</em>}}\eqref{eq:loss-3}\right|_{r=0<br />
\end{aligned}\end{equation}</p>
<p>æ‰€ä»¥ï¼Œä»è¿™ä¸ªè§’åº¦çœ‹ï¼ŒsCMæ˜¯MeanFlowåœ¨$r=0$æ—¶çš„ä¸€ä¸ªç‰¹ä¾‹ã€‚æ­£å¦‚å‰é¢æ‰€è¯´ï¼Œå¼•å…¥å¦å¤–çš„æ—¶é—´å‚æ•°$r$å¯ä»¥è®©ReFlowç»™MeanFlowâ€œå…œåº•â€ï¼ˆ$r=t$æ—¶ï¼‰ï¼Œä»è€Œæ›´å¥½åœ°é¿å…è®­å´©ï¼Œè¿™æ˜¯å®ƒçš„ä¼˜ç‚¹ä¹‹ä¸€ã€‚å½“ç„¶ï¼Œä»sCMå‡ºå‘å…¶å®ä¹Ÿå¯ä»¥å¼•å…¥åŒæ—¶é—´å‚æ•°ï¼Œå¾—åˆ°è·Ÿç¬¬ä¸‰ç›®æ ‡å®Œå…¨ç›¸åŒçš„ç»“æœï¼Œä½†ä»ä¸ªäººçš„å®¡ç¾æ¥çœ‹ï¼ŒCMã€sCMçš„ç‰©ç†æ„ä¹‰ç»ˆç©¶ä¸å¦‚MeanFlowå¹³å‡é€Ÿåº¦çš„è¯ é‡Šç›´è§‚ã€‚</p>
<p>æ­¤å¤–ï¼Œå¹³å‡é€Ÿåº¦å’ŒReFlowç»“åˆçš„å‡ºå‘ç‚¹ï¼Œè¿˜å¯ä»¥å¾—åˆ°å¦å¤–çš„ç¬¬ä¸€ç›®æ ‡$\eqref{eq:loss-1}$å’Œç¬¬äºŒç›®æ ‡$\eqref{eq:loss-2}$ï¼Œè¿™å¯¹äºåƒç¬”è€…è¿™æ ·çš„stop_gradientæ´ç™–æ‚£è€…æ¥è¯´æ˜¯éå¸¸èˆ’é€‚å’Œæ¼‚äº®çš„ç»“æœã€‚åœ¨ç¬”è€…çœ‹æ¥ï¼Œä»è®¡ç®—æˆæœ¬å‡ºå‘ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥è€ƒè™‘ç»™æŸå¤±å‡½æ•°åŠ ä¸Šstop_gradientï¼Œä½†æ¨å¯¼çš„ç¬¬ä¸€æ€§åŸç†å’ŒåŸºæœ¬ç»“æœä¸åº”è¯¥è·Ÿstop_gradientè€¦åˆï¼Œå¦åˆ™æ„å‘³ç€å®ƒè·Ÿä¼˜åŒ–å™¨å’ŒåŠ¨åŠ›å­¦æ˜¯å¼ºè€¦åˆçš„ï¼Œè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªæœ¬è´¨ç»“æœåº”æœ‰çš„è¡¨ç°ã€‚</p>
<h2 id="_11">æ–‡ç« å°ç»“</h2>
<p>æœ¬æ–‡ä»¥æœ€è¿‘å‡ºæ¥çš„MeanFlowä¸ºä¸­å¿ƒï¼Œè®¨è®ºäº†â€œå¹³å‡é€Ÿåº¦â€è§†è§’ä¸‹çš„æ‰©æ•£æ¨¡å‹åŠ é€Ÿç”Ÿæˆæ€è·¯ã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/10958">https://spaces.ac.cn/archives/10958</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (May. 26, 2025). ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆä¸‰åï¼‰ï¼šä»ç¬æ—¶é€Ÿåº¦åˆ°å¹³å‡é€Ÿåº¦ ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/10958">https://spaces.ac.cn/archives/10958</a></p>
<p>@online{kexuefm-10958,<br />
title={ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆä¸‰åï¼‰ï¼šä»ç¬æ—¶é€Ÿåº¦åˆ°å¹³å‡é€Ÿåº¦},<br />
author={è‹å‰‘æ—},<br />
year={2025},<br />
month={May},<br />
url={\url{https://spaces.ac.cn/archives/10958}},<br />
} </p>
<hr />
<h2 id="_12">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<h3 id="1">1. æ ¸å¿ƒæ¦‚å¿µä¸æ•°å­¦æ¡†æ¶</h3>
<h4 id="11-ode">1.1 ODEå¼æ‰©æ•£æ¨¡å‹çš„åŸºæœ¬è®¾å®š</h4>
<p>åœ¨æ‰©æ•£æ¨¡å‹ä¸­,æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å­¦ä¹ ä¸€ä¸ªä»ç®€å•åˆ†å¸ƒ(å¦‚æ ‡å‡†æ­£æ€åˆ†å¸ƒ)åˆ°å¤æ‚æ•°æ®åˆ†å¸ƒçš„å˜æ¢ã€‚ODEå¼æ‰©æ•£æ¨¡å‹é€šè¿‡ä»¥ä¸‹å¸¸å¾®åˆ†æ–¹ç¨‹æ¥å®ç°è¿™ä¸€å˜æ¢:</p>
<p>$$\frac{d\boldsymbol{x}_t}{dt} = \boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x}_t,t) \tag{1}$$</p>
<p><strong>ç¬¦å·è¯´æ˜:</strong>
- $\boldsymbol{x}<em _boldsymbol_theta="\boldsymbol{\theta">t$: æ—¶åˆ»$t$çš„çŠ¶æ€å˜é‡,å¯ä»¥ç†è§£ä¸ºå›¾åƒåœ¨åŠ å™ªè¿‡ç¨‹ä¸­çš„ä¸­é—´çŠ¶æ€
- $t \in [0,1]$: æ—¶é—´å‚æ•°,é€šå¸¸$t=1$å¯¹åº”çº¯å™ªå£°,$t=0$å¯¹åº”çœŸå®æ•°æ®
- $\boldsymbol{v}</em>_t,t)$: å‚æ•°åŒ–çš„é€Ÿåº¦åœº,æè¿°çŠ¶æ€å˜åŒ–çš„ç¬æ—¶é€Ÿåº¦
- $\boldsymbol{\theta}$: ç¥ç»ç½‘ç»œå‚æ•°}}(\boldsymbol{x</p>
<p><strong>ç‰©ç†ç›´è§‰:</strong> å°†$t$çœ‹ä½œæ—¶é—´,$\boldsymbol{x}_t$çœ‹ä½œä½ç§»,åˆ™$\frac{d\boldsymbol{x}_t}{dt}$å°±æ˜¯ç¬æ—¶é€Ÿåº¦ã€‚</p>
<h4 id="12-reflow">1.2 ReFlowæ¡†æ¶</h4>
<p>ReFlowæä¾›äº†ä¸€ç§ç›´è§‚çš„æ–¹æ³•æ¥è®­ç»ƒé€Ÿåº¦åœº$\boldsymbol{v}_{\boldsymbol{\theta}}$ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯:</p>
<ol>
<li>
<p><strong>æ„å»ºæ’å€¼è·¯å¾„:</strong> åœ¨æ•°æ®ç‚¹$\boldsymbol{x}_0$å’Œå™ªå£°ç‚¹$\boldsymbol{x}_1$ä¹‹é—´æ„å»ºæ’å€¼
   $$\boldsymbol{x}_t = (1-t)\boldsymbol{x}_0 + t\boldsymbol{x}_1 \tag{2}$$</p>
</li>
<li>
<p><strong>è®¡ç®—ç²¾ç¡®é€Ÿåº¦:</strong> å¯¹æ’å€¼è·¯å¾„æ±‚å¯¼å¾—åˆ°ç²¾ç¡®çš„é€Ÿåº¦åœº
   $$\frac{d\boldsymbol{x}_t}{dt} = \boldsymbol{x}_1 - \boldsymbol{x}_0 \tag{3}$$</p>
</li>
<li>
<p><strong>ç›‘ç£å­¦ä¹ :</strong> ç”¨ç¥ç»ç½‘ç»œ$\boldsymbol{v}_{\boldsymbol{\theta}}$æ‹Ÿåˆè¿™ä¸ªé€Ÿåº¦åœº
   $$\mathcal{L}_{\text{ReFlow}} = \mathbb{E}_{t,\boldsymbol{x}_0,\boldsymbol{x}_1}\left[\|\boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x}_t,t) - (\boldsymbol{x}_1 - \boldsymbol{x}_0)\|^2\right] \tag{4}$$</p>
</li>
</ol>
<p><strong>ç†è®ºä¿è¯:</strong> å¯ä»¥è¯æ˜,å½“æŸå¤±å‡½æ•°æœ€å°åŒ–æ—¶,å­¦åˆ°çš„ODEç¡®å®èƒ½å°†å™ªå£°åˆ†å¸ƒ$p_1$å˜æ¢ä¸ºæ•°æ®åˆ†å¸ƒ$p_0$ã€‚</p>
<h3 id="2">2. ä»ç¬æ—¶é€Ÿåº¦åˆ°å¹³å‡é€Ÿåº¦çš„åŠ¨æœº</h3>
<h4 id="21-ode">2.1 ODEç¦»æ•£åŒ–çš„é—®é¢˜</h4>
<p>åœ¨å®é™…åº”ç”¨ä¸­,æˆ‘ä»¬éœ€è¦å¯¹ODEè¿›è¡Œç¦»æ•£åŒ–æ±‚è§£ã€‚æœ€ç®€å•çš„æ¬§æ‹‰æ–¹æ³•ä¸º:</p>
<p>$$\boldsymbol{x}_{t-\Delta t} = \boldsymbol{x}_t - \boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x}_t,t) \Delta t \tag{5}$$</p>
<p><strong>å…³é”®çŸ›ç›¾:</strong>
- <strong>ç†è®ºè¦æ±‚:</strong> ODEçš„ç²¾ç¡®æ±‚è§£éœ€è¦$\Delta t \to 0$,å³æ­¥é•¿è¶Šå°è¶Šå¥½
- <strong>å®é™…éœ€æ±‚:</strong> ä¸ºäº†åŠ é€Ÿç”Ÿæˆ,æˆ‘ä»¬å¸Œæœ›$\Delta t$å°½å¯èƒ½å¤§,æœ€å¥½$\Delta t = 1$å®ç°ä¸€æ­¥ç”Ÿæˆ
- <strong>æ€§èƒ½é—®é¢˜:</strong> ReFlowè™½ç„¶å£°ç§°ç›´çº¿æ’å€¼ä½¿è½¨è¿¹æ›´ç›´,ä½†å®é™…è½¨è¿¹ä»æœ‰å¼¯æ›²,$\Delta t$å¾ˆéš¾æ¥è¿‘1</p>
<h4 id="22">2.2 å¹³å‡é€Ÿåº¦çš„å®šä¹‰</h4>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªçŸ›ç›¾,æˆ‘ä»¬è€ƒè™‘å¯¹ODEä¸¤ç«¯ç§¯åˆ†:</p>
<p>$$\int_r^t \frac{d\boldsymbol{x}_{\tau}}{d\tau} d\tau = \int_r^t \boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x}_{\tau},\tau) d\tau \tag{6}$$</p>
<p>å·¦ç«¯ç§¯åˆ†ä¸º:
$$\boldsymbol{x}_t - \boldsymbol{x}_r = \int_r^t \boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x}_{\tau},\tau) d\tau \tag{7}$$</p>
<p><strong>æ”¹å†™ä¸ºå¹³å‡é€Ÿåº¦å½¢å¼:</strong>
$$\boldsymbol{x}_t - \boldsymbol{x}_r = (t-r) \cdot \frac{1}{t-r}\int_r^t \boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x}_{\tau},\tau) d\tau \tag{8}$$</p>
<p><strong>å®šä¹‰å¹³å‡é€Ÿåº¦:</strong>
$$\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) \triangleq \frac{1}{t-r}\int_r^t \boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x}_{\tau},\tau) d\tau \tag{9}$$</p>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿:</strong> å¦‚æœèƒ½ç›´æ¥å»ºæ¨¡å¹³å‡é€Ÿåº¦$\boldsymbol{u}_{\boldsymbol{\theta}}$,åˆ™æœ‰:
$$\boldsymbol{x}_0 = \boldsymbol{x}_1 - \boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_1, 0, 1) \tag{10}$$</p>
<p>è¿™æ ·å°±å¯ä»¥<strong>ç†è®ºä¸Šç²¾ç¡®åœ°</strong>å®ç°ä¸€æ­¥ç”Ÿæˆ,æ— éœ€ä¾èµ–ç¦»æ•£åŒ–è¿‘ä¼¼!</p>
<h3 id="3">3. ç¬æ—¶é€Ÿåº¦ä¸å¹³å‡é€Ÿåº¦çš„æ’ç­‰å˜æ¢</h3>
<h4 id="31">3.1 ç¬¬ä¸€ä¸ªæ’ç­‰å…³ç³»çš„æ¨å¯¼</h4>
<p>ä»å¹³å‡é€Ÿåº¦çš„å®šä¹‰å‡ºå‘:
$$\int_r^t \boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x}_{\tau},\tau) d\tau = (t-r)\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) \tag{11}$$</p>
<p><strong>ä¸¤ç«¯å¯¹$t$æ±‚å¯¼</strong> (åº”ç”¨Leibnizç§¯åˆ†æ³•åˆ™):</p>
<p>å·¦ç«¯æ±‚å¯¼:
$$\frac{d}{dt}\left[\int_r^t \boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x}_{\tau},\tau) d\tau\right] = \boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x}_t,t) \tag{12}$$</p>
<p>å³ç«¯æ±‚å¯¼(åº”ç”¨ä¹˜ç§¯æ³•åˆ™):
$$\frac{d}{dt}\left[(t-r)\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t)\right] = \boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) + (t-r)\frac{d}{dt}\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) \tag{13}$$</p>
<p><strong>å¯¹$\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t)$åº”ç”¨é“¾å¼æ³•åˆ™:</strong></p>
<p>$\boldsymbol{u}_{\boldsymbol{\theta}}$æ˜¯å…³äº$\boldsymbol{x}_t$å’Œ$t$çš„å‡½æ•°,å› æ­¤å…¨å¯¼æ•°ä¸º:
$$\frac{d}{dt}\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) = \frac{d\boldsymbol{x}_t}{dt}\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) + \frac{\partial}{\partial t}\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) \tag{14}$$</p>
<p><strong>ç¬¬ä¸€ä¸ªæ’ç­‰å…³ç³»:</strong>
ç»“åˆ(12)-(14),å¾—åˆ°:
$$\boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x}_t,t) = \boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) + (t-r)\left[\frac{d\boldsymbol{x}_t}{dt}\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) + \frac{\partial}{\partial t}\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t)\right] \tag{15}$$</p>
<h4 id="32">3.2 ç¬¬äºŒä¸ªæ’ç­‰å…³ç³»çš„æ¨å¯¼</h4>
<p>ä»å¹³å‡é€Ÿåº¦çš„å®šä¹‰,è€ƒè™‘æé™æƒ…å†µ$r \to t$:</p>
<p>$$\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) = \frac{1}{t-r}\int_r^t \boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x}_{\tau},\tau) d\tau \tag{16}$$</p>
<p><strong>åº”ç”¨L'HÃ´pitalæ³•åˆ™æˆ–ç§¯åˆ†ä¸­å€¼å®šç†:</strong></p>
<p>å½“$r \to t$æ—¶,åˆ†å­åˆ†æ¯éƒ½è¶‹äº0,åº”ç”¨L'HÃ´pitalæ³•åˆ™:
$$\lim_{r \to t} \boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) = \lim_{r \to t} \frac{\int_r^t \boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x}_{\tau},\tau) d\tau}{t-r} \tag{17}$$</p>
<p>å¯¹åˆ†å­æ±‚å¯¼(å¯¹$r$):
$$\frac{\partial}{\partial r}\left[\int_r^t \boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x}_{\tau},\tau) d\tau\right] = -\boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x}_r,r) \tag{18}$$</p>
<p>å¯¹åˆ†æ¯æ±‚å¯¼:
$$\frac{\partial}{\partial r}(t-r) = -1 \tag{19}$$</p>
<p>å› æ­¤:
$$\lim_{r \to t} \boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) = \boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x}_t,t) \tag{20}$$</p>
<p><strong>ç¬¬äºŒä¸ªæ’ç­‰å…³ç³»:</strong>
$$\boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x}_t,t) = \boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t, t) \tag{21}$$</p>
<p><strong>ç‰©ç†ç›´è§‰:</strong> æ— é™å°æ—¶é—´åŒºé—´å†…çš„å¹³å‡é€Ÿåº¦å°±ç­‰äºç¬æ—¶é€Ÿåº¦ã€‚</p>
<h3 id="4-meanflow">4. MeanFlowçš„ä¸‰ä¸ªè®­ç»ƒç›®æ ‡</h3>
<h4 id="41">4.1 ç¬¬ä¸€ç›®æ ‡çš„æ¨å¯¼(æœ€ç†æƒ³)</h4>
<p><strong>ç­–ç•¥:</strong> ç”¨å¹³å‡é€Ÿåº¦$\boldsymbol{u}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}$æ¥è¡¨è¾¾ç¬æ—¶é€Ÿåº¦$\boldsymbol{v}</em>$,ç„¶åä»£å…¥ReFlowç›®æ ‡ã€‚}</p>
<p><strong>æ­¥éª¤1:</strong> å°†ç¬¬äºŒæ’ç­‰å…³ç³»(21)ä»£å…¥ç¬¬ä¸€æ’ç­‰å…³ç³»(15)ä¸­çš„$\frac{d\boldsymbol{x}_t}{dt}$:</p>
<p>$$\boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x}_t,t) = \boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) + (t-r)\left[\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t, t)\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) + \frac{\partial}{\partial t}\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t)\right] \tag{22}$$</p>
<p><strong>æ­¥éª¤2:</strong> ä»£å…¥ReFlowçš„æŸå¤±å‡½æ•°(4):</p>
<p>$$\mathcal{L}_1 = \mathbb{E}_{r,t,\boldsymbol{x}_0,\boldsymbol{x}_1}\left[\left\|\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) + (t-r)\left[\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t, t)\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) + \frac{\partial}{\partial t}\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t)\right] - (\boldsymbol{x}_1 - \boldsymbol{x}_0)\right\|^2\right] \tag{23}$$</p>
<p><strong>ä¼˜ç‚¹åˆ†æ:</strong>
1. <strong>å•ä¸€ç›®æ ‡:</strong> åªæœ‰ä¸€ä¸ªæœ€å°åŒ–ç›®æ ‡,æ²¡æœ‰å¯¹æŠ—æˆ–å¤šç›®æ ‡ä¼˜åŒ–
2. <strong>æ— EMA:</strong> ä¸éœ€è¦æŒ‡æ•°ç§»åŠ¨å¹³å‡,è®­ç»ƒæ›´ç¨³å®š
3. <strong>æ— stop_gradient:</strong> ä¸ä¾èµ–æ¢¯åº¦æˆªæ–­æŠ€å·§
4. <strong>ç†è®ºä¿è¯:</strong> ç»§æ‰¿ReFlowçš„ç†è®ºä¿è¯</p>
<p><strong>è®¡ç®—è¦æ±‚:</strong>
- éœ€è¦ä¸¤æ¬¡å‰å‘ä¼ æ’­: $\boldsymbol{u}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t)$å’Œ$\boldsymbol{u}</em>_t, t, t)$
- éœ€è¦è®¡ç®—JVP(é›…å¯æ¯”å‘é‡ç§¯)
- åå‘ä¼ æ’­æ—¶éœ€è¦äºŒé˜¶æ¢¯åº¦}}(\boldsymbol{x</p>
<h4 id="42-jvp">4.2 é›…å¯æ¯”å‘é‡ç§¯(JVP)çš„ç†è§£</h4>
<p><strong>å®šä¹‰:</strong> ç»™å®šå‡½æ•°$f: \mathbb{R}^n \to \mathbb{R}^m$å’Œåˆ‡å‘é‡$\boldsymbol{v} \in \mathbb{R}^n$,JVPè®¡ç®—:</p>
<p>$$\text{JVP}(f, \boldsymbol{v}) = J_f \cdot \boldsymbol{v} = \frac{\partial f}{\partial \boldsymbol{x}} \boldsymbol{v} \tag{24}$$</p>
<p>å…¶ä¸­$J_f \in \mathbb{R}^{m \times n}$æ˜¯é›…å¯æ¯”çŸ©é˜µã€‚</p>
<p><strong>åœ¨MeanFlowä¸­çš„åº”ç”¨:</strong></p>
<p>å‡½æ•°: $f(\boldsymbol{x}<em _boldsymbol_theta="\boldsymbol{\theta">t, r, t) = \boldsymbol{u}</em>_t, r, t)$}}(\boldsymbol{x</p>
<p>è¾“å…¥å‘é‡: $(\boldsymbol{x}_t, r, t)$</p>
<p>åˆ‡å‘é‡: $(\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t, t), 0, 1)$</p>
<p>JVPç»“æœ:
$$\text{JVP} = \boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t, t) \cdot \frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) + 0 \cdot \frac{\partial}{\partial r}\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) + 1 \cdot \frac{\partial}{\partial t}\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) \tag{25}$$</p>
<p><strong>è®¡ç®—æ•ˆç‡:</strong> JVPçš„è®¡ç®—å¤æ‚åº¦ä¸å‰å‘ä¼ æ’­ç›¸åŒ,è¿œå°äºå®Œæ•´é›…å¯æ¯”çŸ©é˜µçš„è®¡ç®—ã€‚</p>
<h4 id="43">4.3 ç¬¬äºŒç›®æ ‡(å‡å°‘è®¡ç®—é‡)</h4>
<p><strong>é—®é¢˜:</strong> ç¬¬ä¸€ç›®æ ‡éœ€è¦å¯¹JVPå†æ¬¡æ±‚æ¢¯åº¦,è®¡ç®—é‡è¾ƒå¤§ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ:</strong> å¯¹JVPéƒ¨åˆ†æ·»åŠ stop_gradient:</p>
<p>$$\mathcal{L}_2 = \mathbb{E}_{r,t,\boldsymbol{x}_0,\boldsymbol{x}_1}\left[\left\|\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) + (t-r)\text{sg}\left[\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t, t)\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) + \frac{\partial}{\partial t}\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t)\right] - (\boldsymbol{x}_1 - \boldsymbol{x}_0)\right\|^2\right] \tag{26}$$</p>
<p>å…¶ä¸­$\text{sg}[\cdot]$è¡¨ç¤ºstop_gradientæ“ä½œã€‚</p>
<p><strong>æ¢¯åº¦åˆ†æ:</strong></p>
<p>å¯¹$\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t)$æ±‚æ¢¯åº¦æ—¶:</p>
<p>ä¸å«stop_gradientçš„é¡¹:
$$\nabla_{\boldsymbol{\theta}} \boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) \tag{27}$$</p>
<p>å«stop_gradientçš„é¡¹ä¸äº§ç”Ÿæ¢¯åº¦:
$$\nabla_{\boldsymbol{\theta}} \text{sg}[...] = 0 \tag{28}$$</p>
<p><strong>æ•ˆæœ:</strong>
- è®­ç»ƒé€Ÿåº¦æå‡çº¦2å€
- å®éªŒè¡¨æ˜æ•ˆæœæ— æ˜æ˜¾æŸå¤±
- ä»éœ€ä¸¤æ¬¡å‰å‘ä¼ æ’­</p>
<p><strong>ä¸Consistency Modelçš„åŒºåˆ«:</strong>
- MeanFlowçš„stop_gradientæ˜¯ä¸ºäº†<strong>è®¡ç®—æ•ˆç‡</strong>
- æŸå¤±å‡½æ•°å€¼è¶Šå°è¶Šå¥½(çœŸå®çš„ä¼˜åŒ–ç›®æ ‡)
- CMçš„stop_gradientæ˜¯ä¸ºäº†<strong>ç®—æ³•æ­£ç¡®æ€§</strong>
- CMçš„æŸå¤±ä¸ä¸€å®šè¶Šå°è¶Šå¥½(ä»…ä¿è¯æ¢¯åº¦ç­‰æ•ˆ)</p>
<h4 id="44-meanflow">4.4 ç¬¬ä¸‰ç›®æ ‡(MeanFlowè®ºæ–‡ä½¿ç”¨)</h4>
<p><strong>åŠ¨æœº:</strong> è¿›ä¸€æ­¥å‡å°‘è®¡ç®—é‡,å»æ‰ç¬¬äºŒæ¬¡å‰å‘ä¼ æ’­$\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t, t)$ã€‚</p>
<p><strong>ç­–ç•¥:</strong> ç”¨$\boldsymbol{x}_1 - \boldsymbol{x}_0$æ›¿æ¢$\frac{d\boldsymbol{x}_t}{dt}$:</p>
<p>ä»ReFlowæˆ‘ä»¬çŸ¥é“$\frac{d\boldsymbol{x}_t}{dt}$çš„å›å½’ç›®æ ‡å°±æ˜¯$\boldsymbol{x}_1 - \boldsymbol{x}_0$,å› æ­¤åœ¨ç¬¬ä¸€æ’ç­‰å…³ç³»(15)ä¸­:</p>
<p>$$\boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x}_t,t) \approx \boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) + (t-r)\left[(\boldsymbol{x}_1-\boldsymbol{x}_0)\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) + \frac{\partial}{\partial t}\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t)\right] \tag{29}$$</p>
<p><strong>æ ‡ç­¾æ³„æ¼é—®é¢˜:</strong> $\boldsymbol{x}_1 - \boldsymbol{x}_0$æ—¢æ˜¯å›å½’ç›®æ ‡,åˆå‡ºç°åœ¨æ¨¡å‹å®šä¹‰ä¸­ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ:</strong> æ·»åŠ stop_gradient:</p>
<p>$$\mathcal{L}_3 = \mathbb{E}_{r,t,\boldsymbol{x}_0,\boldsymbol{x}_1}\left[\left\|\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) + (t-r)\text{sg}\left[(\boldsymbol{x}_1-\boldsymbol{x}_0)\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) + \frac{\partial}{\partial t}\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t)\right] - (\boldsymbol{x}_1 - \boldsymbol{x}_0)\right\|^2\right] \tag{30}$$</p>
<p><strong>ç‰¹æ®Šæƒ…å†µåˆ†æ($r=t$):</strong></p>
<p>å½“$r=t$æ—¶,ç›®æ ‡é€€åŒ–ä¸º:
$$\mathcal{L}_3|_{r=t} = \mathbb{E}_{t,\boldsymbol{x}_0,\boldsymbol{x}_1}\left[\|\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t, t) - (\boldsymbol{x}_1 - \boldsymbol{x}_0)\|^2\right] \tag{31}$$</p>
<p>è¿™æ­£æ˜¯ReFlowçš„ç›®æ ‡!å› æ­¤ReFlowä¸ºMeanFlow"å…œåº•",ä¿è¯è®­ç»ƒä¸ä¼šå¤ªå·®ã€‚</p>
<p><strong>ä¼˜ç¼ºç‚¹:</strong>
- ä¼˜ç‚¹: åªéœ€ä¸€æ¬¡å‰å‘ä¼ æ’­,æœ€å¿«
- ç¼ºç‚¹: ä¸ä¼˜åŒ–å™¨è€¦åˆ,æœ‰"ç¥ç§˜æ„Ÿ"</p>
<h3 id="5">5. ç†è®ºè¯æ˜ä¸æ”¶æ•›æ€§åˆ†æ</h3>
<h4 id="51-reflow">5.1 ReFlowçš„ç†è®ºåŸºç¡€</h4>
<p><strong>å¼•ç†1(å›å½’æœ€ä¼˜è§£):</strong></p>
<p>$$\mathop{\text{argmin}}_{\boldsymbol{\mu}} \mathbb{E}[\|\boldsymbol{\mu} - \boldsymbol{x}\|^2] = \mathbb{E}[\boldsymbol{x}] \tag{32}$$</p>
<p><strong>è¯æ˜:</strong>
å¯¹$\boldsymbol{\mu}$æ±‚å¯¼:
$$\frac{\partial}{\partial \boldsymbol{\mu}} \mathbb{E}[\|\boldsymbol{\mu} - \boldsymbol{x}\|^2] = 2\mathbb{E}[\boldsymbol{\mu} - \boldsymbol{x}] = 2(\boldsymbol{\mu} - \mathbb{E}[\boldsymbol{x}]) \tag{33}$$</p>
<p>ä»¤å¯¼æ•°ä¸ºé›¶:
$$\boldsymbol{\mu} = \mathbb{E}[\boldsymbol{x}] \tag{34}$$</p>
<p><strong>å¼•ç†2(ODEçš„æ¦‚ç‡æµå½¢å¼):</strong></p>
<p>å¯¹äºæ’å€¼è½¨è¿¹$\boldsymbol{x}_t = (1-t)\boldsymbol{x}_0 + t\boldsymbol{x}_1$,å°†$\boldsymbol{x}_1$åˆ°$\boldsymbol{x}_0$çš„æœ€ä¼˜ODEä¸º:</p>
<p>$$\frac{d\boldsymbol{x}_t}{dt} = \mathbb{E}_{\boldsymbol{x}_0|\boldsymbol{x}_t}[\boldsymbol{x}_1 - \boldsymbol{x}_0] \tag{35}$$</p>
<p><strong>ç›´è§‰ç†è§£:</strong>
- åœ¨$\boldsymbol{x}_t$å¤„,ä¸‹ä¸€æ­¥åº”è¯¥æœç€æœŸæœ›æ–¹å‘ç§»åŠ¨
- æœŸæœ›æ˜¯å¯¹æ‰€æœ‰å¯èƒ½çš„$\boldsymbol{x}_0$(ç»™å®š$\boldsymbol{x}_t$)å–å¹³å‡</p>
<p><strong>ReFlowçš„æ”¶æ•›æ€§:</strong></p>
<p>æœ€ä¼˜è§£æ»¡è¶³:
$$\boldsymbol{v}_{\boldsymbol{\theta}^*}(\boldsymbol{x}_t, t) = \mathbb{E}_{\boldsymbol{x}_0|\boldsymbol{x}_t}[\boldsymbol{x}_1 - \boldsymbol{x}_0] \tag{36}$$</p>
<p>ä»£å…¥å¼•ç†2,å¾—åˆ°æ­£ç¡®çš„ODEã€‚</p>
<h4 id="52">5.2 ç¬¬ä¸‰ç›®æ ‡çš„ç†è®ºè¯æ˜</h4>
<p><strong>ç›®æ ‡:</strong> è¯æ˜$\mathcal{L}_3$çš„æœ€ä¼˜è§£æ˜¯æœŸæœ›çš„å¹³å‡é€Ÿåº¦æ¨¡å‹ã€‚</p>
<p><strong>æ­¥éª¤1:</strong> å¯¹$\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t)$æ±‚æ¢¯åº¦å¹¶ä»¤å…¶ä¸ºé›¶ã€‚</p>
<p>ç”±äºæœ‰stop_gradient,æ¢¯åº¦ä¸º:
$$\nabla_{\boldsymbol{u}_{\boldsymbol{\theta}}} \mathcal{L}_3 = 2\mathbb{E}\left[\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) + (t-r)\text{sg}[...] - (\boldsymbol{x}_1 - \boldsymbol{x}_0)\right] \nabla_{\boldsymbol{u}_{\boldsymbol{\theta}}} \boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) \tag{37}$$</p>
<p>ä»¤æ¢¯åº¦ä¸ºé›¶:
$$\boldsymbol{u}_{\boldsymbol{\theta}^*}(\boldsymbol{x}_t, r, t) + (t-r)\mathbb{E}_{\boldsymbol{x}_0|\boldsymbol{x}_t}\left[(\boldsymbol{x}_1-\boldsymbol{x}_0)\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}_{\boldsymbol{\theta}^*}(\boldsymbol{x}_t, r, t) + \frac{\partial}{\partial t}\boldsymbol{u}_{\boldsymbol{\theta}^*}(\boldsymbol{x}_t, r, t)\right] = \mathbb{E}_{\boldsymbol{x}_0|\boldsymbol{x}_t}[\boldsymbol{x}_1 - \boldsymbol{x}_0] \tag{38}$$</p>
<p><strong>æ­¥éª¤2:</strong> åˆ©ç”¨å¼•ç†2,å°†$\mathbb{E}_{\boldsymbol{x}_0|\boldsymbol{x}_t}[\boldsymbol{x}_1 - \boldsymbol{x}_0]$æ›¿æ¢ä¸º$\frac{d\boldsymbol{x}_t}{dt}$:</p>
<p>$$\boldsymbol{u}_{\boldsymbol{\theta}^*}(\boldsymbol{x}_t, r, t) + (t-r)\left[\frac{d\boldsymbol{x}_t}{dt}\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}_{\boldsymbol{\theta}^*}(\boldsymbol{x}_t, r, t) + \frac{\partial}{\partial t}\boldsymbol{u}_{\boldsymbol{\theta}^*}(\boldsymbol{x}_t, r, t)\right] = \frac{d\boldsymbol{x}_t}{dt} \tag{39}$$</p>
<p><strong>æ­¥éª¤3:</strong> è¯†åˆ«å…¨å¯¼æ•°ç»“æ„ã€‚</p>
<p>æ³¨æ„åˆ°:
$$\frac{d}{dt}\boldsymbol{u}_{\boldsymbol{\theta}^*}(\boldsymbol{x}_t, r, t) = \frac{d\boldsymbol{x}_t}{dt}\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}_{\boldsymbol{\theta}^*}(\boldsymbol{x}_t, r, t) + \frac{\partial}{\partial t}\boldsymbol{u}_{\boldsymbol{\theta}^*}(\boldsymbol{x}_t, r, t) \tag{40}$$</p>
<p>æ–¹ç¨‹(39)å¯æ”¹å†™ä¸º:
$$\boldsymbol{u}_{\boldsymbol{\theta}^*}(\boldsymbol{x}_t, r, t) + (t-r)\frac{d}{dt}\boldsymbol{u}_{\boldsymbol{\theta}^*}(\boldsymbol{x}_t, r, t) = \frac{d\boldsymbol{x}_t}{dt} \tag{41}$$</p>
<p><strong>æ­¥éª¤4:</strong> åº”ç”¨ä¹˜ç§¯æ³•åˆ™ã€‚</p>
<p>æ³¨æ„åˆ°:
$$\frac{d}{dt}\left[(t-r)\boldsymbol{u}_{\boldsymbol{\theta}^*}(\boldsymbol{x}_t, r, t)\right] = \boldsymbol{u}_{\boldsymbol{\theta}^*}(\boldsymbol{x}_t, r, t) + (t-r)\frac{d}{dt}\boldsymbol{u}_{\boldsymbol{\theta}^*}(\boldsymbol{x}_t, r, t) \tag{42}$$</p>
<p>å› æ­¤æ–¹ç¨‹(41)ç­‰ä»·äº:
$$\frac{d}{dt}\left[(t-r)\boldsymbol{u}_{\boldsymbol{\theta}^*}(\boldsymbol{x}_t, r, t)\right] = \frac{d\boldsymbol{x}_t}{dt} \tag{43}$$</p>
<p><strong>æ­¥éª¤5:</strong> ç§¯åˆ†å¾—åˆ°ç»“æœã€‚</p>
<p>å¯¹æ–¹ç¨‹(43)ä»$r$åˆ°$t$ç§¯åˆ†:
$$\int_r^t \frac{d}{d\tau}\left[(\tau-r)\boldsymbol{u}_{\boldsymbol{\theta}^*}(\boldsymbol{x}_{\tau}, r, \tau)\right] d\tau = \int_r^t \frac{d\boldsymbol{x}_{\tau}}{d\tau} d\tau \tag{44}$$</p>
<p>å·¦ç«¯:
$$(t-r)\boldsymbol{u}_{\boldsymbol{\theta}^*}(\boldsymbol{x}_t, r, t) - 0 = (t-r)\boldsymbol{u}_{\boldsymbol{\theta}^*}(\boldsymbol{x}_t, r, t) \tag{45}$$</p>
<p>å³ç«¯:
$$\boldsymbol{x}_t - \boldsymbol{x}_r \tag{46}$$</p>
<p><strong>æœ€ç»ˆç»“æœ:</strong>
$$\boldsymbol{x}_t - \boldsymbol{x}_r = (t-r)\boldsymbol{u}_{\boldsymbol{\theta}^*}(\boldsymbol{x}_t, r, t) \tag{47}$$</p>
<p>è¿™æ­£æ˜¯å¹³å‡é€Ÿåº¦çš„å®šä¹‰!è¯æ˜å®Œæ¯•ã€‚</p>
<p><strong>stop_gradientçš„å¿…è¦æ€§åˆ†æ:</strong></p>
<p>å¦‚æœå»æ‰stop_gradient,æ±‚æ¢¯åº¦æ—¶ä¼šå¤šå‡ºJVPéƒ¨åˆ†å¯¹$\boldsymbol{u}_{\boldsymbol{\theta}^*}$çš„é›…å¯æ¯”çŸ©é˜µ,å¯¼è‡´æ— æ³•å°†æ–¹ç¨‹åŒ–ç®€ä¸º(43)çš„å½¢å¼ã€‚</p>
<p><strong>æ•°å­¦æ„ä¹‰:</strong> stop_gradientçš„å¼•å…¥é¿å…äº†å¯¹JVPæ±‚æ¢¯åº¦,ä½¿å¾—æœ€ä¼˜æ€§æ¡ä»¶èƒ½å¤ŸåŒ–ç®€ä¸ºå¾®åˆ†æ–¹ç¨‹å½¢å¼ã€‚</p>
<h3 id="6">6. ä¸ç›¸å…³å·¥ä½œçš„è”ç³»</h3>
<h4 id="61">6.1 ä¸ä¸­å€¼å®šç†æ–¹æ³•çš„å…³ç³»</h4>
<p><strong>ä¸­å€¼å®šç†æ–¹æ³•</strong> (<a href="/archives/9881">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆ(äºŒåä¸€)ã€‹</a>) çš„æ ¸å¿ƒæ€æƒ³:</p>
<p>æ ¹æ®ç§¯åˆ†ä¸­å€¼å®šç†,å­˜åœ¨$s \in [r,t]$ä½¿å¾—:
$$\frac{1}{t-r}\int_r^t \boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x}_{\tau},\tau) d\tau = \boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x}_s, s) \tag{48}$$</p>
<p><strong>ç­–ç•¥:</strong> å¯»æ‰¾æœ€ä¼˜çš„$s$æ¥è¿‘ä¼¼å¹³å‡é€Ÿåº¦ã€‚</p>
<p><strong>ä¸MeanFlowçš„åŒºåˆ«:</strong>
- ä¸­å€¼å®šç†: å¯»æ‰¾ç‰¹æ®Šç‚¹$s$,ä»æ˜¯æ±‚è§£å™¨æ€æƒ³
- MeanFlow: ç›´æ¥å»ºæ¨¡å¹³å‡é€Ÿåº¦,è®­ç»ƒæ—¶å­¦ä¹ </p>
<h4 id="62-shortcut">6.2 ä¸Shortcutæ¨¡å‹çš„å…³ç³»</h4>
<p><strong>Shortcutæ¨¡å‹</strong> (<a href="/archives/10617">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆ(äºŒåä¸ƒ)ã€‹</a>) å°†æ­¥é•¿ä½œä¸ºæ¡ä»¶è¾“å…¥ã€‚</p>
<p><strong>å¹³å‡é€Ÿåº¦çš„æ€§è´¨:</strong> åº”è¯¥æ»¡è¶³
$$\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) = \frac{1}{2}\left[\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, s, t) + \boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_s, r, s)\right] \tag{49}$$</p>
<p>å…¶ä¸­$s = (r+t)/2$ã€‚</p>
<p><strong>Shortcutçš„æ­£åˆ™åŒ–æŸå¤±:</strong>
$$\mathcal{L}_{\text{reg}} = \left\|\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, r, t) - \frac{1}{2}\text{sg}\left[\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, s, t) + \boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_s, r, s)\right]\right\|^2 \tag{50}$$</p>
<p>æ··åˆReFlowç›®æ ‡è®­ç»ƒã€‚</p>
<p><strong>ä¸MeanFlowçš„åŒºåˆ«:</strong>
- Shortcut: ç›´è§‚ä½†ç¼ºä¹ç†è®ºä¿è¯,åƒç»éªŒæ€§æ¢ç´¢
- MeanFlow: é€šè¿‡æ’ç­‰å˜æ¢æœ‰ä¸¥æ ¼ç†è®ºæ”¯æ’‘</p>
<h4 id="63-consistency-model">6.3 ä¸Consistency Modelçš„å…³ç³»</h4>
<p><strong>è¿ç»­ä¸€è‡´æ€§æ¨¡å‹(sCM)</strong> çš„ç›®æ ‡å‡½æ•°:
$$\mathcal{L}_{\text{sCM}} = \boldsymbol{f}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t) \cdot \frac{d}{dt}\boldsymbol{f}_{\text{sg}[\boldsymbol{\theta}]}(\boldsymbol{x}_t, t) \tag{51}$$</p>
<p>å…¶ä¸­$\boldsymbol{f}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)$æ˜¯ä¸€è‡´æ€§å‡½æ•°ã€‚</p>
<p><strong>å˜æ¢å…³ç³»:</strong> ä»¤
$$\boldsymbol{f}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t) = \boldsymbol{x}_t - t\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, 0, t) \tag{52}$$</p>
<p><strong>æ¢¯åº¦ç­‰ä»·æ€§æ¨å¯¼:</strong></p>
<p>å¯¹$\mathcal{L}_{\text{sCM}}$æ±‚æ¢¯åº¦:
$$\nabla_{\boldsymbol{\theta}}\mathcal{L}_{\text{sCM}} = \nabla_{\boldsymbol{\theta}}\boldsymbol{f}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t) \cdot \left[\frac{d\boldsymbol{x}_t}{dt}\cdot\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{f}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t) + \frac{\partial}{\partial t}\boldsymbol{f}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)\right] \tag{53}$$</p>
<p>ä»£å…¥(52):
$$\nabla_{\boldsymbol{\theta}}\boldsymbol{f}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t) = -t\nabla_{\boldsymbol{\theta}}\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, 0, t) \tag{54}$$</p>
<p>$$\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{f}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t) = \boldsymbol{I} - t\frac{\partial}{\partial \boldsymbol{x}_t}\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, 0, t) \tag{55}$$</p>
<p>$$\frac{\partial}{\partial t}\boldsymbol{f}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t) = -\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, 0, t) - t\frac{\partial}{\partial t}\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, 0, t) \tag{56}$$</p>
<p>ç»è¿‡ä»£æ•°åŒ–ç®€(è¯¦ç»†è¿‡ç¨‹ç•¥),å¯ä»¥è¯æ˜:
$$\nabla_{\boldsymbol{\theta}}\mathcal{L}_{\text{sCM}} \propto \nabla_{\boldsymbol{\theta}}\mathcal{L}_3|_{r=0} \tag{57}$$</p>
<p><strong>ç»“è®º:</strong> sCMæ˜¯MeanFlowåœ¨$r=0$æ—¶çš„ç‰¹ä¾‹ã€‚</p>
<p><strong>MeanFlowçš„ä¼˜åŠ¿:</strong>
1. å¼•å…¥$r$å‚æ•°,å½“$r=t$æ—¶é€€åŒ–ä¸ºReFlow,æä¾›"å…œåº•"ä¿è¯
2. ç‰©ç†æ„ä¹‰æ›´æ¸…æ™°(å¹³å‡é€Ÿåº¦ vs ä¸€è‡´æ€§)
3. å¯ä»¥å¾—åˆ°ä¸ä¾èµ–stop_gradientçš„ç¬¬ä¸€ã€ç¬¬äºŒç›®æ ‡</p>
<h3 id="7">7. å®ç°ç»†èŠ‚ä¸æŠ€æœ¯è¦ç‚¹</h3>
<h4 id="71">7.1 é‡‡æ ·ç®—æ³•</h4>
<p><strong>å•æ­¥ç”Ÿæˆ:</strong>
$$\boldsymbol{x}_0 = \boldsymbol{x}_1 - \boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_1, 0, 1) \tag{58}$$</p>
<p><strong>å¤šæ­¥ç”Ÿæˆ</strong> (NFE=N):</p>
<p>å°†$[0,1]$åˆ’åˆ†ä¸º$0=t_0 &lt; t_1 &lt; \cdots &lt; t_N = 1$</p>
<p>ä»$\boldsymbol{x}_N \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{I})$å¼€å§‹:
$$\boldsymbol{x}_{i-1} = \boldsymbol{x}_i - (t_i - t_{i-1})\boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_i, t_{i-1}, t_i), \quad i=N,N-1,\ldots,1 \tag{59}$$</p>
<p><strong>ç†è®ºä¼˜åŠ¿:</strong> å¤šæ­¥æ—¶æ˜¯å¯¹ODEç§¯åˆ†çš„æ›´ç²¾ç¡®è¿‘ä¼¼,å¯ä»¥æå‡è´¨é‡ã€‚</p>
<h4 id="72">7.2 è®­ç»ƒç®—æ³•ä¼ªä»£ç </h4>
<p><strong>è¾“å…¥:</strong> æ•°æ®é›†${\boldsymbol{x}<em i="1">0^{(i)}}</em>^M$</p>
<p><strong>è¾“å‡º:</strong> è®­ç»ƒå¥½çš„$\boldsymbol{u}_{\boldsymbol{\theta}}$</p>
<div class="codehilite"><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="n">epoch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">max_epochs</span><span class="p">:</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">batch</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">data_loader</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># é‡‡æ ·æ•°æ®ç‚¹</span>
<span class="w">        </span><span class="n">x0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">batch</span><span class="w">  </span><span class="c1"># çœŸå®æ•°æ®</span>

<span class="w">        </span><span class="c1"># é‡‡æ ·å™ªå£°</span>
<span class="w">        </span><span class="n">x1</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">N</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">I</span><span class="p">)</span>

<span class="w">        </span><span class="c1"># é‡‡æ ·æ—¶é—´å‚æ•°</span>
<span class="w">        </span><span class="n">t</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">        </span><span class="n">r</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w">  </span><span class="c1"># æˆ–å›ºå®š r=0</span>

<span class="w">        </span><span class="c1"># æ„å»ºæ’å€¼</span>
<span class="w">        </span><span class="n">xt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">x0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="o">*</span><span class="n">x1</span>

<span class="w">        </span><span class="c1"># ç›®æ ‡é€Ÿåº¦</span>
<span class="w">        </span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x0</span>

<span class="w">        </span><span class="c1"># è®¡ç®—é¢„æµ‹(æ ¹æ®é€‰æ‹©çš„ç›®æ ‡)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">using_loss_1</span><span class="p">:</span>
<span class="w">            </span><span class="n">u_rt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_theta</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>
<span class="w">            </span><span class="n">u_tt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_theta</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>
<span class="w">            </span><span class="n">jvp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compute_jvp</span><span class="p">(</span><span class="n">u_rt</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">xt</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">t</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="n">u_tt</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="w">            </span><span class="n">pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_rt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">jvp</span>
<span class="w">        </span><span class="k">elif</span><span class="w"> </span><span class="n">using_loss_2</span><span class="p">:</span>
<span class="w">            </span><span class="n">u_rt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_theta</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>
<span class="w">            </span><span class="n">u_tt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_theta</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>
<span class="w">            </span><span class="n">jvp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compute_jvp</span><span class="p">(</span><span class="n">u_rt</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">xt</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">t</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="n">u_tt</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="w">            </span><span class="n">pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_rt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">stop_gradient</span><span class="p">(</span><span class="n">jvp</span><span class="p">)</span>
<span class="w">        </span><span class="k">elif</span><span class="w"> </span><span class="n">using_loss_3</span><span class="p">:</span>
<span class="w">            </span><span class="n">u_rt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_theta</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>
<span class="w">            </span><span class="n">jvp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compute_jvp</span><span class="p">(</span><span class="n">u_rt</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">xt</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">t</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="w">            </span><span class="n">pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_rt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">stop_gradient</span><span class="p">(</span><span class="n">jvp</span><span class="p">)</span>

<span class="w">        </span><span class="c1"># è®¡ç®—æŸå¤±</span>
<span class="w">        </span><span class="n">loss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">||</span><span class="n">pred</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">target</span><span class="o">||^</span><span class="mi">2</span>

<span class="w">        </span><span class="c1"># åå‘ä¼ æ’­</span>
<span class="w">        </span><span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>
</code></pre></div>

<h4 id="73-jvp">7.3 JVPçš„å®ç°</h4>
<p><strong>PyTorchç¤ºä¾‹:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_jvp</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">tangents</span><span class="p">):</span>
    <span class="c1"># func: è¦è®¡ç®—JVPçš„å‡½æ•°</span>
    <span class="c1"># inputs: è¾“å…¥ç‚¹ (xt, r, t)</span>
    <span class="c1"># tangents: åˆ‡å‘é‡ (v_xt, v_r, v_t)</span>

    <span class="n">outputs</span><span class="p">,</span> <span class="n">jvp_out</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">jvp</span><span class="p">(</span>
        <span class="n">func</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">tangents</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">jvp_out</span>
</code></pre></div>

<p><strong>JAXç¤ºä¾‹:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_jvp</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">tangents</span><span class="p">):</span>
    <span class="n">primals_out</span><span class="p">,</span> <span class="n">tangents_out</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jvp</span><span class="p">(</span>
        <span class="n">func</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">tangents</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">primals_out</span><span class="p">,</span> <span class="n">tangents_out</span>
</code></pre></div>

<h3 id="8">8. ç†è®ºæ·±åº¦åˆ†æ</h3>
<h4 id="81">8.1 ä¸ºä»€ä¹ˆå¹³å‡é€Ÿåº¦æ›´é€‚åˆå¤§æ­¥é•¿?</h4>
<p><strong>ç¬æ—¶é€Ÿåº¦çš„å±€é™æ€§:</strong></p>
<p>ODE $\frac{d\boldsymbol{x}<em _boldsymbol_theta="\boldsymbol{\theta">t}{dt} = \boldsymbol{v}</em>_t, t)$ æè¿°çš„æ˜¯}}(\boldsymbol{x<strong>å±€éƒ¨</strong>æ€§è´¨,åªåœ¨$\Delta t \to 0$æ—¶ç²¾ç¡®ã€‚</p>
<p>æ¬§æ‹‰æ³•ç¦»æ•£åŒ–:
$$\boldsymbol{x}_{t-\Delta t} \approx \boldsymbol{x}_t - \boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)\Delta t \tag{60}$$</p>
<p><strong>å±€éƒ¨æˆªæ–­è¯¯å·®:</strong> $O(\Delta t^2)$</p>
<p><strong>å…¨å±€ç´¯ç§¯è¯¯å·®:</strong> $O(\Delta t)$</p>
<p>å½“$\Delta t$å¤§æ—¶,è¯¯å·®ä¸å¯æ¥å—ã€‚</p>
<p><strong>å¹³å‡é€Ÿåº¦çš„ä¼˜åŠ¿:</strong></p>
<p>å¹³å‡é€Ÿåº¦ç›´æ¥å»ºæ¨¡<strong>å…¨å±€</strong>æ€§è´¨:
$$\boldsymbol{x}_{t-\Delta t} = \boldsymbol{x}_t - \Delta t \cdot \boldsymbol{u}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t-\Delta t, t) \tag{61}$$</p>
<p>ç†è®ºä¸Š,å½“æ¨¡å‹å®Œç¾å­¦ä¹ æ—¶,è¿™æ˜¯<strong>ç²¾ç¡®</strong>çš„,æ— è¿‘ä¼¼è¯¯å·®!</p>
<p><strong>ç±»æ¯”:</strong>
- ç¬æ—¶é€Ÿåº¦: ç”¨åˆ‡çº¿è¿‘ä¼¼æ›²çº¿
- å¹³å‡é€Ÿåº¦: ç›´æ¥å­¦ä¹ æ›²çº¿çš„å¼¦</p>
<h4 id="82">8.2 åŒæ—¶é—´å‚æ•°çš„æ„ä¹‰</h4>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦$r$å’Œ$t$ä¸¤ä¸ªå‚æ•°?</strong></p>
<ol>
<li><strong>çµæ´»æ€§:</strong> å¯ä»¥å»ºæ¨¡ä»»æ„æ—¶é—´åŒºé—´$[r,t]$çš„å¹³å‡é€Ÿåº¦</li>
<li><strong>ReFlowå…œåº•:</strong> å½“$r=t$æ—¶,é€€åŒ–ä¸ºç¬æ—¶é€Ÿåº¦,å³ReFlow</li>
<li><strong>æ¸è¿›å­¦ä¹ :</strong> å¯ä»¥å…ˆå­¦å°åŒºé—´,å†æ³›åŒ–åˆ°å¤§åŒºé—´</li>
</ol>
<p><strong>è®­ç»ƒç­–ç•¥:</strong></p>
<p>å¯ä»¥è®¾è®¡è¯¾ç¨‹å­¦ä¹ :
- æ—©æœŸè®­ç»ƒ: $r$å’Œ$t$æ¥è¿‘,å­¦ä¹ å±€éƒ¨æ€§è´¨
- åæœŸè®­ç»ƒ: $r$å’Œ$t$ç›¸å·®å¤§,å­¦ä¹ å…¨å±€æ€§è´¨</p>
<h4 id="83">8.3 ç†è®ºå±€é™æ€§åˆ†æ</h4>
<p><strong>stop_gradientçš„ç†è®ºåœ°ä½:</strong></p>
<p>ç¬¬ä¸‰ç›®æ ‡ä¸­çš„stop_gradient:
- æ•°å­¦ä¸Š: æ”¹å˜äº†ä¼˜åŒ–ç›®æ ‡çš„æ€§è´¨
- ä¼˜åŒ–ä¸Š: ä½¿æœ€ä¼˜ç‚¹å˜ä¸ºé©»ç‚¹è€Œéæå°å€¼ç‚¹
- å®è·µä¸Š: ä¾èµ–ä¼˜åŒ–å™¨åŠ¨åŠ›å­¦</p>
<p><strong>å¼€æ”¾é—®é¢˜:</strong>
1. èƒ½å¦æ‰¾åˆ°ä¸ä¾èµ–stop_gradientçš„å…¨å±€æ€§å»ºæ¨¡æ–¹æ³•?
2. stop_gradientçš„ç¨³å®šæ€§å¦‚ä½•ç†è®ºä¿è¯?
3. ä¸åŒä¼˜åŒ–å™¨å¯¹ç»“æœçš„å½±å“?</p>
<h3 id="9">9. å®éªŒè§‚å¯Ÿä¸å®è·µå»ºè®®</h3>
<h4 id="91">9.1 ä¸‰ä¸ªç›®æ ‡çš„å¯¹æ¯”</h4>
<p><strong>ç¬¬ä¸€ç›®æ ‡($\mathcal{L}_1$):</strong>
- ä¼˜ç‚¹: ç†è®ºæœ€æ¸…æ™°,æ— stop_gradient
- ç¼ºç‚¹: è®¡ç®—é‡æœ€å¤§(äºŒé˜¶æ¢¯åº¦)
- é€‚ç”¨: ç†è®ºç ”ç©¶,å°è§„æ¨¡å®éªŒ</p>
<p><strong>ç¬¬äºŒç›®æ ‡($\mathcal{L}_2$):</strong>
- ä¼˜ç‚¹: å¹³è¡¡ç†è®ºä¸æ•ˆç‡
- ç¼ºç‚¹: ä»éœ€ä¸¤æ¬¡å‰å‘ä¼ æ’­
- é€‚ç”¨: é«˜è´¨é‡ç”Ÿæˆä»»åŠ¡</p>
<p><strong>ç¬¬ä¸‰ç›®æ ‡($\mathcal{L}_3$):</strong>
- ä¼˜ç‚¹: æœ€å¿«,å·¥ç¨‹å®è·µå‹å¥½
- ç¼ºç‚¹: ç†è®ºä¸Šæœ‰"ç¥ç§˜æ„Ÿ"
- é€‚ç”¨: å¤§è§„æ¨¡ç”Ÿäº§åº”ç”¨</p>
<h4 id="92">9.2 è¶…å‚æ•°è®¾ç½®å»ºè®®</h4>
<p><strong>æ—¶é—´é‡‡æ ·:</strong>
- $t \sim \text{Uniform}(0, 1)$: ç®€å•æœ‰æ•ˆ
- $t \sim \text{Beta}(\alpha, \beta)$: å¯ä»¥è°ƒæ•´éš¾åº¦åˆ†å¸ƒ</p>
<p><strong>$r$çš„é€‰æ‹©:</strong>
- $r = 0$: ç±»ä¼¼sCM,ç†è®ºä¿è¯å¼º
- $r \sim \text{Uniform}(0, t)$: æ›´çµæ´»,å­¦ä¹ å…¨å±€</p>
<p><strong>å­¦ä¹ ç‡:</strong>
- å»ºè®®ä½¿ç”¨warmup
- AdamWä¼˜åŒ–å™¨æ•ˆæœè¾ƒå¥½</p>
<h3 id="10">10. æ€»ç»“ä¸å±•æœ›</h3>
<h4 id="101">10.1 æ ¸å¿ƒè´¡çŒ®</h4>
<p>MeanFlowçš„æ ¸å¿ƒè´¡çŒ®å¯ä»¥æ€»ç»“ä¸º:</p>
<ol>
<li><strong>æ¦‚å¿µåˆ›æ–°:</strong> ä»ç¬æ—¶é€Ÿåº¦è½¬å‘å¹³å‡é€Ÿåº¦,çªç ´ODEçš„$\Delta t \to 0$é™åˆ¶</li>
<li><strong>ç†è®ºä¸¥æ ¼:</strong> é€šè¿‡æ’ç­‰å˜æ¢å’ŒReFlowç†è®º,æä¾›äº†ä¸¥æ ¼çš„æ•°å­¦åŸºç¡€</li>
<li><strong>å¤šä¸ªç›®æ ‡:</strong> æä¾›äº†ä¸‰ä¸ªè®­ç»ƒç›®æ ‡,å¹³è¡¡ç†è®ºçº¯ç²¹æ€§ä¸è®¡ç®—æ•ˆç‡</li>
<li><strong>ç»Ÿä¸€æ¡†æ¶:</strong> å°†sCMã€Shortcutç­‰æ–¹æ³•ç»Ÿä¸€åˆ°å¹³å‡é€Ÿåº¦æ¡†æ¶ä¸‹</li>
</ol>
<h4 id="102">10.2 ç†è®ºæ„ä¹‰</h4>
<p><strong>å¯¹æ‰©æ•£æ¨¡å‹çš„ç†è§£:</strong>
- ç”Ÿæˆè¿‡ç¨‹ä¸å¿…å±€é™äºæ— é™å°æ­¥é•¿
- å…¨å±€æ€§è´¨å¯ä»¥ç›´æ¥å»ºæ¨¡
- ç†è®ºä¿è¯ä¸å®è·µæ•ˆç‡å¯ä»¥å…¼é¡¾</p>
<p><strong>å¯¹æœªæ¥ç ”ç©¶çš„å¯ç¤º:</strong>
- å¯»æ‰¾æ›´å¤šçš„å…¨å±€æ€§è´¨è¿›è¡Œå»ºæ¨¡
- æ¢ç´¢stop_gradientçš„æ›¿ä»£æ–¹æ¡ˆ
- å‘å±•æ›´ç²¾ç»†çš„ç†è®ºåˆ†æå·¥å…·</p>
<h4 id="103">10.3 å¼€æ”¾é—®é¢˜</h4>
<ol>
<li><strong>æœ€ä¼˜æ—¶é—´ç¦»æ•£åŒ–:</strong> å¤šæ­¥ç”Ÿæˆæ—¶,å¦‚ä½•é€‰æ‹©æœ€ä¼˜çš„æ—¶é—´ç‚¹?</li>
<li><strong>é«˜é˜¶å¹³å‡é€Ÿåº¦:</strong> èƒ½å¦å¼•å…¥åŠ é€Ÿåº¦ç­‰é«˜é˜¶æ¦‚å¿µ?</li>
<li><strong>æ¡ä»¶ç”Ÿæˆ:</strong> å¦‚ä½•å°†å¹³å‡é€Ÿåº¦æ‰©å±•åˆ°æ¡ä»¶ç”Ÿæˆ?</li>
<li><strong>ç¦»æ•£æ•°æ®:</strong> èƒ½å¦åº”ç”¨åˆ°æ–‡æœ¬ç­‰ç¦»æ•£æ¨¡æ€?</li>
</ol>
<h4 id="104">10.4 å®è·µå±•æœ›</h4>
<p>MeanFlowä¸ºæ‰©æ•£æ¨¡å‹çš„å¿«é€Ÿç”Ÿæˆå¼€è¾Ÿäº†æ–°è·¯å¾„:
- <strong>ä¸€æ­¥ç”Ÿæˆ:</strong> ç†è®ºä¸Šå¯ä»¥è¾¾åˆ°ä¸å¤šæ­¥ç”Ÿæˆç›¸å½“çš„è´¨é‡
- <strong>å¯æ‰©å±•æ€§:</strong> å¯ä»¥é€šè¿‡å¢åŠ æ­¥æ•°æå‡æ•ˆæœ
- <strong>è®­ç»ƒç®€å•:</strong> å•ä¸€ç›®æ ‡,æ— å¯¹æŠ—è®­ç»ƒ
- <strong>ç†è®ºæ¸…æ™°:</strong> ä¾¿äºè¿›ä¸€æ­¥æ”¹è¿›å’Œæ‰©å±•</p>
<p><strong>æœªæ¥æ–¹å‘:</strong>
1. ç»“åˆå…¶ä»–åŠ é€ŸæŠ€æœ¯(è’¸é¦ã€å‰ªæç­‰)
2. åº”ç”¨åˆ°è§†é¢‘ã€3Dç­‰é«˜ç»´æ•°æ®
3. ä¸å…¶ä»–ç”Ÿæˆæ¨¡å‹(VAEã€GAN)ç»“åˆ
4. å¼€å‘æ›´é«˜æ•ˆçš„ç½‘ç»œæ¶æ„</p>
<hr />
<p><strong>å‚è€ƒæ–‡çŒ®:</strong>
- MeanFlowåŸè®ºæ–‡: <a href="https://papers.cool/arxiv/2505.13447">Mean Flows for One-step Generative Modeling</a>
- ReFlow: <a href="https://papers.cool/arxiv/2209.03003">Flow Straight and Fast: Learning to Generate and Transfer Data with Rectified Flow</a>
- sCM: <a href="https://papers.cool/arxiv/2410.11081">Simplifying, Stabilizing and Scaling Continuous-Time Consistency Models</a></p>
        </div>
    </div>
</body>
</html>