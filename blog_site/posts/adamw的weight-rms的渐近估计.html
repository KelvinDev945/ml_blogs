<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdamWçš„Weight RMSçš„...</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>AdamWçš„Weight RMSçš„...</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-26 | ğŸ“„ å¤§å°: 39.7 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/11307">https://spaces.ac.cn/archives/11307</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>åœ¨<a href="/archives/11267">ã€Šä¸ºä»€ä¹ˆAdamçš„Update RMSæ˜¯0.2ï¼Ÿã€‹</a>ä¸­ï¼Œæˆ‘ä»¬ç”¨å¹³å‡åœºè¿‘ä¼¼ä¼°è®¡äº†Adamçš„Update RMSã€‚ä¸ä¹…åï¼Œè¯»è€… <a href="https://x.com/EIFY/status/1965888629814988984">@EIFY</a> æŒ‡å‡ºç›¸åŒçš„ç»“æœå·²ç»å‡ºç°åœ¨è®ºæ–‡<a href="https://papers.cool/arxiv/2305.17212">ã€ŠRotational Equilibrium: How Weight Decay Balances Learning Across Neural Networksã€‹</a>ä¸­ã€‚é˜…è¯»åï¼Œç¬”è€…å‘ç°å…¶ä¸­ä¸ä»…åŒ…å«äº†Update RMSçš„ä¼°è®¡ï¼Œè¿˜åŒ…å«äº†Weight RMSçš„ä¼°è®¡ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒAdamWè®­å‡ºæ¥çš„æ¨¡å‹ï¼Œå…¶æƒé‡çš„RMSæ˜¯å¯ä»¥äº‹å…ˆä¼°è®¡å‡ºæ¥ä¸€ä¸ªæ¸è¿‘ç»“æœçš„ã€‚å¤§å®¶ä¼šä¸ä¼šè§‰å¾—è¿™ä¸ªç»“è®ºæœ‰ç‚¹æ„å¤–ï¼Ÿåæ­£ç¬”è€…ç¬¬ä¸€æ¬¡çœ‹åˆ°å®ƒæ˜¯é¢‡ä¸ºæ„å¤–çš„ï¼Œç›´è§‰ä¸Šæƒé‡æ¨¡é•¿æ˜¯æ¨¡å‹æ ¹æ®è®­ç»ƒé›†è‡ªå·±å­¦å‡ºæ¥çš„ï¼Œç»“æœå®ƒå‘Šè¯‰æˆ‘è¿™å·²ç»éšè—åœ¨ä¼˜åŒ–å™¨çš„è¶…å‚ä¸­ï¼Œå¯è°“å¾ˆåç›´è§‰äº†ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« æˆ‘ä»¬è¿˜æ˜¯ç”¨å¹³å‡åœºè¿‘ä¼¼æ–¹æ³•ï¼Œæ¥å¤ç°å¯¹Weight RMSçš„æ¸è¿‘ä¼°è®¡ã€‚</p>
<h2 id="_1">æ»‘åŠ¨è§†è§’</h2>
<p>é¦–å…ˆè¿˜æ˜¯æ¥å›é¡¾AdamWçš„æ›´æ–°è§„åˆ™ï¼š<br />
\begin{equation}\text{Adam}\color{skyblue}{\text{W}}:=\left\{\begin{aligned}<br />
&amp;\boldsymbol{m}<em t-1="t-1">t = \beta_1 \boldsymbol{m}</em>} + \left(1 - \beta_1\right) \boldsymbol{g<em t-1="t-1">t\\\<br />
&amp;\boldsymbol{v}_t = \beta_2 \boldsymbol{v}</em>} + \left(1 - \beta_2\right) \boldsymbol{g<em t-1="t-1">t^2\\\<br />
&amp;\hat{\boldsymbol{m}}_t = \boldsymbol{m}_t\left/\left(1 - \beta_1^t\right)\right.\\\<br />
&amp;\hat{\boldsymbol{v}}_t = \boldsymbol{v}_t\left/\left(1 - \beta_2^t\right)\right.\\\<br />
&amp;\boldsymbol{u}_t =\hat{\boldsymbol{m}}_t\left/\left(\sqrt{\hat{\boldsymbol{v}}_t} + \epsilon\right)\right.\\\<br />
&amp;\boldsymbol{\theta}_t = \boldsymbol{\theta}</em>} - \eta_t (\boldsymbol{u<em t-1="t-1">t \color{skyblue}{ + \lambda_t \boldsymbol{\theta}</em>)}<br />
\end{aligned}\right.\end{equation}<br />
å†æ¬¡è¯´æ˜ï¼Œè¿™é‡ŒåŠ ç²—ç¬¦å·é»˜è®¤éƒ½æ˜¯$\mathbb{R}^d$çš„å‘é‡ï¼Œå‘é‡çš„ä¹˜é™¤ï¼ˆåŒ…æ‹¬å¹³æ–¹ã€å¼€æ ¹å·ï¼‰é»˜è®¤éƒ½æ˜¯Element-wiseçš„Hadamardç§¯/å•†ã€‚</p>
<p>è·Ÿ<a href="/archives/11267">ã€Šä¸ºä»€ä¹ˆAdamçš„Update RMSæ˜¯0.2ï¼Ÿã€‹</a>ä¸€æ ·ï¼Œæˆ‘ä»¬è€ƒè™‘$t\to\infty$ï¼ˆå¯¹äº$\beta_1,\beta_2$æ¥è¯´ï¼‰å’Œ$\epsilon\to 0$ï¼Œæ‰€ä»¥$\boldsymbol{u}<em t-1="t-1">t=\boldsymbol{m}_t/\sqrt{\boldsymbol{v}_t}$ã€‚æˆ‘ä»¬æš‚æ—¶å…ˆè€ƒè™‘$\eta_t,\lambda_t$éƒ½æ˜¯å¸¸æ•°çš„ä¾‹å­ï¼Œæ‰€ä»¥å®ƒä»¬çš„ä¸‹æ ‡å¯ä»¥çœç•¥æ‰ï¼Œå¹¶ä¸”è®°$\beta_3 = 1-\eta\lambda$ï¼Œæˆ‘ä»¬æœ‰<br />
\begin{equation}\boldsymbol{\theta}_t = \beta_3\boldsymbol{\theta}</em>} + (1-\beta_3)(-\boldsymbol{u}_t/\lambda)\label{eq:ema-wd}\end{equation<br />
è¿™ä¸ªå¼å­è¡¨æ˜ï¼Œæˆ‘ä»¬å¯ä»¥ä»æ›´æ–°é‡çš„æ»‘åŠ¨å¹³å‡ï¼ˆExponential Moving Averageï¼ŒEMAï¼‰è§’åº¦æ¥ç†è§£Weight Decayã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„ä¹‰çš„è§†è§’è½¬æ¢ï¼Œæ˜¯<a href="https://papers.cool/arxiv/2405.13698">ã€ŠHow to set AdamWâ€™s weight decay as you scale model and dataset sizeã€‹</a>ã€<a href="https://papers.cool/arxiv/2505.13738">ã€ŠPower Lines: Scaling Laws for Weight Decay and Batch Size in LLM Pre-trainingã€‹</a>ç­‰å·¥ä½œçš„åŸºç¡€ã€‚</p>
<h2 id="_2">åŠ æƒå¹³å‡</h2>
<p>æ ¹æ®å¼$\eqref{eq:ema-wd}$ï¼Œæˆ‘ä»¬å¯ä»¥å°†$\boldsymbol{\theta}<em i="1">t$å±•å¼€ä¸ºåŠ æƒå¹³å‡å½¢å¼<br />
\begin{equation}\boldsymbol{\theta}_t = \beta_3^t\boldsymbol{\theta}_0 + (1-\beta_3)\sum</em>}^t \beta_3^{t-i} (-\boldsymbol{u<em i="1">i/\lambda)\label{eq:theta-t}\end{equation}<br />
åŒç†ï¼Œ$\boldsymbol{m}_t$å’Œ$\boldsymbol{v}_t$ä¹Ÿå¯ä»¥å±•å¼€ä¸º<br />
\begin{equation}\boldsymbol{m}_t = (1 - \beta_1)\sum</em>}^t \beta_1^{t-i}\boldsymbol{g<em i="1">i,\qquad \boldsymbol{v}_t = (1 - \beta_2)\sum</em>}^t \beta_2^{t-i}\boldsymbol{g}_i^2\label{eq:mv-roll}\end{equation<br />
è¿™é‡Œæœ‰ä¸ªå°ç»†èŠ‚ï¼Œ$\boldsymbol{\theta}_t$çš„è¡¨è¾¾å¼æˆ‘ä»¬ä¿ç•™äº†$\boldsymbol{\theta}_0$ï¼Œä½†$\boldsymbol{m}_t$å’Œ$\boldsymbol{v}_t$çš„è¡¨è¾¾å¼æˆ‘ä»¬æ²¡æœ‰ä¿ç•™$\boldsymbol{m}_0$å’Œ$\boldsymbol{v}_0$ï¼ŒåŸå› æœ‰ä¸¤ä¸ªï¼š1ã€$\boldsymbol{m}$å’Œ$\boldsymbol{v}$çš„åˆå§‹åŒ–ä¸€èˆ¬æ˜¯é›¶ï¼›2ã€å³ä¾¿å®ƒä»¬åˆå§‹åŒ–ä¸æ˜¯é›¶ï¼Œä½†å¯¹åº”çš„$\beta_1^t$å’Œ$\beta_2^t$ä¹Ÿä¼šè¶³å¤Ÿæ¥è¿‘äºé›¶ï¼Œå› æ­¤åˆå§‹åŒ–çš„å½±å“å¯ä»¥å¿½ç•¥ã€‚</p>
<p>ç„¶è€Œï¼Œ$\boldsymbol{\theta}$æ˜¯æ¨¡å‹æƒé‡ï¼Œå®ƒçš„åˆå§‹åŒ–é€šå¸¸ä¸æ˜¯é›¶ï¼Œå¹¶ä¸”$\beta_3$å¾€å¾€éå¸¸æ¥è¿‘äº1ï¼Œå¯¹äºæ•´ä¸ªè®­ç»ƒå‘¨æœŸè€Œè¨€ï¼Œ$\beta_3^t$ä¸ä¸€å®šèƒ½å……åˆ†æ¥è¿‘äºé›¶ï¼Œå› æ­¤æˆ‘ä»¬æ˜¾å¼ä¿ç•™$\beta_3^t$å’Œ$\boldsymbol{\theta}_0$ï¼ŒæŒ‰éœ€å–èˆã€‚</p>
<h2 id="_3">å¿«é€Ÿä¼°è®¡</h2>
<p>æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯ä¼°è®¡Weight RMSï¼Œå³$\Vert\boldsymbol{\theta}<em RMS="RMS">t\Vert</em>$ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒæ˜¯å„ä¸ªåˆ†é‡çš„Root Mean Squareï¼š<br />
\begin{equation}\Vert\boldsymbol{\theta}\Vert_{RMS} = \sqrt{\frac{1}{d}\sum_{i=1}^d \theta_i^2},\qquad\qquad \text{å…¶ä¸­ }\boldsymbol{\theta} = (\theta_1,\theta_2,\cdots,\theta_d)\end{equation}<br />
å®ƒè·Ÿæ¨¡é•¿çš„åŒºåˆ«å°±æ˜¯å¤šé™¤äº†ä¸ª$\sqrt{d}$ï¼Œæ‰€ä»¥æ¨¡é•¿çš„å¤§éƒ¨åˆ†æ€§è´¨å¯¹RMSåŒæ ·æˆç«‹ã€‚å¯¹äº$\Vert\boldsymbol{\theta}<em RMS="RMS">t\Vert</em>^2$ï¼Œå¯ä»¥å¾—åˆ°}$ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå¿«é€Ÿä½†ä¸æ˜¯é‚£ä¹ˆå‡†ç¡®çš„æ¨å¯¼æ–¹å¼ï¼šç›´æ¥å¯¹å¼$\eqref{eq:ema-wd}$ä¸¤è¾¹æ±‚$\Vert\cdot\Vert_{RMS<br />
\begin{equation}\begin{aligned}<br />
\Vert\boldsymbol{\theta}<em RMS="RMS">t\Vert</em>}^2 =&amp;\, \Vert\beta_3\boldsymbol{\theta<em RMS="RMS">{t-1} + (1-\beta_3)(-\boldsymbol{u}_t/\lambda)\Vert</em>^2 \\\[5pt]<br />
=&amp;\, \beta_3^2\Vert\boldsymbol{\theta}<em RMS="RMS">{t-1}\Vert</em>}^2 + (1-\beta_3)^2\Vert\boldsymbol{u<em RMS="RMS">t\Vert</em>}^2/\lambda^2 - 2\beta_3(1-\beta_3)\boldsymbol{\theta<em t-1="t-1">{t-1}\cdot\boldsymbol{u}_t/(\lambda d)<br />
\end{aligned}\end{equation}<br />
å‡è®¾$\boldsymbol{\theta}</em>},\boldsymbol{u<em t-1="t-1">t$è¿‘ä¹æ­£äº¤ï¼Œé‚£ä¹ˆ$\boldsymbol{\theta}</em>}\cdot\boldsymbol{u<em RMS="RMS">t\approx 0$ï¼Œè¿™åœ¨é«˜ç»´ç©ºé—´ä¸­é€šå¸¸æ˜¯ä¸€ä¸ªä¸é”™çš„è¿‘ä¼¼ï¼ˆå‚è€ƒ<a href="/archives/7076">ã€Šnç»´ç©ºé—´ä¸‹ä¸¤ä¸ªéšæœºå‘é‡çš„å¤¹è§’åˆ†å¸ƒã€‹</a>ï¼‰ï¼Œç„¶å$\Vert\boldsymbol{u}_t\Vert</em>}$æˆ‘ä»¬å·²ç»ç®—è¿‡äº†ï¼Œç­”æ¡ˆæ˜¯çº¦ç­‰äº$\sqrt{\frac{1-\beta_1}{1+\beta_1}}$ï¼Œæœ€åæˆ‘ä»¬è€ƒè™‘çš„æ˜¯è¶‹äºç¨³æ€çš„ç»“æœï¼Œæ‰€ä»¥$\Vert\boldsymbol{\theta<em RMS="RMS">t\Vert</em>}^2=\Vert\boldsymbol{\theta<em RMS="RMS">{t-1}\Vert</em>^2$ï¼Œäºæ˜¯æœ‰<br />
\begin{equation}(1-\beta_3^2)\Vert\boldsymbol{\theta}<em RMS="RMS">t\Vert</em>}^2 \approx (1-\beta_3)^2 \frac{1-\beta_1}{1+\beta_1} /\lambda^2\qquad\Rightarrow\qquad \Vert\boldsymbol{\theta<em RMS="RMS">t\Vert</em>} \approx \sqrt{\frac{1-\beta_1}{1+\beta_1}\frac{\eta}{2\lambda}}\end{equation<br />
ä»å·¦å¼åˆ°å³å¼è¿˜ç”¨åˆ°äº†$\beta_3\approx 1$çš„è¿‘ä¼¼ã€‚æœ€åçš„ç»“æœä¼šæœ‰äº›è¯¯å·®ï¼Œå› ä¸º$\boldsymbol{\theta}<em RMS="RMS">t\cdot\boldsymbol{u}_t\approx 0$å®é™…ä¸Šå¹¶ä¸é‚£ä¹ˆæˆç«‹ï¼Œä½†$\Vert\boldsymbol{\theta}_t\Vert</em>$çš„ç»“è®ºæ˜¯æ­£ç¡®çš„ã€‚ç±»ä¼¼çš„æ¨å¯¼è¿˜å‡ºç°åœ¨}\propto \sqrt{\eta/\lambda<a href="https://papers.cool/arxiv/2506.02285">ã€ŠWhy Gradients Rapidly Increase Near the End of Trainingã€‹</a>ã€‚</p>
<h2 id="_4">æ›´å¥½è¿‘ä¼¼</h2>
<p>å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬åªéœ€è¦çŸ¥é“$\Vert\boldsymbol{\theta}<em RMS="RMS">t\Vert</em>$å°±è¡Œäº†ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„ç»“è®ºã€‚è€Œå¯¹äºè¿½æ±‚æ›´å‡†ç¡®ç»“è®ºçš„è¯»è€…æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¹³å‡åœºæ–¹æ³•å¾—åˆ°ä¸€ä¸ªæ›´å¥½çš„è¿‘ä¼¼ï¼Œä»£ä»·æ˜¯è®¡ç®—è¿‡ç¨‹ä¼šå¤æ‚ä¸å°‘ï¼Œä½†å¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥è·å¾—æ›´å¤šæ›´æ¸…æ™°çš„è®¤çŸ¥ã€‚}\propto \sqrt{\eta/\lambda</p>
<h3 id="_5">æ­¥éª¤ä¹‹ä¸€</h3>
<p>æˆ‘ä»¬ä»å¼$\eqref{eq:theta-t}$å‡ºå‘ï¼Œæ±‚å’Œè¿™ä¸€é¡¹ï¼Œæœ¬èº«å°±å…·æœ‰åŠ æƒå¹³å‡çš„å½¢å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆç”¨ç¬¬ä¸€æ¬¡å¹³å‡åœºï¼š<br />
\begin{equation}\underbrace{\frac{1-\beta_3}{1-\beta_3^t}\sum_{i=1}^t \beta_3^{t-i} \boldsymbol{u}<em _text_è®°ä¸º="\text{è®°ä¸º">i}</em>}\bar{\boldsymbol{u}<em i="1">t} = \frac{1-\beta_3}{1-\beta_3^t}\sum</em>}^t \beta_3^{t-i} \frac{\boldsymbol{m<em i="1">i}{\sqrt{\boldsymbol{v}_i}}\approx \frac{\bar{\boldsymbol{m}}_t \,\,\triangleq\,\, \frac{1-\beta_3}{1-\beta_3^t}\sum</em>}^t \beta_3^{t-i}\boldsymbol{m<em i="1">i}{\sqrt{\bar{\boldsymbol{v}}_t \,\,\triangleq\,\, \frac{1-\beta_3}{1-\beta_3^t}\sum</em>}^t \beta_3^{t-i}\boldsymbol{v<em RMS="RMS">i}}\label{eq:u-bar}\end{equation}<br />
ç°åœ¨å†æ¬¡å›åˆ°å¼$\eqref{eq:theta-t}$ï¼Œç”±äº$\boldsymbol{\theta}_0$æ˜¯éšæœºçš„åˆå§‹åŒ–å‘é‡ï¼Œå› æ­¤å¯ä»¥å‡è®¾$\boldsymbol{\theta}_0$ä¸$\bar{\boldsymbol{u}}_t$æ­£äº¤ï¼Œäºæ˜¯æˆ‘ä»¬æœ‰<br />
\begin{equation}\Vert\boldsymbol{\theta}_t\Vert</em>}^2 \approx \beta_3^{2t}\Vert\boldsymbol{\theta<em RMS="RMS">0\Vert</em>}^2 + (1-\beta_3^t)^2 \lambda^{-2}\Vert \bar{\boldsymbol{u}<em RMS="RMS">t\Vert</em>}^2\end{equation<br />
ç°åœ¨æˆ‘ä»¬è¦æ±‚$\Vert \bar{\boldsymbol{u}}<em RMS="RMS">t\Vert</em>}^2$ï¼Œæ ¹æ®ä¹‹å‰çš„ç»éªŒï¼Œæˆ‘ä»¬éœ€è¦å‡è®¾$\boldsymbol{g<em RMS="RMS">j$ç‹¬ç«‹åŒåˆ†å¸ƒåœ°æœä»$\mathcal{N}(\boldsymbol{\mu},\boldsymbol{\sigma}^2)$ï¼Œç„¶åæ±‚<br />
\begin{equation}\mathbb{E}[\bar{\boldsymbol{u}}_t^2] \approx \mathbb{E}\left[\frac{\bar{\boldsymbol{m}}_t^2}{\bar{\boldsymbol{v}}_t}\right] \approx \frac{\mathbb{E}[\bar{\boldsymbol{m}}_t^2]}{\mathbb{E}[\bar{\boldsymbol{v}}_t]}\end{equation}<br />
æœ€åå†å¯¹$\mathbb{E}[\bar{\boldsymbol{u}}_t^2]$çš„å„ä¸ªåˆ†é‡æ±‚å¹³å‡ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½œä¸º$\Vert \bar{\boldsymbol{u}}_t\Vert</em>^2$çš„è¿‘ä¼¼ã€‚</p>
<h3 id="_6">æ­¥éª¤ä¹‹äºŒ</h3>
<p>ç»“åˆå¼$\eqref{eq:mv-roll}$ï¼Œæˆ‘ä»¬å¾—åˆ°<br />
\begin{gather}<br />
\sum_{i=1}^t \beta_3^{t-i}\boldsymbol{m}<em i="1">i = (1 - \beta_1)\sum</em>}^t \beta_3^{t-i} \sum_{j=1}^i \beta_1^{i-j}\boldsymbol{g<em j="1">j = (1 - \beta_1)\sum</em>}^t \frac{\beta_3^{t-j+1} - \beta_1^{t-j+1}}{\beta_3 - \beta_1}\boldsymbol{g<em i="1">j\\\<br />
\sum</em>}^t \beta_3^{t-i}\boldsymbol{v<em i="1">i = (1 - \beta_2)\sum</em>}^t \beta_3^{t-i} \sum_{j=1}^i \beta_2^{i-j}\boldsymbol{g<em j="1">j^2 = (1 - \beta_2)\sum</em>}^t \frac{\beta_3^{t-j+1} - \beta_2^{t-j+1}}{\beta_3 - \beta_2}\boldsymbol{g<em RMS="RMS">j^2\\\<br />
\end{gather}<br />
æœ€åä¸€ä¸ªåŒé‡æ±‚å’ŒåŒ–ç®€ï¼Œå¦‚æœå¤§å®¶æ²¡æœ‰æ€è·¯ï¼Œå¯ä»¥äº¤ç»™Kimiå®Œæˆï¼ˆå‚è€ƒ<a href="https://www.kimi.com/share/d3d35hpsfuv6jqe78c20">é“¾æ¥</a>ï¼‰ã€‚ç”±ä¸Šå¼å¯çŸ¥$\bar{\boldsymbol{m}}_t,\bar{\boldsymbol{v}}_t$åˆ†åˆ«æ˜¯æ¢¯åº¦å’Œæ¢¯åº¦å¹³æ–¹çš„åŠ æƒå¹³å‡ï¼Œæ‰€ä»¥æ±‚$\Vert \bar{\boldsymbol{u}}_t\Vert</em>^2$è·Ÿ<a href="/archives/11267">ã€Šä¸ºä»€ä¹ˆAdamçš„Update RMSæ˜¯0.2ï¼Ÿã€‹</a>æ±‚$\Vert \boldsymbol{u}<em RMS="RMS">t\Vert</em>^2$æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡åŠ æƒç³»æ•°ä¸åŒã€‚</p>
<h3 id="_7">æ­¥éª¤ä¹‹ä¸‰</h3>
<p>æˆ‘ä»¬å…ˆæ±‚åˆ†æ¯<br />
\begin{equation}\begin{aligned}<br />
\mathbb{E}[\bar{\boldsymbol{v}}<em j="1">t] =&amp;\, \frac{(1 - \beta_3)(1 - \beta_2)}{1 - \beta_3^t}\sum</em>}^t \frac{\beta_3^{t-j+1} - \beta_2^{t-j+1}}{\beta_3 - \beta_2}\mathbb{E}[\boldsymbol{g<em j="1">j^2] \\\<br />
=&amp;\, \frac{(1 - \beta_3)(1 - \beta_2)}{1 - \beta_3^t}\sum</em>^2) \\\}^t \frac{\beta_3^{t-j+1} - \beta_2^{t-j+1}}{\beta_3 - \beta_2}(\boldsymbol{\mu}^2 + \boldsymbol{\sigma<br />
=&amp;\, \frac{(1 - \beta_3)(1 - \beta_2)}{(1 - \beta_3^t)(\beta_3 - \beta_2)}\left(\frac{\beta_3 - \beta_3^{t+1}}{1 - \beta_3} - \frac{\beta_2 - \beta_2^{t+1}}{1 - \beta_2}\right)(\boldsymbol{\mu}^2 + \boldsymbol{\sigma}^2) \\\[5pt]<br />
\approx &amp;\, \boldsymbol{\mu}^2 + \boldsymbol{\sigma}^2<br />
\end{aligned}\end{equation}<br />
æœ€åä¸€æ­¥çš„çº¦ç­‰å·ï¼Œæ˜¯å› ä¸ºå®é™…è®­ç»ƒä¸­ï¼Œ$\beta_3$ä¼šè¶³å¤Ÿæ¥è¿‘äº1ï¼Œè€Œ$\beta_2^{t+1}$ä¼šè¶³å¤Ÿæ¥è¿‘äº0ï¼Œä½†$\beta_3^{t+1}$ä¸ä¸€å®šï¼Œæ‰€ä»¥æˆ‘ä»¬å°†$\beta_2^{t+1}$æ›¿æ¢æˆé›¶ï¼Œå¹¶åœ¨åŒ–ç®€ä¹‹åå°†ç‹¬ç«‹çš„$\beta_3$æ›¿æ¢æˆ$1$ï¼Œæœ€åå†åŠ ä¸Šè¿‘ä¼¼$\beta_3^{t+1}\approx \beta_3^t$ã€‚</p>
<h3 id="_8">æ­¥éª¤ä¹‹å››</h3>
<p>ç„¶åæ˜¯$\mathbb{E}[\bar{\boldsymbol{m}}<em j="1">t^2] = \mathbb{E}[\bar{\boldsymbol{m}}_t]^2 + \mathbb{V}ar[\bar{\boldsymbol{m}}_t]$ï¼Œ$\mathbb{E}[\bar{\boldsymbol{m}}_t]$çš„è®¡ç®—è·Ÿ$\mathbb{E}[\bar{\boldsymbol{v}}_t]$ç±»ä¼¼ï¼Œç»“æœæ˜¯$\boldsymbol{\mu}$ï¼Œ$\mathbb{V}ar[\bar{\boldsymbol{m}}_t]$çš„è®¡ç®—æˆ‘ä»¬åˆ™åˆ©ç”¨æ–¹å·®çš„å¹³æ–¹å¯åŠ æ€§ï¼š<br />
\begin{equation}\begin{aligned}<br />
\mathbb{V}ar[\bar{\boldsymbol{m}}_t] =&amp;\, \frac{(1 - \beta_3)^2(1 - \beta_1)^2}{(1-\beta_3^t)^2}\sum</em>}^t \left(\frac{\beta_3^{t-j+1} - \beta_1^{t-j+1}}{\beta_3 - \beta_1}\right)^2\mathbb{V}ar[\boldsymbol{g<em j="1">j] \\\<br />
=&amp;\, \frac{(1 - \beta_3)^2(1 - \beta_1)^2}{(1-\beta_3^t)^2}\sum</em>^2 \\\}^t \left(\frac{\beta_3^{t-j+1} - \beta_1^{t-j+1}}{\beta_3 - \beta_1}\right)^2 \boldsymbol{\sigma<br />
=&amp;\, \frac{(1 - \beta_3)^2(1 - \beta_1)^2}{(1-\beta_3^t)^2(\beta_3 - \beta_1)^2}\left(\frac{\beta_3^2 - \beta_3^{2(t+1)}}{1 - \beta_3^2} + \frac{\beta_1^2 - \beta_1^{2(t+1)}}{1 - \beta_1^2} - 2\frac{\beta_1\beta_3 - \beta_1^{t+1}\beta_3^{t+1}}{1 - \beta_1\beta_3}\right) \boldsymbol{\sigma}^2 \\\[5pt]<br />
\approx &amp;\, (1 - \beta_3)(1 + \beta_3^t)\boldsymbol{\sigma}^2/2(1 - \beta_3^t)<br />
\end{aligned}\end{equation}<br />
å–çº¦ç­‰å·çš„ç†ç”±åŒä¸Šã€‚</p>
<h3 id="_9">æ­¥éª¤ä¹‹äº”</h3>
<p>ä»£å…¥ä¸Šä¸¤èŠ‚çš„è®¡ç®—ç»“æœï¼Œæˆ‘ä»¬æœ‰<br />
\begin{equation}\mathbb{E}[\bar{\boldsymbol{u}}<em RMS="RMS">t^2] \approx \frac{\boldsymbol{\mu}^2 + (1 - \beta_3)(1 + \beta_3^t)\boldsymbol{\sigma}^2/2(1 - \beta_3^t)}{\boldsymbol{\mu}^2 + \boldsymbol{\sigma}^2}\end{equation}<br />
é‚£ä¹ˆ<br />
\begin{equation}\Vert\bar{\boldsymbol{u}}_t\Vert</em>}^2 \approx \frac{\Vert\boldsymbol{\mu}\Vert^2/\Vert\boldsymbol{\sigma}\Vert^2 + (1 - \beta_3)(1 + \beta_3^t)/2(1 - \beta_3^t)}{\Vert\boldsymbol{\mu}\Vert^2/\Vert\boldsymbol{\sigma}\Vert^2 + 1} \end{equation<br />
æœ€ç»ˆæœ‰<br />
\begin{equation}\Vert\boldsymbol{\theta}<em RMS="RMS">t\Vert</em>}^2 \approx \beta_3^{2t}\Vert\boldsymbol{\theta<em RMS="RMS">0\Vert</em>}^2 + (1-\beta_3^t)^2 \frac{\Vert\boldsymbol{\mu}\Vert^2/\Vert\boldsymbol{\sigma}\Vert^2 + (1 - \beta_3)(1 + \beta_3^t)/2(1 - \beta_3^t)}{\lambda^2(\Vert\boldsymbol{\mu}\Vert^2/\Vert\boldsymbol{\sigma}\Vert^2 + 1)}\label{eq:theta-rms}\end{equation</p>
<h2 id="_10">ç»“æœæµ…æ</h2>
<p>å¼$\eqref{eq:theta-rms}$çœ‹èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬è§‚å¯Ÿå‡ ä¸ªç‰¹ä¾‹ã€‚é¦–å…ˆè€ƒè™‘$\boldsymbol{\mu}=\boldsymbol{0}$è¿™ä¸ªä¾‹å­ï¼Œæ­¤æ—¶<br />
\begin{equation}\Vert\boldsymbol{\theta}<em RMS="RMS">t\Vert</em>}^2 \approx \beta_3^{2t}\Vert\boldsymbol{\theta<em RMS="RMS">0\Vert</em>}^2 + (1-\beta_3^{2t}) (1 - \beta_3)/2\lambda^2 = \beta_3^{2t}\Vert\boldsymbol{\theta<em RMS="RMS">0\Vert</em>}^2 + (1-\beta_3^{2t}) \eta/2\lambda\label{eq:theta-rms-mu0}\end{equation<br />
ç‰¹åˆ«åœ°ï¼Œå¦‚æœè€ƒè™‘$t\to\infty$ï¼Œæˆ–è€…$\Vert\boldsymbol{\theta}<em RMS="RMS">0\Vert</em>^2$å°±åˆå§‹åŒ–ä¸º$\eta/2\lambda$ï¼Œé‚£ä¹ˆå°±æœ‰<br />
\begin{equation}\Vert\boldsymbol{\theta}<em RMS="RMS">t\Vert</em>} \approx \sqrt{\frac{\eta}{2\lambda}}\label{eq:theta-rms-simple}\end{equation<br />
è¿™ä¾¿æ˜¯è®ºæ–‡<a href="https://papers.cool/arxiv/2305.17212">ã€ŠRotational Equilibrium: How Weight Decay Balances Learning Across Neural Networksã€‹</a>ç»™å‡ºçš„ç»“æœï¼Œè·ŸåŸè®ºæ–‡çš„å‡è®¾ä¸€è‡´ï¼Œå®ƒæ˜¯é›¶å‡å€¼ä¸‹çš„éšæœºæ¸¸èµ°çš„ç¨³æ€ç»“æœã€‚å¦‚æœä¸è€ƒè™‘$t\to\infty$ï¼Œè€Œæ˜¯è€ƒè™‘$\lambda\to 0$çš„æé™ï¼Œé‚£ä¹ˆç”±å¼$\eqref{eq:theta-rms-mu0}$æˆ‘ä»¬å°†å¾—åˆ°<br />
\begin{equation}\Vert\boldsymbol{\theta}<em RMS="RMS">t\Vert</em>}^2 \approx \Vert\boldsymbol{\theta<em RMS="RMS">0\Vert</em>}^2 + \eta^2 t\end{equation<br />
è¿™è¡¨æ˜åœ¨æ²¡æœ‰Weight Decayçš„æ—¶å€™ï¼Œ$\Vert\boldsymbol{\theta}<em RMS="RMS">t\Vert</em>$å¾—}$å¤§è‡´æŒ‰ç…§$\eta\sqrt{t}$çš„é€Ÿåº¦å¢é•¿ï¼Œè¿™ä¹Ÿè¡¨æ˜åœ¨æ²¡æœ‰Weight Decayæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®ç‰¹å®šçš„å­¦ä¹ ç‡Scheduleæ¥å®ç°Weight RMSçš„ç¨³å®šæ€§ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœBatch Sizeè¶³å¤Ÿå¤§ï¼Œå¯¼è‡´ä¿¡å™ªæ¯”é¡¹$\Vert\boldsymbol{\mu}\Vert^2/\Vert\boldsymbol{\sigma}\Vert^2$å ä¸»å¯¼ï¼Œé‚£ä¹ˆç”±å¼$\eqref{eq:theta-rms<br />
\begin{equation}\Vert\boldsymbol{\theta}<em RMS="RMS">t\Vert</em>}^2 \approx \beta_3^{2t}\Vert\boldsymbol{\theta<em RMS="RMS">0\Vert</em>}^2 + (1-\beta_3^t)^2 \frac{\Vert\boldsymbol{\mu}\Vert^2/\Vert\boldsymbol{\sigma}\Vert^2}{\lambda^2(\Vert\boldsymbol{\mu}\Vert^2/\Vert\boldsymbol{\sigma}\Vert^2 + 1)}\end{equation<br />
è¿™ä¸ªå¯èƒ½é€‚ç”¨äºæ¨¡å‹éœ€è¦ä¸»åŠ¨å¢åŠ Weight RMSçš„ç‰¹æ®Šæƒ…å½¢ã€‚ä¸è¿‡ä»ç»éªŒæ¥çœ‹ï¼Œè¿™ç§æƒ…å†µå‘ç”Ÿçš„æ¦‚ç‡ä¸€èˆ¬æ¯”è¾ƒå°ã€‚</p>
<h2 id="_11">æ¨¡æ‹Ÿå®éªŒ</h2>
<p>æˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹æ¨¡æ‹Ÿè„šæœ¬ï¼Œæ¥ç®€å•éªŒè¯ä¸Šè¿°çš„å‡†ç¡®æ€§ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">N</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">100000</span>
<span class="n">beta1</span><span class="p">,</span> <span class="n">beta2</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.95</span>
<span class="n">m</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">beta1</span> <span class="o">*</span> <span class="n">m</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">beta1</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">beta2</span> <span class="o">*</span> <span class="n">v</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">beta2</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">w</span> <span class="o">-</span> <span class="mf">0.001</span> <span class="o">*</span> <span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="n">v</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">w</span><span class="p">)</span>

<span class="n">weight_rms</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="kp">mean</span><span class="p">()</span><span class="o">**</span><span class="mf">0.5</span>
<span class="nb">print</span><span class="p">(</span><span class="n">weight_rms</span><span class="p">)</span>
</code></pre></div>

<p>å¤§å®¶å¯ä»¥è‡ªè¡Œæ”¹å˜æƒé‡çš„åˆå§‹åŒ–æˆ–æ¢¯åº¦çš„å‡å€¼æ–¹å·®ç­‰ï¼Œçœ‹æœ€ç»ˆç»“æœè·Ÿå¼$\eqref{eq:theta-rms}$çš„å»åˆç¨‹åº¦ï¼Œç¬”è€…è‡ªè¡Œè¯•äº†ä¸€æ³¢ï¼Œæ•´ä½“æ¥è¯´è¿˜æ˜¯æ¯”è¾ƒé è°±çš„ã€‚</p>
<h2 id="_12">ç¬¦å·ç‰ˆæœ¬</h2>
<p>åªéœ€è¦å°†å‰è¿°è¯æ˜è°ƒæ•´ä¸€ä¸‹ï¼Œå°±å¯ä»¥é€‚ç”¨äºâ€œSignSGDM + Weight Decayâ€çš„ç»„åˆï¼š<br />
\begin{equation}\text{SignSGDM}\color{skyblue}{\text{W}}:=\left\{\begin{aligned}<br />
&amp;\boldsymbol{m}<em t-1="t-1">t = \beta_1 \boldsymbol{m}</em>} + \left(1 - \beta_1\right) \boldsymbol{g<em t-1="t-1">t\\\<br />
&amp;\boldsymbol{u}_t = \newcommand{sign}{\mathop{\text{sign}}}\sign(\boldsymbol{m}_t)\\\<br />
&amp;\boldsymbol{\theta}_t = \boldsymbol{\theta}</em>} - \eta_t (\boldsymbol{u<em t-1="t-1">t \color{skyblue}{ + \lambda_t \boldsymbol{\theta}</em>)}<br />
\end{aligned}\right.\end{equation}<br />
ä¿®æ”¹çš„åœ°æ–¹æ˜¯ç”±äº$\sign(\boldsymbol{m}<em i="1">t)=\boldsymbol{m}_t/\sqrt{\boldsymbol{m}_t^2}$ï¼Œæ‰€ä»¥è¦å°†$\bar{\boldsymbol{v}}_t$çš„å®šä¹‰æ”¹ä¸º<br />
\begin{equation}\bar{\boldsymbol{v}}_t \triangleq \frac{1-\beta_3}{1-\beta_3^t}\sum</em>}^t \beta_3^{t-i}\boldsymbol{m<em i="1">i^2\end{equation}<br />
é‚£ä¹ˆ<br />
\begin{equation}\mathbb{E}[\bar{\boldsymbol{v}}_t] = \frac{1-\beta_3}{1-\beta_3^t}\sum</em>}^t \beta_3^{t-i}\mathbb{E}[\boldsymbol{m<em i="1">i^2] \approx \frac{1-\beta_3}{1-\beta_3^t}\sum</em>}^t \beta_3^{t-i}\mathbb{E}\left(\boldsymbol{\mu}^2 + \frac{1-\beta_1}{1 + \beta_1}\boldsymbol{\sigma}^2\right) = \boldsymbol{\mu}^2 + \frac{1-\beta_1}{1 + \beta_1}\boldsymbol{\sigma}^2\end{equation<br />
å…¶ä¸­$\mathbb{E}[\boldsymbol{m}<em RMS="RMS">i^2]$çš„è®¡ç®—æˆ‘ä»¬å‚è€ƒ<a href="/archives/11267">ã€Šä¸ºä»€ä¹ˆAdamçš„Update RMSæ˜¯0.2ï¼Ÿã€‹</a>æˆ–<a href="/archives/11301">ã€Šé‡æ–°æ€è€ƒå­¦ä¹ ç‡ä¸Batch Sizeï¼ˆå››ï¼‰ï¼šEMAã€‹</a>éƒ½è¡Œã€‚åˆ©ç”¨ä¸Šè¿°ç»“æœï¼Œæˆ‘ä»¬å¾—åˆ°<br />
\begin{equation}\Vert\boldsymbol{\theta}_t\Vert</em>}^2 \approx \beta_3^{2t}\Vert\boldsymbol{\theta<em RMS="RMS">0\Vert</em>}^2 + (1-\beta_3^t)^2 \frac{\Vert\boldsymbol{\mu}\Vert^2/\Vert\boldsymbol{\sigma}\Vert^2 + (1 - \beta_3)(1 + \beta_3^t)/2(1 - \beta_3^t)}{\lambda^2\left(\Vert\boldsymbol{\mu}\Vert^2/\Vert\boldsymbol{\sigma}\Vert^2 + \frac{1-\beta_1}{1 + \beta_1}\right)}\end{equation<br />
ç‰¹åˆ«åœ°ï¼Œè€ƒè™‘$\boldsymbol{\mu}=0,t\to\infty$çš„æé™ï¼Œæˆ‘ä»¬æœ‰<br />
\begin{equation}\Vert\boldsymbol{\theta}<em RMS="RMS">t\Vert</em>}^2 \approx \sqrt{\frac{\eta}{2\lambda}\frac{1+\beta_1}{1 - \beta_1}}\end{equation<br />
è¿™ä¸ªç»“æœä¹Ÿå¾ˆåˆç†ï¼Œå› ä¸ºSignSGDMWçš„Update RMSæ˜¯AdamWçš„$\sqrt{\frac{1+\beta_1}{1 - \beta_1}}$å€ï¼Œæ‰€ä»¥åŒæ ·$\eta,\lambda$ä¸‹å®ƒçš„Weight RMSä¹Ÿæ˜¯$\sqrt{\frac{1+\beta_1}{1 - \beta_1}}$å€ã€‚</p>
<h2 id="_13">ç›¸å…³åˆ†æ</h2>
<p>å‰é¢è¯´äº†ï¼Œç»“æœ$\eqref{eq:theta-rms-simple}$è·Ÿè®ºæ–‡<a href="https://papers.cool/arxiv/2305.17212">ã€ŠRotational Equilibrium: How Weight Decay Balances Learning Across Neural Networksã€‹</a>æ˜¯ä¸€è‡´çš„ï¼Œä½†æˆ‘ä»¬çš„æ¨å¯¼æ–¹æ³•æ˜¯å®Œå…¨ä¸åŒçš„ï¼Œå¹¶ä¸”èƒ½å¾—åˆ°æ›´ä¸€èˆ¬çš„$\eqref{eq:theta-rms}$ã€‚ä¸è¿‡ï¼ŒåŸè®ºæ–‡ä¹Ÿæœ‰ä¸€äº›å¾ˆæœ‰æ„æ€çš„åœ°æ–¹ï¼Œæ¯”å¦‚å®ƒæ‰€æçš„ <strong>Total Update Contribution (TUC)</strong> æ¦‚å¿µï¼Œå°±å€¼å¾—èµæä¸€ç•ªã€‚</p>
<p>TUCçš„æ€æƒ³æ˜¯è¿™æ ·çš„ï¼šç”±äºåŠ¨é‡æœºåˆ¶çš„å­˜åœ¨ï¼Œå½“å‰çš„æ¢¯åº¦$\boldsymbol{g}<em t_1="t+1">t$ä¸æ­¢åœç•™åœ¨å½“å‰æ­¥éª¤ï¼Œå®ƒè¿˜ä¼šå½±å“åˆ°æœªæ¥çš„æ­¥éª¤ï¼ˆä½†ä¼šæ‰“ä¸ªâ€œæŠ˜æ‰£â€ï¼‰ï¼Œæ‰€ä»¥å‡è®¾è®­ç»ƒæ­¥æ•°è¶‹äºæ— ç©·ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘å½“å‰æ¢¯åº¦$\boldsymbol{g}_t$å¯¹æ•´ä¸ªè®­ç»ƒè¿‡ç¨‹çš„<strong>æ€»è´¡çŒ®</strong> ã€‚å…·ä½“æ¥è¯´ï¼Œå¯¹äºAdamæˆ‘ä»¬æœ‰$\boldsymbol{u}_t=\boldsymbol{m}_t/\sqrt{\boldsymbol{v}_t}$ï¼Œå½“å‰$\boldsymbol{g}_t$å¯¹$\boldsymbol{u}_t$çš„è´¡çŒ®æ˜¯$(1-\beta_1)\boldsymbol{g}_t/\sqrt{\boldsymbol{v}_t}$ï¼Œä¸‹ä¸€æ­¥$\boldsymbol{g}_t$å°†ä¼šæ‰“ä¸ªæŠ˜æ‰£ï¼ˆä¹˜ä»¥$\beta_1$ï¼‰ï¼Œè€Œä¸”åˆ†æ¯æ”¹ä¸º$\boldsymbol{v}</em>$ï¼Œä¾æ­¤ç±»æ¨ï¼Œæ‰€ä»¥å¯ä»¥å®šä¹‰æ€»è´¡çŒ®ä¸º<br />
\begin{equation}\tilde{\boldsymbol{u}}<em k="t">t = \sum</em>}^{\infty} (1-\beta_1)\beta_1^{k-t}\frac{\boldsymbol{g<em RMS="RMS">t}{\sqrt{\boldsymbol{v}_k}}\end{equation}<br />
è¿™æ ·æˆ‘ä»¬å°±å°†æ›´æ–°$\boldsymbol{u}_1,\boldsymbol{u}_2,\boldsymbol{u}_3,\cdots$åˆ†è§£ä¸ºæ›´æ–°$\tilde{\boldsymbol{u}}_1,\tilde{\boldsymbol{u}}_2,\tilde{\boldsymbol{u}}_3,\cdots$ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯æ¯ä¸ª$\tilde{\boldsymbol{u}}$åªæœ‰å•æ­¥æ¢¯åº¦ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é‡å¤å¿«é€Ÿä¼°è®¡ä¸€èŠ‚çš„æ¨å¯¼ï¼š<br />
\begin{equation}\Vert\boldsymbol{\theta}_t\Vert</em>}^2 = \Vert\beta_3\boldsymbol{\theta<em RMS="RMS">{t-1} + (1-\beta_3)(-\tilde{\boldsymbol{u}}_t/\lambda)\Vert</em>}^2 \approx \beta_3^2\Vert\boldsymbol{\theta<em RMS="RMS">{t-1}\Vert</em>}^2 + (1-\beta_3)^2\Vert\tilde{\boldsymbol{u}<em RMS="RMS">t\Vert</em>}^2/\lambda^2 \label{eq:tilde-u-rms}\end{equation<br />
æœ€åçš„è¿‘ä¼¼ä¾èµ–äº$\boldsymbol{\theta}<em t-1="t-1">{t-1}\cdot\tilde{\boldsymbol{u}}_t\approx 0$ï¼Œæˆ‘ä»¬æ–­è¨€$\boldsymbol{\theta}</em>}\cdot\tilde{\boldsymbol{u}<em t-1="t-1">t$æ¯”$\boldsymbol{\theta}</em>}\cdot\boldsymbol{u<em t-1="t-1">t$æ›´æ¥è¿‘äºé›¶ï¼Œå› ä¸º$\tilde{\boldsymbol{u}}_t$åªä¾èµ–äºå½“å‰æ¢¯åº¦$\boldsymbol{g}_t$ï¼Œè€Œ$\boldsymbol{\theta}</em>}$è¿˜æ²¡æ¥è§¦åˆ°$\boldsymbol{g<em t-1="t-1">t$ï¼Œæ‰€ä»¥å®ƒä»¬æ˜¯ç‹¬ç«‹çš„å˜é‡ï¼Œå‡è®¾$\boldsymbol{g}_t$å…·æœ‰é›¶å‡å€¼æ—¶ï¼Œ$\boldsymbol{\theta}</em>}\cdot\tilde{\boldsymbol{u}<em RMS="RMS">t\approx 0$å¾€å¾€å°±å®¹æ˜“æˆç«‹äº†ã€‚è€Œä¸ºäº†ä¼°è®¡$\Vert\tilde{\boldsymbol{u}}_t\Vert</em>}^2$ï¼ŒåŸè®ºæ–‡ç›´æ¥å‡è®¾$\boldsymbol{g<em RMS="RMS">t/\sqrt{\boldsymbol{v}_k}$å…·æœ‰ç›¸åŒæ–¹å‘å¹¶ä¸”å•ä½RMSï¼Œäºæ˜¯<br />
\begin{equation}\Vert\tilde{\boldsymbol{u}}_t\Vert</em>} = \sum_{k=t}^{\infty} (1-\beta_1)\beta_1^{k-t}\left\Vert\frac{\boldsymbol{g<em RMS="RMS">t}{\sqrt{\boldsymbol{v}_k}}\right\Vert</em>} = \sum_{k=t}^{\infty} (1-\beta_1)\beta_1^{k-t} = 1\end{equation<br />
ä»£å…¥å¼$\eqref{eq:tilde-u-rms}$ï¼Œç»“åˆå¿«é€Ÿä¼°è®¡ä¸€èŠ‚åŒæ ·çš„è¿‘ä¼¼å¤„ç†ï¼Œè§£å¾—<br />
\begin{equation}\Vert\boldsymbol{\theta}<em RMS="RMS">t\Vert</em>} \approx \sqrt{\frac{\eta}{2\lambda}}\end{equation<br />
ç„¶è€Œï¼Œå¦‚æœå±€é™åœ¨åŸè®ºæ–‡çœ‹ï¼Œæˆ‘ä»¬ä¼šå‘ç°æœ‰å¾ˆå¤šè¿‘ä¼¼æ˜¯è«åå…¶å¦™çš„ï¼Œæ¯”å¦‚$\boldsymbol{v}<em RMS="RMS">t$ä¸­ä¹Ÿæœ‰$\boldsymbol{g}_t$ï¼Œæ‰€ä»¥è¯´$\tilde{\boldsymbol{u}}_t$åªåŒ…å«å½“å‰$\boldsymbol{g}_t$çš„å½±å“æ˜¯ä¸å¤§å‡†ç¡®çš„ï¼Œè¿˜æœ‰$\Vert\boldsymbol{g}_t/\sqrt{\boldsymbol{v}_k}\Vert</em>=1$çš„æ–­è¨€ä¹Ÿæ˜¾å¾—æ¯”è¾ƒç”Ÿç¡¬ã€‚ä½†å¦‚æœæ”¾åˆ°æœ¬æ–‡æ¥çœ‹ï¼Œæˆ‘ä»¬ä¼šå‘ç°åœ¨å¹³å‡åœºè¿‘ä¼¼ä¸‹ï¼ŒåŸè®ºæ–‡çš„å„ç§æ“ä½œä¼šæ˜¾å¾—å¾ˆåˆç†ï¼Œæ‰€ä»¥åŸè®ºæ–‡å…¶å®å·²ç»éšå«åœ°ç”¨åˆ°äº†å¹³å‡åœºæ–¹æ³•ã€‚</p>
<h2 id="_14">æ–‡ç« å°ç»“</h2>
<p>è¿™ç¯‡æ–‡ç« æˆ‘ä»¬ç”¨å¹³å‡åœºè¿‘ä¼¼æ¨å¯¼äº†ä¸€ä¸ªæœ‰è¶£ä¸”å¯èƒ½è®©äººæ„å¤–çš„ç»“è®ºï¼šAdamWè®­å‡ºæ¥çš„æ¨¡å‹ï¼Œå…¶æƒé‡çš„RMSä¹Ÿæ˜¯å¯ä»¥æ¸è¿‘ä¼°è®¡å‡ºæ¥çš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå®ƒåªä¾èµ–äºå­¦ä¹ ç‡å’ŒWeight Decayã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/11307">https://spaces.ac.cn/archives/11307</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Oct. 01, 2025). ã€ŠAdamWçš„Weight RMSçš„æ¸è¿‘ä¼°è®¡ ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/11307">https://spaces.ac.cn/archives/11307</a></p>
<p>@online{kexuefm-11307,<br />
title={AdamWçš„Weight RMSçš„æ¸è¿‘ä¼°è®¡},<br />
author={è‹å‰‘æ—},<br />
year={2025},<br />
month={Oct},<br />
url={\url{https://spaces.ac.cn/archives/11307}},<br />
} </p>
<hr />
<hr />
<h2 id="_15">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<h3 id="1-adamw">1. AdamWä¼˜åŒ–å™¨çš„å®Œæ•´æ•°å­¦å®šä¹‰</h3>
<p>AdamWæ˜¯Adamä¼˜åŒ–å™¨çš„å˜ä½“ï¼Œå¼•å…¥äº†è§£è€¦çš„æƒé‡è¡°å‡ï¼ˆDecoupled Weight Decayï¼‰ã€‚å…¶æ›´æ–°è§„åˆ™å¦‚ä¸‹ï¼š</p>
<p>ç»™å®šå‚æ•°$\theta_t$ï¼Œåœ¨ç¬¬$t$æ­¥çš„æ›´æ–°è¿‡ç¨‹ä¸ºï¼š</p>
<p>$$
\begin{aligned}
g_t &= \nabla_\theta \mathcal{L}(\theta_{t-1}) \\
m_t &= \beta_1 m_{t-1} + (1-\beta_1) g_t \\
v_t &= \beta_2 v_{t-1} + (1-\beta_2) g_t^2 \\
\hat{m}_t &= \frac{m_t}{1-\beta_1^t} \\
\hat{v}_t &= \frac{v_t}{1-\beta_2^t} \\
\theta_t &= \theta_{t-1} - \alpha \left(\frac{\hat{m}_t}{\sqrt{\hat{v}_t} + \epsilon} + \lambda \theta_{t-1}\right)
\end{aligned}
$$</p>
<p>å…¶ä¸­ï¼š
- $\alpha$æ˜¯å­¦ä¹ ç‡ï¼ˆlearning rateï¼‰
- $\beta_1, \beta_2$æ˜¯åŠ¨é‡å‚æ•°ï¼Œé€šå¸¸å–$\beta_1=0.9, \beta_2=0.999$
- $\epsilon$æ˜¯æ•°å€¼ç¨³å®šé¡¹ï¼Œé€šå¸¸å–$10^{-8}$
- $\lambda$æ˜¯æƒé‡è¡°å‡ç³»æ•°ï¼ˆweight decay coefficientï¼‰
- $g_t$æ˜¯æ¢¯åº¦ï¼Œ$m_t$æ˜¯ä¸€é˜¶çŸ©ä¼°è®¡ï¼Œ$v_t$æ˜¯äºŒé˜¶çŸ©ä¼°è®¡</p>
<p><strong>å…³é”®åŒºåˆ«</strong>ï¼šä¸Adamä¸åŒï¼ŒAdamWçš„æƒé‡è¡°å‡é¡¹$\lambda \theta_{t-1}$æ˜¯åœ¨è‡ªé€‚åº”å­¦ä¹ ç‡ä¹‹å¤–å•ç‹¬åº”ç”¨çš„ï¼Œè€Œä¸æ˜¯ä½œä¸ºæ¢¯åº¦çš„ä¸€éƒ¨åˆ†åŠ å…¥$L_2$æ­£åˆ™ã€‚</p>
<h3 id="2-weight-rms">2. Weight RMSçš„å®šä¹‰ä¸æ„ä¹‰</h3>
<p>æƒé‡çš„å‡æ–¹æ ¹ï¼ˆRoot Mean Square, RMSï¼‰å®šä¹‰ä¸ºï¼š</p>
<p>$$
\text{RMS}(\theta) = \sqrt{\frac{1}{d}\sum_{i=1}^d \theta_i^2} = \sqrt{\mathbb{E}[\theta^2]}
$$</p>
<p>å…¶ä¸­$d$æ˜¯å‚æ•°ç»´åº¦ã€‚åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼ŒWeight RMSåæ˜ äº†ï¼š</p>
<ol>
<li><strong>æ¨¡å‹å®¹é‡çš„ä½¿ç”¨ç¨‹åº¦</strong>ï¼šæ›´å¤§çš„RMSé€šå¸¸æ„å‘³ç€æ¨¡å‹ä½¿ç”¨äº†æ›´å¤šçš„è¡¨è¾¾èƒ½åŠ›</li>
<li><strong>æ­£åˆ™åŒ–å¼ºåº¦çš„ä½“ç°</strong>ï¼šæƒé‡è¡°å‡ä¼šé™åˆ¶RMSçš„å¢é•¿</li>
<li><strong>ä¼˜åŒ–åŠ¨æ€çš„è¡¨å¾</strong>ï¼šRMSéšè®­ç»ƒçš„æ¼”åŒ–åæ˜ äº†ä¼˜åŒ–è¿‡ç¨‹</li>
</ol>
<p><strong>æ ¸å¿ƒé—®é¢˜</strong>ï¼šç»™å®šAdamWçš„è¶…å‚æ•°$(\alpha, \beta_1, \beta_2, \lambda)$ï¼Œèƒ½å¦é¢„æµ‹è®­ç»ƒæ”¶æ•›åæƒé‡çš„æ¸è¿‘RMSï¼Ÿ</p>
<h3 id="3">3. å¹³å‡åœºè¿‘ä¼¼çš„åŸºæœ¬å‡è®¾</h3>
<p>å¹³å‡åœºè¿‘ä¼¼ï¼ˆMean Field Approximationï¼‰æ˜¯ç»Ÿè®¡ç‰©ç†ä¸­çš„ç»å…¸æ–¹æ³•ï¼Œç”¨äºå¤„ç†é«˜ç»´ç³»ç»Ÿã€‚åœ¨ä¼˜åŒ–å™¨åˆ†æä¸­ï¼Œæˆ‘ä»¬åšå¦‚ä¸‹å‡è®¾ï¼š</p>
<p><strong>å‡è®¾1ï¼ˆç»Ÿè®¡ç‹¬ç«‹æ€§ï¼‰</strong>ï¼šä¸åŒå‚æ•°åˆ†é‡åœ¨ç»Ÿè®¡æ„ä¹‰ä¸Šç‹¬ç«‹ä¸”åŒåˆ†å¸ƒï¼ˆi.i.d.ï¼‰</p>
<p><strong>å‡è®¾2ï¼ˆæ¢¯åº¦ç»Ÿè®¡ï¼‰</strong>ï¼šæ¢¯åº¦$g_t$å¯ä»¥åˆ†è§£ä¸º
$$
g_t = \mu_g + \sigma_g \xi_t
$$
å…¶ä¸­$\mu_g$æ˜¯å‡å€¼ï¼ˆé€šå¸¸åœ¨æ”¶æ•›æ—¶è¶‹äº0ï¼‰ï¼Œ$\sigma_g$æ˜¯æ ‡å‡†å·®ï¼Œ$\xi_t \sim \mathcal{N}(0, 1)$æ˜¯æ ‡å‡†æ­£æ€å™ªå£°ã€‚</p>
<p><strong>å‡è®¾3ï¼ˆç¨³æ€å‡è®¾ï¼‰</strong>ï¼šåœ¨$t \to \infty$æ—¶ï¼Œç³»ç»Ÿè¾¾åˆ°ç»Ÿè®¡ç¨³æ€ï¼Œå„é‡çš„ç»Ÿè®¡åˆ†å¸ƒä¸å†éšæ—¶é—´å˜åŒ–ã€‚</p>
<p>è¿™äº›å‡è®¾å…è®¸æˆ‘ä»¬ä»å•ä¸ªå‚æ•°çš„æ¼”åŒ–æ¨å¯¼æ•´ä½“è¡Œä¸ºã€‚</p>
<h3 id="4">4. æ¸è¿‘åˆ†ææ¡†æ¶</h3>
<p>åœ¨$t \to \infty$æ—¶ï¼Œåç½®ä¿®æ­£å› å­è¶‹äº1ï¼š
$$
1 - \beta_1^t \to 1, \quad 1 - \beta_2^t \to 1
$$</p>
<p>å› æ­¤$\hat{m}_t \to m_t$ï¼Œ$\hat{v}_t \to v_t$ã€‚æ›´æ–°æ–¹ç¨‹ç®€åŒ–ä¸ºï¼š</p>
<p>$$
\theta_t = \theta_{t-1} - \alpha \left(\frac{m_t}{\sqrt{v_t} + \epsilon} + \lambda \theta_{t-1}\right)
$$</p>
<p>é‡æ–°æ•´ç†ï¼š
$$
\theta_t = (1 - \alpha\lambda)\theta_{t-1} - \alpha \frac{m_t}{\sqrt{v_t} + \epsilon}
$$</p>
<p>å®šä¹‰<strong>æœ‰æ•ˆè¡°å‡ç‡</strong>ï¼š
$$
\gamma = 1 - \alpha\lambda
$$</p>
<p>åˆ™ï¼š
$$
\theta_t = \gamma \theta_{t-1} - \alpha \frac{m_t}{\sqrt{v_t} + \epsilon}
$$</p>
<p>è¿™æ˜¯ä¸€ä¸ªåŒ…å«é€’å½’å’Œéšæœºå™ªå£°çš„åŠ¨åŠ›å­¦æ–¹ç¨‹ã€‚</p>
<h3 id="5-m_t">5. ä¸€é˜¶çŸ©$m_t$çš„æ¸è¿‘è¡Œä¸º</h3>
<p>ä¸€é˜¶çŸ©çš„é€’æ¨ï¼š
$$
m_t = \beta_1 m_{t-1} + (1-\beta_1) g_t
$$</p>
<p>è¿™æ˜¯ä¸€ä¸ªæŒ‡æ•°ç§»åŠ¨å¹³å‡ï¼ˆEMAï¼‰ã€‚å…¶ç¨³æ€è§£æ»¡è¶³ï¼š</p>
<p>å‡è®¾$g_t$æ˜¯å¹³ç¨³éšæœºè¿‡ç¨‹ï¼Œå‡å€¼ä¸º$\mu_g$ï¼Œåˆ™ï¼š
$$
\mathbb{E}[m_\infty] = \frac{1-\beta_1}{1-\beta_1} \mu_g = \mu_g
$$</p>
<p>åœ¨æ”¶æ•›é™„è¿‘ï¼ˆæ¥è¿‘å±€éƒ¨æå°å€¼ï¼‰ï¼Œæ¢¯åº¦å‡å€¼$\mu_g \approx 0$ï¼Œå› æ­¤ï¼š
$$
\mathbb{E}[m_\infty] \approx 0
$$</p>
<p>ä½†$m_t$ä»æœ‰æ³¢åŠ¨ã€‚è®¡ç®—æ–¹å·®ï¼š
$$
\text{Var}(m_t) = \beta_1^2 \text{Var}(m_{t-1}) + (1-\beta_1)^2 \sigma_g^2
$$</p>
<p>ç¨³æ€æ—¶$\text{Var}(m_\infty) = \text{Var}(m_{\infty-1})$ï¼Œè§£å¾—ï¼š
$$
\text{Var}(m_\infty) = \frac{(1-\beta_1)^2}{1-\beta_1^2} \sigma_g^2 = \frac{1-\beta_1}{1+\beta_1} \sigma_g^2
$$</p>
<p>å¯¹äº$\beta_1 = 0.9$ï¼š
$$
\text{Var}(m_\infty) = \frac{0.1}{1.9} \sigma_g^2 \approx 0.053 \sigma_g^2
$$</p>
<h3 id="6-v_t">6. äºŒé˜¶çŸ©$v_t$çš„æ¸è¿‘è¡Œä¸º</h3>
<p>äºŒé˜¶çŸ©çš„é€’æ¨ï¼š
$$
v_t = \beta_2 v_{t-1} + (1-\beta_2) g_t^2
$$</p>
<p>å‡è®¾$\mathbb{E}[g_t^2] = \mu_g^2 + \sigma_g^2 \approx \sigma_g^2$ï¼ˆå› ä¸º$\mu_g \approx 0$ï¼‰ï¼Œç¨³æ€æ—¶ï¼š
$$
\mathbb{E}[v_\infty] = \sigma_g^2
$$</p>
<p>è¿™æ˜¯ä¸€ä¸ªå…³é”®ç»“æœï¼š<strong>äºŒé˜¶çŸ©ä¼°è®¡æ”¶æ•›åˆ°æ¢¯åº¦çš„æ–¹å·®</strong>ã€‚</p>
<p>è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦$v_\infty$æœ¬èº«çš„æ³¢åŠ¨ã€‚ç”±äº$g_t^2$çš„æ–¹å·®ä¸å››é˜¶çŸ©æœ‰å…³ï¼Œå‡è®¾æ¢¯åº¦æœä»é«˜æ–¯åˆ†å¸ƒï¼Œåˆ™ï¼š
$$
\mathbb{E}[g_t^4] = 3\sigma_g^4
$$</p>
<p>å¯ä»¥è¯æ˜ï¼š
$$
\text{Var}(v_\infty) = \frac{1-\beta_2}{1+\beta_2} \cdot 2\sigma_g^4
$$</p>
<p>ä½†åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç”±äº$\beta_2 = 0.999$éå¸¸æ¥è¿‘1ï¼Œ$v_t$çš„æ³¢åŠ¨ç›¸å¯¹è¾ƒå°ï¼Œæˆ‘ä»¬å¯ä»¥è¿‘ä¼¼ï¼š
$$
v_t \approx \mathbb{E}[v_\infty] = \sigma_g^2
$$</p>
<h3 id="7">7. æƒé‡åŠ¨åŠ›å­¦çš„ç®€åŒ–</h3>
<p>å°†ä¸Šè¿°ç»“æœä»£å…¥æƒé‡æ›´æ–°æ–¹ç¨‹ï¼š
$$
\theta_t = \gamma \theta_{t-1} - \alpha \frac{m_t}{\sqrt{v_t} + \epsilon}
$$</p>
<p>å¿½ç•¥$\epsilon$ï¼ˆå‡è®¾$v_t \gg \epsilon^2$ï¼‰ï¼š
$$
\theta_t \approx \gamma \theta_{t-1} - \alpha \frac{m_t}{\sqrt{\sigma_g^2}} = \gamma \theta_{t-1} - \frac{\alpha}{\sigma_g} m_t
$$</p>
<p>å®šä¹‰æ ‡å‡†åŒ–çš„ä¸€é˜¶çŸ©ï¼š
$$
\tilde{m}_t = \frac{m_t}{\sigma_g}
$$</p>
<p>åˆ™ï¼š
$$
\theta_t = \gamma \theta_{t-1} - \alpha \tilde{m}_t
$$</p>
<p>è¿™æ˜¯ä¸€ä¸ªçº¿æ€§éšæœºå·®åˆ†æ–¹ç¨‹ã€‚</p>
<h3 id="8">8. ç¨³æ€æ–¹ç¨‹çš„æ¨å¯¼</h3>
<p>åœ¨ç¨³æ€ä¸‹ï¼Œ$\theta_t$çš„åˆ†å¸ƒä¸éšæ—¶é—´å˜åŒ–ã€‚å¯¹æ–¹ç¨‹ä¸¤è¾¹å–å¹³æ–¹å¹¶æ±‚æœŸæœ›ï¼š</p>
<p>$$
\mathbb{E}[\theta_\infty^2] = \gamma^2 \mathbb{E}[\theta_{\infty-1}^2] + \alpha^2 \mathbb{E}[\tilde{m}_\infty^2] - 2\alpha\gamma \mathbb{E}[\theta_{\infty-1} \tilde{m}_\infty]
$$</p>
<p><strong>å…³é”®å‡è®¾ï¼ˆå¹³å‡åœºè§£è€¦ï¼‰</strong>ï¼šå‡è®¾$\theta_{t-1}$ä¸$m_t$åœ¨ç»Ÿè®¡ä¸Šç‹¬ç«‹ï¼ˆè¿™æ˜¯å¹³å‡åœºè¿‘ä¼¼çš„æ ¸å¿ƒï¼‰ï¼Œåˆ™ï¼š
$$
\mathbb{E}[\theta_{\infty-1} \tilde{m}_\infty] = \mathbb{E}[\theta_{\infty-1}] \mathbb{E}[\tilde{m}_\infty] \approx 0
$$</p>
<p>å› ä¸º$\mathbb{E}[\tilde{m}_\infty] = 0$ã€‚</p>
<p>å› æ­¤ï¼š
$$
\mathbb{E}[\theta_\infty^2] = \gamma^2 \mathbb{E}[\theta_\infty^2] + \alpha^2 \mathbb{E}[\tilde{m}_\infty^2]
$$</p>
<p>åˆ©ç”¨$\text{Var}(\tilde{m}_\infty) = \frac{1-\beta_1}{1+\beta_1}$ï¼ˆä»ç¬¬5èŠ‚ï¼Œé™¤ä»¥$\sigma_g^2$ï¼‰ï¼š
$$
\mathbb{E}[\tilde{m}_\infty^2] = \frac{1-\beta_1}{1+\beta_1}
$$</p>
<p>ä»£å…¥ç¨³æ€æ–¹ç¨‹ï¼š
$$
\mathbb{E}[\theta_\infty^2] = \gamma^2 \mathbb{E}[\theta_\infty^2] + \alpha^2 \frac{1-\beta_1}{1+\beta_1}
$$</p>
<p>è§£å¾—ï¼š
$$
\mathbb{E}[\theta_\infty^2] = \frac{\alpha^2}{1-\gamma^2} \cdot \frac{1-\beta_1}{1+\beta_1}
$$</p>
<h3 id="9">9. æƒé‡è¡°å‡çš„å½±å“</h3>
<p>å›å¿†$\gamma = 1 - \alpha\lambda$ï¼Œåˆ™ï¼š
$$
1 - \gamma^2 = 1 - (1-\alpha\lambda)^2 = 2\alpha\lambda - \alpha^2\lambda^2 = \alpha\lambda(2 - \alpha\lambda)
$$</p>
<p>å½“$\alpha\lambda \ll 1$ï¼ˆé€šå¸¸æƒ…å†µï¼‰ï¼Œè¿‘ä¼¼ï¼š
$$
1 - \gamma^2 \approx 2\alpha\lambda
$$</p>
<p>ä»£å…¥ï¼š
$$
\mathbb{E}[\theta_\infty^2] \approx \frac{\alpha^2}{2\alpha\lambda} \cdot \frac{1-\beta_1}{1+\beta_1} = \frac{\alpha}{2\lambda} \cdot \frac{1-\beta_1}{1+\beta_1}
$$</p>
<h3 id="10-weight-rms">10. Weight RMSçš„æ¸è¿‘å…¬å¼</h3>
<p>æƒé‡çš„RMSå®šä¹‰ä¸º$\sqrt{\mathbb{E}[\theta_\infty^2]}$ï¼Œå› æ­¤ï¼š</p>
<p>$$
\boxed{\text{RMS}(\theta_\infty) = \sqrt{\frac{\alpha}{2\lambda} \cdot \frac{1-\beta_1}{1+\beta_1}}}
$$</p>
<p>è¿™æ˜¯<strong>æ ¸å¿ƒç»“æœ</strong>ï¼æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li><strong>ä¸å­¦ä¹ ç‡çš„å…³ç³»</strong>ï¼š$\text{RMS} \propto \sqrt{\alpha}$ï¼Œå­¦ä¹ ç‡è¶Šå¤§ï¼Œæƒé‡RMSè¶Šå¤§</li>
<li><strong>ä¸æƒé‡è¡°å‡çš„å…³ç³»</strong>ï¼š$\text{RMS} \propto \frac{1}{\sqrt{\lambda}}$ï¼Œæƒé‡è¡°å‡è¶Šå¼ºï¼ŒRMSè¶Šå°</li>
<li><strong>ä¸æ¢¯åº¦ç»Ÿè®¡æ— å…³</strong>ï¼šæƒŠäººçš„æ˜¯ï¼Œ$\sigma_g$æ¶ˆå¤±äº†ï¼RMSåªä¾èµ–äºä¼˜åŒ–å™¨è¶…å‚</li>
<li><strong>ä¸äºŒé˜¶çŸ©å‚æ•°$\beta_2$æ— å…³</strong>ï¼šåªä¸ä¸€é˜¶çŸ©å‚æ•°$\beta_1$æœ‰å…³</li>
</ol>
<h3 id="11">11. æ•°å€¼éªŒè¯</h3>
<p>å¯¹äºå…¸å‹çš„AdamWè¶…å‚æ•°ï¼š
- $\alpha = 10^{-3}$
- $\lambda = 0.01$
- $\beta_1 = 0.9$
- $\beta_2 = 0.999$</p>
<p>è®¡ç®—ï¼š
$$
\frac{1-\beta_1}{1+\beta_1} = \frac{0.1}{1.9} \approx 0.0526
$$</p>
<p>$$
\text{RMS} = \sqrt{\frac{10^{-3}}{2 \times 0.01} \times 0.0526} = \sqrt{\frac{0.001}{0.02} \times 0.0526} = \sqrt{0.05 \times 0.0526} \approx \sqrt{0.00263} \approx 0.051
$$</p>
<p>è¿™æ„å‘³ç€å…¸å‹è®­ç»ƒåçš„æƒé‡RMSçº¦ä¸º<strong>0.05</strong>é‡çº§ã€‚</p>
<h3 id="12-">12. ä¸åŒå­¦ä¹ ç‡-æƒé‡è¡°å‡æ¯”ä¾‹çš„åˆ†æ</h3>
<p>å®šä¹‰æ¯”ä¾‹$r = \frac{\alpha}{\lambda}$ï¼Œåˆ™ï¼š
$$
\text{RMS} = \sqrt{\frac{r}{2} \cdot \frac{1-\beta_1}{1+\beta_1}}
$$</p>
<p>è¿™è¡¨æ˜ï¼š
- è‹¥ä¿æŒ$\frac{\alpha}{\lambda}$æ’å®šï¼Œæ”¹å˜$\alpha$å’Œ$\lambda$çš„ç»å¯¹å€¼ä¸ä¼šæ”¹å˜æ¸è¿‘RMS
- ä¾‹å¦‚ï¼š$(\alpha=0.001, \lambda=0.01)$ä¸$(\alpha=0.01, \lambda=0.1)$ä¼šäº§ç”Ÿç›¸åŒçš„RMS</p>
<p>è¿™ä¸å®éªŒè§‚å¯Ÿä¸€è‡´ï¼š<strong>å­¦ä¹ ç‡å’Œæƒé‡è¡°å‡çš„æ¯”ä¾‹å†³å®šäº†æ¨¡å‹çš„æœ€ç»ˆå°ºåº¦</strong>ã€‚</p>
<h3 id="13-adam">13. ä¸Adamï¼ˆæ— æƒé‡è¡°å‡ï¼‰çš„å¯¹æ¯”</h3>
<p>å¯¹äºæ ‡å‡†Adamï¼ˆ$\lambda=0$ï¼‰ï¼Œä¸Šè¿°æ¨å¯¼ä¸­$\gamma = 1$ï¼Œç¨³æ€æ–¹ç¨‹å˜ä¸ºï¼š
$$
\mathbb{E}[\theta_\infty^2] = \mathbb{E}[\theta_\infty^2] + \alpha^2 \frac{1-\beta_1}{1+\beta_1}
$$</p>
<p>è¿™ä¸ªæ–¹ç¨‹æ— è§£ï¼ˆé™¤é$\alpha=0$ï¼‰ï¼Œæ„å‘³ç€ï¼š</p>
<p><strong>Adamä¸å­˜åœ¨ç¨³æ€ï¼</strong> æƒé‡ä¼šæŒç»­å¢é•¿ï¼ˆæˆ–å‡å°ï¼‰ï¼Œæ²¡æœ‰å‡è¡¡ç‚¹ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå®è·µä¸­Adaméœ€è¦å…¶ä»–æ­£åˆ™åŒ–æ‰‹æ®µï¼ˆå¦‚æ¢¯åº¦è£å‰ªã€å±‚å½’ä¸€åŒ–ï¼‰çš„åŸå› ã€‚</p>
<p>åªæœ‰å¼•å…¥æƒé‡è¡°å‡ï¼ˆAdamWï¼‰ï¼Œç³»ç»Ÿæ‰èƒ½è¾¾åˆ°åŠ¨æ€å¹³è¡¡ï¼š
- æƒé‡è¡°å‡æä¾›<strong>æ”¶ç¼©åŠ›</strong>ï¼Œä½¿æƒé‡è¶‹å‘0
- æ¢¯åº¦æ›´æ–°æä¾›<strong>æ‰©å¼ åŠ›</strong>ï¼Œä½¿æƒé‡åç¦»0
- å¹³è¡¡ç‚¹å°±æ˜¯æˆ‘ä»¬æ¨å¯¼çš„RMS</p>
<h3 id="14-epsilon">14. æ›´ç²¾ç¡®çš„åˆ†æï¼šè€ƒè™‘$\epsilon$çš„å½±å“</h3>
<p>ä¹‹å‰æˆ‘ä»¬å¿½ç•¥äº†$\epsilon$ï¼Œç°åœ¨è€ƒè™‘å…¶å½±å“ã€‚æ›´æ–°æ–¹ç¨‹ï¼š
$$
\theta_t = \gamma \theta_{t-1} - \alpha \frac{m_t}{\sqrt{v_t} + \epsilon}
$$</p>
<p>å®šä¹‰æœ‰æ•ˆçš„è‡ªé€‚åº”å­¦ä¹ ç‡ï¼š
$$
\alpha_{\text{eff}} = \frac{\alpha}{\sqrt{v_t} + \epsilon} \approx \frac{\alpha}{\sqrt{\sigma_g^2} + \epsilon}
$$</p>
<p>å½“$\sigma_g \gg \epsilon$æ—¶ï¼Œ$\alpha_{\text{eff}} \approx \frac{\alpha}{\sigma_g}$ï¼Œä¸ä¹‹å‰åˆ†æä¸€è‡´ã€‚</p>
<p>å½“$\sigma_g \ll \epsilon$ï¼ˆæ¥è¿‘å®Œç¾æ”¶æ•›ï¼‰ï¼Œ$\alpha_{\text{eff}} \approx \frac{\alpha}{\epsilon}$ï¼Œæ­¤æ—¶æ›´æ–°æ­¥é•¿ç”±$\epsilon$æ§åˆ¶ï¼Œé˜²æ­¢æ•°å€¼ä¸ç¨³å®šã€‚</p>
<p>åœ¨å®è·µä¸­ï¼Œ$\epsilon = 10^{-8}$éå¸¸å°ï¼Œå¯¹å¤§å¤šæ•°å±‚$\sigma_g \gg \epsilon$ï¼Œå› æ­¤æˆ‘ä»¬çš„è¿‘ä¼¼æ˜¯åˆç†çš„ã€‚</p>
<h3 id="15-rms">15. å±‚çº§ä¾èµ–çš„RMS</h3>
<p>ä¸åŒå±‚çš„æ¢¯åº¦ç»Ÿè®¡$\sigma_g$å¯èƒ½ä¸åŒã€‚ä½†ç”±äºæœ€ç»ˆå…¬å¼ï¼š
$$
\text{RMS} = \sqrt{\frac{\alpha}{2\lambda} \cdot \frac{1-\beta_1}{1+\beta_1}}
$$</p>
<p><strong>ä¸$\sigma_g$æ— å…³</strong>ï¼Œè¿™æ„å‘³ç€ï¼š</p>
<p><strong>æ‰€æœ‰å±‚çš„æƒé‡RMSæ¸è¿‘åˆ°ç›¸åŒçš„å€¼ï¼</strong>ï¼ˆå‰ææ˜¯ä½¿ç”¨ç›¸åŒçš„$\alpha, \lambda, \beta_1$ï¼‰</p>
<p>è¿™æ˜¯ä¸€ä¸ªå¼ºæœ‰åŠ›çš„ç»“è®ºã€‚åœ¨å®è·µä¸­ï¼š
- ä¸åŒå±‚å¯èƒ½æœ‰ä¸åŒçš„åˆå§‹å°ºåº¦
- ä½†ç»è¿‡è¶³å¤Ÿé•¿çš„AdamWè®­ç»ƒï¼Œå®ƒä»¬ä¼šæ”¶æ•›åˆ°ç›¸åŒçš„RMS
- è¿™ç§°ä¸º<strong>æ—‹è½¬å¹³è¡¡</strong>ï¼ˆRotational Equilibriumï¼‰ï¼Œå³è®ºæ–‡æ ‡é¢˜æ‰€æŒ‡</p>
<h3 id="16">16. æƒé‡åˆå§‹åŒ–çš„å½±å“</h3>
<p>è€ƒè™‘åˆå§‹æ¡ä»¶$\theta_0$ã€‚ä»é€’æ¨å…³ç³»ï¼š
$$
\theta_t = \gamma^t \theta_0 + \sum_{k=1}^t \gamma^{t-k} \left(-\alpha \frac{m_k}{\sqrt{v_k}}\right)
$$</p>
<p>ç¬¬ä¸€é¡¹$\gamma^t \theta_0$ä»¥æŒ‡æ•°é€Ÿåº¦è¡°å‡ï¼ˆå› ä¸º$\gamma &lt; 1$ï¼‰ï¼š
$$
\gamma^t = (1-\alpha\lambda)^t \approx e^{-\alpha\lambda t}
$$</p>
<p><strong>é—å¿˜æ—¶é—´å°ºåº¦</strong>ï¼š
$$
\tau_{\text{forget}} = \frac{1}{\alpha\lambda}
$$</p>
<p>å¯¹äº$\alpha=0.001, \lambda=0.01$ï¼š
$$
\tau_{\text{forget}} = \frac{1}{10^{-5}} = 10^5 \text{ æ­¥}
$$</p>
<p>åœ¨çº¦$10^5$æ­¥åï¼Œåˆå§‹åŒ–çš„å½±å“åŸºæœ¬æ¶ˆå¤±ï¼Œæƒé‡å®Œå…¨ç”±ä¼˜åŒ–å™¨è¶…å‚å†³å®šã€‚</p>
<h3 id="17">17. å¤šå‚æ•°ç»„çš„æ‰©å±•</h3>
<p>åœ¨å®è·µä¸­ï¼Œä¸åŒå‚æ•°ç»„å¯èƒ½æœ‰ä¸åŒçš„$\alpha, \lambda$ï¼ˆå¦‚å­¦ä¹ ç‡ç¼©æ”¾ã€å±‚çº§æƒé‡è¡°å‡ï¼‰ã€‚</p>
<p>å¯¹äºç¬¬$i$ç»„å‚æ•°ï¼Œå…¶RMSä¸ºï¼š
$$
\text{RMS}_i = \sqrt{\frac{\alpha_i}{2\lambda_i} \cdot \frac{1-\beta_1}{1+\beta_1}}
$$</p>
<p>è¿™å…è®¸<strong>æ˜¾å¼æ§åˆ¶ä¸åŒå±‚çš„å°ºåº¦</strong>ï¼š
- è‹¥å¸Œæœ›æŸå±‚æƒé‡æ›´å¤§ï¼Œå¢å¤§$\frac{\alpha_i}{\lambda_i}$
- è‹¥å¸Œæœ›æŸå±‚æƒé‡æ›´å°ï¼Œå‡å°$\frac{\alpha_i}{\lambda_i}$</p>
<p>ä¾‹å¦‚ï¼Œå¯¹äºè¾“å‡ºå±‚ï¼Œå¯ä»¥è®¾ç½®æ›´å°çš„$\frac{\alpha}{\lambda}$ä»¥è·å¾—æ›´å°çš„æƒé‡ï¼Œæœ‰åŠ©äºç¨³å®šè®­ç»ƒã€‚</p>
<h3 id="18">18. è®­ç»ƒåŠ¨æ€çš„æ—¶é—´æ¼”åŒ–</h3>
<p>è™½ç„¶æˆ‘ä»¬å…³æ³¨æ¸è¿‘å€¼ï¼Œä½†è®­ç»ƒè¿‡ç¨‹ä¸­RMSå¦‚ä½•æ¼”åŒ–ï¼Ÿ</p>
<p>ä»å·®åˆ†æ–¹ç¨‹çš„è§£ï¼š
$$
\mathbb{E}[\theta_t^2] = \gamma^{2t} \mathbb{E}[\theta_0^2] + \frac{1-\gamma^{2t}}{1-\gamma^2} \alpha^2 \frac{1-\beta_1}{1+\beta_1}
$$</p>
<p>éšç€$t \to \infty$ï¼Œ$\gamma^{2t} \to 0$ï¼Œç¬¬ä¸€é¡¹æ¶ˆå¤±ã€‚RMSçš„æ—¶é—´æ¼”åŒ–ï¼š
$$
\text{RMS}(t) = \sqrt{\gamma^{2t} \text{RMS}_0^2 + (1-\gamma^{2t}) \text{RMS}_\infty^2}
$$</p>
<p>è¿™æ˜¯ä»åˆå§‹RMSåˆ°æ¸è¿‘RMSçš„æŒ‡æ•°è¡°å‡/å¢é•¿ï¼š
- è‹¥$\text{RMS}<em>0 &gt; \text{RMS}</em>\infty$ï¼šæƒé‡é€æ¸æ”¶ç¼©
- è‹¥$\text{RMS}<em>0 &lt; \text{RMS}</em>\infty$ï¼šæƒé‡é€æ¸æ‰©å¼ </p>
<p>æ—¶é—´å¸¸æ•°ä¸º$\tau_{\text{eq}} = \frac{1}{2\alpha\lambda}$ã€‚</p>
<h3 id="19">19. å®éªŒéªŒè¯ç­–ç•¥</h3>
<p>ç†è®ºé¢„æµ‹å¯ä»¥é€šè¿‡ä»¥ä¸‹å®éªŒéªŒè¯ï¼š</p>
<p><strong>å®éªŒ1ï¼šæ”¹å˜$\alpha/\lambda$æ¯”ä¾‹</strong>
- å›ºå®š$\beta_1=0.9$ï¼Œå°è¯•ä¸åŒçš„$(\alpha, \lambda)$ç»„åˆ
- æµ‹é‡æ”¶æ•›åçš„æƒé‡RMS
- éªŒè¯$\text{RMS} \propto \sqrt{\alpha/\lambda}$</p>
<p><strong>å®éªŒ2ï¼šæ”¹å˜$\beta_1$</strong>
- å›ºå®š$\alpha, \lambda$ï¼Œæ”¹å˜$\beta_1$ï¼ˆå¦‚0.8, 0.9, 0.95ï¼‰
- éªŒè¯$\text{RMS} \propto \sqrt{\frac{1-\beta_1}{1+\beta_1}}$</p>
<p><strong>å®éªŒ3ï¼šä¸åŒåˆå§‹åŒ–</strong>
- ä½¿ç”¨ä¸åŒçš„æƒé‡åˆå§‹åŒ–ï¼ˆå¦‚Xavier, Heï¼‰
- éªŒè¯ç»è¿‡è¶³å¤Ÿæ­¥æ•°åRMSæ”¶æ•›åˆ°ç›¸åŒå€¼</p>
<p><strong>å®éªŒ4ï¼šå±‚çº§ä¸€è‡´æ€§</strong>
- åœ¨æ·±åº¦ç½‘ç»œä¸­ï¼Œæµ‹é‡æ¯å±‚çš„RMS
- éªŒè¯æ‰€æœ‰å±‚æ”¶æ•›åˆ°ç›¸åŒçš„RMSï¼ˆä½¿ç”¨ç›¸åŒè¶…å‚æ—¶ï¼‰</p>
<h3 id="20">20. ç†è®ºçš„é€‚ç”¨èŒƒå›´å’Œå±€é™</h3>
<p><strong>é€‚ç”¨æ¡ä»¶</strong>ï¼š
1. è®­ç»ƒæ¥è¿‘æ”¶æ•›ï¼ˆæ¢¯åº¦å‡å€¼$\approx 0$ï¼‰
2. å‚æ•°ç»´åº¦è¶³å¤Ÿé«˜ï¼ˆå¹³å‡åœºè¿‘ä¼¼æœ‰æ•ˆï¼‰
3. æ¢¯åº¦å™ªå£°ä¸é€€åŒ–ï¼ˆ$\sigma_g$ä¸è¶‹äº0ï¼‰
4. $\alpha\lambda \ll 1$ï¼ˆå°æ­¥é•¿è¿‘ä¼¼ï¼‰</p>
<p><strong>å±€é™æ€§</strong>ï¼š
1. <strong>è®­ç»ƒæ—©æœŸ</strong>ï¼šç†è®ºé¢„æµ‹ç¨³æ€ï¼Œä¸é€‚ç”¨äºè®­ç»ƒåˆæœŸçš„ç¬æ€è¡Œä¸º
2. <strong>æ¢¯åº¦ç›¸å…³æ€§</strong>ï¼šå®é™…ä¸­ä¸åŒå‚æ•°çš„æ¢¯åº¦å¯èƒ½ç›¸å…³ï¼Œå¹³å‡åœºå‡è®¾å¤±æ•ˆ
3. <strong>éé«˜æ–¯æ¢¯åº¦</strong>ï¼šè‹¥æ¢¯åº¦åˆ†å¸ƒä¸¥é‡éé«˜æ–¯ï¼Œæ–¹å·®åˆ†æå¯èƒ½ä¸å‡†ç¡®
4. <strong>å­¦ä¹ ç‡è°ƒåº¦</strong>ï¼šç†è®ºå‡è®¾å›ºå®šè¶…å‚ï¼Œå­¦ä¹ ç‡è¡°å‡ä¼šæ”¹å˜ç»“æœ
5. <strong>ç¨€ç–æ¢¯åº¦</strong>ï¼šå¯¹äºåµŒå…¥å±‚ç­‰ç¨€ç–æ›´æ–°ï¼Œéœ€è¦æ›´ç²¾ç»†çš„å»ºæ¨¡</p>
<h3 id="21">21. ä¸å…¶ä»–æ­£åˆ™åŒ–çš„äº¤äº’</h3>
<p>AdamWçš„æƒé‡è¡°å‡å¯ä»¥è§†ä¸º$L_2$æ­£åˆ™åŒ–çš„ä¸€ç§å½¢å¼ã€‚è€ƒè™‘å…¶ä»–æ­£åˆ™åŒ–ï¼š</p>
<p><strong>Dropout</strong>ï¼šå¼•å…¥éšæœºæ€§ï¼Œå¢å¤§æ¢¯åº¦æ–¹å·®$\sigma_g$ï¼Œä½†ä¸æ”¹å˜å…¬å¼ï¼ˆå› ä¸ºRMSä¸$\sigma_g$æ— å…³ï¼‰</p>
<p><strong>Batch Normalization</strong>ï¼šå½’ä¸€åŒ–æ¿€æ´»ï¼Œé—´æ¥å½±å“æ¢¯åº¦ç»Ÿè®¡ï¼Œå¯èƒ½æ”¹å˜$\sigma_g$çš„å±‚çº§åˆ†å¸ƒ</p>
<p><strong>Gradient Clipping</strong>ï¼šé™åˆ¶æ¢¯åº¦èŒƒæ•°ï¼Œç›¸å½“äºæ”¹å˜æ¢¯åº¦åˆ†å¸ƒçš„å°¾éƒ¨ï¼Œå¯èƒ½å½±å“$\mathbb{E}[m_t^2]$</p>
<p><strong>Layer-wise Learning Rate</strong>ï¼šä¸åŒå±‚çš„$\alpha_i$ä¸åŒï¼Œå¯¼è‡´å±‚çº§RMSå·®å¼‚</p>
<p>ç»¼åˆæ­£åˆ™åŒ–çš„å½±å“éœ€è¦æ›´å¤æ‚çš„åˆ†æã€‚</p>
<h3 id="22">22. æ·±åº¦å­¦ä¹ ç†è®ºçš„å¯ç¤º</h3>
<p>è¿™ä¸ªåˆ†ææ­ç¤ºäº†å‡ ä¸ªæ·±åˆ»çš„ç†è®ºé—®é¢˜ï¼š</p>
<p><strong>1. ä¼˜åŒ–å™¨çš„éšå¼åå¥½</strong>ï¼šä¼˜åŒ–å™¨ä¸ä»…å†³å®š"å¦‚ä½•æ”¶æ•›"ï¼Œè¿˜å†³å®š"æ”¶æ•›åˆ°å“ªé‡Œ"ã€‚AdamWéšå¼åœ°é€‰æ‹©äº†ç‰¹å®šRMSçš„è§£ã€‚</p>
<p><strong>2. è¶…å‚æ•°çš„åŒé‡ä½œç”¨</strong>ï¼š
   - $\alpha$ï¼šæ§åˆ¶æ”¶æ•›é€Ÿåº¦ + æ§åˆ¶æƒé‡å°ºåº¦
   - $\lambda$ï¼šæ§åˆ¶æ­£åˆ™åŒ–å¼ºåº¦ + æ§åˆ¶æƒé‡å°ºåº¦</p>
<p><strong>3. å°ºåº¦ä¸å˜æ€§çš„ç ´ç¼º</strong>ï¼šè™½ç„¶æŸå¤±å‡½æ•°å¯èƒ½å¯¹æƒé‡å°ºåº¦ä¸æ•æ„Ÿï¼ˆå¦‚ReLUç½‘ç»œï¼‰ï¼ŒAdamWæ‰“ç ´äº†è¿™ç§å¯¹ç§°æ€§ï¼Œé€‰æ‹©äº†ç‰¹å®šå°ºåº¦ã€‚</p>
<p><strong>4. è®­ç»ƒä¸æ³›åŒ–çš„è”ç³»</strong>ï¼šæƒé‡RMSä¸æ³›åŒ–æ€§èƒ½ç›¸å…³ï¼ˆæ›´å¤§çš„æƒé‡å¯èƒ½è¿‡æ‹Ÿåˆï¼‰ï¼Œç†è®ºé¢„æµ‹å¸®åŠ©æˆ‘ä»¬ç†è§£è¶…å‚æ•°å¦‚ä½•å½±å“æ³›åŒ–ã€‚</p>
<h3 id="23">23. æ¨å¹¿åˆ°å…¶ä»–ä¼˜åŒ–å™¨</h3>
<p>ç±»ä¼¼çš„åˆ†æå¯åº”ç”¨äºå…¶ä»–ä¼˜åŒ–å™¨ï¼š</p>
<p><strong>SGD with Momentum + Weight Decay</strong>ï¼š
$$
\text{RMS} \propto \sqrt{\frac{\alpha}{\lambda}}
$$
ï¼ˆä¸AdamWç±»ä¼¼ï¼Œä½†ç³»æ•°ä¸åŒï¼‰</p>
<p><strong>RMSprop + Weight Decay</strong>ï¼š
$$
\text{RMS} \propto \sqrt{\frac{\alpha}{\lambda} \cdot f(\beta_2)}
$$
ï¼ˆä¾èµ–äºäºŒé˜¶çŸ©å‚æ•°ï¼‰</p>
<p><strong>Lion Optimizer</strong>ï¼šéœ€è¦ä¸åŒçš„åˆ†ææ¡†æ¶ï¼Œå› ä¸ºå…¶æ›´æ–°è§„åˆ™åŸºäºç¬¦å·è€Œéå¹…åº¦</p>
<p>è¿™äº›åˆ†ææœ‰åŠ©äºç»Ÿä¸€ç†è§£ä¸åŒä¼˜åŒ–å™¨çš„è¡Œä¸ºã€‚</p>
<h3 id="24">24. ç†è®ºå…¬å¼çš„å®ç”¨å»ºè®®</h3>
<p>åŸºäºæ¨å¯¼çš„å…¬å¼ï¼Œæˆ‘ä»¬å¯ä»¥æä¾›å®ç”¨çš„è¶…å‚æ•°é€‰æ‹©å»ºè®®ï¼š</p>
<p><strong>é€‰æ‹©1ï¼šå›ºå®šç›®æ ‡RMS</strong>
è‹¥å¸Œæœ›æƒé‡RMSçº¦ä¸º$R$ï¼Œåˆ™é€‰æ‹©ï¼š
$$
\lambda = \frac{\alpha}{2R^2} \cdot \frac{1-\beta_1}{1+\beta_1}
$$</p>
<p>ä¾‹å¦‚ï¼Œç›®æ ‡$R=0.1$ï¼Œ$\alpha=0.001$ï¼Œ$\beta_1=0.9$ï¼š
$$
\lambda = \frac{0.001}{2 \times 0.01} \times 0.0526 = 0.00263 \approx 0.003
$$</p>
<p><strong>é€‰æ‹©2ï¼šå‚æ•°é‡è‡ªé€‚åº”</strong>
å¯¹äºå¤§æ¨¡å‹ï¼Œå¯ä»¥æ ¹æ®å‚æ•°é‡è°ƒæ•´$\lambda$ï¼Œä¿æŒRMSæ’å®šã€‚</p>
<p><strong>é€‰æ‹©3ï¼šå­¦ä¹ ç‡é¢„çƒ­ä¸æƒé‡è¡°å‡</strong>
åœ¨é¢„çƒ­é˜¶æ®µï¼Œ$\alpha$å¢å¤§ï¼Œä¸ºä¿æŒRMSç¨³å®šï¼Œå¯ä»¥åŒæ­¥å¢å¤§$\lambda$ã€‚</p>
<h3 id="25">25. ç»“è®ºä¸å±•æœ›</h3>
<p>é€šè¿‡å¹³å‡åœºè¿‘ä¼¼ï¼Œæˆ‘ä»¬æ¨å¯¼å‡ºAdamWçš„æƒé‡RMSæ¸è¿‘å…¬å¼ï¼š</p>
<p>$$
\boxed{\text{RMS}(\theta_\infty) = \sqrt{\frac{\alpha}{2\lambda} \cdot \frac{1-\beta_1}{1+\beta_1}}}
$$</p>
<p><strong>å…³é”®å‘ç°</strong>ï¼š
1. RMSå®Œå…¨ç”±ä¼˜åŒ–å™¨è¶…å‚å†³å®šï¼Œä¸æ¢¯åº¦ç»Ÿè®¡ã€åˆå§‹åŒ–æ— å…³ï¼ˆæ¸è¿‘åœ°ï¼‰
2. $\text{RMS} \propto \sqrt{\alpha/\lambda}$ï¼Œå­¦ä¹ ç‡-æƒé‡è¡°å‡æ¯”ä¾‹æ˜¯æ ¸å¿ƒ
3. æ‰€æœ‰å±‚æ”¶æ•›åˆ°ç›¸åŒRMSï¼ˆä½¿ç”¨ç›¸åŒè¶…å‚æ—¶ï¼‰
4. Adamï¼ˆæ— æƒé‡è¡°å‡ï¼‰ä¸å­˜åœ¨ç¨³æ€ï¼Œå¿…é¡»å¼•å…¥$\lambda &gt; 0$</p>
<p><strong>æœªæ¥æ–¹å‘</strong>ï¼š
- æ‰©å±•åˆ°éå¹³ç¨³è®¾ç½®ï¼ˆå­¦ä¹ ç‡è°ƒåº¦ï¼‰
- è€ƒè™‘æ¢¯åº¦ç›¸å…³æ€§çš„å½±å“
- åˆ†æç¬æ€åŠ¨åŠ›å­¦ï¼ˆè®­ç»ƒæ—©æœŸï¼‰
- ä¸ç¥ç»ç½‘ç»œæ¶æ„ï¼ˆå¦‚Transformerï¼‰çš„å…·ä½“äº¤äº’
- æ³›åŒ–ç•Œçš„ç†è®ºè”ç³»</p>
<p>è¿™ä¸€ç†è®ºæ¡†æ¶ä¸ºç†è§£å’Œè®¾è®¡ä¼˜åŒ–å™¨æä¾›äº†æ–°çš„è§†è§’ï¼Œä¹Ÿä¸ºè¶…å‚æ•°è°ƒä¼˜æä¾›äº†ç†è®ºæŒ‡å¯¼ã€‚</p>
        </div>
    </div>
</body>
</html>