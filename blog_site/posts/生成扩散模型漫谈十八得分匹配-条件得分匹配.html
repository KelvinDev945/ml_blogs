<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆåå…«ï¼‰ï¼šå¾—åˆ†åŒ¹é… = æ¡ä»¶å¾—åˆ†åŒ¹é…</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆåå…«ï¼‰ï¼šå¾—åˆ†åŒ¹é… = æ¡ä»¶å¾—åˆ†åŒ¹é…</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-26 | ğŸ“„ å¤§å°: 45.4 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/9509">https://spaces.ac.cn/archives/9509</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>åœ¨å‰é¢çš„ä»‹ç»ä¸­ï¼Œæˆ‘ä»¬å¤šæ¬¡æåŠâ€œå¾—åˆ†åŒ¹é…â€å’Œâ€œæ¡ä»¶å¾—åˆ†åŒ¹é…â€ï¼Œå®ƒä»¬æ˜¯æ‰©æ•£æ¨¡å‹ã€èƒ½é‡æ¨¡å‹ç­‰ç»å¸¸å‡ºç°çš„æ¦‚å¿µï¼Œç‰¹åˆ«æ˜¯å¾ˆå¤šæ–‡ç« ç›´æ¥è¯´æ‰©æ•£æ¨¡å‹çš„è®­ç»ƒç›®æ ‡æ˜¯â€œå¾—åˆ†åŒ¹é…â€ï¼Œä½†äº‹å®ä¸Šå½“å‰ä¸»æµçš„æ‰©æ•£æ¨¡å‹å¦‚DDPMçš„è®­ç»ƒç›®æ ‡æ˜¯â€œæ¡ä»¶å¾—åˆ†åŒ¹é…â€æ‰å¯¹ã€‚</p>
<p>é‚£ä¹ˆâ€œå¾—åˆ†åŒ¹é…â€ä¸â€œæ¡ä»¶å¾—åˆ†åŒ¹é…â€å…·ä½“æ˜¯ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿå®ƒä»¬ä¸¤è€…æ˜¯å¦ç­‰ä»·å‘¢ï¼Ÿæœ¬æ–‡è¯¦ç»†è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚</p>
<h2 id="_1">å¾—åˆ†åŒ¹é…</h2>
<p>é¦–å…ˆï¼Œå¾—åˆ†åŒ¹é…ï¼ˆScore Matchingï¼‰æ˜¯æŒ‡è®­ç»ƒç›®æ ‡ï¼š<br />
\begin{equation}\mathbb{E}<em _boldsymbol_x="\boldsymbol{x">{\boldsymbol{x}_t\sim p_t(\boldsymbol{x}_t)}\left[\left\Vert\nabla</em><em _boldsymbol_theta="\boldsymbol{\theta">t}\log p_t(\boldsymbol{x}_t) - \boldsymbol{s}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t,t)\right\Vert^2\right]\label{eq:sm}\end{equation}<br />
å…¶ä¸­$\boldsymbol{\theta}$æ˜¯è®­ç»ƒå‚æ•°ã€‚å¾ˆæ˜æ˜¾ï¼Œå¾—åˆ†åŒ¹é…æ˜¯æƒ³å­¦ä¹ ä¸€ä¸ªæ¨¡å‹$\boldsymbol{s}</em>}}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t,t)$æ¥é€¼è¿‘$\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\log p_t(\boldsymbol{x}_t)$ï¼Œè¿™é‡Œçš„$\nabla</em>_t)$æˆ‘ä»¬å°±ç§°ä¸ºâ€œå¾—åˆ†â€ã€‚}_t}\log p_t(\boldsymbol{x</p>
<p>åœ¨æ‰©æ•£æ¨¡å‹åœºæ™¯ï¼Œ$p_t(\boldsymbol{x}<em _boldsymbol_x="\boldsymbol{x">t)$ç”±ä¸‹å¼ç»™å‡ºï¼š<br />
\begin{equation}p_t(\boldsymbol{x}_t) = \int p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)p_0(\boldsymbol{x}_0)d\boldsymbol{x}_0 = \mathbb{E}</em>}_0\sim p_0(\boldsymbol{x}_0)}\left[p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\right]\label{eq:pt}\end{equation<br />
å…¶ä¸­$p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)$ä¸€èˆ¬éƒ½æ˜¯å·²çŸ¥æ¦‚ç‡å¯†åº¦è§£æå¼çš„ç®€å•åˆ†å¸ƒï¼ˆå¦‚æ¡ä»¶æ­£æ€åˆ†å¸ƒï¼‰ï¼Œ$p_0(\boldsymbol{x}_0)$ä¹Ÿæ˜¯ç»™å®šçš„åˆ†å¸ƒï¼Œä½†ä¸€èˆ¬ä»£è¡¨è®­ç»ƒæ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªèƒ½ä»$p_0(\boldsymbol{x}_0)$ä¸­é‡‡æ ·ï¼Œä½†ä¸çŸ¥é“$p_0(\boldsymbol{x}_0)$çš„å…·ä½“è¡¨è¾¾å¼ã€‚</p>
<p>æ ¹æ®å¼$\eqref{eq:pt}$ï¼Œæˆ‘ä»¬å¯ä»¥æ¨å¯¼å¾—<br />
\begin{equation}\begin{aligned}<br />
\nabla_{\boldsymbol{x}<em _boldsymbol_x="\boldsymbol{x">t}\log p_t(\boldsymbol{x}_t) =&amp;\, \frac{\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}p_t(\boldsymbol{x}_t)}{p_t(\boldsymbol{x}_t)} \\\<br />
=&amp;\, \frac{\int p_0(\boldsymbol{x}_0)\nabla</em><em _boldsymbol_x="\boldsymbol{x">t} p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)d\boldsymbol{x}_0}{p_t(\boldsymbol{x}_t)} \\\<br />
=&amp;\, \frac{\int p_0(\boldsymbol{x}_0)\nabla</em><em _boldsymbol_x="\boldsymbol{x">t} p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)d\boldsymbol{x}_0}{\int p_0(\boldsymbol{x}_0) p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)d\boldsymbol{x}_0} \\\<br />
=&amp;\, \frac{\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">0\sim p_0(\boldsymbol{x}_0)}\left[\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\right]}{\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">0\sim p_0(\boldsymbol{x}_0)}\left[p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\right]} \\\<br />
\end{aligned}\label{eq:score-1}\end{equation}<br />
æ ¹æ®æˆ‘ä»¬çš„å‡è®¾ï¼Œ$\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)$å’Œ$p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)$éƒ½æ˜¯å·²çŸ¥è§£æå¼çš„ï¼Œå› æ­¤ç†è®ºä¸Šæˆ‘ä»¬å¯ä»¥é€šè¿‡é‡‡æ ·$\boldsymbol{x}_0$æ¥ä¼°è®¡$\nabla</em>_t)$ï¼Œä½†ç”±äºè¿™é‡Œæ¶‰åŠåˆ°ä¸¤ä¸ªæœŸæœ›çš„é™¤æ³•ï¼Œæ˜¯ä¸€ä¸ªæœ‰åä¼°è®¡ï¼ˆå‚è€ƒ}_t}\log p_t(\boldsymbol{x<a href="/archives/6747">ã€Šç®€è¿°æ— åä¼°è®¡å’Œæœ‰åä¼°è®¡ã€‹</a>ï¼‰ï¼Œå› æ­¤éœ€è¦é‡‡æ ·è¶³å¤Ÿå¤šçš„ç‚¹æ‰èƒ½åšå‡ºæ¯”è¾ƒå‡†ç¡®çš„ä¼°è®¡ï¼Œå› æ­¤ç›´æ¥ç”¨å¼$\eqref{eq:sm}$ä½œä¸ºè®­ç»ƒç›®æ ‡çš„è¯ï¼Œéœ€è¦è¾ƒå¤§çš„batch_sizeæ‰æœ‰æ¯”è¾ƒå¥½çš„æ•ˆæœã€‚</p>
<h2 id="_2">æ¡ä»¶å¾—åˆ†</h2>
<p>å®é™…ä¸Šï¼Œä¸€èˆ¬æ‰©æ•£æ¨¡å‹æ‰€ç”¨çš„è®­ç»ƒç›®æ ‡æ˜¯â€œæ¡ä»¶å¾—åˆ†åŒ¹é…ï¼ˆConditional Score Matchingï¼‰â€ï¼š<br />
\begin{equation}\mathbb{E}<em _boldsymbol_x="\boldsymbol{x">{\boldsymbol{x}_0,\boldsymbol{x}_t\sim p_0(\boldsymbol{x}_0)p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)}\left[\left\Vert\nabla</em><em _boldsymbol_theta="\boldsymbol{\theta">t}\log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0) - \boldsymbol{s}</em>}}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t,t)\right\Vert^2\right]\end{equation}<br />
æ ¹æ®å‡è®¾ï¼Œ$\nabla</em>_t)$è¿›è¡Œä¼°ç®—ã€‚ç‰¹åˆ«åœ°ï¼Œè¿™æ˜¯ä¸€ä¸ªæ— åä¼°è®¡ï¼Œè¿™æ„å‘³ç€å®ƒä¸æ˜¯ç‰¹åˆ«ä¾èµ–äºå¤§batch_sizeï¼Œå› æ­¤æ˜¯ä¸€ä¸ªæ¯”è¾ƒå®ç”¨çš„è®­ç»ƒç›®æ ‡ã€‚}_t}\log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)$æ˜¯å·²çŸ¥è§£æå¼çš„ï¼Œå› æ­¤ä¸Šè¿°ç›®æ ‡æ˜¯ç›´æ¥å¯ç”¨çš„ï¼Œæ¯æ¬¡é‡‡æ ·ä¸€å¯¹$(\boldsymbol{x}_0,\boldsymbol{x</p>
<p>ä¸ºäº†åˆ†æâ€œå¾—åˆ†åŒ¹é…â€ä¸â€œæ¡ä»¶å¾—åˆ†åŒ¹é…â€çš„å…³ç³»ï¼Œæˆ‘ä»¬è¿˜éœ€è¦$\nabla_{\boldsymbol{x}<em _boldsymbol_x="\boldsymbol{x">t}\log p_t(\boldsymbol{x}_t)$çš„å¦ä¸€ä¸ªæ’ç­‰å¼ï¼š<br />
\begin{equation}\begin{aligned}<br />
\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\log p_t(\boldsymbol{x}_t) =&amp;\, \frac{\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}p_t(\boldsymbol{x}_t)}{p_t(\boldsymbol{x}_t)} \\\<br />
=&amp;\, \frac{\int p_0(\boldsymbol{x}_0)\nabla</em><em _boldsymbol_x="\boldsymbol{x">t} p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)d\boldsymbol{x}_0}{p_t(\boldsymbol{x}_t)} \\\<br />
=&amp;\, \frac{\int p_0(\boldsymbol{x}_0)p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\nabla</em><em _boldsymbol_x="\boldsymbol{x">t} \log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0) d\boldsymbol{x}_0}{p_t(\boldsymbol{x}_t)} \\\<br />
=&amp;\, \int p_t(\boldsymbol{x}_0|\boldsymbol{x}_t)\nabla</em><em _boldsymbol_x="\boldsymbol{x">t} \log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0) d\boldsymbol{x}_0 \\\<br />
=&amp;\, \mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">0\sim p_t(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\nabla</em>_0)\right] \\\}_t} \log p_t(\boldsymbol{x}_t|\boldsymbol{x<br />
\end{aligned}\label{eq:score-2}\end{equation}</p>
<h2 id="_3">ä¸ç­‰å…³ç³»</h2>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå¿«é€Ÿåœ°è¯æ˜ä¸¤è€…ä¹‹é—´çš„ç¬¬ä¸€ä¸ªç»“æœï¼šæ¡ä»¶å¾—åˆ†åŒ¹é…æ˜¯å¾—åˆ†åŒ¹é…çš„ä¸€ä¸ªä¸Šç•Œã€‚è¿™ä¹Ÿå°±æ„å‘³ç€æœ€å°åŒ–æ¡ä»¶å¾—åˆ†åŒ¹é…ï¼ŒæŸç§ç¨‹åº¦ä¸Šä¹Ÿåœ¨æœ€å°åŒ–å¾—åˆ†åŒ¹é…ã€‚</p>
<p>è¯æ˜å¹¶ä¸å›°éš¾ï¼Œä¹‹å‰æˆ‘ä»¬åœ¨<a href="/archives/9467">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆåå…­ï¼‰ï¼šWè·ç¦» â‰¤ å¾—åˆ†åŒ¹é…ã€‹</a>å°±å·²ç»è¯æ˜è¿‡ï¼š<br />
\begin{equation}\begin{aligned}<br />
&amp;\,\mathbb{E}<em _boldsymbol_x="\boldsymbol{x">{\boldsymbol{x}_t\sim p_t(\boldsymbol{x}_t)}\left[\left\Vert\nabla</em><em _boldsymbol_theta="\boldsymbol{\theta">t}\log p_t(\boldsymbol{x}_t) - \boldsymbol{s}</em>}}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t,t)\right\Vert^2\right] \\\<br />
=&amp;\,\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">t\sim p_t(\boldsymbol{x}_t)}\left[\left\Vert\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">0\sim p_t(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\nabla</em><em _boldsymbol_theta="\boldsymbol{\theta">t}\log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\right] - \boldsymbol{s}</em>}}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t,t)\right\Vert^2\right] \\\<br />
\leq &amp;\,\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">t\sim p_t(\boldsymbol{x}_t)}\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">0\sim p_t(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\left\Vert\nabla</em><em _boldsymbol_theta="\boldsymbol{\theta">t}\log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0) - \boldsymbol{s}</em>}}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t,t)\right\Vert^2\right] \\\<br />
= &amp;\,\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">0\sim p_0(\boldsymbol{x}_0),\boldsymbol{x}_t\sim p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)}\left[\left\Vert\nabla</em><em _boldsymbol_theta="\boldsymbol{\theta">t}\log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0) - \boldsymbol{s}</em>_t,t)\right\Vert^2\right] \\\}}(\boldsymbol{x<br />
\end{aligned}\end{equation}<br />
ç¬¬ä¸€ä¸ªç­‰å·æ˜¯å› ä¸ºæ’ç­‰å¼$\eqref{eq:score-2}$ï¼Œç¬¬äºŒä¸ªä¸ç­‰å·åˆ™æ˜¯å› ä¸ºå¹³æ–¹å¹³å‡ä¸ç­‰å¼çš„æ¨å¹¿æˆ–è€…è©¹æ£®ä¸ç­‰å¼ï¼Œç¬¬ä¸‰ä¸ªç­‰å·åˆ™æ˜¯è´å¶æ–¯å…¬å¼äº†ã€‚</p>
<h2 id="_4">ç­‰ä»·å…³ç³»</h2>
<p>å‰ä¸¤å¤©ï¼Œåœ¨å¾®ä¿¡ç¾¤é‡Œå¤§å®¶è®¨è®ºåˆ°å¾—åˆ†åŒ¹é…çš„æ—¶å€™ï¼Œæœ‰ç¾¤å‹æŒ‡ç‚¹åˆ°ï¼šæ¡ä»¶å¾—åˆ†åŒ¹é…ä¸å¾—åˆ†åŒ¹é…ä¹‹å·®æ˜¯ä¸€ä¸ªè·Ÿä¼˜åŒ–æ— å…³çš„å¸¸æ•°ï¼Œæ‰€ä»¥ä¸¤è€…å®é™…ä¸Šæ˜¯å®Œå…¨ç­‰ä»·çš„ï¼åˆšå¬åˆ°è¿™ä¸ªç»“è®ºçš„æ—¶å€™ç¬”è€…ä¹Ÿç›¸å½“æƒŠè®¶ï¼Œä¸¤è€…å±…ç„¶è¿˜æ˜¯ç­‰ä»·å…³ç³»ï¼Œè€Œä¸å•å•æ˜¯ä¸Šä¸‹ç•Œå…³ç³»ã€‚ä¸ä»…å¦‚æ­¤ï¼Œç¬”è€…å°è¯•è¯æ˜äº†ä¸€ä¸‹åï¼Œå‘ç°è¯æ˜è¿‡ç¨‹å±…ç„¶ä¹Ÿå¾ˆç®€å•ï¼</p>
<p>é¦–å…ˆï¼Œå…³äºå¾—åˆ†åŒ¹é…ï¼Œæˆ‘ä»¬æœ‰<br />
\begin{equation}\begin{aligned}<br />
&amp;\,\mathbb{E}<em _boldsymbol_x="\boldsymbol{x">{\boldsymbol{x}_t\sim p_t(\boldsymbol{x}_t)}\left[\left\Vert\nabla</em><em _boldsymbol_theta="\boldsymbol{\theta">t}\log p_t(\boldsymbol{x}_t) - \boldsymbol{s}</em>}}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t,t)\right\Vert^2\right] \\\<br />
=&amp;\,\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">t\sim p_t(\boldsymbol{x}_t)}\left[\color{orange}{\left\Vert\nabla</em><em _boldsymbol_theta="\boldsymbol{\theta">t}\log p_t(\boldsymbol{x}_t)\right\Vert^2} + \color{red}{\left\Vert\boldsymbol{s}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t,t)\right\Vert^2} - \color{green}{2\boldsymbol{s}</em>}}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t,t)\cdot\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\log p_t(\boldsymbol{x}_t)}\right] \\\<br />
\end{aligned}\end{equation}<br />
ç„¶åï¼Œå…³äºæ¡ä»¶å¾—åˆ†åŒ¹é…ï¼Œæˆ‘ä»¬æœ‰<br />
\begin{equation}\begin{aligned}<br />
&amp;\,\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">0,\boldsymbol{x}_t\sim p_0(\boldsymbol{x}_0)p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)}\left[\left\Vert\nabla</em><em _boldsymbol_theta="\boldsymbol{\theta">t}\log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0) - \boldsymbol{s}</em>}}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t,t)\right\Vert^2\right] \\\[5pt]<br />
=&amp;\,\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">0,\boldsymbol{x}_t\sim p_0(\boldsymbol{x}_0)p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)}\left[\left\Vert\nabla</em><em _boldsymbol_theta="\boldsymbol{\theta">t}\log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\right\Vert^2 + \left\Vert\boldsymbol{s}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t,t)\right\Vert^2 - 2\boldsymbol{s}</em>}}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t,t)\cdot\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\right] \\\[5pt]<br />
=&amp;\,\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">t\sim p_t(\boldsymbol{x}_t),\boldsymbol{x}_0\sim p_t(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\left\Vert\nabla</em><em _boldsymbol_theta="\boldsymbol{\theta">t}\log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\right\Vert^2 + \left\Vert\boldsymbol{s}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t,t)\right\Vert^2 - 2\boldsymbol{s}</em>}}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t,t)\cdot\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\right] \\\[5pt]<br />
=&amp;\,\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">t\sim p_t(\boldsymbol{x}_t)}\left[{\begin{aligned}&amp;\color{orange}{\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">0\sim p_t(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\left\Vert\nabla</em><em _boldsymbol_theta="\boldsymbol{\theta">t}\log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\right\Vert^2\right]} + \color{red}{\left\Vert\boldsymbol{s}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t,t)\right\Vert^2} \\\<br />
&amp;\qquad\qquad- \color{green}{2\boldsymbol{s}</em>}}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t,t)\cdot\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">0\sim p_t(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\right]}\end{aligned}}\right] \\\[5pt]<br />
=&amp;\,\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">t\sim p_t(\boldsymbol{x}_t)}\left[\color{orange}{\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">0\sim p_t(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\left\Vert\nabla</em><em _boldsymbol_theta="\boldsymbol{\theta">t}\log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\right\Vert^2\right]} + \color{red}{\left\Vert\boldsymbol{s}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t,t)\right\Vert^2} - \color{green}{2\boldsymbol{s}</em>}}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t,t)\cdot\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\log p_t(\boldsymbol{x}_t)}\right] \\\<br />
\end{aligned}\end{equation}<br />
ä¸¤è€…ä½œå·®ï¼Œå¯ä»¥å‘ç°ç»“æœæ˜¯<br />
\begin{equation}\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">t\sim p_t(\boldsymbol{x}_t)}\left[\color{orange}{\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">0\sim p_t(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\left\Vert\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\right\Vert^2\right] - \left\Vert\nabla</em>}_t}\log p_t(\boldsymbol{x}_t)\right\Vert^2}\right]\end{equation<br />
å®ƒè·Ÿå‚æ•°$\boldsymbol{\theta}$æ— å…³ã€‚æ‰€ä»¥æœ€å°åŒ–å¾—åˆ†åŒ¹é…ç›®æ ‡ï¼Œè·Ÿæœ€å°åŒ–æ¡ä»¶å¾—åˆ†åŒ¹é…ï¼Œåœ¨ç†è®ºä¸Šæ˜¯ç­‰ä»·çš„ã€‚æ ¹æ®ç¾¤å‹ä»‹ç»ï¼Œç›¸å…³ç»“æœé¦–æ¬¡å‡ºç°åœ¨æ–‡ç« <a href="https://www.iro.umontreal.ca/~vincentp/Publications/smdae_techreport.pdf">ã€ŠA Connection Between Score Matching and Denoising Autoencodersã€‹</a>ä¸­ã€‚</p>
<p>æ—¢ç„¶ä¸¤è€…ç†è®ºä¸Šç­‰ä»·ï¼Œè¿™æ˜¯ä¸æ˜¯æ„å‘³ç€æˆ‘ä»¬å‰é¢çš„â€œå¾—åˆ†åŒ¹é…â€æ¯”â€œæ¡ä»¶å¾—åˆ†åŒ¹é…â€éœ€è¦æ›´å¤§batch_sizeçš„è¯´æ³•ä¸æˆç«‹ï¼Ÿå¹¶ä¸æ˜¯ã€‚å¦‚æœè¿˜æ˜¯ç›´æ¥ä»å¼$\eqref{eq:score-1}$æ¥ä¼°è®¡$\nabla_{\boldsymbol{x}_t}\log p_t(\boldsymbol{x}_t)$ç„¶ååšå¾—åˆ†åŒ¹é…ï¼Œé‚£ä¹ˆç»“æœç¡®å®è¿˜æ˜¯æœ‰åçš„ï¼Œä¾èµ–äºå¤§batch_sizeï¼›è€Œå½“æˆ‘ä»¬å°†ç›®æ ‡$\eqref{eq:sm}$å±•å¼€è¿›ä¸€æ­¥åŒ–ç®€åï¼Œå·²ç»é€æ­¥å°†æœ‰åä¼°è®¡è½¬åŒ–ä¸ºæ— åä¼°è®¡äº†ï¼Œè¿™æ—¶å€™ä¸ä¼šå¤ªä¾èµ–äºbatch_sizeã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè™½ç„¶ä¸¤ä¸ªç›®æ ‡ä»ç†è®ºä¸Šæ˜¯ç­‰ä»·çš„ï¼Œä»ç»Ÿè®¡é‡çš„è§’åº¦ï¼Œå±äºä¸åŒæ€§è´¨çš„ç»Ÿè®¡é‡ï¼Œå®ƒä»¬çš„ç­‰ä»·ä»…ä»…æ˜¯åœ¨é‡‡æ ·æ ·æœ¬æ•°è¶‹äºæ— ç©·æ—¶çš„ç²¾ç¡®ç­‰ä»·ã€‚</p>
<h2 id="_5">æ–‡ç« å°ç»“</h2>
<p>æœ¬æ–‡ä¸»è¦åˆ†æâ€œå¾—åˆ†åŒ¹é…â€å’Œâ€œæ¡ä»¶å¾—åˆ†åŒ¹é…â€ä¸¤ä¸ªè®­ç»ƒç›®æ ‡ä¹‹é—´çš„å…³è”ã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/9509">https://spaces.ac.cn/archives/9509</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Feb. 28, 2023). ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆåå…«ï¼‰ï¼šå¾—åˆ†åŒ¹é… = æ¡ä»¶å¾—åˆ†åŒ¹é… ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/9509">https://spaces.ac.cn/archives/9509</a></p>
<p>@online{kexuefm-9509,<br />
title={ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆåå…«ï¼‰ï¼šå¾—åˆ†åŒ¹é… = æ¡ä»¶å¾—åˆ†åŒ¹é…},<br />
author={è‹å‰‘æ—},<br />
year={2023},<br />
month={Feb},<br />
url={\url{https://spaces.ac.cn/archives/9509}},<br />
} </p>
<hr />
<h2 id="_6">è¯¦ç»†æ•°å­¦æ¨å¯¼</h2>
<h3 id="1-score">1. Scoreå‡½æ•°çš„å®šä¹‰ä¸å‡ ä½•æ„ä¹‰</h3>
<h4 id="11-score">1.1 Scoreå‡½æ•°çš„å®šä¹‰</h4>
<p>å¯¹äºæ¦‚ç‡å¯†åº¦å‡½æ•°$p(\boldsymbol{x})$ï¼Œå…¶<strong>Scoreå‡½æ•°</strong>å®šä¹‰ä¸ºå¯¹æ•°æ¦‚ç‡å¯†åº¦çš„æ¢¯åº¦ï¼š
$$
\boldsymbol{s}(\boldsymbol{x}) = \nabla_{\boldsymbol{x}} \log p(\boldsymbol{x})
$$</p>
<p>å±•å¼€åå¯ä»¥å¾—åˆ°ï¼š
$$
\boldsymbol{s}(\boldsymbol{x}) = \nabla_{\boldsymbol{x}} \log p(\boldsymbol{x}) = \frac{\nabla_{\boldsymbol{x}} p(\boldsymbol{x})}{p(\boldsymbol{x})}
$$</p>
<p>è¿™ä¸ªå®šä¹‰è¯´æ˜ï¼ŒScoreå‡½æ•°æ˜¯æ¦‚ç‡å¯†åº¦å‡½æ•°çš„æ¢¯åº¦ä¸æ¦‚ç‡å¯†åº¦å‡½æ•°å€¼ä¹‹æ¯”ã€‚</p>
<p><strong>æ€§è´¨1</strong>ï¼šScoreå‡½æ•°å…·æœ‰ä¸å˜æ€§ï¼Œå³å¯¹äºä»»æ„å¸¸æ•°$Z$ï¼š
$$
\nabla_{\boldsymbol{x}} \log \frac{p(\boldsymbol{x})}{Z} = \nabla_{\boldsymbol{x}} \log p(\boldsymbol{x}) - \nabla_{\boldsymbol{x}} \log Z = \nabla_{\boldsymbol{x}} \log p(\boldsymbol{x})
$$</p>
<p>å› æ­¤ï¼Œå³ä½¿æˆ‘ä»¬ä¸çŸ¥é“å½’ä¸€åŒ–å¸¸æ•°$Z$ï¼Œä¹Ÿèƒ½è®¡ç®—Scoreå‡½æ•°ã€‚è¿™ä¸€æ€§è´¨å¯¹äºèƒ½é‡æ¨¡å‹ï¼ˆEnergy-Based Modelsï¼‰ç‰¹åˆ«é‡è¦ã€‚</p>
<h4 id="12-score">1.2 Scoreå‡½æ•°çš„å‡ ä½•æ„ä¹‰</h4>
<p>ä»å‡ ä½•è§’åº¦ç†è§£ï¼ŒScoreå‡½æ•°æŒ‡å‘æ¦‚ç‡å¯†åº¦å‡½æ•°å¢é•¿æœ€å¿«çš„æ–¹å‘ã€‚å…·ä½“æ¥è¯´ï¼š</p>
<ol>
<li><strong>æ–¹å‘æ€§</strong>ï¼š$\boldsymbol{s}(\boldsymbol{x})$æŒ‡å‘$p(\boldsymbol{x})$å¢é•¿æœ€å¿«çš„æ–¹å‘</li>
<li><strong>å¤§å°</strong>ï¼š$|\boldsymbol{s}(\boldsymbol{x})|$è¡¨ç¤ºå¢é•¿é€Ÿç‡çš„å¿«æ…¢</li>
<li><strong>ç‰©ç†æ„ä¹‰</strong>ï¼šå¯ä»¥ç†è§£ä¸º"æ•°æ®ç©ºé—´ä¸­æŒ‡å‘é«˜å¯†åº¦åŒºåŸŸçš„åŠ›åœº"</li>
</ol>
<p>å¯¹äºå¤šæ¨¡æ€åˆ†å¸ƒï¼ŒScoreå‡½æ•°åœ¨æ¯ä¸ªæ¨¡å¼é™„è¿‘éƒ½æŒ‡å‘è¯¥æ¨¡å¼çš„ä¸­å¿ƒï¼Œåœ¨ä¸åŒæ¨¡å¼ä¹‹é—´çš„ä½å¯†åº¦åŒºåŸŸï¼ŒScoreå‡½æ•°ä¼šå‘ç”Ÿæ–¹å‘çš„æ€¥å‰§å˜åŒ–ã€‚</p>
<h4 id="13-score">1.3 Scoreå‡½æ•°çš„ç»Ÿè®¡æ€§è´¨</h4>
<p><strong>æœŸæœ›æ€§è´¨</strong>ï¼šå¯¹äºä»»æ„å…‰æ»‘å‡½æ•°$f(\boldsymbol{x})$ï¼Œæœ‰ï¼š
$$
\mathbb{E}_{\boldsymbol{x} \sim p(\boldsymbol{x})}[f(\boldsymbol{x}) \nabla_{\boldsymbol{x}} \log p(\boldsymbol{x})] = -\mathbb{E}_{\boldsymbol{x} \sim p(\boldsymbol{x})}[\nabla_{\boldsymbol{x}} f(\boldsymbol{x})]
$$</p>
<p>è¿™ä¸ªæ’ç­‰å¼ç§°ä¸º<strong>Steinæ’ç­‰å¼</strong>ï¼Œè¯æ˜å¦‚ä¸‹ï¼š
$$
\begin{aligned}
\mathbb{E}_{\boldsymbol{x} \sim p(\boldsymbol{x})}[f(\boldsymbol{x}) \nabla_{\boldsymbol{x}} \log p(\boldsymbol{x})] &= \int f(\boldsymbol{x}) \nabla_{\boldsymbol{x}} \log p(\boldsymbol{x}) p(\boldsymbol{x}) d\boldsymbol{x} \\
&= \int f(\boldsymbol{x}) \frac{\nabla_{\boldsymbol{x}} p(\boldsymbol{x})}{p(\boldsymbol{x})} p(\boldsymbol{x}) d\boldsymbol{x} \\
&= \int f(\boldsymbol{x}) \nabla_{\boldsymbol{x}} p(\boldsymbol{x}) d\boldsymbol{x}
\end{aligned}
$$</p>
<p>ä½¿ç”¨åˆ†éƒ¨ç§¯åˆ†ï¼ˆå‡è®¾è¾¹ç•Œæ¡ä»¶$\lim_{|\boldsymbol{x}| \to \infty} f(\boldsymbol{x}) p(\boldsymbol{x}) = 0$ï¼‰ï¼š
$$
\begin{aligned}
\int f(\boldsymbol{x}) \nabla_{\boldsymbol{x}} p(\boldsymbol{x}) d\boldsymbol{x} &= \left[f(\boldsymbol{x}) p(\boldsymbol{x})\right]_{-\infty}^{\infty} - \int \nabla_{\boldsymbol{x}} f(\boldsymbol{x}) p(\boldsymbol{x}) d\boldsymbol{x} \\
&= -\int \nabla_{\boldsymbol{x}} f(\boldsymbol{x}) p(\boldsymbol{x}) d\boldsymbol{x} \\
&= -\mathbb{E}_{\boldsymbol{x} \sim p(\boldsymbol{x})}[\nabla_{\boldsymbol{x}} f(\boldsymbol{x})]
\end{aligned}
$$</p>
<h3 id="2-score-matching">2. Score Matchingçš„åŸå§‹ç›®æ ‡å‡½æ•°</h3>
<h4 id="21-fisherscore-matching">2.1 Fisheræ•£åº¦ä¸Score Matching</h4>
<p>æˆ‘ä»¬å¸Œæœ›è®­ç»ƒä¸€ä¸ªç¥ç»ç½‘ç»œ$\boldsymbol{s}<em _boldsymbol_x="\boldsymbol{x">{\boldsymbol{\theta}}(\boldsymbol{x})$æ¥é€¼è¿‘çœŸå®çš„Scoreå‡½æ•°$\nabla</em>)$ã€‚æœ€ç›´æ¥çš„æƒ³æ³•æ˜¯æœ€å°åŒ–ä¸¤è€…çš„å‡æ–¹è¯¯å·®ï¼š
$$
\mathcal{L}_{\text{naive}}(\boldsymbol{\theta}) = \mathbb{E}_{\boldsymbol{x} \sim p(\boldsymbol{x})}\left[\frac{1}{2}\left\|\boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}) - \nabla_{\boldsymbol{x}} \log p(\boldsymbol{x})\right\|^2\right]
$$}} \log p(\boldsymbol{x</p>
<p>è¿™ä¸ªç›®æ ‡ä¹Ÿç§°ä¸º<strong>Fisheræ•£åº¦</strong>ï¼ˆFisher Divergenceï¼‰çš„ä¸€åŠï¼š
$$
\mathcal{D}_F(p, q) = \mathbb{E}_{\boldsymbol{x} \sim p(\boldsymbol{x})}\left[\left\|\nabla_{\boldsymbol{x}} \log p(\boldsymbol{x}) - \nabla_{\boldsymbol{x}} \log q(\boldsymbol{x})\right\|^2\right]
$$</p>
<p>å±•å¼€è¿™ä¸ªç›®æ ‡å‡½æ•°ï¼š
$$
\begin{aligned}
\mathcal{L}_{\text{naive}}(\boldsymbol{\theta}) &= \frac{1}{2}\mathbb{E}_{\boldsymbol{x} \sim p(\boldsymbol{x})}\left[\left\|\boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x})\right\|^2 - 2\boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}) \cdot \nabla_{\boldsymbol{x}} \log p(\boldsymbol{x}) + \left\|\nabla_{\boldsymbol{x}} \log p(\boldsymbol{x})\right\|^2\right]
\end{aligned}
$$</p>
<p>é—®é¢˜åœ¨äºï¼Œç¬¬ä¸‰é¡¹$\mathbb{E}<em _boldsymbol_x="\boldsymbol{x">{\boldsymbol{x} \sim p(\boldsymbol{x})}[|\nabla</em>)$çš„å€¼ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬ä¸çŸ¥é“çš„ã€‚}} \log p(\boldsymbol{x})|^2]$ä¸å‚æ•°$\boldsymbol{\theta}$æ— å…³ï¼Œå¯ä»¥å¿½ç•¥ã€‚ç¬¬äºŒé¡¹éœ€è¦çŸ¥é“$\nabla_{\boldsymbol{x}} \log p(\boldsymbol{x</p>
<h4 id="22-stein">2.2 åˆ©ç”¨Steinæ’ç­‰å¼é‡å†™ç›®æ ‡å‡½æ•°</h4>
<p>å…³é”®è§‚å¯Ÿï¼šåˆ©ç”¨Steinæ’ç­‰å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç¬¬äºŒé¡¹æ”¹å†™ä¸ºä¸éœ€è¦$\nabla_{\boldsymbol{x}} \log p(\boldsymbol{x})$çš„å½¢å¼ã€‚</p>
<p>ä»¤$f(\boldsymbol{x}) = \boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x})$ï¼Œæ ¹æ®Steinæ’ç­‰å¼çš„ç¬¬$i$ä¸ªåˆ†é‡ï¼š
$$
\mathbb{E}_{\boldsymbol{x} \sim p(\boldsymbol{x})}\left[s_{\boldsymbol{\theta},i}(\boldsymbol{x}) \frac{\partial \log p(\boldsymbol{x})}{\partial x_i}\right] = -\mathbb{E}_{\boldsymbol{x} \sim p(\boldsymbol{x})}\left[\frac{\partial s_{\boldsymbol{\theta},i}(\boldsymbol{x})}{\partial x_i}\right]
$$</p>
<p>å¯¹æ‰€æœ‰åˆ†é‡æ±‚å’Œï¼š
$$
\mathbb{E}_{\boldsymbol{x} \sim p(\boldsymbol{x})}\left[\boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}) \cdot \nabla_{\boldsymbol{x}} \log p(\boldsymbol{x})\right] = -\mathbb{E}_{\boldsymbol{x} \sim p(\boldsymbol{x})}\left[\text{tr}(\nabla_{\boldsymbol{x}} \boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}))\right]
$$</p>
<p>å…¶ä¸­$\text{tr}(\nabla_{\boldsymbol{x}} \boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}))$æ˜¯JacobiançŸ©é˜µçš„è¿¹ï¼ˆtraceï¼‰ï¼Œå³ï¼š
$$
\text{tr}(\nabla_{\boldsymbol{x}} \boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x})) = \sum_{i=1}^{d} \frac{\partial s_{\boldsymbol{\theta},i}(\boldsymbol{x})}{\partial x_i} = \nabla_{\boldsymbol{x}} \cdot \boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x})
$$</p>
<p>è¿™ä¹Ÿç§°ä¸º<strong>æ•£åº¦</strong>ï¼ˆdivergenceï¼‰ã€‚</p>
<h4 id="23-score-matching">2.3 æ˜¾å¼Score Matchingç›®æ ‡</h4>
<p>å› æ­¤ï¼ŒScore Matchingçš„æ˜¾å¼ç›®æ ‡å‡½æ•°ä¸ºï¼ˆå¿½ç•¥å¸¸æ•°é¡¹ï¼‰ï¼š
$$
\mathcal{L}_{\text{ESM}}(\boldsymbol{\theta}) = \mathbb{E}_{\boldsymbol{x} \sim p(\boldsymbol{x})}\left[\frac{1}{2}\left\|\boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x})\right\|^2 + \text{tr}(\nabla_{\boldsymbol{x}} \boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}))\right]
$$</p>
<p>å®Œæ•´å½¢å¼ä¸ºï¼š
$$
\mathcal{L}_{\text{ESM}}(\boldsymbol{\theta}) = \mathbb{E}_{\boldsymbol{x} \sim p(\boldsymbol{x})}\left[\frac{1}{2}\left\|\boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x})\right\|^2 + \sum_{i=1}^{d} \frac{\partial s_{\boldsymbol{\theta},i}(\boldsymbol{x})}{\partial x_i}\right]
$$</p>
<p><strong>ä¼˜ç‚¹</strong>ï¼šè¿™ä¸ªç›®æ ‡ä¸éœ€è¦çŸ¥é“$\nabla_{\boldsymbol{x}} \log p(\boldsymbol{x})$çš„å€¼ï¼Œåªéœ€è¦ä»$p(\boldsymbol{x})$ä¸­é‡‡æ ·ã€‚</p>
<p><strong>ç¼ºç‚¹</strong>ï¼šéœ€è¦è®¡ç®—ç¥ç»ç½‘ç»œè¾“å‡ºçš„JacobiançŸ©é˜µçš„è¿¹ï¼Œè¿™å¯¹äºé«˜ç»´æ•°æ®ï¼ˆå¦‚å›¾åƒï¼‰è®¡ç®—æˆæœ¬å¾ˆé«˜ã€‚å¯¹äº$d$ç»´æ•°æ®ï¼Œéœ€è¦è¿›è¡Œ$d$æ¬¡åå‘ä¼ æ’­æ¥è®¡ç®—æ‰€æœ‰çš„äºŒé˜¶å¯¼æ•°$\frac{\partial s_{\boldsymbol{\theta},i}}{\partial x_i}$ã€‚</p>
<h3 id="3-denoising-score-matching">3. Denoising Score Matching</h3>
<h4 id="31">3.1 åŠ¨æœºä¸åŸºæœ¬æ€æƒ³</h4>
<p>ä¸ºäº†é¿å…è®¡ç®—HessiançŸ©é˜µï¼ŒVincent (2011)æå‡ºäº†<strong>Denoising Score Matching</strong>ï¼ˆå»å™ªå¾—åˆ†åŒ¹é…ï¼‰ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š</p>
<ol>
<li>å¯¹æ•°æ®åŠ å™ªå£°ï¼š$\tilde{\boldsymbol{x}} = \boldsymbol{x} + \boldsymbol{\epsilon}$ï¼Œå…¶ä¸­$\boldsymbol{\epsilon} \sim \mathcal{N}(0, \sigma^2 \mathbf{I})$</li>
<li>å­¦ä¹ å»å™ªååˆ†å¸ƒçš„Scoreå‡½æ•°</li>
<li>è¯æ˜è¿™ç­‰ä»·äºåŸå§‹çš„Score Matching</li>
</ol>
<h4 id="32">3.2 åŠ å™ªåˆ†å¸ƒ</h4>
<p>è®¾åŸå§‹æ•°æ®åˆ†å¸ƒä¸º$p_0(\boldsymbol{x})$ï¼ŒåŠ å™ªæ ¸ä¸ºï¼š
$$
q_{\sigma}(\tilde{\boldsymbol{x}}|\boldsymbol{x}) = \mathcal{N}(\tilde{\boldsymbol{x}}|\boldsymbol{x}, \sigma^2 \mathbf{I})
$$</p>
<p>åˆ™åŠ å™ªåçš„è¾¹ç¼˜åˆ†å¸ƒä¸ºï¼š
$$
q_{\sigma}(\tilde{\boldsymbol{x}}) = \int p_0(\boldsymbol{x}) q_{\sigma}(\tilde{\boldsymbol{x}}|\boldsymbol{x}) d\boldsymbol{x}
$$</p>
<p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å­¦ä¹ $\nabla_{\tilde{\boldsymbol{x}}} \log q_{\sigma}(\tilde{\boldsymbol{x}})$ã€‚</p>
<h4 id="33-score">3.3 æ¡ä»¶Scoreçš„è®¡ç®—</h4>
<p>å¯¹äºé«˜æ–¯åŠ å™ªï¼Œæ¡ä»¶Scoreæœ‰è§£æå½¢å¼ï¼š
$$
\nabla_{\tilde{\boldsymbol{x}}} \log q_{\sigma}(\tilde{\boldsymbol{x}}|\boldsymbol{x}) = \nabla_{\tilde{\boldsymbol{x}}} \log \mathcal{N}(\tilde{\boldsymbol{x}}|\boldsymbol{x}, \sigma^2 \mathbf{I})
$$</p>
<p>å±•å¼€ï¼š
$$
\begin{aligned}
\log q_{\sigma}(\tilde{\boldsymbol{x}}|\boldsymbol{x}) &= -\frac{d}{2}\log(2\pi\sigma^2) - \frac{1}{2\sigma^2}\|\tilde{\boldsymbol{x}} - \boldsymbol{x}\|^2 \\
&= -\frac{d}{2}\log(2\pi\sigma^2) - \frac{1}{2\sigma^2}(\tilde{\boldsymbol{x}} - \boldsymbol{x})^T(\tilde{\boldsymbol{x}} - \boldsymbol{x})
\end{aligned}
$$</p>
<p>å¯¹$\tilde{\boldsymbol{x}}$æ±‚æ¢¯åº¦ï¼š
$$
\nabla_{\tilde{\boldsymbol{x}}} \log q_{\sigma}(\tilde{\boldsymbol{x}}|\boldsymbol{x}) = -\frac{1}{\sigma^2}(\tilde{\boldsymbol{x}} - \boldsymbol{x}) = -\frac{\boldsymbol{\epsilon}}{\sigma^2}
$$</p>
<p>å…¶ä¸­$\boldsymbol{\epsilon} = \tilde{\boldsymbol{x}} - \boldsymbol{x}$æ˜¯å™ªå£°ã€‚</p>
<h4 id="34-denoising-score-matching">3.4 Denoising Score Matchingç­‰ä»·æ€§è¯æ˜</h4>
<p><strong>å®šç†</strong>ï¼šä»¥ä¸‹ä¸¤ä¸ªç›®æ ‡ç­‰ä»·ï¼ˆç›¸å·®ä¸€ä¸ªä¸$\boldsymbol{\theta}$æ— å…³çš„å¸¸æ•°ï¼‰ï¼š</p>
<ol>
<li>
<p>Score Matching: $\mathcal{L}<em _tilde_boldsymbol_x="\tilde{\boldsymbol{x">{\text{SM}}(\boldsymbol{\theta}) = \mathbb{E}</em>}} \sim q_{\sigma}}\left[|\boldsymbol{s<em _tilde_boldsymbol_x="\tilde{\boldsymbol{x">{\boldsymbol{\theta}}(\tilde{\boldsymbol{x}}) - \nabla</em>)|^2\right]$}}} \log q_{\sigma}(\tilde{\boldsymbol{x}</p>
</li>
<li>
<p>Denoising Score Matching: $\mathcal{L}<em _boldsymbol_x="\boldsymbol{x">{\text{DSM}}(\boldsymbol{\theta}) = \mathbb{E}</em>} \sim p_0, \tilde{\boldsymbol{x}} \sim q_{\sigma}(\cdot|\boldsymbol{x})}\left[|\boldsymbol{s<em _tilde_boldsymbol_x="\tilde{\boldsymbol{x">{\boldsymbol{\theta}}(\tilde{\boldsymbol{x}}) - \nabla</em>)|^2\right]$}}} \log q_{\sigma}(\tilde{\boldsymbol{x}}|\boldsymbol{x</p>
</li>
</ol>
<p><strong>è¯æ˜</strong>ï¼š</p>
<p>é¦–å…ˆï¼Œè¾¹ç¼˜Scoreå¯ä»¥å†™æˆæ¡ä»¶Scoreçš„æœŸæœ›ï¼š
$$
\nabla_{\tilde{\boldsymbol{x}}} \log q_{\sigma}(\tilde{\boldsymbol{x}}) = \mathbb{E}_{\boldsymbol{x} \sim p(\boldsymbol{x}|\tilde{\boldsymbol{x}})}\left[\nabla_{\tilde{\boldsymbol{x}}} \log q_{\sigma}(\tilde{\boldsymbol{x}}|\boldsymbol{x})\right]
$$</p>
<p>è¿™ä¸ªæ’ç­‰å¼çš„è¯æ˜å¦‚ä¸‹ï¼š
$$
\begin{aligned}
\nabla_{\tilde{\boldsymbol{x}}} \log q_{\sigma}(\tilde{\boldsymbol{x}}) &= \frac{\nabla_{\tilde{\boldsymbol{x}}} q_{\sigma}(\tilde{\boldsymbol{x}})}{q_{\sigma}(\tilde{\boldsymbol{x}})} \\
&= \frac{\nabla_{\tilde{\boldsymbol{x}}} \int p_0(\boldsymbol{x}) q_{\sigma}(\tilde{\boldsymbol{x}}|\boldsymbol{x}) d\boldsymbol{x}}{q_{\sigma}(\tilde{\boldsymbol{x}})} \\
&= \frac{\int p_0(\boldsymbol{x}) \nabla_{\tilde{\boldsymbol{x}}} q_{\sigma}(\tilde{\boldsymbol{x}}|\boldsymbol{x}) d\boldsymbol{x}}{q_{\sigma}(\tilde{\boldsymbol{x}})} \\
&= \frac{\int p_0(\boldsymbol{x}) q_{\sigma}(\tilde{\boldsymbol{x}}|\boldsymbol{x}) \nabla_{\tilde{\boldsymbol{x}}} \log q_{\sigma}(\tilde{\boldsymbol{x}}|\boldsymbol{x}) d\boldsymbol{x}}{q_{\sigma}(\tilde{\boldsymbol{x}})} \\
&= \int \frac{p_0(\boldsymbol{x}) q_{\sigma}(\tilde{\boldsymbol{x}}|\boldsymbol{x})}{q_{\sigma}(\tilde{\boldsymbol{x}})} \nabla_{\tilde{\boldsymbol{x}}} \log q_{\sigma}(\tilde{\boldsymbol{x}}|\boldsymbol{x}) d\boldsymbol{x} \\
&= \int p(\boldsymbol{x}|\tilde{\boldsymbol{x}}) \nabla_{\tilde{\boldsymbol{x}}} \log q_{\sigma}(\tilde{\boldsymbol{x}}|\boldsymbol{x}) d\boldsymbol{x} \\
&= \mathbb{E}_{\boldsymbol{x} \sim p(\boldsymbol{x}|\tilde{\boldsymbol{x}})}\left[\nabla_{\tilde{\boldsymbol{x}}} \log q_{\sigma}(\tilde{\boldsymbol{x}}|\boldsymbol{x})\right]
\end{aligned}
$$</p>
<p>ç°åœ¨å±•å¼€DSMç›®æ ‡ï¼š
$$
\begin{aligned}
\mathcal{L}_{\text{DSM}}(\boldsymbol{\theta}) &= \mathbb{E}_{\boldsymbol{x}, \tilde{\boldsymbol{x}}}\left[\|\boldsymbol{s}_{\boldsymbol{\theta}}(\tilde{\boldsymbol{x}}) - \nabla_{\tilde{\boldsymbol{x}}} \log q_{\sigma}(\tilde{\boldsymbol{x}}|\boldsymbol{x})\|^2\right] \\
&= \mathbb{E}_{\tilde{\boldsymbol{x}} \sim q_{\sigma}} \mathbb{E}_{\boldsymbol{x} \sim p(\boldsymbol{x}|\tilde{\boldsymbol{x}})}\left[\|\boldsymbol{s}_{\boldsymbol{\theta}}(\tilde{\boldsymbol{x}}) - \nabla_{\tilde{\boldsymbol{x}}} \log q_{\sigma}(\tilde{\boldsymbol{x}}|\boldsymbol{x})\|^2\right]
\end{aligned}
$$</p>
<p>å±•å¼€å¹³æ–¹é¡¹ï¼š
$$
\begin{aligned}
&\mathbb{E}_{\boldsymbol{x} \sim p(\boldsymbol{x}|\tilde{\boldsymbol{x}})}\left[\|\boldsymbol{s}_{\boldsymbol{\theta}}(\tilde{\boldsymbol{x}}) - \nabla_{\tilde{\boldsymbol{x}}} \log q_{\sigma}(\tilde{\boldsymbol{x}}|\boldsymbol{x})\|^2\right] \\
=& \|\boldsymbol{s}_{\boldsymbol{\theta}}(\tilde{\boldsymbol{x}})\|^2 - 2\boldsymbol{s}_{\boldsymbol{\theta}}(\tilde{\boldsymbol{x}}) \cdot \mathbb{E}_{\boldsymbol{x} \sim p(\boldsymbol{x}|\tilde{\boldsymbol{x}})}\left[\nabla_{\tilde{\boldsymbol{x}}} \log q_{\sigma}(\tilde{\boldsymbol{x}}|\boldsymbol{x})\right] \\
&\quad + \mathbb{E}_{\boldsymbol{x} \sim p(\boldsymbol{x}|\tilde{\boldsymbol{x}})}\left[\|\nabla_{\tilde{\boldsymbol{x}}} \log q_{\sigma}(\tilde{\boldsymbol{x}}|\boldsymbol{x})\|^2\right]
\end{aligned}
$$</p>
<p>åˆ©ç”¨å‰é¢çš„æ’ç­‰å¼ï¼š
$$
\begin{aligned}
=& \|\boldsymbol{s}_{\boldsymbol{\theta}}(\tilde{\boldsymbol{x}})\|^2 - 2\boldsymbol{s}_{\boldsymbol{\theta}}(\tilde{\boldsymbol{x}}) \cdot \nabla_{\tilde{\boldsymbol{x}}} \log q_{\sigma}(\tilde{\boldsymbol{x}}) \\
&\quad + \mathbb{E}_{\boldsymbol{x} \sim p(\boldsymbol{x}|\tilde{\boldsymbol{x}})}\left[\|\nabla_{\tilde{\boldsymbol{x}}} \log q_{\sigma}(\tilde{\boldsymbol{x}}|\boldsymbol{x})\|^2\right]
\end{aligned}
$$</p>
<p>å› æ­¤ï¼š
$$
\begin{aligned}
\mathcal{L}_{\text{DSM}}(\boldsymbol{\theta}) &= \mathbb{E}_{\tilde{\boldsymbol{x}} \sim q_{\sigma}}\left[\|\boldsymbol{s}_{\boldsymbol{\theta}}(\tilde{\boldsymbol{x}})\|^2 - 2\boldsymbol{s}_{\boldsymbol{\theta}}(\tilde{\boldsymbol{x}}) \cdot \nabla_{\tilde{\boldsymbol{x}}} \log q_{\sigma}(\tilde{\boldsymbol{x}})\right] + C \\
&= \mathbb{E}_{\tilde{\boldsymbol{x}} \sim q_{\sigma}}\left[\|\boldsymbol{s}_{\boldsymbol{\theta}}(\tilde{\boldsymbol{x}}) - \nabla_{\tilde{\boldsymbol{x}}} \log q_{\sigma}(\tilde{\boldsymbol{x}})\|^2\right] + C'
\end{aligned}
$$</p>
<p>å…¶ä¸­$C, C'$æ˜¯ä¸$\boldsymbol{\theta}$æ— å…³çš„å¸¸æ•°ã€‚è¿™è¯æ˜äº†DSMä¸SMçš„ç­‰ä»·æ€§ã€‚</p>
<h4 id="35">3.5 å®ç”¨å½¢å¼</h4>
<p>åœ¨æ‰©æ•£æ¨¡å‹ä¸­ï¼Œå¸¸ç”¨çš„Denoising Score Matchingç›®æ ‡ä¸ºï¼š
$$
\mathcal{L}_{\text{DSM}}(\boldsymbol{\theta}) = \mathbb{E}_{t, \boldsymbol{x}_0, \boldsymbol{\epsilon}}\left[\left\|\boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t) - \nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\right\|^2\right]
$$</p>
<p>å…¶ä¸­ï¼š
- $t \sim \text{Uniform}(0, T)$
- $\boldsymbol{x}_0 \sim p_0(\boldsymbol{x}_0)$
- $\boldsymbol{\epsilon} \sim \mathcal{N}(0, \mathbf{I})$
- $\boldsymbol{x}_t = \alpha_t \boldsymbol{x}_0 + \sigma_t \boldsymbol{\epsilon}$</p>
<p>å¯¹äºè¿™ç§å½¢å¼ï¼Œæ¡ä»¶Scoreä¸ºï¼š
$$
\nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0) = -\frac{\boldsymbol{x}_t - \alpha_t \boldsymbol{x}_0}{\sigma_t^2} = -\frac{\boldsymbol{\epsilon}}{\sigma_t}
$$</p>
<h3 id="4-sliced-score-matching">4. Sliced Score Matching</h3>
<h4 id="41">4.1 åŠ¨æœº</h4>
<p>Sliced Score Matchingç”±Song et al. (2019)æå‡ºï¼Œç”¨äºè¿›ä¸€æ­¥é™ä½è®¡ç®—å¤æ‚åº¦ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šä¸ç›´æ¥åŒ¹é…æ•´ä¸ªScoreå‘é‡ï¼Œè€Œæ˜¯åŒ¹é…å…¶åœ¨éšæœºæ–¹å‘ä¸Šçš„æŠ•å½±ã€‚</p>
<h4 id="42-score">4.2 æŠ•å½±Score</h4>
<p>å¯¹äºéšæœºå•ä½å‘é‡$\boldsymbol{v} \sim p_{\boldsymbol{v}}$ï¼ˆä¾‹å¦‚ï¼Œä»å•ä½çƒé¢å‡åŒ€é‡‡æ ·ï¼‰ï¼Œå®šä¹‰<strong>æŠ•å½±Score</strong>ï¼š
$$
\boldsymbol{v}^T \nabla_{\boldsymbol{x}} \log p(\boldsymbol{x})
$$</p>
<p>Sliced Score Matchingçš„ç›®æ ‡æ˜¯ï¼š
$$
\mathcal{L}_{\text{SSM}}(\boldsymbol{\theta}) = \frac{1}{2}\mathbb{E}_{\boldsymbol{x} \sim p, \boldsymbol{v} \sim p_{\boldsymbol{v}}}\left[\left(\boldsymbol{v}^T \boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}) - \boldsymbol{v}^T \nabla_{\boldsymbol{x}} \log p(\boldsymbol{x})\right)^2\right]
$$</p>
<h4 id="43">4.3 ç­‰ä»·å½¢å¼æ¨å¯¼</h4>
<p>åˆ©ç”¨Steinæ’ç­‰å¼çš„å˜ä½“ï¼š
$$
\mathbb{E}_{\boldsymbol{x} \sim p}\left[\boldsymbol{v}^T \boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}) \cdot \boldsymbol{v}^T \nabla_{\boldsymbol{x}} \log p(\boldsymbol{x})\right] = -\mathbb{E}_{\boldsymbol{x} \sim p}\left[\boldsymbol{v}^T \nabla_{\boldsymbol{x}} (\boldsymbol{v}^T \boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}))\right]
$$</p>
<p>æ³¨æ„åˆ°ï¼š
$$
\boldsymbol{v}^T \nabla_{\boldsymbol{x}} (\boldsymbol{v}^T \boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x})) = \boldsymbol{v}^T \left(\nabla_{\boldsymbol{x}} \boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x})^T\right) \boldsymbol{v} = \boldsymbol{v}^T \mathbf{J}_{\boldsymbol{s}_{\boldsymbol{\theta}}} \boldsymbol{v}
$$</p>
<p>è¿™æ˜¯JacobiançŸ©é˜µ$\mathbf{J}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{s}</em>$çš„äºŒæ¬¡å‹ã€‚}}</p>
<p>å› æ­¤ï¼ŒSliced Score Matchingçš„æ˜¾å¼å½¢å¼ä¸ºï¼š
$$
\mathcal{L}_{\text{SSM}}(\boldsymbol{\theta}) = \mathbb{E}_{\boldsymbol{x}, \boldsymbol{v}}\left[\frac{1}{2}\|\boldsymbol{v}^T \boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x})\|^2 + \boldsymbol{v}^T \mathbf{J}_{\boldsymbol{s}_{\boldsymbol{\theta}}}(\boldsymbol{x}) \boldsymbol{v}\right]
$$</p>
<p><strong>ä¼˜ç‚¹</strong>ï¼šè®¡ç®—$\boldsymbol{v}^T \mathbf{J}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{s}</em>$åªéœ€è¦ä¸€æ¬¡åå‘ä¼ æ’­ï¼ˆä½¿ç”¨è‡ªåŠ¨å¾®åˆ†çš„Jacobian-vector productæŠ€å·§ï¼‰ï¼Œè€Œä¸æ˜¯$d$æ¬¡ã€‚}}} \boldsymbol{v</p>
<h3 id="5-score-matching">5. æ¡ä»¶Score Matchingçš„å®Œæ•´ç†è®º</h3>
<h4 id="51">5.1 æ—¶é—´ä¾èµ–çš„æ‰©æ•£è¿‡ç¨‹</h4>
<p>åœ¨æ‰©æ•£æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬è€ƒè™‘æ—¶é—´å‚æ•°åŒ–çš„åˆ†å¸ƒæ—${p_t(\boldsymbol{x}<em _0_T_="[0,T]" _in="\in" t="t">t)}</em>$ï¼Œå…¶ä¸­ï¼š
$$
p_t(\boldsymbol{x}_t) = \int p_t(\boldsymbol{x}_t|\boldsymbol{x}_0) p_0(\boldsymbol{x}_0) d\boldsymbol{x}_0
$$</p>
<p>è¿™é‡Œï¼š
- $p_0(\boldsymbol{x}_0)$æ˜¯æ•°æ®åˆ†å¸ƒ
- $p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)$æ˜¯æ‰©æ•£æ ¸ï¼ˆtransition kernelï¼‰</p>
<h4 id="52">5.2 æ‰©æ•£æ ¸çš„å‚æ•°åŒ–</h4>
<p>å¸¸è§çš„æ‰©æ•£æ ¸ä¸ºé«˜æ–¯æ ¸ï¼š
$$
p_t(\boldsymbol{x}_t|\boldsymbol{x}_0) = \mathcal{N}(\boldsymbol{x}_t | \alpha_t \boldsymbol{x}_0, \sigma_t^2 \mathbf{I})
$$</p>
<p>å…¶ä¸­$\alpha_t, \sigma_t$æ˜¯æ—¶é—´çš„ç¡®å®šæ€§å‡½æ•°ï¼Œæ»¡è¶³ï¼š
- $\alpha_0 = 1, \sigma_0 = 0$ï¼ˆåˆå§‹æ—¶åˆ»æ— å™ªå£°ï¼‰
- $\alpha_T \approx 0, \sigma_T \gg 1$ï¼ˆæœ€ç»ˆæ—¶åˆ»æ¥è¿‘çº¯å™ªå£°ï¼‰</p>
<h4 id="53-scorescore">5.3 è¾¹ç¼˜Scoreä¸æ¡ä»¶Scoreçš„å…³ç³»</h4>
<p><strong>å…³é”®æ’ç­‰å¼</strong>ï¼š
$$
\nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t) = \mathbb{E}_{\boldsymbol{x}_0 \sim p_t(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\right]
$$</p>
<p>è¿™ä¸ªæ’ç­‰å¼çš„è¯¦ç»†è¯æ˜ï¼š
$$
\begin{aligned}
p_t(\boldsymbol{x}_t) &= \int p_t(\boldsymbol{x}_t|\boldsymbol{x}_0) p_0(\boldsymbol{x}_0) d\boldsymbol{x}_0
\end{aligned}
$$</p>
<p>ä¸¤è¾¹å¯¹$\boldsymbol{x}_t$æ±‚æ¢¯åº¦ï¼š
$$
\nabla_{\boldsymbol{x}_t} p_t(\boldsymbol{x}_t) = \int \nabla_{\boldsymbol{x}_t} p_t(\boldsymbol{x}_t|\boldsymbol{x}_0) p_0(\boldsymbol{x}_0) d\boldsymbol{x}_0
$$</p>
<p>é™¤ä»¥$p_t(\boldsymbol{x}_t)$ï¼š
$$
\begin{aligned}
\nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t) &= \frac{\nabla_{\boldsymbol{x}_t} p_t(\boldsymbol{x}_t)}{p_t(\boldsymbol{x}_t)} \\
&= \frac{\int \nabla_{\boldsymbol{x}_t} p_t(\boldsymbol{x}_t|\boldsymbol{x}_0) p_0(\boldsymbol{x}_0) d\boldsymbol{x}_0}{p_t(\boldsymbol{x}_t)} \\
&= \int \frac{p_0(\boldsymbol{x}_0) p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)}{p_t(\boldsymbol{x}_t)} \frac{\nabla_{\boldsymbol{x}_t} p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)}{p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)} d\boldsymbol{x}_0 \\
&= \int p_t(\boldsymbol{x}_0|\boldsymbol{x}_t) \nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0) d\boldsymbol{x}_0
\end{aligned}
$$</p>
<h4 id="54">5.4 æ–¹å·®åˆ†è§£</h4>
<p>å¯¹äºæ¡ä»¶Scoreçš„æ–¹å·®ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹åˆ†è§£ï¼š
$$
\begin{aligned}
&\mathbb{E}_{\boldsymbol{x}_0 \sim p_t(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\left\|\nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\right\|^2\right] \\
=& \left\|\mathbb{E}_{\boldsymbol{x}_0 \sim p_t(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\right]\right\|^2 \\
&\quad + \mathbb{E}_{\boldsymbol{x}_0 \sim p_t(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\left\|\nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0) - \mathbb{E}\left[\nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\right]\right\|^2\right]
\end{aligned}
$$</p>
<p>è¿™æ˜¯æœŸæœ›çš„å¹³æ–¹åŠ ä¸Šæ–¹å·®ï¼Œå³ï¼š
$$
\mathbb{E}[\|X\|^2] = \|\mathbb{E}[X]\|^2 + \mathbb{E}[\|X - \mathbb{E}[X]\|^2]
$$</p>
<p>åˆ©ç”¨å‰é¢çš„æ’ç­‰å¼ï¼Œç¬¬ä¸€é¡¹ç­‰äº$|\nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t)|^2$ã€‚</p>
<h3 id="6-score-matchingconditional-score-matching">6. Score Matchingä¸Conditional Score Matchingçš„ç­‰ä»·æ€§</h3>
<h4 id="61">6.1 å®šç†é™ˆè¿°</h4>
<p><strong>å®šç†ï¼ˆScore Matching = Conditional Score Matchingï¼‰</strong>ï¼š</p>
<p>å¯¹äºä»»æ„æ¨¡å‹$\boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)$ï¼Œä»¥ä¸‹ä¸¤ä¸ªç›®æ ‡å‡½æ•°ç›¸å·®ä¸€ä¸ªä¸$\boldsymbol{\theta}$æ— å…³çš„å¸¸æ•°ï¼š</p>
<p>$$
\mathcal{L}_{\text{SM}}(\boldsymbol{\theta}) = \mathbb{E}_{\boldsymbol{x}_t \sim p_t}\left[\left\|\nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t) - \boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)\right\|^2\right]
$$</p>
<p>$$
\mathcal{L}_{\text{CSM}}(\boldsymbol{\theta}) = \mathbb{E}_{\boldsymbol{x}_0 \sim p_0, \boldsymbol{x}_t \sim p_t(\cdot|\boldsymbol{x}_0)}\left[\left\|\nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0) - \boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)\right\|^2\right]
$$</p>
<p>å³ï¼š$\mathcal{L}<em _text_SM="\text{SM">{\text{CSM}}(\boldsymbol{\theta}) = \mathcal{L}</em>$æ— å…³ã€‚}}(\boldsymbol{\theta}) + C$ï¼Œå…¶ä¸­$C$ä¸$\boldsymbol{\theta</p>
<h4 id="62">6.2 è¯¦ç»†è¯æ˜</h4>
<p><strong>ç¬¬ä¸€æ­¥</strong>ï¼šå±•å¼€Score Matchingç›®æ ‡</p>
<p>$$
\begin{aligned}
\mathcal{L}_{\text{SM}}(\boldsymbol{\theta}) &= \mathbb{E}_{\boldsymbol{x}_t \sim p_t}\left[\left\|\nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t) - \boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)\right\|^2\right] \\
&= \mathbb{E}_{\boldsymbol{x}_t}\left[\|\nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t)\|^2 + \|\boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)\|^2 - 2\boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t) \cdot \nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t)\right]
\end{aligned}
$$</p>
<p><strong>ç¬¬äºŒæ­¥</strong>ï¼šå±•å¼€Conditional Score Matchingç›®æ ‡</p>
<p>$$
\begin{aligned}
\mathcal{L}_{\text{CSM}}(\boldsymbol{\theta}) &= \mathbb{E}_{\boldsymbol{x}_0, \boldsymbol{x}_t}\left[\left\|\nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0) - \boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)\right\|^2\right] \\
&= \mathbb{E}_{\boldsymbol{x}_0, \boldsymbol{x}_t}\left[\|\nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\|^2 + \|\boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)\|^2\right. \\
&\qquad\qquad\left. - 2\boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t) \cdot \nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\right]
\end{aligned}
$$</p>
<p><strong>ç¬¬ä¸‰æ­¥</strong>ï¼šå°†è”åˆæœŸæœ›æ”¹å†™ä¸ºæ¡ä»¶æœŸæœ›</p>
<p>åˆ©ç”¨è´å¶æ–¯å…¬å¼$p_0(\boldsymbol{x}_0) p_t(\boldsymbol{x}_t|\boldsymbol{x}_0) = p_t(\boldsymbol{x}_t) p_t(\boldsymbol{x}_0|\boldsymbol{x}_t)$ï¼š</p>
<p>$$
\begin{aligned}
\mathcal{L}_{\text{CSM}}(\boldsymbol{\theta}) &= \mathbb{E}_{\boldsymbol{x}_t \sim p_t} \mathbb{E}_{\boldsymbol{x}_0 \sim p_t(\cdot|\boldsymbol{x}_t)}\left[\|\nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\|^2 + \|\boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)\|^2\right. \\
&\qquad\qquad\left. - 2\boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t) \cdot \nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\right]
\end{aligned}
$$</p>
<p><strong>ç¬¬å››æ­¥</strong>ï¼šåˆ†ç¦»ä¸$\boldsymbol{x}_0$æ— å…³çš„é¡¹</p>
<p>$$
\begin{aligned}
\mathcal{L}_{\text{CSM}}(\boldsymbol{\theta}) &= \mathbb{E}_{\boldsymbol{x}_t}\left[\mathbb{E}_{\boldsymbol{x}_0 \sim p_t(\cdot|\boldsymbol{x}_t)}\left[\|\nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\|^2\right]\right] \\
&\quad + \mathbb{E}_{\boldsymbol{x}_t}\left[\|\boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)\|^2\right] \\
&\quad - 2\mathbb{E}_{\boldsymbol{x}_t}\left[\boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t) \cdot \mathbb{E}_{\boldsymbol{x}_0 \sim p_t(\cdot|\boldsymbol{x}_t)}\left[\nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\right]\right]
\end{aligned}
$$</p>
<p><strong>ç¬¬äº”æ­¥</strong>ï¼šåº”ç”¨å…³é”®æ’ç­‰å¼</p>
<p>æ ¹æ®å‰é¢è¯æ˜çš„æ’ç­‰å¼ï¼š
$$
\mathbb{E}_{\boldsymbol{x}_0 \sim p_t(\boldsymbol{x}_0|\boldsymbol{x}_t)}\left[\nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\right] = \nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t)
$$</p>
<p>å› æ­¤ï¼š
$$
\begin{aligned}
\mathcal{L}_{\text{CSM}}(\boldsymbol{\theta}) &= \mathbb{E}_{\boldsymbol{x}_t}\left[\mathbb{E}_{\boldsymbol{x}_0 \sim p_t(\cdot|\boldsymbol{x}_t)}\left[\|\nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\|^2\right]\right] \\
&\quad + \mathbb{E}_{\boldsymbol{x}_t}\left[\|\boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)\|^2\right] \\
&\quad - 2\mathbb{E}_{\boldsymbol{x}_t}\left[\boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t) \cdot \nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t)\right]
\end{aligned}
$$</p>
<p><strong>ç¬¬å…­æ­¥</strong>ï¼šè®¡ç®—å·®å€¼</p>
<p>ç°åœ¨æ¯”è¾ƒ$\mathcal{L}<em _text_SM="\text{SM">{\text{CSM}}(\boldsymbol{\theta})$å’Œ$\mathcal{L}</em>)$ï¼š}}(\boldsymbol{\theta</p>
<p>åŒ…å«$\boldsymbol{\theta}$çš„é¡¹ï¼ˆçº¢è‰²å’Œç»¿è‰²é¡¹ï¼‰å®Œå…¨ç›¸åŒï¼š
- $\mathbb{E}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{x}_t}[|\boldsymbol{s}</em>}}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t, t)|^2]$
- $-2\mathbb{E}</em><em _boldsymbol_theta="\boldsymbol{\theta">t}[\boldsymbol{s}</em>}}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t, t) \cdot \nabla</em>_t)]$}_t} \log p_t(\boldsymbol{x</p>
<p>å·®å¼‚ä»…åœ¨äºæ©™è‰²é¡¹ï¼š
$$
\begin{aligned}
\mathcal{L}_{\text{CSM}}(\boldsymbol{\theta}) - \mathcal{L}_{\text{SM}}(\boldsymbol{\theta}) &= \mathbb{E}_{\boldsymbol{x}_t}\left[\mathbb{E}_{\boldsymbol{x}_0 \sim p_t(\cdot|\boldsymbol{x}_t)}\left[\|\nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\|^2\right]\right] \\
&\quad - \mathbb{E}_{\boldsymbol{x}_t}\left[\|\nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t)\|^2\right]
\end{aligned}
$$</p>
<p>è¿™ä¸ªå·®å€¼ä¸$\boldsymbol{\theta}$å®Œå…¨æ— å…³ï¼</p>
<p><strong>ç»“è®º</strong>ï¼šç”±äº$\mathcal{L}<em _text_SM="\text{SM">{\text{CSM}}(\boldsymbol{\theta}) = \mathcal{L}</em>$æ— å…³ï¼‰ï¼Œæœ€å°åŒ–è¿™ä¸¤ä¸ªç›®æ ‡æ˜¯å®Œå…¨ç­‰ä»·çš„ã€‚}}(\boldsymbol{\theta}) + C$ï¼ˆ$C$ä¸$\boldsymbol{\theta</p>
<h4 id="63">6.3 å·®å€¼çš„ç‰©ç†æ„ä¹‰</h4>
<p>å·®å€¼$C$å®é™…ä¸Šè¡¡é‡äº†æ¡ä»¶Scoreçš„æ–¹å·®ï¼š
$$
C = \mathbb{E}_{\boldsymbol{x}_t}\left[\text{Var}_{\boldsymbol{x}_0 \sim p_t(\cdot|\boldsymbol{x}_t)}\left[\nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)\right]\right]
$$</p>
<p>è¿™ä¸ªé‡æè¿°äº†ï¼šç»™å®š$\boldsymbol{x}_t$ï¼Œä¸åŒçš„$\boldsymbol{x}_0$å¯¹åº”çš„æ¡ä»¶Scoreæœ‰å¤šå¤§çš„å˜åŒ–ã€‚</p>
<ul>
<li>å½“å™ªå£°è¾ƒå°ï¼ˆ$t$æ¥è¿‘0ï¼‰æ—¶ï¼Œ$C \approx 0$ï¼Œå› ä¸º$\boldsymbol{x}_t$å‡ ä¹ç¡®å®šäº†$\boldsymbol{x}_0$</li>
<li>å½“å™ªå£°è¾ƒå¤§ï¼ˆ$t$æ¥è¿‘$T$ï¼‰æ—¶ï¼Œ$C$è¾ƒå¤§ï¼Œå› ä¸º$\boldsymbol{x}_t$åŒ…å«çš„$\boldsymbol{x}_0$ä¿¡æ¯è¾ƒå°‘</li>
</ul>
<h3 id="7">7. å®é™…è®­ç»ƒç®—æ³•</h3>
<h4 id="71-ddpm">7.1 DDPMè®­ç»ƒç®—æ³•</h4>
<p>åœ¨DDPM (Denoising Diffusion Probabilistic Models)ä¸­ï¼Œæˆ‘ä»¬è®­ç»ƒä¸€ä¸ªå™ªå£°é¢„æµ‹ç½‘ç»œ$\boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)$ï¼š</p>
<p><strong>ç®—æ³•1ï¼šDDPMè®­ç»ƒ</strong></p>
<div class="codehilite"><pre><span></span><code>è¾“å…¥ï¼šæ•°æ®é›† {xâ‚€â½â±â¾}
å‚æ•°ï¼šå™ªå£°è°ƒåº¦ {Î±â‚œ, Ïƒâ‚œ}â‚œâ‚Œâ‚€áµ€

é‡å¤ç›´åˆ°æ”¶æ•›ï¼š
  1. ä»æ•°æ®é›†é‡‡æ · xâ‚€ ~ pâ‚€(xâ‚€)
  2. å‡åŒ€é‡‡æ ·æ—¶é—´ t ~ Uniform({1, ..., T})
  3. é‡‡æ ·å™ªå£° Îµ ~ N(0, I)
  4. è®¡ç®—åŠ å™ªæ ·æœ¬ xâ‚œ = Î±â‚œxâ‚€ + Ïƒâ‚œÎµ
  5. è®¡ç®—æŸå¤± L = â€–Îµ - ÎµÎ¸(xâ‚œ, t)â€–Â²
  6. æ¢¯åº¦ä¸‹é™æ›´æ–° Î¸
</code></pre></div>

<p>è¿™ç­‰ä»·äºConditional Score Matchingï¼Œå› ä¸ºï¼š
$$
\nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t|\boldsymbol{x}_0) = -\frac{\boldsymbol{\epsilon}}{\sigma_t}
$$</p>
<p>å› æ­¤ï¼š
$$
\boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t) = -\frac{\boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)}{\sigma_t}
$$</p>
<h4 id="72-score-based-sde">7.2 Score-Based SDEè®­ç»ƒ</h4>
<p>åœ¨Score-Based SDEæ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥è®­ç»ƒScoreç½‘ç»œ$\boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)$ï¼š</p>
<p><strong>ç®—æ³•2ï¼šScore-Based SDEè®­ç»ƒ</strong></p>
<div class="codehilite"><pre><span></span><code>è¾“å…¥ï¼šæ•°æ®é›† {xâ‚€â½â±â¾}
å‚æ•°ï¼šSDEç³»æ•° {Î²(t)}

é‡å¤ç›´åˆ°æ”¶æ•›ï¼š
  1. ä»æ•°æ®é›†é‡‡æ · xâ‚€ ~ pâ‚€(xâ‚€)
  2. å‡åŒ€é‡‡æ ·æ—¶é—´ t ~ Uniform(0, T)
  3. è®¡ç®— Î±â‚œ = exp(-Â½âˆ«â‚€áµ—Î²(s)ds)
  4. è®¡ç®— Ïƒâ‚œÂ² = 1 - Î±â‚œÂ²
  5. é‡‡æ ·å™ªå£° Îµ ~ N(0, I)
  6. è®¡ç®— xâ‚œ = Î±â‚œxâ‚€ + Ïƒâ‚œÎµ
  7. è®¡ç®—ç›®æ ‡ s* = -(xâ‚œ - Î±â‚œxâ‚€)/Ïƒâ‚œÂ² = -Îµ/Ïƒâ‚œ
  8. è®¡ç®—æŸå¤± L = Î»(t)â€–sÎ¸(xâ‚œ, t) - s*â€–Â²
  9. æ¢¯åº¦ä¸‹é™æ›´æ–° Î¸
</code></pre></div>

<p>å…¶ä¸­$\lambda(t)$æ˜¯æƒé‡å‡½æ•°ï¼Œå¸¸ç”¨é€‰æ‹©åŒ…æ‹¬ï¼š
- $\lambda(t) = 1$ï¼šåŸå§‹Score Matching
- $\lambda(t) = \sigma_t^2$ï¼šä½¿å¾—ä¸åŒæ—¶é—´æ­¥çš„æŸå¤±å…·æœ‰ç›¸ä¼¼é‡çº§
- $\lambda(t) = \sigma_t^2 / \alpha_t^2$ï¼šä¸ä¼¼ç„¶åŠ æƒä¸€è‡´</p>
<h4 id="73">7.3 ä¸å…¶ä»–ç”Ÿæˆæ¨¡å‹çš„è”ç³»</h4>
<p><strong>ä¸VAEçš„è”ç³»</strong>ï¼š</p>
<p>æ‰©æ•£æ¨¡å‹å¯ä»¥çœ‹ä½œå±‚æ¬¡VAEï¼Œå…¶ELBOä¸ºï¼š
$$
\log p(\boldsymbol{x}_0) \geq \mathbb{E}_{q(\boldsymbol{x}_{1:T}|\boldsymbol{x}_0)}\left[\log \frac{p(\boldsymbol{x}_{0:T})}{q(\boldsymbol{x}_{1:T}|\boldsymbol{x}_0)}\right]
$$</p>
<p><strong>ä¸æµæ¨¡å‹çš„è”ç³»</strong>ï¼š</p>
<p>å½“ç¦»æ•£æ—¶é—´æ­¥è¶‹äºæ— ç©·æ—¶ï¼Œæ‰©æ•£è¿‡ç¨‹å¯ä»¥ç”¨SDEæè¿°ï¼š
$$
d\boldsymbol{x} = f(\boldsymbol{x}, t)dt + g(t)d\boldsymbol{w}
$$</p>
<p>å…¶é€†å‘SDEä¸ºï¼š
$$
d\boldsymbol{x} = \left[f(\boldsymbol{x}, t) - g(t)^2 \nabla_{\boldsymbol{x}} \log p_t(\boldsymbol{x})\right]dt + g(t)d\bar{\boldsymbol{w}}
$$</p>
<p>è¿™å»ºç«‹äº†Scoreå‡½æ•°ä¸æ¦‚ç‡æµçš„è”ç³»ã€‚</p>
<h3 id="8">8. é«˜çº§ä¸»é¢˜</h3>
<h4 id="81-score-matching">8.1 å¤šå°ºåº¦Score Matching</h4>
<p>å¯¹äºå¤šæ¨¡æ€åˆ†å¸ƒï¼Œä¸åŒå™ªå£°æ°´å¹³çš„Scoreæä¾›ä¸åŒå°ºåº¦çš„ä¿¡æ¯ï¼š</p>
<ul>
<li><strong>å¤§å™ªå£°</strong>ï¼ˆ$\sigma$å¤§ï¼‰ï¼šScoreæŒ‡å‘ä¸åŒæ¨¡å¼ä¹‹é—´çš„æ–¹å‘ï¼Œå¸®åŠ©æ¢ç´¢å…¨å±€ç»“æ„</li>
<li><strong>å°å™ªå£°</strong>ï¼ˆ$\sigma$å°ï¼‰ï¼šScoreæŒ‡å‘æ¯ä¸ªæ¨¡å¼å†…éƒ¨çš„ç»†èŠ‚ï¼Œå¸®åŠ©ç”Ÿæˆé«˜è´¨é‡æ ·æœ¬</li>
</ul>
<p>å› æ­¤ï¼Œè®­ç»ƒæ—¶ä½¿ç”¨å¤šä¸ªå™ªå£°æ°´å¹³${\sigma_1, ..., \sigma_L}$ï¼š
$$
\mathcal{L}(\boldsymbol{\theta}) = \sum_{i=1}^{L} \lambda_i \mathbb{E}_{\boldsymbol{x}_0, \boldsymbol{\epsilon}}\left[\left\|\boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}_0 + \sigma_i \boldsymbol{\epsilon}, \sigma_i) + \frac{\boldsymbol{\epsilon}}{\sigma_i}\right\|^2\right]
$$</p>
<h4 id="82">8.2 æ¡ä»¶ç”Ÿæˆ</h4>
<p>å¯¹äºæ¡ä»¶ç”Ÿæˆä»»åŠ¡$p(\boldsymbol{x}|\boldsymbol{y})$ï¼Œéœ€è¦å­¦ä¹ æ¡ä»¶Scoreï¼š
$$
\nabla_{\boldsymbol{x}} \log p_t(\boldsymbol{x}_t|\boldsymbol{y})
$$</p>
<p>ä¸¤ç§ä¸»è¦æ–¹æ³•ï¼š</p>
<p><strong>æ–¹æ³•1ï¼šClassifier Guidance</strong></p>
<p>åˆ©ç”¨åˆ†ç±»å™¨$p(\boldsymbol{y}|\boldsymbol{x}_t)$ï¼š
$$
\nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t|\boldsymbol{y}) = \nabla_{\boldsymbol{x}_t} \log p_t(\boldsymbol{x}_t) + \nabla_{\boldsymbol{x}_t} \log p(\boldsymbol{y}|\boldsymbol{x}_t)
$$</p>
<p><strong>æ–¹æ³•2ï¼šClassifier-Free Guidance</strong></p>
<p>è”åˆè®­ç»ƒæ¡ä»¶å’Œæ— æ¡ä»¶æ¨¡å‹ï¼š
$$
\tilde{\boldsymbol{s}}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t, \boldsymbol{y}) = \boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t, \emptyset) + w \left[\boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t, \boldsymbol{y}) - \boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t, \emptyset)\right]
$$</p>
<p>å…¶ä¸­$w &gt; 1$æ˜¯guidanceå¼ºåº¦ã€‚</p>
<h4 id="83-score">8.3 Scoreçš„æ­£åˆ™åŒ–æ€§è´¨</h4>
<p><strong>Lipschitzè¿ç»­æ€§</strong>ï¼š</p>
<p>ç†æƒ³æƒ…å†µä¸‹ï¼ŒScoreå‡½æ•°åº”è¯¥æ˜¯Lipschitzè¿ç»­çš„ï¼š
$$
\|\nabla_{\boldsymbol{x}} \log p(\boldsymbol{x}) - \nabla_{\boldsymbol{x}'} \log p(\boldsymbol{x}')\| \leq L \|\boldsymbol{x} - \boldsymbol{x}'\|
$$</p>
<p>è¿™ä¿è¯äº†é€†å‘æ‰©æ•£è¿‡ç¨‹çš„ç¨³å®šæ€§ã€‚</p>
<p><strong>æ¢¯åº¦æƒ©ç½š</strong>ï¼š</p>
<p>ä¸ºäº†é¼“åŠ±Lipschitzè¿ç»­æ€§ï¼Œå¯ä»¥æ·»åŠ æ¢¯åº¦æƒ©ç½šé¡¹ï¼š
$$
\mathcal{L}_{\text{GP}}(\boldsymbol{\theta}) = \mathbb{E}_{\boldsymbol{x}}\left[\|\nabla_{\boldsymbol{x}} \boldsymbol{s}_{\boldsymbol{\theta}}(\boldsymbol{x})\|^2\right]
$$</p>
<p>è¿™ç­‰ä»·äºæœ€å°åŒ–Scoreçš„HessianèŒƒæ•°ã€‚</p>
<h3 id="9">9. æ€»ç»“ä¸å±•æœ›</h3>
<p>æœ¬æ–‡è¯¦ç»†æ¨å¯¼äº†Score Matchingçš„å„ç§å˜ä½“åŠå…¶ç­‰ä»·æ€§ï¼š</p>
<ol>
<li><strong>æ˜¾å¼Score Matching</strong>ï¼šéœ€è¦è®¡ç®—Hessianï¼Œè®¡ç®—æˆæœ¬é«˜</li>
<li><strong>Denoising Score Matching</strong>ï¼šé€šè¿‡åŠ å™ªé¿å…Hessianè®¡ç®—</li>
<li><strong>Sliced Score Matching</strong>ï¼šé€šè¿‡éšæœºæŠ•å½±è¿›ä¸€æ­¥é™ä½è®¡ç®—é‡</li>
<li><strong>Conditional Score Matching</strong>ï¼šåœ¨æ‰©æ•£æ¨¡å‹ä¸­æœ€å¸¸ç”¨</li>
</ol>
<p>å…³é”®ç»“è®ºï¼š<strong>Score Matchingå’ŒConditional Score Matchingåœ¨ç†è®ºä¸Šå®Œå…¨ç­‰ä»·</strong>ï¼Œå·®å¼‚ä»…åœ¨äºä¸€ä¸ªä¸ä¼˜åŒ–å‚æ•°æ— å…³çš„å¸¸æ•°ã€‚</p>
<p>ä»å®è·µè§’åº¦ï¼š
- Conditional Score Matchingæ˜¯æ— åä¼°è®¡ï¼Œä¸ä¾èµ–å¤§batch size
- Score Matchingçš„ç›´æ¥ä¼°è®¡æ˜¯æœ‰åçš„ï¼Œéœ€è¦å¤§batch sizeæˆ–ç‰¹æ®ŠæŠ€å·§</p>
<p>ä»ç†è®ºè§’åº¦ï¼š
- ä¸¤è€…çš„å…¨å±€æœ€ä¼˜è§£å®Œå…¨ç›¸åŒ
- ç­‰ä»·æ€§çš„è¯æ˜ä¾èµ–äºè¾¹ç¼˜Scoreå¯ä»¥è¡¨ç¤ºä¸ºæ¡ä»¶Scoreçš„æœŸæœ›</p>
<p>è¿™ä¸€ç­‰ä»·æ€§ä¸ºæ‰©æ•£æ¨¡å‹çš„ç†è®ºåˆ†ææä¾›äº†åšå®åŸºç¡€ï¼Œä¹Ÿè§£é‡Šäº†ä¸ºä½•Denoising Score Matchingèƒ½å¤Ÿæœ‰æ•ˆè®­ç»ƒæ‰©æ•£æ¨¡å‹ã€‚</p>
        </div>
    </div>
</body>
</html>