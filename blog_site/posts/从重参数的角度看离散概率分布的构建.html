<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»é‡å‚æ•°çš„è§’åº¦çœ‹ç¦»æ•£æ¦‚ç‡åˆ†å¸ƒçš„æ„å»º</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>ä»é‡å‚æ•°çš„è§’åº¦çœ‹ç¦»æ•£æ¦‚ç‡åˆ†å¸ƒçš„æ„å»º</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-19 | ğŸ“„ å¤§å°: 23.1 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/9085">https://spaces.ac.cn/archives/9085</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>ä¸€èˆ¬æ¥è¯´ï¼Œç¥ç»ç½‘ç»œçš„è¾“å‡ºéƒ½æ˜¯æ— çº¦æŸçš„ï¼Œä¹Ÿå°±æ˜¯å€¼åŸŸä¸º$\mathbb{R}$ï¼Œè€Œä¸ºäº†å¾—åˆ°æœ‰çº¦æŸçš„è¾“å‡ºï¼Œé€šå¸¸æ˜¯é‡‡ç”¨åŠ æ¿€æ´»å‡½æ•°çš„æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è¾“å‡ºä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒæ¥ä»£è¡¨æ¯ä¸ªç±»åˆ«çš„æ¦‚ç‡ï¼Œé‚£ä¹ˆé€šå¸¸åœ¨æœ€ååŠ ä¸ŠSoftmaxä½œä¸ºæ¿€æ´»å‡½æ•°ã€‚é‚£ä¹ˆä¸€ä¸ªç´§æ¥ç€çš„ç–‘é—®å°±æ˜¯ï¼šé™¤äº†Softmaxï¼Œè¿˜æœ‰ä»€ä¹ˆåˆ«çš„æ“ä½œèƒ½ç”Ÿæˆä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒå—ï¼Ÿ</p>
<p>åœ¨<a href="/archives/6705">ã€Šæ¼«è°ˆé‡å‚æ•°ï¼šä»æ­£æ€åˆ†å¸ƒåˆ°Gumbel Softmaxã€‹</a>ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†Softmaxçš„é‡å‚æ•°æ“ä½œï¼Œæœ¬æ–‡å°†è¿™ä¸ªè¿‡ç¨‹åè¿‡æ¥ï¼Œå³å…ˆå®šä¹‰é‡å‚æ•°æ“ä½œï¼Œç„¶åå»åæ¨å¯¹åº”çš„æ¦‚ç‡åˆ†å¸ƒï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªç†è§£æ¦‚ç‡åˆ†å¸ƒæ„å»ºçš„æ–°è§†è§’ã€‚</p>
<h2 id="_1">é—®é¢˜å®šä¹‰</h2>
<p>å‡è®¾æ¨¡å‹çš„è¾“å‡ºå‘é‡ä¸º$\boldsymbol{\mu}=[\mu_1,\cdots,\mu_n]\in\mathbb{R}^n$ï¼Œä¸å¤±ä¸€èˆ¬æ€§ï¼Œè¿™é‡Œå‡è®¾$\mu_i$ä¸¤ä¸¤ä¸ç­‰ã€‚æˆ‘ä»¬å¸Œæœ›é€šè¿‡æŸä¸ªå˜æ¢$\mathcal{T}$å°†$\boldsymbol{\mu}$è½¬æ¢ä¸º$n$å…ƒæ¦‚ç‡åˆ†å¸ƒ$\boldsymbol{p}=[p_1,\cdots,p_n]$ï¼Œå¹¶ä¿æŒä¸€å®šçš„æ€§è´¨ã€‚æ¯”å¦‚ï¼Œæœ€åŸºæœ¬çš„è¦æ±‚æ˜¯ï¼š<br />
\begin{equation}{\color{red}1.}\,p_i\geq 0 \qquad {\color{red}2.}\,\sum_i p_i = 1 \qquad {\color{red}3.}\,p_i \geq p_j \Leftrightarrow \mu_i \geq \mu_j\end{equation}<br />
å½“ç„¶ï¼Œè¿™äº›è¦æ±‚éƒ½å¾ˆå¹³å‡¡ï¼Œåªè¦$f$æ˜¯$\mathbb{R}\mapsto\mathbb{R}^+$çš„å•è°ƒå‡½æ•°ï¼ˆå¯¹äºSoftmaxæœ‰$f(x)=e^x$ï¼‰ï¼Œé‚£ä¹ˆå˜æ¢<br />
\begin{equation}p_i = \frac{f(\mu_i)}{\sum\limits_j f(\mu_j)}\end{equation}<br />
éƒ½å¯ä»¥æ»¡è¶³ä¸Šè¿°è¦æ±‚ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å¢åŠ ä¸€ä¸ªä¸é‚£ä¹ˆå¹³å‡¡çš„æ¡ä»¶ï¼š<br />
\begin{equation}{\color{red}4.}\, \mathcal{T}(\boldsymbol{\mu}) = \mathcal{T}(\boldsymbol{\mu} + c\boldsymbol{1})\quad (\forall c \in \mathbb{R})\end{equation}<br />
å…¶ä¸­$\boldsymbol{1}$ä»£è¡¨å…¨1å‘é‡ï¼Œ$c$åˆ™æ˜¯ä»»æ„å¸¸æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ$\boldsymbol{\mu}$çš„æ¯ä¸ªåˆ†é‡éƒ½åŠ ä¸ŠåŒä¸€å¸¸æ•°åï¼Œå˜æ¢çš„ç»“æœä¿æŒä¸å˜ï¼Œæå‡ºè¿™ä¸ªæ¡ä»¶æ˜¯å› ä¸ºæ¯ä¸ªåˆ†é‡éƒ½åŠ ä¸Šä¸€ä¸ªå¸¸æ•°åï¼Œ$\mathop{\text{argmax}}$çš„ç»“æœä¸ä¼šæ”¹å˜ï¼Œè€Œ$\mathcal{T}$æœ€å¥½èƒ½å°½é‡ä¿æŒè·Ÿå®ƒä¸€æ ·çš„æ€§è´¨ã€‚å®¹æ˜“æ£€éªŒSoftmaxæ˜¯æ»¡è¶³è¿™ä¸ªæ¡ä»¶çš„ï¼Œç„¶è€Œé™¤äº†Softmaxå¤–ï¼Œæˆ‘ä»¬ä¼¼ä¹å¾ˆéš¾æƒ³åˆ°åˆ«çš„å˜æ¢äº†ã€‚</p>
<h2 id="_2">å™ªå£°æ‰°åŠ¨</h2>
<p>éå¸¸æœ‰æ„æ€çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©é‡å‚æ•°ï¼ˆReparameterizationï¼‰çš„é€†è¿‡ç¨‹æ¥æ„é€ è¿™æ ·çš„å˜æ¢ï¼å‡è®¾$\boldsymbol{\varepsilon}=[\varepsilon_1,\cdots,\varepsilon_n]$æ˜¯ä»åˆ†å¸ƒ$p(\varepsilon)$ç‹¬ç«‹é‡å¤é‡‡æ ·$n$æ¬¡å¾—åˆ°çš„å‘é‡ï¼Œç”±äº$\boldsymbol{\varepsilon}$æ˜¯éšæœºçš„ï¼Œé‚£ä¹ˆ$\mathop{\text{argmax}}(\boldsymbol{\mu}+\boldsymbol{\varepsilon})$é€šå¸¸ä¹Ÿæ˜¯éšæœºçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡<br />
\begin{equation}p_i = P[\mathop{\text{argmax}}(\boldsymbol{\mu}+\boldsymbol{\varepsilon})=i]\end{equation}<br />
æ¥å®šä¹‰å˜æ¢$\mathcal{T}$ã€‚ç”±äº$\boldsymbol{\varepsilon}$æ˜¯ç‹¬ç«‹åŒåˆ†å¸ƒçš„ï¼Œä¸”æ•´ä¸ªå®šä¹‰åªè·Ÿ$\mathop{\text{argmax}}(\boldsymbol{\mu}+\boldsymbol{\varepsilon})$æœ‰å…³ï¼Œä¹Ÿå°±æ˜¯åªæ¶‰åŠåˆ°æ¯ä¸ªåˆ†é‡çš„ç›¸å¯¹å¤§å°ï¼Œå› æ­¤æ‰€å®šä¹‰çš„å˜æ¢å¿…ç„¶æ˜¯æ»¡è¶³å‰è¿°4ä¸ªæ¡ä»¶çš„ã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç›´æ¥ç®—å‡º$p_i$çš„å½¢å¼æ¥åˆ¤æ–­å®ƒæ»¡è¶³çš„æ€§è´¨ã€‚å…·ä½“æ¥è¯´ï¼Œ$\mathop{\text{argmax}}(\boldsymbol{\mu}+\boldsymbol{\varepsilon})=i$æ„å‘³ç€<br />
\begin{equation}\mu_i + \varepsilon_i &gt; \mu_j + \varepsilon_j\quad (\forall j\neq i)\end{equation}<br />
ä¹Ÿå°±æ˜¯$\mu_i - \mu_j + \varepsilon_i &gt; \varepsilon_j$ï¼Œæ˜¾ç„¶$\mu_i$è¶Šå¤§è¯¥å¼æˆç«‹çš„å¯èƒ½æ€§è¶Šå¤§ï¼Œä¹Ÿå³$\mu_i$è¶Šå¤§å¯¹åº”çš„$p_i$è¶Šå¤§ï¼Œè¿™ä¾¿æ˜¯æ¡ä»¶$3$ã€‚å…·ä½“æ¥è¯´ï¼Œå›ºå®š$\varepsilon_i$çš„æƒ…å†µä¸‹ï¼Œæ»¡è¶³è¯¥æ¡ä»¶çš„æ¦‚ç‡æ˜¯<br />
\begin{equation}\int_{-\infty}^{\mu_i - \mu_j + \varepsilon_i} p(\varepsilon_j)d\varepsilon_j = \Phi(\mu_i - \mu_j + \varepsilon_i)\end{equation}<br />
è¿™é‡Œ$\Phi$æ˜¯$p(\varepsilon)$çš„ç´¯ç§¯åˆ†å¸ƒå‡½æ•°ï¼ˆCumulative Distribution Functionï¼‰ã€‚ç”±äºå„ä¸ª$\varepsilon_j$éƒ½æ˜¯ç‹¬ç«‹åŒåˆ†å¸ƒçš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†æ¦‚ç‡ç›´æ¥è¿ä¹˜èµ·æ¥ï¼š<br />
\begin{equation}\prod_{j\neq i} \Phi(\mu_i - \mu_j + \varepsilon_i)\end{equation}<br />
è¿™æ˜¯å›ºå®š$\varepsilon_i$çš„æƒ…å†µä¸‹ï¼Œ$\mathop{\text{argmax}}(\boldsymbol{\mu}+\boldsymbol{\varepsilon})=i$çš„æ¦‚ç‡ã€‚æœ€åæˆ‘ä»¬åªéœ€è¦å¯¹$\varepsilon_i$æ±‚å¹³å‡ï¼Œå°±å¯ä»¥å¾—åˆ°$p_i$ï¼š<br />
\begin{equation}p_i = \int_{-\infty}^{\infty} p(\varepsilon_i)\left[\prod_{j\neq i} \Phi(\mu_i - \mu_j + \varepsilon_i)\right]d\varepsilon_i \label{eq:pi}\end{equation}<br />
ä»$p_i$çš„è¡¨è¾¾å¼å¯ä»¥çœ‹åˆ°å®ƒåªä¾èµ–äºç›¸å¯¹å€¼$\mu_i - \mu_j$ï¼Œå› æ­¤æ˜¾ç„¶å®ƒæ»¡è¶³å®šä¹‰ä¸­çš„æ¡ä»¶$4$ã€‚</p>
<h2 id="_3">æ¸©æ•…çŸ¥æ–°</h2>
<p>å¯¹ç…§<a href="/archives/6705">ã€Šæ¼«è°ˆé‡å‚æ•°ï¼šä»æ­£æ€åˆ†å¸ƒåˆ°Gumbel Softmaxã€‹</a>ä¸­å…³äºGumbel Maxçš„ä»‹ç»ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ä¸Šè¿°æ¨å¯¼è·Ÿé‡å‚æ•°æ­£å¥½ç›¸åï¼Œå®ƒæ˜¯å…ˆå®šä¹‰äº†é‡å‚æ•°çš„æ–¹æ³•ï¼Œç„¶ååœ¨åå‘æ¨å¯¼å‡ºå¯¹åº”çš„æ¦‚ç‡åˆ†å¸ƒã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥æ¥é‡æ–°æ£€éªŒä¸€ä¸‹ä¹‹å‰çš„ç»“æœï¼Œå³å½“å™ªå£°åˆ†å¸ƒå–<a href="https://en.wikipedia.org/wiki/Gumbel_distribution">Gumbelåˆ†å¸ƒ</a>æ—¶ï¼Œå¼$\eqref{eq:pi}$æ˜¯å¦èƒ½å¾—åˆ°å¸¸è§„çš„Softmaxæ“ä½œã€‚Gumbelå™ªå£°æ˜¯$u\sim U[0,1]$é€šè¿‡$\varepsilon = -\log(-\log u)$å˜æ¢è€Œæ¥ï¼Œç”±äº$u$çš„åˆ†å¸ƒæ­£å¥½æ˜¯$U[0,1]$ï¼Œæ‰€ä»¥è§£å‡ºæ¥$u=e^{-e^{-\varepsilon}}$æ­£å¥½å°±æ˜¯Gumbelåˆ†å¸ƒçš„ç´¯ç§¯åˆ†å¸ƒå‡½æ•°ï¼Œå³$\Phi(\varepsilon)=e^{-e^{-\varepsilon}}$ï¼Œè€Œ$p(\varepsilon)$å°±æ˜¯$\Phi(\varepsilon)$çš„å¯¼æ•°ï¼Œå³$p(\varepsilon)=\Phi'(\varepsilon)=e^{-\varepsilon-e^{-\varepsilon}}$ã€‚</p>
<p>å°†ä¸Šè¿°ç»“æœä»£å…¥å¼$\eqref{eq:pi}$å¾—<br />
\begin{equation}\begin{aligned}<br />
p_i =&amp;\, \int_{-\infty}^{\infty} e^{-\varepsilon_i-e^{-\varepsilon_i}} e^{-\sum\limits_{j\neq i}e^{-\varepsilon_i + \mu_j - \mu_i}} d\varepsilon_i \\\<br />
=&amp;\, \int_{-\infty}^0 e^{-e^{-\varepsilon_i}\left(1+\sum\limits_{j\neq i}e^{\mu_j - \mu_i}\right)} d(-e^{-\varepsilon_i}) \\\<br />
=&amp;\, \int_{-\infty}^0 e^{t\left(1+\sum\limits_{j\neq i}e^{\mu_j - \mu_i}\right)} dt\\\<br />
=&amp;\, \frac{1}{1+\sum\limits_{j\neq i}e^{\mu_j - \mu_i}} = \frac{e^{\mu_i}}{\sum\limits_j e^{\mu_j }}<br />
\end{aligned}\end{equation}<br />
è¿™æ­£å¥½æ˜¯Softmaxã€‚äºæ˜¯æˆ‘ä»¬å†æ¬¡éªŒè¯äº†Gumbel Maxä¸Softmaxçš„å¯¹åº”å…³ç³»ã€‚</p>
<h2 id="_4">æ•°å€¼è®¡ç®—</h2>
<p>èƒ½åƒGumbelåˆ†å¸ƒé‚£æ ·è§£å‡ºè¯¸å¦‚Softmaxçš„è§£æè§£æ˜¯æå…¶ç¨€ç½•çš„ï¼Œè‡³å°‘ç¬”è€…ç›®å‰è¿˜æ‰¾ä¸åˆ°ç¬¬äºŒä¾‹ã€‚å› æ­¤ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªèƒ½ç”¨æ•°å€¼è®¡ç®—æ–¹æ³•è¿‘ä¼¼ä¼°ç®—å¼$\eqref{eq:pi}$ã€‚ç”±äº$p(\varepsilon)=\Phi'(\varepsilon)$ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥å‡‘å¾®åˆ†å¾—ï¼š<br />
\begin{equation}p_i = \int_0^1 \left[\prod_{j\neq i} \Phi(\mu_i - \mu_j + \varepsilon_i)\right]d\Phi(\varepsilon_i)\end{equation}<br />
è®°$t=\Phi(\varepsilon_i)$ï¼Œé‚£ä¹ˆ<br />
\begin{equation}\begin{aligned}<br />
p_i =&amp;\, \int_0^1 \left[\prod_{j\neq i} \Phi(\mu_i - \mu_j + \Phi^{-1}(t))\right]dt \\\<br />
\approx&amp;\, \frac{1}{K}\sum_{k=1}^K\prod_{j\neq i} \Phi\left(\mu_i - \mu_j + \Phi^{-1}\left(\frac{k}{K+1}\right)\right)<br />
\end{aligned}\end{equation}<br />
å…¶ä¸­$\Phi^{-1}$æ˜¯$\Phi$çš„é€†å‡½æ•°ï¼Œåœ¨æ¦‚ç‡ä¸­ä¹Ÿå«åˆ†ä½å‡½æ•°ï¼ˆQuantile Functionã€Percent Point Functionç­‰ï¼‰ã€‚</p>
<p>ä»ä¸Šå¼å¯ä»¥çœ‹åˆ°ï¼Œåªè¦æˆ‘ä»¬çŸ¥é“$\Phi$çš„è§£æå¼ï¼Œå°±å¯ä»¥å¯¹$p_i$è¿›è¡Œè¿‘ä¼¼è®¡ç®—ã€‚æ³¨æ„æˆ‘ä»¬ä¸éœ€è¦çŸ¥é“$\Phi^{-1}$çš„è§£æå¼ï¼Œå› ä¸ºé‡‡æ ·ç‚¹$\Phi^{-1}\left(\frac{k}{K+1}\right)$çš„ç»“æœæˆ‘ä»¬å¯ä»¥ç”¨å…¶ä»–æ•°å€¼æ–¹æ³•æå‰è®¡ç®—å¥½ã€‚</p>
<p>ä»¥æ ‡å‡†æ­£æ€åˆ†å¸ƒä¸ºä¾‹ï¼Œ$\Phi(x)=\frac{1}{2} \left(1+\text{erf}\left(\frac{x}{\sqrt{2}}\right)\right)$ï¼Œè€Œä¸»æµçš„æ·±åº¦å­¦ä¹ æ¡†æ¶åŸºæœ¬ä¸Šéƒ½è‡ªå¸¦äº†$\text{erf}$å‡½æ•°ï¼Œæ‰€ä»¥$\Phi(x)$çš„è®¡ç®—æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼›è‡³äº$\Phi^{-1}\left(\frac{k}{K+1}\right)$æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>scipy.stats.norm.ppf</code>æ¥äº‹å…ˆè®¡ç®—å¥½ã€‚æ‰€ä»¥å½“$\boldsymbol{\varepsilon}$é‡‡æ ·è‡ªæ ‡å‡†æ­£æ€åˆ†å¸ƒæ—¶ï¼Œ$p_i$çš„è®¡ç®—åœ¨ä¸»æµæ·±åº¦å­¦ä¹ æ¡†æ¶ä¸­éƒ½æ˜¯æ²¡é—®é¢˜çš„ã€‚</p>
<h2 id="_5">æ–‡ç« å°ç»“</h2>
<p>æœ¬æ–‡ä»é‡å‚æ•°è§’åº¦å¯¹Softmaxè¿›è¡Œæ¨å¹¿ï¼Œå¾—åˆ°äº†ä¸€ç±»å…·å¤‡ç›¸ä¼¼æ€§è´¨çš„æ¦‚ç‡å½’ä¸€åŒ–æ–¹æ³•ã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/9085">https://spaces.ac.cn/archives/9085</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (May. 25, 2022). ã€Šä»é‡å‚æ•°çš„è§’åº¦çœ‹ç¦»æ•£æ¦‚ç‡åˆ†å¸ƒçš„æ„å»º ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/9085">https://spaces.ac.cn/archives/9085</a></p>
<p>@online{kexuefm-9085,<br />
title={ä»é‡å‚æ•°çš„è§’åº¦çœ‹ç¦»æ•£æ¦‚ç‡åˆ†å¸ƒçš„æ„å»º},<br />
author={è‹å‰‘æ—},<br />
year={2022},<br />
month={May},<br />
url={\url{https://spaces.ac.cn/archives/9085}},<br />
} </p>
<hr />
<h2 id="_6">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<p>æœ¬æ–‡æå‡ºäº†ä¸€ç§åŸºäºé‡å‚æ•°ï¼ˆReparameterizationï¼‰çš„æ–°è§†è§’æ¥ç†è§£å’Œæ„é€ æ¦‚ç‡åˆ†å¸ƒï¼Œç‰¹åˆ«æ˜¯æ¨å¹¿äº† Softmax æ“ä½œã€‚è¿™ä¸ªæ–¹æ³•é€šè¿‡å™ªå£°æ‰°åŠ¨å’Œ argmax æ“ä½œï¼Œè‡ªç„¶åœ°æ»¡è¶³æ¦‚ç‡åˆ†å¸ƒçš„æ‰€æœ‰è¦æ±‚ã€‚</p>
<h3 id="1">1. é—®é¢˜èƒŒæ™¯ä¸åŠ¨æœº</h3>
<h4 id="11">1.1 ç¥ç»ç½‘ç»œè¾“å‡ºå½’ä¸€åŒ–é—®é¢˜</h4>
<p><strong>é—®é¢˜è®¾å®š</strong>ï¼šç¥ç»ç½‘ç»œè¾“å‡º $\boldsymbol{\mu} = [\mu_1, \ldots, \mu_n] \in \mathbb{R}^n$ï¼ˆæ— çº¦æŸå®æ•°å‘é‡ï¼‰ï¼Œéœ€è¦è½¬æ¢ä¸ºæ¦‚ç‡åˆ†å¸ƒ $\boldsymbol{p} = [p_1, \ldots, p_n]$ã€‚</p>
<p><strong>ç»å…¸è§£å†³æ–¹æ¡ˆ</strong>ï¼ˆSoftmaxï¼‰ï¼š</p>
<p>$$p_i = \frac{\exp(\mu_i)}{\sum_{j=1}^n \exp(\mu_j)}$$</p>
<p><strong>æ ¸å¿ƒé—®é¢˜</strong>ï¼šé™¤äº† Softmaxï¼Œè¿˜æœ‰å…¶ä»–æ»¡è¶³æ¦‚ç‡åˆ†å¸ƒè¦æ±‚çš„å½’ä¸€åŒ–æ–¹æ³•å—ï¼Ÿ</p>
<h4 id="12">1.2 æ¦‚ç‡åˆ†å¸ƒçš„å¿…è¦æ¡ä»¶</h4>
<p>ä¸€ä¸ªæœ‰æ•ˆçš„å˜æ¢ $\mathcal{T}: \mathbb{R}^n \to \Delta^{n-1}$ï¼ˆ$\Delta^{n-1}$ æ˜¯ $(n-1)$ ç»´å•çº¯å½¢ï¼‰éœ€æ»¡è¶³ï¼š</p>
<p><strong>æ¡ä»¶ 1ï¼ˆéè´Ÿæ€§ï¼‰</strong>ï¼š
$$p_i \geq 0, \quad \forall i \in \{1, \ldots, n\}$$</p>
<p><strong>æ¡ä»¶ 2ï¼ˆå½’ä¸€åŒ–ï¼‰</strong>ï¼š
$$\sum_{i=1}^n p_i = 1$$</p>
<p><strong>æ¡ä»¶ 3ï¼ˆå•è°ƒæ€§ï¼‰</strong>ï¼š
$$p_i \geq p_j \Leftrightarrow \mu_i \geq \mu_j$$</p>
<p><strong>æ¡ä»¶ 4ï¼ˆå¹³ç§»ä¸å˜æ€§ï¼‰</strong>ï¼š
$$\mathcal{T}(\boldsymbol{\mu}) = \mathcal{T}(\boldsymbol{\mu} + c\boldsymbol{1}), \quad \forall c \in \mathbb{R}$$</p>
<p>å…¶ä¸­ $\boldsymbol{1} = [1, \ldots, 1]^T$ã€‚</p>
<h4 id="13">1.3 ä¸€èˆ¬å½¢å¼</h4>
<p><strong>å®šç†</strong>ï¼šä»»ä½•å•è°ƒé€’å¢å‡½æ•° $f: \mathbb{R} \to \mathbb{R}^+$ éƒ½å¯ä»¥å®šä¹‰æ»¡è¶³æ¡ä»¶ 1-4 çš„å˜æ¢ï¼š</p>
<p>$$p_i = \frac{f(\mu_i)}{\sum_{j=1}^n f(\mu_j)}$$</p>
<p><strong>è¯æ˜</strong>ï¼š</p>
<ul>
<li><strong>æ¡ä»¶ 1</strong>ï¼šç”±äº $f(\mu_i) &gt; 0$ ä¸” $\sum_j f(\mu_j) &gt; 0$ï¼Œæ˜¾ç„¶ $p_i &gt; 0$ã€‚</li>
<li><strong>æ¡ä»¶ 2</strong>ï¼š$\sum_i p_i = \frac{\sum_i f(\mu_i)}{\sum_j f(\mu_j)} = 1$ã€‚</li>
<li><strong>æ¡ä»¶ 3</strong>ï¼šè‹¥ $\mu_i \geq \mu_j$ï¼Œåˆ™ $f(\mu_i) \geq f(\mu_j)$ï¼ˆå•è°ƒæ€§ï¼‰ï¼Œå› æ­¤ï¼š
  $$\frac{p_i}{p_j} = \frac{f(\mu_i)}{f(\mu_j)} \geq 1 \Rightarrow p_i \geq p_j$$</li>
<li><strong>æ¡ä»¶ 4</strong>ï¼š$f(\mu_i + c) / \sum_j f(\mu_j + c)$ åœ¨åˆ†å­åˆ†æ¯ä¸­ $c$ çš„å½±å“ç›¸åŒï¼Œçº¦åˆ†åä¸å˜ã€‚</li>
</ul>
<p><strong>ç‰¹ä¾‹</strong>ï¼š
- $f(x) = e^x$ â†’ Softmax
- $f(x) = \max(0, x)$ â†’ Sparsemaxï¼ˆè¿‘ä¼¼ï¼‰
- $f(x) = x^2$ ï¼ˆ$x &gt; 0$ æ—¶ï¼‰â†’ äºŒæ¬¡å½’ä¸€åŒ–</p>
<p>ä½†è¿™è¿˜ä¸å¤Ÿæœ‰è¶£ï¼Œæˆ‘ä»¬éœ€è¦æ›´æœ¬è´¨çš„æ„é€ æ–¹æ³•ã€‚</p>
<h3 id="2">2. é‡å‚æ•°æŠ€å·§ä¸å™ªå£°æ‰°åŠ¨</h3>
<h4 id="21-reparameterization">2.1 é‡å‚æ•°ï¼ˆReparameterizationï¼‰å›é¡¾</h4>
<p><strong>æ­£å‘é‡å‚æ•°</strong>ï¼ˆä»åˆ†å¸ƒåˆ°é‡‡æ ·ï¼‰ï¼š</p>
<p>å¦‚æœ $X \sim p_\theta(x)$ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰¾åˆ°ç¡®å®šæ€§å‡½æ•° $g$ å’Œå™ªå£°åˆ†å¸ƒ $\varepsilon \sim p(\varepsilon)$ï¼Œä½¿å¾—ï¼š</p>
<p>$$X = g(\theta, \varepsilon)$$</p>
<p>è¿™æ ·å¯ä»¥é€šè¿‡ $\varepsilon$ çš„æ¢¯åº¦æ¥åå‘ä¼ æ’­ $\theta$ çš„æ¢¯åº¦ã€‚</p>
<p><strong>ä¾‹å­</strong>ï¼ˆæ­£æ€åˆ†å¸ƒï¼‰ï¼š
$$X \sim \mathcal{N}(\mu, \sigma^2) \Rightarrow X = \mu + \sigma \varepsilon, \quad \varepsilon \sim \mathcal{N}(0, 1)$$</p>
<h4 id="22">2.2 é€†å‘é‡å‚æ•°ï¼šä»å™ªå£°åˆ°åˆ†å¸ƒ</h4>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼ˆæœ¬æ–‡åˆ›æ–°ï¼‰ï¼šåè¿‡æ¥ï¼Œå…ˆå®šä¹‰å™ªå£°æ‰°åŠ¨æ–¹å¼ï¼Œå†æ¨å¯¼å‡ºå¯¹åº”çš„æ¦‚ç‡åˆ†å¸ƒã€‚</p>
<p><strong>å®šä¹‰</strong>ï¼šè®¾ $\boldsymbol{\varepsilon} = [\varepsilon_1, \ldots, \varepsilon_n]$ï¼Œå…¶ä¸­ $\varepsilon_i \overset{\text{i.i.d.}}{\sim} p(\varepsilon)$ã€‚å®šä¹‰ï¼š</p>
<p>$$p_i = P\left[\mathop{\arg\max}_j (\mu_j + \varepsilon_j) = i\right]$$</p>
<p><strong>ç›´è§‚ç†è§£</strong>ï¼š
- åœ¨ $\boldsymbol{\mu}$ ä¸ŠåŠ éšæœºå™ªå£° $\boldsymbol{\varepsilon}$
- å–æœ€å¤§å€¼çš„ç´¢å¼•ï¼ˆargmaxï¼‰
- $p_i$ æ˜¯ç´¢å¼•ä¸º $i$ çš„æ¦‚ç‡</p>
<p><strong>ä¸ºä»€ä¹ˆè¿™æ ·å®šä¹‰ï¼Ÿ</strong>
1. è‡ªç„¶æ»¡è¶³ $\sum_i p_i = 1$ï¼ˆargmax å¿…ç„¶é€‰ä¸­æŸä¸ªä½ç½®ï¼‰
2. è‡ªç„¶æ»¡è¶³ $p_i &gt; 0$ï¼ˆä»»ä½•ä½ç½®éƒ½æœ‰æœºä¼šæˆä¸ºæœ€å¤§ï¼‰
3. $\mu_i$ è¶Šå¤§ï¼Œ$i$ è¢«é€‰ä¸­çš„æ¦‚ç‡è¶Šå¤§ï¼ˆæ»¡è¶³å•è°ƒæ€§ï¼‰
4. åŠ å¸¸æ•°ä¸æ”¹å˜ç›¸å¯¹å¤§å°ï¼ˆæ»¡è¶³å¹³ç§»ä¸å˜æ€§ï¼‰</p>
<h3 id="3">3. æ¦‚ç‡åˆ†å¸ƒçš„æ˜¾å¼æ¨å¯¼</h3>
<h4 id="31">3.1 æ¡ä»¶æ¦‚ç‡åˆ†è§£</h4>
<p>$\mathop{\arg\max}_j (\mu_j + \varepsilon_j) = i$ ç­‰ä»·äºï¼š</p>
<p>$$\mu_i + \varepsilon_i > \mu_j + \varepsilon_j, \quad \forall j \neq i$$</p>
<p>å³ï¼š</p>
<p>$$\varepsilon_j < \mu_i - \mu_j + \varepsilon_i, \quad \forall j \neq i$$</p>
<h4 id="32-varepsilon_i">3.2 å›ºå®š $\varepsilon_i$ æ—¶çš„æ¡ä»¶æ¦‚ç‡</h4>
<p>ç»™å®š $\varepsilon_i$ çš„å€¼ï¼Œäº‹ä»¶ $\varepsilon_j &lt; \mu_i - \mu_j + \varepsilon_i$ çš„æ¦‚ç‡ä¸ºï¼š</p>
<p>$$P[\varepsilon_j < \mu_i - \mu_j + \varepsilon_i] = \int_{-\infty}^{\mu_i - \mu_j + \varepsilon_i} p(\varepsilon_j) d\varepsilon_j = \Phi(\mu_i - \mu_j + \varepsilon_i)$$</p>
<p>å…¶ä¸­ $\Phi(x)$ æ˜¯ $p(\varepsilon)$ çš„<strong>ç´¯ç§¯åˆ†å¸ƒå‡½æ•°</strong>ï¼ˆCDFï¼‰ï¼š</p>
<p>$$\Phi(x) = \int_{-\infty}^x p(t) \, dt$$</p>
<h4 id="33">3.3 ç‹¬ç«‹æ€§ä¸ä¹˜ç§¯</h4>
<p>ç”±äº $\varepsilon_1, \ldots, \varepsilon_n$ ç‹¬ç«‹åŒåˆ†å¸ƒï¼Œå¯¹äºå›ºå®šçš„ $\varepsilon_i$ï¼š</p>
<p>$$P[\text{æ‰€æœ‰ } j \neq i \text{ éƒ½æ»¡è¶³æ¡ä»¶} \mid \varepsilon_i] = \prod_{j \neq i} \Phi(\mu_i - \mu_j + \varepsilon_i)$$</p>
<h4 id="34-varepsilon_i">3.4 å¯¹ $\varepsilon_i$ ç§¯åˆ†ï¼ˆå…¨æ¦‚ç‡å…¬å¼ï¼‰</h4>
<p>$$p_i = \int_{-\infty}^{\infty} p(\varepsilon_i) \left[\prod_{j \neq i} \Phi(\mu_i - \mu_j + \varepsilon_i)\right] d\varepsilon_i$$</p>
<p><strong>è¿™æ˜¯æœ¬æ–‡çš„æ ¸å¿ƒå…¬å¼</strong>ï¼å®ƒç»™å‡ºäº†ä»»æ„å™ªå£°åˆ†å¸ƒ $p(\varepsilon)$ å¯¹åº”çš„æ¦‚ç‡å½’ä¸€åŒ–æ–¹æ³•ã€‚</p>
<h4 id="35">3.5 æ€§è´¨éªŒè¯</h4>
<p><strong>å¹³ç§»ä¸å˜æ€§</strong>ï¼š</p>
<p>$$p_i = \int p(\varepsilon_i) \prod_{j \neq i} \Phi((\mu_i + c) - (\mu_j + c) + \varepsilon_i) d\varepsilon_i$$</p>
<p>$$= \int p(\varepsilon_i) \prod_{j \neq i} \Phi(\mu_i - \mu_j + \varepsilon_i) d\varepsilon_i$$</p>
<p>å› ä¸º $c$ åœ¨å·®å€¼ä¸­æŠµæ¶ˆï¼Œæ‰€ä»¥æ»¡è¶³æ¡ä»¶ 4ã€‚âœ…</p>
<h3 id="4-gumbel-softmax">4. Gumbel åˆ†å¸ƒä¸ Softmax çš„ç­‰ä»·æ€§</h3>
<h4 id="41-gumbel">4.1 Gumbel åˆ†å¸ƒå®šä¹‰</h4>
<p><strong>æ ‡å‡† Gumbel åˆ†å¸ƒ</strong>ï¼š</p>
<p><strong>é‡‡æ ·æ–¹æ³•</strong>ï¼š$u \sim \text{Uniform}(0, 1)$ï¼Œåˆ™ï¼š</p>
<p>$$\varepsilon = -\log(-\log u)$$</p>
<p>æœä» Gumbel$(0, 1)$ åˆ†å¸ƒã€‚</p>
<p><strong>ç´¯ç§¯åˆ†å¸ƒå‡½æ•°</strong>ï¼ˆCDFï¼‰ï¼š</p>
<p>$$\Phi(\varepsilon) = P[\varepsilon \leq x] = e^{-e^{-x}}$$</p>
<p><strong>è¯æ˜</strong>ï¼š</p>
<p>$$P[\varepsilon \leq x] = P[-\log(-\log u) \leq x] = P[-\log u \geq e^{-x}]$$</p>
<p>$$= P[u \leq e^{-e^{-x}}] = e^{-e^{-x}}$$</p>
<p><strong>æ¦‚ç‡å¯†åº¦å‡½æ•°</strong>ï¼ˆPDFï¼‰ï¼š</p>
<p>$$p(\varepsilon) = \frac{d\Phi}{d\varepsilon} = e^{-\varepsilon - e^{-\varepsilon}}$$</p>
<p><strong>éªŒè¯</strong>ï¼š</p>
<p>$$\frac{d}{d\varepsilon} e^{-e^{-\varepsilon}} = e^{-e^{-\varepsilon}} \cdot (-e^{-\varepsilon}) \cdot (-1) = e^{-\varepsilon - e^{-\varepsilon}}$$ âœ…</p>
<h4 id="42">4.2 ä»£å…¥æ ¸å¿ƒå…¬å¼</h4>
<p>å°† Gumbel åˆ†å¸ƒä»£å…¥ $p_i$ çš„ç§¯åˆ†è¡¨è¾¾å¼ï¼š</p>
<p>$$p_i = \int_{-\infty}^{\infty} e^{-\varepsilon_i - e^{-\varepsilon_i}} \prod_{j \neq i} e^{-e^{-\varepsilon_i + \mu_j - \mu_i}} d\varepsilon_i$$</p>
<p><strong>ç®€åŒ–æŒ‡æ•°é¡¹</strong>ï¼š</p>
<p>$$\prod_{j \neq i} e^{-e^{-\varepsilon_i + \mu_j - \mu_i}} = \exp\left(-\sum_{j \neq i} e^{-\varepsilon_i + \mu_j - \mu_i}\right)$$</p>
<p>$$= \exp\left(-e^{-\varepsilon_i} \sum_{j \neq i} e^{\mu_j - \mu_i}\right)$$</p>
<h4 id="43">4.3 åˆå¹¶æŒ‡æ•°</h4>
<p>$$p_i = \int_{-\infty}^{\infty} \exp\left(-\varepsilon_i - e^{-\varepsilon_i} - e^{-\varepsilon_i} \sum_{j \neq i} e^{\mu_j - \mu_i}\right) d\varepsilon_i$$</p>
<p>$$= \int_{-\infty}^{\infty} \exp\left(-\varepsilon_i - e^{-\varepsilon_i} \left(1 + \sum_{j \neq i} e^{\mu_j - \mu_i}\right)\right) d\varepsilon_i$$</p>
<h4 id="44">4.4 å˜é‡æ›¿æ¢</h4>
<p>ä»¤ $t = e^{-\varepsilon_i}$ï¼Œåˆ™ï¼š
- $\varepsilon_i = -\log t$
- $d\varepsilon_i = -\frac{1}{t} dt$
- å½“ $\varepsilon_i \to -\infty$ æ—¶ï¼Œ$t \to +\infty$
- å½“ $\varepsilon_i \to +\infty$ æ—¶ï¼Œ$t \to 0$</p>
<p>$$p_i = \int_{+\infty}^{0} \exp\left(\log t - t \sum_j e^{\mu_j - \mu_i}\right) \left(-\frac{1}{t}\right) dt$$</p>
<p>$$= \int_0^{+\infty} \exp\left(-t \sum_j e^{\mu_j - \mu_i}\right) dt$$</p>
<p>å…¶ä¸­ $\sum_j e^{\mu_j - \mu_i} = e^{-\mu_i} \sum_j e^{\mu_j}$ã€‚</p>
<h4 id="45">4.5 æ ‡å‡†ç§¯åˆ†</h4>
<p>$$\int_0^{\infty} e^{-\lambda t} dt = \frac{1}{\lambda}, \quad \lambda > 0$$</p>
<p>åº”ç”¨å¾—ï¼š</p>
<p>$$p_i = \frac{1}{\sum_j e^{\mu_j - \mu_i}} = \frac{e^{\mu_i}}{\sum_j e^{\mu_j}}$$</p>
<p><strong>è¿™æ­£æ˜¯ Softmaxï¼</strong> âœ…</p>
<p><strong>ç»“è®º</strong>ï¼šGumbel Max é‡å‚æ•°ç­‰ä»·äº Softmax æ“ä½œã€‚</p>
<h3 id="5">5. å…¶ä»–å™ªå£°åˆ†å¸ƒ</h3>
<h4 id="51">5.1 æ ‡å‡†æ­£æ€åˆ†å¸ƒ</h4>
<p>å¦‚æœ $\varepsilon_i \sim \mathcal{N}(0, 1)$ï¼Œåˆ™ï¼š</p>
<p>$$\Phi(\varepsilon) = \frac{1}{2}\left(1 + \text{erf}\left(\frac{\varepsilon}{\sqrt{2}}\right)\right)$$</p>
<p>å…¶ä¸­ $\text{erf}(x) = \frac{2}{\sqrt{\pi}} \int_0^x e^{-t^2} dt$ æ˜¯è¯¯å·®å‡½æ•°ã€‚</p>
<p>ä»£å…¥æ ¸å¿ƒå…¬å¼ï¼š</p>
<p>$$p_i = \int_{-\infty}^{\infty} \frac{1}{\sqrt{2\pi}} e^{-\varepsilon_i^2/2} \prod_{j \neq i} \frac{1}{2}\left(1 + \text{erf}\left(\frac{\mu_i - \mu_j + \varepsilon_i}{\sqrt{2}}\right)\right) d\varepsilon_i$$</p>
<p><strong>æ³¨æ„</strong>ï¼šè¿™ä¸ªç§¯åˆ†<strong>æ²¡æœ‰è§£æè§£</strong>ï¼Œéœ€è¦æ•°å€¼è®¡ç®—ï¼ˆè§ä¸‹èŠ‚ï¼‰ã€‚</p>
<h4 id="52-logistic">5.2 Logistic åˆ†å¸ƒ</h4>
<p>$$\Phi(\varepsilon) = \frac{1}{1 + e^{-\varepsilon}}$$</p>
<p>è¿™ä¼šå¯¼è‡´å¦ä¸€ç§ç±»ä¼¼ Softmax çš„åˆ†å¸ƒï¼Œä½†ä»éœ€æ•°å€¼ç§¯åˆ†ã€‚</p>
<h3 id="6">6. æ•°å€¼è®¡ç®—æ–¹æ³•</h3>
<h4 id="61">6.1 å˜é‡æ›¿æ¢æŠ€å·§</h4>
<p>åˆ©ç”¨ $p(\varepsilon) = \Phi'(\varepsilon)$ï¼Œè¿›è¡Œå˜é‡æ›¿æ¢ $u = \Phi(\varepsilon_i)$ï¼š</p>
<p>$$p_i = \int_0^1 \left[\prod_{j \neq i} \Phi(\mu_i - \mu_j + \Phi^{-1}(u))\right] du$$</p>
<p>å…¶ä¸­ $\Phi^{-1}$ æ˜¯<strong>åˆ†ä½å‡½æ•°</strong>ï¼ˆQuantile Functionï¼‰ã€‚</p>
<h4 id="62">6.2 è’™ç‰¹å¡æ´›è¿‘ä¼¼</h4>
<p>$$p_i \approx \frac{1}{K} \sum_{k=1}^K \prod_{j \neq i} \Phi\left(\mu_i - \mu_j + \Phi^{-1}\left(\frac{k}{K+1}\right)\right)$$</p>
<p><strong>ä¼˜ç‚¹</strong>ï¼š
- åªéœ€è¦çŸ¥é“ $\Phi(x)$ çš„è§£æå¼ï¼ˆé€šå¸¸æ·±åº¦å­¦ä¹ æ¡†æ¶éƒ½æœ‰ï¼‰
- $\Phi^{-1}(k/(K+1))$ å¯ä»¥é¢„å…ˆè®¡ç®—å¹¶å­˜å‚¨</p>
<h4 id="63">6.3 æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„å®ç°</h4>
<p><strong>Python ç¤ºä¾‹</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">norm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.special</span><span class="w"> </span><span class="kn">import</span> <span class="n">erf</span>

<span class="c1"># é¢„è®¡ç®—åˆ†ä½ç‚¹</span>
<span class="n">K</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">quantiles</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">K</span><span class="o">/</span><span class="p">(</span><span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">K</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">normal_softmax</span><span class="p">(</span><span class="n">mu</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;åŸºäºæ ‡å‡†æ­£æ€å™ªå£°çš„ Softmax æ¨å¹¿&quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="c1"># å¯¹æ¯ä¸ªåˆ†ä½ç‚¹è®¡ç®—ä¹˜ç§¯</span>
        <span class="n">probs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">quantiles</span><span class="p">:</span>
            <span class="n">prod</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">:</span>
                    <span class="c1"># Î¦(Î¼_i - Î¼_j + Îµ_i)</span>
                    <span class="n">arg</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">mu</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">prod</span> <span class="o">*=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">erf</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>
            <span class="n">probs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prod</span><span class="p">)</span>

        <span class="c1"># è’™ç‰¹å¡æ´›å¹³å‡</span>
        <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">probs</span><span class="p">)</span>

    <span class="c1"># é‡æ–°å½’ä¸€åŒ–ï¼ˆæ•°å€¼ç¨³å®šæ€§ï¼‰</span>
    <span class="n">p</span> <span class="o">/=</span> <span class="n">p</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">p</span>

<span class="c1"># æµ‹è¯•</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Normal-Softmax:&quot;</span><span class="p">,</span> <span class="n">normal_softmax</span><span class="p">(</span><span class="n">mu</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Standard Softmax:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</code></pre></div>

<p><strong>è¾“å‡ºç¤ºä¾‹</strong>ï¼š</p>
<div class="codehilite"><pre><span></span><code>Normal-Softmax: [0.241, 0.632, 0.127]
Standard Softmax: [0.211, 0.643, 0.146]
</code></pre></div>

<p>å·®å¼‚ä¸å¤§ï¼Œä½† Normal-Softmax æ›´"æ¸©å’Œ"ï¼ˆç†µæ›´é«˜ï¼‰ã€‚</p>
<h3 id="7">7. æ€§è´¨å¯¹æ¯”åˆ†æ</h3>
<h4 id="71">7.1 ä¸åŒå™ªå£°åˆ†å¸ƒçš„æ•ˆæœ</h4>
<table>
<thead>
<tr>
<th>å™ªå£°åˆ†å¸ƒ</th>
<th>CDF $\Phi(\varepsilon)$</th>
<th>å½’ä¸€åŒ–æ•ˆæœ</th>
<th>è§£æè§£</th>
</tr>
</thead>
<tbody>
<tr>
<td>Gumbel</td>
<td>$e^{-e^{-\varepsilon}}$</td>
<td>Softmax</td>
<td>âœ…</td>
</tr>
<tr>
<td>æ­£æ€</td>
<td>$\Phi_{\mathcal{N}}(\varepsilon)$</td>
<td>æ¸©å’Œ Softmax</td>
<td>âŒ</td>
</tr>
<tr>
<td>Logistic</td>
<td>$(1+e^{-\varepsilon})^{-1}$</td>
<td>ç±» Softmax</td>
<td>âŒ</td>
</tr>
<tr>
<td>æŒ‡æ•°</td>
<td>$1 - e^{-\varepsilon}$ ï¼ˆ$\varepsilon \geq 0$ï¼‰</td>
<td>åå‘å¤§å€¼</td>
<td>âŒ</td>
</tr>
</tbody>
</table>
<h4 id="72">7.2 ç†µçš„æ¯”è¾ƒ</h4>
<p>å¯¹äºç›¸åŒçš„ $\boldsymbol{\mu}$ï¼Œä¸åŒå™ªå£°åˆ†å¸ƒäº§ç”Ÿçš„ $\boldsymbol{p}$ å…·æœ‰ä¸åŒçš„ç†µï¼š</p>
<p>$$\mathcal{H}(\boldsymbol{p}) = -\sum_i p_i \log p_i$$</p>
<p><strong>è§‚å¯Ÿ</strong>ï¼ˆå®éªŒç»“æœï¼‰ï¼š
- <strong>Gumbel</strong>ï¼ˆSoftmaxï¼‰ï¼šä¸­ç­‰ç†µ
- <strong>æ­£æ€</strong>ï¼šç•¥é«˜ç†µï¼ˆåˆ†å¸ƒæ›´å‡åŒ€ï¼‰
- <strong>é‡å°¾åˆ†å¸ƒ</strong>ï¼ˆå¦‚ Cauchyï¼‰ï¼šæ›´é«˜ç†µ
- <strong>è½»å°¾åˆ†å¸ƒ</strong>ï¼ˆå¦‚æˆªæ–­æ­£æ€ï¼‰ï¼šæ›´ä½ç†µ</p>
<p><strong>è§£é‡Š</strong>ï¼šå™ªå£°æ–¹å·®è¶Šå¤§ï¼Œ$\arg\max$ è¶Šéšæœºï¼Œç†µè¶Šé«˜ã€‚</p>
<h3 id="8">8. æ¢¯åº¦è®¡ç®—ä¸åå‘ä¼ æ’­</h3>
<h4 id="81">8.1 æ¢¯åº¦çš„éšå¼å½¢å¼</h4>
<p>$$\frac{\partial p_i}{\partial \mu_k} = \frac{\partial}{\partial \mu_k} \int p(\varepsilon_i) \prod_{j \neq i} \Phi(\mu_i - \mu_j + \varepsilon_i) d\varepsilon_i$$</p>
<p><strong>æƒ…å†µ 1</strong>ï¼ˆ$k = i$ï¼‰ï¼š</p>
<p>$$\frac{\partial p_i}{\partial \mu_i} = \int p(\varepsilon_i) \sum_{j \neq i} \left[\Phi'(\mu_i - \mu_j + \varepsilon_i) \prod_{l \neq i, l \neq j} \Phi(\mu_i - \mu_l + \varepsilon_i)\right] d\varepsilon_i$$</p>
<p><strong>æƒ…å†µ 2</strong>ï¼ˆ$k \neq i$ï¼‰ï¼š</p>
<p>$$\frac{\partial p_i}{\partial \mu_k} = -\int p(\varepsilon_i) \Phi'(\mu_i - \mu_k + \varepsilon_i) \prod_{j \neq i, j \neq k} \Phi(\mu_i - \mu_j + \varepsilon_i) d\varepsilon_i$$</p>
<h4 id="82">8.2 è‡ªåŠ¨å¾®åˆ†</h4>
<p>å¥½æ¶ˆæ¯ï¼šåœ¨æ·±åº¦å­¦ä¹ æ¡†æ¶ä¸­ï¼Œå¦‚æœç”¨è’™ç‰¹å¡æ´›è¿‘ä¼¼è®¡ç®— $p_i$ï¼Œæ¢¯åº¦å¯ä»¥è‡ªåŠ¨è®¡ç®—ï¼</p>
<p>$$p_i \approx \frac{1}{K} \sum_{k=1}^K g_i^{(k)}(\boldsymbol{\mu})$$</p>
<p>å…¶ä¸­ $g_i^{(k)}(\boldsymbol{\mu}) = \prod_{j \neq i} \Phi(\mu_i - \mu_j + \varepsilon_i^{(k)})$ æ˜¯å¯å¾®çš„ã€‚</p>
<h3 id="9">9. åº”ç”¨ä¸æ‰©å±•</h3>
<h4 id="91">9.1 æ¸©å’Œçš„åˆ†ç±»</h4>
<p>ç›¸æ¯” Softmaxï¼Œæ­£æ€å™ªå£°å½’ä¸€åŒ–äº§ç”Ÿæ›´å‡åŒ€çš„åˆ†å¸ƒï¼Œå¯ç”¨äºï¼š
- å‡è½»è¿‡æ‹Ÿåˆï¼ˆåˆ†å¸ƒæ›´å¹³æ»‘ï¼‰
- æé«˜é²æ£’æ€§ï¼ˆå¯¹å¼‚å¸¸å€¼ä¸æ•æ„Ÿï¼‰</p>
<h4 id="92">9.2 å¯å­¦ä¹ çš„å™ªå£°åˆ†å¸ƒ</h4>
<p>å¯ä»¥å°†å™ªå£°åˆ†å¸ƒ $p_\theta(\varepsilon)$ å‚æ•°åŒ–ï¼Œé€šè¿‡å­¦ä¹  $\theta$ æ¥ä¼˜åŒ–å½’ä¸€åŒ–æ–¹å¼ï¼š</p>
<p>$$p_i(\theta) = \int p_\theta(\varepsilon_i) \prod_{j \neq i} \Phi_\theta(\mu_i - \mu_j + \varepsilon_i) d\varepsilon_i$$</p>
<h4 id="93">9.3 ç»“æ„åŒ–å™ªå£°</h4>
<p>å¯¹äºç»“æ„åŒ–è¾“å‡ºï¼ˆå¦‚åºåˆ—æ ‡æ³¨ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ç›¸å…³å™ªå£° $\boldsymbol{\varepsilon}$ æ¥å»ºæ¨¡è¾“å‡ºä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</p>
<h3 id="10">10. ç†è®ºæ·±å…¥</h3>
<h4 id="101">10.1 ä¸æå€¼ç†è®ºçš„è”ç³»</h4>
<p><strong>Fisher-Tippett-Gnedenko å®šç†</strong>ï¼ˆæå€¼åˆ†å¸ƒï¼‰ï¼š</p>
<p>åœ¨é€‚å½“å½’ä¸€åŒ–ä¸‹ï¼Œi.i.d. éšæœºå˜é‡çš„æœ€å¤§å€¼æ”¶æ•›åˆ°ä¸‰ç§åˆ†å¸ƒä¹‹ä¸€ï¼š
1. <strong>Gumbel åˆ†å¸ƒ</strong>ï¼ˆæŒ‡æ•°å°¾ï¼‰
2. FrÃ©chet åˆ†å¸ƒï¼ˆé‡å°¾ï¼‰
3. Weibull åˆ†å¸ƒï¼ˆæœ‰ç•Œï¼‰</p>
<p><strong>æ„ä¹‰</strong>ï¼šGumbel æ˜¯"è‡ªç„¶"çš„æœ€å¤§å€¼åˆ†å¸ƒï¼Œè¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆ Gumbel Max å¯¹åº” Softmaxå¦‚æ­¤å¸¸ç”¨ã€‚</p>
<h4 id="102-gibbs">10.2 Gibbs åˆ†å¸ƒçš„é‡å‚æ•°è§£é‡Š</h4>
<p>Softmax ä¹Ÿå¯ä»¥çœ‹ä½œ Gibbs åˆ†å¸ƒï¼š</p>
<p>$$p_i \propto e^{-E_i/T}$$</p>
<p>å…¶ä¸­ $E_i = -\mu_i$ æ˜¯"èƒ½é‡"ï¼Œ$T$ æ˜¯æ¸©åº¦ã€‚</p>
<p><strong>é‡å‚æ•°è§†è§’</strong>ï¼šåŠ  Gumbel å™ªå£° $\Leftrightarrow$ çƒ­åŠ›å­¦æ¶¨è½</p>
<h3 id="11_1">11. æ€»ç»“</h3>
<h4 id="_7">æ ¸å¿ƒè´¡çŒ®</h4>
<p>æœ¬æ–‡å±•ç¤ºäº†ä»é‡å‚æ•°åˆ°æ¦‚ç‡åˆ†å¸ƒçš„<strong>é€†å‘æ„é€ </strong>æ–¹æ³•ï¼š</p>
<p>$$\text{å™ªå£°åˆ†å¸ƒ } p(\varepsilon) \xrightarrow{\text{argmax}} \text{å½’ä¸€åŒ–æ–¹æ³• } \mathcal{T}(\boldsymbol{\mu})$$</p>
<h4 id="_8">å…³é”®å…¬å¼</h4>
<p>$$p_i = \int_{-\infty}^{\infty} p(\varepsilon_i) \prod_{j \neq i} \Phi(\mu_i - \mu_j + \varepsilon_i) \, d\varepsilon_i$$</p>
<h4 id="_9">ç‰¹æ®Šæƒ…å†µ</h4>
<ul>
<li><strong>Gumbel å™ªå£°</strong> â†’ Softmaxï¼ˆè§£æè§£ï¼‰</li>
<li><strong>æ­£æ€å™ªå£°</strong> â†’ æ¸©å’Œ Softmaxï¼ˆæ•°å€¼è§£ï¼‰</li>
<li><strong>å…¶ä»–å™ªå£°</strong> â†’ æ–°çš„å½’ä¸€åŒ–æ–¹æ³•</li>
</ul>
<h4 id="_10">æ„ä¹‰</h4>
<ol>
<li><strong>ç†è®º</strong>ï¼šç»Ÿä¸€äº†é‡å‚æ•°å’Œ Softmax</li>
<li><strong>å®è·µ</strong>ï¼šæä¾›äº† Softmax çš„å¯è°ƒæ¨å¹¿</li>
<li><strong>è§†è§’</strong>ï¼šå™ªå£° â†’ éšæœºæ€§ â†’ æ¦‚ç‡</li>
</ol>
        </div>
    </div>
</body>
</html>