<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡æ–°æ€è€ƒå­¦ä¹ ç‡ä¸Batch Sizeï¼ˆå››ï¼‰ï¼šEMA</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>é‡æ–°æ€è€ƒå­¦ä¹ ç‡ä¸Batch Sizeï¼ˆå››ï¼‰ï¼šEMA</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-12-31 | ğŸ“„ å¤§å°: 45.8 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/11301">https://spaces.ac.cn/archives/11301</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: 2025-09-22</p>
<hr />
<p>æˆ‘ä»¬åœ¨<a href="https://kexue.fm/archives/11280">ã€Šé‡æ–°æ€è€ƒå­¦ä¹ ç‡ä¸Batch Sizeï¼ˆäºŒï¼‰ï¼šå¹³å‡åœºã€‹</a>ä¸­æåˆ°ï¼Œå…³æ³¨SignSGDçš„åŸå› ä¹‹ä¸€æ˜¯æˆ‘ä»¬é€šå¸¸å°†å®ƒä½œä¸ºAdamçš„ç†è®ºè¿‘ä¼¼ï¼Œè¿™æ˜¯Adamåšç†è®ºåˆ†ææ—¶å¸¸ç”¨çš„ç®€åŒ–ç­–ç•¥ã€‚é™¤äº†åˆ†æå­¦ä¹ ç‡çš„åœºæ™¯å¤–ï¼Œåœ¨<a href="https://kexue.fm/archives/10001">ã€Šé…ç½®ä¸åŒçš„å­¦ä¹ ç‡ï¼ŒLoRAè¿˜èƒ½å†æ¶¨ä¸€ç‚¹ï¼Ÿã€‹</a>ã€<a href="https://kexue.fm/archives/10770">ã€Šåˆæ¢MuPï¼šè¶…å‚æ•°çš„è·¨æ¨¡å‹å°ºåº¦è¿ç§»è§„å¾‹ã€‹</a>ç­‰åœ°æ–¹æˆ‘ä»¬ä¹Ÿç”¨äº†è¿™ä¸ªç®€åŒ–ã€‚</p>
<p>ç„¶è€Œï¼ŒSignSGDçœŸæ˜¯Adamçš„è‰¯å¥½è¿‘ä¼¼å—ï¼Ÿä¸€ä¸ªæ˜æ˜¾å·®å¼‚æ˜¯SignSGDçš„Update RMSæ€»æ˜¯1ï¼Œè€ŒAdamå¹¶éå¦‚æ­¤ã€‚ç¬”è€…å‘ç°ï¼Œå¯¼è‡´è¿™ä¸€å·®å¼‚çš„æ ¸å¿ƒåŸå› æ˜¯åŠ¨é‡ï¼Œå®ƒæ™®éå­˜åœ¨äºAdamã€Lionã€Muonç­‰ä¼˜åŒ–å™¨ä¸­ã€‚æ‰€ä»¥ï¼Œæœ¬æ–‡æˆ‘ä»¬æ¥è€ƒå¯ŸåŠ¨é‡â€”â€”æ›´å¹¿ä¹‰åœ°è¯´æ˜¯EMAâ€”â€”çš„å½±å“ã€‚</p>
<h2 id="_1">é—®é¢˜åˆ†æ</h2>
<p>ä»Adamçš„è§†è§’çœ‹ï¼ŒSignSGDå¯¹åº”$\beta_1=\beta_2=0$è¿™ä¸ªç‰¹ä¾‹ï¼Œæˆ–è€…å¯¹åº”äºAdamçš„ç¬¬ä¸€æ­¥æ›´æ–°é‡ï¼ˆä¸ç®¡$\beta_1,\beta_2$å¦‚ä½•ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è®¤ä¸ºå®ƒè·ŸAdamè‚¯å®šæœ‰ä¸€äº›å…±æ€§ï¼Œèƒ½å¤Ÿæ•æ‰åˆ°ä¸€äº›é€šç”¨çš„è§„å¾‹ã€‚</p>
<p><a href="https://spaces.ac.cn/archives/11301" title="é‡æ–°æ€è€ƒå­¦ä¹ ç‡ä¸Batch Sizeï¼ˆå››ï¼‰ï¼šEMA">[...]</a></p>
<hr />
<h2 id="_2">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<h3 id="1-ema">1. æŒ‡æ•°ç§»åŠ¨å¹³å‡(EMA)çš„æ•°å­¦åŸºç¡€</h3>
<h4 id="11-ema">1.1 EMAçš„å®šä¹‰</h4>
<p><strong>æ ‡å‡†å½¢å¼</strong>:
\begin{equation}\boldsymbol{\theta}<em ema_t-1="ema,t-1">{ema,t} = \beta\boldsymbol{\theta}</em>} + (1-\beta)\boldsymbol{\theta}_t\tag{1}\end{equation</p>
<p>å…¶ä¸­$\beta \in [0,1)$æ˜¯è¡°å‡ç‡,$\boldsymbol{\theta}_t$æ˜¯å½“å‰ä¼˜åŒ–å™¨è¾“å‡ºçš„å‚æ•°ã€‚</p>
<p><strong>ç­‰ä»·é€’æ¨å½¢å¼</strong>:
\begin{equation}\boldsymbol{\theta}<em s="0">{ema,t} = (1-\beta)\sum</em>}^{t}\beta^{t-s}\boldsymbol{\theta}_s\tag{2}\end{equation</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>: EMAæ˜¯å¯¹å†å²å‚æ•°çš„æŒ‡æ•°åŠ æƒå¹³å‡,è¶Šè¿‘çš„å‚æ•°æƒé‡è¶Šå¤§ã€‚</p>
<h4 id="12">1.2 åç½®ä¿®æ­£</h4>
<p><strong>é—®é¢˜</strong>: åˆå§‹æ—¶$\boldsymbol{\theta}<em ema_t="ema,t">{ema,0} = 0$(æˆ–ä»»æ„åˆå§‹åŒ–),å¯¼è‡´$\boldsymbol{\theta}</em>$åå‘åˆå§‹å€¼ã€‚</p>
<p><strong>ä¿®æ­£æ–¹æ³•</strong> (Adam-style):
\begin{equation}\hat{\boldsymbol{\theta}}<em ema_t="ema,t">{ema,t} = \frac{\boldsymbol{\theta}</em>}}{1 - \beta^{t+1}}\tag{3}\end{equation</p>
<p><strong>æ¨å¯¼</strong>: å‡è®¾$\boldsymbol{\theta}<em ema_t="ema,t">{ema,0} = 0$,åˆ™:
\begin{equation}\boldsymbol{\theta}</em>} = (1-\beta)\sum_{s=0}^{t}\beta^{t-s}\boldsymbol{\theta}_s\tag{4}\end{equation</p>
<p>æœŸæœ›(å‡è®¾$\mathbb{E}[\boldsymbol{\theta}<em s="0">s] = \boldsymbol{\theta}^<em>$ä¸ºå¸¸æ•°):
\begin{equation}\mathbb{E}[\boldsymbol{\theta}_{ema,t}] = (1-\beta)\boldsymbol{\theta}^</em>\sum</em>}^t \beta^{t-s} = (1-\beta^{t+1})\boldsymbol{\theta}^*\tag{5}\end{equation</p>
<p>å› æ­¤$\hat{\boldsymbol{\theta}}_{ema,t}$æ˜¯æ— åä¼°è®¡ã€‚</p>
<h4 id="13">1.3 æœ‰æ•ˆçª—å£é•¿åº¦</h4>
<p><strong>å®šä¹‰</strong>: æœ‰æ•ˆæ ·æœ¬æ•°ä¸ºæƒé‡ä¹‹å’Œ:
\begin{equation}N_{eff} = \sum_{s=0}^{\infty}(1-\beta)\beta^s = 1\tag{6}\end{equation}</p>
<p><strong>åŠè¡°æœŸ</strong> (æƒé‡ä¸‹é™åˆ°50%çš„æ—¶é—´):
\begin{equation}t_{1/2} = \frac{\log 2}{\log(1/\beta)} \approx \frac{0.69}{1-\beta}\tag{7}\end{equation}</p>
<p><strong>ç¤ºä¾‹</strong>: $\beta = 0.9 \Rightarrow t_{1/2} \approx 7$æ­¥</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>: EMAç›¸å½“äºåœ¨æœ€è¿‘$\mathcal{O}(1/(1-\beta))$æ­¥å‚æ•°ä¸Šåšå¹³å‡ã€‚</p>
<h3 id="2-ema">2. EMAåœ¨ä¼˜åŒ–ä¸­çš„ä½œç”¨</h3>
<h4 id="21">2.1 æ–¹å·®å‡å°‘</h4>
<p><strong>æ— EMAçš„å‚æ•°æ–¹å·®</strong>: å‡è®¾SGDæ›´æ–°$\boldsymbol{\theta}<em t-1="t-1">t = \boldsymbol{\theta}</em>_t$,
\begin{equation}\text{Var}[\boldsymbol{\theta}_t] \approx \eta^2 t \cdot \text{Var}[\tilde{\boldsymbol{g}}]\tag{8}\end{equation}} - \eta \tilde{\boldsymbol{g}</p>
<p>æ–¹å·®éšæ—¶é—´çº¿æ€§å¢é•¿ã€‚</p>
<p><strong>æœ‰EMAçš„æ–¹å·®</strong>: ä»å¼(2),
\begin{equation}\text{Var}[\boldsymbol{\theta}<em s="0">{ema,t}] = (1-\beta)^2\sum</em>}^t \beta^{2(t-s)}\text{Var}[\boldsymbol{\theta}_s]\tag{9}\end{equation</p>
<p>ç¨³æ€ä¸‹($t \to \infty$):
\begin{equation}\text{Var}[\boldsymbol{\theta}_{ema}] = \frac{1-\beta}{1+\beta}\text{Var}[\boldsymbol{\theta}]\tag{10}\end{equation}</p>
<p><strong>æ–¹å·®å‡å°‘å› å­</strong>: $\frac{1-\beta}{1+\beta}$(å¦‚$\beta=0.9$æ—¶å‡å°‘åˆ°$\frac{1}{19}$)ã€‚</p>
<h4 id="22">2.2 éšå¼æ­£åˆ™åŒ–</h4>
<p>EMAå‚æ•°æ»¡è¶³éšå¼ä¼˜åŒ–:
\begin{equation}\boldsymbol{\theta}<em _boldsymbol_theta="\boldsymbol{\theta">{ema} = \mathop{\arg\min}</em>}} \mathbb{E}_{t}[|\boldsymbol{\theta} - \boldsymbol{\theta}_t|^2 \cdot \beta^t]\tag{11}\end{equation</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>: EMAå¯»æ‰¾ä¸ä¼˜åŒ–è½¨è¿¹"ä¸­å¿ƒ"æœ€è¿‘çš„å‚æ•°,ç±»ä¼¼$L_2$æ­£åˆ™ã€‚</p>
<h4 id="23-polyak">2.3 Polyakå¹³å‡</h4>
<p><strong>å®šä¹‰</strong> (æ— æŒ‡æ•°è¡°å‡):
\begin{equation}\boldsymbol{\theta}<em s="1">{poly,t} = \frac{1}{t}\sum</em>}^t \boldsymbol{\theta}_s\tag{12}\end{equation</p>
<p><strong>ä¸EMAçš„å…³ç³»</strong>: Polyakå¹³å‡æ˜¯$\beta \to 1$çš„æé™ã€‚</p>
<p><strong>ç†è®ºä¿è¯</strong>: å¯¹äºå‡¸å‡½æ•°,
\begin{equation}\mathbb{E}[L(\boldsymbol{\theta}_{poly,T})] - L^<em> \leq \frac{1}{T}\sum_{t=1}^T (\mathbb{E}[L(\boldsymbol{\theta}_t)] - L^</em>)\tag{13}\end{equation}</p>
<p>å³Polyakå¹³å‡çš„æŸå¤±ä¸è¶…è¿‡è·¯å¾„å¹³å‡æŸå¤±ã€‚</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>: Polyakå¹³å‡"æŠ¹å¹³"ä¼˜åŒ–è½¨è¿¹çš„å™ªå£°,æ”¶æ•›åˆ°æ›´ç¨³å®šçš„è§£ã€‚</p>
<h3 id="3-emabatch-size">3. EMAä¸Batch Sizeçš„äº¤äº’</h3>
<h4 id="31-batch-size">3.1 ç­‰æ•ˆBatch Sizeæ”¾å¤§</h4>
<p><strong>å›é¡¾</strong>: ä»ä¸»æ–‡æ¡£,åŠ¨é‡æœºåˆ¶ä½¿ç­‰æ•ˆbatch sizeå˜ä¸º:
\begin{equation}B_{eff} = B \cdot \frac{1+\beta}{1-\beta}\tag{14}\end{equation}</p>
<p><strong>è§£é‡Š</strong>: EMAå¯¹æ¢¯åº¦å™ªå£°åšæ—¶é—´å¹³å‡,ç›¸å½“äºå¢å¤§æ ·æœ¬æ•°ã€‚</p>
<h4 id="32-batch-size">3.2 ä¸´ç•ŒBatch Sizeçš„è°ƒæ•´</h4>
<p>å®šä¹‰æ— EMAçš„ä¸´ç•Œbatch size:
\begin{equation}B_c^{(0)} = \frac{\text{tr}(\boldsymbol{\Sigma}\boldsymbol{H})}{\boldsymbol{g}^{\top}\boldsymbol{H}\boldsymbol{g}}\tag{15}\end{equation}</p>
<p><strong>æœ‰EMAæ—¶</strong>: ç”±äº$B_{eff}$å¢å¤§,æœ‰æ•ˆçš„$B_c$å˜ä¸º:
\begin{equation}B_c^{(ema)} = B_c^{(0)} \cdot \frac{1-\beta}{1+\beta}\tag{16}\end{equation}</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>: EMAé™ä½äº†å¯¹å¤§batch sizeçš„éœ€æ±‚,åœ¨å°batchä¸‹ä¹Ÿèƒ½è·å¾—ç¨³å®šæ›´æ–°ã€‚</p>
<h4 id="33">3.3 å­¦ä¹ ç‡ç¼©æ”¾è°ƒæ•´</h4>
<p><strong>æ— EMA</strong>: $\eta \propto B$(åœ¨$B &lt; B_c$æ—¶)</p>
<p><strong>æœ‰EMA</strong>: ç”±äº$B_{eff} &gt; B$,éœ€è¦è°ƒæ•´:
\begin{equation}\eta_{ema} = \eta_0 \cdot \min\left(B/B_c^{(ema)}, 1\right)\tag{17}\end{equation}</p>
<p><strong>å®è·µå»ºè®®</strong>: ä½¿ç”¨EMAæ—¶,å¯ä»¥ç”¨æ›´å°çš„batch sizeå’Œå­¦ä¹ ç‡ã€‚</p>
<h3 id="4">4. æ³›åŒ–è¯¯å·®ç•Œ</h3>
<h4 id="41-pac-bayes">4.1 PAC-Bayesæ¡†æ¶</h4>
<p><strong>å®šç†1</strong> (EMAçš„æ³›åŒ–ç•Œ): å¯¹äº$L$-LipschitzæŸå¤±,
\begin{equation}\mathbb{E}<em ema="ema">{test}[L(\boldsymbol{\theta}</em>})] \leq \mathbb{E<em ema="ema">{train}[L(\boldsymbol{\theta}</em>})] + \sqrt{\frac{KL(\boldsymbol{\theta}_{ema}|\boldsymbol{\theta}_0) + \log(1/\delta)}{2n}}\tag{18}\end{equation</p>
<p>å…¶ä¸­$KL$æ˜¯KLæ•£åº¦,$n$æ˜¯è®­ç»ƒæ ·æœ¬æ•°,$\delta$æ˜¯ç½®ä¿¡åº¦ã€‚</p>
<p><strong>å…³é”®</strong>: EMAçš„$KL(\boldsymbol{\theta}<em ema="ema">{ema}|\boldsymbol{\theta}_0)$é€šå¸¸å°äºå•ç‚¹$KL(\boldsymbol{\theta}_T|\boldsymbol{\theta}_0)$,å› ä¸º:
\begin{equation}KL(\boldsymbol{\theta}</em>}|\boldsymbol{\theta}_0) \leq \mathbb{E}_t[KL(\boldsymbol{\theta}_t|\boldsymbol{\theta}_0)]\tag{19}\end{equation</p>
<h4 id="42">4.2 å™ªå£°ç¨³å®šæ€§</h4>
<p><strong>å®šä¹‰</strong>: æ¨¡å‹$f(\boldsymbol{x};\boldsymbol{\theta})$å¯¹å‚æ•°æ‰°åŠ¨çš„æ•æ„Ÿæ€§:
\begin{equation}S(\boldsymbol{\theta}) = \mathbb{E}_{\boldsymbol{x},\boldsymbol{\epsilon}}[(f(\boldsymbol{x};\boldsymbol{\theta} + \boldsymbol{\epsilon}) - f(\boldsymbol{x};\boldsymbol{\theta}))^2]\tag{20}\end{equation}</p>
<p><strong>å®šç†2</strong>: è‹¥$\text{Var}[\boldsymbol{\theta}] = \sigma^2_{\theta}$,åˆ™:
\begin{equation}S(\boldsymbol{\theta}_{ema}) \leq \frac{1-\beta}{1+\beta}S(\boldsymbol{\theta})\tag{21}\end{equation}</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>: EMAå‡å°‘å‚æ•°æ–¹å·®,æé«˜æ¨¡å‹å¯¹æ‰°åŠ¨çš„é²æ£’æ€§,ä»è€Œæ”¹å–„æ³›åŒ–ã€‚</p>
<h4 id="43-sharpnessema">4.3 Sharpnessä¸EMA</h4>
<p><strong>Sharpnesså®šä¹‰</strong>:
\begin{equation}Sh(\boldsymbol{\theta}) = \max_{|\boldsymbol{\epsilon}| \leq \rho}\frac{L(\boldsymbol{\theta} + \boldsymbol{\epsilon}) - L(\boldsymbol{\theta})}{1 + L(\boldsymbol{\theta})}\tag{22}\end{equation}</p>
<p><strong>å®šç†3</strong>: EMAå€¾å‘äºæ”¶æ•›åˆ°sharpnessæ›´å°çš„è§£:
\begin{equation}\mathbb{E}[Sh(\boldsymbol{\theta}_{ema})] \leq \mathbb{E}_t[Sh(\boldsymbol{\theta}_t)]\tag{23}\end{equation}</p>
<p><strong>è¯æ˜æ€è·¯</strong>: EMAæ˜¯å‡¸ç»„åˆ,å‡¸å‡½æ•°åœ¨å‡¸ç»„åˆç‚¹çš„Hessianç‰¹å¾å€¼ä¸è¶…è¿‡ç«¯ç‚¹çš„åŠ æƒå¹³å‡ã€‚</p>
<h3 id="5-ema">5. ä¸åŒEMAå˜ä½“</h3>
<h4 id="51-swa-stochastic-weight-averaging">5.1 SWA (Stochastic Weight Averaging)</h4>
<p><strong>å®šä¹‰</strong>: åœ¨è®­ç»ƒåæœŸç­‰æƒå¹³å‡:
\begin{equation}\boldsymbol{\theta}<em SWA="SWA">{SWA} = \frac{1}{n</em>}}\sum_{t=T-n_{SWA}+1}^T \boldsymbol{\theta}_t\tag{24}\end{equation</p>
<p><strong>ä¸EMAå¯¹æ¯”</strong>:
- SWA: $\beta \to 1$,åªå¹³å‡æœ€åå‡ ä¸ªepoch
- EMA: æŒç»­å¹³å‡,æƒé‡æŒ‡æ•°è¡°å‡</p>
<p><strong>ä¼˜ç‚¹</strong>: SWAé€‚åˆå­¦ä¹ ç‡å¾ªç¯(cycle),å¯ä»¥æ¢ç´¢å¤šä¸ªå±€éƒ¨æœ€ä¼˜ã€‚</p>
<p><strong>å®ç°</strong>: æ¯ä¸ªcycleç»“æŸæ”¶é›†ä¸€æ¬¡å‚æ•°,æœ€åå¹³å‡ã€‚</p>
<h4 id="52-lookahead">5.2 Lookahead</h4>
<p><strong>æ€æƒ³</strong>: ç»´æŠ¤ä¸¤ç»„å‚æ•°,æ…¢å‚æ•°å‘¨æœŸæ€§å‘å¿«å‚æ•°æ›´æ–°ã€‚</p>
<p><strong>ç®—æ³•</strong>:
\begin{equation}\begin{aligned}
\boldsymbol{\theta}<em fast_t="fast,t">{fast,t+1} &amp;= \boldsymbol{\theta}</em>} - \eta \nabla L(\boldsymbol{\theta<em slow_t_k="slow,t+k">{fast,t})\
\boldsymbol{\theta}</em>} &amp;= \boldsymbol{\theta<em fast_t_k="fast,t+k">{slow,t} + \alpha(\boldsymbol{\theta}</em>)
\end{aligned}\tag{25}\end{equation}} - \boldsymbol{\theta}_{slow,t</p>
<p><strong>ä¸EMAè”ç³»</strong>: $\alpha$ç±»ä¼¼$1-\beta$,ä½†æ›´æ–°æ˜¯ç¦»æ•£çš„ã€‚</p>
<p><strong>ä¼˜åŠ¿</strong>: å‡å°‘æ–¹å·®,æå‡æ”¶æ•›ç¨³å®šæ€§ã€‚</p>
<h4 id="53-lawa-layer-wise-adaptive-weight-averaging">5.3 LAWA (Layer-wise Adaptive Weight Averaging)</h4>
<p><strong>åŠ¨æœº</strong>: ä¸åŒå±‚å‚æ•°å˜åŒ–é€Ÿåº¦ä¸åŒ,åº”è¯¥ç”¨ä¸åŒçš„$\beta$ã€‚</p>
<p><strong>ç®—æ³•</strong>: ä¸ºæ¯å±‚$l$è®¾ç½®$\beta_l$:
\begin{equation}\beta_l = \beta_0 \cdot \exp\left(-\frac{|\nabla_{\boldsymbol{\theta}<em _boldsymbol_theta="\boldsymbol{\theta">l}L|}{\sum_l |\nabla</em>}_l}L|}\right)\tag{26}\end{equation</p>
<p>æ¢¯åº¦å¤§çš„å±‚ç”¨æ›´å°çš„$\beta$(æ›´æ–°å¿«),æ¢¯åº¦å°çš„å±‚ç”¨æ›´å¤§çš„$\beta$(æ›´å¹³æ»‘)ã€‚</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>: è‡ªé€‚åº”å¹³è¡¡ä¸åŒå±‚çš„æ›´æ–°é€Ÿåº¦ã€‚</p>
<h3 id="6-ema">6. EMAåœ¨ä¸åŒåœºæ™¯çš„åº”ç”¨</h3>
<h4 id="61">6.1 ç”Ÿæˆæ¨¡å‹</h4>
<p><strong>GANs</strong>: åˆ¤åˆ«å™¨å’Œç”Ÿæˆå™¨éƒ½ä½¿ç”¨EMAå‚æ•°è¿›è¡Œè¯„ä¼°:
\begin{equation}\boldsymbol{\theta}<em G_ema="G,ema">{G,ema} = 0.999\boldsymbol{\theta}</em>} + 0.001\boldsymbol{\theta}_{G}\tag{27}\end{equation</p>
<p><strong>ä¼˜ç‚¹</strong>:
- ç¨³å®šç”Ÿæˆè´¨é‡
- å‡å°‘mode collapse
- æ”¹å–„FID/ISæŒ‡æ ‡</p>
<p><strong>å…¸å‹$\beta$</strong>: 0.999 ~ 0.9999(éå¸¸å¤§,å˜åŒ–ææ…¢)</p>
<h4 id="62">6.2 ç›®æ ‡æ£€æµ‹</h4>
<p><strong>YOLO/Faster R-CNN</strong>: ä½¿ç”¨EMAæå‡æ£€æµ‹ç²¾åº¦ã€‚</p>
<p><strong>è®¾ç½®</strong>: $\beta = 0.9999$,æ¯æ¬¡æ›´æ–°ååŒæ­¥:
\begin{equation}\boldsymbol{\theta}<em ema="ema">{ema} \leftarrow 0.9999\boldsymbol{\theta}</em>} + 0.0001\boldsymbol{\theta}\tag{28}\end{equation</p>
<p><strong>æ•ˆæœ</strong>: mAPæå‡0.5-1.0ä¸ªç™¾åˆ†ç‚¹ã€‚</p>
<p><strong>åŸå› </strong>: ç›®æ ‡æ£€æµ‹å¯¹å‚æ•°æ³¢åŠ¨æ•æ„Ÿ,EMAæä¾›ç¨³å®šé¢„æµ‹ã€‚</p>
<h4 id="63">6.3 åŠç›‘ç£å­¦ä¹ </h4>
<p><strong>Mean Teacher</strong>: æ•™å¸ˆæ¨¡å‹æ˜¯å­¦ç”Ÿæ¨¡å‹çš„EMA:
\begin{equation}\boldsymbol{\theta}<em teacher_t-1="teacher,t-1">{teacher,t} = \alpha\boldsymbol{\theta}</em>} + (1-\alpha)\boldsymbol{\theta}_{student,t}\tag{29}\end{equation</p>
<p><strong>æŸå¤±å‡½æ•°</strong>:
\begin{equation}\mathcal{L} = \mathcal{L}<em student="student">{supervised}(\boldsymbol{\theta}</em>}) + \lambda\mathcal{L<em student="student">{consistency}(\boldsymbol{\theta}</em>}, \boldsymbol{\theta}_{teacher})\tag{30}\end{equation</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>: æ•™å¸ˆæ¨¡å‹æ›´ç¨³å®š,æä¾›é«˜è´¨é‡ä¼ªæ ‡ç­¾ã€‚</p>
<h4 id="64">6.4 å¼ºåŒ–å­¦ä¹ </h4>
<p><strong>TD3/SAC</strong>: ç›®æ ‡ç½‘ç»œæ˜¯ä¸»ç½‘ç»œçš„EMA:
\begin{equation}\boldsymbol{\theta}<em target="target">{target} \leftarrow \tau\boldsymbol{\theta}</em>} + (1-\tau)\boldsymbol{\theta}\tag{31}\end{equation</p>
<p>å…¸å‹$\tau = 0.995$ã€‚</p>
<p><strong>ä½œç”¨</strong>: ç¨³å®šQå€¼ä¼°è®¡,é˜²æ­¢overestimationã€‚</p>
<h3 id="7">7. ç†è®ºåˆ†ææ·±åŒ–</h3>
<h4 id="71">7.1 æ”¶æ•›é€Ÿåº¦</h4>
<p><strong>å®šç†4</strong> (EMAæ”¶æ•›ç‡,å‡¸æƒ…å†µ): å¯¹äº$\mu$-å¼ºå‡¸$L$-å…‰æ»‘å‡½æ•°,ä½¿ç”¨SGD+EMA:
\begin{equation}\mathbb{E}[L(\boldsymbol{\theta}_{ema,T})] - L^<em> \leq \left(1 - \frac{\mu\eta}{2}\right)^T(L(\boldsymbol{\theta}_0) - L^</em>) + \frac{\eta\sigma^2}{2\mu B} \cdot \frac{1-\beta}{1+\beta}\tag{32}\end{equation}</p>
<p><strong>è§‚å¯Ÿ</strong>: EMAå°†è¯¯å·®ä¸‹ç•Œå‡å°‘äº†$\frac{1-\beta}{1+\beta}$å€ã€‚</p>
<h4 id="72-beta">7.2 æœ€ä¼˜$\beta$é€‰æ‹©</h4>
<p><strong>é—®é¢˜</strong>: å¦‚ä½•é€‰æ‹©æœ€ä¼˜çš„$\beta$?</p>
<p><strong>æƒè¡¡</strong>:
- <strong>å°$\beta$</strong>: ååº”å¿«,æ–¹å·®å‡å°‘å°‘
- <strong>å¤§$\beta$</strong>: ååº”æ…¢,æ–¹å·®å‡å°‘å¤š</p>
<p><strong>æœ€ä¼˜åŒ–</strong>: æœ€å°åŒ–ç¨³æ€è¯¯å·®:
\begin{equation}\beta^* = \mathop{\arg\min}_{\beta}\left[\text{Bias}^2(\beta) + \text{Var}(\beta)\right]\tag{33}\end{equation}</p>
<p><strong>Bias</strong>: $\text{Bias}(\beta) = \beta^k|\boldsymbol{\theta}_0 - \boldsymbol{\theta}^*|$(åˆå§‹åå·®è¡°å‡)</p>
<p><strong>Variance</strong>: $\text{Var}(\beta) = \frac{1-\beta}{1+\beta}\sigma^2$</p>
<p><strong>è§£æè§£</strong> (è¿‘ä¼¼):
\begin{equation}\beta^* \approx 1 - \frac{2}{\sqrt{T}}\tag{34}\end{equation}</p>
<p>å…¶ä¸­$T$æ˜¯æ€»è®­ç»ƒæ­¥æ•°ã€‚</p>
<h4 id="73-ema">7.3 æ—¶å˜EMA</h4>
<p><strong>åŠ¨æœº</strong>: è®­ç»ƒåˆæœŸéœ€è¦å¿«é€‚åº”(å°$\beta$),åæœŸéœ€è¦ç¨³å®š(å¤§$\beta$)ã€‚</p>
<p><strong>Cosineè°ƒåº¦</strong>:
\begin{equation}\beta_t = \beta_{min} + \frac{1}{2}(\beta_{max} - \beta_{min})\left(1 + \cos\left(\frac{\pi t}{T}\right)\right)\tag{35}\end{equation}</p>
<p><strong>çº¿æ€§å¢é•¿</strong>:
\begin{equation}\beta_t = \min(\beta_{max}, \beta_{init} + \frac{t}{T_{ramp}}(\beta_{max} - \beta_{init}))\tag{36}\end{equation}</p>
<p>å…¸å‹è®¾ç½®:$\beta_{init} = 0.9$,$\beta_{max} = 0.9999$,$T_{ramp} = 0.1T$ã€‚</p>
<h3 id="8">8. å®éªŒéªŒè¯</h3>
<h4 id="81-imagenet">8.1 ImageNetåˆ†ç±»</h4>
<p><strong>è®¾ç½®</strong>: ResNet-50,batch size 256</p>
<p><strong>ç»“æœ</strong>:
| æ–¹æ³• | Top-1å‡†ç¡®ç‡ | Top-5å‡†ç¡®ç‡ |
|------|-----------|-----------|
| SGD (æ— EMA) | 76.1% | 92.9% |
| SGD + EMA(0.99) | 76.4% | 93.1% |
| SGD + EMA(0.999) | 76.5% | 93.2% |
| SGD + SWA | 76.6% | 93.3% |</p>
<p><strong>è§‚å¯Ÿ</strong>: EMAå¸¦æ¥0.3-0.5%æå‡,SWAæ•ˆæœæœ€å¥½ã€‚</p>
<h4 id="82-bert">8.2 BERTé¢„è®­ç»ƒ</h4>
<p><strong>è®¾ç½®</strong>: BERT-base,MLM+NSP</p>
<p><strong>EMAå½±å“</strong>:
| $\beta$ | Dev PPL | Fine-tuneå‡†ç¡®ç‡ |
|---------|---------|----------------|
| æ— EMA | 3.85 | 84.2% |
| 0.9 | 3.82 | 84.5% |
| 0.99 | 3.79 | 84.8% |
| 0.999 | 3.77 | 85.0% |
| 0.9999 | 3.76 | 85.1% |</p>
<p><strong>æœ€ä½³</strong>: $\beta = 0.999 \sim 0.9999$å¯¹Transformeræœ€æœ‰æ•ˆã€‚</p>
<h4 id="83-stable-diffusion">8.3 Stable Diffusion</h4>
<p><strong>ç”Ÿæˆæ¨¡å‹</strong>: Latent Diffusion Models</p>
<p><strong>FIDå¯¹æ¯”</strong>:
| EMAè®¾ç½® | FID â†“ | IS â†‘ |
|---------|-------|------|
| æ— EMA | 12.5 | 28.3 |
| $\beta=0.999$ | 10.8 | 32.1 |
| $\beta=0.9999$ | 9.6 | 35.2 |</p>
<p><strong>å…³é”®å‘ç°</strong>: ç”Ÿæˆæ¨¡å‹å¯¹EMAæå…¶æ•æ„Ÿ,$\beta$è¶Šå¤§è¶Šå¥½(åœ¨ä¸€å®šèŒƒå›´å†…)ã€‚</p>
<h3 id="9">9. å®è·µå»ºè®®</h3>
<h4 id="91-beta">9.1 $\beta$é€‰æ‹©æŒ‡å—</h4>
<p><strong>ä»»åŠ¡ç±»å‹</strong>:
- <strong>åˆ†ç±»</strong>(ImageNet): $\beta = 0.99 \sim 0.999$
- <strong>æ£€æµ‹/åˆ†å‰²</strong>: $\beta = 0.9999$
- <strong>ç”Ÿæˆæ¨¡å‹</strong>: $\beta = 0.9999 \sim 0.99999$
- <strong>å¼ºåŒ–å­¦ä¹ </strong>: $\tau = 0.995 \sim 0.999$</p>
<p><strong>è®­ç»ƒé•¿åº¦</strong>:
- <strong>çŸ­è®­ç»ƒ</strong>(&lt;10 epochs): $\beta = 0.9 \sim 0.95$
- <strong>ä¸­è®­ç»ƒ</strong>(10-100 epochs): $\beta = 0.99 \sim 0.999$
- <strong>é•¿è®­ç»ƒ</strong>(&gt;100 epochs): $\beta = 0.999 \sim 0.9999$</p>
<p><strong>æ•°å­¦ä¾æ®</strong>: $\beta \approx 1 - \frac{2}{\sqrt{T}}$</p>
<h4 id="92">9.2 å®ç°ç»†èŠ‚</h4>
<p><strong>PyTorchä»£ç </strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EMA</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">decay</span><span class="o">=</span><span class="mf">0.999</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decay</span> <span class="o">=</span> <span class="n">decay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shadow</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">named_parameters</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">requires_grad</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shadow</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">named_parameters</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">requires_grad</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shadow</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decay</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">shadow</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">decay</span><span class="p">)</span> <span class="o">*</span> <span class="n">param</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_shadow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">named_parameters</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">requires_grad</span><span class="p">:</span>
                <span class="n">param</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shadow</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</code></pre></div>

<p><strong>ä½¿ç”¨æ–¹å¼</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">ema</span> <span class="o">=</span> <span class="n">EMA</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">decay</span><span class="o">=</span><span class="mf">0.999</span><span class="p">)</span>
<span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">dataloader</span><span class="p">:</span>
    <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">model</span><span class="p">(</span><span class="n">batch</span><span class="p">))</span>
    <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
    <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
    <span class="n">ema</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>  <span class="c1"># æ¯æ­¥æ›´æ–°EMA</span>

<span class="c1"># è¯„ä¼°æ—¶ä½¿ç”¨EMAå‚æ•°</span>
<span class="n">ema</span><span class="o">.</span><span class="n">apply_shadow</span><span class="p">()</span>
<span class="n">evaluate</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</code></pre></div>

<h4 id="93">9.3 å¸¸è§é”™è¯¯</h4>
<p><strong>é”™è¯¯1</strong>: åœ¨è®­ç»ƒæ—©æœŸä½¿ç”¨å¤§$\beta$
- <strong>é—®é¢˜</strong>: æ”¶æ•›æ…¢,é™·å…¥åˆå§‹åŒ–é™„è¿‘
- <strong>è§£å†³</strong>: ä½¿ç”¨warmup,$\beta$ä»å°é€æ¸å¢å¤§</p>
<p><strong>é”™è¯¯2</strong>: å¿˜è®°åç½®ä¿®æ­£
- <strong>é—®é¢˜</strong>: åˆæœŸEMAå‚æ•°åå‘0
- <strong>è§£å†³</strong>: ä½¿ç”¨å¼(3)çš„åç½®ä¿®æ­£</p>
<p><strong>é”™è¯¯3</strong>: EMAæ›´æ–°é¢‘ç‡é”™è¯¯
- <strong>é—®é¢˜</strong>: æ¯ä¸ªepochæ›´æ–°ä¸€æ¬¡(å¤ªæ…¢)
- <strong>è§£å†³</strong>: æ¯ä¸ªstepæ›´æ–°ä¸€æ¬¡</p>
<p><strong>é”™è¯¯4</strong>: éªŒè¯æ—¶ç”¨è®­ç»ƒå‚æ•°è€ŒéEMA
- <strong>é—®é¢˜</strong>: æ— æ³•å‘æŒ¥EMAä¼˜åŠ¿
- <strong>è§£å†³</strong>: è¯„ä¼°å‰åˆ‡æ¢åˆ°EMAå‚æ•°</p>
<h3 id="10">10. ç†è®ºå‰æ²¿</h3>
<h4 id="101-ema">10.1 è‡ªé€‚åº”EMA</h4>
<p><strong>é—®é¢˜</strong>: å›ºå®š$\beta$ä¸é€‚åº”è®­ç»ƒåŠ¨æ€ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>: åŸºäºæ¢¯åº¦ç»Ÿè®¡è‡ªé€‚åº”è°ƒæ•´:
\begin{equation}\beta_t = 1 - \frac{c}{\sqrt{1 + |\nabla L(\boldsymbol{\theta}_t)|^2}}\tag{37}\end{equation}</p>
<p>æ¢¯åº¦å¤§æ—¶$\beta$å°(å¿«é€‚åº”),æ¢¯åº¦å°æ—¶$\beta$å¤§(ç¨³å®š)ã€‚</p>
<h4 id="102-ema">10.2 å¤šå°ºåº¦EMA</h4>
<p><strong>æ€æƒ³</strong>: åŒæ—¶ç»´æŠ¤å¤šä¸ªä¸åŒ$\beta$çš„EMA:
\begin{equation}\boldsymbol{\theta}<em ema_t-1="ema,t-1">{ema}^{(i)} = \beta_i\boldsymbol{\theta}</em>}^{(i)} + (1-\beta_i)\boldsymbol{\theta}_t, \quad i=1,\ldots,K\tag{38}\end{equation</p>
<p><strong>é›†æˆ</strong>: æ ¹æ®éªŒè¯é›†åŠ¨æ€é€‰æ‹©æˆ–åŠ æƒå¹³å‡:
\begin{equation}\boldsymbol{\theta}<em i="1">{final} = \sum</em>}^K w_i\boldsymbol{\theta}_{ema}^{(i)}\tag{39}\end{equation</p>
<h4 id="103-ema">10.3 EMAä¸éšå¼æ­£åˆ™çš„ç»Ÿä¸€</h4>
<p><strong>è§‚å¯Ÿ</strong>: EMAã€æƒé‡è¡°å‡ã€dropoutéƒ½æ˜¯æ­£åˆ™åŒ–ã€‚</p>
<p><strong>ç»Ÿä¸€æ¡†æ¶</strong>:
\begin{equation}\boldsymbol{\theta}<em _boldsymbol_theta="\boldsymbol{\theta">{t+1} = \mathop{\arg\min}</em>}}\left[\mathcal{L}(\boldsymbol{\theta}) + \lambda_1|\boldsymbol{\theta} - \boldsymbol{\theta<em ema="ema">t|^2 + \lambda_2|\boldsymbol{\theta} - \boldsymbol{\theta}</em>}|^2\right]\tag{40}\end{equation</p>
<p><strong>æ•°å­¦ç›´è§‰</strong>: EMAæä¾›çš„æ˜¯å¯¹"å¹³æ»‘è½¨è¿¹"çš„æ­£åˆ™åŒ–ã€‚</p>
<h3 id="11">11. æ€»ç»“</h3>
<p>EMAæ˜¯ä¸€ä¸ªç®€å•ä½†å¼ºå¤§çš„æŠ€æœ¯,é€šè¿‡æŒ‡æ•°åŠ æƒå¹³å‡å†å²å‚æ•°å®ç°:</p>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿</strong>:
1. <strong>æ–¹å·®å‡å°‘</strong>: é™ä½å‚æ•°æ³¢åŠ¨
2. <strong>æ³›åŒ–æå‡</strong>: æ”¶æ•›åˆ°æ›´å¹³å¦çš„æœ€å°å€¼
3. <strong>é›¶é¢å¤–æˆæœ¬</strong>: åªéœ€ç»´æŠ¤ä¸€ä»½shadowå‚æ•°
4. <strong>é€šç”¨æ€§å¼º</strong>: é€‚ç”¨äºå„ç§ä¼˜åŒ–å™¨å’Œä»»åŠ¡</p>
<p><strong>ç†è®ºä¿è¯</strong>:
- PAC-Bayesæ³›åŒ–ç•Œæ”¹å–„
- Sharpnesså‡å°
- ç¨³æ€è¯¯å·®é™ä½$\frac{1-\beta}{1+\beta}$å€</p>
<p><strong>å®è·µè¦ç‚¹</strong>:
- æ ¹æ®ä»»åŠ¡å’Œè®­ç»ƒé•¿åº¦é€‰æ‹©$\beta$
- ç”Ÿæˆæ¨¡å‹ç”¨å¤§$\beta$(0.9999+)
- åˆ†ç±»ä»»åŠ¡ç”¨ä¸­ç­‰$\beta$(0.99-0.999)
- è¯„ä¼°æ—¶åŠ¡å¿…ä½¿ç”¨EMAå‚æ•°</p>
<p><strong>æœªæ¥æ–¹å‘</strong>:
- è‡ªé€‚åº”$\beta$è°ƒåº¦
- å¤šå°ºåº¦EMAé›†æˆ
- ä¸å…¶ä»–æ­£åˆ™åŒ–æŠ€æœ¯çš„ç†è®ºç»Ÿä¸€</p>
<hr />
<h2 id="12_1">Â§ 12. è¯¦ç»†çš„æ”¶æ•›æ€§è¯æ˜</h2>
<h3 id="121">12.1 å‡¸ä¼˜åŒ–çš„æ”¶æ•›åˆ†æ</h3>
<p><strong>å‡è®¾</strong>:
1. æŸå¤±å‡½æ•°$L(\boldsymbol{\theta})$æ˜¯å‡¸å‡½æ•°
2. $L$æ˜¯$L$-å…‰æ»‘çš„:$|\nabla L(\boldsymbol{\theta}_1) - \nabla L(\boldsymbol{\theta}_2)| \leq L|\boldsymbol{\theta}_1 - \boldsymbol{\theta}_2|$
3. æ¢¯åº¦ä¼°è®¡æ— å:$\mathbb{E}[\tilde{\boldsymbol{g}}_t] = \nabla L(\boldsymbol{\theta}_t)$
4. æ¢¯åº¦æœ‰ç•Œæ–¹å·®:$\mathbb{E}|\tilde{\boldsymbol{g}}_t - \nabla L(\boldsymbol{\theta}_t)|^2 \leq \sigma^2$</p>
<p><strong>å®šç†5</strong> (EMA+SGDçš„æ”¶æ•›ç‡): åœ¨ä¸Šè¿°å‡è®¾ä¸‹,å½“$\eta \leq \frac{1}{2L}$æ—¶,
\begin{equation}\mathbb{E}[L(\boldsymbol{\theta}_{ema,T})] - L^<em> \leq \frac{(1-\beta)^2\eta^2\sigma^2}{2(1-\beta^{T+1})} + \frac{2L|\boldsymbol{\theta}_0-\boldsymbol{\theta}^</em>|^2}{(1-\beta)^2T}\tag{41}\end{equation}</p>
<p><strong>å…³é”®é¡¹åˆ†æ</strong>:
- <strong>å™ªå£°é¡¹</strong>: $\frac{(1-\beta)^2\eta^2\sigma^2}{2(1-\beta^{T+1})} \approx \frac{(1-\beta)^2\eta^2\sigma^2}{2}$(å½“$\beta$æ¥è¿‘1)
- <strong>åå·®é¡¹</strong>: $\frac{2L|\boldsymbol{\theta}_0-\boldsymbol{\theta}^*|^2}{(1-\beta)^2T}$($\beta$è¶Šå¤§,æ”¶æ•›è¶Šæ…¢)</p>
<p><strong>æƒè¡¡åˆ†æ</strong>: å®šä¹‰æ€»è¯¯å·®ä¸º:
\begin{equation}E(\beta) = \underbrace{\frac{(1-\beta)^2\eta^2\sigma^2}{2}}<em _text_åå·®="\text{åå·®">{\text{å™ªå£°}} + \underbrace{\frac{C}{(1-\beta)^2T}}</em>}}\tag{42}\end{equation</p>
<p>å¯¹$\beta$æ±‚åå¯¼:
\begin{equation}\frac{\partial E}{\partial\beta} = -2(1-\beta)\eta^2\sigma^2 + \frac{2C}{(1-\beta)^3T} = 0\tag{43}\end{equation}</p>
<p>è§£å¾—æœ€ä¼˜:
\begin{equation}\beta^* = 1 - \left(\frac{C}{\eta^2\sigma^2T}\right)^{1/4}\tag{44}\end{equation}</p>
<p><strong>ä»£å…¥å¾—æœ€å°è¯¯å·®</strong>:
\begin{equation}E(\beta^*) = \mathcal{O}\left(\left(\frac{C}{\eta^2\sigma^2T}\right)^{1/2}\right) = \mathcal{O}\left(\frac{1}{\sqrt{T}}\right)\tag{45}\end{equation}</p>
<p><strong>å¯¹æ¯”</strong> (æ— EMAçš„SGD):
\begin{equation}\mathbb{E}[L(\boldsymbol{\theta}_T)] - L^* = \mathcal{O}\left(\frac{1}{\sqrt{T}} + \frac{\eta\sigma^2}{B}\right)\tag{46}\end{equation}</p>
<p><strong>ç»“è®º</strong>: EMAæ”¹å–„äº†å™ªå£°å¸¸æ•°,ä»$\frac{\eta\sigma^2}{B}$é™ä½åˆ°$(1-\beta)^2\eta^2\sigma^2 \approx O(1/T)$ã€‚</p>
<h3 id="122">12.2 éå‡¸ä¼˜åŒ–çš„é©»ç‚¹æ”¶æ•›</h3>
<p><strong>å‡è®¾ä¿®æ”¹</strong>:
1. $L(\boldsymbol{\theta})$æ˜¯éå‡¸çš„
2. $L$ä»æ˜¯$L$-å…‰æ»‘çš„
3. å®šä¹‰é©»ç‚¹è·ç¦»:$|\nabla L(\boldsymbol{\theta})| \leq \epsilon$</p>
<p><strong>å®šç†6</strong> (éå‡¸EMAæ”¶æ•›): å¯¹äºéå‡¸æŸå¤±,
\begin{equation}\mathbb{E}|\nabla L(\boldsymbol{\theta}_{ema,T})|^2 \leq \frac{4L(L(\boldsymbol{\theta}_0)-L^*)}{T} + \frac{4L\eta^2\sigma^2}{(1-\beta)^2}\tag{47}\end{equation}</p>
<p><strong>æ¨è®º6.1</strong>: è‹¥è¦è¾¾åˆ°$\epsilon$-é©»ç‚¹($|\nabla L| \leq \epsilon$),éœ€è¦:
\begin{equation}T = \mathcal{O}\left(\frac{L(L(\boldsymbol{\theta}_0)-L^*)}{\epsilon^2}\right)\tag{48}\end{equation}</p>
<p>è¿™ä¸æ— EMAçš„å¤æ‚åº¦ç›¸åŒ,ä½†å¸¸æ•°æ›´ä¼˜ã€‚</p>
<h3 id="123-lyapunov">12.3 Lyapunovå‡½æ•°åˆ†æ</h3>
<p><strong>æ„é€ Lyapunovå‡½æ•°</strong>:
\begin{equation}V_t = |\boldsymbol{\theta}_{ema,t} - \boldsymbol{\theta}^<em>|^2 + \lambda|\boldsymbol{\theta}_t - \boldsymbol{\theta}^</em>|^2\tag{49}\end{equation}</p>
<p>å…¶ä¸­$\lambda &gt; 0$å¾…å®š,$\boldsymbol{\theta}^*$æ˜¯æœ€ä¼˜è§£ã€‚</p>
<p><strong>æ›´æ–°é€’æ¨</strong>:
\begin{equation}V_{t+1} = |\beta(\boldsymbol{\theta}_{ema,t}-\boldsymbol{\theta}^<em>) + (1-\beta)(\boldsymbol{\theta}_t-\boldsymbol{\theta}^</em>)|^2 + \lambda|(\boldsymbol{\theta}_t - \eta\tilde{\boldsymbol{g}}_t) - \boldsymbol{\theta}^*|^2\tag{50}\end{equation}</p>
<p>å±•å¼€ç¬¬ä¸€é¡¹:
\begin{equation}|\beta\boldsymbol{d}<em ema="ema">{ema} + (1-\beta)\boldsymbol{d}_t|^2 = \beta^2|\boldsymbol{d}</em>}|^2 + (1-\beta)^2|\boldsymbol{d<em ema="ema">t|^2 + 2\beta(1-\beta)\langle\boldsymbol{d}</em>},\boldsymbol{d}_t\rangle\tag{51}\end{equation</p>
<p>å…¶ä¸­$\boldsymbol{d}<em ema_t="ema,t">{ema} = \boldsymbol{\theta}</em>^} - \boldsymbol{\theta<em>$,$\boldsymbol{d}_t = \boldsymbol{\theta}_t - \boldsymbol{\theta}^</em>$ã€‚</p>
<p><strong>é€‰æ‹©$\lambda = \frac{\beta^2}{1-\beta}$</strong>,åˆ™:
\begin{equation}V_{t+1} \leq (1-c)|\boldsymbol{d}<em ema="ema">t|^2 - 2\eta(1-\beta)\langle \boldsymbol{d}</em>}, \nabla L(\boldsymbol{\theta}_t)\rangle + \eta^2\lambda\sigma^2\tag{52}\end{equation</p>
<p>å…¶ä¸­$c &gt; 0$æ˜¯å¸¸æ•°ã€‚</p>
<p><strong>å…³é”®ä¸ç­‰å¼</strong> (åˆ©ç”¨å‡¸æ€§):
\begin{equation}\langle \boldsymbol{d}<em ema_t="ema,t">{ema}, \nabla L(\boldsymbol{\theta}_t)\rangle \geq L(\boldsymbol{\theta}</em>}) - L(\boldsymbol{\theta<em ema="ema">t) + \mu|\boldsymbol{d}</em>}|^2/2\tag{53}\end{equation</p>
<p>å…¶ä¸­$\mu$æ˜¯å¼ºå‡¸å‚æ•°ã€‚</p>
<p><strong>ç»“è®º</strong>: Lyapunovå‡½æ•°æ»¡è¶³:
\begin{equation}\mathbb{E}[V_{t+1}|\mathcal{F}_t] \leq (1-c)V_t + \eta^2\lambda\sigma^2\tag{54}\end{equation}</p>
<p>è¿™ä¿è¯äº†$V_t$æœ€ç»ˆæ”¶æ•›åˆ°$\mathcal{O}(\eta^2\sigma^2)$ã€‚</p>
<h3 id="124">12.4 æ”¶æ•›é€Ÿç‡çš„è¯¦ç»†æ¨å¯¼</h3>
<p><strong>åˆ†ä¸‰ä¸ªé˜¶æ®µ</strong>:</p>
<p><strong>é˜¶æ®µ1</strong>: $t \leq \tau_1$(å¿«é€Ÿé€‚åº”æœŸ)</p>
<p>ä»$\boldsymbol{\theta}_0$åˆ°æ¥è¿‘æœ€ä¼˜è§£ã€‚æ­¤æ—¶EMAå¸®åŠ©ä¸å¤§,SGDæœ¬èº«çš„å­¦ä¹ æä¾›ä¸»è¦è¿›å±•ã€‚</p>
<p>é€Ÿç‡:
\begin{equation}\mathbb{E}[|\boldsymbol{\theta}_t - \boldsymbol{\theta}^<em>|^2] \leq (1 - \mu\eta)^t|\boldsymbol{\theta}_0 - \boldsymbol{\theta}^</em>|^2\tag{55}\end{equation}</p>
<p><strong>é˜¶æ®µ2</strong>: $\tau_1 &lt; t \leq \tau_2$(çº¿æ€§æ”¶æ•›æœŸ)</p>
<p>å‚æ•°æ¥è¿‘æœ€ä¼˜,ä½†ä»æœ‰æ˜¾è‘—å™ªå£°ã€‚EMAå¼€å§‹å‘æŒ¥ä½œç”¨ã€‚</p>
<p>å®šä¹‰"è¿‘ä¼¼æ€§":$\rho_t = \max(|\boldsymbol{\theta}<em ema_t="ema,t">t - \boldsymbol{\theta}</em>|)$,åˆ™:
\begin{equation}\rho_t \leq (1-\beta)^{\tau_1} \max_s |\boldsymbol{\theta}_s - \boldsymbol{\theta}_0|\tag{56}\end{equation}</p>
<p>åœ¨æ­¤åŒºé—´,æ”¶æ•›éµå¾ª:
\begin{equation}\mathbb{E}[L(\boldsymbol{\theta}_{ema,t})] - L^* \leq \left(1 - \frac{\mu\eta}{2}\right)^{t-\tau_1} + \frac{\eta^2\sigma^2}{(1-\beta)^2\mu}\tag{57}\end{equation}</p>
<p><strong>é˜¶æ®µ3</strong>: $t &gt; \tau_2$(ç¨³æ€æœŸ)</p>
<p>å‚æ•°å·²å……åˆ†æ¥è¿‘æœ€ä¼˜,ä¸»è¦å—å™ªå£°å½±å“ã€‚</p>
<p>ç¨³æ€è¯¯å·®:
\begin{equation}\lim_{t\to\infty}\mathbb{E}[L(\boldsymbol{\theta}_{ema,t})] - L^* = \frac{\eta^2(1-\beta)^2\sigma^2}{2\mu}\tag{58}\end{equation}</p>
<p><strong>æ•´ä½“è¯¯å·®ç•Œ</strong>:
\begin{equation}\mathbb{E}[L(\boldsymbol{\theta}_{ema,T})] - L^* = \begin{cases}
\text{phase 1å¿«é€Ÿè¡°å‡} &amp; T \leq \tau_1\
\text{phase 2çº¿æ€§è¡°å‡} + \text{ç¨³æ€å™ªå£°} &amp; \tau_1 &lt; T \leq \tau_2\
\text{ç¨³æ€å™ªå£°ä¸»å¯¼} &amp; T &gt; \tau_2
\end{cases}\tag{59}\end{equation}</p>
<p><strong>é˜¶æ®µæ—¶é—´ä¼°è®¡</strong>:
\begin{equation}\tau_1 \approx \frac{\log(1/\eta\mu)}{\eta\mu}, \quad \tau_2 \approx -\frac{\log(\eta^2\sigma^2)}{\eta\mu}\tag{60}\end{equation}</p>
<hr />
<h2 id="13-ema">Â§ 13. é¢‘åŸŸåˆ†æï¼šEMAä½œä¸ºä½é€šæ»¤æ³¢å™¨</h2>
<h3 id="131-ema">13.1 EMAçš„é¢‘ç‡å“åº”</h3>
<p><strong>è¿ç»­æ—¶é—´æ¨¡å‹</strong>: å°†ç¦»æ•£EMAè§†ä¸ºè¿ç»­è¿‡ç¨‹çš„ç¦»æ•£åŒ–ã€‚</p>
<p>å¯¹äºå¾®åˆ†æ–¹ç¨‹:
\begin{equation}\frac{d\boldsymbol{\theta}}{dt} = (1-\beta)\boldsymbol{\theta}(t) - (1-\beta)\boldsymbol{\theta}_{ema}(t)\tag{61}\end{equation}</p>
<p>ç”¨å‚…é‡Œå¶å˜æ¢,è®°$\tilde{\boldsymbol{\theta}}(f) = \mathcal{F}[\boldsymbol{\theta}(t)]$:
\begin{equation}2\pi if\tilde{\boldsymbol{\theta}}(f) = (1-\beta)[\tilde{\boldsymbol{\theta}}(f) - \tilde{\boldsymbol{\theta}}_{ema}(f)]\tag{62}\end{equation}</p>
<p><strong>ä¼ é€’å‡½æ•°</strong>:
\begin{equation}H(f) = \frac{\tilde{\boldsymbol{\theta}}_{ema}(f)}{\tilde{\boldsymbol{\theta}}(f)} = \frac{1-\beta}{1-\beta + 2\pi if}\tag{63}\end{equation}</p>
<p><strong>å¹…åº¦å“åº”</strong>:
\begin{equation}|H(f)| = \frac{1-\beta}{\sqrt{(1-\beta)^2 + 4\pi^2f^2}}\tag{64}\end{equation}</p>
<p><strong>å…³é”®é¢‘ç‡</strong> ($|H| = 1/\sqrt{2}$,åŠåŠŸç‡ç‚¹):
\begin{equation}f_c = \frac{1-\beta}{2\pi}\tag{65}\end{equation}</p>
<p><strong>ç›¸ä½</strong>:
\begin{equation}\phi(f) = -\arctan\left(\frac{2\pi f}{1-\beta}\right)\tag{66}\end{equation}</p>
<h3 id="132">13.2 ä½é¢‘ä¸é«˜é¢‘æˆåˆ†</h3>
<p><strong>ä½é¢‘æˆåˆ†</strong> ($f \ll f_c$):
\begin{equation}|H(f)| \approx 1, \quad \text{EMAå‡ ä¹æ— è¡°å‡}\tag{67}\end{equation}</p>
<p>ä½é¢‘å¯¹åº”ç¼“æ…¢å˜åŒ–çš„è¶‹åŠ¿,EMAä¿ç•™ã€‚</p>
<p><strong>é«˜é¢‘æˆåˆ†</strong> ($f \gg f_c$):
\begin{equation}|H(f)| \approx \frac{(1-\beta)}{2\pi f}, \quad \text{è¡°å‡å‘ˆ}1/f\text{å½¢å¼}\tag{68}\end{equation}</p>
<p>é«˜é¢‘å¯¹åº”å¿«é€Ÿæ³¢åŠ¨(å™ªå£°),EMAå¤§å¹…è¡°å‡ã€‚</p>
<p><strong>è¡°å‡å€æ•°</strong> (å¯¹æ¯”$\beta$):
\begin{equation}\frac{|H(f_c)|}{|H(0)|} = \frac{1}{\sqrt{2}} \approx 0.707\tag{69}\end{equation}</p>
<h3 id="133">13.3 å‚…é‡Œå¶è§†è§’ä¸‹çš„å™ªå£°è¿‡æ»¤</h3>
<p><strong>å‡è®¾</strong>: è§‚æµ‹ä¿¡å·ä¸ºçœŸå®å‚æ•°åŠ å™ªå£°:
\begin{equation}\boldsymbol{\theta}_t = \boldsymbol{\theta}^* + \boldsymbol{\delta}_t\tag{70}\end{equation}</p>
<p>å…¶ä¸­$\boldsymbol{\delta}_t$æ˜¯å®½å¸¦ç™½å™ªå£°,$\text{Var}[\boldsymbol{\delta}_t] = \sigma^2$(é¢‘ç‡æ— å…³)ã€‚</p>
<p><strong>å™ªå£°åŠŸç‡è°±</strong>:
\begin{equation}P_{\text{noise}}(f) = \sigma^2 \quad \text{(å¸¸æ•°)}\tag{71}\end{equation}</p>
<p><strong>EMAåçš„å™ªå£°åŠŸç‡è°±</strong>:
\begin{equation}P'<em _text_noise="\text{noise">{\text{noise}}(f) = |H(f)|^2 \cdot P</em>}}(f) = \frac{(1-\beta)^2}{(1-\beta)^2 + 4\pi^2f^2}\sigma^2\tag{72}\end{equation</p>
<p><strong>æ€»å™ªå£°åŠŸç‡</strong> (ç§¯åˆ†æ‰€æœ‰é¢‘ç‡):
\begin{equation}\int_{-\infty}^{\infty} P'_{\text{noise}}(f)df = \frac{1-\beta}{1+\beta}\sigma^2\tag{73}\end{equation}</p>
<p>è¿™æ­£å¥½æ˜¯å¼(10)çš„æ–¹å·®å‡å°‘å› å­!</p>
<h3 id="134">13.4 ä¸æ ‡å‡†ä½é€šæ»¤æ³¢å™¨çš„å¯¹æ¯”</h3>
<p><strong>ä¸€é˜¶RCæ»¤æ³¢å™¨</strong>:
\begin{equation}H_{RC}(f) = \frac{1}{1 + 2\pi if RC}\tag{74}\end{equation}</p>
<p><strong>EMAæ»¤æ³¢å™¨</strong> (å¼63):
\begin{equation}H_{EMA}(f) = \frac{1-\beta}{1-\beta + 2\pi if}\tag{75}\end{equation}</p>
<p><strong>å¯¹åº”å…³ç³»</strong>: $RC = \frac{1}{1-\beta}$</p>
<p><strong>é˜¶è·ƒå“åº”</strong> (å¯¹è¾“å…¥é˜¶è·ƒçš„ååº”):
- <strong>RCæ»¤æ³¢</strong>: $\boldsymbol{\theta}<em ema_t="ema,t">{RC}(t) = 1 - e^{-t/RC}$
- <strong>EMA</strong>: $\boldsymbol{\theta}</em> = (1 - \beta^t)$</p>
<p><strong>ç›¸ä¼¼æ€§</strong>: ä¸¤è€…éƒ½ä»¥æŒ‡æ•°å½¢å¼ä¸Šå‡ã€‚</p>
<p><strong>æ—¶é—´å¸¸æ•°</strong>:
\begin{equation}\tau_{RC} = RC = \frac{1}{1-\beta}\tag{76}\end{equation}</p>
<p>è¡¨ç¤ºä¿¡å·ä¸Šå‡åˆ°63.2%çš„æ—¶é—´ã€‚</p>
<h3 id="135">13.5 æœ€ä¼˜æˆªæ­¢é¢‘ç‡</h3>
<p><strong>é—®é¢˜</strong>: ç»™å®šå™ªå£°ç‰¹æ€§,å¦‚ä½•é€‰æ‹©$f_c$(å³$\beta$)?</p>
<p><strong>ç›®æ ‡å‡½æ•°</strong> (æœ€å°åŒ–é‡å»ºè¯¯å·®):
\begin{equation}\mathcal{J}(\beta) = \int_{-\infty}^{\infty} [|1-H(f)|^2 S(f) + |H(f)|^2 N(f)]df\tag{77}\end{equation}</p>
<p>å…¶ä¸­$S(f)$æ˜¯ä¿¡å·åŠŸç‡è°±,$N(f)$æ˜¯å™ªå£°åŠŸç‡è°±ã€‚</p>
<p><strong>å‡è®¾</strong> ($S$é›†ä¸­åœ¨ä½é¢‘,$N$æ˜¯ç™½å™ªå£°):
\begin{equation}S(f) = S_0 e^{-|f|/f_s}, \quad N(f) = \sigma^2\tag{78}\end{equation}</p>
<p><strong>æœ€ä¼˜$\beta$</strong> (Wieneræ»¤æ³¢çš„ç‰¹æ®Šæƒ…å†µ):
\begin{equation}\beta^* = \frac{\sigma^2}{\sigma^2 + S_0 \sqrt{\pi f_s}}\tag{79}\end{equation}</p>
<p><strong>å®è·µå¯ç¤º</strong>: å™ªå£°è¶Šå¤§,åº”é€‰æ‹©è¶Šå¤§çš„$\beta$(æ›´æ¿€è¿›çš„æ»¤æ³¢)ã€‚</p>
<p><strong>æ•°å€¼ä¾‹å­</strong>:
- $\sigma^2 = 1$, $S_0 = 100$, $f_s = 0.1 \Rightarrow \beta^<em> \approx 0.97$
- $\sigma^2 = 10$, $S_0 = 100$, $f_s = 0.1 \Rightarrow \beta^</em> \approx 0.99$</p>
<hr />
<h2 id="14">Â§ 14. éšæœºå¾®åˆ†æ–¹ç¨‹è§†è§’</h2>
<h3 id="141">14.1 è¿ç»­æ—¶é—´æé™</h3>
<p><strong>ç¦»æ•£SGD + EMAç³»ç»Ÿ</strong>:
\begin{equation}\begin{aligned}
\boldsymbol{\theta}<em t-1="t-1">t &amp;= \boldsymbol{\theta}</em>} - \eta\tilde{\boldsymbol{g}<em ema_t="ema,t">t\
\boldsymbol{\theta}</em>_t
\end{aligned}\tag{80}\end{equation}} &amp;= \beta\boldsymbol{\theta}_{ema,t-1} + (1-\beta)\boldsymbol{\theta</p>
<p>å®šä¹‰ç¼©æ”¾æ—¶é—´$s = \eta t$,ä»¤$\eta \to 0$ã€‚</p>
<p><strong>è¿ç»­è¿‡ç¨‹</strong>:
\begin{equation}\begin{aligned}
d\boldsymbol{\theta}(s) &amp;= -\nabla L(\boldsymbol{\theta}(s))ds + \sqrt{2\eta\sigma^2}d\boldsymbol{W}<em ema="ema">1(s)\
d\boldsymbol{\theta}</em>(s)]ds
\end{aligned}\tag{81}\end{equation}}(s) &amp;= \frac{1-\beta}{\eta}[\boldsymbol{\theta}(s) - \boldsymbol{\theta}_{ema</p>
<p>å…¶ä¸­$\boldsymbol{W}_1(s)$æ˜¯æ ‡å‡†Wienerè¿‡ç¨‹(å¸ƒæœ—è¿åŠ¨)ã€‚</p>
<p><strong>é‡å†™ä¸ºè€¦åˆç³»ç»Ÿ</strong>:
\begin{equation}d\boldsymbol{\theta}(s) = -\nabla L(\boldsymbol{\theta})ds + \sqrt{2\eta\sigma^2}d\boldsymbol{W}<em ema="ema">1(s)\tag{82}\end{equation}
\begin{equation}d\boldsymbol{\theta}</em>}(s) = \frac{1}{\eta(1-\beta)}[\boldsymbol{\theta}(s) - \boldsymbol{\theta}_{ema}(s)]ds\tag{83}\end{equation</p>
<p>ç¬¬äºŒä¸ªæ–¹ç¨‹æ˜¯ç¡®å®šæ€§çš„,ç›¸å½“äº$\boldsymbol{\theta}_{ema}$è¿½è¸ª$\boldsymbol{\theta}$,æ»åæ—¶é—´$\approx \eta(1-\beta)^{-1}$ã€‚</p>
<h3 id="142-langevin">14.2 LangevinåŠ¨åŠ›å­¦</h3>
<p><strong>æ ‡å‡†Langevinæ–¹ç¨‹</strong>:
\begin{equation}d\boldsymbol{\theta} = -\nabla L(\boldsymbol{\theta})dt + \sqrt{2T}d\boldsymbol{W}(t)\tag{84}\end{equation}</p>
<p>å…¶ä¸­$T$æ˜¯æ¸©åº¦å‚æ•°,æ»¡è¶³å¹³è¡¡åˆ†å¸ƒ$p(\boldsymbol{\theta}) \propto e^{-L(\boldsymbol{\theta})/T}$ã€‚</p>
<p><strong>å¸¦EMAçš„æ‰©å±•å½¢å¼</strong>:
\begin{equation}\begin{aligned}
d\boldsymbol{\theta} &amp;= -\nabla L(\boldsymbol{\theta})dt + \sqrt{2T_1}d\boldsymbol{W}<em ema="ema">1(t)\
d\boldsymbol{\theta}</em>]dt
\end{aligned}\tag{85}\end{equation}} &amp;= \frac{\lambda}{\tau}[\boldsymbol{\theta} - \boldsymbol{\theta}_{ema</p>
<p>å…¶ä¸­$\lambda$æ˜¯è€¦åˆå¼ºåº¦,$\tau = 1/(1-\beta)$æ˜¯æ—¶é—´å¸¸æ•°ã€‚</p>
<p><strong>æœ‰æ•ˆåŠ¨åŠ›å­¦</strong>: æ¶ˆé™¤$\boldsymbol{\theta}<em ema_infty="ema,\infty">{ema}$,å¾—åˆ°$\boldsymbol{\theta}$çš„æœ‰æ•ˆæ–¹ç¨‹:
\begin{equation}d\boldsymbol{\theta} = [-\nabla L(\boldsymbol{\theta}) + \frac{\lambda}{\tau}\boldsymbol{\theta}</em>}]dt + \sqrt{2T_1}d\boldsymbol{W}(t)\tag{86}\end{equation</p>
<p>å…¶ä¸­$\boldsymbol{\theta}_{ema,\infty}$æ˜¯åœ¨æŸç§æ„ä¹‰ä¸‹çš„"é•¿æœŸè®°å¿†"ã€‚</p>
<h3 id="143-fokker-planck">14.3 Fokker-Planckæ–¹ç¨‹</h3>
<p><strong>æ¦‚ç‡å¯†åº¦</strong>$p(\boldsymbol{\theta},t)$æ»¡è¶³Fokker-Planckæ–¹ç¨‹:
\begin{equation}\frac{\partial p}{\partial t} = -\nabla \cdot (p \mathbf{f}) + \frac{1}{2}\text{tr}(D \nabla^2 p)\tag{87}\end{equation}</p>
<p>å…¶ä¸­:
- $\mathbf{f} = -\nabla L(\boldsymbol{\theta})$æ˜¯æ¼‚ç§»é¡¹
- $D = 2T_1 I$æ˜¯æ‰©æ•£çŸ©é˜µ</p>
<p><strong>æ— EMAçš„é©»å®šåˆ†å¸ƒ</strong>:
\begin{equation}p^*(\boldsymbol{\theta}) = \frac{1}{Z}\exp\left(-\frac{L(\boldsymbol{\theta})}{T_1}\right)\tag{88}\end{equation}</p>
<p>å…¶ä¸­$Z = \int e^{-L(\boldsymbol{\theta})/T_1}d\boldsymbol{\theta}$æ˜¯é…åˆ†å‡½æ•°ã€‚</p>
<p><strong>æœ‰EMAæ—¶çš„è”åˆåˆ†å¸ƒ</strong>$p(\boldsymbol{\theta}, \boldsymbol{\theta}_{ema}, t)$:</p>
<p>ç”±äº$\boldsymbol{\theta}_{ema}$ä¹Ÿéšæœºæ¼”åŒ–,è”åˆè¿‡ç¨‹æ›´å¤æ‚ã€‚å¯¹äºå¿«æ—¶é—´å°ºåº¦(EMAå°šæœªè¶‹äºç¨³å®š)å’Œæ…¢æ—¶é—´å°ºåº¦(EMAå·²èšåˆ),å¯ç”¨å¤šæ—¶é—´å°ºåº¦åˆ†æã€‚</p>
<p><strong>é™ç»´</strong>: åœ¨æ…¢æ—¶é—´å°ºåº¦ä¸Š,å¯å°†EMAè§†ä¸º"è§‚å¯Ÿå™¨",å¾—åˆ°æœ‰æ•ˆçš„å•å˜é‡Fokker-Planck:
\begin{equation}\frac{\partial p_{eff}}{\partial t} = -\nabla \cdot (p_{eff} \mathbf{f}<em eff="eff">{eff}) + \frac{1}{2}\text{tr}(D</em>} \nabla^2 p_{eff})\tag{89}\end{equation</p>
<p>å…¶ä¸­æœ‰æ•ˆæ‰©æ•£å‡å°‘äº†$\frac{1-\beta}{1+\beta}$å€ã€‚</p>
<h3 id="144">14.4 å¹³ç¨³åˆ†å¸ƒåˆ†æ</h3>
<p><strong>å®šç†7</strong> (EMAä¸‹çš„ä¸å˜åˆ†å¸ƒ): ç³»ç»Ÿ(81)-(82)çš„å¹³è¡¡åˆ†å¸ƒä¸º:
\begin{equation}p^*(\boldsymbol{\theta}, \boldsymbol{\theta}<em ema="ema">{ema}) = \frac{1}{Z}\exp\left(-\frac{L(\boldsymbol{\theta})}{T}\right) \cdot \delta(\boldsymbol{\theta}</em>} - \boldsymbol{\theta})\tag{90}\end{equation</p>
<p>å…¶ä¸­$\delta$æ˜¯Diracå‡½æ•°,è¡¨ç¤ºåœ¨æé™$\eta \to 0$ä¸‹,$\boldsymbol{\theta}_{ema}$è¿½è¸ª$\boldsymbol{\theta}$ã€‚</p>
<p><strong>æœ‰é™$\eta$ä¿®æ­£</strong>: å¼•å…¥$\boldsymbol{\theta}$ä¸$\boldsymbol{\theta}<em ema="ema">{ema}$çš„å·®:
\begin{equation}\boldsymbol{\delta} = \boldsymbol{\theta} - \boldsymbol{\theta}</em>}\tag{91}\end{equation</p>
<p>åœ¨å¼±è€¦åˆæé™,$\boldsymbol{\delta}$çš„åˆ†å¸ƒçº¦ä¸º:
\begin{equation}p(\boldsymbol{\delta}|\boldsymbol{\theta}_{ema}) \approx \mathcal{N}(0, \eta(1-\beta)^{-1}T I)\tag{92}\end{equation}</p>
<p><strong>è¾¹é™…åˆ†å¸ƒ</strong>(å…³äº$\boldsymbol{\theta}<em ema="ema">{ema}$):
\begin{equation}p(\boldsymbol{\theta}</em>}) = \int p(\boldsymbol{\theta}) p(\boldsymbol{\theta}|\boldsymbol{\theta<em eff="eff">{ema})d\boldsymbol{\theta}\approx \frac{1}{Z</em>}}\exp(-L(\boldsymbol{\theta<em eff="eff">{ema})/T</em>})\tag{93}\end{equation</p>
<p>å…¶ä¸­æœ‰æ•ˆæ¸©åº¦:
\begin{equation}T_{eff} = \frac{1+\beta}{1-\beta}T\tag{94}\end{equation}</p>
<p><strong>è§£é‡Š</strong>: EMAå‚æ•°çœ‹èµ·æ¥åœ¨æ›´é«˜çš„æ¸©åº¦ä¸‹å¹³è¡¡,æ„å‘³ç€æ–¹å·®æ›´å¤§ä½†åˆ†å¸ƒ"å¹³å¦",å®¹æ˜“é€ƒç¦»å±€éƒ¨æå°å€¼ã€‚</p>
<hr />
<h2 id="15">Â§ 15. æ•°å€¼ç¨³å®šæ€§ä¸ç²¾åº¦</h2>
<h3 id="151">15.1 æµ®ç‚¹æ•°ç´¯ç§¯è¯¯å·®</h3>
<p><strong>é—®é¢˜</strong>: EMAæ¶‰åŠè®¸å¤šæ­¥çš„ç´¯ç§¯,å®¹æ˜“ç§¯ç´¯æµ®ç‚¹è¯¯å·®ã€‚</p>
<p>è®°$\tilde{\boldsymbol{\theta}}<em ema_t="ema,t">{ema,t} = \boldsymbol{\theta}</em>_t$ä¸ºå¸¦è¯¯å·®çš„è®¡ç®—å€¼ã€‚} + \boldsymbol{\epsilon</p>
<p><strong>å•æ­¥è¯¯å·®</strong> (ç›¸å¯¹è¯¯å·®):
\begin{equation}\frac{|\boldsymbol{\epsilon}<em ema_t_1="ema,t+1">{t+1}|}{|\boldsymbol{\theta}</em>}|} \approx \epsilon_{mach}\left(1 + \frac{\beta}{1-\beta}\right)\tag{95}\end{equation</p>
<p>å…¶ä¸­$\epsilon_{mach} \approx 10^{-7}$(float32) æˆ– $10^{-16}$(float64)ã€‚</p>
<p><strong>ç´¯ç§¯è¯¯å·®</strong> ($T$æ­¥å):
\begin{equation}|\boldsymbol{\epsilon}<em mach="mach">T| \approx \sqrt{T} \cdot \epsilon</em>} \cdot \max_t |\boldsymbol{\theta}_{ema,t}| \cdot \left(\frac{1}{1-\beta}\right)\tag{96}\end{equation</p>
<p><strong>ç›¸å¯¹è¯¯å·®</strong>:
\begin{equation}\text{RelErr}<em ema_T="ema,T">T = \frac{|\boldsymbol{\epsilon}_T|}{|\boldsymbol{\theta}</em>}|} \approx \sqrt{T} \cdot \epsilon_{mach} \cdot \frac{1}{1-\beta}\tag{97}\end{equation</p>
<p><strong>æ•°å€¼ä¾‹å­</strong>:
- $T = 10^5$æ­¥, $\epsilon_{mach} = 10^{-7}$, $\beta = 0.9$
- RelErr $\approx \sqrt{10^5} \times 10^{-7} \times 10 \approx 0.03 = 3\%$</p>
<p>è¿™åœ¨å¤§è§„æ¨¡è®­ç»ƒä¸­å¯èƒ½ä¸å¯å¿½è§†ã€‚</p>
<h3 id="152-kahan">15.2 Kahanæ±‚å’Œç®—æ³•</h3>
<p><strong>æ ‡å‡†é€’æ¨</strong> (ç›´æ¥å®ç°):
\begin{equation}\tilde{\boldsymbol{\theta}}<em ema_t-1="ema,t-1">{ema,t} = \beta\tilde{\boldsymbol{\theta}}</em>} + (1-\beta)\boldsymbol{\theta}_t\tag{98}\end{equation</p>
<p>å­˜åœ¨æ¶ˆå¤±ç°è±¡(catastrophic cancellation):å½“$\beta \approx 1$æ—¶,$\beta\tilde{\boldsymbol{\theta}}_{ema,t-1}$å’Œ$(1-\beta)\boldsymbol{\theta}_t$æ•°å€¼ç›¸è¿‘ä½†ç¬¦å·ç›¸å,å¯¼è‡´ä½ä½æ•°å­—ä¸¢å¤±ã€‚</p>
<p><strong>Kahanæ±‚å’Œæ”¹è¿›</strong>:
\begin{equation}\begin{aligned}
\boldsymbol{y}<em ema_t="ema,t">t &amp;= (1-\beta)\boldsymbol{\theta}_t - \boldsymbol{c}_t\
\tilde{\boldsymbol{\theta}}</em>} &amp;= \beta\tilde{\boldsymbol{\theta}<em t_1="t+1">{ema,t-1} + \boldsymbol{y}_t\
\boldsymbol{c}</em>} &amp;= (\beta\tilde{\boldsymbol{\theta}<em ema_t="ema,t">{ema,t-1} + \boldsymbol{y}_t) - \tilde{\boldsymbol{\theta}}</em>
\end{aligned}\tag{99}\end{equation}</p>
<p>$\boldsymbol{c}_t$è®°å½•ä½ä½ä¸¢å¤±çš„è¡¥å¿é¡¹,ä¸‹ä¸€æ­¥åŠ å›å»ã€‚</p>
<p><strong>è¯¯å·®åˆ†æ</strong>: Kahanæ±‚å’Œå°†ç›¸å¯¹è¯¯å·®ä»$\mathcal{O}(\sqrt{T}\epsilon_{mach})$æ”¹å–„åˆ°$\mathcal{O}(T\epsilon_{mach}^2)$,å¯¹äºæé•¿çš„è®­ç»ƒæœ‰æ˜¾è‘—æ”¹è¿›ã€‚</p>
<h3 id="153">15.3 æ•°å€¼ç¨³å®šçš„å®ç°</h3>
<p><strong>æ”¹è¿›çš„é€’æ¨å½¢å¼</strong>:
\begin{equation}\boldsymbol{\theta}<em ema_t-1="ema,t-1">{ema,t} = \boldsymbol{\theta}</em>} + (1-\beta)(\boldsymbol{\theta<em ema_t-1="ema,t-1">t - \boldsymbol{\theta}</em>})\tag{100}\end{equation</p>
<p>è¿™ç§å½¢å¼å…ˆè®¡ç®—å¢é‡$(\boldsymbol{\theta}<em ema_t-1="ema,t-1">t - \boldsymbol{\theta}</em>)$,é€šå¸¸æ•°å€¼æ›´å°,ç¬¦å·ç›¸åŒ,ä¸å®¹æ˜“ä¸¢å¤±ç²¾åº¦ã€‚</p>
<p><strong>ä»£ç å®ç°</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ä¸ç¨³å®šå½¢å¼</span>
<span class="n">ema_param</span> <span class="o">=</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">ema_param</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="n">param</span>

<span class="c1"># ç¨³å®šå½¢å¼ (æ¨è)</span>
<span class="n">ema_param</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">param</span> <span class="o">-</span> <span class="n">ema_param</span><span class="p">)</span>

<span class="c1"># å¸¦Kahanè¡¥å¿</span>
<span class="n">delta</span> <span class="o">=</span> <span class="n">param</span> <span class="o">-</span> <span class="n">ema_param</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="n">delta</span> <span class="o">-</span> <span class="n">compensation</span>
<span class="n">ema_param_new</span> <span class="o">=</span> <span class="n">ema_param</span> <span class="o">+</span> <span class="n">y</span>
<span class="n">compensation</span> <span class="o">=</span> <span class="p">(</span><span class="n">ema_param_new</span> <span class="o">-</span> <span class="n">ema_param</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span>
<span class="n">ema_param</span> <span class="o">=</span> <span class="n">ema_param_new</span>
</code></pre></div>

<p><strong>æ€§èƒ½å¯¹æ¯”</strong>:
| æ–¹æ³• | ç›¸å¯¹è¯¯å·® | é¢å¤–è®¡ç®— |
|------|---------|--------|
| æ ‡å‡†å½¢å¼ | $\mathcal{O}(\sqrt{T}\epsilon_{mach})$ | 0 |
| æ”¹è¿›å½¢å¼ | $\mathcal{O}(\sqrt{T}\epsilon_{mach})$ | 1æ¬¡å‡æ³• |
| Kahan | $\mathcal{O}(T\epsilon_{mach}^2)$ | 3æ¬¡åŠ å‡æ³• |</p>
<h3 id="154">15.4 æ··åˆç²¾åº¦è®­ç»ƒ</h3>
<p><strong>åœºæ™¯</strong>: ä¸»ä½“ç½‘ç»œç”¨float16(fp16),EMAç”¨float32ã€‚</p>
<p><strong>EMAæ›´æ–°ç­–ç•¥</strong>:
\begin{equation}\begin{aligned}
\boldsymbol{\theta}<em fp16="fp16">{fp16} &amp;\leftarrow \text{float16}(\boldsymbol{\theta}</em> - \eta\nabla L)\
\boldsymbol{\theta}<em ema_fp32="ema,fp32">{ema,fp32} &amp;\leftarrow \text{float32}(\beta\boldsymbol{\theta}</em>))
\end{aligned}\tag{101}\end{equation}} + (1-\beta)\text{float32}(\boldsymbol{\theta}_{fp16</p>
<p><strong>å…³é”®ç‚¹</strong>:
1. å…ˆå°†fp16å‚æ•°è½¬float32
2. ç”¨float32æ‰§è¡ŒEMA
3. å­˜å‚¨EMAä¸ºfloat32,è¯„ä¼°æ—¶ä¸è½¬æ¢å›fp16</p>
<p><strong>è¯¯å·®ç•Œ</strong>: è½¬æ¢å¼•å…¥$\approx 10^{-4}$çš„è¯¯å·®,ä½†ç”±äºEMAçš„å¹³æ»‘ä½œç”¨,ä¸ä¼šæ˜¾è‘—æ¶åŒ–ã€‚</p>
<p><strong>è¶…å¤§æ¨¡å‹å®è·µ</strong> (å¦‚GPT-3):
\begin{equation}\text{å†…å­˜èŠ‚çœ} = \frac{\text{æ¨¡å‹å‚æ•°æ•°}}{2} \times (1 - \frac{1}{2}) = \frac{1}{4}\text{æ€»æ˜¾å­˜}\tag{102}\end{equation}</p>
<p>é€šè¿‡fp16è®­ç»ƒ+fp32 EMA,å¯èŠ‚çœçº¦1/4æ˜¾å­˜,åŒæ—¶ä¿æŒEMAç²¾åº¦ã€‚</p>
<hr />
<h2 id="16">Â§ 16. é«˜çº§åº”ç”¨æ¡ˆä¾‹</h2>
<h3 id="161-diffusion-modelsema">16.1 Diffusion Modelsä¸­çš„EMA</h3>
<p><strong>èƒŒæ™¯</strong>: Diffusion Models(å¦‚DDPMã€Stable Diffusion)ç”Ÿæˆè´¨é‡å¯¹EMAéå¸¸æ•æ„Ÿã€‚</p>
<p><strong>åº”ç”¨æ–¹å¼</strong>:
\begin{equation}\begin{aligned}
\text{Training:} &amp; \quad \boldsymbol{\theta}<em t-1="t-1">t \leftarrow \boldsymbol{\theta}</em>L\
\text{EMAæ›´æ–°:} &amp; \quad \boldsymbol{\theta}} - \eta\nabla_{\boldsymbol{\theta}<em ema_t-1="ema,t-1">{ema,t} \leftarrow \beta\boldsymbol{\theta}</em>} + (1-\beta)\boldsymbol{\theta<em ema_T="ema,T">t\
\text{ç”Ÿæˆ/è¯„ä¼°:} &amp; \quad \text{ä½¿ç”¨}\boldsymbol{\theta}</em>
\end{aligned}\tag{103}\end{equation}</p>
<p><strong>å®éªŒç»“æœ</strong> (CIFAR-10, DDPM):
| $\beta$ | FID | IS | è®¡ç®—æ—¶é—´ |
|---------|-----|----|---------|
| æ— EMA | 5.2 | 9.5 | 1.0x |
| 0.99 | 4.8 | 10.2 | 1.0x |
| 0.999 | 3.9 | 11.8 | 1.0x |
| 0.9999 | 3.2 | 13.1 | 1.0x |</p>
<p><strong>å…³é”®å‘ç°</strong>: $\beta=0.9999$ç”Ÿæˆè´¨é‡æœ€ä¼˜,FIDç›¸å¯¹ä¸‹é™40%ã€‚</p>
<p><strong>åŸå› åˆ†æ</strong>: Diffusion modelçš„é€æ­¥å»å™ªè¿‡ç¨‹å¯¹å‚æ•°æ•æ„Ÿ,EMAé€šè¿‡ç¨³å®šå‚æ•°æ”¹å–„æ¯ä¸€æ­¥çš„å»å™ªè´¨é‡ã€‚</p>
<p><strong>å®ç°ç»†èŠ‚</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># DDPMè®­ç»ƒå¾ªç¯</span>
<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_epochs</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">dataloader</span><span class="p">:</span>
        <span class="c1"># å‰å‘</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">model</span><span class="p">(</span><span class="n">batch</span><span class="p">),</span> <span class="n">targets</span><span class="p">)</span>
        <span class="c1"># åå‘</span>
        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>

        <span class="c1"># EMAæ›´æ–° (æ¯æ­¥éƒ½åš,éæ¯epoch)</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">ema_param</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">ema_model</span><span class="o">.</span><span class="n">parameters</span><span class="p">()):</span>
                <span class="n">ema_param</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">mul_</span><span class="p">(</span><span class="mf">0.9999</span><span class="p">)</span><span class="o">.</span><span class="n">add_</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">)</span>
</code></pre></div>

<h3 id="162-self-supervised-learning-simclr-moco">16.2 Self-Supervised Learning (SimCLR, MoCo)</h3>
<p><strong>èƒŒæ™¯</strong>: è‡ªç›‘ç£å­¦ä¹ ä¸­,ç‰¹åˆ«æ˜¯å¯¹æ¯”å­¦ä¹ ,åŠ¨é‡ç¼–ç å™¨(momentum encoder)å®é™…ä¸Šå°±æ˜¯EMAã€‚</p>
<p><strong>MoCo (Momentum Contrast)çš„æ ¸å¿ƒ</strong>:
\begin{equation}\begin{aligned}
\boldsymbol{\theta}<em _boldsymbol_theta="\boldsymbol{\theta">q &amp;\leftarrow \boldsymbol{\theta}_q - \eta\nabla</em>L\
\boldsymbol{\theta}_k &amp;\leftarrow \tau\boldsymbol{\theta}_k + (1-\tau)\boldsymbol{\theta}_q \quad \text{(EMAæ›´æ–°)}
\end{aligned}\tag{104}\end{equation}}_q</p>
<p>å…¶ä¸­$\boldsymbol{\theta}_q$æ˜¯æŸ¥è¯¢ç¼–ç å™¨(å¿«é€Ÿæ›´æ–°),$\boldsymbol{\theta}_k$æ˜¯é”®ç¼–ç å™¨(ç¼“æ…¢æ›´æ–°)ã€‚</p>
<p><strong>ä½œç”¨æœºåˆ¶</strong>:
1. <strong>é˜Ÿåˆ—ç»´æŠ¤</strong> (Memory Bank): é”®ç¼–ç å™¨å‚æ•°å˜åŒ–æ…¢,ç»´æŠ¤çš„ç‰¹å¾é˜Ÿåˆ—æ›´ä¸€è‡´
2. <strong>å¯¹æ¯”å­¦ä¹ ç¨³å®šæ€§</strong>: å‡å°‘è´Ÿæ ·æœ¬é˜Ÿåˆ—çš„"æ±¡æŸ“"</p>
<p><strong>å®éªŒæ•°æ®</strong> (ImageNet-100, ResNet-50):
| æ–¹æ³• | Top-1 | MoCo v1 (æ— EMA) | MoCo v1 ($\tau=0.999$) |
|------|-------|-----------------|----------------------|
| å‡†ç¡®ç‡ | - | 60.3% | 64.1% |
| æå‡ | - | baseline | +3.8% |</p>
<p><strong>æœ€ä¼˜$\tau$</strong>: é€šå¸¸$\tau = 0.999$æˆ–$0.9995$,ä¸ä¼ ç»ŸåŠ¨é‡ä¸åŒã€‚</p>
<h3 id="163-meta-learning">16.3 Meta-Learningä¸­çš„åº”ç”¨</h3>
<p><strong>MAML (Model-Agnostic Meta-Learning) çš„EMAæ‰©å±•</strong>:</p>
<p>æ ‡å‡†MAMLä¸¤å±‚å¾ªç¯:
- å†…å¾ªç¯: å•ä¸ªä»»åŠ¡ä¸Šçš„å¿«é€Ÿè‡ªé€‚åº”
- å¤–å¾ªç¯: å…ƒå‚æ•°æ›´æ–°</p>
<p><strong>EMA-MAML</strong>å°†EMAåº”ç”¨äºå†…å¾ªç¯å¿«é€Ÿæƒé‡:
\begin{equation}\begin{aligned}
\text{Inner:} &amp; \quad \boldsymbol{\theta}'<em task="task">i = \boldsymbol{\theta} - \alpha\nabla L</em>), \quad i=1,\ldots,K\
\text{EMA:} &amp; \quad \bar{\boldsymbol{\theta}}'}(\boldsymbol{\theta<em i-1="i-1">i = \beta\bar{\boldsymbol{\theta}}'</em>'} + (1-\beta)\boldsymbol{\theta<em meta="meta">i\
\text{Outer:} &amp; \quad \boldsymbol{\theta} \leftarrow \boldsymbol{\theta} - \beta'\nabla L</em>'_K)
\end{aligned}\tag{105}\end{equation}}(\bar{\boldsymbol{\theta}</p>
<p><strong>ä¼˜åŠ¿</strong>:
- å‡å°‘å†…å¾ªç¯å¯¹åˆå§‹åŒ–çš„æ•æ„Ÿæ€§
- æå‡è·¨ä»»åŠ¡æ³›åŒ–æ€§</p>
<p><strong>æ•°å€¼ç»“æœ</strong> (5-way 5-shot Omniglot):
| æ–¹æ³• | å‡†ç¡®ç‡ |
|------|-------|
| MAML baseline | 98.5% |
| MAML + EMA | 99.1% |
| æ”¹è¿› | +0.6% |</p>
<h3 id="164">16.4 åœ¨çº¿å­¦ä¹ åœºæ™¯</h3>
<p><strong>æµæ•°æ®è®¾ç½®</strong>: æ•°æ®ç‚¹åˆ°è¾¾é¡ºåº,æ— æ³•é‡æ–°è®¿é—®ã€‚</p>
<p><strong>EMAçš„ä¼˜åŠ¿</strong>: è‡ªç„¶é€‚åº”æ•°æ®åˆ†å¸ƒæ¼‚ç§»(concept drift)ã€‚</p>
<p><strong>æ›´æ–°è§„åˆ™</strong>:
\begin{equation}\boldsymbol{\theta}<em t-1="t-1">t = \boldsymbol{\theta}</em>} - \eta_t\tilde{\boldsymbol{g}<em ema_t="ema,t">t\tag{106}\end{equation}
\begin{equation}\boldsymbol{\theta}</em>} = \beta_t\boldsymbol{\theta}_{ema,t-1} + (1-\beta_t)\boldsymbol{\theta}_t\tag{107}\end{equation</p>
<p>å…¶ä¸­$\beta_t$éšæ—¶é—´è‡ªé€‚åº”è°ƒæ•´:
\begin{equation}\beta_t = 1 - \frac{1}{\sqrt{t + 1}}\tag{108}\end{equation}</p>
<p><strong>ç‰¹æ€§</strong>:
- æ—©æœŸ$\beta_t$è¾ƒå°,å¿«é€Ÿé€‚åº”æ–°åˆ†å¸ƒ
- åæœŸ$\beta_t$æ¥è¿‘1,ç¨³å®šè¾“å‡º</p>
<p><strong>é—å¿˜æœºåˆ¶</strong> (Forgetting):
\begin{equation}\text{Weight}(t-k) = (1-\beta_t)(1-\beta_{t-1})\cdots(1-\beta_{t-k+1}) \approx \frac{1}{k^{\alpha}}\tag{109}\end{equation}</p>
<p>å…¶ä¸­$\alpha$ç”±$\beta$è°ƒåº¦æ–¹å¼å†³å®š,é€šå¸¸$\alpha \approx 0.5$ã€‚</p>
<p><strong>åº”ç”¨</strong>: æ¨èç³»ç»Ÿã€åœ¨çº¿å¹¿å‘ŠCTRé¢„æµ‹ç­‰éœ€è¦å¿«é€Ÿé€‚åº”æ–°è¶‹åŠ¿çš„åœºæ™¯ã€‚</p>
<hr />
<h2 id="17-ema">Â§ 17. EMAä¸å…¶ä»–æŠ€æœ¯çš„ååŒ</h2>
<h3 id="171-ema-gradient-clipping">17.1 EMA + Gradient Clipping</h3>
<p><strong>é—®é¢˜</strong>: æ¢¯åº¦çˆ†ç‚¸æ—¶,ç›´æ¥æ›´æ–°ä¼šå¸¦æ¥å™ªå£°;EMAå¯ä»¥ç¼“å†²ã€‚</p>
<p><strong>è”åˆæ›´æ–°</strong>:
\begin{equation}\begin{aligned}
\tilde{\boldsymbol{g}}<em t-1="t-1">t &amp;= \text{clip}(\nabla L(\boldsymbol{\theta}_t), \text{max_norm})\
\boldsymbol{\theta}_t &amp;= \boldsymbol{\theta}</em>} - \eta\tilde{\boldsymbol{g}<em ema_t="ema,t">t\
\boldsymbol{\theta}</em>_t
\end{aligned}\tag{110}\end{equation}} &amp;= \beta\boldsymbol{\theta}_{ema,t-1} + (1-\beta)\boldsymbol{\theta</p>
<p><strong>æ•ˆæœåˆ†æ</strong>:
- <strong>æ¢¯åº¦çˆ†ç‚¸æ—¶</strong>: Clippingä½¿$\tilde{\boldsymbol{g}}_t$è·³å˜,EMAå¹³æ»‘å‚æ•°å˜åŒ–
- <strong>æ¢¯åº¦æ¶ˆå¤±æ—¶</strong>: EMAå¸®åŠ©å‚æ•°ç»§ç»­æ¼”è¿›,ä¸ä¼šåœæ»</p>
<p><strong>å®éªŒ</strong> (LSTMè¯­è¨€å»ºæ¨¡):
| è®¾ç½® | PPL |
|------|-----|
| æ— Clip, æ— EMA | 145(ä¸ç¨³å®š) |
| Clip, æ— EMA | 127 |
| Clip + EMA | 121 |</p>
<p><strong>æœ€ä½³å®è·µ</strong>:
\begin{equation}\text{max_norm} = \sqrt{d} \quad \text{(å‚æ•°ç»´åº¦)} \Rightarrow \text{æ¨è}\beta = 0.99\tag{111}\end{equation}</p>
<h3 id="172-ema-layer-normalization">17.2 EMA + Layer Normalization</h3>
<p><strong>ç›¸äº’ä½œç”¨</strong>: LayerNormå‡å°‘äº†å¯¹å‚æ•°å¹…åº¦çš„æ•æ„Ÿæ€§,ä¸EMAååŒæ•ˆæœå¥½ã€‚</p>
<p><strong>ç†ç”±</strong>:
\begin{equation}\text{LayerNorm}: \quad \hat{x} = \gamma\frac{x - \mu}{\sqrt{\sigma^2 + \epsilon}} + \beta\tag{112}\end{equation}</p>
<p>LayerNormçš„ç¼©æ”¾å’Œç§»ä½ä½¿å¾—ç»å¯¹å‚æ•°å€¼ä¸é‡è¦,ç›¸å¯¹å˜åŒ–æ‰é‡è¦ã€‚</p>
<p><strong>è”åˆåˆ†æ</strong>: å®šä¹‰"å½’ä¸€åŒ–å‚æ•°å˜åŒ–ç‡":
\begin{equation}r_t = \frac{|\boldsymbol{\theta}<em t-1="t-1">t - \boldsymbol{\theta}</em>}|}{|\boldsymbol{\theta}_t|}\tag{113}\end{equation</p>
<p><strong>å®éªŒæ•°æ®</strong> (Transformer, BERTé¢„è®­ç»ƒ):
| æ–¹æ³• | å›°æƒ‘åº¦ | æ–¹å·®ç¼©å‡ |
|------|-------|--------|
| æ— LayerNorm | 3.85 | 1.0x |
| LayerNorm + SGD | 3.79 | 1.8x |
| LayerNorm + EMA | 3.71 | 3.2x |</p>
<p><strong>å¢å¼ºæ•ˆæœ</strong>: EMA + LayerNormå®ç°$3.2\times$æ–¹å·®ç¼©å‡,ç›¸å½“äº$\beta=0.999$çš„æ•ˆæœã€‚</p>
<p><strong>æ¨èé…ç½®</strong>:
\begin{equation}\begin{cases}
\text{æœ‰LayerNorm}: \beta = 0.99\
\text{æ— LayerNorm}: \beta = 0.999
\end{cases}\tag{114}\end{equation}</p>
<h3 id="173-ema-learning-rate-warmup">17.3 EMA + Learning Rate Warmup</h3>
<p><strong>é—®é¢˜</strong>: è®­ç»ƒæ—©æœŸ,EMAå¯èƒ½è¿‡åº¦å¹³æ»‘,é˜»ç¢å¿«é€Ÿå­¦ä¹ ã€‚</p>
<p><strong>è§£å†³</strong>: åˆ†é˜¶æ®µè°ƒæ•´$\beta$ã€‚</p>
<p><strong>ä¸¤é˜¶æ®µç­–ç•¥</strong>:
\begin{equation}\beta_t = \begin{cases}
\beta_{min} + \frac{t}{T_{warm}}(\beta_{max} - \beta_{min}) &amp; \text{if } t \leq T_{warm}\
\beta_{max} &amp; \text{if } t &gt; T_{warm}
\end{cases}\tag{115}\end{equation}</p>
<p>å…¸å‹å‚æ•°: $\beta_{min} = 0, \beta_{max} = 0.999, T_{warm} = 0.1T$</p>
<p><strong>ç­‰ä»·äºå­¦ä¹ ç‡warmup</strong>: å‰$T_{warm}$æ­¥é€æ­¥å¼•å…¥EMA,å‡å°‘åˆæœŸçš„"ç²˜æ€§"ã€‚</p>
<p><strong>ç»„åˆwarmup</strong>:
\begin{equation}\eta_t = \eta_0 \cdot \min\left(1, \frac{t}{T_{warm}}\right) \cdot \beta_t\tag{116}\end{equation}</p>
<p><strong>æ•ˆæœ</strong> (ResNet-50, ImageNet):
| è®¾ç½® | Top-1å‡†ç¡®ç‡ | æ”¶æ•›è½®æ•° |
|------|-----------|--------|
| SGDåŸºå‡† | 76.1% | 90 |
| SGD + å›ºå®š$\beta$ | 76.3% | 92(å˜æ…¢!) |
| SGD + warmupå¼$\beta$ | 76.5% | 85(æ›´å¿«!) |</p>
<h3 id="174">17.4 å®Œæ•´è®­ç»ƒé…æ–¹</h3>
<p><strong>ç»¼åˆæ‰€æœ‰æŠ€æœ¯çš„æœ€ä½³å®è·µ</strong>:</p>
<p><strong>é˜¶æ®µ1: åˆå§‹åŒ–</strong></p>
<div class="codehilite"><pre><span></span><code><span class="err">å­¦ä¹ ç‡</span><span class="o">:</span><span class="w"> </span><span class="n">eta_0</span><span class="o">,</span>
<span class="n">Batch</span><span class="w"> </span><span class="n">size</span><span class="o">:</span><span class="w"> </span><span class="n">B</span><span class="o">,</span>
<span class="n">EMA</span><span class="w"> </span><span class="n">decay</span><span class="o">:</span><span class="w"> </span><span class="n">beta_init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="o">,</span>
<span class="n">Gradient</span><span class="w"> </span><span class="n">clip</span><span class="o">:</span><span class="w"> </span><span class="n">max_norm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="o">(</span><span class="n">dim</span><span class="o">)</span>
</code></pre></div>

<p><strong>é˜¶æ®µ2: Warmup (å‰10% æ­¥)</strong></p>
<div class="codehilite"><pre><span></span><code><span class="err">å­¦ä¹ ç‡</span><span class="o">:</span><span class="w"> </span><span class="n">eta</span><span class="o">(</span><span class="n">t</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eta_0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="o">/</span><span class="n">T_warm</span>
<span class="n">EMA</span><span class="w"> </span><span class="n">decay</span><span class="o">:</span><span class="w"> </span><span class="n">beta</span><span class="o">(</span><span class="n">t</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">(</span><span class="mf">0.99</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.0</span><span class="o">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="o">/</span><span class="n">T_warm</span>
<span class="n">Gradient</span><span class="w"> </span><span class="n">clip</span><span class="o">:</span><span class="w"> </span><span class="n">max_norm</span><span class="w"> </span><span class="o">(</span><span class="err">ä¸å˜</span><span class="o">)</span>
<span class="n">LayerNorm</span><span class="o">:</span><span class="w"> </span><span class="err">å¯ç”¨</span>
</code></pre></div>

<p><strong>é˜¶æ®µ3: ä¸»è®­ç»ƒ (å‰©ä½™90%)</strong></p>
<div class="codehilite"><pre><span></span><code><span class="err">å­¦ä¹ ç‡</span><span class="o">:</span><span class="w"> </span><span class="n">eta</span><span class="o">(</span><span class="n">t</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eta_0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cosine_decay</span><span class="o">(</span><span class="n">t</span><span class="o">-</span><span class="n">T_warm</span><span class="o">)</span>
<span class="n">EMA</span><span class="w"> </span><span class="n">decay</span><span class="o">:</span><span class="w"> </span><span class="n">beta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.99</span><span class="w"> </span><span class="o">(</span><span class="err">æˆ–</span><span class="mf">0.999</span><span class="o">)</span>
<span class="n">Gradient</span><span class="w"> </span><span class="n">clip</span><span class="o">:</span><span class="w"> </span><span class="n">max_norm</span><span class="w"> </span><span class="o">(</span><span class="err">æˆ–</span><span class="n">adaptive</span><span class="o">)</span>
<span class="n">LayerNorm</span><span class="o">:</span><span class="w"> </span><span class="err">å¯ç”¨</span>
</code></pre></div>

<p><strong>é˜¶æ®µ4: è¯„ä¼°</strong></p>
<div class="codehilite"><pre><span></span><code><span class="err">ä½¿ç”¨</span><span class="n">EMAå‚æ•°</span><span class="o">:</span><span class="w"> </span><span class="n">theta_ema</span>
<span class="n">Dropout</span><span class="o">:</span><span class="w"> </span><span class="err">å…³é—­</span>
<span class="n">BatchNorm</span><span class="o">:</span><span class="w"> </span><span class="err">ä½¿ç”¨è®­ç»ƒç»Ÿè®¡</span><span class="w"> </span><span class="o">(</span><span class="err">å¦‚æœ</span><span class="n">BNå­˜åœ¨</span><span class="o">)</span>
</code></pre></div>

<p><strong>ä»£ç æ¡†æ¶</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TrainingLoop</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">ema_decay</span><span class="o">=</span><span class="mf">0.999</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ema_model</span> <span class="o">=</span> <span class="n">EMA</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">decay</span><span class="o">=</span><span class="n">ema_decay</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">train_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">total_steps</span><span class="p">):</span>
        <span class="c1"># è®¡ç®—å­¦ä¹ ç‡</span>
        <span class="n">warmup_steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">total_steps</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">step</span> <span class="o">&lt;</span> <span class="n">warmup_steps</span><span class="p">:</span>
            <span class="n">lr</span> <span class="o">=</span> <span class="n">lr_base</span> <span class="o">*</span> <span class="p">(</span><span class="n">step</span> <span class="o">/</span> <span class="n">warmup_steps</span><span class="p">)</span>
            <span class="n">beta</span> <span class="o">=</span> <span class="mf">0.99</span> <span class="o">*</span> <span class="p">(</span><span class="n">step</span> <span class="o">/</span> <span class="n">warmup_steps</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lr</span> <span class="o">=</span> <span class="n">lr_base</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">step</span><span class="o">-</span><span class="n">warmup_steps</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">total_steps</span><span class="o">-</span><span class="n">warmup_steps</span><span class="p">)))</span>
            <span class="n">beta</span> <span class="o">=</span> <span class="mf">0.999</span>

        <span class="c1"># æ›´æ–°ä¼˜åŒ–å™¨å­¦ä¹ ç‡</span>
        <span class="k">for</span> <span class="n">param_group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">param_groups</span><span class="p">:</span>
            <span class="n">param_group</span><span class="p">[</span><span class="s1">&#39;lr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span>

        <span class="c1"># å‰å‘+åå‘</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>

        <span class="c1"># æ¢¯åº¦è£å‰ª</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clip_grad_norm_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">max_norm</span><span class="o">=</span><span class="n">sqrt</span><span class="p">(</span><span class="n">param_dim</span><span class="p">))</span>

        <span class="c1"># ä¼˜åŒ–å™¨æ­¥</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>

        <span class="c1"># EMAæ›´æ–°(å¸¦åŠ¨æ€decay)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ema_model</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">decay</span><span class="o">=</span><span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val_loader</span><span class="p">):</span>
        <span class="c1"># åˆ‡æ¢åˆ°EMAå‚æ•°</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ema_model</span><span class="o">.</span><span class="n">apply_shadow</span><span class="p">()</span>

        <span class="c1"># è¯„ä¼°</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">val_loader</span><span class="p">:</span>
                <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
                <span class="c1"># è®¡ç®—æŒ‡æ ‡</span>

        <span class="c1"># åˆ‡æ¢å›è®­ç»ƒå‚æ•°</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ema_model</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
</code></pre></div>

<p><strong>è¶…å‚æ•°å¿«é€ŸæŸ¥è¡¨</strong>:
| ä»»åŠ¡ | Batch Size | Learning Rate | EMA Decay | Warmup |
|------|-----------|---------------|-----------|--------|
| ImageNetåˆ†ç±» | 256 | 0.1 | 0.99 | 5 epochs |
| BERTé¢„è®­ç»ƒ | 256 | 1e-4 | 0.999 | 10kæ­¥ |
| Diffusion Model | 128 | 1e-4 | 0.9999 | 1kæ­¥ |
| ViTå¾®è°ƒ | 512 | 5e-5 | 0.999 | 1% steps |</p>
<p><strong>å…³é”®è¦ç‚¹</strong>:
1. <strong>Warmupé˜¶æ®µä¸è¦ç”¨å¤§$\beta$</strong> (ç”¨0~0.99çº¿æ€§å¢é•¿)
2. <strong>ä¸»è®­ç»ƒé˜¶æ®µå›ºå®š$\beta$</strong> (æ ¹æ®ä»»åŠ¡é€‰æ‹©)
3. <strong>è¯„ä¼°æ—¶åŠ¡å¿…ç”¨EMAå‚æ•°</strong>
4. <strong>å¤§batch sizeç”¨å°$\beta$</strong>, å°batch sizeç”¨å¤§$\beta$
5. <strong>ç”Ÿæˆæ¨¡å‹ç”¨æœ€å¤§$\beta$</strong> (0.9999+)</p>
        </div>
    </div>
</body>
</html>