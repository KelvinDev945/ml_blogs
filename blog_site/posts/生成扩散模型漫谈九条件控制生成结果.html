<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆä¹ï¼‰ï¼šæ¡ä»¶æ§åˆ¶ç”Ÿæˆç»“æœ</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆä¹ï¼‰ï¼šæ¡ä»¶æ§åˆ¶ç”Ÿæˆç»“æœ</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-26 | ğŸ“„ å¤§å°: 49.7 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/9257">https://spaces.ac.cn/archives/9257</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>å‰é¢çš„å‡ ç¯‡æ–‡ç« éƒ½æ˜¯æ¯”è¾ƒåç†è®ºçš„ç»“æœï¼Œè¿™ç¯‡æ–‡ç« æˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸ªæ¯”è¾ƒæœ‰å®ç”¨ä»·å€¼çš„ä¸»é¢˜â€”â€”æ¡ä»¶æ§åˆ¶ç”Ÿæˆã€‚</p>
<p>ä½œä¸ºç”Ÿæˆæ¨¡å‹ï¼Œæ‰©æ•£æ¨¡å‹è·ŸVAEã€GANã€flowç­‰æ¨¡å‹çš„å‘å±•å²å¾ˆç›¸ä¼¼ï¼Œéƒ½æ˜¯å…ˆå‡ºæ¥äº†æ— æ¡ä»¶ç”Ÿæˆï¼Œç„¶åæœ‰æ¡ä»¶ç”Ÿæˆå°±ç´§æ¥è€Œæ¥ã€‚æ— æ¡ä»¶ç”Ÿæˆå¾€å¾€æ˜¯ä¸ºäº†æ¢ç´¢æ•ˆæœä¸Šé™ï¼Œè€Œæœ‰æ¡ä»¶ç”Ÿæˆåˆ™æ›´å¤šæ˜¯åº”ç”¨å±‚é¢çš„å†…å®¹ï¼Œå› ä¸ºå®ƒå¯ä»¥å®ç°æ ¹æ®æˆ‘ä»¬çš„æ„æ„¿æ¥æ§åˆ¶è¾“å‡ºç»“æœã€‚ä»DDPMè‡³ä»Šï¼Œå·²ç»å‡ºæ¥äº†å¾ˆå¤šæ¡ä»¶æ‰©æ•£æ¨¡å‹çš„å·¥ä½œï¼Œç”šè‡³å¯ä»¥è¯´çœŸæ­£å¸¦ç«äº†æ‰©æ•£æ¨¡å‹çš„å°±æ˜¯æ¡ä»¶æ‰©æ•£æ¨¡å‹ï¼Œæ¯”å¦‚è„ç‚™äººå£çš„æ–‡ç”Ÿå›¾æ¨¡å‹<a href="https://papers.cool/arxiv/2204.06125">DALLÂ·E 2</a>ã€<a href="https://papers.cool/arxiv/2205.11487">Imagen</a>ã€‚</p>
<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å¯¹æ¡ä»¶æ‰©æ•£æ¨¡å‹çš„ç†è®ºåŸºç¡€åšä¸ªç®€å•çš„å­¦ä¹ å’Œæ€»ç»“ã€‚</p>
<h2 id="_1">æŠ€æœ¯åˆ†æ</h2>
<p>ä»æ–¹æ³•ä¸Šæ¥çœ‹ï¼Œæ¡ä»¶æ§åˆ¶ç”Ÿæˆçš„æ–¹å¼åˆ†ä¸¤ç§ï¼šäº‹åä¿®æ”¹ï¼ˆClassifier-Guidanceï¼‰å’Œäº‹å‰è®­ç»ƒï¼ˆClassifier-Freeï¼‰ã€‚</p>
<p>å¯¹äºå¤§å¤šæ•°äººæ¥è¯´ï¼Œä¸€ä¸ªSOTAçº§åˆ«çš„æ‰©æ•£æ¨¡å‹è®­ç»ƒæˆæœ¬å¤ªå¤§äº†ï¼Œè€Œåˆ†ç±»å™¨ï¼ˆClassifierï¼‰çš„è®­ç»ƒè¿˜èƒ½æ¥å—ï¼Œæ‰€ä»¥å°±æƒ³ç€ç›´æ¥å¤ç”¨åˆ«äººè®­ç»ƒå¥½çš„æ— æ¡ä»¶æ‰©æ•£æ¨¡å‹ï¼Œç”¨ä¸€ä¸ªåˆ†ç±»å™¨æ¥è°ƒæ•´ç”Ÿæˆè¿‡ç¨‹ä»¥å®ç°æ§åˆ¶ç”Ÿæˆï¼Œè¿™å°±æ˜¯äº‹åä¿®æ”¹çš„Classifier-Guidanceæ–¹æ¡ˆï¼›è€Œå¯¹äºâ€œè´¢å¤§æ°”ç²—â€çš„Googleã€OpenAIç­‰å…¬å¸æ¥è¯´ï¼Œå®ƒä»¬ä¸ç¼ºæ•°æ®å’Œç®—åŠ›ï¼Œæ‰€ä»¥æ›´å€¾å‘äºå¾€æ‰©æ•£æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ä¸­å°±åŠ å…¥æ¡ä»¶ä¿¡å·ï¼Œè¾¾åˆ°æ›´å¥½çš„ç”Ÿæˆæ•ˆæœï¼Œè¿™å°±æ˜¯äº‹å‰è®­ç»ƒçš„Classifier-Freeæ–¹æ¡ˆã€‚</p>
<p>Classifier-Guidanceæ–¹æ¡ˆæœ€æ—©å‡ºè‡ª<a href="https://papers.cool/arxiv/2105.05233">ã€ŠDiffusion Models Beat GANs on Image Synthesisã€‹</a>ï¼Œæœ€åˆå°±æ˜¯ç”¨æ¥å®ç°æŒ‰ç±»ç”Ÿæˆçš„ï¼›åæ¥<a href="https://papers.cool/arxiv/2112.05744">ã€ŠMore Control for Free! Image Synthesis with Semantic Diffusion Guidanceã€‹</a>æ¨å¹¿äº†â€œClassifierâ€çš„æ¦‚å¿µï¼Œä½¿å¾—å®ƒä¹Ÿå¯ä»¥æŒ‰å›¾ã€æŒ‰æ–‡æ¥ç”Ÿæˆã€‚Classifier-Guidanceæ–¹æ¡ˆçš„è®­ç»ƒæˆæœ¬æ¯”è¾ƒä½ï¼ˆç†Ÿæ‚‰NLPçš„è¯»è€…å¯èƒ½è¿˜ä¼šæƒ³èµ·ä¸ä¹‹å¾ˆç›¸ä¼¼çš„<a href="https://papers.cool/arxiv/1912.02164">PPLMæ¨¡å‹</a>ï¼‰ï¼Œä½†æ˜¯æ¨æ–­æˆæœ¬ä¼šé«˜äº›ï¼Œè€Œä¸”æ§åˆ¶ç»†èŠ‚ä¸Šé€šå¸¸æ²¡é‚£ä¹ˆåˆ°ä½ã€‚</p>
<p>è‡³äºClassifier-Freeæ–¹æ¡ˆï¼Œæœ€æ—©å‡ºè‡ª<a href="https://papers.cool/arxiv/2207.12598">ã€ŠClassifier-Free Diffusion Guidanceã€‹</a>ï¼Œåæ¥çš„<a href="https://papers.cool/arxiv/2204.06125">DALLÂ·E 2</a>ã€<a href="https://papers.cool/arxiv/2205.11487">Imagen</a>ç­‰å¸å¼•äººçœ¼çƒçš„æ¨¡å‹åŸºæœ¬ä¸Šéƒ½æ˜¯ä»¥å®ƒä¸ºåŸºç¡€åšçš„ï¼Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¯¥è®ºæ–‡ä¸Šä¸ªæœˆæ‰æ”¾åˆ°Arxivä¸Šï¼Œä½†äº‹å®ä¸Šå»å¹´å·²ç»ä¸­äº†NeurIPS 2021ã€‚åº”è¯¥è¯´ï¼ŒClassifier-Freeæ–¹æ¡ˆæœ¬èº«æ²¡ä»€ä¹ˆç†è®ºä¸Šçš„æŠ€å·§ï¼Œå®ƒæ˜¯æ¡ä»¶æ‰©æ•£æ¨¡å‹æœ€æœ´ç´ çš„æ–¹æ¡ˆï¼Œå‡ºç°å¾—æ™šåªæ˜¯å› ä¸ºé‡æ–°è®­ç»ƒæ‰©æ•£æ¨¡å‹çš„æˆæœ¬è¾ƒå¤§å§ï¼Œåœ¨æ•°æ®å’Œç®—åŠ›éƒ½æ¯”è¾ƒå……è£•çš„å‰æä¸‹ï¼ŒClassifier-Freeæ–¹æ¡ˆè¡¨ç°å‡ºäº†ä»¤äººæƒŠå¹çš„ç»†èŠ‚æ§åˆ¶èƒ½åŠ›ã€‚</p>
<h2 id="_2">æ¡ä»¶è¾“å…¥</h2>
<p>è¯´ç™½äº†ï¼ŒClassifier-Freeæ–¹æ¡ˆå°±æ˜¯è®­ç»ƒæˆæœ¬å¤§ï¼Œæœ¬èº«â€œæ²¡ä»€ä¹ˆæŠ€æœ¯å«é‡â€ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥çš„ä¸»è¦ç¯‡å¹…éƒ½æ˜¯Classifier-Guidanceæ–¹æ¡ˆï¼Œè€ŒClassifier-Freeæ–¹æ¡ˆåˆ™æ˜¯åœ¨æœ€åç®€å•ä»‹ç»ä¸€ä¸‹ã€‚</p>
<p>ç»è¿‡å‰é¢ä¸€ç³»åˆ—æ–‡ç« çš„åˆ†æï¼Œæƒ³å¿…è¯»è€…å·²ç»çŸ¥é“ï¼Œç”Ÿæˆæ‰©æ•£æ¨¡å‹æœ€å…³é”®çš„æ­¥éª¤å°±æ˜¯ç”Ÿæˆè¿‡ç¨‹$p(\boldsymbol{x}<em t-1="t-1">{t-1}|\boldsymbol{x}_t)$çš„æ„å»ºï¼Œè€Œå¯¹äºä»¥$\boldsymbol{y}$ä¸ºè¾“å…¥æ¡ä»¶çš„ç”Ÿæˆæ¥è¯´ï¼Œæ— éå°±æ˜¯å°†$p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t)$æ¢æˆ$p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t, \boldsymbol{y})$è€Œå·²ï¼Œä¹Ÿå°±æ˜¯è¯´ç”Ÿæˆè¿‡ç¨‹ä¸­å¢åŠ è¾“å…¥$\boldsymbol{y}$ã€‚ä¸ºäº†é‡ç”¨å·²ç»è®­ç»ƒå¥½çš„æ— æ¡ä»¶ç”Ÿæˆæ¨¡å‹$p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t)$ï¼Œæˆ‘ä»¬åˆ©ç”¨è´å¶æ–¯å®šç†å¾—<br />
\begin{equation}p(\boldsymbol{x}</em>}|\boldsymbol{y}) = \frac{p(\boldsymbol{x<em t-1="t-1">{t-1})p(\boldsymbol{y}|\boldsymbol{x}</em>})}{p(\boldsymbol{y})}\end{equation<br />
åœ¨æ¯ä¸€é¡¹ä¸Šé¢è¡¥ä¸Šæ¡ä»¶$\boldsymbol{x}<em t-1="t-1">t$ï¼Œå°±å¾—åˆ°<br />
\begin{equation}p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t, \boldsymbol{y}) = \frac{p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t)p(\boldsymbol{y}|\boldsymbol{x}</em>}, \boldsymbol{x<em t-1="t-1">t)}{p(\boldsymbol{y}|\boldsymbol{x}_t)}\label{eq:bayes-1}\end{equation}<br />
æ³¨æ„ï¼Œåœ¨å‰å‘è¿‡ç¨‹ä¸­ï¼Œ$\boldsymbol{x}_t$æ˜¯ç”±$\boldsymbol{x}</em>}$åŠ å™ªå£°å¾—åˆ°çš„ï¼Œå™ªå£°ä¸ä¼šå¯¹åˆ†ç±»æœ‰å¸®åŠ©ï¼Œæ‰€ä»¥$\boldsymbol{x<em t-1="t-1">t$çš„åŠ å…¥å¯¹åˆ†ç±»ä¸ä¼šæœ‰ä»»ä½•æ”¶ç›Šï¼Œå› æ­¤æœ‰$p(\boldsymbol{y}|\boldsymbol{x}</em>}, \boldsymbol{x<em t-1="t-1">t)=p(\boldsymbol{y}|\boldsymbol{x}</em>)$ï¼Œä»è€Œ<br />
\begin{equation}p(\boldsymbol{x}<em t-1="t-1">{t-1}|\boldsymbol{x}_t, \boldsymbol{y}) = \frac{p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t)p(\boldsymbol{y}|\boldsymbol{x}</em>})}{p(\boldsymbol{y}|\boldsymbol{x<em t-1="t-1">t)} = p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t) e^{\log p(\boldsymbol{y}|\boldsymbol{x}</em>}) - \log p(\boldsymbol{y}|\boldsymbol{x}_t)}\label{eq:bayes-2}\end{equation</p>
<h2 id="_3">è¿‘ä¼¼åˆ†å¸ƒ</h2>
<p>å¯¹äºå·²ç»çœ‹è¿‡<a href="/archives/9209">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆäº”ï¼‰ï¼šä¸€èˆ¬æ¡†æ¶ä¹‹SDEç¯‡ã€‹</a>çš„è¯»è€…ï¼Œå¤§æ¦‚ä¼šè§‰å¾—æ¥ä¸‹æ¥çš„è¿‡ç¨‹ä¼¼æ›¾ç›¸è¯†ã€‚ä¸è¿‡å³ä¾¿æ²¡è¯»è¿‡ä¹Ÿä¸è¦ç´§ï¼Œä¸‹é¢æˆ‘ä»¬ä¾æ—§å®Œæ•´æ¨å¯¼ä¸€ä¸‹ã€‚</p>
<p>å½“$T$è¶³å¤Ÿå¤§æ—¶ï¼Œ$p(\boldsymbol{x}<em t-1="t-1">t|\boldsymbol{x}</em>})$çš„æ–¹å·®è¶³å¤Ÿå°ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰$\boldsymbol{x<em t-1="t-1">t$ä¸$\boldsymbol{x}</em>}$å¾ˆæ¥è¿‘æ—¶æ¦‚ç‡æ‰ä¼šæ˜æ˜¾å¤§äº0ã€‚åè¿‡æ¥ä¹Ÿæ˜¯æˆç«‹çš„ï¼Œå³ä¹Ÿåªæœ‰$\boldsymbol{x<em t-1="t-1">t$ä¸$\boldsymbol{x}</em>}$å¾ˆæ¥è¿‘æ—¶$p(\boldsymbol{x<em t-1="t-1">{t-1}|\boldsymbol{x}_t, \boldsymbol{y})$æˆ–$p(\boldsymbol{x}_t|\boldsymbol{x}</em>)$æ‰æ˜æ˜¾å¤§äº0ï¼Œæˆ‘ä»¬åªéœ€è¦é‡ç‚¹è€ƒè™‘è¿™ä¸ªèŒƒå›´å†…çš„æ¦‚ç‡å˜åŒ–ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ç”¨æ³°å‹’å±•å¼€ï¼š}, \boldsymbol{y<br />
\begin{equation}\log p(\boldsymbol{y}|\boldsymbol{x}<em t-1="t-1">{t-1}) - \log p(\boldsymbol{y}|\boldsymbol{x}_t)\approx (\boldsymbol{x}</em>} - \boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t)\cdot\nabla</em><em t-1="t-1">t} \log p(\boldsymbol{y}|\boldsymbol{x}_t)\end{equation}<br />
ä¸¥æ ¼æ¥è®²è¿˜æœ‰ä¸€é¡¹å…³äº$t$çš„å˜åŒ–é¡¹ï¼Œä½†æ˜¯é‚£ä¸€é¡¹è·Ÿ$\boldsymbol{x}</em>}$æ— å…³ï¼Œå±äºä¸å½±å“$\boldsymbol{x<em t-1="t-1">{t-1}$æ¦‚ç‡çš„å¸¸æ•°é¡¹ï¼Œå› æ­¤æˆ‘ä»¬æ²¡æœ‰å†™å‡ºã€‚å‡è®¾åŸæ¥æœ‰$p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t)=\mathcal{N}(\boldsymbol{x}</em>};\boldsymbol{\mu}(\boldsymbol{x<em t-1="t-1">t),\sigma_t^2\boldsymbol{I})\propto e^{-\Vert \boldsymbol{x}</em>} - \boldsymbol{\mu}(\boldsymbol{x<em t-1="t-1">t)\Vert^2/2\sigma_t^2}$ï¼Œé‚£ä¹ˆæ­¤æ—¶è¿‘ä¼¼åœ°æœ‰<br />
\begin{equation}\begin{aligned}<br />
p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t, \boldsymbol{y}) \propto&amp;\, e^{-\Vert \boldsymbol{x}</em>} - \boldsymbol{\mu}(\boldsymbol{x<em t-1="t-1">t)\Vert^2/2\sigma_t^2 + (\boldsymbol{x}</em>} - \boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t)\cdot\nabla</em><em t-1="t-1">t} \log p(\boldsymbol{y}|\boldsymbol{x}_t)} \\\<br />
\propto&amp;\, e^{-\Vert \boldsymbol{x}</em>} - \boldsymbol{\mu}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t) - \sigma_t^2 \nabla</em><em t-1="t-1">t} \log p(\boldsymbol{y}|\boldsymbol{x}_t))\Vert^2/2\sigma_t^2}<br />
\end{aligned}\end{equation}<br />
ä»è¿™ä¸ªç»“æœå¯ä»¥çœ‹å‡ºï¼Œ$p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t, \boldsymbol{y})$è¿‘ä¼¼äº$\mathcal{N}(\boldsymbol{x}</em>};\boldsymbol{\mu}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t) + \sigma_t^2 \nabla</em><em t-1="t-1">t} \log p(\boldsymbol{y}|\boldsymbol{x}_t),\sigma_t^2\boldsymbol{I})$ï¼Œæ‰€ä»¥åªéœ€è¦æŠŠç”Ÿæˆè¿‡ç¨‹çš„é‡‡æ ·æ”¹ä¸º<br />
\begin{equation}\boldsymbol{x}</em>} = \boldsymbol{\mu}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t) \color{skyblue}{+} {\color{skyblue}{\underbrace{\sigma_t^2 \nabla</em><em _text_æ–°å¢é¡¹="\text{æ–°å¢é¡¹">t} \log p(\boldsymbol{y}|\boldsymbol{x}_t)}</em>}}}} + \sigma_t\boldsymbol{\varepsilon},\quad \boldsymbol{\varepsilon}\sim \mathcal{N}(\boldsymbol{0},\boldsymbol{I})\end{equation<br />
è¿™å°±æ˜¯Classifier-Guidanceæ–¹æ¡ˆçš„æ ¸å¿ƒç»“æœã€‚æ³¨æ„ï¼Œ$p(\boldsymbol{y}|\boldsymbol{x}<em o="o">t)$çš„è¾“å…¥æ˜¯åŠ å™ªåçš„æ ·æœ¬$\boldsymbol{x}_t$ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿå¯¹åŠ å™ªæ ·æœ¬è¿›è¡Œé¢„æµ‹çš„æ¨¡å‹ã€‚å¦‚æœæˆ‘ä»¬åªæœ‰å¯¹æ— å™ªæ ·æœ¬é¢„æµ‹çš„æ¨¡å‹$p_o(\boldsymbol{y}|\boldsymbol{x})$ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘çš„$p(\boldsymbol{y}|\boldsymbol{x}_t)$æ˜¯<br />
\begin{equation}p(\boldsymbol{y}|\boldsymbol{x}_t) = p</em>}(\boldsymbol{y}|\boldsymbol{\mu}(\boldsymbol{x}_t))\end{equation<br />
å³åˆ©ç”¨$\boldsymbol{\mu}(\cdot)$å¯¹$\boldsymbol{x}_t$å»å™ªåå†ä¼ å…¥åˆ°$p(\boldsymbol{y}|\boldsymbol{x}_t)$ä¸­ï¼Œè¿™æ ·å°±å…é™¤äº†å¦å¤–ç”¨åŠ å™ªæ ·æœ¬è®­ç»ƒåˆ†ç±»å™¨çš„æˆæœ¬ã€‚</p>
<h2 id="_4">æ¢¯åº¦ç¼©æ”¾</h2>
<p>åŸè®ºæ–‡ï¼ˆ<a href="https://papers.cool/arxiv/2105.05233">ã€ŠDiffusion Models Beat GANs on Image Synthesisã€‹</a>ï¼‰å‘ç°ï¼Œå¾€åˆ†ç±»å™¨çš„æ¢¯åº¦ä¸­å¼•å…¥ä¸€ä¸ªç¼©æ”¾å‚æ•°$\gamma$ï¼Œå¯ä»¥æ›´å¥½åœ°è°ƒèŠ‚ç”Ÿæˆæ•ˆæœï¼š<br />
\begin{equation}\boldsymbol{x}<em _boldsymbol_x="\boldsymbol{x">{t-1} = \boldsymbol{\mu}(\boldsymbol{x}_t) \color{skyblue}{+} \color{skyblue}{\sigma_t^2 \color{red}{\gamma}\nabla</em>}_t} \log p(\boldsymbol{y}|\boldsymbol{x}_t)} + \sigma_t\boldsymbol{\varepsilon},\quad \boldsymbol{\varepsilon}\sim \mathcal{N}(\boldsymbol{0},\boldsymbol{I})\label{eq:gamma-sample}\end{equation<br />
å½“$\gamma &gt; 1$æ—¶ï¼Œç”Ÿæˆè¿‡ç¨‹å°†ä½¿ç”¨æ›´å¤šçš„åˆ†ç±»å™¨ä¿¡å·ï¼Œç»“æœå°†ä¼šæé«˜ç”Ÿæˆç»“æœä¸è¾“å…¥ä¿¡å·$\boldsymbol{y}$çš„ç›¸å…³æ€§ï¼Œä½†æ˜¯ä¼šç›¸åº”åœ°é™ä½ç”Ÿæˆç»“æœçš„å¤šæ ·æ€§ï¼›åä¹‹ï¼Œåˆ™ä¼šé™ä½ç”Ÿæˆç»“æœä¸è¾“å…¥ä¿¡å·ä¹‹é—´çš„ç›¸å…³æ€§ï¼Œä½†å¢åŠ äº†å¤šæ ·æ€§ã€‚</p>
<p>æ€ä¹ˆä»ç†è®ºä¸Šç†è§£è¿™ä¸ªå‚æ•°å‘¢ï¼ŸåŸè®ºæ–‡æå‡ºå°†å®ƒç†è§£ä¸ºé€šè¿‡å¹‚æ“ä½œæ¥æé«˜åˆ†å¸ƒçš„èšç„¦ç¨‹åº¦ï¼Œå³å®šä¹‰<br />
\begin{equation}\tilde{p}(\boldsymbol{y}|\boldsymbol{x}<em _boldsymbol_y="\boldsymbol{y">t) = \frac{p^{\gamma}(\boldsymbol{y}|\boldsymbol{x}_t)}{Z(\boldsymbol{x}_t)},\quad Z(\boldsymbol{x}_t)=\sum</em>}} p^{\gamma}(\boldsymbol{y}|\boldsymbol{x}_t)\end{equation<br />
éšç€$\gamma$çš„å¢åŠ ï¼Œ$\tilde{p}(\boldsymbol{y}|\boldsymbol{x}_t)$çš„é¢„æµ‹ä¼šè¶Šæ¥è¶Šæ¥è¿‘one hotåˆ†å¸ƒï¼Œç”¨å®ƒæ¥ä»£æ›¿$p(\boldsymbol{y}|\boldsymbol{x}_t)$ä½œä¸ºåˆ†ç±»å™¨åšClassifier-Guidanceï¼Œç”Ÿæˆè¿‡ç¨‹ä¼šå€¾å‘äºæŒ‘å‡ºåˆ†ç±»ç½®ä¿¡åº¦å¾ˆé«˜çš„æ ·æœ¬ã€‚</p>
<p>ç„¶è€Œï¼Œè¿™ä¸ªè§’åº¦è™½ç„¶èƒ½æä¾›ä¸€å®šçš„å‚è€ƒä»·å€¼ï¼Œä½†å…¶å®ä¸å®Œå…¨å¯¹ï¼Œå› ä¸º<br />
\begin{equation}\nabla_{\boldsymbol{x}<em _boldsymbol_x="\boldsymbol{x">t}\log \tilde{p}(\boldsymbol{y}|\boldsymbol{x}_t) = \gamma\nabla</em><em _boldsymbol_x="\boldsymbol{x">t} \log p(\boldsymbol{y}|\boldsymbol{x}_t) - \nabla</em><em _boldsymbol_x="\boldsymbol{x">t} \log Z(\boldsymbol{x}_t) \neq \gamma\nabla</em><em _boldsymbol_x="\boldsymbol{x">t} \log p(\boldsymbol{y}|\boldsymbol{x}_t)\end{equation}<br />
åŸè®ºæ–‡é”™è¯¯åœ°è®¤ä¸º$Z(\boldsymbol{x}_t)$æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œæ‰€ä»¥$\nabla</em>_t)=1$ï¼‰çš„æ¢¯åº¦æ€§è´¨èƒ½è¿‘ä¼¼åœ°æ³›åŒ–åˆ°$\gamma\neq 1$çš„æƒ…å½¢ã€‚}_t} \log Z(\boldsymbol{x}_t)=0$ï¼Œä½†äº‹å®ä¸Š$\gamma\neq 1$æ—¶ï¼Œ$Z(\boldsymbol{x}_t)$ä¼šæ˜¾å¼åœ°ä¾èµ–äº$\boldsymbol{x}_t$ã€‚ç¬”è€…ä¹Ÿç»§ç»­æ€è€ƒäº†ä¸€ä¸‹æœ‰æ²¡æœ‰ä»€ä¹ˆè¡¥æ•‘æ–¹æ³•ï¼Œä½†å¾ˆé—æ†¾æ²¡ä»€ä¹ˆç»“æœï¼Œä»¿ä½›åªèƒ½å¾ˆå‹‰å¼ºåœ°è®¤ä¸º$\gamma=1$æ—¶ï¼ˆæ­¤æ—¶$Z(\boldsymbol{x</p>
<h2 id="_5">ç›¸ä¼¼æ§åˆ¶</h2>
<p>äº‹å®ä¸Šï¼Œç†è§£$\gamma\neq 1$çš„æœ€ä½³æ–¹æ¡ˆï¼Œå°±æ˜¯æ”¾å¼ƒä»è´å¶æ–¯å®šç†çš„å¼$\eqref{eq:bayes-1}$å’Œå¼$\eqref{eq:bayes-2}$æ¥ç†è§£$p(\boldsymbol{x}<em t-1="t-1">{t-1}|\boldsymbol{x}_t, \boldsymbol{y})$ï¼Œè€Œæ˜¯ç›´æ¥å®šä¹‰<br />
\begin{equation}p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t, \boldsymbol{y}) = \frac{p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t) e^{\gamma\cdot\text{sim}(\boldsymbol{x}</em>}, \boldsymbol{y})}}{Z(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t, \boldsymbol{y})},\quad Z(\boldsymbol{x}_t,\boldsymbol{y})=\sum</em><em t-1="t-1">{t-1}} p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t) e^{\gamma\cdot\text{sim}(\boldsymbol{x}</em>}, \boldsymbol{y})}\end{equation<br />
å…¶ä¸­$\text{sim}(\boldsymbol{x}<em t-1="t-1">{t-1}, \boldsymbol{y})$æ˜¯ç”Ÿæˆç»“æœ$\boldsymbol{x}</em>}$ä¸æ¡ä»¶$\boldsymbol{y}$çš„æŸä¸ªç›¸ä¼¼æˆ–ç›¸å…³åº¦é‡ã€‚åœ¨è¿™ä¸ªè§’åº¦ä¸‹ï¼Œ$\gamma$ç›´æ¥èäº$p(\boldsymbol{x<em t-1="t-1">{t-1}|\boldsymbol{x}_t, \boldsymbol{y})$çš„å®šä¹‰ä¸­ï¼Œç›´æ¥æ§åˆ¶ç»“æœä¸æ¡ä»¶çš„ç›¸å…³æ€§ï¼Œå½“$\gamma$è¶Šå¤§ï¼Œæ¨¡å‹ä¼šå€¾å‘äºç”Ÿæˆè·Ÿ$\boldsymbol{y}$è¶Šç›¸å…³çš„$\boldsymbol{x}</em>$ã€‚</p>
<p>ä¸ºäº†è¿›ä¸€æ­¥å¾—åˆ°å¯é‡‡æ ·çš„è¿‘ä¼¼ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥åœ¨$\boldsymbol{x}<em t-1="t-1">{t-1}=\boldsymbol{x}_t$å¤„ï¼ˆä¹Ÿå¯ä»¥åœ¨$\boldsymbol{x}</em>}=\boldsymbol{\mu}(\boldsymbol{x<em t-1="t-1">t)$ï¼Œè·Ÿå‰é¢ç±»ä¼¼ï¼‰å±•å¼€<br />
\begin{equation}e^{\gamma\cdot\text{sim}(\boldsymbol{x}</em>}, \boldsymbol{y})}\approx e^{\gamma\cdot\text{sim}(\boldsymbol{x<em t-1="t-1">t, \boldsymbol{y}) + \gamma\cdot(\boldsymbol{x}</em>}-\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t)\cdot\nabla</em><em t-1="t-1">t}\text{sim}(\boldsymbol{x}_t, \boldsymbol{y})}<br />
\end{equation}<br />
å‡è®¾æ­¤è¿‘ä¼¼ç¨‹åº¦å·²ç»è¶³å¤Ÿï¼Œé‚£ä¹ˆé™¤å»ä¸$\boldsymbol{x}</em>$æ— å…³çš„é¡¹ï¼Œæˆ‘ä»¬å¾—åˆ°<br />
\begin{equation}p(\boldsymbol{x}<em t-1="t-1">{t-1}|\boldsymbol{x}_t, \boldsymbol{y})\propto p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t)e^{\gamma\cdot(\boldsymbol{x}</em>}-\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t)\cdot\nabla</em><em t-1="t-1">t}\text{sim}(\boldsymbol{x}_t, \boldsymbol{y})}<br />
\end{equation}<br />
è·Ÿå‰é¢ä¸€æ ·ï¼Œä»£å…¥$p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t)=\mathcal{N}(\boldsymbol{x}</em>};\boldsymbol{\mu}(\boldsymbol{x<em t-1="t-1">t),\sigma_t^2\boldsymbol{I})$ï¼Œé…æ–¹åå¾—åˆ°<br />
\begin{equation}p(\boldsymbol{x}</em>}|\boldsymbol{x<em t-1="t-1">t, \boldsymbol{y})\approx \mathcal{N}(\boldsymbol{x}</em>}; \boldsymbol{\mu}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t) + \sigma_t^2\gamma \nabla</em>)}_t} \text{sim}(\boldsymbol{x}_t, \boldsymbol{y}),\sigma_t^2\boldsymbol{I<br />
\end{equation}</p>
<p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦çº ç»“$p(\boldsymbol{y}|\boldsymbol{x}_t)$çš„æ¦‚ç‡æ„ä¹‰ï¼Œè€Œæ˜¯åªéœ€è¦ç›´æ¥å®šä¹‰åº¦é‡å‡½æ•°$\text{sim}(\boldsymbol{x}_t, \boldsymbol{y})$ï¼Œè¿™é‡Œçš„$\boldsymbol{y}$ä¹Ÿä¸å†æ˜¯ä»…é™äºâ€œç±»åˆ«â€ï¼Œä¹Ÿå¯ä»¥æ˜¯æ–‡æœ¬ã€å›¾åƒç­‰ä»»æ„è¾“å…¥ä¿¡å·ï¼Œé€šå¸¸çš„å¤„ç†æ–¹å¼æ˜¯ç”¨å„è‡ªçš„ç¼–ç å™¨å°†å…¶ç¼–ç ä¸ºç‰¹å¾å‘é‡ï¼Œç„¶åç”¨cosç›¸ä¼¼åº¦ï¼š<br />
\begin{equation}\text{sim}(\boldsymbol{x}_t, \boldsymbol{y}) = \frac{E_1(\boldsymbol{x}_t)\cdot E_2(\boldsymbol{y})}{\Vert E_1(\boldsymbol{x}_t)\Vert \Vert E_2(\boldsymbol{y})\Vert}\end{equation}<br />
è¦æŒ‡å‡ºçš„æ˜¯ï¼Œä¸­é—´è¿‡ç¨‹çš„$\boldsymbol{x}_t$æ˜¯å¸¦é«˜æ–¯å™ªå£°çš„ï¼Œæ‰€ä»¥ç¼–ç å™¨$E_1$ä¸€èˆ¬ä¸èƒ½ç›´æ¥è°ƒç”¨å¹²å‡€æ•°æ®è®­ç»ƒçš„ç¼–ç å™¨ï¼Œè€Œæ˜¯è¦ç”¨åŠ å™ªå£°åçš„æ•°æ®å¯¹å®ƒè¿›è¡Œå¾®è°ƒæ‰æ¯”è¾ƒå¥½ã€‚æ­¤å¤–ï¼Œå¦‚æœåšé£æ ¼è¿ç§»çš„ï¼Œé€šå¸¸åˆ™æ˜¯ç”¨GramçŸ©é˜µè·ç¦»è€Œä¸æ˜¯cosç›¸ä¼¼åº¦ï¼Œè¿™äº›éƒ½çœ‹åœºæ™¯å‘æŒ¥äº†ã€‚ä»¥ä¸Šä¾¿æ˜¯è®ºæ–‡<a href="https://papers.cool/arxiv/2112.05744">ã€ŠMore Control for Free! Image Synthesis with Semantic Diffusion Guidanceã€‹</a>çš„ä¸€ç³»åˆ—ç»“æœï¼Œæ›´å¤šç»†èŠ‚å¯ä»¥è‡ªè¡Œå‚è€ƒåŸè®ºæ–‡ã€‚</p>
<h2 id="_6">è¿ç»­æƒ…å½¢</h2>
<p>ç»è¿‡å‰é¢çš„æ¨å¯¼ï¼Œæˆ‘ä»¬å¾—åˆ°å‡å€¼çš„ä¿®æ­£é¡¹ä¸º$\sigma_t^2 \gamma \nabla_{\boldsymbol{x}<em _boldsymbol_x="\boldsymbol{x">t} \log p(\boldsymbol{y}|\boldsymbol{x}_t)$æˆ–$\sigma_t^2\gamma \nabla</em>)$ï¼Œå®ƒä»¬éƒ½æœ‰ä¸€ä¸ªå…±åŒç‰¹ç‚¹ï¼Œå°±æ˜¯$\sigma_t=0$æ—¶ï¼Œä¿®æ­£é¡¹ä¹Ÿç­‰äº0ï¼Œä¿®æ­£å°±å¤±æ•ˆäº†ã€‚}_t} \text{sim}(\boldsymbol{x}_t, \boldsymbol{y</p>
<p>é‚£ä¹ˆç”Ÿæˆè¿‡ç¨‹çš„$\sigma_t$å¯ä»¥ç­‰äº0å—ï¼Ÿè‚¯å®šå¯ä»¥ï¼Œæ¯”å¦‚<a href="/archives/9181">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆå››ï¼‰ï¼šDDIM = é«˜è§‚ç‚¹DDPMã€‹</a>ä»‹ç»çš„DDIMï¼Œå°±æ˜¯æ–¹å·®ä¸º0çš„ç”Ÿæˆè¿‡ç¨‹ï¼Œè¿™ç§æƒ…å†µä¸‹åº”è¯¥æ€æ ·åšæ§åˆ¶ç”Ÿæˆå‘¢ï¼Ÿæ­¤æ—¶æˆ‘ä»¬éœ€è¦ç”¨åˆ°<a href="/archives/9228">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆå…­ï¼‰ï¼šä¸€èˆ¬æ¡†æ¶ä¹‹ODEç¯‡ã€‹</a>ä»‹ç»çš„åŸºäºSDEçš„ä¸€èˆ¬ç»“æœäº†ï¼Œåœ¨é‡Œè¾¹æˆ‘ä»¬ä»‹ç»åˆ°ï¼Œå¯¹äºå‰å‘SDEï¼š<br />
\begin{equation}d\boldsymbol{x} = \boldsymbol{f}<em _boldsymbol_x="\boldsymbol{x">t(\boldsymbol{x}) dt + g_t d\boldsymbol{w}\end{equation}<br />
å¯¹åº”çš„æœ€ä¸€èˆ¬çš„åå‘SDEä¸º<br />
\begin{equation}d\boldsymbol{x} = \left(\boldsymbol{f}_t(\boldsymbol{x}) - \frac{1}{2}(g_t^2 + \sigma_t^2)\nabla</em>}}\log p_t(\boldsymbol{x})\right) dt + \sigma_t d\boldsymbol{w}\end{equation<br />
è¿™é‡Œå…è®¸æˆ‘ä»¬è‡ªç”±é€‰æ‹©åå‘æ–¹å·®$\sigma_t^2$ï¼ŒDDPMã€DDIMéƒ½å¯ä»¥è®¤ä¸ºæ˜¯å®ƒçš„ç‰¹ä¾‹ï¼Œå…¶ä¸­$\sigma_t=0$æ—¶å°±æ˜¯ä¸€èˆ¬åŒ–çš„DDIMã€‚å¯ä»¥çœ‹åˆ°ï¼Œåå‘SDEè·Ÿè¾“å…¥æœ‰å…³çš„å°±æ˜¯$\nabla_{\boldsymbol{x}}\log p_t(\boldsymbol{x})$ï¼Œå¦‚æœè¦åšæ¡ä»¶ç”Ÿæˆï¼Œè‡ªç„¶æ˜¯è¦å°†å®ƒæ¢æˆ$\nabla_{\boldsymbol{x}}\log p_t(\boldsymbol{x}|\boldsymbol{y})$ï¼Œç„¶ååˆ©ç”¨è´å¶æ–¯å®šç†ï¼Œæœ‰<br />
\begin{equation}\nabla_{\boldsymbol{x}}\log p_t(\boldsymbol{x}|\boldsymbol{y}) = \nabla_{\boldsymbol{x}}\log p_t(\boldsymbol{x}) + \nabla_{\boldsymbol{x}}\log p_t(\boldsymbol{y}|\boldsymbol{x})\end{equation}<br />
åœ¨ä¸€èˆ¬çš„å‚æ•°åŒ–ä¸‹æœ‰$\nabla_{\boldsymbol{x}}\log p_t(\boldsymbol{x}) = -\frac{\boldsymbol{\epsilon}<em _boldsymbol_x="\boldsymbol{x">{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)}{\bar{\beta}_t}$ï¼Œå› æ­¤<br />
\begin{equation}\nabla</em>}}\log p_t(\boldsymbol{x}|\boldsymbol{y}) = -\frac{\boldsymbol{\epsilon<em _boldsymbol_x="\boldsymbol{x">{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)}{\bar{\beta}_t} + \nabla</em>}}\log p_t(\boldsymbol{y}|\boldsymbol{x}) = -\frac{\boldsymbol{\epsilon<em _boldsymbol_x="\boldsymbol{x">{\boldsymbol{\theta}}(\boldsymbol{x}_t, t) - \bar{\beta}_t\nabla</em>}}\log p_t(\boldsymbol{y}|\boldsymbol{x})}{\bar{\beta<em _boldsymbol_theta="\boldsymbol{\theta">t}\end{equation}<br />
è¿™å°±æ„å‘³ç€ï¼Œä¸ç®¡ç”Ÿæˆæ–¹å·®æ˜¯å¤šå°‘ï¼Œæˆ‘ä»¬åªéœ€è¦ç”¨$\boldsymbol{\epsilon}</em>}}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t, t) - \bar{\beta}_t\nabla</em>_t, t)$å°±å¯ä»¥å®ç°æ¡ä»¶æ§åˆ¶ç”Ÿæˆäº†ã€‚å› æ­¤ï¼Œåœ¨SDEçš„ç»Ÿä¸€è§†è§’ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥éå¸¸ç®€å•è€Œç›´æ¥åœ°å¾—åˆ°Classifier-Guidanceæ–¹æ¡ˆçš„æœ€ä¸€èˆ¬ç»“æœã€‚}}\log p_t(\boldsymbol{y}|\boldsymbol{x})$ä»£æ›¿$\boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x</p>
<h2 id="_7">æ— åˆ†ç±»å™¨</h2>
<p>æœ€åï¼Œæˆ‘ä»¬æ¥ç®€å•ä»‹ç»ä¸€ä¸‹Classifier-Freeæ–¹æ¡ˆã€‚å…¶å®å¾ˆç®€å•ï¼Œå®ƒå°±æ˜¯ç›´æ¥å®šä¹‰<br />
\begin{equation}p(\boldsymbol{x}<em t-1="t-1">{t-1}|\boldsymbol{x}_t, \boldsymbol{y}) = \mathcal{N}(\boldsymbol{x}</em>}; \boldsymbol{\mu}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, \boldsymbol{y}),\sigma_t^2\boldsymbol{I})<br />
\end{equation}<br />
æ²¿ç”¨å‰é¢DDPMçš„å‡ ç¯‡æ–‡ç« çš„ç»“æœï¼Œ$\boldsymbol{\mu}(\boldsymbol{x}_t, \boldsymbol{y})$ä¸€èˆ¬å‚æ•°åŒ–ä¸º<br />
\begin{equation}\boldsymbol{\mu}(\boldsymbol{x}_t, \boldsymbol{y}) = \frac{1}{\alpha_t}\left(\boldsymbol{x}_t - \frac{\beta_t^2}{\bar{\beta}_t}\boldsymbol{\epsilon}</em>}}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t, \boldsymbol{y}, t)\right)\end{equation}<br />
è®­ç»ƒçš„æŸå¤±å‡½æ•°å°±æ˜¯<br />
\begin{equation}\mathbb{E}</em><em _boldsymbol_theta="\boldsymbol{\theta">0,\boldsymbol{y}\sim\tilde{p}(\boldsymbol{x}_0,\boldsymbol{y}), \boldsymbol{\varepsilon}\sim\mathcal{N}(\boldsymbol{0}, \boldsymbol{I})}\left[\left\Vert\boldsymbol{\varepsilon} - \boldsymbol{\epsilon}</em>}}(\bar{\alpha}_t \boldsymbol{x}_0 + \bar{\beta}_t \boldsymbol{\varepsilon}, \boldsymbol{y}, t)\right\Vert^2\right]\end{equation<br />
å®ƒçš„ä¼˜ç‚¹æ˜¯åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å°±å¼•å…¥äº†é¢å¤–çš„è¾“å…¥$\boldsymbol{y}$ï¼Œç†è®ºä¸Šè¾“å…¥ä¿¡æ¯è¶Šå¤šè¶Šå®¹æ˜“è®­ç»ƒï¼›å®ƒçš„ç¼ºç‚¹ä¹Ÿæ˜¯åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å°±å¼•å…¥äº†é¢å¤–çš„è¾“å…¥$\boldsymbol{y}$ï¼Œæ„å‘³ç€æ¯åšä¸€ç»„ä¿¡å·æ§åˆ¶ï¼Œå°±è¦é‡æ–°è®­ç»ƒæ•´ä¸ªæ‰©æ•£æ¨¡å‹ã€‚</p>
<p>ç‰¹åˆ«åœ°ï¼ŒClassifier-Freeæ–¹æ¡ˆä¹Ÿæ¨¡ä»¿Classifier-Guidanceæ–¹æ¡ˆåŠ å…¥äº†$\gamma$å‚æ•°çš„ç¼©æ”¾æœºåˆ¶æ¥å¹³è¡¡ç›¸å…³æ€§ä¸å¤šæ ·æ€§ã€‚å…·ä½“æ¥è¯´ï¼Œå¼$\eqref{eq:gamma-sample}$çš„å‡å€¼å¯ä»¥æ”¹å†™æˆï¼š<br />
\begin{equation}\boldsymbol{\mu}(\boldsymbol{x}<em _boldsymbol_x="\boldsymbol{x">t) + \sigma_t^2 \gamma \nabla</em><em _boldsymbol_x="\boldsymbol{x">t} \log p(\boldsymbol{y}|\boldsymbol{x}_t) = \gamma\left[\boldsymbol{\mu}(\boldsymbol{x}_t) + \sigma_t^2 \nabla</em><em _boldsymbol_x="\boldsymbol{x">t} \log p(\boldsymbol{y}|\boldsymbol{x}_t)\right] - (\gamma - 1) \boldsymbol{\mu}(\boldsymbol{x}_t)\end{equation}<br />
Classifier-Freeæ–¹æ¡ˆç›¸å½“äºç›´æ¥ç”¨ç›´æ¥ç”¨æ¨¡å‹æ‹Ÿåˆäº†$\boldsymbol{\mu}(\boldsymbol{x}_t) + \sigma_t^2 \nabla</em><em _boldsymbol_theta="\boldsymbol{\theta">t} \log p(\boldsymbol{y}|\boldsymbol{x}_t)$ï¼Œé‚£ä¹ˆç±»æ¯”ä¸Šå¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨Classifier-Freeæ–¹æ¡ˆä¸­å¼•å…¥$w=\gamma - 1$å‚æ•°ï¼Œç”¨<br />
\begin{equation}\tilde{\boldsymbol{\epsilon}}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, \boldsymbol{y}, t) = (1 + w)\boldsymbol{\epsilon}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, \boldsymbol{y}, t) - w \boldsymbol{\epsilon}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, t)\end{equation}<br />
ä»£æ›¿$\boldsymbol{\epsilon}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, \boldsymbol{y}, t)$æ¥åšç”Ÿæˆã€‚é‚£æ— æ¡ä»¶çš„$\boldsymbol{\epsilon}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, t)$æ€ä¹ˆæ¥å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æ–°å¼•å…¥ä¸€ä¸ªç‰¹å®šçš„è¾“å…¥$\boldsymbol{\phi}$ï¼Œå®ƒå¯¹åº”çš„ç›®æ ‡å›¾åƒä¸ºå…¨ä½“å›¾åƒï¼ŒåŠ åˆ°äº†æ¨¡å‹çš„è®­ç»ƒä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è®¤ä¸º$\boldsymbol{\epsilon}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, t)=\boldsymbol{\epsilon}</em>, t)$äº†ã€‚}}(\boldsymbol{x}_t, \boldsymbol{\phi</p>
<h2 id="_8">æ–‡ç« å°ç»“</h2>
<p>æœ¬æ–‡ç®€å•ä»‹ç»äº†å»ºç«‹æ¡ä»¶æ‰©æ•£æ¨¡å‹çš„ç›¸å…³ç†è®ºç»“æœï¼Œä¸»è¦åŒ…å«äº‹åä¿®æ”¹ï¼ˆClassifier-Guidanceï¼‰å’Œäº‹å‰è®­ç»ƒï¼ˆClassifier-Freeï¼‰ä¸¤ç§æ–¹æ¡ˆã€‚å…¶ä¸­ï¼Œå‰è€…ä¸éœ€è¦é‡æ–°è®­ç»ƒæ‰©æ•£æ¨¡å‹ï¼Œå¯ä»¥ä½æˆæœ¬å®ç°ç®€å•çš„æ§åˆ¶ï¼›åè€…éœ€è¦é‡æ–°è®­ç»ƒæ‰©æ•£æ¨¡å‹ï¼Œæˆæœ¬è¾ƒå¤§ï¼Œä½†å¯ä»¥å®ç°æ¯”è¾ƒç²¾ç»†çš„æ§åˆ¶ã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/9257">https://spaces.ac.cn/archives/9257</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Aug. 30, 2022). ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆä¹ï¼‰ï¼šæ¡ä»¶æ§åˆ¶ç”Ÿæˆç»“æœ ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/9257">https://spaces.ac.cn/archives/9257</a></p>
<p>@online{kexuefm-9257,<br />
title={ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆä¹ï¼‰ï¼šæ¡ä»¶æ§åˆ¶ç”Ÿæˆç»“æœ},<br />
author={è‹å‰‘æ—},<br />
year={2022},<br />
month={Aug},<br />
url={\url{https://spaces.ac.cn/archives/9257}},<br />
} </p>
<hr />
<h2 id="_9">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<h3 id="1">1. æ ¸å¿ƒæ¦‚å¿µä¸ç†è®ºåŸºç¡€</h3>
<h4 id="11">1.1 æ¡ä»¶ç”Ÿæˆçš„åŠ¨æœº</h4>
<p>åœ¨æ— æ¡ä»¶æ‰©æ•£æ¨¡å‹ä¸­,ç”Ÿæˆè¿‡ç¨‹ä¸º:
$$p(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t) \tag{1}$$</p>
<p>è¿™ä¼šéšæœºç”Ÿæˆæ•°æ®åˆ†å¸ƒä¸­çš„æ ·æœ¬,ä½†æˆ‘ä»¬æ— æ³•æ§åˆ¶ç”Ÿæˆä»€ä¹ˆå†…å®¹ã€‚</p>
<p><strong>æ¡ä»¶ç”Ÿæˆçš„ç›®æ ‡:</strong> ç»™å®šæ¡ä»¶$\boldsymbol{y}$(å¦‚ç±»åˆ«ã€æ–‡æœ¬ã€å›¾åƒç­‰),ç”Ÿæˆæ»¡è¶³è¯¥æ¡ä»¶çš„æ ·æœ¬:
$$p(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t, \boldsymbol{y}) \tag{2}$$</p>
<p><strong>ä¸¤ç§ä¸»è¦æ–¹æ¡ˆ:</strong>
1. <strong>Classifier-Guidance (CG):</strong> äº‹åä¿®æ”¹,ä½¿ç”¨åˆ†ç±»å™¨å¼•å¯¼å·²è®­ç»ƒçš„æ— æ¡ä»¶æ¨¡å‹
2. <strong>Classifier-Free (CF):</strong> äº‹å‰è®­ç»ƒ,åœ¨è®­ç»ƒæ—¶ç›´æ¥åŠ å…¥æ¡ä»¶ä¿¡å·</p>
<h4 id="12">1.2 æ‰©æ•£æ¨¡å‹çš„ç”Ÿæˆè¿‡ç¨‹å›é¡¾</h4>
<p>æ ‡å‡†çš„DDPMç”Ÿæˆè¿‡ç¨‹å»ºæ¨¡ä¸º:
$$p(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t) = \mathcal{N}(\boldsymbol{x}_{t-1}; \boldsymbol{\mu}(\boldsymbol{x}_t), \sigma_t^2\boldsymbol{I}) \tag{3}$$</p>
<p>å…¶ä¸­å‡å€¼å‚æ•°åŒ–ä¸º:
$$\boldsymbol{\mu}(\boldsymbol{x}_t) = \frac{1}{\alpha_t}\left(\boldsymbol{x}_t - \frac{\beta_t^2}{\bar{\beta}_t}\boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)\right) \tag{4}$$</p>
<p>é‡‡æ ·è¿‡ç¨‹ä¸º:
$$\boldsymbol{x}_{t-1} = \boldsymbol{\mu}(\boldsymbol{x}_t) + \sigma_t\boldsymbol{\varepsilon}, \quad \boldsymbol{\varepsilon} \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{I}) \tag{5}$$</p>
<h3 id="2-classifier-guidance">2. Classifier-Guidanceæ–¹æ¡ˆçš„æ¨å¯¼</h3>
<h4 id="21">2.1 è´å¶æ–¯å®šç†çš„åº”ç”¨</h4>
<p><strong>ç›®æ ‡:</strong> å°†æ— æ¡ä»¶åˆ†å¸ƒ$p(\boldsymbol{x}<em t-1="t-1">{t-1}|\boldsymbol{x}_t)$è½¬åŒ–ä¸ºæ¡ä»¶åˆ†å¸ƒ$p(\boldsymbol{x}</em>)$ã€‚}|\boldsymbol{x}_t, \boldsymbol{y</p>
<p><strong>åŸºæœ¬è´å¶æ–¯å®šç†:</strong>
$$p(\boldsymbol{x}_{t-1}|\boldsymbol{y}) = \frac{p(\boldsymbol{x}_{t-1})p(\boldsymbol{y}|\boldsymbol{x}_{t-1})}{p(\boldsymbol{y})} \tag{6}$$</p>
<p><strong>åœ¨æ¯é¡¹ä¸Šæ·»åŠ æ¡ä»¶$\boldsymbol{x}_t$:</strong>
$$p(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t, \boldsymbol{y}) = \frac{p(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t)p(\boldsymbol{y}|\boldsymbol{x}_{t-1}, \boldsymbol{x}_t)}{p(\boldsymbol{y}|\boldsymbol{x}_t)} \tag{7}$$</p>
<p><strong>å…³é”®è§‚å¯Ÿ:</strong> åœ¨å‰å‘æ‰©æ•£è¿‡ç¨‹ä¸­,$\boldsymbol{x}<em t-1="t-1">t$ç”±$\boldsymbol{x}</em>$åŠ å™ªå£°å¾—åˆ°:
$$\boldsymbol{x}_t = \alpha_t\boldsymbol{x}_{t-1} + \beta_t\boldsymbol{\varepsilon}, \quad \boldsymbol{\varepsilon} \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{I}) \tag{8}$$</p>
<p><strong>ç›´è§‰ç†è§£:</strong> å™ªå£°$\boldsymbol{\varepsilon}$ä¸åŒ…å«ä»»ä½•è¯­ä¹‰ä¿¡æ¯,å› æ­¤:
$$p(\boldsymbol{y}|\boldsymbol{x}_{t-1}, \boldsymbol{x}_t) = p(\boldsymbol{y}|\boldsymbol{x}_{t-1}) \tag{9}$$</p>
<p><strong>æœ€ç»ˆè´å¶æ–¯å½¢å¼:</strong>
$$p(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t, \boldsymbol{y}) = \frac{p(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t)p(\boldsymbol{y}|\boldsymbol{x}_{t-1})}{p(\boldsymbol{y}|\boldsymbol{x}_t)} \tag{10}$$</p>
<p><strong>å¯¹æ•°å½¢å¼æ”¹å†™:</strong>
$$p(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t, \boldsymbol{y}) = p(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t) \exp\left[\log p(\boldsymbol{y}|\boldsymbol{x}_{t-1}) - \log p(\boldsymbol{y}|\boldsymbol{x}_t)\right] \tag{11}$$</p>
<h4 id="22">2.2 æ³°å‹’å±•å¼€ä¸è¿‘ä¼¼</h4>
<p><strong>å‡è®¾:</strong> å½“$T$è¶³å¤Ÿå¤§æ—¶,$\sigma_t^2$è¶³å¤Ÿå°,$\boldsymbol{x}_{t-1}$å’Œ$\boldsymbol{x}_t$éå¸¸æ¥è¿‘ã€‚</p>
<p><strong>åœ¨$\boldsymbol{x}_t$å¤„å¯¹å¯¹æ•°æ¦‚ç‡è¿›è¡Œä¸€é˜¶æ³°å‹’å±•å¼€:</strong>
$$\log p(\boldsymbol{y}|\boldsymbol{x}_{t-1}) \approx \log p(\boldsymbol{y}|\boldsymbol{x}_t) + (\boldsymbol{x}_{t-1} - \boldsymbol{x}_t) \cdot \nabla_{\boldsymbol{x}_t} \log p(\boldsymbol{y}|\boldsymbol{x}_t) + \frac{1}{2}(\boldsymbol{x}_{t-1} - \boldsymbol{x}_t)^T H (\boldsymbol{x}_{t-1} - \boldsymbol{x}_t) \tag{12}$$</p>
<p>å…¶ä¸­$H$æ˜¯HessiançŸ©é˜µã€‚</p>
<p><strong>ç®€åŒ–è¿‘ä¼¼(å¿½ç•¥äºŒé˜¶é¡¹):</strong>
$$\log p(\boldsymbol{y}|\boldsymbol{x}_{t-1}) - \log p(\boldsymbol{y}|\boldsymbol{x}_t) \approx (\boldsymbol{x}_{t-1} - \boldsymbol{x}_t) \cdot \nabla_{\boldsymbol{x}_t} \log p(\boldsymbol{y}|\boldsymbol{x}_t) \tag{13}$$</p>
<p><strong>æ³¨æ„:</strong> å…³äºæ—¶é—´$t$çš„å˜åŒ–é¡¹$\frac{\partial}{\partial t}\log p(\boldsymbol{y}|\boldsymbol{x}<em t-1="t-1">t)$ä¸$\boldsymbol{x}</em>$æ— å…³,å› æ­¤åœ¨æ¦‚ç‡å½’ä¸€åŒ–æ—¶ä¼šè¢«å¸æ”¶ä¸ºå¸¸æ•°ã€‚</p>
<h4 id="23">2.3 é…æ–¹å¾—åˆ°æ¡ä»¶åˆ†å¸ƒ</h4>
<p><strong>ä»£å…¥æ— æ¡ä»¶é«˜æ–¯åˆ†å¸ƒ:</strong>
$$p(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t) = \mathcal{N}(\boldsymbol{x}_{t-1}; \boldsymbol{\mu}(\boldsymbol{x}_t), \sigma_t^2\boldsymbol{I}) \propto \exp\left[-\frac{1}{2\sigma_t^2}\|\boldsymbol{x}_{t-1} - \boldsymbol{\mu}(\boldsymbol{x}_t)\|^2\right] \tag{14}$$</p>
<p><strong>ç»“åˆæ³°å‹’å±•å¼€ç»“æœ:</strong>
$$p(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t, \boldsymbol{y}) \propto \exp\left[-\frac{1}{2\sigma_t^2}\|\boldsymbol{x}_{t-1} - \boldsymbol{\mu}(\boldsymbol{x}_t)\|^2 + (\boldsymbol{x}_{t-1} - \boldsymbol{x}_t) \cdot \nabla_{\boldsymbol{x}_t} \log p(\boldsymbol{y}|\boldsymbol{x}_t)\right] \tag{15}$$</p>
<p><strong>å±•å¼€äºŒæ¬¡é¡¹:</strong>
$$-\frac{1}{2\sigma_t^2}\|\boldsymbol{x}_{t-1} - \boldsymbol{\mu}(\boldsymbol{x}_t)\|^2 = -\frac{1}{2\sigma_t^2}\left[\|\boldsymbol{x}_{t-1}\|^2 - 2\boldsymbol{x}_{t-1} \cdot \boldsymbol{\mu}(\boldsymbol{x}_t) + \|\boldsymbol{\mu}(\boldsymbol{x}_t)\|^2\right] \tag{16}$$</p>
<p><strong>ä¸€æ¬¡é¡¹:</strong>
$$(\boldsymbol{x}_{t-1} - \boldsymbol{x}_t) \cdot \nabla_{\boldsymbol{x}_t} \log p(\boldsymbol{y}|\boldsymbol{x}_t) = \boldsymbol{x}_{t-1} \cdot \nabla_{\boldsymbol{x}_t} \log p(\boldsymbol{y}|\boldsymbol{x}_t) - \boldsymbol{x}_t \cdot \nabla_{\boldsymbol{x}_t} \log p(\boldsymbol{y}|\boldsymbol{x}_t) \tag{17}$$</p>
<p><strong>åˆå¹¶$\boldsymbol{x}_{t-1}$çš„ä¸€æ¬¡é¡¹:</strong>
$$\boldsymbol{x}_{t-1} \cdot \left[\frac{1}{\sigma_t^2}\boldsymbol{\mu}(\boldsymbol{x}_t) + \nabla_{\boldsymbol{x}_t} \log p(\boldsymbol{y}|\boldsymbol{x}_t)\right] \tag{18}$$</p>
<p><strong>é…æ–¹å¾—åˆ°æ–°çš„å‡å€¼:</strong>
$$p(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t, \boldsymbol{y}) \propto \exp\left[-\frac{1}{2\sigma_t^2}\left\|\boldsymbol{x}_{t-1} - \left[\boldsymbol{\mu}(\boldsymbol{x}_t) + \sigma_t^2 \nabla_{\boldsymbol{x}_t} \log p(\boldsymbol{y}|\boldsymbol{x}_t)\right]\right\|^2\right] \tag{19}$$</p>
<p><strong>æœ€ç»ˆæ¡ä»¶åˆ†å¸ƒ:</strong>
$$p(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t, \boldsymbol{y}) \approx \mathcal{N}(\boldsymbol{x}_{t-1}; \boldsymbol{\mu}(\boldsymbol{x}_t) + \sigma_t^2 \nabla_{\boldsymbol{x}_t} \log p(\boldsymbol{y}|\boldsymbol{x}_t), \sigma_t^2\boldsymbol{I}) \tag{20}$$</p>
<h4 id="24">2.4 æ¡ä»¶é‡‡æ ·ç®—æ³•</h4>
<p><strong>ä¿®æ­£åçš„é‡‡æ ·å…¬å¼:</strong>
$$\boldsymbol{x}_{t-1} = \boldsymbol{\mu}(\boldsymbol{x}_t) + \sigma_t^2 \nabla_{\boldsymbol{x}_t} \log p(\boldsymbol{y}|\boldsymbol{x}_t) + \sigma_t\boldsymbol{\varepsilon}, \quad \boldsymbol{\varepsilon} \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{I}) \tag{21}$$</p>
<p><strong>æ¢¯åº¦é¡¹$\nabla_{\boldsymbol{x}_t} \log p(\boldsymbol{y}|\boldsymbol{x}_t)$çš„å«ä¹‰:</strong>
- è¿™æ˜¯å¯¹æ•°ä¼¼ç„¶çš„æ¢¯åº¦,æŒ‡å‘ä½¿æ¡ä»¶æ¦‚ç‡$p(\boldsymbol{y}|\boldsymbol{x}_t)$å¢å¤§çš„æ–¹å‘
- æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª"å¼•å¯¼åŠ›",å°†ç”Ÿæˆè¿‡ç¨‹æ¨å‘æ»¡è¶³æ¡ä»¶$\boldsymbol{y}$çš„æ ·æœ¬</p>
<p><strong>åˆ†ç±»å™¨çš„é€‰æ‹©:</strong>
- <strong>ç†æƒ³æƒ…å†µ:</strong> è®­ç»ƒå¯¹åŠ å™ªæ ·æœ¬$\boldsymbol{x}_t$çš„åˆ†ç±»å™¨$p(\boldsymbol{y}|\boldsymbol{x}_t)$
- <strong>å®è·µæ›¿ä»£:</strong> ä½¿ç”¨æ— å™ªåˆ†ç±»å™¨$p_o(\boldsymbol{y}|\boldsymbol{x})$,å…ˆå»å™ªå†åˆ†ç±»:
  $$p(\boldsymbol{y}|\boldsymbol{x}_t) \approx p_o(\boldsymbol{y}|\boldsymbol{\mu}(\boldsymbol{x}_t)) \tag{22}$$</p>
<h3 id="3">3. æ¢¯åº¦ç¼©æ”¾ä¸å¼ºåº¦æ§åˆ¶</h3>
<h4 id="31-gamma">3.1 å¼•å…¥ç¼©æ”¾å‚æ•°$\gamma$</h4>
<p><strong>åŠ¨æœº:</strong> åŸå§‹æ¢¯åº¦å¯èƒ½è¿‡å¼ºæˆ–è¿‡å¼±,éœ€è¦è°ƒèŠ‚æ§åˆ¶å¼ºåº¦ã€‚</p>
<p><strong>ä¿®æ­£çš„é‡‡æ ·å…¬å¼:</strong>
$$\boldsymbol{x}_{t-1} = \boldsymbol{\mu}(\boldsymbol{x}_t) + \sigma_t^2 \gamma \nabla_{\boldsymbol{x}_t} \log p(\boldsymbol{y}|\boldsymbol{x}_t) + \sigma_t\boldsymbol{\varepsilon} \tag{23}$$</p>
<p><strong>æ•ˆæœåˆ†æ:</strong>
- $\gamma &gt; 1$: å¢å¼ºæ¡ä»¶ä¿¡å·,æé«˜ç›¸å…³æ€§,é™ä½å¤šæ ·æ€§
- $\gamma &lt; 1$: å‡å¼±æ¡ä»¶ä¿¡å·,é™ä½ç›¸å…³æ€§,æé«˜å¤šæ ·æ€§
- $\gamma = 1$: åŸå§‹ç†è®ºæ¨å¯¼çš„ç»“æœ</p>
<h4 id="32">3.2 å¹‚æ“ä½œçš„ç†è®ºè§£é‡Š(æœ‰ç‘•ç–µ)</h4>
<p><strong>åŸè®ºæ–‡çš„å°è¯•:</strong> å®šä¹‰é”åŒ–çš„æ¡ä»¶åˆ†å¸ƒ
$$\tilde{p}(\boldsymbol{y}|\boldsymbol{x}_t) = \frac{p^{\gamma}(\boldsymbol{y}|\boldsymbol{x}_t)}{Z(\boldsymbol{x}_t)}, \quad Z(\boldsymbol{x}_t) = \sum_{\boldsymbol{y}} p^{\gamma}(\boldsymbol{y}|\boldsymbol{x}_t) \tag{24}$$</p>
<p><strong>å¯¹æ•°æ¢¯åº¦:</strong>
$$\nabla_{\boldsymbol{x}_t} \log \tilde{p}(\boldsymbol{y}|\boldsymbol{x}_t) = \gamma \nabla_{\boldsymbol{x}_t} \log p(\boldsymbol{y}|\boldsymbol{x}_t) - \nabla_{\boldsymbol{x}_t} \log Z(\boldsymbol{x}_t) \tag{25}$$</p>
<p><strong>é—®é¢˜:</strong> åŸè®ºæ–‡é”™è¯¯åœ°è®¤ä¸º$Z(\boldsymbol{x}_t)$æ˜¯å¸¸æ•°,ä½†å®é™…ä¸Š:
$$Z(\boldsymbol{x}_t) = \sum_{\boldsymbol{y}} p^{\gamma}(\boldsymbol{y}|\boldsymbol{x}_t) \tag{26}$$</p>
<p>æ˜¾å¼ä¾èµ–äº$\boldsymbol{x}<em _boldsymbol_x="\boldsymbol{x">t$,å› æ­¤$\nabla</em>_t) \neq 0$ã€‚}_t} \log Z(\boldsymbol{x</p>
<p><strong>å±•å¼€å½’ä¸€åŒ–å¸¸æ•°çš„æ¢¯åº¦:</strong>
$$\nabla_{\boldsymbol{x}_t} \log Z(\boldsymbol{x}_t) = \frac{1}{Z(\boldsymbol{x}_t)} \nabla_{\boldsymbol{x}_t} Z(\boldsymbol{x}_t) = \frac{1}{Z(\boldsymbol{x}_t)} \sum_{\boldsymbol{y}} \gamma p^{\gamma}(\boldsymbol{y}|\boldsymbol{x}_t) \nabla_{\boldsymbol{x}_t} \log p(\boldsymbol{y}|\boldsymbol{x}_t) \tag{27}$$</p>
<p>ç®€åŒ–ä¸º:
$$\nabla_{\boldsymbol{x}_t} \log Z(\boldsymbol{x}_t) = \gamma \mathbb{E}_{\boldsymbol{y} \sim \tilde{p}(\boldsymbol{y}|\boldsymbol{x}_t)}[\nabla_{\boldsymbol{x}_t} \log p(\boldsymbol{y}|\boldsymbol{x}_t)] \tag{28}$$</p>
<p><strong>ç»“è®º:</strong> è¿™ä¸ªç†è®ºè§£é‡Šä¸å®Œå…¨æ­£ç¡®,ä½†åœ¨$\gamma = 1$é™„è¿‘å¯èƒ½æœ‰ä¸€å®šçš„è¿‘ä¼¼æ€§ã€‚</p>
<h4 id="33">3.3 åŸºäºç›¸ä¼¼åº¦çš„æ›´å¥½ç†è§£</h4>
<p><strong>é‡æ–°å®šä¹‰æ¡ä»¶åˆ†å¸ƒ:</strong>
$$p(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t, \boldsymbol{y}) = \frac{p(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t) \exp[\gamma \cdot \text{sim}(\boldsymbol{x}_{t-1}, \boldsymbol{y})]}{Z(\boldsymbol{x}_t, \boldsymbol{y})} \tag{29}$$</p>
<p>å…¶ä¸­$\text{sim}(\boldsymbol{x}_{t-1}, \boldsymbol{y})$æ˜¯ä»»æ„ç›¸ä¼¼åº¦å‡½æ•°ã€‚</p>
<p><strong>å½’ä¸€åŒ–å¸¸æ•°:</strong>
$$Z(\boldsymbol{x}_t, \boldsymbol{y}) = \int p(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t) \exp[\gamma \cdot \text{sim}(\boldsymbol{x}_{t-1}, \boldsymbol{y})] d\boldsymbol{x}_{t-1} \tag{30}$$</p>
<p><strong>æ³°å‹’å±•å¼€(åœ¨$\boldsymbol{x}_{t-1} = \boldsymbol{x}_t$å¤„):</strong>
$$\text{sim}(\boldsymbol{x}_{t-1}, \boldsymbol{y}) \approx \text{sim}(\boldsymbol{x}_t, \boldsymbol{y}) + (\boldsymbol{x}_{t-1} - \boldsymbol{x}_t) \cdot \nabla_{\boldsymbol{x}_t} \text{sim}(\boldsymbol{x}_t, \boldsymbol{y}) \tag{31}$$</p>
<p><strong>ä»£å…¥æ¡ä»¶åˆ†å¸ƒ(å¿½ç•¥å½’ä¸€åŒ–å¸¸æ•°):</strong>
$$p(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t, \boldsymbol{y}) \propto p(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t) \exp[\gamma(\boldsymbol{x}_{t-1} - \boldsymbol{x}_t) \cdot \nabla_{\boldsymbol{x}_t} \text{sim}(\boldsymbol{x}_t, \boldsymbol{y})] \tag{32}$$</p>
<p><strong>é…æ–¹å¾—åˆ°:</strong>
$$p(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t, \boldsymbol{y}) \approx \mathcal{N}(\boldsymbol{x}_{t-1}; \boldsymbol{\mu}(\boldsymbol{x}_t) + \sigma_t^2 \gamma \nabla_{\boldsymbol{x}_t} \text{sim}(\boldsymbol{x}_t, \boldsymbol{y}), \sigma_t^2\boldsymbol{I}) \tag{33}$$</p>
<p><strong>å¸¸ç”¨ç›¸ä¼¼åº¦å‡½æ•°:</strong></p>
<ol>
<li>
<p><strong>å¯¹æ•°æ¦‚ç‡(åŸå§‹CG):</strong>
   $$\text{sim}(\boldsymbol{x}_t, \boldsymbol{y}) = \log p(\boldsymbol{y}|\boldsymbol{x}_t) \tag{34}$$</p>
</li>
<li>
<p><strong>ä½™å¼¦ç›¸ä¼¼åº¦(é€‚ç”¨äºå›¾åƒ/æ–‡æœ¬ç¼–ç ):</strong>
   $$\text{sim}(\boldsymbol{x}_t, \boldsymbol{y}) = \frac{E_1(\boldsymbol{x}_t) \cdot E_2(\boldsymbol{y})}{\|E_1(\boldsymbol{x}_t)\| \|E_2(\boldsymbol{y})\|} \tag{35}$$
   å…¶ä¸­$E_1, E_2$æ˜¯ç¼–ç å™¨ã€‚</p>
</li>
<li>
<p><strong>è´Ÿæ¬§æ°è·ç¦»:</strong>
   $$\text{sim}(\boldsymbol{x}_t, \boldsymbol{y}) = -\|E_1(\boldsymbol{x}_t) - E_2(\boldsymbol{y})\|^2 \tag{36}$$</p>
</li>
</ol>
<p><strong>ä¼˜ç‚¹:</strong> è¿™ä¸ªæ¡†æ¶æ›´çµæ´»,å¯ä»¥å¤„ç†å„ç§æ¡ä»¶ä¿¡å·(ç±»åˆ«ã€æ–‡æœ¬ã€å›¾åƒç­‰)ã€‚</p>
<h3 id="4-sde">4. SDEè§†è§’ä¸‹çš„ç»Ÿä¸€ç†è®º</h3>
<h4 id="41-sde">4.1 éšæœºå¾®åˆ†æ–¹ç¨‹(SDE)æ¡†æ¶</h4>
<p><strong>å‰å‘SDE:</strong>
$$d\boldsymbol{x} = \boldsymbol{f}_t(\boldsymbol{x})dt + g_t d\boldsymbol{w} \tag{37}$$</p>
<p>å…¶ä¸­:
- $\boldsymbol{f}_t(\boldsymbol{x})$: æ¼‚ç§»é¡¹
- $g_t$: æ‰©æ•£ç³»æ•°
- $d\boldsymbol{w}$: ç»´çº³è¿‡ç¨‹(å¸ƒæœ—è¿åŠ¨)</p>
<p><strong>åå‘SDE(æœ€ä¸€èˆ¬å½¢å¼):</strong>
$$d\boldsymbol{x} = \left[\boldsymbol{f}_t(\boldsymbol{x}) - \frac{1}{2}(g_t^2 + \sigma_t^2)\nabla_{\boldsymbol{x}} \log p_t(\boldsymbol{x})\right]dt + \sigma_t d\boldsymbol{w} \tag{38}$$</p>
<p><strong>é‡è¦å‚æ•°:</strong> $\sigma_t^2$æ˜¯åå‘æ‰©æ•£ç³»æ•°,å¯ä»¥è‡ªç”±é€‰æ‹©:
- $\sigma_t = 0$: å¯¹åº”DDIM(ç¡®å®šæ€§ODE)
- $\sigma_t = g_t$: å¯¹åº”DDPM(æ ‡å‡†åå‘SDE)</p>
<h4 id="42-sde">4.2 æ¡ä»¶ç”Ÿæˆçš„SDEå½¢å¼</h4>
<p><strong>æ— æ¡ä»¶å¾—åˆ†å‡½æ•°:</strong>
$$\nabla_{\boldsymbol{x}} \log p_t(\boldsymbol{x}) \tag{39}$$</p>
<p>åœ¨DDPMå‚æ•°åŒ–ä¸‹:
$$\nabla_{\boldsymbol{x}} \log p_t(\boldsymbol{x}) = -\frac{\boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)}{\bar{\beta}_t} \tag{40}$$</p>
<p><strong>æ¡ä»¶å¾—åˆ†å‡½æ•°(åº”ç”¨è´å¶æ–¯):</strong>
$$\nabla_{\boldsymbol{x}} \log p_t(\boldsymbol{x}|\boldsymbol{y}) = \nabla_{\boldsymbol{x}} \log p_t(\boldsymbol{x}) + \nabla_{\boldsymbol{x}} \log p_t(\boldsymbol{y}|\boldsymbol{x}) \tag{41}$$</p>
<p><strong>å‚æ•°åŒ–å½¢å¼:</strong>
$$\nabla_{\boldsymbol{x}} \log p_t(\boldsymbol{x}|\boldsymbol{y}) = -\frac{\boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)}{\bar{\beta}_t} + \nabla_{\boldsymbol{x}} \log p_t(\boldsymbol{y}|\boldsymbol{x}) \tag{42}$$</p>
<p><strong>ç­‰ä»·äºä¿®æ­£å™ªå£°é¢„æµ‹:</strong>
$$\nabla_{\boldsymbol{x}} \log p_t(\boldsymbol{x}|\boldsymbol{y}) = -\frac{\boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t) - \bar{\beta}_t \nabla_{\boldsymbol{x}} \log p_t(\boldsymbol{y}|\boldsymbol{x})}{\bar{\beta}_t} \tag{43}$$</p>
<p><strong>å®šä¹‰ä¿®æ­£åçš„å™ªå£°é¢„æµ‹å™¨:</strong>
$$\tilde{\boldsymbol{\epsilon}}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t, \boldsymbol{y}) = \boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t) - \bar{\beta}_t \nabla_{\boldsymbol{x}} \log p_t(\boldsymbol{y}|\boldsymbol{x}) \tag{44}$$</p>
<h4 id="43">4.3 ç»Ÿä¸€çš„æ¡ä»¶é‡‡æ ·ç®—æ³•</h4>
<p><strong>æ ¸å¿ƒæ€æƒ³:</strong> æ— è®ºåå‘æ–¹å·®$\sigma_t$å–ä½•å€¼,åªéœ€ç”¨$\tilde{\boldsymbol{\epsilon}}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}$æ›¿æ¢$\boldsymbol{\epsilon}</em>$ã€‚}</p>
<p><strong>DDPMå¼é‡‡æ ·($\sigma_t = \beta_t$):</strong>
$$\boldsymbol{x}_{t-1} = \frac{1}{\alpha_t}\left(\boldsymbol{x}_t - \frac{\beta_t^2}{\bar{\beta}_t}\tilde{\boldsymbol{\epsilon}}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t, \boldsymbol{y})\right) + \sigma_t\boldsymbol{\varepsilon} \tag{45}$$</p>
<p><strong>DDIMå¼é‡‡æ ·($\sigma_t = 0$):</strong>
$$\boldsymbol{x}_{t-1} = \sqrt{\bar{\alpha}_{t-1}}\left(\frac{\boldsymbol{x}_t - \bar{\beta}_t\tilde{\boldsymbol{\epsilon}}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t, \boldsymbol{y})}{\sqrt{\bar{\alpha}_t}}\right) + \sqrt{1 - \bar{\alpha}_{t-1}}\tilde{\boldsymbol{\epsilon}}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t, \boldsymbol{y}) \tag{46}$$</p>
<p><strong>ä¼˜ç‚¹:</strong> SDEæ¡†æ¶ä¸‹,æ¡ä»¶ç”Ÿæˆçš„å¤„ç†éå¸¸ç»Ÿä¸€å’Œç®€æ´,é€‚ç”¨äºæ‰€æœ‰åå‘è¿‡ç¨‹å˜ç§ã€‚</p>
<h3 id="5-classifier-free-guidance">5. Classifier-Free Guidanceçš„æ¨å¯¼</h3>
<h4 id="51">5.1 ç›´æ¥å»ºæ¨¡æ¡ä»¶åˆ†å¸ƒ</h4>
<p><strong>ç­–ç•¥:</strong> åœ¨è®­ç»ƒæ—¶ç›´æ¥å­¦ä¹ æ¡ä»¶ç”Ÿæˆè¿‡ç¨‹ã€‚</p>
<p><strong>æ¡ä»¶åˆ†å¸ƒå®šä¹‰:</strong>
$$p(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t, \boldsymbol{y}) = \mathcal{N}(\boldsymbol{x}_{t-1}; \boldsymbol{\mu}(\boldsymbol{x}_t, \boldsymbol{y}), \sigma_t^2\boldsymbol{I}) \tag{47}$$</p>
<p><strong>å‚æ•°åŒ–å‡å€¼:</strong>
$$\boldsymbol{\mu}(\boldsymbol{x}_t, \boldsymbol{y}) = \frac{1}{\alpha_t}\left(\boldsymbol{x}_t - \frac{\beta_t^2}{\bar{\beta}_t}\boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, \boldsymbol{y}, t)\right) \tag{48}$$</p>
<p><strong>è®­ç»ƒç›®æ ‡:</strong>
$$\mathcal{L}_{\text{CF}} = \mathbb{E}_{\boldsymbol{x}_0, \boldsymbol{y}, \boldsymbol{\varepsilon}, t}\left[\|\boldsymbol{\varepsilon} - \boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\bar{\alpha}_t\boldsymbol{x}_0 + \bar{\beta}_t\boldsymbol{\varepsilon}, \boldsymbol{y}, t)\|^2\right] \tag{49}$$</p>
<p>å…¶ä¸­:
- $\boldsymbol{x}_0, \boldsymbol{y} \sim \tilde{p}(\boldsymbol{x}_0, \boldsymbol{y})$: ä»è®­ç»ƒæ•°æ®é‡‡æ ·
- $\boldsymbol{\varepsilon} \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{I})$: å™ªå£°
- $t \sim \text{Uniform}(1, T)$: æ—¶é—´æ­¥</p>
<h4 id="52">5.2 å¼•å…¥æ— æ¡ä»¶è®­ç»ƒ</h4>
<p><strong>åŠ¨æœº:</strong> ä¸ºäº†å®ç°guidanceç¼©æ”¾,éœ€è¦åŒæ—¶å­¦ä¹ æ¡ä»¶å’Œæ— æ¡ä»¶æ¨¡å‹ã€‚</p>
<p><strong>æ··åˆè®­ç»ƒç­–ç•¥:</strong>
ä»¥æ¦‚ç‡$p_{\text{uncond}}$(å¦‚10-20%)éšæœºä¸¢å¼ƒæ¡ä»¶$\boldsymbol{y}$:
$$\boldsymbol{y}_{\text{train}} = \begin{cases}
\boldsymbol{y} & \text{æ¦‚ç‡ } 1 - p_{\text{uncond}} \\
\boldsymbol{\phi} & \text{æ¦‚ç‡ } p_{\text{uncond}}
\end{cases} \tag{50}$$</p>
<p>å…¶ä¸­$\boldsymbol{\phi}$æ˜¯ç‰¹æ®Šçš„"ç©ºæ¡ä»¶"æ ‡è®°ã€‚</p>
<p><strong>è®­ç»ƒç›®æ ‡(ä¿®æ­£):</strong>
$$\mathcal{L}_{\text{CF}} = \mathbb{E}_{\boldsymbol{x}_0, \boldsymbol{y}_{\text{train}}, \boldsymbol{\varepsilon}, t}\left[\|\boldsymbol{\varepsilon} - \boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\bar{\alpha}_t\boldsymbol{x}_0 + \bar{\beta}_t\boldsymbol{\varepsilon}, \boldsymbol{y}_{\text{train}}, t)\|^2\right] \tag{51}$$</p>
<p><strong>å­¦åˆ°çš„æ¨¡å‹:</strong>
- $\boldsymbol{\epsilon}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}(\boldsymbol{x}_t, \boldsymbol{y}, t)$: æ¡ä»¶å™ªå£°é¢„æµ‹
- $\boldsymbol{\epsilon}</em>, t)$: æ— æ¡ä»¶å™ªå£°é¢„æµ‹}}(\boldsymbol{x}_t, \boldsymbol{\phi</p>
<h4 id="53-guidance">5.3 Guidanceç¼©æ”¾çš„æ¨å¯¼</h4>
<p><strong>ç›®æ ‡:</strong> ç±»æ¯”Classifier-Guidance,å¼•å…¥ç¼©æ”¾å‚æ•°$w$æ¥æ§åˆ¶æ¡ä»¶å¼ºåº¦ã€‚</p>
<p><strong>å›é¡¾CGçš„å‡å€¼ä¿®æ­£(å¼23):</strong>
$$\boldsymbol{\mu}_{\text{CG}} = \boldsymbol{\mu}(\boldsymbol{x}_t) + \sigma_t^2\gamma\nabla_{\boldsymbol{x}_t}\log p(\boldsymbol{y}|\boldsymbol{x}_t) \tag{52}$$</p>
<p><strong>è´å¶æ–¯åˆ†è§£:</strong>
$$\nabla_{\boldsymbol{x}_t}\log p(\boldsymbol{y}|\boldsymbol{x}_t) = \nabla_{\boldsymbol{x}_t}\log p(\boldsymbol{x}_t|\boldsymbol{y}) - \nabla_{\boldsymbol{x}_t}\log p(\boldsymbol{x}_t) \tag{53}$$</p>
<p><strong>ç”¨å™ªå£°é¢„æµ‹è¡¨ç¤ºå¾—åˆ†:</strong>
$$\nabla_{\boldsymbol{x}_t}\log p(\boldsymbol{x}_t|\boldsymbol{y}) = -\frac{\boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, \boldsymbol{y}, t)}{\bar{\beta}_t} \tag{54}$$
$$\nabla_{\boldsymbol{x}_t}\log p(\boldsymbol{x}_t) = -\frac{\boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, \boldsymbol{\phi}, t)}{\bar{\beta}_t} \tag{55}$$</p>
<p><strong>æ¡ä»¶å¯¹æ•°ä¼¼ç„¶çš„æ¢¯åº¦:</strong>
$$\nabla_{\boldsymbol{x}_t}\log p(\boldsymbol{y}|\boldsymbol{x}_t) = -\frac{1}{\bar{\beta}_t}\left[\boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, \boldsymbol{y}, t) - \boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, \boldsymbol{\phi}, t)\right] \tag{56}$$</p>
<p><strong>CGå‡å€¼ä¿®æ­£æ”¹å†™:</strong>
$$\boldsymbol{\mu}_{\text{CG}} = \boldsymbol{\mu}(\boldsymbol{x}_t) - \frac{\sigma_t^2\gamma}{\bar{\beta}_t}\left[\boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, \boldsymbol{y}, t) - \boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, \boldsymbol{\phi}, t)\right] \tag{57}$$</p>
<p><strong>è¿›ä¸€æ­¥æ”¹å†™(æå–å…¬å› å­):</strong>
$$\boldsymbol{\mu}_{\text{CG}} = \boldsymbol{\mu}(\boldsymbol{x}_t) - \frac{\sigma_t^2}{\bar{\beta}_t}\gamma\left[\boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, \boldsymbol{y}, t) - \boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, \boldsymbol{\phi}, t)\right] \tag{58}$$</p>
<p><strong>CFçš„ç±»æ¯”æ€è·¯:</strong>
è§‚å¯Ÿåˆ°CGçš„ä¿®æ­£é¡¹å½¢å¼ä¸º$\gamma[\text{conditional} - \text{unconditional}]$,CFé‡‡ç”¨ç±»ä¼¼çš„çº¿æ€§ç»„åˆ:</p>
<p><strong>å®šä¹‰guidance scale:</strong> ä»¤$w = \gamma - 1$,åˆ™:
$$\gamma[\text{cond} - \text{uncond}] = (w+1)[\text{cond} - \text{uncond}] = (w+1)\text{cond} - (w+1)\text{uncond} \tag{59}$$</p>
<p>æ”¹å†™ä¸º:
$$= w\cdot\text{cond} + \text{cond} - w\cdot\text{uncond} - \text{uncond} = (1+w)\text{cond} - w\cdot\text{uncond} \tag{60}$$</p>
<p><strong>CFçš„ä¿®æ­£å™ªå£°é¢„æµ‹:</strong>
$$\tilde{\boldsymbol{\epsilon}}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, \boldsymbol{y}, t) = (1+w)\boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, \boldsymbol{y}, t) - w\boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, \boldsymbol{\phi}, t) \tag{61}$$</p>
<p><strong>å¸¸è§çš„ç­‰ä»·å†™æ³•(ä»¤$s = 1+w$):</strong>
$$\tilde{\boldsymbol{\epsilon}}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, \boldsymbol{y}, t) = s\boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, \boldsymbol{y}, t) + (1-s)\boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, \boldsymbol{\phi}, t) \tag{62}$$</p>
<p>æˆ–è€…:
$$\tilde{\boldsymbol{\epsilon}}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, \boldsymbol{y}, t) = \boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, \boldsymbol{\phi}, t) + w\left[\boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, \boldsymbol{y}, t) - \boldsymbol{\epsilon}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, \boldsymbol{\phi}, t)\right] \tag{63}$$</p>
<p><strong>å‚æ•°æ•ˆæœ:</strong>
- $w = 0$ (æˆ–$s=1$): çº¯æ¡ä»¶ç”Ÿæˆ
- $w &gt; 0$ (æˆ–$s&gt;1$): å¢å¼ºæ¡ä»¶ä¿¡å·,æé«˜ç›¸å…³æ€§
- $w &lt; 0$ (æˆ–$s&lt;1$): å‡å¼±æ¡ä»¶ä¿¡å·,æé«˜å¤šæ ·æ€§</p>
<h4 id="54-cf">5.4 CFé‡‡æ ·ç®—æ³•</h4>
<p><strong>å®Œæ•´é‡‡æ ·è¿‡ç¨‹:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="err">è¾“å…¥</span><span class="o">:</span><span class="w"> </span><span class="err">æ¡ä»¶</span><span class="n">y</span><span class="o">,</span><span class="w"> </span><span class="n">guidance</span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="n">w</span>
<span class="err">åˆå§‹åŒ–</span><span class="o">:</span><span class="w"> </span><span class="n">x_T</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">N</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="n">I</span><span class="o">)</span>

<span class="k">for</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span>
<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="err">é¢„æµ‹å™ªå£°</span><span class="o">(</span><span class="err">æ¡ä»¶å’Œæ— æ¡ä»¶</span><span class="o">)</span>
<span class="w">    </span><span class="n">eps_cond</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">epsilon_theta</span><span class="o">(</span><span class="n">x_t</span><span class="o">,</span><span class="w"> </span><span class="n">y</span><span class="o">,</span><span class="w"> </span><span class="n">t</span><span class="o">)</span>
<span class="w">    </span><span class="n">eps_uncond</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">epsilon_theta</span><span class="o">(</span><span class="n">x_t</span><span class="o">,</span><span class="w"> </span><span class="err">Ï†</span><span class="o">,</span><span class="w"> </span><span class="n">t</span><span class="o">)</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">Guidanceç¼©æ”¾</span>
<span class="w">    </span><span class="n">eps_guided</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="mi">1</span><span class="o">+</span><span class="n">w</span><span class="o">)*</span><span class="n">eps_cond</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">w</span><span class="o">*</span><span class="n">eps_uncond</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="err">è®¡ç®—å‡å€¼</span>
<span class="w">    </span><span class="n">mu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="n">x_t</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">(</span><span class="n">beta_t</span><span class="o">^</span><span class="mi">2</span><span class="w"> </span><span class="sr">/ bar_beta_t) * eps_guided) /</span><span class="w"> </span><span class="n">alpha_t</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="err">é‡‡æ ·</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span>
<span class="w">        </span><span class="n">x_</span><span class="o">{</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="o">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mu</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sigma_t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">epsilon</span><span class="o">,</span><span class="w"> </span><span class="n">epsilon</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">N</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="w"> </span><span class="n">I</span><span class="o">)</span>
<span class="w">    </span><span class="k">else</span><span class="o">:</span>
<span class="w">        </span><span class="n">x_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mu</span>

<span class="k">return</span><span class="w"> </span><span class="n">x_0</span>
</code></pre></div>

<h3 id="6">6. ä¸¤ç§æ–¹æ¡ˆçš„æ·±å…¥å¯¹æ¯”</h3>
<h4 id="61">6.1 ç†è®ºå¯¹æ¯”</h4>
<table>
<thead>
<tr>
<th>ç»´åº¦</th>
<th>Classifier-Guidance</th>
<th>Classifier-Free</th>
</tr>
</thead>
<tbody>
<tr>
<td>è®­ç»ƒæˆæœ¬</td>
<td>ä½(å¤ç”¨é¢„è®­ç»ƒæ¨¡å‹)</td>
<td>é«˜(é‡æ–°è®­ç»ƒæ‰©æ•£æ¨¡å‹)</td>
</tr>
<tr>
<td>æ¨ç†æˆæœ¬</td>
<td>é«˜(éœ€è¦åˆ†ç±»å™¨æ¢¯åº¦)</td>
<td>ä¸­(éœ€è¦ä¸¤æ¬¡å‰å‘ä¼ æ’­)</td>
</tr>
<tr>
<td>çµæ´»æ€§</td>
<td>é«˜(å¯åæœŸæ›´æ¢åˆ†ç±»å™¨)</td>
<td>ä½(æ¡ä»¶å›ºå®šåœ¨è®­ç»ƒä¸­)</td>
</tr>
<tr>
<td>æ§åˆ¶è´¨é‡</td>
<td>ä¸­ç­‰</td>
<td>é«˜(è®­ç»ƒæ—¶ç›´æ¥ä¼˜åŒ–)</td>
</tr>
<tr>
<td>ç†è®ºåŸºç¡€</td>
<td>è´å¶æ–¯+æ³°å‹’å±•å¼€</td>
<td>ç›´æ¥å»ºæ¨¡</td>
</tr>
</tbody>
</table>
<h4 id="62">6.2 è®¡ç®—å¤æ‚åº¦åˆ†æ</h4>
<p><strong>Classifier-Guidanceæ¯æ­¥:</strong>
1. æ‰©æ•£æ¨¡å‹å‰å‘ä¼ æ’­: $O(M)$
2. åˆ†ç±»å™¨å‰å‘ä¼ æ’­: $O(C)$
3. åˆ†ç±»å™¨åå‘ä¼ æ’­(æ±‚æ¢¯åº¦): $O(C)$</p>
<p>æ€»è®¡: $O(M + 2C)$</p>
<p><strong>Classifier-Freeæ¯æ­¥:</strong>
1. æ¡ä»¶æ¨¡å‹å‰å‘ä¼ æ’­: $O(M)$
2. æ— æ¡ä»¶æ¨¡å‹å‰å‘ä¼ æ’­: $O(M)$</p>
<p>æ€»è®¡: $O(2M)$</p>
<p><strong>æ³¨:</strong> å®è·µä¸­å¯ä»¥é€šè¿‡æ‰¹å¤„ç†åŒæ—¶è®¡ç®—ä¸¤ä¸ªå‰å‘ä¼ æ’­,æ•ˆç‡æ›´é«˜ã€‚</p>
<h4 id="63">6.3 é€‚ç”¨åœºæ™¯</h4>
<p><strong>Classifier-Guidanceé€‚åˆ:</strong>
- å¿«é€ŸåŸå‹å¼€å‘
- æ¡ä»¶ä¿¡å·é¢‘ç¹å˜åŒ–
- é¢„ç®—æœ‰é™,æ— æ³•é‡æ–°è®­ç»ƒå¤§æ¨¡å‹
- éœ€è¦å¤šç§æ§åˆ¶æ–¹å¼</p>
<p><strong>Classifier-Freeé€‚åˆ:</strong>
- è¿½æ±‚æœ€é«˜ç”Ÿæˆè´¨é‡
- æ¡ä»¶ç±»å‹å›ºå®š
- æœ‰å……è¶³çš„è®­ç»ƒèµ„æº
- ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²</p>
<h3 id="7">7. é«˜çº§æŠ€å·§ä¸æ‰©å±•</h3>
<h4 id="71">7.1 å¤šæ¡ä»¶ç»„åˆ</h4>
<p><strong>åœºæ™¯:</strong> åŒæ—¶æ»¡è¶³å¤šä¸ªæ¡ä»¶$\boldsymbol{y}_1, \boldsymbol{y}_2, \ldots, \boldsymbol{y}_K$ã€‚</p>
<p><strong>CGçš„ç»„åˆ:</strong>
$$\nabla_{\boldsymbol{x}_t}\log p(\boldsymbol{y}_1, \ldots, \boldsymbol{y}_K|\boldsymbol{x}_t) = \sum_{i=1}^K w_i \nabla_{\boldsymbol{x}_t}\log p(\boldsymbol{y}_i|\boldsymbol{x}_t) \tag{64}$$</p>
<p>å…¶ä¸­$w_i$æ˜¯å„æ¡ä»¶çš„æƒé‡ã€‚</p>
<p><strong>CFçš„ç»„åˆ:</strong> éœ€è¦è®­ç»ƒè”åˆæ¡ä»¶æ¨¡å‹æˆ–ä½¿ç”¨ç»„åˆç­–ç•¥:
$$\tilde{\boldsymbol{\epsilon}} = \boldsymbol{\epsilon}_{\text{uncond}} + \sum_{i=1}^K w_i[\boldsymbol{\epsilon}(\boldsymbol{y}_i) - \boldsymbol{\epsilon}_{\text{uncond}}] \tag{65}$$</p>
<h4 id="72-negative-prompts">7.2 è´Ÿæ¡ä»¶(Negative Prompts)</h4>
<p><strong>ç›®æ ‡:</strong> é¿å…ç”ŸæˆæŸäº›ç‰¹å¾ã€‚</p>
<p><strong>CFå®ç°:</strong>
$$\tilde{\boldsymbol{\epsilon}} = \boldsymbol{\epsilon}(\boldsymbol{y}_{\text{pos}}) + w_{\text{pos}}[\boldsymbol{\epsilon}(\boldsymbol{y}_{\text{pos}}) - \boldsymbol{\epsilon}_{\text{uncond}}] - w_{\text{neg}}[\boldsymbol{\epsilon}(\boldsymbol{y}_{\text{neg}}) - \boldsymbol{\epsilon}_{\text{uncond}}] \tag{66}$$</p>
<h4 id="73-guidance">7.3 æ—¶é—´ä¾èµ–çš„guidance</h4>
<p><strong>åŠ¨æœº:</strong> ä¸åŒæ—¶é—´æ­¥å¯¹guidanceçš„æ•æ„Ÿåº¦ä¸åŒã€‚</p>
<p><strong>æ—¶é—´ä¾èµ–æƒé‡:</strong>
$$w(t) = w_0 \cdot f(t) \tag{67}$$</p>
<p>å¸¸è§é€‰æ‹©:
- çº¿æ€§: $f(t) = t/T$
- ä½™å¼¦: $f(t) = \cos(\pi t / 2T)$
- åˆ†æ®µ: $f(t) = \begin{cases} 0 &amp; t &lt; t_0 \ w_{\max} &amp; t_0 \leq t &lt; t_1 \ w_{\max}(T-t)/(T-t_1) &amp; t \geq t_1 \end{cases}$</p>
<h3 id="8">8. å®ç°ç»†èŠ‚ä¸æŠ€å·§</h3>
<h4 id="81">8.1 æ¢¯åº¦è®¡ç®—çš„æ•°å€¼ç¨³å®šæ€§</h4>
<p><strong>é—®é¢˜:</strong> ç›´æ¥è®¡ç®—$\nabla_{\boldsymbol{x}_t}\log p(\boldsymbol{y}|\boldsymbol{x}_t)$å¯èƒ½æ•°å€¼ä¸ç¨³å®šã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ:</strong>
1. <strong>æ¢¯åº¦è£å‰ª:</strong>
   $$\tilde{\nabla} = \begin{cases}
   \nabla & \|\nabla\| \leq \tau \\
   \tau \frac{\nabla}{\|\nabla\|} & \|\nabla\| > \tau
   \end{cases} \tag{68}$$</p>
<ol>
<li><strong>å½’ä¸€åŒ–:</strong>
   $$\tilde{\nabla} = \frac{\nabla}{\|\nabla\| + \epsilon} \tag{69}$$</li>
</ol>
<h4 id="82">8.2 ç¼–ç å™¨çš„è®­ç»ƒ</h4>
<p><strong>å¯¹äºåŸºäºç›¸ä¼¼åº¦çš„CG:</strong> ç¼–ç å™¨$E_1$éœ€è¦å¯¹åŠ å™ªæ ·æœ¬é²æ£’ã€‚</p>
<p><strong>å¾®è°ƒç­–ç•¥:</strong>
1. åœ¨å¹²å‡€æ•°æ®ä¸Šé¢„è®­ç»ƒç¼–ç å™¨
2. å¯¹$\boldsymbol{x}_t = \bar{\alpha}_t\boldsymbol{x}_0 + \bar{\beta}_t\boldsymbol{\varepsilon}$è¿›è¡Œå¾®è°ƒ
3. ä½¿ç”¨å¯¹æ¯”å­¦ä¹ ç›®æ ‡:
   $$\mathcal{L}_{\text{enc}} = -\log \frac{\exp[\text{sim}(\boldsymbol{x}_t, \boldsymbol{y})/\tau]}{\sum_{\boldsymbol{y}'} \exp[\text{sim}(\boldsymbol{x}_t, \boldsymbol{y}')/\tau]} \tag{70}$$</p>
<h4 id="83-classifier-free">8.3 Classifier-Freeçš„é«˜æ•ˆå®ç°</h4>
<p><strong>æ‰¹å¤„ç†æŠ€å·§:</strong> å°†æ¡ä»¶å’Œæ— æ¡ä»¶æ ·æœ¬æ‰“åŒ…åœ¨åŒä¸€æ‰¹æ¬¡:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># è¾“å…¥</span>
<span class="n">x_t</span><span class="p">:</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">]</span>
<span class="n">y</span><span class="p">:</span> <span class="p">[</span><span class="n">B</span><span class="p">,</span> <span class="n">D</span><span class="p">]</span>  <span class="c1"># æ¡ä»¶å‘é‡</span>

<span class="c1"># æ„å»ºæ‰¹æ¬¡</span>
<span class="n">x_double</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">x_t</span><span class="p">,</span> <span class="n">x_t</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># [2B, C, H, W]</span>
<span class="n">y_double</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">y</span><span class="p">,</span> <span class="n">phi</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># [2B, D]</span>

<span class="c1"># ä¸€æ¬¡å‰å‘ä¼ æ’­</span>
<span class="n">eps_double</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">x_double</span><span class="p">,</span> <span class="n">y_double</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>  <span class="c1"># [2B, C, H, W]</span>

<span class="c1"># åˆ†ç¦»ç»“æœ</span>
<span class="n">eps_cond</span><span class="p">,</span> <span class="n">eps_uncond</span> <span class="o">=</span> <span class="n">eps_double</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Guidance</span>
<span class="n">eps_guided</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="n">eps_cond</span> <span class="o">-</span> <span class="n">w</span> <span class="o">*</span> <span class="n">eps_uncond</span>
</code></pre></div>

<h3 id="9">9. ç†è®ºæ·±å…¥ä¸æ•°å­¦æ´å¯Ÿ</h3>
<h4 id="91-guidance">9.1 ä¸ºä»€ä¹ˆguidanceèƒ½å·¥ä½œ?</h4>
<p><strong>èƒ½é‡è§†è§’:</strong> å°†æ¡ä»¶åˆ†å¸ƒçœ‹ä½œèƒ½é‡æ¨¡å‹:
$$p(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t, \boldsymbol{y}) \propto \exp[-E(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t, \boldsymbol{y})] \tag{71}$$</p>
<p>å…¶ä¸­èƒ½é‡å‡½æ•°:
$$E(\boldsymbol{x}_{t-1}|\boldsymbol{x}_t, \boldsymbol{y}) = \frac{1}{2\sigma_t^2}\|\boldsymbol{x}_{t-1} - \boldsymbol{\mu}(\boldsymbol{x}_t)\|^2 - \gamma\log p(\boldsymbol{y}|\boldsymbol{x}_{t-1}) \tag{72}$$</p>
<p><strong>æ¢¯åº¦ä¸‹é™è§£é‡Š:</strong> é‡‡æ ·è¿‡ç¨‹ç›¸å½“äºåœ¨èƒ½é‡æ™¯è§‚ä¸Šè¿›è¡Œå¸¦å™ªå£°çš„æ¢¯åº¦ä¸‹é™ã€‚</p>
<h4 id="92-guidance">9.2 guidanceçš„å‡ ä½•ç›´è§‚</h4>
<p><strong>æ— æ¡ä»¶é‡‡æ ·:</strong> æ²¿ç€æ•°æ®å¯†åº¦æ¢¯åº¦$\nabla_{\boldsymbol{x}}\log p(\boldsymbol{x})$ç§»åŠ¨ã€‚</p>
<p><strong>æ¡ä»¶é‡‡æ ·:</strong> åœ¨æ•°æ®å¯†åº¦æ¢¯åº¦åŸºç¡€ä¸Š,åŠ ä¸Šæ¡ä»¶ä¼¼ç„¶æ¢¯åº¦$\nabla_{\boldsymbol{x}}\log p(\boldsymbol{y}|\boldsymbol{x})$,ç›¸å½“äºåœ¨é«˜ç»´ç©ºé—´ä¸­:
- å¯»æ‰¾æ•°æ®æµå½¢
- åŒæ—¶æ»¡è¶³æ¡ä»¶çº¦æŸ</p>
<p><strong>ç±»æ¯”:</strong> åœ¨å±±åœ°ä¸Šæ‰¾è·¯å¾„:
- æ— æ¡ä»¶: é¡ºç€ä»»æ„ä¸‹å±±æ–¹å‘èµ°
- æ¡ä»¶: åœ¨ä¸‹å±±çš„åŒæ—¶,æ²¿ç€æŒ‡å®šæ–¹å‘(å¦‚å‘åŒ—)èµ°</p>
<h4 id="93-guidance">9.3 æœ€ä¼˜guidanceå¼ºåº¦çš„ç†è®ºåˆ†æ</h4>
<p><strong>æƒè¡¡:</strong> guidanceå¼ºåº¦$\gamma$æ§åˆ¶ä¸¤ä¸ªç›®æ ‡:
1. <strong>æ ·æœ¬è´¨é‡:</strong> ç”Ÿæˆçš„æ ·æœ¬åº”è¯¥åƒçœŸå®æ•°æ®
2. <strong>æ¡ä»¶åŒ¹é…:</strong> ç”Ÿæˆçš„æ ·æœ¬åº”è¯¥æ»¡è¶³æ¡ä»¶$\boldsymbol{y}$</p>
<p><strong>å½¢å¼åŒ–:</strong> å®šä¹‰ä¼˜åŒ–ç›®æ ‡
$$\max_{\boldsymbol{x}_0} \left[\log p(\boldsymbol{x}_0) + \lambda\log p(\boldsymbol{y}|\boldsymbol{x}_0)\right] \tag{73}$$</p>
<p>å…¶ä¸­$\lambda$å¯¹åº”guidanceå¼ºåº¦ã€‚</p>
<p><strong>è´å¶æ–¯è§†è§’:</strong> ç›¸å½“äºè°ƒæ•´å…ˆéªŒå’Œä¼¼ç„¶çš„ç›¸å¯¹æƒé‡:
$$p(\boldsymbol{x}_0|\boldsymbol{y}) \propto p(\boldsymbol{x}_0) p(\boldsymbol{y}|\boldsymbol{x}_0)^{\lambda} \tag{74}$$</p>
<p><strong>æœ€ä¼˜é€‰æ‹©:</strong> å–å†³äºå…·ä½“åº”ç”¨:
- åˆ›æ„ç”Ÿæˆ: è¾ƒå°çš„$\lambda$
- ç²¾ç¡®æ§åˆ¶: è¾ƒå¤§çš„$\lambda$
- å®è·µä¸­é€šå¸¸$\lambda \in [5, 20]$</p>
<h3 id="10">10. åº”ç”¨æ¡ˆä¾‹ä¸å®éªŒè§‚å¯Ÿ</h3>
<h4 id="101-text-to-image">10.1 æ–‡ç”Ÿå›¾(Text-to-Image)</h4>
<p><strong>ä»»åŠ¡:</strong> ç»™å®šæ–‡æœ¬æè¿°$\boldsymbol{y}_{\text{text}}$,ç”Ÿæˆå¯¹åº”å›¾åƒã€‚</p>
<p><strong>æŠ€æœ¯æ ˆ:</strong>
- æ–‡æœ¬ç¼–ç : CLIP, T5, BERT
- CF guidance with $w \in [7, 15]$
- å…¸å‹NFE: 50-100æ­¥</p>
<p><strong>è§‚å¯Ÿ:</strong>
- è¿‡å°çš„$w$: å›¾åƒè´¨é‡é«˜ä½†ä¸æ–‡æœ¬ä¸ç¬¦
- è¿‡å¤§çš„$w$: ä¸¥æ ¼ç¬¦åˆæ–‡æœ¬ä½†å¯èƒ½è¿‡é¥±å’Œã€å¤±çœŸ</p>
<h4 id="102">10.2 è¶…åˆ†è¾¨ç‡</h4>
<p><strong>ä»»åŠ¡:</strong> ç»™å®šä½åˆ†è¾¨ç‡å›¾åƒ$\boldsymbol{y}_{\text{lr}}$,ç”Ÿæˆé«˜åˆ†è¾¨ç‡å›¾åƒã€‚</p>
<p><strong>CGå®ç°:</strong> ä½¿ç”¨ä¸‹é‡‡æ ·ä¸€è‡´æ€§ä½œä¸ºguidance:
$$\text{sim}(\boldsymbol{x}_t, \boldsymbol{y}_{\text{lr}}) = -\|\text{Downsample}(\boldsymbol{x}_t) - \boldsymbol{y}_{\text{lr}}\|^2 \tag{75}$$</p>
<h4 id="103">10.3 å›¾åƒç¼–è¾‘</h4>
<p><strong>ä»»åŠ¡:</strong> ç»™å®šæºå›¾åƒå’Œç¼–è¾‘æŒ‡ä»¤,ç”Ÿæˆç¼–è¾‘åçš„å›¾åƒã€‚</p>
<p><strong>ç­–ç•¥:</strong> ç»“åˆå¤šç§guidance:
1. æ–‡æœ¬guidance(ç¼–è¾‘æŒ‡ä»¤)
2. æºå›¾åƒçš„ç»“æ„ä¿æŒ
3. å±€éƒ¨åŒºåŸŸçš„ç²¾ç¡®æ§åˆ¶</p>
<h3 id="11_1">11. æ€»ç»“ä¸å±•æœ›</h3>
<h4 id="111">11.1 æ ¸å¿ƒè¦ç‚¹å›é¡¾</h4>
<p><strong>Classifier-Guidance:</strong>
- ç†è®ºåŸºç¡€: è´å¶æ–¯å®šç† + æ³°å‹’å±•å¼€
- æ ¸å¿ƒå…¬å¼: $\boldsymbol{\mu}<em _text_old="\text{old">{\text{new}} = \boldsymbol{\mu}</em>_t)$
- ä¼˜ç‚¹: çµæ´»,ä½è®­ç»ƒæˆæœ¬
- ç¼ºç‚¹: éœ€è¦é¢å¤–åˆ†ç±»å™¨,æ¨ç†æˆæœ¬é«˜}} + \sigma_t^2\gamma\nabla\log p(\boldsymbol{y}|\boldsymbol{x</p>
<p><strong>Classifier-Free:</strong>
- ç†è®ºåŸºç¡€: ç›´æ¥å»ºæ¨¡æ¡ä»¶åˆ†å¸ƒ
- æ ¸å¿ƒå…¬å¼: $\tilde{\boldsymbol{\epsilon}} = (1+w)\boldsymbol{\epsilon}(\boldsymbol{y}) - w\boldsymbol{\epsilon}(\boldsymbol{\phi})$
- ä¼˜ç‚¹: é«˜è´¨é‡,æ— éœ€é¢å¤–æ¨¡å‹
- ç¼ºç‚¹: è®­ç»ƒæˆæœ¬é«˜,æ¡ä»¶å›ºå®š</p>
<h4 id="112">11.2 æœªæ¥ç ”ç©¶æ–¹å‘</h4>
<ol>
<li><strong>è‡ªé€‚åº”guidance:</strong> æ ¹æ®ç”Ÿæˆé˜¶æ®µè‡ªåŠ¨è°ƒæ•´guidanceå¼ºåº¦</li>
<li><strong>é«˜æ•ˆè®­ç»ƒ:</strong> å‡å°‘CFçš„è®­ç»ƒæˆæœ¬</li>
<li><strong>å¤šæ¨¡æ€èåˆ:</strong> æ›´å¥½åœ°ç»“åˆå¤šç§æ¡ä»¶ä¿¡å·</li>
<li><strong>ç†è®ºå®Œå–„:</strong> guidanceç¼©æ”¾çš„ä¸¥æ ¼ç†è®ºåŸºç¡€</li>
<li><strong>æ–°å‹guidance:</strong> æ¢ç´¢åŸºäºç‰©ç†çº¦æŸã€ç¾å­¦è¯„åˆ†ç­‰æ–°å‹guidance</li>
</ol>
<hr />
<p><strong>å‚è€ƒæ–‡çŒ®:</strong>
- Classifier-Guidance: <a href="https://papers.cool/arxiv/2105.05233">Diffusion Models Beat GANs on Image Synthesis</a>
- Classifier-Free: <a href="https://papers.cool/arxiv/2207.12598">Classifier-Free Diffusion Guidance</a>
- Semantic Guidance: <a href="https://papers.cool/arxiv/2112.05744">More Control for Free!</a></p>
        </div>
    </div>
</body>
</html>