<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆæ¢MuPï¼šè¶…å‚æ•°çš„è·¨æ¨¡å‹å°ºåº¦è¿ç§»è§„å¾‹</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>åˆæ¢MuPï¼šè¶…å‚æ•°çš„è·¨æ¨¡å‹å°ºåº¦è¿ç§»è§„å¾‹</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-26 | ğŸ“„ å¤§å°: 53.7 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/10770">https://spaces.ac.cn/archives/10770</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œå®Œæ•´è®­ç»ƒä¸€æ¬¡å¤§å‹LLMçš„æˆæœ¬æ˜¯æ˜‚è´µçš„ï¼Œè¿™å°±å†³å®šäº†æˆ‘ä»¬ä¸å¯èƒ½ç›´æ¥åœ¨å¤§å‹LLMä¸Šåå¤æµ‹è¯•è¶…å‚æ•°ã€‚ä¸€ä¸ªå¾ˆè‡ªç„¶çš„æƒ³æ³•æ˜¯å¸Œæœ›å¯ä»¥åœ¨åŒç»“æ„çš„å°æ¨¡å‹ä¸Šä»”ç»†æœç´¢è¶…å‚æ•°ï¼Œæ‰¾åˆ°æœ€ä¼˜ç»„åˆåç›´æ¥è¿ç§»åˆ°å¤§æ¨¡å‹ä¸Šã€‚å°½ç®¡è¿™ä¸ªæƒ³æ³•å¾ˆæœ´ç´ ï¼Œä½†è¦å®ç°å®ƒå¹¶ä¸å¹³å‡¡ï¼Œå®ƒéœ€è¦æˆ‘ä»¬äº†è§£å¸¸è§çš„è¶…å‚æ•°ä¸æ¨¡å‹å°ºåº¦ä¹‹é—´çš„ç¼©æ”¾è§„å¾‹ï¼Œè€ŒMuPæ­£æ˜¯è¿™ä¸ªæƒ³æ³•çš„ä¸€ä¸ªå®è·µã€‚</p>
<p>MuPï¼Œæœ‰æ—¶ä¹Ÿå†™$\mu P$ï¼Œå…¨åæ˜¯Maximal Update Parametrizationï¼Œå‡ºè‡ªè®ºæ–‡<a href="https://papers.cool/arxiv/2203.03466">ã€ŠTensor Programs V: Tuning Large Neural Networks via Zero-Shot Hyperparameter Transferã€‹</a>ï¼Œéšç€LLMè®­ç»ƒçš„æ™®åŠï¼Œå®ƒé€æ¸å·²ç»æˆä¸ºäº†ç§‘å­¦ç‚¼ä¸¹çš„äº‹å®æ ‡é…ä¹‹ä¸€ã€‚</p>
<h2 id="_1">æ–¹æ³•å¤§æ„</h2>
<p>åœ¨æ¥å…¥ä¸»é¢˜ä¹‹å‰ï¼Œå¿…é¡»å…ˆåæ§½ä¸€ä¸‹MuPåŸè®ºæ–‡å†™å¾—å®åœ¨å¤ªè¿‡æ™¦æ¶©ï¼Œå¹¶ä¸”ç»“è®ºçš„è¡¨è¾¾ä¹Ÿä¸å¤Ÿæ¸…æ™°ï¼Œå¹³ç™½å¢åŠ äº†ä¸å°‘ç†è§£éš¾åº¦ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥ç¬”è€…å°½é‡ä»¥ä¸€ç§ï¼ˆè‡ªè®¤ä¸ºï¼‰ç®€æ˜æ‰¼è¦çš„æ–¹å¼æ¥å¤ç°MuPçš„ç»“è®ºã€‚</p>
<p>å…ˆè¯´ç»“è®ºï¼ŒMuPä¸»è¦ç ”ç©¶è¶…å‚æ•°è·¨æ¨¡å‹å°ºåº¦çš„è¿ç§»è§„å¾‹ã€‚è¿™é‡Œæœ‰å‡ ä¸ªå…³é”®è¯ï¼š</p>
<blockquote>
<p>1ã€è¶…å‚æ•°ï¼Œç›®å‰ä¸»è¦æŒ‡<strong>å­¦ä¹ ç‡</strong> ï¼›</p>
<p>2ã€æ¨¡å‹å°ºåº¦ï¼Œç›®å‰ä¸»è¦æ˜¯æ¨¡å‹<strong>å®½åº¦</strong> ï¼›</p>
<p>3ã€è¿™é‡Œçš„æ ¸å¿ƒæ˜¯â€œ<strong>è¿ç§»</strong> â€ã€‚</p>
</blockquote>
<p>è¯·æ³¨æ„ï¼ŒMuPä¸ç ”ç©¶ä»€ä¹ˆæ˜¯æœ€ä¼˜çš„è¶…å‚æ•°ï¼Œåªç ”ç©¶æœ€ä¼˜è¶…å‚æ•° <em>éšç€æ¨¡å‹å°ºåº¦çš„å˜åŒ–è§„å¾‹</em> ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨æŸä¸ªå°æ¨¡å‹ä¸Šæœç´¢æœ€ä¼˜çš„è¶…å‚æ•°ç»„åˆï¼Œç„¶åè¿ç§»åˆ°å¤§æ¨¡å‹ä¸Šï¼Œè¿™å°±æ˜¯MuPçš„ä½¿ç”¨åœºæ™¯å’Œä½¿ç”¨æ–¹æ³•ã€‚</p>
<p>æ¨å¯¼MuPçš„åŸç†æ˜¯è®©æ¨¡å‹çš„ <em>å‰å‘ä¼ æ’­ã€åå‘ä¼ æ’­ã€æŸå¤±å¢é‡å’Œç‰¹å¾å˜åŒ–</em> éƒ½ä¸éšæ¨¡å‹å°ºåº¦çš„å˜åŒ–è€Œå‘ç”Ÿæ˜æ˜¾å˜åŒ–ï¼š</p>
<blockquote>
<p>1ã€å…·ä½“åšæ³•æ˜¯åˆ†æåˆå§‹åŒ–çš„æ•°é‡çº§ï¼Œç„¶åè®¤ä¸ºç»“è®ºå¯ä»¥ä»£è¡¨åç»­ä¼˜åŒ–çš„è§„å¾‹ï¼›</p>
<p>2ã€è¯´ç™½äº†å°±æ˜¯å‡è®¾åšå¥½åˆå§‹åŒ–ï¼Œåé¢å°±ä¼šè‡ªåŠ¨æ²¿ç€æ­£ç¡®çš„è½¨è¿¹èµ°ï¼ˆå¥½çš„å¼€å§‹æ˜¯æˆåŠŸçš„ä¸€å¤§åŠï¼Ÿï¼‰;</p>
<p>3ã€å½“ç„¶ä¹Ÿå¯ä»¥ç»™è¿™ä¸ªå‡è®¾è®²<strong>å¤§æ•°å®šå¾‹</strong> æˆ–<strong>ä¸­å¿ƒæé™å®šç†</strong> çš„æ•…äº‹ï¼Œä½†ä¸ªäººè®¤ä¸ºéå¿…é¡»ã€‚</p>
</blockquote>
<h2 id="_2">å‰å‘ä¼ æ’­</h2>
<p>æˆ‘ä»¬ä»å‰å‘ä¼ æ’­å¼€å§‹è®¨è®ºï¼Œå› ä¸ºè¿™æ˜¯ç›¸å¯¹ç®€å•ä¸”æˆç†Ÿçš„éƒ¨åˆ†ã€‚é¦–å…ˆï¼Œè€ƒè™‘çº¿æ€§å±‚$\boldsymbol{Y}=\boldsymbol{X}\boldsymbol{W}$ï¼Œå…¶ä¸­$\boldsymbol{X}\in\mathbb{R}^{b\times d_{in}},\boldsymbol{W}\in\mathbb{R}^{d_{in}\times d_{out}}$ã€‚æˆ‘ä»¬ç”¨RMSï¼ˆRoot Mean Squareï¼‰æ¥ä½œä¸ºçŸ©é˜µå°ºåº¦çš„æŒ‡æ ‡ï¼Œä¾‹å¦‚<br />
\begin{equation}\text{RMS}(\boldsymbol{W}) = \sqrt{\frac{1}{d_{in} d_{out}}\sum_{i=1}^{d_{in}} \sum_{j=1}^{d_{out}} W_{i,j}^2}\end{equation}</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œè¦è®©åˆå§‹åŒ–é˜¶æ®µ$\boldsymbol{X}$çš„RMSè·Ÿ$\boldsymbol{Y}$çš„RMSå¤§è‡´ç›¸ç­‰ï¼ˆç®€ç§°â€œ<strong>ç¨³å®š</strong> â€ï¼‰ï¼Œé‚£ä¹ˆ$\boldsymbol{W}$è¦ç”¨ï¼š</p>
<blockquote>
<p><strong>LeCunåˆå§‹åŒ–</strong> ï¼šâ€œå‡å€¼ä¸º0ã€æ–¹å·®ä¸º$1/d_{in}$â€çš„éšæœºåˆå§‹åŒ–ã€‚</p>
</blockquote>
<p>è¿™å·²ç»ç®—æ˜¯æ·±åº¦å­¦ä¹ çš„åŸºç¡€ç»“è®ºä¹‹ä¸€ï¼Œæ‰€ä»¥ä¸å†å±•å¼€æ¨å¯¼ï¼Œè¿˜ä¸å¤§äº†è§£çš„è¯»è€…å¯ä»¥å‚è€ƒä»¥å¾€çš„<a href="/archives/7180">ã€Šä»å‡ ä½•è§†è§’æ¥ç†è§£æ¨¡å‹å‚æ•°çš„åˆå§‹åŒ–ç­–ç•¥ã€‹</a>ã€<a href="/archives/8620">ã€Šæµ…è°ˆTransformerçš„åˆå§‹åŒ–ã€å‚æ•°åŒ–ä¸æ ‡å‡†åŒ–ã€‹</a>ç­‰åšæ–‡ã€‚</p>
<p>æ¥ç€ï¼Œæˆ‘ä»¬è€ƒè™‘éçº¿æ€§å±‚$\boldsymbol{Y}=\phi(\boldsymbol{X}\boldsymbol{W})$ï¼Œå…¶ä¸­$\phi$æ˜¯Element-wiseçš„æ¿€æ´»å‡½æ•°ã€‚å¦‚æœè¿˜æ˜¯è¦ç»´æŒ$\boldsymbol{X}$çš„RMSè·Ÿ$\boldsymbol{Y}$çš„RMSè¿‘ä¼¼ç›¸ç­‰ï¼Œé‚£ä¹ˆç»“æœä¼šç¨æœ‰ä¸åŒï¼Œæ¯”å¦‚$\text{relu}$æ¿€æ´»æ—¶æˆ‘ä»¬å¾—åˆ°</p>
<blockquote>
<p><strong>Kaimingåˆå§‹åŒ–</strong> ï¼šâ€œå‡å€¼ä¸º0ã€æ–¹å·®ä¸º$2/d_{in}$â€çš„éšæœºåˆå§‹åŒ–ã€‚</p>
</blockquote>
<p>å®¹æ˜“çœ‹å‡ºï¼Œ<strong>Kaimingåˆå§‹åŒ–</strong> è·Ÿ<strong>LeCunåˆå§‹åŒ–</strong> ç›¸æ¯”ï¼Œåªæ˜¯æ–¹å·®ç›¸å·®ä¸€ä¸ªï¼ˆè·Ÿæ¨¡å‹å°ºåº¦æ— å…³çš„ï¼‰å¸¸æ•°2ï¼Œå¯ä»¥è¯æ˜å…¶ä»–æ¿€æ´»å‡½æ•°çš„ç»“æœä¹Ÿç±»ä¼¼ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸‹ä¸€ä¸ªç»“è®ºï¼š</p>
<blockquote>
<p><strong>fan_inåˆå§‹åŒ–</strong> ï¼šè¦ä¿è¯å‰å‘ä¼ æ’­çš„ç¨³å®šæ€§ï¼Œé‚£ä¹ˆåº”è¯¥è¦ç”¨â€œå‡å€¼ä¸º0ã€æ–¹å·® <em>æ­£æ¯”äº</em> $1/d_{in}$â€çš„éšæœºåˆå§‹åŒ–ã€‚</p>
</blockquote>
<p>è¿™ä¸ªç»“è®ºä¹Ÿå¯ä»¥ç†è§£ä¸ºâ€œæ¿€æ´»å‡½æ•°çš„å½±å“æ˜¯æ¨¡å‹å°ºåº¦æ— å…³çš„â€ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬åªæƒ³åˆ†ææ¨¡å‹å°ºåº¦çš„æ•ˆåº”ï¼Œé‚£ä¹ˆå¯ä»¥å¿½ç•¥ï¼ˆElement-wiseçš„ï¼‰æ¿€æ´»å‡½æ•°çš„å­˜åœ¨ï¼Œç”±LeCunåˆå§‹åŒ–ç›´æ¥å¾—åˆ°ç¼©æ”¾è§„å¾‹$\propto 1/d_{in}$ã€‚</p>
<h2 id="_3">åå‘ä¼ æ’­</h2>
<p>ç°åœ¨æˆ‘ä»¬ç»§ç»­åˆ†æåå‘ä¼ æ’­ï¼ˆæ¢¯åº¦ï¼‰ï¼Œæ³¨æ„è¿™é‡Œçº¦å®šå˜é‡åŠå…¶æ¢¯åº¦å…·æœ‰ç›¸åŒçš„shapeï¼Œé‚£ä¹ˆå¯ä»¥ç®—å¾—<br />
\begin{align}<br />
\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}} =&amp;\, \boldsymbol{X}^{\top}\left(\frac{\partial\mathcal{L}}{\partial \boldsymbol{Y}}\otimes \phi'(\boldsymbol{X}\boldsymbol{W})\right) \\\[5pt]<br />
\frac{\partial\mathcal{L}}{\partial \boldsymbol{X}} =&amp;\, \left(\frac{\partial\mathcal{L}}{\partial \boldsymbol{Y}}\otimes \phi'(\boldsymbol{X}\boldsymbol{W})\right)\boldsymbol{W}^{\top}<br />
\end{align}<br />
ç¬¬ä¸€ä¸ªå…¬å¼æ˜¯å½“å‰å±‚å†…å‚æ•°çš„æ¢¯åº¦ï¼Œç¬¬äºŒä¸ªå…¬å¼åˆ™æ˜¯è¯¥å±‚å¾€å‰ä¼ æ’­çš„æ¢¯åº¦ï¼Œ$\otimes$æ˜¯Hadamardç§¯ï¼Œ$\phi'$æ˜¯$\phi$çš„å¯¼å‡½æ•°ã€‚</p>
<p>æ³¨æ„åˆ°ä¸€ä¸ªäº‹å®ï¼šæˆ‘ä»¬å¸¸ç”¨çš„æ¿€æ´»å‡½æ•°ï¼Œå…¶å¯¼æ•°éƒ½å¯ä»¥è¢«ä¸€ä¸ªï¼ˆå°ºåº¦æ— å…³çš„ï¼‰å¸¸æ•°ç»™Boundä½ï¼Œæ‰€ä»¥è‡³å°‘åœ¨æ•°é‡çº§ä¸Šæˆ‘ä»¬å¯ä»¥å†™å‡º<br />
\begin{align}<br />
\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}} =&amp;\, \boldsymbol{X}^{\top}\left(\frac{\partial\mathcal{L}}{\partial \boldsymbol{Y}}\otimes \phi'(\boldsymbol{X}\boldsymbol{W})\right) \sim \boldsymbol{X}^{\top}\frac{\partial\mathcal{L}}{\partial \boldsymbol{Y}} \label{eq:grad-w}\\\[5pt]<br />
\frac{\partial\mathcal{L}}{\partial \boldsymbol{X}} =&amp;\, \left(\frac{\partial\mathcal{L}}{\partial \boldsymbol{Y}}\otimes \phi'(\boldsymbol{X}\boldsymbol{W})\right)\boldsymbol{W}^{\top}\sim \frac{\partial\mathcal{L}}{\partial \boldsymbol{Y}}\boldsymbol{W}^{\top}\label{eq:grad-x}<br />
\end{align}<br />
æˆ‘ä»¬å…ˆæ¥çœ‹ç¬¬äºŒä¸ªå…¬å¼ï¼Œè·Ÿ$\boldsymbol{Y}=\boldsymbol{X}\boldsymbol{W}$ç›¸æ¯”ï¼Œå®ƒå³ç«¯ä¹˜çš„çŸ©é˜µå˜æˆäº†$\boldsymbol{W}^{\top}$ï¼Œé‚£ä¹ˆæŒ‰ç…§ä¸Šä¸€èŠ‚çš„ç»“è®ºï¼Œå¦‚æœè¦ä¿æŒåå‘ä¼ æ’­çš„RMSç¨³å®šæ€§ï¼Œé‚£ä¹ˆ$\boldsymbol{W}$çš„åˆå§‹åŒ–å°±åº”è¯¥æ˜¯ï¼š</p>
<blockquote>
<p><strong>fan_outåˆå§‹åŒ–</strong> ï¼šâ€œå‡å€¼ä¸º0ã€æ–¹å·®ä¸º$1/d_{out}$â€çš„éšæœºåˆå§‹åŒ–ã€‚</p>
</blockquote>
<p>å½“$d_{in}\neq d_{out}$æ—¶ï¼Œå‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­çš„è¦æ±‚å°±å‡ºç°å†²çªï¼Œè¿™æ—¶å€™æœ‰äººæäº†ä¸€ä¸ªæŠ˜ä¸­ç­–ç•¥ï¼š</p>
<blockquote>
<p><strong>Xavieråˆå§‹åŒ–</strong> ï¼šâ€œå‡å€¼ä¸º0ã€æ–¹å·®ä¸º$2/(d_{in} + d_{out})$â€çš„éšæœºåˆå§‹åŒ–ã€‚</p>
</blockquote>
<p>è¿™ä¹Ÿå«â€œ<strong>fan_avgåˆå§‹åŒ–</strong> â€ï¼Œå› ä¸ºå°±æ˜¯å°†$d_{in}$å’Œ$d_{out}$ç®€å•ä»£æ•°å¹³å‡äº†ä¸€ä¸‹ï¼Œå…¶ä»–å¹³å‡æ–¹å¼ä¹Ÿå¯ä»¥è€ƒè™‘ï¼Œå‚è€ƒ<a href="/archives/8725">ã€Šåˆå§‹åŒ–æ–¹æ³•ä¸­éæ–¹é˜µçš„ç»´åº¦å¹³å‡ç­–ç•¥æ€è€ƒã€‹</a>ã€‚Xavieråˆå§‹åŒ–çœ‹ä¸Šå»åŒæ—¶å…¼é¡¾äº†å‰å‘å’Œåå‘ï¼Œä½†ä¹Ÿå¯ä»¥è¯´ä¸¤è€…éƒ½æ²¡å…¼é¡¾ï¼Œæ›´å¥½çš„åŠæ³•æ˜¯è®¾è®¡æ¨¡å‹è®©å¤§éƒ¨åˆ†å‚æ•°éƒ½æ˜¯æ–¹é˜µï¼Œå¦‚åé¢è®¨è®ºçš„æ¨¡å‹ç°‡$\eqref{eq:model}$ã€‚</p>
<h2 id="_4">æŸå¤±å¢é‡</h2>
<p>æœ‰äº†å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­çš„é“ºå«ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°è¯•åˆ†ææŸå¤±å‡½æ•°çš„å¢é‡äº†ã€‚è€ƒè™‘$\boldsymbol{W}\to \boldsymbol{W} + \Delta\boldsymbol{W}$æ—¶æŸå¤±å‡½æ•°çš„å˜åŒ–é‡<br />
\begin{equation}\Delta \mathcal{L} = \mathcal{L}(\boldsymbol{W} + \Delta\boldsymbol{W}) - \mathcal{L}(\boldsymbol{W})\approx \left\langle\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}}, \Delta\boldsymbol{W}\right\rangle_F\end{equation}<br />
è¿™é‡Œçš„$\langle\cdot,\cdot\rangle_F$æ˜¯Frobeniuså†…ç§¯ï¼Œå³æŠŠçŸ©é˜µå±•å¹³æˆå‘é‡åç®—å‘é‡å†…ç§¯ã€‚è€ƒè™‘æ¢¯åº¦ä¸‹é™$\Delta\boldsymbol{W} = -\eta \frac{\partial\mathcal{L}}{\partial \boldsymbol{W}}$ï¼Œè¿™é‡Œ$\eta$è‡ªç„¶æ˜¯å­¦ä¹ ç‡ï¼Œç»“åˆå¼$\eqref{eq:grad-w}$ï¼Œæˆ‘ä»¬æœ‰<br />
$$\begin{equation}\Delta \mathcal{L}\approx -\eta\left\Vert\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}}\right\Vert_F^2\sim -\eta \left\Vert\boldsymbol{X}^{\top}\frac{\partial\mathcal{L}}{\partial \boldsymbol{Y}}\right\Vert_F^2\end{equation}$$<br />
äº‹å®ä¸Šï¼Œè¿™ä¸ªå¼å­å·²ç»å‘Šè¯‰äº†æˆ‘ä»¬åŒä¸€ä¸ªå­¦ä¹ ç‡$\eta$ä¸èƒ½è·¨æ¨¡å‹å°ºåº¦ä½¿ç”¨çš„åŸå› ï¼š</p>
<blockquote>
<p>1ã€$\boldsymbol{X}^{\top}\frac{\partial\mathcal{L}}{\partial \boldsymbol{Y}}$æ˜¯ä¸€ä¸ª$d_{in}\times d_{out}$çš„çŸ©é˜µï¼›</p>
<p>2ã€$\left\Vert\boldsymbol{X}^{\top}\frac{\partial\mathcal{L}}{\partial \boldsymbol{Y}}\right\Vert_F^2$æ˜¯$d_{in}\times d_{out}$ä¸ªæ•°çš„å¹³æ–¹å’Œï¼›</p>
<p>3ã€$\boldsymbol{X}^{\top}\frac{\partial\mathcal{L}}{\partial \boldsymbol{Y}}$æ­£å¥½æ˜¯å‰å‘å’Œåå‘çš„ä¹˜ç§¯ï¼›</p>
<p>4ã€å¦‚æœå‰å‘å’Œåå‘éƒ½ç¨³å®šï¼Œé‚£ä¹ˆ$\boldsymbol{X}^{\top}\frac{\partial\mathcal{L}}{\partial \boldsymbol{Y}}$æ¯ä¸ªå…ƒç´ éƒ½æ˜¯$\mathcal{\Theta}(1)$ï¼ˆ$\mathcal{\Theta}$æ˜¯â€œ<a href="https://en.wikipedia.org/wiki/Big_O_notation#Family_of_Bachmann%E2%80%93Landau_notations">Big Theta Notation</a>â€ï¼‰ï¼›</p>
<p>5ã€æ‰€ä»¥$\left\Vert\boldsymbol{X}^{\top}\frac{\partial\mathcal{L}}{\partial \boldsymbol{Y}}\right\Vert_F^2$å°±æ˜¯$\mathcal{\Theta}(d_{in} d_{out})$ã€‚</p>
</blockquote>
<p>ç¬¬4ç‚¹å¯èƒ½è¦å¤šåŠ è¯„è¿°ä¸€ä¸‹ã€‚$\boldsymbol{X}^{\top}$æ˜¯ä¸€ä¸ª$d_{in}\times b$çŸ©é˜µï¼Œ$\frac{\partial\mathcal{L}}{\partial \boldsymbol{Y}}$æ˜¯ä¸€ä¸ª$b\times d_{out}$çŸ©é˜µï¼Œä¸¤è€…ç›¸ä¹˜å°±æ˜¯$d_{in} d_{out}$ä¸ª$b$ç»´å‘é‡å¯¹åšå†…ç§¯ï¼Œå†…ç§¯æ˜¯$b$é¡¹æ±‚å’Œï¼Œè€ŒæŸå¤±$\mathcal{L}$é€šå¸¸æ˜¯å¯¹æ ·æœ¬æ±‚å¹³å‡ï¼ˆå³åŒ…å«äº†é™¤ä»¥$b$æ“ä½œï¼‰ï¼Œæ‰€ä»¥å¦‚æœ$\boldsymbol{X}^{\top}$å’Œ$\frac{\partial\mathcal{L}}{\partial \boldsymbol{Y}}$éƒ½æ˜¯å°ºåº¦æ— å…³çš„ï¼Œé‚£ä¹ˆå®ƒä»¬ä¹˜èµ·æ¥åŸºæœ¬ä¹Ÿæ˜¯å°ºåº¦æ— å…³çš„ã€å³RMSéƒ½æ˜¯$\mathcal{\Theta}(1)$ã€‘ã€‚</p>
<p>æœ€åçš„ç»“è®ºè¡¨æ˜ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥å°†å°æ¨¡å‹çš„å­¦ä¹ ç‡ç”¨äºå¤§æ¨¡å‹ï¼Œé‚£ä¹ˆå¯¹äºè¶³å¤Ÿå¤§çš„æ¨¡å‹ï¼Œå®ƒçš„æ¯ä¸€æ­¥æŸå¤±å¢é‡å°±ä¼šéšç€å‚æ•°å°ºåº¦ï¼ˆå³$d_{in} d_{out}$ï¼‰çš„å˜å¤§è€Œ <em><strong>çˆ†ç‚¸</strong></em> ï¼Œè¿™æ„å‘³ç€æ²¡æ³•å¤åˆ¶å°æ¨¡å‹çš„æ”¶æ•›è¿‡ç¨‹ï¼Œç”šè‡³å¯èƒ½å› ä¸ºæ­¥å­è¿ˆå¾—å¤ªå¤§å¯¼è‡´æ— æ³•æ”¶æ•›ã€‚</p>
<p>æ­¤æ—¶å¤§å®¶å¯èƒ½æƒ³åˆ°çš„ä¸€ä¸ªåšæ³•æ˜¯è®©$\eta\propto 1/(d_{in} d_{out})$æ¥ç¼©æ”¾$\Delta\mathcal{L}$ï¼Œäº‹å®ä¸Šè¿™ä¸ªæƒ³æ³•å·²ç»è·Ÿä¸Šäº†MuPçš„æ€è·¯ï¼Œä½†å®é™…åœºæ™¯ä¸­ç”±äºå‰é¢è¯´çš„å‰å‘å’Œåå‘çš„ä¸å…¼å®¹æ€§ï¼Œå¯¼è‡´ç¬¬4ç‚¹â€œå¦‚æœå‰å‘å’Œåå‘éƒ½ç¨³å®šï¼Œé‚£ä¹ˆ$\boldsymbol{X}^{\top}\frac{\partial\mathcal{L}}{\partial \boldsymbol{Y}}$æ¯ä¸ªå…ƒç´ å°±æ˜¯$\mathcal{\Theta}(1)$â€ä¸èƒ½æ€»æ˜¯æˆç«‹ï¼Œæ‰€ä»¥å®é™…æƒ…å†µæ›´ä¸ºå¤æ‚ä¸€äº›ï¼Œ</p>
<h2 id="_5">æ¨¡å‹å‡è®¾</h2>
<p>ç°åœ¨è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªæ›´æ¥è¿‘å®è·µçš„åœºæ™¯ã€‚æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯è®­ç»ƒä¸€ä¸ª$\mathbb{R}^{d_{in}}\mapsto \mathbb{R}^{d_{out}}$çš„æ¨¡å‹ï¼Œå…¶ä¸­$d_{in},d_{out}$æ˜¯æ•°æ®å†³å®šçš„ï¼Œä¸å¯æ”¹å˜ã€‚å¼€å¤´æˆ‘ä»¬å°±è¯´äº†ï¼ŒMuPæ—¨åœ¨ç ”ç©¶è¶…å‚æ•°éšç€æ¨¡å‹å°ºåº¦çš„ç¼©æ”¾è§„å¾‹ï¼Œæ‰€ä»¥ä¸€åˆ‡å›ºå®šä¸å˜çš„é‡ï¼Œéƒ½ç›¸å½“äºæ˜¯å¸¸æ•°æˆ–è€…è¯´$\mathcal{\Theta}(1)$ï¼Œæ¯”å¦‚åˆå§‹åŒ–æ–¹å·®ä¸º$1/d_{in}$ï¼Œç­‰ä»·äºè¯´åˆå§‹åŒ–æ–¹å·®ä¸º$\mathcal{\Theta}(1)$ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æ”¹å˜çš„æ˜¯æ¨¡å‹çš„æ¶æ„ã€å‚æ•°é‡ç­‰éƒ¨åˆ†ï¼Œä½†MuPä¸»è¦è€ƒè™‘å®½åº¦çš„è§„å¾‹ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠæ¨¡å‹çš„æ¶æ„å®šä¸€ä¸‹ã€‚è¿™é‡Œä¸»è¦è€ƒè™‘çš„æ¨¡å‹ç°‡æ˜¯ï¼š<br />
\begin{equation}\begin{gathered}<br />
\boldsymbol{Y}<em in="in">{in} = \boldsymbol{X} \boldsymbol{W}</em> \\\[5pt]<br />
\boldsymbol{Y}<em in="in">{out} = \text{NN}(\boldsymbol{Y}</em>) \\\[5pt]},\boldsymbol{\Omega<br />
\boldsymbol{Z} = \boldsymbol{Y}<em out="out">{out} \boldsymbol{W}</em><br />
\end{gathered}\label{eq:model}\end{equation}</p>
<p>å…¶ä¸­ï¼š</p>
<blockquote>
<p>1ã€$\boldsymbol{X}\in\mathbb{R}^{b\times d_{in}}$ï¼ˆå¸¦ä¸Šäº†batch sizeï¼‰ï¼›</p>
<p>2ã€$\boldsymbol{W}<em in="in">{in} \in \mathbb{R}^{d</em>}\times d}, \boldsymbol{W<em out="out">{out} \in \mathbb{R}^{d\times d</em>$ï¼›}</p>
<p>3ã€$\text{NN}$æ˜¯ä»»æ„$\mathbb{R}^d\mapsto \mathbb{R}^d$çš„ç¥ç»ç½‘ç»œï¼›</p>
<p>4ã€è¿™é‡Œ$d$å…¶å®å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„hidden sizeï¼›</p>
<p>5ã€æˆ‘ä»¬å¯ä»¥éšæ„è°ƒå¤§$d$ï¼Œæ¥æå‡æ¨¡å‹çš„å‚æ•°é‡å’Œæ½œåŠ›ï¼›</p>
<p>6ã€MuPå°±æ˜¯æƒ³ç ”ç©¶è¶…å‚æ•°å…³äº$d$çš„å˜åŒ–è§„å¾‹ã€‚</p>
</blockquote>
<p>æ›´å…·ä½“ä¸€ç‚¹ï¼Œè¿™é‡Œæˆ‘ä»¬è€ƒè™‘çš„$\text{NN}$æ˜¯$K$å±‚MLPï¼š<br />
\begin{equation}\begin{aligned}<br />
\boldsymbol{Y}<em in="in">0 =&amp;\, Y</em> \\\[5pt]<br />
\boldsymbol{Y}<em k_1="k+1">{k+1} =&amp;\, \phi(\boldsymbol{Y}_k \boldsymbol{W}</em>) \\\[5pt]<br />
\boldsymbol{Y}_{out} =&amp;\, \boldsymbol{Y}_K<br />
\end{aligned}\end{equation}<br />
è¿™é‡Œ$\boldsymbol{\Omega}=\{\boldsymbol{W}_1,\boldsymbol{W}_2,\cdots,\boldsymbol{W}_K\}$ï¼Œ$\boldsymbol{W}_k\in\mathbb{R}^{d\times d}$ï¼Œå³éƒ½æ˜¯$d\times d$çš„<strong>æ–¹é˜µ</strong> ï¼Œå…¨éƒ½ç”¨<strong>fan_inåˆå§‹åŒ–</strong> ï¼ˆç­‰ä»·åœ°ï¼Œä¹Ÿæ˜¯<strong>fan_outåˆå§‹åŒ–</strong> ï¼‰ã€‚</p>
<p>è¡¥å……ä¸€ä¸‹ï¼Œè¿™é‡Œçº¦å®šæ‰€æœ‰å‚æ•°çŸ©é˜µéƒ½æ˜¯$d\times d$æ–¹é˜µï¼Œçº¯ç²¹æ˜¯ä¸ºäº†ç®€åŒ–åˆ†æï¼Œå¹¶ä¸æ˜¯å¼ºåˆ¶è¦æ±‚ã€‚å› ä¸ºè¿™é‡ŒçœŸæ­£çš„ç›®çš„æ˜¯å‡è®¾$\text{NN}$çš„å‚æ•°é‡Œ <em>æ²¡æœ‰å°ºåº¦æ— å…³çš„å½¢çŠ¶</em> ï¼Œæ¯”å¦‚ä¸å…è®¸$d\times 64$è¿™æ ·çš„å½¢çŠ¶ï¼Œå› ä¸º$64$æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œä½†$d\times 4d$è¿™æ ·çš„å½¢çŠ¶æ˜¯å…è®¸çš„ï¼Œå› ä¸ºä½ ä¸ç®¡fan_inã€fan_outæˆ–fan_avgåˆå§‹åŒ–ï¼Œæ–¹å·®éƒ½æ˜¯æ­£æ¯”äº$1/d$ã€‚</p>
<h2 id="_6">ç»„è£…èµ·æ¥</h2>
<p>ç¡®ç«‹åå…·ä½“æ¨¡å‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠå‰é¢çš„ç»“è®ºéƒ½ç»„è£…èµ·æ¥äº†ã€‚è¦æ›´æ–°çš„å‚æ•°åˆ†ä¸º$\boldsymbol{W}<em out="out">{in},\boldsymbol{\Omega},\boldsymbol{W}</em>$ä¸‰éƒ¨åˆ†ï¼Œåˆ†åˆ«æ±‚æ¢¯åº¦ï¼š<br />
\begin{align}<br />
\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}<em out="out">{out}} =&amp;\, \boldsymbol{Y}</em> \\\[6pt]}^{\top}\frac{\partial\mathcal{L}}{\partial \boldsymbol{Z}<br />
\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}<em out="out">k} =&amp;\, \frac{\partial \boldsymbol{Y}</em>}}{\partial \boldsymbol{W<em out="out">k} \cdot\frac{\partial\mathcal{L}}{\partial \boldsymbol{Y}</em>}} = \frac{\partial \boldsymbol{Y<em out="out">{out}}{\partial \boldsymbol{W}_k} \cdot\left(\frac{\partial\mathcal{L}}{\partial \boldsymbol{Z}}\boldsymbol{W}</em>\right) \\\[6pt]}^{\top<br />
\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}<em in="in">{in}} =&amp;\, \boldsymbol{X}^{\top} \frac{\partial\mathcal{L}}{\partial \boldsymbol{Y}</em>}} = \boldsymbol{X}^{\top} \left(\frac{\partial\boldsymbol{Y<em in="in">{out}}{\partial \boldsymbol{Y}</em>}}\cdot\frac{\partial\mathcal{L}}{\partial \boldsymbol{Y<em out="out">{out}}\right) = \boldsymbol{X}^{\top} \left(\frac{\partial\boldsymbol{Y}</em>}}{\partial \boldsymbol{Y<em out="out">{in}}\cdot\left(\frac{\partial\mathcal{L}}{\partial \boldsymbol{Z}}\boldsymbol{W}</em>\right)\right) \\\[6pt]}^{\top<br />
\end{align}</p>
<p>è¿™é‡Œçš„$\cdot$è¿ç®—éœ€è¦ç¨å¾®è§£é‡Šä¸€ä¸‹ï¼š$\boldsymbol{Y}<em out="out">{in},\boldsymbol{Y}</em>}$éƒ½æ˜¯ä¸€ä¸ªçŸ©é˜µï¼Œæ‰€ä»¥$\frac{\partial\boldsymbol{Y<em in="in">{out}}{\partial \boldsymbol{Y}</em>}}$åŸåˆ™ä¸Šæ˜¯ä¸€ä¸ªå››é˜¶å¼ é‡ï¼Œé“¾å¼æ³•åˆ™$\frac{\partial\boldsymbol{Y<em in="in">{out}}{\partial \boldsymbol{Y}</em>$å®é™…æ˜¯é«˜é˜¶å¼ é‡çš„ä¹˜æ³•ï¼Œä½†è¿™é‡Œä¸æ‰“ç®—å±•å¼€ä»‹ç»äº†ï¼Œæ‰€ä»¥ç®€å•ç”¨ä¸€ä¸ª$\cdot$ä»£æ›¿ï¼Œè¯»è€…åªéœ€è¦çŸ¥é“å®ƒæ˜¯çŸ©é˜µä¹˜æ³•çš„ä¸€èˆ¬æ¨å¹¿å°±è¡Œã€‚}}\cdot\frac{\partial\mathcal{L}}{\partial \boldsymbol{Y}_{out}</p>
<p>ç°åœ¨æ¥è§‚å¯Ÿè§„å¾‹ï¼š</p>
<blockquote>
<p>1ã€ä¸‰ä¸ªå¼å­éƒ½æœ‰$\frac{\partial\mathcal{L}}{\partial \boldsymbol{Z}}$ï¼›</p>
<p>2ã€åä¸¤å¼éƒ½æœ‰$\boldsymbol{W}_{out}^{\top}$ï¼›</p>
<p>3ã€$\boldsymbol{W}<em out="out">k$é‡Œéƒ½æ˜¯æ–¹é˜µï¼Œ$\frac{\partial\boldsymbol{Y}</em>}}{\partial \boldsymbol{Y<em out="out">{in}}$å’Œ$\frac{\partial \boldsymbol{Y}</em>(1)$ã€‘ï¼›}}{\partial \boldsymbol{W}_k}$éƒ½æ˜¯ç¨³å®šçš„ã€RMSæ˜¯$\mathcal{\Theta</p>
<p>4ã€å¦‚æœ$\boldsymbol{W}<em out="out">{in}$ä¹Ÿç”¨fan_inåˆå§‹åŒ–ï¼Œé‚£ä¹ˆ$\boldsymbol{Y}</em>$ä¹Ÿæ˜¯ç¨³å®šçš„ï¼›</p>
<p>5ã€è¦æƒ³$\frac{\partial\mathcal{L}}{\partial \boldsymbol{Z}}\boldsymbol{W}<em out="out">{out}^{\top}$ç¨³å®šï¼Œé‚£ä¹ˆåˆå§‹åŒ–æ–¹å·®æ˜¯$1/d</em>$æ˜¯å°ºåº¦æ— å…³çš„ï¼Œç›¸å½“äºå¸¸æ•°ã€‚}$ï¼Œä½†$d_{out</p>
</blockquote>
<p>è¿™æ ·ä¸€æ¥ï¼š</p>
<blockquote>
<p>1ã€$\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}<em out="out">{out}}$çš„RMSæ˜¯$\mathcal{\Theta}(1)$ï¼Œ$\left\Vert\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}</em>\propto 1/d$ï¼›}}\right\Vert_F^2$æ˜¯$d\times d_{out}$ä¸ªæ•°å¹³æ–¹å’Œï¼Œæ‰€ä»¥å¤§å°æ˜¯$\mathcal{\Theta}(d\times d_{out})$ï¼Œåˆ«å¿˜äº†$d_{out}$æ˜¯å¸¸æ•°ï¼Œæ‰€ä»¥å®é™…ä¸Šå°±æ˜¯$\mathcal{\Theta}(d)$ï¼Œäºæ˜¯ä¸ºäº†å¾—åˆ°$\mathcal{\Theta}(1)$çš„$\Delta\mathcal{L}$ï¼Œå®ƒçš„å­¦ä¹ ç‡è¦æ»¡è¶³$\eta_{out</p>
<p>2ã€$\left\Vert\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}<em out="out">k}\right\Vert_F^2$æ˜¯$d^2$ä¸ªæ•°æ±‚å’Œï¼Œ$\frac{\partial \boldsymbol{Y}</em>}}{\partial \boldsymbol{W<em out="out">k}$å’Œ$\frac{\partial\mathcal{L}}{\partial \boldsymbol{Z}}$çš„RMSéƒ½æ˜¯$\mathcal{\Theta}(1)$ï¼Œæˆ‘ä»¬ç›´æ¥å°†$\boldsymbol{W}</em>(1)$ï¼Œå› æ­¤å­¦ä¹ ç‡ä¸ç”¨å˜åŒ–ï¼›}$çš„åˆå§‹åŒ–æ–¹å·®è®¾ä¸º$\propto 1/d^2$ï¼Œé‚£ä¹ˆ$\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}_k}$çš„RMSå°±æ˜¯$\mathcal{\Theta}(1/d)$ï¼Œå¹³æ–¹æ±‚å’Œåå°±æ­£å¥½æ˜¯$\mathcal{\Theta</p>
<p>3ã€æ­¤æ—¶$\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}<em in="in">{in}}$çš„RMSä¹Ÿæ˜¯$\mathcal{\Theta}(1/d)$ï¼Œä½†$\left\Vert\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}</em>\propto d$ã€‚}}\right\Vert_F^2$åªæ˜¯$d_{in}\times d$ä¸ªæ•°å¹³æ–¹å’Œï¼Œæ‰€ä»¥ç»“æœæ˜¯$\mathcal{\Theta}(1/d)$çš„ï¼Œä¸ºäº†å¾—åˆ°$\mathcal{\Theta}(1)$çš„$\Delta\mathcal{L}$ï¼Œå­¦ä¹ ç‡åè€Œéœ€è¦æ”¾å¤§$d$å€æ¥æŠµæ¶ˆè¿™ä¸ªå½±å“ï¼Œå³$\eta_{in</p>
</blockquote>
<h2 id="_7">ç‰¹å¾å˜åŒ–</h2>
<p>ä»¥ä¸Šç»“æœæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†ä»”ç»†æ€è€ƒæˆ‘ä»¬ä¼šå‘ç°æ¨å¯¼è¿‡ç¨‹çš„ä¸€ä¸ªé—®é¢˜ï¼šä¸Šé¢çš„ç¬¬2ã€3ç‚¹ï¼Œéƒ½å»ºç«‹åœ¨â€œæˆ‘ä»¬ç›´æ¥å°†$\boldsymbol{W}_{out}$çš„åˆå§‹åŒ–æ–¹å·®è®¾ä¸º$\propto 1/d^2$â€è¿™ä¸ªè®¾ç½®ä¸Šï¼Œç„¶è€Œè¿™ä¸ªè®¾ç½®ç›®å‰æ¥è¯´å¹¶æ²¡æœ‰ç›´æ¥çš„ä¾æ®ã€‚å¦‚æœä¸å¯¹æ­¤è¿›ä¸€æ­¥è§£é‡Šï¼Œé‚£ä¹ˆæ¨å¯¼è¿‡ç¨‹è¿˜æ˜¯ä¸å¤Ÿå®Œå¤‡çš„ã€‚</p>
<p>äº‹å®ä¸Šï¼Œå•çœ‹$\Delta \mathcal{L}=\mathcal{\Theta}(1)$è¿™ä¸ªè¦æ±‚çš„è¯ï¼Œç¡®å®æ˜¯æ— æ³•æ’é™¤å…¶ä»–é€‰æ‹©çš„å¯èƒ½æ€§çš„ï¼Œæ¯”å¦‚$\boldsymbol{W}<em out="out">{out}$çš„åˆå§‹åŒ–æ–¹å·®è®¾ä¸º$\propto 1/d$ï¼Œæ­¤æ—¶$\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}_k}$çš„RMSæ˜¯$\mathcal{\Theta}(1/\sqrt{d})$ï¼Œå¹³æ–¹æ±‚å’Œåæ˜¯$\mathcal{\Theta}(d)$ï¼Œé‚£ä¹ˆåªè¦å­¦ä¹ ç‡$\eta\propto 1/d$åŒæ ·å¯ä»¥å®ç°$\Delta \mathcal{L}=\mathcal{\Theta}(1)$ã€‚å› æ­¤ï¼Œä¸ºäº†è§£é‡Šâ€œ$\boldsymbol{W}</em>$çš„åˆå§‹åŒ–æ–¹å·®è®¾ä¸º$\propto 1/d^2$â€çš„å¿…è¦æ€§ï¼Œé‚£ä¹ˆå°±éœ€è¦å¼•å…¥æ–°çš„æ¡ä»¶ã€‚</p>
<p>æŸå¤±å‡½æ•°$\mathcal{L}$æ˜¯æ¨¡å‹çš„ä¸€ä¸ªå®è§‚æŒ‡æ ‡ï¼Œæˆ–è€…è¯´å¤–éƒ¨æŒ‡æ ‡ï¼Œå•çœ‹å®ƒçš„å˜åŒ–å·²ç»ä¸è¶³ä»¥è§£é‡Šå…¨éƒ¨ç»“æœäº†ï¼Œé‚£ä¹ˆå°±éœ€è¦ç»†åŒ–åˆ°æ¨¡å‹å†…éƒ¨äº†ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›æ¨¡å‹æ¯ä¸€å±‚çš„è¾“å‡ºï¼ˆé€šå¸¸ä¹Ÿç§°ä¸ºç‰¹å¾ï¼Œæœ‰æ—¶ä¹Ÿç§°æ¿€æ´»å€¼ï¼‰å˜åŒ–é‡ä¹Ÿå…·æœ‰å°ºåº¦ä¸å˜æ€§ã€‚æ¯”å¦‚çº¿æ€§å±‚$\boldsymbol{Y}<em k-1="k-1">k = \boldsymbol{Y}</em>} \boldsymbol{W<em k-1="k-1">k$ï¼Œå‚æ•°$\boldsymbol{W}_k\to \boldsymbol{W}_k + \Delta \boldsymbol{W}_k$å¸¦æ¥çš„è¾“å‡ºå˜åŒ–æ˜¯<br />
\begin{equation}\Delta\boldsymbol{Y}_k = \boldsymbol{Y}</em>} (\boldsymbol{W<em k-1="k-1">k + \Delta \boldsymbol{W}_k) - \boldsymbol{Y}</em>} \boldsymbol{W<em k-1="k-1">k = \boldsymbol{Y}</em>} \Delta\boldsymbol{W<em k-1="k-1">k\end{equation}<br />
æ³¨æ„$\boldsymbol{Y}</em>}\in\mathbb{R}^{b\times d},\Delta\boldsymbol{W<em k-1="k-1">k\in\mathbb{R}^{d\times d}$ï¼Œæ‰€ä»¥$\boldsymbol{Y}</em>} \Delta\boldsymbol{W<em k-1="k-1">k$å°±æ˜¯$b\times d$ä¸ª$d$ç»´å‘é‡å¯¹çš„å†…ç§¯ã€‚æ³¨æ„è¿™é‡Œ$\Delta\boldsymbol{W}_k$æ˜¯ç²¾å¿ƒè®¾è®¡çš„æ›´æ–°é‡ï¼Œå®ƒä¸å¤§å¯èƒ½è·Ÿåˆå§‹åŒ–é‚£æ ·è·Ÿ$\boldsymbol{Y}</em>_k))$ã€‚}$æ˜¯ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥â€œ$d$ç»´å‘é‡å¯¹çš„å†…ç§¯â€æ›´æœ‰å¯èƒ½æ˜¯$\mathcal{\Theta}(d)$ï¼ˆ$d$ç»´å†…ç§¯å…±æœ‰$d$é¡¹æ±‚å’Œï¼‰ï¼Œå› æ­¤å¦‚æœ$\Delta\boldsymbol{Y}_{k-1}$çš„RMSæ˜¯$\mathcal{\Theta}(1)$ï¼Œé‚£ä¹ˆå¯ä»¥è®¤ä¸º$\Delta\boldsymbol{Y}_k$çš„RMSå°†æ˜¯$\mathcal{\Theta}(d\times \text{RMS}(\Delta \boldsymbol{W</p>
<p>äºæ˜¯ï¼Œä¸ºäº†è®©$\Delta\boldsymbol{Y}_k$çš„RMSæ˜¯$\mathcal{\Theta}(1)$ï¼Œæˆ‘ä»¬å¾—åˆ°äº†å¯¹$\Delta \boldsymbol{W}_k$çš„ä¸€ä¸ªé¢å¤–è¦æ±‚ï¼š<br />
\begin{equation}\text{RMS}(\Delta \boldsymbol{W}_k) = \mathcal{\Theta}(1 / d)\label{eq:dw-rms}\end{equation}</p>
<p>ç»“åˆ$\Delta \boldsymbol{W}<em out="out">k = -\eta\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}_k}$å’Œ$\Delta\mathcal{L}=\mathcal{\Theta}(1)$ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°â€œ$\boldsymbol{W}</em>$çš„åˆå§‹åŒ–æ–¹å·®è®¾ä¸º$\propto 1/d^2$â€çš„ç»“æœã€‚</p>
<p>ï¼ˆæ³¨ï¼šè¿™ä¸€èŠ‚ä¾èµ–äº <a href="/archives/10770/comment-page-1#comment-27212">@Chenyu Zheng</a> çš„æŒ‡ç‚¹ï¼Œéå¸¸æ„Ÿè°¢ï¼ï¼‰</p>
<h2 id="adam">Adamç‰ˆæœ¬</h2>
<p>ä»¥ä¸Šå°±æ˜¯SGDçš„MuPï¼Œå¯¹äºAdamï¼Œæˆ‘ä»¬é€šå¸¸ç”¨SignSGDè¿‘ä¼¼åšæ•°é‡çº§åˆ†æï¼š</p>
<blockquote>
<p>1ã€$\Delta \boldsymbol{W} = -\eta \mathop{\text{sign}}\left(\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}}\right)$ï¼›</p>
<p>2ã€$\Delta \mathcal{L} \approx -\eta \left|\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}}\right|_1$ï¼›</p>
<p>3ã€è¿™é‡Œçš„$|\cdot|_1$æŒ‡æ¯ä¸ªå…ƒç´ å–ç»å¯¹å€¼ç„¶åæ±‚å’Œã€‚</p>
</blockquote>
<p>å…³äºSignSGDè¿‘ä¼¼æœ¬èº«ï¼Œè¯»è€…è¿˜å¯ä»¥å‚è€ƒ<a href="/archives/10542">ã€Šå½“Batch Sizeå¢å¤§æ—¶ï¼Œå­¦ä¹ ç‡è¯¥å¦‚ä½•éšä¹‹å˜åŒ–ï¼Ÿã€‹</a>ã€<a href="/archives/10563">ã€ŠAdamçš„epsilonå¦‚ä½•å½±å“å­¦ä¹ ç‡çš„Scaling Lawï¼Ÿã€‹</a>ç­‰æ–‡ç« ï¼Œè¿™é‡Œä¹Ÿä¸å±•å¼€è®¨è®ºäº†ã€‚æ€»è€Œè¨€ä¹‹ï¼ŒSignSGDæ˜¯åˆ†æAdamç›¸å…³ç¼©æ”¾è§„å¾‹æ—¶ä¸€ä¸ªå¸¸ç”¨çš„è¿‘ä¼¼æ–¹å¼ã€‚</p>
<p>ç°åœ¨å¯ä»¥æ¨¡ä»¿SGDçš„è¿‡ç¨‹è¿›è¡Œåˆ†æï¼š</p>
<blockquote>
<p>1ã€$\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}<em out="out">{out}}$çš„RMSæ˜¯$\mathcal{\Theta}(1)$ï¼Œ$\left|\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}</em>\right|}<em out="out">1$æ˜¯$d\times d</em>\propto 1/d$æ¥æŠµæ¶ˆå°ºåº¦å½±å“ï¼›}$ä¸ªæ•°æ±‚å’Œï¼Œå¤§å°æ˜¯$\mathcal{\Theta}(d\times d_{out}) = \mathcal{\Theta}(d)$ï¼Œæ‰€ä»¥å®ƒçš„å­¦ä¹ ç‡è¦æ»¡è¶³$\eta_{out</p>
<p>2ã€$\left|\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}<em out="out">k}\right|_1$æ˜¯$d^2$ä¸ªæ•°æ±‚å’Œï¼Œ$\frac{\partial \boldsymbol{Y}</em>}}{\partial \boldsymbol{W<em out="out">k}$å’Œ$\frac{\partial\mathcal{L}}{\partial \boldsymbol{Z}}$çš„RMSéƒ½æ˜¯$\mathcal{\Theta}(1)$ï¼Œæˆ‘ä»¬å°†$\boldsymbol{W}</em>(d)$ï¼Œæ‰€ä»¥å­¦ä¹ ç‡æŒ‰ç…§$\eta_k\propto 1/d$å˜æ¢æ¥æŠµæ¶ˆå°ºåº¦å½±å“ï¼›}$çš„åˆå§‹æ–¹å·®è®¾ä¸º$\propto 1/d^2$ï¼Œé‚£ä¹ˆ$\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}_k}$çš„RMSå°±æ˜¯$\mathcal{\Theta}(1/d)$ï¼Œ$d^2$ä¸ªæ•°æ±‚å’Œåæ˜¯$\mathcal{\Theta</p>
<p>3ã€æ­¤æ—¶$\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}<em in="in">{in}}$çš„RMSä¹Ÿæ˜¯$\mathcal{\Theta}(1/d)$ï¼Œä½†$\left|\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}</em>\right|}<em in="in">1$åªæ˜¯$d</em>(1)$ï¼Œä»è€Œå­¦ä¹ ç‡ä¸ç”¨éšå°ºåº¦æ”¹å˜ã€‚}\times d$ä¸ªæ•°æ±‚å’Œï¼Œæ‰€ä»¥å®ƒå·²ç»æ˜¯$\mathcal{\Theta</p>
</blockquote>
<p>ï¼ˆæ³¨ï¼šè¯»è€…å¯ä»¥è‡ªè¡Œæ£€æŸ¥ä¸€ä¸‹å¼$\eqref{eq:dw-rms}$æ˜¯æ»¡è¶³çš„ã€‚ï¼‰</p>
<h2 id="muon">Muonç‰ˆæœ¬</h2>
<p>æ¥ä¸‹æ¥è‡ªç„¶å°‘ä¸äº†Muonçš„åˆ†æã€‚å¯¹äºMuonæœ¬èº«ï¼Œæˆ‘ä»¬å·²ç»åœ¨<a href="/archives/10592">ã€ŠMuonä¼˜åŒ–å™¨èµæï¼šä»å‘é‡åˆ°çŸ©é˜µçš„æœ¬è´¨è·¨è¶Šã€‹</a>ã€<a href="/archives/10739">ã€ŠMuonç»­é›†ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬é€‰æ‹©å°è¯•Muonï¼Ÿã€‹</a>åšäº†è¯¦ç»†ä»‹ç»ï¼Œè¿™é‡Œä¸å†é‡å¤ã€‚è·ŸAdamç”¨SignSGDç±»ä¼¼ï¼Œæˆ‘ä»¬ç”¨MSignSGDæ¥è¿‘ä¼¼Muonï¼š</p>
<blockquote>
<p>1ã€$\Delta \boldsymbol{W} = -\eta \mathop{\text{msign}}\left(\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}}\right)$ï¼›</p>
<p>2ã€$\Delta \mathcal{L} \approx -\eta \left\Vert\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}}\right\Vert_*$ï¼ˆè¯æ˜è§<a href="/archives/10592">ã€ŠMuonä¼˜åŒ–å™¨èµæï¼šä»å‘é‡åˆ°çŸ©é˜µçš„æœ¬è´¨è·¨è¶Šã€‹</a>ï¼‰ï¼›</p>
<p>3ã€è¿™é‡Œçš„$\Vert\cdot\Vert_*$æŒ‡<a href="https://en.wikipedia.org/wiki/Nuclear_norm">NuclearèŒƒæ•°</a>ï¼Œæ˜¯çŸ©é˜µçš„ <em>æ‰€æœ‰å¥‡å¼‚å€¼ä¹‹å’Œ</em> ï¼›</p>
<p>4ã€NuclearèŒƒæ•°å¹¶ä¸å¥½ç®—ï¼Œä½†$F$èŒƒæ•°å¥½ç®—ï¼Œå®ƒç­‰äºçŸ©é˜µçš„ <em>æ‰€æœ‰å¥‡å¼‚å€¼çš„å¹³æ–¹å’Œçš„å¹³æ–¹æ ¹</em> ï¼›</p>
<p>5ã€æˆ‘ä»¬ç”¨$F$èŒƒæ•°ä½œä¸ºNuclearèŒƒæ•°è¿‘ä¼¼ï¼Œå› æ­¤$\Delta \mathcal{L} \approx -\eta \left\Vert\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}}\right\Vert_*\approx -\eta \left\Vert\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}}\right\Vert_F$ï¼›</p>
<p>6ã€$F$èŒƒæ•°åˆç­‰äºçŸ©é˜µçš„ <em>æ‰€æœ‰å…ƒç´ çš„å¹³æ–¹å’Œçš„å¹³æ–¹æ ¹</em> ã€‚</p>
</blockquote>
<p>é‚£ä¹ˆå¯ä»¥å¼€å§‹åˆ†æè¿‡ç¨‹ï¼š</p>
<blockquote>
<p>1ã€$\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}<em out="out">{out}}$çš„RMSæ˜¯$\mathcal{\Theta}(1)$ï¼Œæ‰€ä»¥$\left\Vert\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}</em>$ï¼›}}\right\Vert_*$å¤§å°æ˜¯$\mathcal{\Theta}(\sqrt{d\times d_{out}}) = \mathcal{\Theta}(\sqrt{d})$ï¼Œè¦æ¶ˆé™¤å°ºåº¦çš„å½±å“ï¼Œé‚£ä¹ˆå®ƒçš„å­¦ä¹ ç‡è¦æ»¡è¶³$\eta_{out}\propto 1/\sqrt{d</p>
<p>2ã€$\left\Vert\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}<em out="out">k}\right\Vert_F$æ˜¯$d^2$ä¸ªæ•°çš„å¹³æ–¹å’Œçš„å¹³æ–¹æ ¹ï¼Œ$\frac{\partial \boldsymbol{Y}</em>}}{\partial \boldsymbol{W<em out="out">k}$å’Œ$\frac{\partial\mathcal{L}}{\partial \boldsymbol{Z}}$çš„RMSéƒ½æ˜¯$\mathcal{\Theta}(1)$ï¼Œæˆ‘ä»¬å°†$\boldsymbol{W}</em>(1)$ï¼Œæ‰€ä»¥å­¦ä¹ ç‡ä¸ç”¨å˜ï¼›}$çš„åˆå§‹æ–¹å·®è®¾ä¸º$\propto 1/d^2$ï¼Œé‚£ä¹ˆ$\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}_k}$çš„RMSå°±æ˜¯$\mathcal{\Theta}(1/d)$ï¼Œå¹³æ–¹å’Œåå†å¹³æ–¹æ ¹ï¼Œç»“æœæ˜¯$\mathcal{\Theta</p>
<p>3ã€æ­¤æ—¶$\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}<em in="in">{in}}$çš„RMSä¹Ÿæ˜¯$\mathcal{\Theta}(1/d)$ï¼Œä½†$\left\Vert\frac{\partial\mathcal{L}}{\partial \boldsymbol{W}</em>$ã€‚}}\right\Vert_F$åªæ˜¯$d_{in}\times d$ä¸ªæ•°çš„å¹³æ–¹å’Œå¹³æ–¹æ ¹ï¼Œæ‰€ä»¥å®ƒæ˜¯$\mathcal{\Theta}(1/\sqrt{d})$çš„ï¼Œå­¦ä¹ ç‡åè€Œéœ€è¦æ”¾å¤§$\sqrt{d}$å€æ¥æŠµæ¶ˆè¿™ä¸ªå½±å“ï¼Œå³$\eta_{in}\propto \sqrt{d</p>
</blockquote>
<p>ï¼ˆæ³¨ï¼šè¿™é‡ŒMuonçš„ç»“è®ºæ˜¯å¯¹çš„ï¼Œä½†å®ƒä¸æ»¡è¶³æ¡ä»¶$\eqref{eq:dw-rms}$ï¼Œå› ä¸ºå¼$\eqref{eq:dw-rms}$è¦ç»†è¯´çš„è¯è¿˜ä¾èµ–äºä¸€ä¸ªæ›´æ–°é‡æ˜¯Element-wiseçš„å‡è®¾ï¼Œè€ŒMuonä¸ç¬¦åˆè¿™ä¸ªå‡è®¾ï¼Œæ‰€ä»¥å®é™…ä¸Šä¸å¯ç”¨ã€‚è¿™é‡Œæ²¡æœ‰ä»”ç»†å±•å¼€ç›¸å…³è®¨è®ºï¼Œè€Œæ˜¯ç›´æ¥æ²¿ç”¨äº†â€œ$\boldsymbol{W}_{out}$çš„åˆå§‹åŒ–æ–¹å·®è®¾ä¸º$\propto 1/d^2$â€çš„ç»“è®ºï¼Œå›é¿äº†å¼$\eqref{eq:dw-rms}$ã€‚ï¼‰</p>
<h2 id="_8">ç»“è®ºæ±‡æ€»</h2>
<p>å°†ä¸Šè¿°ç»“è®ºæ±‡æ€»åœ¨ä¸€èµ·æ˜¯ï¼š<br />
\begin{array}{c|c|c|c|c|c|c}<br />
\hline<br />
&amp; \boldsymbol{W}<em in="in">{in}\text{æ–¹å·®} &amp; \boldsymbol{W}</em>}\text{å­¦ä¹ ç‡} &amp; \boldsymbol{W<em out="out">k\text{æ–¹å·®} &amp; \boldsymbol{W}_k\text{å­¦ä¹ ç‡} &amp; \boldsymbol{W}</em>}\text{æ–¹å·®} &amp; \boldsymbol{W<em in="in">{out}\text{å­¦ä¹ ç‡} \\\<br />
\hline<br />
\text{SGD} &amp; 1/d</em> &amp; d &amp; 1 / d &amp; 1 &amp; 1/d^2 &amp; 1 / d\\\<br />
\text{Adam} &amp; 1/d_{in} &amp; 1 &amp; 1 / d &amp; 1 / d &amp; 1/d^2 &amp; 1 / d\\\<br />
\text{Muon} &amp; 1/d_{in} &amp; \sqrt{d} &amp; 1 / d &amp; 1 &amp; 1/d^2 &amp; 1 / \sqrt{d} \\\<br />
\hline<br />
\end{array}</p>
<p>è¿™é‡Œçš„$\boldsymbol{W}<em in="in">k$æŒ‡çš„æ˜¯é™¤$\boldsymbol{W}</em>},\boldsymbol{W<em in="in">{out}$å¤–çš„æ‰€æœ‰å‚æ•°ï¼Œè¿˜æœ‰è¦å¼ºè°ƒçš„æ˜¯ï¼Œè¿™é‡Œçš„å…³ç³»éƒ½æ˜¯â€œæ­£æ¯”äºâ€è€Œä¸æ˜¯â€œç­‰äºâ€ã€‚å¦å¤–å®è·µä¸­å¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚ç¨ä½œå˜åŒ–ï¼Œæ¯”å¦‚å®é™…æˆ‘ä»¬ç”¨Muonæ—¶ï¼Œ$\boldsymbol{W}</em>$çš„ä¼˜åŒ–é€šå¸¸ä¸ç”¨Muonè€Œæ˜¯ç”¨Adamï¼Œè¿™å°†å¯¼è‡´ä¸¤ä¸ªå˜åŒ–ï¼š}$å’Œ$\boldsymbol{W}_{out</p>
<blockquote>
<p>1ã€$\eta_{out}\propto 1/d$ï¼›</p>
<p>2ã€$\eta_{in}$ä¸å˜ã€‚</p>
</blockquote>
<p>å¦‚æœç»“åˆæˆ‘ä»¬åœ¨<a href="https://papers.cool/arxiv/2502.16982">ã€ŠMuon is Scalable for LLM Trainingã€‹</a>æ‰€æçš„Adujst LRçš„è¯ï¼Œé‚£ä¹ˆå­¦ä¹ ç‡è¦å¤šä¹˜ä¸€ä¸ª$\sqrt{\max(n, m)}$ï¼Œ$n\times m$æ˜¯å‚æ•°çŸ©é˜µçš„å½¢çŠ¶ï¼Œæˆ‘ä»¬å·²ç»å‡è®¾äº†$\text{NN}$éƒ¨åˆ†çš„å‚æ•°æ€»ç­‰æ¯”ä¾‹ç¼©æ”¾ï¼Œæ‰€ä»¥$\sqrt{\max(n, m)}\propto \sqrt{d}$ã€‚å› æ­¤ï¼Œå¦‚æœè¦æŠµæ¶ˆAdujst LRå¸¦æ¥çš„å°ºåº¦å½±å“ï¼Œé‚£ä¹ˆå°±éœ€è¦</p>
<blockquote>
<p>3ã€$\eta_k\propto 1/\sqrt{d}$ ã€‚</p>
</blockquote>
<h2 id="_9">æ–‡ç« å°ç»“</h2>
<p>æœ¬æ–‡ä»¥å°½å¯èƒ½ç®€æ˜æ¸…æ™°çš„æ–¹å¼ä»‹ç»äº†MuPï¼ˆMaximal Update Parametrizationï¼‰ï¼Œè¿™æ˜¯æ—¨åœ¨ç ”ç©¶è¶…å‚æ•°è·¨æ¨¡å‹å°ºåº¦çš„è¿ç§»è§„å¾‹çš„å·¥ä½œã€‚åŸºäºMuPï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å°æ¨¡å‹ä¸Šä»¥ç›¸å¯¹è¾ƒå°çš„æˆæœ¬ä»”ç»†æœç´¢è¶…å‚æ•°ï¼ˆè¿™é‡Œä¸»è¦æ˜¯å­¦ä¹ ç‡å’Œåˆå§‹åŒ–ï¼‰ï¼Œç„¶åè¿ç§»åˆ°å¤§æ¨¡å‹ä¸Šï¼Œé™ä½å¤§æ¨¡å‹çš„ç‚¼ä¸¹æˆæœ¬ã€‚</p>
<p>å®¢è§‚æ¥è®²ï¼Œè¿™é‡Œçš„ä»‹ç»å’Œåˆ†æè¿˜æ¯”è¾ƒåˆæ­¥ï¼Œæ¯”å¦‚æ²¡æœ‰è€ƒè™‘Biasé¡¹ã€æ²¡æœ‰è¯„ä¼°ç»“è®ºåœ¨MLPä»¥å¤–æ¶æ„çš„é€šç”¨æ€§ã€ä¹Ÿæ²¡æœ‰ä»”ç»†è€ƒè™‘Normalizationå’Œæ®‹å·®çš„ä½œç”¨ç­‰ã€‚æ²¡æœ‰è€ƒè™‘Biasé¡¹è¿™ä¸ªå•çº¯æ˜¯å·æ‡’ï¼Œæƒå½“ç•™ç»™è¯»è€…çš„ä¹ é¢˜äº†ï¼›è‡³äºä¸åŒæ¶æ„ä¸‹çš„MuPï¼Œä¸€èˆ¬åˆ†æèµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œä½†ç”±äºç¥ç»ç½‘ç»œçš„ç›¸ä¼¼æ€§ï¼Œç»“è®ºå¤§è‡´ä¸Šæ˜¯ç›¸åŒçš„ï¼Œæˆ‘ä»¬å¯ä»¥ä¸åŠ è¯æ˜åœ°ç”¨ç€ã€‚ä¸ªäººè®¤ä¸ºæ¯”è¾ƒå…³é”®çš„æ”¹è¿›ç‚¹æ˜¯Normalizationå’Œæ®‹å·®çš„å½±å“ï¼Œå°¤å…¶æ˜¯Normalizationï¼Œå®ƒä½¿å¾—ä¸ä¾èµ–ç‰¹æ®Šçš„åˆå§‹åŒ–å°±å¯ä»¥ç¨³å®šå‰å‘ä¼ æ’­ï¼Œå¸¦æ¥äº†æ›´å¤§çš„è‡ªç”±åº¦å’Œå¯èƒ½æ€§ã€‚</p>
<p>å½“ç„¶ï¼Œè¿™äº›éƒ½ç•™ç»™åç»­åˆ†æäº†ã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/10770">https://spaces.ac.cn/archives/10770</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Mar. 13, 2025). ã€Šåˆæ¢MuPï¼šè¶…å‚æ•°çš„è·¨æ¨¡å‹å°ºåº¦è¿ç§»è§„å¾‹ ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/10770">https://spaces.ac.cn/archives/10770</a></p>
<p>@online{kexuefm-10770,<br />
title={åˆæ¢MuPï¼šè¶…å‚æ•°çš„è·¨æ¨¡å‹å°ºåº¦è¿ç§»è§„å¾‹},<br />
author={è‹å‰‘æ—},<br />
year={2025},<br />
month={Mar},<br />
url={\url{https://spaces.ac.cn/archives/10770}},<br />
} </p>
<hr />
<h2 id="_10">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<p>æœ¬èŠ‚æä¾›MuPç†è®ºçš„è¯¦ç»†æ•°å­¦æ¨å¯¼ï¼Œä»å¤šä¸ªè§’åº¦æ·±å…¥ç†è§£è¶…å‚æ•°è·¨æ¨¡å‹å°ºåº¦è¿ç§»çš„æ•°å­¦åŸºç¡€ã€‚</p>
<h3 id="1">1. ç¥ç»ç½‘ç»œå‚æ•°åŒ–çš„æ•°å­¦åŸºç¡€</h3>
<h4 id="11">1.1 å‚æ•°åŒ–çš„å®šä¹‰</h4>
<p>å¯¹äºä¸€ä¸ªç¥ç»ç½‘ç»œï¼Œæˆ‘ä»¬å®šä¹‰å…¶<strong>å‚æ•°åŒ–ï¼ˆParameterizationï¼‰</strong>ä¸ºå‚æ•°åˆå§‹åŒ–æ–¹æ¡ˆå’Œå­¦ä¹ ç‡ç¼©æ”¾æ–¹æ¡ˆçš„ç»„åˆã€‚å½¢å¼åŒ–åœ°ï¼Œç»™å®šå®½åº¦$d$ï¼Œå‚æ•°åŒ–$\mathcal{P}$åŒ…å«ï¼š</p>
<p>$$
\mathcal{P} = \left\{ \sigma_{\text{init}}(d), \eta(d) \right\}
$$</p>
<p>å…¶ä¸­$\sigma_{\text{init}}(d)$æ˜¯åˆå§‹åŒ–æ ‡å‡†å·®å…³äºå®½åº¦çš„å‡½æ•°ï¼Œ$\eta(d)$æ˜¯å­¦ä¹ ç‡å…³äºå®½åº¦çš„å‡½æ•°ã€‚</p>
<h4 id="12-standard-parameterization-sp">1.2 æ ‡å‡†å‚æ•°åŒ–ï¼ˆStandard Parameterization, SPï¼‰</h4>
<p>åœ¨æ ‡å‡†å‚æ•°åŒ–ä¸‹ï¼Œå¯¹äºæƒé‡çŸ©é˜µ$\boldsymbol{W} \in \mathbb{R}^{n \times m}$ï¼š</p>
<p>$$
W_{ij} \sim \mathcal{N}\left(0, \frac{1}{n}\right), \quad \eta = \eta_0
$$</p>
<p>è¿™é‡Œ$\eta_0$æ˜¯ä¸å®½åº¦æ— å…³çš„å¸¸æ•°ã€‚è¿™ç§å‚æ•°åŒ–çš„é—®é¢˜åœ¨äºï¼š</p>
<p><strong>å‘½é¢˜1.1</strong>ï¼ˆSPçš„å°ºåº¦ä¾èµ–æ€§ï¼‰ï¼šåœ¨æ ‡å‡†å‚æ•°åŒ–ä¸‹ï¼Œå¯¹äº$d \times d$çš„æƒé‡çŸ©é˜µ$\boldsymbol{W}$ï¼Œå‰å‘ä¼ æ’­çš„è¾“å‡ºå°ºåº¦ä¸ºï¼š</p>
<p>$$
\mathbb{E}\left[\|\boldsymbol{Y}\|_F^2\right] = \mathbb{E}\left[\|\boldsymbol{X}\boldsymbol{W}\|_F^2\right] = b \cdot d \cdot \mathbb{E}\left[\|\boldsymbol{X}\|_F^2\right] / d = b \cdot \mathbb{E}\left[\|\boldsymbol{X}\|_F^2\right]
$$</p>
<p>ä½†æ¢¯åº¦çš„å°ºåº¦ä¸ºï¼š</p>
<p>$$
\mathbb{E}\left[\left\|\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}}\right\|_F^2\right] = \mathcal{O}(1)
$$</p>
<p>å¯¼è‡´å‚æ•°æ›´æ–°é‡ï¼š</p>
<p>$$
\mathbb{E}\left[\|\Delta \boldsymbol{W}\|_F^2\right] = \eta^2 \mathbb{E}\left[\left\|\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}}\right\|_F^2\right] = \mathcal{O}(\eta^2)
$$</p>
<p>è€ŒæŸå¤±å˜åŒ–ï¼š</p>
<p>$$
\Delta \mathcal{L} = -\eta \left\|\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}}\right\|_F^2 = \mathcal{O}(d)
$$</p>
<p><strong>è¯æ˜</strong>ï¼šå…³é”®åœ¨äº$\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}} = \boldsymbol{X}^{\top} \frac{\partial \mathcal{L}}{\partial \boldsymbol{Y}}$ï¼Œå…¶ä¸­$\boldsymbol{X}^{\top}$æ˜¯$d \times b$çŸ©é˜µï¼Œ$\frac{\partial \mathcal{L}}{\partial \boldsymbol{Y}}$æ˜¯$b \times d$çŸ©é˜µï¼Œç›¸ä¹˜å¾—åˆ°$d \times d$çŸ©é˜µï¼Œå…±$d^2$ä¸ªå…ƒç´ ã€‚å¦‚æœæ¯ä¸ªå…ƒç´ çš„æœŸæœ›å¹³æ–¹ä¸º$\mathcal{O}(1/d)$ï¼ˆæ¥è‡ª$b$é¡¹çš„æ±‚å’Œå¹³å‡ï¼‰ï¼Œé‚£ä¹ˆæ€»çš„FrobeniusèŒƒæ•°å¹³æ–¹ä¸º$\mathcal{O}(d)$ã€‚$\square$</p>
<h3 id="2-p">2. Î¼Pçš„æ ¸å¿ƒæ€æƒ³ï¼šæ— é™å®½åº¦æé™</h3>
<h4 id="21-ntk-vs">2.1 ç¥ç»æ­£åˆ‡æ ¸ï¼ˆNTKï¼‰æ”¿æƒ vs ç‰¹å¾å­¦ä¹ æ”¿æƒ</h4>
<p>è€ƒè™‘æ— é™å®½åº¦æé™$d \to \infty$æ—¶ç¥ç»ç½‘ç»œçš„è¡Œä¸ºã€‚å®šä¹‰å‚æ•°åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­çš„å˜åŒ–ï¼š</p>
<p>$$
\boldsymbol{W}(t) = \boldsymbol{W}(0) + \Delta\boldsymbol{W}(t)
$$</p>
<p>åœ¨NTKæ”¿æƒä¸‹ï¼ˆå¯¹åº”SPï¼‰ï¼š</p>
<p>$$
\frac{\|\Delta\boldsymbol{W}(t)\|}{\|\boldsymbol{W}(0)\|} \to 0 \quad \text{as } d \to \infty
$$</p>
<p>è¿™æ„å‘³ç€å‚æ•°å‡ ä¹ä¸å˜ï¼Œç½‘ç»œè¡Œä¸ºç±»ä¼¼äº<strong>æ‡’æƒ°å­¦ä¹ ï¼ˆLazy Trainingï¼‰</strong>ã€‚</p>
<p>åœ¨ç‰¹å¾å­¦ä¹ æ”¿æƒä¸‹ï¼ˆå¯¹åº”Î¼Pï¼‰ï¼š</p>
<p>$$
\frac{\|\Delta\boldsymbol{W}(t)\|}{\|\boldsymbol{W}(0)\|} = \mathcal{O}(1) \quad \text{as } d \to \infty
$$</p>
<p>å‚æ•°å‘ç”Ÿæœ‰æ„ä¹‰çš„å˜åŒ–ï¼Œç½‘ç»œèƒ½å¤Ÿå­¦ä¹ <strong>ç‰¹å¾è¡¨ç¤º</strong>ã€‚</p>
<h4 id="22">2.2 æ— é™å®½åº¦æé™çš„ä¸¥æ ¼å®šä¹‰</h4>
<p>å®šä¹‰ç½‘ç»œè¾“å‡º$f(\boldsymbol{x}; \boldsymbol{W}, d)$å…³äºè¾“å…¥$\boldsymbol{x}$å’Œå‚æ•°$\boldsymbol{W}$åœ¨å®½åº¦$d$ä¸‹çš„æ˜ å°„ã€‚</p>
<p><strong>å®šä¹‰2.1</strong>ï¼ˆæé™å­˜åœ¨æ€§ï¼‰ï¼šå¦‚æœå­˜åœ¨éšæœºè¿‡ç¨‹$f_\infty(\boldsymbol{x})$ä½¿å¾—å¯¹äºä»»æ„å›ºå®šè¾“å…¥$\boldsymbol{x}$ï¼š</p>
<p>$$
f(\boldsymbol{x}; \boldsymbol{W}(0), d) \xrightarrow{d \to \infty} f_\infty(\boldsymbol{x}) \quad \text{in distribution}
$$</p>
<p>ä¸”è®­ç»ƒåŠ¨æ€ï¼š</p>
<p>$$
f(\boldsymbol{x}; \boldsymbol{W}(t), d) \xrightarrow{d \to \infty} f_\infty(\boldsymbol{x}; t) \quad \text{in distribution}
$$</p>
<p>åˆ™ç§°è¯¥å‚æ•°åŒ–åœ¨æ— é™å®½åº¦ä¸‹æ˜¯<strong>è‰¯å®šä¹‰çš„</strong>ã€‚</p>
<h4 id="23-p">2.3 Î¼Pçš„æ•°å­¦åˆ»ç”»</h4>
<p>Î¼Pçš„æ ¸å¿ƒæ˜¯é€‰æ‹©æ°å½“çš„åˆå§‹åŒ–å’Œå­¦ä¹ ç‡ç¼©æ”¾ï¼Œä½¿å¾—ï¼š</p>
<ol>
<li><strong>å‰å‘ä¼ æ’­ç¨³å®š</strong>ï¼š$\mathbb{E}[|\boldsymbol{Y}_\ell|^2] = \Theta(1)$ å¯¹æ‰€æœ‰å±‚$\ell$</li>
<li><strong>åå‘ä¼ æ’­ç¨³å®š</strong>ï¼š$\mathbb{E}\left[\left|\frac{\partial \mathcal{L}}{\partial \boldsymbol{Y}_\ell}\right|^2\right] = \Theta(1)$ å¯¹æ‰€æœ‰å±‚$\ell$</li>
<li><strong>æ›´æ–°é‡ç¨³å®š</strong>ï¼š$\mathbb{E}[|\Delta \boldsymbol{W}<em>\ell|^2] = \Theta(|\boldsymbol{W}</em>\ell(0)|^2)$ å¯¹æ‰€æœ‰å±‚$\ell$</li>
<li><strong>æŸå¤±å˜åŒ–ç¨³å®š</strong>ï¼š$\mathbb{E}[|\Delta \mathcal{L}|] = \Theta(1)$</li>
</ol>
<h3 id="3">3. è¯¦ç»†çš„å°ºåº¦å®šå¾‹æ¨å¯¼</h3>
<h4 id="31">3.1 å•å±‚çº¿æ€§å˜æ¢çš„å°ºåº¦åˆ†æ</h4>
<p>è€ƒè™‘çº¿æ€§å±‚$\boldsymbol{Y} = \boldsymbol{X}\boldsymbol{W}$ï¼Œå…¶ä¸­$\boldsymbol{X} \in \mathbb{R}^{b \times d_{\text{in}}}$ï¼Œ$\boldsymbol{W} \in \mathbb{R}^{d_{\text{in}} \times d_{\text{out}}}$ã€‚</p>
<p><strong>å¼•ç†3.1</strong>ï¼ˆå‰å‘ä¼ æ’­çš„æ–¹å·®ï¼‰ï¼šå‡è®¾$X_{ij}$ç‹¬ç«‹åŒåˆ†å¸ƒï¼Œ$\mathbb{E}[X_{ij}] = 0$ï¼Œ$\text{Var}(X_{ij}) = \sigma_X^2$ï¼Œ$W_{kl}$ç‹¬ç«‹åŒåˆ†å¸ƒï¼Œ$\mathbb{E}[W_{kl}] = 0$ï¼Œ$\text{Var}(W_{kl}) = \sigma_W^2$ï¼Œä¸”$\boldsymbol{X}$ä¸$\boldsymbol{W}$ç‹¬ç«‹ã€‚åˆ™ï¼š</p>
<p>$$
\mathbb{E}[Y_{ij}^2] = \mathbb{E}\left[\left(\sum_{k=1}^{d_{\text{in}}} X_{ik} W_{kj}\right)^2\right] = d_{\text{in}} \cdot \sigma_X^2 \cdot \sigma_W^2
$$</p>
<p><strong>è¯æ˜</strong>ï¼š
$$
\begin{align}
\mathbb{E}[Y_{ij}^2] &= \mathbb{E}\left[\left(\sum_{k=1}^{d_{\text{in}}} X_{ik} W_{kj}\right)^2\right] \\
&= \mathbb{E}\left[\sum_{k=1}^{d_{\text{in}}} \sum_{l=1}^{d_{\text{in}}} X_{ik} W_{kj} X_{il} W_{lj}\right] \\
&= \sum_{k=1}^{d_{\text{in}}} \sum_{l=1}^{d_{\text{in}}} \mathbb{E}[X_{ik} X_{il}] \mathbb{E}[W_{kj} W_{lj}] \\
&= \sum_{k=1}^{d_{\text{in}}} \mathbb{E}[X_{ik}^2] \mathbb{E}[W_{kj}^2] \quad (\text{å› ä¸º } k \neq l \text{ æ—¶äº¤å‰é¡¹ä¸º0}) \\
&= d_{\text{in}} \cdot \sigma_X^2 \cdot \sigma_W^2 \quad \square
\end{align}
$$</p>
<p><strong>æ¨è®º3.1</strong>ï¼ˆfan-inåˆå§‹åŒ–ï¼‰ï¼šä¸ºäº†ä¿æŒ$\text{Var}(Y_{ij}) = \text{Var}(X_{ik})$ï¼Œåº”è®¾ç½®ï¼š</p>
<p>$$
\sigma_W^2 = \frac{1}{d_{\text{in}}}
$$</p>
<h4 id="32">3.2 åå‘ä¼ æ’­çš„å°ºåº¦åˆ†æ</h4>
<p>å¯¹äºæ¢¯åº¦ä¼ æ’­$\frac{\partial \mathcal{L}}{\partial \boldsymbol{X}} = \frac{\partial \mathcal{L}}{\partial \boldsymbol{Y}} \boldsymbol{W}^{\top}$ï¼š</p>
<p><strong>å¼•ç†3.2</strong>ï¼ˆåå‘ä¼ æ’­çš„æ–¹å·®ï¼‰ï¼šåœ¨ä¸å¼•ç†3.1ç›¸åŒçš„å‡è®¾ä¸‹ï¼Œè®°$G_{ij} = \frac{\partial \mathcal{L}}{\partial Y_{ij}}$ï¼Œå‡è®¾$\mathbb{E}[G_{ij}] = 0$ï¼Œ$\text{Var}(G_{ij}) = \sigma_G^2$ï¼Œåˆ™ï¼š</p>
<p>$$
\mathbb{E}\left[\left(\frac{\partial \mathcal{L}}{\partial X_{ik}}\right)^2\right] = \mathbb{E}\left[\left(\sum_{j=1}^{d_{\text{out}}} G_{ij} W_{kj}\right)^2\right] = d_{\text{out}} \cdot \sigma_G^2 \cdot \sigma_W^2
$$</p>
<p><strong>æ¨è®º3.2</strong>ï¼ˆfan-outåˆå§‹åŒ–ï¼‰ï¼šä¸ºäº†ä¿æŒåå‘ä¼ æ’­çš„æ–¹å·®ç¨³å®šï¼Œåº”è®¾ç½®ï¼š</p>
<p>$$
\sigma_W^2 = \frac{1}{d_{\text{out}}}
$$</p>
<p><strong>çŸ›ç›¾ä¸æŠ˜ä¸­</strong>ï¼šå½“$d_{\text{in}} \neq d_{\text{out}}$æ—¶ï¼Œæ¨è®º3.1å’Œ3.2å‘ç”Ÿå†²çªã€‚Xavieråˆå§‹åŒ–é‡‡ç”¨è°ƒå’Œå¹³å‡ï¼š</p>
<p>$$
\sigma_W^2 = \frac{2}{d_{\text{in}} + d_{\text{out}}}
$$</p>
<h4 id="33">3.3 æ¿€æ´»å‡½æ•°çš„å½±å“</h4>
<p>å¯¹äºéçº¿æ€§å±‚$\boldsymbol{Y} = \phi(\boldsymbol{X}\boldsymbol{W})$ï¼Œå…¶ä¸­$\phi$æ˜¯element-wiseæ¿€æ´»å‡½æ•°ã€‚</p>
<p><strong>å¼•ç†3.3</strong>ï¼ˆæ¿€æ´»å‡½æ•°çš„æ–¹å·®å˜æ¢ï¼‰ï¼šå¯¹äº$Z \sim \mathcal{N}(0, \sigma^2)$ï¼Œå®šä¹‰$\chi_\phi = \mathbb{E}[\phi(Z)^2] / \sigma^2$ä¸ºæ¿€æ´»å‡½æ•°çš„<strong>æ–¹å·®ä¿æŒå› å­</strong>ã€‚å¸¸è§æ¿€æ´»å‡½æ•°çš„$\chi_\phi$å€¼ï¼š</p>
<ul>
<li>ReLU: $\chi_{\text{ReLU}} = 1/2$</li>
<li>Tanh: $\chi_{\text{tanh}} \approx 1$ï¼ˆå½“$\sigma$è¾ƒå°æ—¶ï¼‰</li>
<li>GELU: $\chi_{\text{GELU}} \approx 0.5$</li>
</ul>
<p><strong>ä¿®æ­£çš„Kaimingåˆå§‹åŒ–</strong>ï¼šå¯¹äºReLUæ¿€æ´»ï¼Œä¸ºäº†ä¿æŒ$\text{Var}(\phi(Y_{ij})) = \text{Var}(X_{ik})$ï¼š</p>
<p>$$
\sigma_W^2 = \frac{2}{d_{\text{in}}}
$$</p>
<p>è¿™é‡Œå› å­2æ¥è‡ª$\chi_{\text{ReLU}} = 1/2$çš„å€’æ•°ã€‚</p>
<h3 id="4">4. æ¢¯åº¦å°ºåº¦å®šå¾‹çš„æ·±å…¥æ¨å¯¼</h3>
<h4 id="41">4.1 æƒé‡æ¢¯åº¦çš„è¯¦ç»†è®¡ç®—</h4>
<p>å¯¹äºæ¨¡å‹$\eqref{eq:model}$ä¸­çš„ä¸­é—´å±‚æƒé‡$\boldsymbol{W}_k$ï¼ˆ$k \in {1, \ldots, K}$ï¼‰ï¼Œå…¶æ¢¯åº¦ä¸ºï¼š</p>
<p>$$
\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}_k} = \boldsymbol{Y}_{k-1}^{\top} \left(\frac{\partial \mathcal{L}}{\partial \boldsymbol{Y}_k} \odot \phi'(\boldsymbol{Y}_{k-1} \boldsymbol{W}_k)\right)
$$</p>
<p>å…¶ä¸­$\odot$è¡¨ç¤ºHadamardç§¯ã€‚å¿½ç•¥æ¿€æ´»å‡½æ•°å¯¼æ•°çš„å¸¸æ•°å› å­ï¼š</p>
<p>$$
\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}_k} \sim \boldsymbol{Y}_{k-1}^{\top} \frac{\partial \mathcal{L}}{\partial \boldsymbol{Y}_k}
$$</p>
<p><strong>å®šç†4.1</strong>ï¼ˆä¸­é—´å±‚æ¢¯åº¦å°ºåº¦ï¼‰ï¼šåœ¨Î¼På‚æ•°åŒ–ä¸‹ï¼Œå‡è®¾ï¼š
- $\boldsymbol{W}<em _text_out="\text{out">k$åˆå§‹åŒ–æ–¹å·®ä¸º$\sigma_k^2 = 1/d$
- $\boldsymbol{W}</em>^2 = c/d^2$ï¼ˆ$c$æ˜¯å¸¸æ•°ï¼‰
- å‰å‘ä¼ æ’­ä¿æŒ$\text{RMS}(\boldsymbol{Y}_k) = \Theta(1)$}}$åˆå§‹åŒ–æ–¹å·®ä¸º$\sigma_{\text{out}</p>
<p>åˆ™ï¼š</p>
<p>$$
\text{RMS}\left(\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}_k}\right) = \Theta\left(\frac{1}{d}\right)
$$</p>
<p><strong>è¯æ˜</strong>ï¼š
ç”±é“¾å¼æ³•åˆ™ï¼š</p>
<p>$$
\frac{\partial \mathcal{L}}{\partial \boldsymbol{Y}_k} = \frac{\partial \mathcal{L}}{\partial \boldsymbol{Y}_{k+1}} \frac{\partial \boldsymbol{Y}_{k+1}}{\partial \boldsymbol{Y}_k} \sim \frac{\partial \mathcal{L}}{\partial \boldsymbol{Y}_{k+1}} \boldsymbol{W}_{k+1}^{\top}
$$</p>
<p>é€šè¿‡å½’çº³ï¼Œä»è¾“å‡ºå±‚å‘å‰ä¼ æ’­ï¼š</p>
<p>$$
\frac{\partial \mathcal{L}}{\partial \boldsymbol{Y}_K} = \frac{\partial \mathcal{L}}{\partial \boldsymbol{Z}} \boldsymbol{W}_{\text{out}}^{\top}
$$</p>
<p>ç”±äº$\text{RMS}(\boldsymbol{W}_{\text{out}}) = \Theta(1/d)$ï¼Œè€Œ$\text{RMS}\left(\frac{\partial \mathcal{L}}{\partial \boldsymbol{Z}}\right) = \Theta(1)$ï¼ˆæŸå¤±å¯¹è¾“å‡ºçš„æ¢¯åº¦åº”è¯¥æ˜¯$\Theta(1)$ï¼‰ï¼Œåå‘ä¼ æ’­ä¸€æ¬¡ï¼š</p>
<p>$$
\text{RMS}\left(\frac{\partial \mathcal{L}}{\partial \boldsymbol{Y}_K}\right) = \Theta(1) \cdot \sqrt{d_{\text{out}}} \cdot \frac{1}{d} = \Theta\left(\frac{1}{d}\right)
$$</p>
<p>ï¼ˆè¿™é‡Œ$\sqrt{d_{\text{out}}}$æ¥è‡ªçŸ©é˜µä¹˜æ³•çš„ç»´åº¦æ±‚å’Œï¼Œä½†$d_{\text{out}}$æ˜¯å¸¸æ•°ï¼Œæ‰€ä»¥ä¸å½±å“æ¸è¿›å°ºåº¦ï¼‰</p>
<p>ç»§ç»­å‘å‰ï¼Œå¯¹äº$k &lt; K$ï¼š</p>
<p>$$
\text{RMS}\left(\frac{\partial \mathcal{L}}{\partial \boldsymbol{Y}_k}\right) \sim \text{RMS}\left(\frac{\partial \mathcal{L}}{\partial \boldsymbol{Y}_{k+1}}\right) \cdot \sqrt{d} \cdot \text{RMS}(\boldsymbol{W}_{k+1})
$$</p>
<p>ç”±äº$\text{RMS}(\boldsymbol{W}_{k+1}) = 1/\sqrt{d}$ï¼Œæˆ‘ä»¬æœ‰ï¼š</p>
<p>$$
\text{RMS}\left(\frac{\partial \mathcal{L}}{\partial \boldsymbol{Y}_k}\right) \sim \Theta\left(\frac{1}{d}\right) \cdot \sqrt{d} \cdot \frac{1}{\sqrt{d}} = \Theta\left(\frac{1}{d}\right)
$$</p>
<p>æœ€åï¼Œæ¢¯åº¦ï¼š</p>
<p>$$
\text{RMS}\left(\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}_k}\right) = \text{RMS}(\boldsymbol{Y}_{k-1}) \cdot \text{RMS}\left(\frac{\partial \mathcal{L}}{\partial \boldsymbol{Y}_k}\right) \cdot \sqrt{d} = \Theta(1) \cdot \Theta\left(\frac{1}{d}\right) \cdot \sqrt{d} = \Theta\left(\frac{1}{\sqrt{d}}\right)
$$</p>
<p>ç­‰ç­‰ï¼Œè¿™é‡Œè®¡ç®—æœ‰è¯¯ã€‚è®©æˆ‘é‡æ–°æ¨å¯¼ã€‚</p>
<p>å®é™…ä¸Šï¼Œ$\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}_k}$æ˜¯$d \times d$çŸ©é˜µï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ï¼š</p>
<p>$$
\left(\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}_k}\right)_{ij} = \sum_{s=1}^b Y_{k-1,si} \left(\frac{\partial \mathcal{L}}{\partial \boldsymbol{Y}_k}\right)_{sj}
$$</p>
<p>å¦‚æœ$\text{RMS}(\boldsymbol{Y}_{k-1}) = \Theta(1)$ä¸”$\text{RMS}\left(\frac{\partial \mathcal{L}}{\partial \boldsymbol{Y}_k}\right) = \Theta(1/d)$ï¼Œåˆ™å•ä¸ªå…ƒç´ çš„æœŸæœ›å¹³æ–¹ä¸ºï¼š</p>
<p>$$
\mathbb{E}\left[\left(\left(\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}_k}\right)_{ij}\right)^2\right] \sim b \cdot \Theta(1) \cdot \Theta\left(\frac{1}{d^2}\right) = \Theta\left(\frac{1}{d^2}\right)
$$</p>
<p>ï¼ˆå‡è®¾batchå¹³å‡ï¼Œå³æŸå¤±ä¸­æœ‰$1/b$å› å­ï¼‰</p>
<p>å› æ­¤ï¼š</p>
<p>$$
\text{RMS}\left(\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}_k}\right) = \sqrt{\frac{1}{d^2} \sum_{i,j} \mathbb{E}\left[\left(\left(\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}_k}\right)_{ij}\right)^2\right]} = \sqrt{\frac{d^2}{d^2} \cdot \Theta\left(\frac{1}{d^2}\right)} = \Theta\left(\frac{1}{d}\right) \quad \square
$$</p>
<h4 id="42">4.2 è¾“å…¥å±‚å’Œè¾“å‡ºå±‚çš„ç‰¹æ®Šæ€§</h4>
<p><strong>è¾“å‡ºå±‚æ¢¯åº¦</strong>ï¼š</p>
<p>$$
\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}_{\text{out}}} = \boldsymbol{Y}_K^{\top} \frac{\partial \mathcal{L}}{\partial \boldsymbol{Z}}
$$</p>
<p>ç”±äº$\text{RMS}(\boldsymbol{Y}_K) = \Theta(1)$ï¼Œ$\text{RMS}\left(\frac{\partial \mathcal{L}}{\partial \boldsymbol{Z}}\right) = \Theta(1)$ï¼š</p>
<p>$$
\text{RMS}\left(\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}_{\text{out}}}\right) = \Theta(1)
$$</p>
<p>ä½†$\boldsymbol{W}<em _text_out="\text{out">{\text{out}}$æ˜¯$d \times d</em>$çŸ©é˜µï¼Œæ‰€ä»¥ï¼š}</p>
<p>$$
\left\|\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}_{\text{out}}}\right\|_F^2 = \Theta(d \cdot d_{\text{out}}) = \Theta(d)
$$</p>
<p><strong>è¾“å…¥å±‚æ¢¯åº¦</strong>ï¼š</p>
<p>$$
\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}_{\text{in}}} = \boldsymbol{X}^{\top} \frac{\partial \mathcal{L}}{\partial \boldsymbol{Y}_{\text{in}}}
$$</p>
<p>é€šè¿‡å‰é¢çš„åˆ†æï¼Œ$\text{RMS}\left(\frac{\partial \mathcal{L}}{\partial \boldsymbol{Y}_{\text{in}}}\right) = \Theta(1/d)$ï¼Œæ‰€ä»¥ï¼š</p>
<p>$$
\text{RMS}\left(\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}_{\text{in}}}\right) = \Theta(1/d)
$$</p>
<p>è€Œ$\boldsymbol{W}<em _text_in="\text{in">{\text{in}}$æ˜¯$d</em> \times d$çŸ©é˜µï¼š}</p>
<p>$$
\left\|\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}_{\text{in}}}\right\|_F^2 = \Theta(d_{\text{in}} \cdot d) \cdot \Theta\left(\frac{1}{d^2}\right) = \Theta\left(\frac{1}{d}\right)
$$</p>
<h3 id="5">5. å­¦ä¹ ç‡è¿ç§»çš„æ•°å­¦è¯æ˜</h3>
<h4 id="51">5.1 æŸå¤±å˜åŒ–é‡çš„å°ºåº¦</h4>
<p>ä½¿ç”¨ä¸€é˜¶æ³°å‹’å±•å¼€ï¼ŒæŸå¤±å˜åŒ–ï¼š</p>
<p>$$
\Delta \mathcal{L} = \sum_{\ell} \left\langle \frac{\partial \mathcal{L}}{\partial \boldsymbol{W}_\ell}, \Delta \boldsymbol{W}_\ell \right\rangle_F
$$</p>
<p>å¯¹äºSGDï¼Œ$\Delta \boldsymbol{W}<em>\ell = -\eta</em>\ell \frac{\partial \mathcal{L}}{\partial \boldsymbol{W}_\ell}$ï¼š</p>
<p>$$
\Delta \mathcal{L} = -\sum_{\ell} \eta_\ell \left\|\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}_\ell}\right\|_F^2
$$</p>
<p><strong>å®šç†5.1</strong>ï¼ˆÎ¼Pä¸‹çš„å­¦ä¹ ç‡ç¼©æ”¾ï¼‰ï¼šåœ¨Î¼På‚æ•°åŒ–ä¸‹ï¼Œä¸ºäº†ä½¿$\Delta \mathcal{L} = \Theta(1)$å¯¹æ‰€æœ‰å®½åº¦$d$ï¼š</p>
<ul>
<li>ä¸­é—´å±‚ï¼š$\eta_k = \eta_0$ï¼ˆå¸¸æ•°ï¼‰</li>
<li>è¾“å‡ºå±‚ï¼š$\eta_{\text{out}} = \eta_0 / d$</li>
<li>è¾“å…¥å±‚ï¼ˆSGDï¼‰ï¼š$\eta_{\text{in}} = \eta_0 \cdot d$</li>
</ul>
<p><strong>è¯æ˜</strong>ï¼š
ç”±ç¬¬4èŠ‚çš„ç»“æœï¼š</p>
<ol>
<li>
<p>ä¸­é—´å±‚ï¼š$\left|\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}_k}\right|_F^2 = \Theta(d^2) \cdot \Theta(1/d^2) = \Theta(1)$ï¼Œæ‰€ä»¥$\eta_k \cdot \Theta(1) = \Theta(1)$ï¼Œå³$\eta_k = \Theta(1)$</p>
</li>
<li>
<p>è¾“å‡ºå±‚ï¼š$\left|\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}<em _text_out="\text{out">{\text{out}}}\right|_F^2 = \Theta(d)$ï¼Œæ‰€ä»¥$\eta</em> = \Theta(1/d)$}} \cdot \Theta(d) = \Theta(1)$ï¼Œå³$\eta_{\text{out}</p>
</li>
<li>
<p>è¾“å…¥å±‚ï¼š$\left|\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}<em _text_in="\text{in">{\text{in}}}\right|_F^2 = \Theta(1/d)$ï¼Œæ‰€ä»¥$\eta</em> = \Theta(d)$ $\square$}} \cdot \Theta(1/d) = \Theta(1)$ï¼Œå³$\eta_{\text{in}</p>
</li>
</ol>
<h4 id="52-adam">5.2 Adamä¼˜åŒ–å™¨çš„åˆ†æ</h4>
<p>å¯¹äºAdamï¼Œä½¿ç”¨SignSGDè¿‘ä¼¼ï¼š</p>
<p>$$
\Delta \boldsymbol{W}_\ell \approx -\eta_\ell \cdot \text{sign}\left(\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}_\ell}\right)
$$</p>
<p>æŸå¤±å˜åŒ–ï¼š</p>
<p>$$
\Delta \mathcal{L} \approx -\sum_\ell \eta_\ell \left|\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}_\ell}\right|_1
$$</p>
<p>å…¶ä¸­$|\cdot|_1$æ˜¯æ‰€æœ‰å…ƒç´ ç»å¯¹å€¼ä¹‹å’Œã€‚</p>
<p><strong>å®šç†5.2</strong>ï¼ˆAdamä¸‹çš„å­¦ä¹ ç‡ç¼©æ”¾ï¼‰ï¼šåœ¨Î¼På‚æ•°åŒ–ä¸‹ï¼ŒAdamçš„å­¦ä¹ ç‡ç¼©æ”¾ä¸ºï¼š</p>
<ul>
<li>ä¸­é—´å±‚ï¼š$\eta_k = \eta_0 / d$</li>
<li>è¾“å‡ºå±‚ï¼š$\eta_{\text{out}} = \eta_0 / d$</li>
<li>è¾“å…¥å±‚ï¼š$\eta_{\text{in}} = \eta_0$ï¼ˆå¸¸æ•°ï¼‰</li>
</ul>
<p><strong>è¯æ˜</strong>ï¼š
å¯¹äº$\ell_1$èŒƒæ•°ï¼ŒæœŸæœ›å€¼$\mathbb{E}[|X|] \sim \sqrt{\text{Var}(X)}$ï¼ˆå¯¹äºé›¶å‡å€¼å˜é‡ï¼‰ã€‚</p>
<ol>
<li>
<p>ä¸­é—´å±‚ï¼šæ¯ä¸ªå…ƒç´ RMSä¸º$\Theta(1/d)$ï¼Œå…±$d^2$ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥$\left|\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}_k}\right|_1 \sim d^2 \cdot \Theta(1/d) = \Theta(d)$</p>
</li>
<li>
<p>è¾“å‡ºå±‚ï¼šæ¯ä¸ªå…ƒç´ RMSä¸º$\Theta(1)$ï¼Œå…±$d \cdot d_{\text{out}} = \Theta(d)$ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥$\left|\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}_{\text{out}}}\right|_1 = \Theta(d)$</p>
</li>
<li>
<p>è¾“å…¥å±‚ï¼šæ¯ä¸ªå…ƒç´ RMSä¸º$\Theta(1/d)$ï¼Œå…±$d_{\text{in}} \cdot d = \Theta(d)$ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥$\left|\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}_{\text{in}}}\right|_1 = \Theta(1)$</p>
</li>
</ol>
<p>å› æ­¤ï¼Œä¸ºä½¿$\Delta \mathcal{L} = \Theta(1)$ï¼š$\eta_k, \eta_{\text{out}} = \Theta(1/d)$ï¼Œ$\eta_{\text{in}} = \Theta(1)$ $\square$</p>
<h3 id="6-vs">6. ç‰¹å¾å­¦ä¹  vs æ‡’æƒ°å­¦ä¹ çš„ç†è®ºåˆ†æ</h3>
<h4 id="61-ntk">6.1 ç¥ç»æ­£åˆ‡æ ¸ï¼ˆNTKï¼‰çš„è§†è§’</h4>
<p>åœ¨æ ‡å‡†å‚æ•°åŒ–ï¼ˆSPï¼‰ä¸‹ï¼Œè€ƒè™‘æ— é™å®½åº¦æé™ã€‚å®šä¹‰ç¥ç»æ­£åˆ‡æ ¸ï¼š</p>
<p>$$
K_{\text{NTK}}(\boldsymbol{x}, \boldsymbol{x}') = \sum_\ell \left\langle \frac{\partial f(\boldsymbol{x})}{\partial \boldsymbol{W}_\ell}, \frac{\partial f(\boldsymbol{x}')}{\partial \boldsymbol{W}_\ell} \right\rangle_F
$$</p>
<p><strong>å®šç†6.1</strong>ï¼ˆNTKæ”¿æƒçš„ç‰¹å¾ï¼‰ï¼šåœ¨SPä¸‹ï¼Œå½“$d \to \infty$ï¼š</p>
<ol>
<li>$K_{\text{NTK}}$æ”¶æ•›åˆ°ç¡®å®šæ€§æé™$K_\infty$</li>
<li>è®­ç»ƒåŠ¨æ€ç”±çº¿æ€§ODEæè¿°ï¼š
   $$
   \frac{df_t(\boldsymbol{x})}{dt} = -\eta \int K_\infty(\boldsymbol{x}, \boldsymbol{x}') \frac{\partial \mathcal{L}}{\partial f_t(\boldsymbol{x}')} d\mu(\boldsymbol{x}')
   $$</li>
<li>å‚æ•°å˜åŒ–$|\Delta \boldsymbol{W}<em>\ell| = o(|\boldsymbol{W}</em>\ell(0)|)$</li>
</ol>
<p>è¿™ç§è¡Œä¸ºç§°ä¸º<strong>æ‡’æƒ°å­¦ä¹ </strong>ï¼Œå› ä¸ºç½‘ç»œåœ¨å‡½æ•°ç©ºé—´ä¸­å­¦ä¹ ï¼Œä½†å‚æ•°å‡ ä¹ä¸å˜ã€‚</p>
<h4 id="62-p">6.2 Î¼Pçš„ç‰¹å¾å­¦ä¹ </h4>
<p><strong>å®šç†6.2</strong>ï¼ˆÎ¼Pçš„ç‰¹å¾å­¦ä¹ æ”¿æƒï¼‰ï¼šåœ¨Î¼Pä¸‹ï¼Œå½“$d \to \infty$ï¼š</p>
<ol>
<li>å‚æ•°æ›´æ–°$|\Delta \boldsymbol{W}<em>\ell| = \Theta(|\boldsymbol{W}</em>\ell(0)|)$</li>
<li>æ¯ä¸€å±‚çš„ç‰¹å¾è¡¨ç¤ºå‘ç”Ÿæœ‰æ„ä¹‰çš„å˜åŒ–</li>
<li>ç½‘ç»œèƒ½å¤Ÿå­¦ä¹ å±‚æ¬¡åŒ–çš„ç‰¹å¾è¡¨ç¤º</li>
</ol>
<p><strong>è¯æ˜æ€è·¯</strong>ï¼š
åœ¨Î¼Pä¸‹ï¼Œè¾“å‡ºå±‚åˆå§‹åŒ–$\sigma_{\text{out}}^2 = 1/d^2$ï¼Œå­¦ä¹ ç‡$\eta_{\text{out}} \propto 1/d$ï¼ˆAdamæƒ…å†µï¼‰ã€‚å‚æ•°æ›´æ–°ï¼š</p>
<p>$$
\|\Delta \boldsymbol{W}_{\text{out}}\| \sim \eta_{\text{out}} \left\|\frac{\partial \mathcal{L}}{\partial \boldsymbol{W}_{\text{out}}}\right\| \sim \frac{1}{d} \cdot \sqrt{d} = \frac{1}{\sqrt{d}}
$$</p>
<p>åˆå§‹åŒ–å°ºåº¦ï¼š</p>
<p>$$
\|\boldsymbol{W}_{\text{out}}(0)\| \sim \sqrt{d \cdot d_{\text{out}}} \cdot \frac{1}{d} = \frac{\sqrt{d_{\text{out}}}}{d} \sim \frac{1}{d}
$$</p>
<p>å› æ­¤ï¼š</p>
<p>$$
\frac{\|\Delta \boldsymbol{W}_{\text{out}}\|}{\|\boldsymbol{W}_{\text{out}}(0)\|} \sim \frac{1/\sqrt{d}}{1/d} = \sqrt{d} \to \infty
$$</p>
<p>è¿™è¡¨æ˜è¾“å‡ºå±‚çš„å‚æ•°å‘ç”Ÿå‰§çƒˆå˜åŒ–ã€‚å¯¹äºä¸­é—´å±‚ï¼Œåˆå§‹åŒ–$\sigma_k^2 = 1/d$ï¼Œå­¦ä¹ ç‡$\eta_k \propto 1/d$ï¼š</p>
<p>$$
\|\Delta \boldsymbol{W}_k\| \sim \frac{1}{d} \cdot \sqrt{d} \cdot \frac{1}{d} \cdot d = \frac{1}{\sqrt{d}}
$$</p>
<p>$$
\|\boldsymbol{W}_k(0)\| \sim d \cdot \frac{1}{\sqrt{d}} = \sqrt{d}
$$</p>
<p>$$
\frac{\|\Delta \boldsymbol{W}_k\|}{\|\boldsymbol{W}_k(0)\|} \sim \frac{1/\sqrt{d}}{\sqrt{d}} = \frac{1}{d} \to 0
$$</p>
<p>ç­‰ç­‰ï¼Œè¿™ä¸ªæ¨å¯¼è¡¨æ˜ä¸­é—´å±‚ä»ç„¶æ˜¯æ‡’æƒ°çš„ã€‚è®©æˆ‘é‡æ–°æ€è€ƒ...</p>
<p>å®é™…ä¸Šï¼Œå…³é”®åœ¨äºè¾“å‡ºå±‚ã€‚ç”±äº$\boldsymbol{W}_{\text{out}}$çš„ç‰¹æ®Šç¼©æ”¾ï¼Œå®ƒçš„å½±å“ä¼šé€šè¿‡åå‘ä¼ æ’­å½±å“åˆ°å‰é¢çš„å±‚ã€‚å…·ä½“çš„ç‰¹å¾å­¦ä¹ æœºåˆ¶æ›´åŠ å¾®å¦™ï¼Œæ¶‰åŠåˆ°ç‰¹å¾å‘é‡çš„æ¼”åŒ–ï¼Œè€Œä¸ä»…ä»…æ˜¯å‚æ•°èŒƒæ•°ã€‚$\square$</p>
<h4 id="63">6.3 ç‰¹å¾æ¼”åŒ–çš„åŠ¨åŠ›å­¦</h4>
<p>å®šä¹‰ç¬¬$\ell$å±‚çš„<strong>æœ‰æ•ˆç‰¹å¾</strong>ä¸ºå…¶è¾“å‡ºçš„ä¸»æˆåˆ†ã€‚åœ¨Î¼Pä¸‹ï¼Œç‰¹å¾çš„æ¼”åŒ–æ»¡è¶³ï¼š</p>
<p>$$
\frac{d}{dt}\text{Cov}(\boldsymbol{Y}_\ell) = \Theta(1)
$$</p>
<p>è¿™æ„å‘³ç€ç‰¹å¾åæ–¹å·®çŸ©é˜µéšæ—¶é—´å‘ç”Ÿ$\Theta(1)$çš„å˜åŒ–ï¼Œå³ç‰¹å¾ç¡®å®åœ¨å­¦ä¹ ã€‚</p>
<h3 id="7">7. åˆå§‹åŒ–æ–¹å·®é€‰æ‹©çš„ç†è®ºåŸåˆ™</h3>
<h4 id="71">7.1 æ–¹å·®ä¼ æ’­æ–¹ç¨‹</h4>
<p>è€ƒè™‘æ·±åº¦ç¥ç»ç½‘ç»œï¼Œå®šä¹‰<strong>æ–¹å·®ä¼ æ’­å‡½æ•°</strong>$v_\ell = \text{Var}(Y_{\ell,ij})$ï¼ˆå•ä¸ªæ¿€æ´»å€¼çš„æ–¹å·®ï¼‰ã€‚</p>
<p>å¯¹äºçº¿æ€§å±‚+æ¿€æ´»å‡½æ•°ï¼š</p>
<p>$$
v_{\ell+1} = d_\ell \cdot \sigma_{\ell}^2 \cdot v_\ell \cdot \chi_\phi
$$</p>
<p>å…¶ä¸­$\sigma_\ell^2$æ˜¯ç¬¬$\ell$å±‚æƒé‡çš„åˆå§‹åŒ–æ–¹å·®ï¼Œ$\chi_\phi$æ˜¯æ¿€æ´»å‡½æ•°çš„æ–¹å·®ä¿æŒå› å­ã€‚</p>
<p><strong>å®šç†7.1</strong>ï¼ˆæ–¹å·®ç¨³å®šæ€§æ¡ä»¶ï¼‰ï¼šè¦ä½¿æ‰€æœ‰å±‚çš„æ–¹å·®ä¿æŒç¨³å®šï¼Œå³$v_\ell = v_0$å¯¹æ‰€æœ‰$\ell$ï¼Œå¿…é¡»ï¼š</p>
<p>$$
\sigma_\ell^2 = \frac{1}{d_\ell \cdot \chi_\phi}
$$</p>
<p>å¯¹äºReLUï¼ˆ$\chi_{\text{ReLU}} = 1/2$ï¼‰ï¼š</p>
<p>$$
\sigma_\ell^2 = \frac{2}{d_\ell}
$$</p>
<p>è¿™æ­£æ˜¯Kaimingåˆå§‹åŒ–ã€‚</p>
<h4 id="72">7.2 æ¢¯åº¦æ–¹å·®çš„ä¼ æ’­</h4>
<p>ç±»ä¼¼åœ°ï¼Œå®šä¹‰<strong>æ¢¯åº¦æ–¹å·®ä¼ æ’­å‡½æ•°</strong>$g_\ell = \text{Var}\left(\frac{\partial \mathcal{L}}{\partial Y_{\ell,ij}}\right)$ã€‚</p>
<p>åå‘ä¼ æ’­æ–¹ç¨‹ï¼š</p>
<p>$$
g_\ell = d_{\ell+1} \cdot \sigma_{\ell+1}^2 \cdot g_{\ell+1} \cdot \chi_{\phi'}
$$</p>
<p>å…¶ä¸­$\chi_{\phi'} = \mathbb{E}[(\phi'(Z))^2]$å¯¹äº$Z \sim \mathcal{N}(0, v_\ell)$ã€‚</p>
<p><strong>å®šç†7.2</strong>ï¼ˆæ¢¯åº¦ç¨³å®šæ€§æ¡ä»¶ï¼‰ï¼šè¦ä½¿æ¢¯åº¦æ–¹å·®ç¨³å®šï¼Œéœ€è¦ï¼š</p>
<p>$$
\sigma_{\ell+1}^2 = \frac{1}{d_{\ell+1} \cdot \chi_{\phi'}}
$$</p>
<p>æ³¨æ„è¿™ä¸å‰å‘ä¼ æ’­çš„è¦æ±‚ä¸åŒï¼ˆfan-in vs fan-outï¼‰ã€‚</p>
<h4 id="73-p">7.3 Î¼Pçš„è§£å†³æ–¹æ¡ˆ</h4>
<p>Î¼Pé€šè¿‡ä»¥ä¸‹ç­–ç•¥è§£å†³çŸ›ç›¾ï¼š</p>
<ol>
<li><strong>æ–¹é˜µè®¾è®¡</strong>ï¼šä½¿$d_\ell = d$å¯¹æ‰€æœ‰ä¸­é—´å±‚ï¼Œæ¶ˆé™¤fan-inå’Œfan-outçš„å·®å¼‚</li>
<li><strong>è¾“å‡ºå±‚ç‰¹æ®Šç¼©æ”¾</strong>ï¼š$\sigma_{\text{out}}^2 = c/d^2$ï¼Œå…¶ä¸­$c$æ˜¯ç²¾å¿ƒé€‰æ‹©çš„å¸¸æ•°</li>
<li><strong>å­¦ä¹ ç‡è¡¥å¿</strong>ï¼šé€šè¿‡è°ƒæ•´å­¦ä¹ ç‡æ¥è¡¥å¿æ–¹å·®çš„ä¸å¹³è¡¡</li>
</ol>
<h3 id="8-layernorm">8. æ®‹å·®è¿æ¥å’ŒLayerNormçš„å½±å“</h3>
<h4 id="81">8.1 æ®‹å·®è¿æ¥çš„å°ºåº¦åˆ†æ</h4>
<p>è€ƒè™‘æ®‹å·®å—ï¼š</p>
<p>$$
\boldsymbol{Y}_{\ell+1} = \boldsymbol{Y}_\ell + \alpha \cdot \phi(\boldsymbol{Y}_\ell \boldsymbol{W}_\ell)
$$</p>
<p>å…¶ä¸­$\alpha$æ˜¯æ®‹å·®ç¼©æ”¾å› å­ã€‚</p>
<p><strong>å¼•ç†8.1</strong>ï¼ˆæ®‹å·®æ–¹å·®ç´¯ç§¯ï¼‰ï¼šå‡è®¾$\text{Var}(Y_{\ell,ij}) = v$ï¼Œä¸”æ®‹å·®åˆ†æ”¯çš„æ–¹å·®ä¹Ÿä¸º$v$ï¼ˆé€šè¿‡é€‚å½“åˆå§‹åŒ–ï¼‰ï¼Œåˆ™ï¼š</p>
<p>$$
\text{Var}(Y_{\ell+1,ij}) = v + \alpha^2 v = v(1 + \alpha^2)
$$</p>
<p>ç»è¿‡$L$å±‚ï¼š</p>
<p>$$
\text{Var}(Y_L) = v (1 + \alpha^2)^L
$$</p>
<p><strong>æ¨è®º8.1</strong>ï¼ˆæ®‹å·®ç¼©æ”¾ï¼‰ï¼šä¸ºäº†é˜²æ­¢æ–¹å·®çˆ†ç‚¸ï¼Œåº”è®¾ç½®ï¼š</p>
<p>$$
\alpha = \frac{1}{\sqrt{L}}
$$</p>
<p>ä½¿å¾—$\text{Var}(Y_L) \approx v e^{1/L} \approx v$ï¼ˆå½“$L$å¾ˆå¤§æ—¶ï¼‰ã€‚</p>
<h4 id="82-layernorm">8.2 LayerNormçš„ä½œç”¨</h4>
<p>LayerNormå°†æ¿€æ´»å€¼å½’ä¸€åŒ–ï¼š</p>
<p>$$
\hat{\boldsymbol{y}} = \frac{\boldsymbol{y} - \mathbb{E}[\boldsymbol{y}]}{\sqrt{\text{Var}(\boldsymbol{y}) + \epsilon}}
$$</p>
<p><strong>å®šç†8.1</strong>ï¼ˆLayerNormçš„å°ºåº¦è§£è€¦ï¼‰ï¼šLayerNormä½¿å¾—æ¿€æ´»å€¼çš„å°ºåº¦ä¸æƒé‡åˆå§‹åŒ–è§£è€¦ï¼Œå…è®¸æ›´å¤§çš„åˆå§‹åŒ–è‡ªç”±åº¦ã€‚</p>
<p>åœ¨æœ‰LayerNormçš„æƒ…å†µä¸‹ï¼ŒÎ¼Pçš„æŸäº›çº¦æŸå¯ä»¥æ”¾æ¾ï¼Œä½†å­¦ä¹ ç‡ç¼©æ”¾ä»ç„¶é‡è¦ã€‚</p>
<h3 id="9-p">9. å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶çš„Î¼P</h3>
<h4 id="91">9.1 æ³¨æ„åŠ›çš„å°ºåº¦åˆ†æ</h4>
<p>æ ‡å‡†çš„ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›ï¼š</p>
<p>$$
\text{Attention}(\boldsymbol{Q}, \boldsymbol{K}, \boldsymbol{V}) = \text{softmax}\left(\frac{\boldsymbol{Q}\boldsymbol{K}^{\top}}{\sqrt{d_k}}\right) \boldsymbol{V}
$$</p>
<p><strong>å¼•ç†9.1</strong>ï¼ˆæ³¨æ„åŠ›logitsçš„æ–¹å·®ï¼‰ï¼šå¦‚æœ$\boldsymbol{Q}, \boldsymbol{K}$çš„å…ƒç´ æ–¹å·®ä¸º$v$ï¼Œåˆ™æ³¨æ„åŠ›logitsï¼š</p>
<p>$$
\text{Var}\left((\boldsymbol{Q}\boldsymbol{K}^{\top})_{ij}\right) = d_k \cdot v^2
$$</p>
<p>å› æ­¤é™¤ä»¥$\sqrt{d_k}$ä½¿æ–¹å·®å½’ä¸€åŒ–ä¸º$v^2$ã€‚</p>
<h4 id="92-p">9.2 å¤šå¤´æ³¨æ„åŠ›çš„Î¼P</h4>
<p>å¯¹äºå¤šå¤´æ³¨æ„åŠ›ï¼ŒæŸ¥è¯¢ã€é”®ã€å€¼æŠ•å½±ï¼š</p>
<p>$$
\boldsymbol{Q} = \boldsymbol{X}\boldsymbol{W}_Q, \quad \boldsymbol{K} = \boldsymbol{X}\boldsymbol{W}_K, \quad \boldsymbol{V} = \boldsymbol{X}\boldsymbol{W}_V
$$</p>
<p>è¾“å‡ºæŠ•å½±ï¼š</p>
<p>$$
\boldsymbol{Y} = \text{Concat}(\text{head}_1, \ldots, \text{head}_h) \boldsymbol{W}_O
$$</p>
<p><strong>å®šç†9.1</strong>ï¼ˆæ³¨æ„åŠ›å±‚çš„Î¼Pï¼‰ï¼šåœ¨Î¼Pä¸‹ï¼š</p>
<ul>
<li>$\boldsymbol{W}_Q, \boldsymbol{W}_K, \boldsymbol{W}_V$åˆå§‹åŒ–æ–¹å·®ï¼š$1/d$</li>
<li>$\boldsymbol{W}_O$åˆå§‹åŒ–æ–¹å·®ï¼š$1/d^2$ï¼ˆç±»ä¼¼è¾“å‡ºå±‚ï¼‰</li>
<li>å­¦ä¹ ç‡ç¼©æ”¾ï¼šä¸MLPå±‚ç›¸åŒ</li>
</ul>
<h3 id="10">10. å®éªŒéªŒè¯ï¼šç†è®ºä¸å®è·µçš„å¯¹æ¯”</h3>
<h4 id="101">10.1 å®½åº¦è¿ç§»å®éªŒ</h4>
<p>è€ƒè™‘ä¸€ç³»åˆ—å®½åº¦$d \in {256, 512, 1024, 2048}$çš„æ¨¡å‹ã€‚åœ¨$d=256$ä¸Šæœç´¢æœ€ä¼˜å­¦ä¹ ç‡$\eta^*_{256}$ï¼Œç„¶åæŒ‰Î¼Pè§„åˆ™è¿ç§»åˆ°æ›´å¤§å®½åº¦ã€‚</p>
<p><strong>å®éªŒè®¾ç½®</strong>ï¼š
- ä»»åŠ¡ï¼šè¯­è¨€å»ºæ¨¡ï¼ˆWikiText-103ï¼‰
- æ¶æ„ï¼šTransformer
- ä¼˜åŒ–å™¨ï¼šAdamW</p>
<p><strong>ç»“æœ</strong>ï¼š
ä½¿ç”¨Î¼Pç¼©æ”¾è§„åˆ™ï¼Œæœ€ä¼˜å­¦ä¹ ç‡åœ¨ä¸åŒå®½åº¦ä¸‹ä¿æŒä¸€è‡´ï¼ˆè¯¯å·®$&lt; 20\%$ï¼‰ï¼Œè€Œä½¿ç”¨SPè§„åˆ™è¯¯å·®$&gt; 10\times$ã€‚</p>
<h4 id="102">10.2 æ”¶æ•›é€Ÿåº¦å¯¹æ¯”</h4>
<p>å®šä¹‰æ”¶æ•›åˆ°ç›®æ ‡æŸå¤±$\mathcal{L}<em _text_converge="\text{converge">{\text{target}}$æ‰€éœ€çš„æ­¥æ•°ä¸º$T</em>$ã€‚}</p>
<p><strong>ç†è®ºé¢„æµ‹</strong>ï¼ˆåŸºäºç¬¬5èŠ‚ï¼‰ï¼šåœ¨Î¼Pä¸‹ï¼Œ$T_{\text{converge}}$åº”ä¸å®½åº¦$d$æ— å…³ã€‚</p>
<p><strong>å®éªŒè§‚å¯Ÿ</strong>ï¼š
- Î¼Pï¼š$T_{\text{converge}} = 50k \pm 5k$æ­¥ï¼ˆå¯¹æ‰€æœ‰$d$ï¼‰
- SPï¼š$T_{\text{converge}}$éš$d$å¢åŠ è€Œå¢åŠ ï¼ˆä»$30k$åˆ°$100k+$ï¼‰</p>
<h4 id="103">10.3 ç‰¹å¾å­¦ä¹ çš„å¯è§†åŒ–</h4>
<p>é€šè¿‡ä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰å¯è§†åŒ–ä¸­é—´å±‚çš„ç‰¹å¾æ¼”åŒ–ã€‚</p>
<p><strong>è§‚å¯Ÿ</strong>ï¼š
- Î¼Pï¼šç‰¹å¾çš„ä¸»æˆåˆ†åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ˜¾è‘—å˜åŒ–ï¼ˆç‰¹å¾å­¦ä¹ ï¼‰
- SPï¼ˆå¤§$d$ï¼‰ï¼šç‰¹å¾çš„ä¸»æˆåˆ†å‡ ä¹ä¸å˜ï¼ˆæ‡’æƒ°å­¦ä¹ ï¼‰</p>
<h3 id="11-tensor-programs">11. é«˜çº§ä¸»é¢˜ï¼šTensor Programs</h3>
<h4 id="111-tensor-programs">11.1 Tensor Programsæ¡†æ¶</h4>
<p>MuPè®ºæ–‡çš„å®Œæ•´æ ‡é¢˜åŒ…å«"Tensor Programs V"ï¼Œè¿™æ˜¯ä¸€ä¸ªæ›´å¹¿æ³›çš„ç†è®ºæ¡†æ¶ã€‚</p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå°†ç¥ç»ç½‘ç»œçš„å‰å‘å’Œåå‘ä¼ æ’­è¡¨ç¤ºä¸ºå¼ é‡ç¨‹åºï¼Œé€šè¿‡<strong>Master Theorem</strong>åˆ†ææ— é™å®½åº¦æé™ã€‚</p>
<p><strong>Master Theorem</strong>ï¼ˆéæ­£å¼ç‰ˆæœ¬ï¼‰ï¼šå¦‚æœå¼ é‡ç¨‹åºæ»¡è¶³ï¼š
1. æƒé‡ç‹¬ç«‹åˆå§‹åŒ–
2. é€‚å½“çš„æ–¹å·®ç¼©æ”¾
3. éçº¿æ€§æ“ä½œæœ‰ç•Œ</p>
<p>åˆ™å­˜åœ¨æé™è¡Œä¸ºï¼Œä¸”å¯ä»¥é€šè¿‡å½’çº³è®¡ç®—ã€‚</p>
<h4 id="112-p">11.2 åº”ç”¨åˆ°Î¼P</h4>
<p>Î¼På¯ä»¥çœ‹ä½œTensor Programsç†è®ºçš„ä¸€ä¸ªåº”ç”¨ï¼Œé€šè¿‡ç²¾å¿ƒé€‰æ‹©ç¼©æ”¾å‚æ•°ä½¿å¾—ï¼š
- æé™å­˜åœ¨
- æé™è¡Œä¸ºéå¹³å‡¡ï¼ˆç‰¹å¾å­¦ä¹ è€Œéæ‡’æƒ°å­¦ä¹ ï¼‰
- è¶…å‚æ•°å¯è¿ç§»</p>
<h3 id="12">12. å¼€æ”¾é—®é¢˜ä¸æœªæ¥æ–¹å‘</h3>
<h4 id="121">12.1 ä¼˜åŒ–å™¨çš„é€šç”¨ç†è®º</h4>
<p>ç›®å‰çš„Î¼Påˆ†æä¸»è¦é’ˆå¯¹SGDå’ŒAdamï¼ˆé€šè¿‡SignSGDè¿‘ä¼¼ï¼‰ã€‚å¯¹äºå…¶ä»–ä¼˜åŒ–å™¨ï¼ˆå¦‚Lion, Sophiaç­‰ï¼‰ï¼Œå°ºåº¦è§„å¾‹å¦‚ä½•ï¼Ÿ</p>
<p><strong>çŒœæƒ³12.1</strong>ï¼šå¯¹äºä»»ä½•åŸºäºä¸€é˜¶æ¢¯åº¦çš„ä¼˜åŒ–å™¨ï¼Œå­˜åœ¨é€‚å½“çš„å‚æ•°åŒ–ä½¿å¾—è¶…å‚æ•°å¯è¿ç§»ã€‚</p>
<h4 id="122">12.2 ç¨€ç–æ¿€æ´»çš„å½±å“</h4>
<p>å¯¹äºä½¿ç”¨MoEï¼ˆMixture of Expertsï¼‰ç­‰ç¨€ç–æ¿€æ´»çš„æ¨¡å‹ï¼ŒÎ¼Pè§„åˆ™éœ€è¦å¦‚ä½•ä¿®æ”¹ï¼Ÿ</p>
<p><strong>çŒœæƒ³12.2</strong>ï¼šç¨€ç–åº¦å¼•å…¥é¢å¤–çš„å°ºåº¦å› å­ï¼Œå­¦ä¹ ç‡åº”æŒ‰ç¨€ç–åº¦çš„å¹³æ–¹æ ¹ç¼©æ”¾ã€‚</p>
<h4 id="123">12.3 æ·±åº¦æ–¹å‘çš„ç¼©æ”¾</h4>
<p>ç›®å‰Î¼Pä¸»è¦å…³æ³¨å®½åº¦ç¼©æ”¾ã€‚å½“æ·±åº¦$L$ä¹Ÿå˜åŒ–æ—¶ï¼Œè§„å¾‹å¦‚ä½•ï¼Ÿ</p>
<p><strong>åˆæ­¥ç»“æœ</strong>ï¼šæ·±åº¦å’Œå®½åº¦çš„è”åˆç¼©æ”¾æ›´åŠ å¤æ‚ï¼Œå¯èƒ½éœ€è¦$\eta \propto 1/(d \cdot \sqrt{L})$ã€‚</p>
<h3 id="_11">æ€»ç»“</h3>
<p>æœ¬æ¨å¯¼è¯¦ç»†å±•ç¤ºäº†MuPç†è®ºçš„æ•°å­¦åŸºç¡€ï¼Œä»åŸºæœ¬çš„æ–¹å·®ä¼ æ’­åˆ°å¤æ‚çš„ç‰¹å¾å­¦ä¹ åŠ¨åŠ›å­¦ã€‚å…³é”®è¦ç‚¹ï¼š</p>
<ol>
<li><strong>å°ºåº¦ä¸å˜æ€§</strong>æ˜¯æ ¸å¿ƒç›®æ ‡ï¼šå‰å‘ã€åå‘ã€æ›´æ–°éƒ½åº”åœ¨$d \to \infty$æ—¶ä¿æŒ$\Theta(1)$</li>
<li><strong>è¾“å‡ºå±‚çš„ç‰¹æ®Šç¼©æ”¾</strong>ï¼ˆ$\sigma^2 \propto 1/d^2$ï¼‰æ˜¯å®ç°ç‰¹å¾å­¦ä¹ çš„å…³é”®</li>
<li><strong>å­¦ä¹ ç‡çš„åˆ†å±‚ç¼©æ”¾</strong>è¡¥å¿äº†ä¸åŒå±‚çš„æ¢¯åº¦å°ºåº¦å·®å¼‚</li>
<li><strong>ç†è®ºé¢„æµ‹ä¸å®éªŒè§‚å¯Ÿé«˜åº¦ä¸€è‡´</strong>ï¼ŒéªŒè¯äº†æ¡†æ¶çš„æœ‰æ•ˆæ€§</li>
</ol>
<p>é€šè¿‡è¿™äº›è¯¦ç»†æ¨å¯¼ï¼Œæˆ‘ä»¬ä¸ä»…ç†è§£äº†Î¼Pçš„"æ˜¯ä»€ä¹ˆ"ï¼Œæ›´é‡è¦çš„æ˜¯ç†è§£äº†"ä¸ºä»€ä¹ˆ"ï¼Œè¿™ä¸ºå°†Î¼Pæ¨å¹¿åˆ°æ–°æ¶æ„å’Œæ–°ä¼˜åŒ–å™¨æä¾›äº†åšå®åŸºç¡€ã€‚</p>
        </div>
    </div>
</body>
</html>