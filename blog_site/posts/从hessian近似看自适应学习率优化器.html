<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»Hessianè¿‘ä¼¼çœ‹è‡ªé€‚åº”å­¦ä¹ ç‡ä¼˜åŒ–å™¨</title>
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5;
}
.container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
header { border-bottom: 2px solid #e0e0e0; padding-bottom: 20px; margin-bottom: 30px; }
h1 { color: #2c3e50; margin-bottom: 10px; font-size: 2em; }
.meta { color: #666; font-size: 0.9em; margin-bottom: 20px; }
.content { margin-top: 30px; overflow-wrap: break-word; }
.content h2 { color: #34495e; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
.content p { margin-bottom: 15px; }
.content pre { background: #f8f8f8; padding: 15px; border-radius: 5px; overflow-x: auto; border-left: 3px solid #3498db; margin: 15px 0; }
.content code { background: #f8f8f8; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
.content blockquote { border-left: 4px solid #3498db; padding-left: 20px; margin: 20px 0; color: #555; font-style: italic; }
.content table { border-collapse: collapse; width: 100%; margin: 20px 0; }
.content th, .content td { border: 1px solid #ddd; padding: 10px; text-align: left; }
.back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: 500; }
</style>
    
<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\(', '\)']],
            displayMath: [['$$', '$$'], ['\[', '\]']],
            processEscapes: true
        }
    };
</script>
<script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        <header>
            <h1>ä»Hessianè¿‘ä¼¼çœ‹è‡ªé€‚åº”å­¦ä¹ ç‡ä¼˜åŒ–å™¨</h1>
            <div class="meta">ğŸ“… æœ€åæ›´æ–°: 2025-11-26 | ğŸ“„ å¤§å°: 46.2 KB</div>
        </header>
        <div class="content">
            <p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/10588">https://spaces.ac.cn/archives/10588</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: </p>
<hr />
<p>è¿™å‡ å¤©åœ¨é‡æ¸©å»å¹´çš„Metaçš„ä¸€ç¯‡è®ºæ–‡<a href="https://papers.cool/arxiv/2304.09871">ã€ŠA Theory on Adam Instability in Large-Scale Machine Learningã€‹</a>ï¼Œé‡Œè¾¹ç»™å‡ºäº†çœ‹å¾…Adamç­‰è‡ªé€‚åº”å­¦ä¹ ç‡ä¼˜åŒ–å™¨çš„æ–°è§†è§’ï¼šå®ƒæŒ‡å‡ºæ¢¯åº¦å¹³æ–¹çš„æ»‘åŠ¨å¹³å‡æŸç§ç¨‹åº¦ä¸Šè¿‘ä¼¼äºåœ¨ä¼°è®¡HessiançŸ©é˜µçš„å¹³æ–¹ï¼Œä»è€ŒAdamã€RMSpropç­‰ä¼˜åŒ–å™¨å®é™…ä¸Šè¿‘ä¼¼äºäºŒé˜¶çš„Newtonæ³•ã€‚</p>
<p>è¿™ä¸ªè§’åº¦é¢‡ä¸ºæ–°é¢–ï¼Œè€Œä¸”è¡¨é¢ä¸Šè·Ÿä»¥å¾€çš„ä¸€äº›Hessianè¿‘ä¼¼æœ‰æ˜æ˜¾çš„å·®å¼‚ï¼Œå› æ­¤å€¼å¾—æˆ‘ä»¬å»å­¦ä¹ å’Œæ€è€ƒä¸€ç•ªã€‚</p>
<h2 id="_1">ç‰›é¡¿ä¸‹é™</h2>
<p>è®¾æŸå¤±å‡½æ•°ä¸º$\mathcal{L}(\boldsymbol{\theta})$ï¼Œå…¶ä¸­å¾…ä¼˜åŒ–å‚æ•°ä¸º$\boldsymbol{\theta}$ï¼Œæˆ‘ä»¬çš„ä¼˜åŒ–ç›®æ ‡æ˜¯<br />
\begin{equation}\boldsymbol{\theta}^* = \mathop{\text{argmin}}<em t_1="t+1">{\boldsymbol{\theta}} \mathcal{L}(\boldsymbol{\theta})\label{eq:loss}\end{equation}<br />
å‡è®¾$\boldsymbol{\theta}$çš„å½“å‰å€¼æ˜¯$\boldsymbol{\theta}_t$ï¼ŒNewtonæ³•é€šè¿‡å°†æŸå¤±å‡½æ•°å±•å¼€åˆ°äºŒé˜¶æ¥å¯»æ±‚$\boldsymbol{\theta}</em>$ï¼š<br />
\begin{equation}\mathcal{L}(\boldsymbol{\theta})\approx \mathcal{L}(\boldsymbol{\theta}<em _boldsymbol_theta="\boldsymbol{\theta">t) + \boldsymbol{g}_t^{\top}(\boldsymbol{\theta} - \boldsymbol{\theta}_t) + \frac{1}{2}(\boldsymbol{\theta} - \boldsymbol{\theta}_t)^{\top}\boldsymbol{\mathcal{H}}_t(\boldsymbol{\theta} - \boldsymbol{\theta}_t)\end{equation}<br />
å…¶ä¸­$\boldsymbol{g}_t = \nabla</em><em _boldsymbol_theta="\boldsymbol{\theta">t}\mathcal{L}(\boldsymbol{\theta}_t)$æ˜¯æ¢¯åº¦ã€ $\boldsymbol{\mathcal{H}}_t=\nabla</em><em t_1="t+1">t}^2\mathcal{L}(\boldsymbol{\theta}_t)$æ˜¯HessiançŸ©é˜µã€‚å‡å®šHessiançŸ©é˜µçš„æ­£å®šæ€§ï¼Œé‚£ä¹ˆä¸Šå¼å³ç«¯å°±å­˜åœ¨å”¯ä¸€çš„æœ€å°å€¼$\boldsymbol{\theta}_t - \boldsymbol{\mathcal{H}}_t^{-1}\boldsymbol{g}_t$ï¼ŒNewtonæ³•å°†å®ƒä½œä¸ºä¸‹ä¸€æ­¥çš„$\boldsymbol{\theta}</em>$ï¼š<br />
\begin{equation}\boldsymbol{\theta}<em _boldsymbol_theta="\boldsymbol{\theta">{t+1} = \boldsymbol{\theta}_t-\boldsymbol{\mathcal{H}}_t^{-1}\boldsymbol{g}_t = \boldsymbol{\theta}_t - (\nabla</em><em _boldsymbol_theta="\boldsymbol{\theta">t}^2\mathcal{L})^{-1} \nabla</em>}_t}\mathcal{L}\end{equation<br />
æ³¨æ„ä¸Šå¼æ²¡æœ‰é¢å¤–çš„å­¦ä¹ ç‡å‚æ•°ï¼Œå› æ­¤Newtonæ³•å¤©ç”Ÿå°±æ˜¯è‡ªé€‚åº”å­¦ä¹ ç‡ç®—æ³•ã€‚å½“ç„¶ï¼Œç”±äºHessiançŸ©é˜µçš„å¤æ‚åº¦æ­£æ¯”äºå‚æ•°é‡çš„å¹³æ–¹ï¼Œæ‰€ä»¥åœ¨æ·±åº¦å­¦ä¹ ä¸­å®Œæ•´çš„Newtonæ³•åŸºæœ¬ä¸Šåªæœ‰ç†è®ºä»·å€¼äº†ï¼ŒçœŸè¦æƒ³åº”ç”¨Newtonæ³•ï¼Œè¦å¯¹HessiançŸ©é˜µåšæ¯”è¾ƒå¤§çš„ç®€åŒ–å‡è®¾ï¼Œæ¯”å¦‚å¯¹è§’çŸ©é˜µæˆ–è€…ä½ç§©çŸ©é˜µã€‚</p>
<p>åœ¨Newtonæ³•è§†è§’ä¸‹ï¼ŒSGDå°±æ˜¯å‡è®¾äº†$\boldsymbol{\mathcal{H}}<em t-1="t-1">t=\eta_t^{-1}\boldsymbol{I}$ï¼Œè€ŒAdamåˆ™æ˜¯å‡è®¾$\boldsymbol{\mathcal{H}}_t=\eta_t^{-1}\text{diag}(\sqrt{\hat{\boldsymbol{v}}_t} + \epsilon)$ï¼Œå…¶ä¸­<br />
\begin{equation}\text{Adam}:=\left\{\begin{aligned}<br />
&amp;\boldsymbol{m}_t = \beta_1 \boldsymbol{m}</em>} + \left(1 - \beta_1\right) \boldsymbol{g<em t-1="t-1">t\\\<br />
&amp;\boldsymbol{v}_t = \beta_2 \boldsymbol{v}</em>} + \left(1 - \beta_2\right) \boldsymbol{g<em t-1="t-1">t\odot\boldsymbol{g}_t\\\<br />
&amp;\hat{\boldsymbol{m}}_t = \boldsymbol{m}_t\left/\left(1 - \beta_1^t\right)\right.\\\<br />
&amp;\hat{\boldsymbol{v}}_t = \boldsymbol{v}_t\left/\left(1 - \beta_2^t\right)\right.\\\<br />
&amp;\boldsymbol{\theta}_t = \boldsymbol{\theta}</em> + \epsilon\right)\right.} - \eta_t \hat{\boldsymbol{m}}_t\left/\left(\sqrt{\hat{\boldsymbol{v}}_t<br />
\end{aligned}\right.\end{equation}<br />
æ¥ä¸‹æ¥æˆ‘ä»¬æƒ³è¦è¯æ˜çš„æ˜¯ï¼Œ$\eta_t^{-1}\text{diag}(\sqrt{\hat{\boldsymbol{v}}_t})$æ˜¯$\boldsymbol{\mathcal{H}}_t$çš„ä¸€ä¸ªæ›´å¥½çš„è¿‘ä¼¼ã€‚</p>
<h2 id="_2">æ¢¯åº¦è¿‘ä¼¼</h2>
<p>è¯æ˜çš„è¦ç‚¹æ˜¯åˆ©ç”¨æ¢¯åº¦çš„ä¸€é˜¶è¿‘ä¼¼ï¼š<br />
\begin{equation}\boldsymbol{g}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}} \approx \boldsymbol{g}</em>^<em>} + \boldsymbol{\mathcal{H}}_{\boldsymbol{\theta}^</em>}(\boldsymbol{\theta} - \boldsymbol{\theta}^<em>)\end{equation}<br />
å…¶ä¸­$\boldsymbol{g}_{\boldsymbol{\theta}^</em>}$å’Œ$\boldsymbol{\mathcal{H}}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}^<em>}$è¡¨æ˜æˆ‘ä»¬åœ¨$\boldsymbol{\theta}=\boldsymbol{\theta}^</em>$å¤„å±•å¼€ï¼Œè¿™é‡Œçš„$\boldsymbol{\theta}^<em>$å°±æ˜¯æˆ‘ä»¬è¦å¯»æ‰¾çš„ç›®æ ‡$\eqref{eq:loss}$ï¼Œåœ¨æ­¤å¤„æ¨¡å‹çš„æ¢¯åº¦ä¸ºé›¶ï¼Œä»è€Œä¸Šå¼å¯ä»¥ç®€åŒ–æˆ<br />
\begin{equation}\boldsymbol{g}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}} \approx \boldsymbol{\mathcal{H}}</em>^</em>}(\boldsymbol{\theta} - \boldsymbol{\theta}^<em>)\end{equation}<br />
äºæ˜¯<br />
\begin{equation}\boldsymbol{g}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}\boldsymbol{g}</em>^}}^{\top} \approx \boldsymbol{\mathcal{H}}_{\boldsymbol{\theta</em>}(\boldsymbol{\theta} - \boldsymbol{\theta}^<em>)(\boldsymbol{\theta} - \boldsymbol{\theta}^</em>)^{\top}\boldsymbol{\mathcal{H}}</em>^<em>}^{\top}\end{equation}<br />
å‡è®¾è®­ç»ƒè¿›å…¥â€œæ­£è½¨â€åï¼Œæ¨¡å‹å°†ä¼šé•¿æœŸå¤„äºå›´ç»•ç€$\boldsymbol{\theta}^</em>$â€œæ‰“è½¬â€ã€ç¼“æ…¢ä¸”èºæ—‹åœ°æ”¶æ•›çš„çŠ¶æ€ï¼Œé‚£ä¹ˆä¸€å®šç¨‹åº¦ä¸Šæˆ‘ä»¬å¯ä»¥å°†$\boldsymbol{\theta} - \boldsymbol{\theta}^<em>$è§†ä¸ºæ­£æ€åˆ†å¸ƒ$\mathcal{N}(\boldsymbol{0},\sigma^2\boldsymbol{I})$çš„éšæœºå˜é‡ï¼Œé‚£ä¹ˆ<br />
\begin{equation}\mathbb{E}[\boldsymbol{g}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}\boldsymbol{g}</em>^}}^{\top}] \approx \boldsymbol{\mathcal{H}}_{\boldsymbol{\theta</em>}\mathbb{E}[(\boldsymbol{\theta} - \boldsymbol{\theta}^<em>)(\boldsymbol{\theta} - \boldsymbol{\theta}^</em>)^{\top}]\boldsymbol{\mathcal{H}}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}^<em>}^{\top} = \sigma^2\boldsymbol{\mathcal{H}}_{\boldsymbol{\theta}^</em>}\boldsymbol{\mathcal{H}}</em>^<em>}^{\top}\label{eq:hessian-2}\end{equation}<br />
å‡è®¾HessiançŸ©é˜µæ˜¯å¯¹è§’é˜µï¼Œé‚£ä¹ˆä¸Šå¼æˆ‘ä»¬å¯ä»¥åªä¿ç•™å¯¹è§’çº¿å…ƒç´ <br />
\begin{equation}\text{diag}(\mathbb{E}[\boldsymbol{g}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}\odot\boldsymbol{g}</em>^}}]) \approx \sigma^2\boldsymbol{\mathcal{H}}_{\boldsymbol{\theta</em>}^2\quad\Rightarrow\quad \boldsymbol{\mathcal{H}}_{\boldsymbol{\theta}^<em>} = \frac{1}{\sigma}\text{diag}(\sqrt{\mathbb{E}[\boldsymbol{g}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}\odot\boldsymbol{g}</em>}}]})\end{equation<br />
æ˜¯ä¸æ˜¯æœ‰ç‚¹ç›¸ä¼¼äº†ï¼ŸAdamçš„$\hat{\boldsymbol{v}}<em _boldsymbol_theta="\boldsymbol{\theta">t$æ˜¯å¯¹æ¢¯åº¦å¹³æ–¹çš„æ»‘åŠ¨å¹³å‡ï¼Œå®ƒå¯ä»¥çœ‹ä½œåœ¨è¿‘ä¼¼$\mathbb{E}[\boldsymbol{g}</em>}}\odot\boldsymbol{g<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}]$ã€‚æœ€åæˆ‘ä»¬å†å‡è®¾$\boldsymbol{\mathcal{H}}</em><em _boldsymbol_theta="\boldsymbol{\theta">t}$ç›¸æ¯”$\boldsymbol{\mathcal{H}}</em>^</em>}$å˜åŒ–ä¸å¤§ï¼Œå°±å¯ä»¥å¾—åˆ°$\eta_t^{-1}\text{diag}(\sqrt{\hat{\boldsymbol{v}}_t})$æ˜¯$\boldsymbol{\mathcal{H}}_t$è¿‘ä¼¼çš„ç»“è®ºã€‚</p>
<p>è¿™ä¹Ÿå¯ä»¥è§£é‡Šä¸ºä»€ä¹ˆAdamçš„$\beta_2$é€šå¸¸éƒ½å¤§äº$\beta_1$ã€‚ä¸ºäº†æ›´å‡†ç¡®åœ°ä¼°è®¡Hessianï¼Œ$\hat{\boldsymbol{v}}<em _boldsymbol_theta="\boldsymbol{\theta">t$çš„æ»‘åŠ¨å¹³å‡åº”è¯¥å°½å¯èƒ½â€œé•¿æœŸâ€ï¼ˆæ¥è¿‘å‡åŒ€å¹³å‡ï¼‰ï¼Œæ‰€ä»¥$\beta_2$åº”è¯¥è¦å¾ˆæ¥è¿‘äº1ï¼›è€ŒåŠ¨é‡$\hat{\boldsymbol{m}}_t$æ˜¯æ¢¯åº¦çš„æ»‘åŠ¨å¹³å‡ï¼Œå¦‚æœæ¢¯åº¦çš„å¹³å‡è¿‡äºé•¿æœŸçš„è¯ï¼Œé‚£ä¹ˆç»“æœå°†ä¼šæ¥è¿‘$\boldsymbol{g}</em>$ï¼Œè¿™åè€Œä¸å¥½ï¼Œå› æ­¤åŠ¨é‡çš„æ»‘åŠ¨å¹³å‡è¦æ›´å±€éƒ¨äº›ã€‚}^*}=\boldsymbol{0</p>
<h2 id="_3">ç›¸å…³å·¥ä½œ</h2>
<p>å¯¹äºæ¯”è¾ƒäº†è§£HessiançŸ©é˜µç†è®ºçš„è¯»è€…ï¼Œçœ‹åˆ°ä¸Šè¿°ç»“è®ºåçš„ç¬¬ä¸€ååº”ä¹Ÿè®¸ä¸æ˜¯ç†Ÿæ‚‰è€Œæ˜¯ç–‘æƒ‘ï¼Œè¿™æ˜¯å› ä¸ºHessiançŸ©é˜µçš„ä¸€ä¸ªç»å…¸è¿‘ä¼¼æ˜¯JacobiçŸ©é˜µï¼ˆç±»ä¼¼æ¢¯åº¦ï¼‰çš„å¤–ç§¯ï¼Œè€Œè¿™é‡Œçš„Hessianè¿‘ä¼¼åˆ™æ˜¯æ¢¯åº¦å¤–ç§¯çš„å¹³æ–¹æ ¹ï¼Œä¸¤è€…å·®äº†ä¸ªæ ¹å·ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬ä»¥å¹³æ–¹è¯¯å·®æŸå¤±ä¸ºä¾‹<br />
\begin{equation}\mathcal{L}(\boldsymbol{\theta}) = \frac{1}{2}\mathbb{E}<em _boldsymbol_theta="\boldsymbol{\theta">{(\boldsymbol{x},\boldsymbol{y})\sim\mathcal{D}}[\Vert \boldsymbol{y} - \boldsymbol{f}</em>}}(\boldsymbol{x})\Vert^2]\label{eq:loss-2}\end{equation<br />
æˆ‘ä»¬åœ¨$\boldsymbol{\theta}<em _boldsymbol_theta="\boldsymbol{\theta">t$å¤„å±•å¼€ï¼Œæœ‰$\boldsymbol{f}</em>}}(\boldsymbol{x})\approx \boldsymbol{f<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}_t}(\boldsymbol{x}) + \boldsymbol{\mathcal{J}}</em><em _boldsymbol_theta="\boldsymbol{\theta">t}^{\top} (\boldsymbol{\theta} - \boldsymbol{\theta}_t)$ï¼Œå…¶ä¸­$\boldsymbol{\mathcal{J}}</em><em _boldsymbol_theta="\boldsymbol{\theta">t}=\nabla</em><em _boldsymbol_theta="\boldsymbol{\theta">t} \boldsymbol{f}</em><em _boldsymbol_x="(\boldsymbol{x">t}(\boldsymbol{x})$æ˜¯JacobiçŸ©é˜µï¼Œä»£å…¥ä¸Šå¼å¾—åˆ°<br />
\begin{equation}\mathcal{L}(\boldsymbol{\theta}) \approx \frac{1}{2}\mathbb{E}</em>},\boldsymbol{y})\sim\mathcal{D}}[\Vert \boldsymbol{y} - \boldsymbol{f<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}_t}(\boldsymbol{x}) - \boldsymbol{\mathcal{J}}</em><em _boldsymbol_theta="\boldsymbol{\theta">t}^{\top} (\boldsymbol{\theta} - \boldsymbol{\theta}_t)\Vert^2]\end{equation}<br />
ç»è¿‡ç®€åŒ–åçš„ä¸Šå¼åªæ˜¯å…³äº$\boldsymbol{\theta}$çš„äºŒæ¬¡å‹ï¼Œå› æ­¤å¯ä»¥ç›´æ¥å†™å‡ºå®ƒçš„HessiançŸ©é˜µï¼Œç»“æœæ˜¯<br />
\begin{equation}\boldsymbol{\mathcal{H}}</em><em _boldsymbol_x="(\boldsymbol{x">t} \approx \mathbb{E}</em>},\boldsymbol{y})\sim\mathcal{D}}[\boldsymbol{\mathcal{J}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}_t}\boldsymbol{\mathcal{J}}</em><em _boldsymbol_theta="\boldsymbol{\theta">t}^{\top}]\end{equation}<br />
è¿™å°±æ˜¯åŸºäºJacobiçŸ©é˜µå¤–ç§¯çš„Hessianè¿‘ä¼¼ï¼Œå®ƒæ˜¯â€œ<a href="https://en.wikipedia.org/wiki/Gauss%E2%80%93Newton_algorithm">Gaussâ€“Newtonæ³•</a>â€çš„ç†è®ºåŸºç¡€ã€‚å½“ç„¶ï¼Œ$\boldsymbol{\mathcal{J}}$è¿˜ä¸æ˜¯$\boldsymbol{g}$ï¼Œæˆ‘ä»¬è¦è¯•å›¾å°†ç»“æœè·Ÿ$\mathcal{g}$è”ç³»èµ·æ¥ã€‚å¯¹å¼$\eqref{eq:loss-2}$ç›´æ¥æ±‚å¯¼å¾—<br />
\begin{equation}\boldsymbol{g}</em>}} = \mathbb{E<em _boldsymbol_theta="\boldsymbol{\theta">{(\boldsymbol{x},\boldsymbol{y})\sim\mathcal{D}}[\boldsymbol{\mathcal{J}}</em>}}(\boldsymbol{y} - \boldsymbol{f<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}(\boldsymbol{x}))]\end{equation}<br />
äºæ˜¯<br />
\begin{equation}\begin{aligned}<br />
\boldsymbol{g}</em>}} \boldsymbol{g<em _boldsymbol_x="(\boldsymbol{x">{\boldsymbol{\theta}}^{\top} =&amp;\, \big(\mathbb{E}</em>},\boldsymbol{y})\sim\mathcal{D}}[\boldsymbol{\mathcal{J}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}(\boldsymbol{y} - \boldsymbol{f}</em>}}(\boldsymbol{x}))]\big)\big(\mathbb{E<em _boldsymbol_theta="\boldsymbol{\theta">{(\boldsymbol{x},\boldsymbol{y})\sim\mathcal{D}}[\boldsymbol{\mathcal{J}}</em>}}(\boldsymbol{y} - \boldsymbol{f<em _boldsymbol_x="(\boldsymbol{x">{\boldsymbol{\theta}}(\boldsymbol{x}))]\big)^{\top} \\\[5pt]<br />
=&amp;\, \big(\mathbb{E}</em>},\boldsymbol{y})\sim\mathcal{D}}[\boldsymbol{\mathcal{J}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}(\boldsymbol{y} - \boldsymbol{f}</em>}}(\boldsymbol{x}))]\big)\big(\mathbb{E<em _boldsymbol_theta="\boldsymbol{\theta">{(\boldsymbol{x},\boldsymbol{y})\sim\mathcal{D}}[(\boldsymbol{y} - \boldsymbol{f}</em>}}(\boldsymbol{x}))^{\top}\boldsymbol{\mathcal{J}<em _boldsymbol_x="(\boldsymbol{x">{\boldsymbol{\theta}}^{\top}]\big) \\\[5pt]<br />
\approx&amp;\, \mathbb{E}</em>},\boldsymbol{y})\sim\mathcal{D}}\big[\boldsymbol{\mathcal{J}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}(\boldsymbol{y} - \boldsymbol{f}</em>}}(\boldsymbol{x}))(\boldsymbol{y} - \boldsymbol{f<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}(\boldsymbol{x}))^{\top}\boldsymbol{\mathcal{J}}</em>\big] \\\[5pt]}}^{\top<br />
\approx&amp;\, \mathbb{E}<em _boldsymbol_theta="\boldsymbol{\theta">{(\boldsymbol{x},\boldsymbol{y})\sim\mathcal{D}}\Big[\boldsymbol{\mathcal{J}}</em>}}\mathbb{E<em _boldsymbol_theta="\boldsymbol{\theta">{(\boldsymbol{x},\boldsymbol{y})\sim\mathcal{D}}\big[(\boldsymbol{y} - \boldsymbol{f}</em>}}(\boldsymbol{x}))(\boldsymbol{y} - \boldsymbol{f<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}(\boldsymbol{x}))^{\top}\big]\boldsymbol{\mathcal{J}}</em>\Big] \\\[5pt]}}^{\top<br />
\end{aligned}\end{equation}<br />
è¿™é‡Œä¸¤ä¸ªçº¦ç­‰å·å…¶å®æ²¡æœ‰å¤ªå¤šé“ç†ï¼Œå¯ä»¥å‹‰å¼ºçœ‹æˆæ˜¯å¹³å‡åœºè¿‘ä¼¼ï¼Œè€Œ$\boldsymbol{y} - \boldsymbol{f}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}(\boldsymbol{x})$æ˜¯å›å½’é¢„æµ‹çš„æ®‹å·®ï¼Œæˆ‘ä»¬é€šå¸¸å‡è®¾å®ƒæœä»$\mathcal{N}(\boldsymbol{0},\sigma^2\boldsymbol{I})$ï¼Œå› æ­¤æœ‰<br />
\begin{equation}\boldsymbol{g}</em>}} \boldsymbol{g<em _boldsymbol_x="(\boldsymbol{x">{\boldsymbol{\theta}}^{\top} \approx \sigma^2\mathbb{E}</em>},\boldsymbol{y})\sim\mathcal{D}}\big[\boldsymbol{\mathcal{J}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}\boldsymbol{\mathcal{J}}</em>}}^{\top}\big] \approx \sigma^2 \boldsymbol{\mathcal{H}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}_t}\label{eq:hessian-t}\end{equation}<br />
è¿™å°±æ­ç¤ºäº†$\boldsymbol{\mathcal{H}}</em><em _boldsymbol_theta="\boldsymbol{\theta">t}$ä¸$\boldsymbol{g}</em>$ï¼Œå¯ä»¥å‘ç°è¡¨é¢ä¸Šåˆšå¥½å·®äº†ä¸ªå¹³æ–¹ã€‚}} \boldsymbol{g}_{\boldsymbol{\theta}}^{\top}$çš„è”ç³»ã€‚å¯¹æ¯”ä¸Šä¸€èŠ‚çš„å¼$\eqref{eq:hessian-2</p>
<p>çœ‹æ¨å¯¼è¿‡ç¨‹ï¼Œä¸¤ä¸ªç»“æœä¼¼ä¹éƒ½æ²¡æ˜æ˜¾é”™è¯¯ï¼Œé‚£æ€ä¹ˆç†è§£è¿™ç§ä¸ä¸€è‡´æ€§å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥è¿™æ ·ç†è§£ï¼šå¼$\eqref{eq:hessian-t}$ç»™å‡ºçš„æ˜¯$t$æ—¶åˆ»çš„Hessianè¿‘ä¼¼ï¼Œå±äºâ€œç¬æ—¶è¿‘ä¼¼â€ï¼Œè€Œå¼$\eqref{eq:hessian-2}$åˆ™æ˜¯æ—¶é—´æ­¥çš„â€œé•¿æœŸå¹³å‡â€ç»“æœï¼Œé•¿æœŸçš„å¹³å‡ä½œç”¨æŠµé”€äº†ä¸€éƒ¨åˆ†å¼ºåº¦ï¼ˆä½†ç†è®ºä¸Šä¹Ÿä¼šä½¿å¾—ä¼°è®¡æ›´å‡†ç¡®ï¼‰ï¼Œä»è€Œéœ€è¦å¤šå¼€ä¸€ä¸ªå¹³æ–¹æ ¹ã€‚</p>
<p>ç±»ä¼¼çš„æ•ˆåº”ä¹Ÿå‡ºç°åœ¨<a href="/archives/9209">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆäº”ï¼‰ï¼šä¸€èˆ¬æ¡†æ¶ä¹‹SDEç¯‡ã€‹</a>ä»‹ç»çš„SDEä¸­ï¼ŒSDEçš„å™ªå£°é¡¹å¼ºåº¦éœ€è¦æ¯”éå™ªå£°é¡¹é«˜åŠé˜¶ï¼ŒåŒæ ·æ˜¯å› ä¸ºå™ªå£°é¡¹åœ¨é•¿æœŸå¹³å‡ä¹‹ä¸‹ä¼šæŠµæ¶ˆï¼Œæ‰€ä»¥å™ªå£°éœ€è¦æ›´é«˜é˜¶æ‰èƒ½åœ¨æœ€ç»ˆçš„ç»“æœä¸­ä½“ç°å‡ºå™ªå£°çš„ä½œç”¨ã€‚</p>
<h2 id="_4">æ›´å¤šè”ç³»</h2>
<p>åœ¨å‰é¢çš„æ¨å¯¼ä¸­ï¼Œæˆ‘ä»¬å‡è®¾äº†$\boldsymbol{\theta}^<em>$æ˜¯ç†è®ºæœ€ä¼˜ç‚¹ï¼Œä»è€Œæœ‰$\boldsymbol{g} _{\boldsymbol{\theta}^</em>} = \boldsymbol{0}$ã€‚å¦‚æœ$\boldsymbol{\theta}^<em>$æ˜¯ä»»æ„ä¸€ç‚¹å‘¢ï¼Ÿé‚£ä¹ˆå¼$\eqref{eq:hessian-2}$å°†å˜æˆ<br />
\begin{equation}\mathbb{E}[(\boldsymbol{g}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}-\boldsymbol{g} </em>^</em>})(\boldsymbol{g}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}-\boldsymbol{g} </em>^<em>})^{\top}] \approx \sigma^2\boldsymbol{\mathcal{H}}_{\boldsymbol{\theta}^</em>}\boldsymbol{\mathcal{H}}<em t-1="t-1">{\boldsymbol{\theta}^*}^{\top}\end{equation}<br />
ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªè¦æ»‘åŠ¨å¹³å‡çš„æ˜¯åæ–¹å·®è€Œä¸æ˜¯äºŒé˜¶çŸ©ï¼Œå°±å¯ä»¥å¾—åˆ°å±€éƒ¨èŒƒå›´å†…çš„Hessianè¿‘ä¼¼ã€‚è¿™æ­£å¥½è·Ÿ<a href="https://papers.cool/arxiv/2010.07468">AdaBeliefä¼˜åŒ–å™¨</a>çš„åšæ³•å¯¹åº”ä¸Šäº†ï¼Œå®ƒçš„$\boldsymbol{v}$æ»‘åŠ¨å¹³å‡çš„æ˜¯$\boldsymbol{g}$ä¸$\boldsymbol{m}$çš„å·®çš„å¹³æ–¹ï¼š<br />
\begin{equation}\text{AdaBelief}:=\left\{\begin{aligned}<br />
&amp;\boldsymbol{m}_t = \beta_1 \boldsymbol{m}</em>} + \left(1 - \beta_1\right) \boldsymbol{g<em t-1="t-1">t\\\<br />
&amp;\boldsymbol{v}_t = \beta_2 \boldsymbol{v}</em>} + \left(1 - \beta_2\right) (\boldsymbol{g<em t-1="t-1">t - \boldsymbol{m}_t)\odot(\boldsymbol{g}_t - \boldsymbol{m}_t)\\\<br />
&amp;\hat{\boldsymbol{m}}_t = \boldsymbol{m}_t\left/\left(1 - \beta_1^t\right)\right.\\\<br />
&amp;\hat{\boldsymbol{v}}_t = \boldsymbol{v}_t\left/\left(1 - \beta_2^t\right)\right.\\\<br />
&amp;\boldsymbol{\theta}_t = \boldsymbol{\theta}</em> + \epsilon\right)\right.} - \eta_t \hat{\boldsymbol{m}}_t\left/\left(\sqrt{\hat{\boldsymbol{v}}_t<br />
\end{aligned}\right.\end{equation}</p>
<h2 id="_5">æ–‡ç« å°ç»“</h2>
<p>æœ¬æ–‡ä»‹ç»äº†ä»Newtonæ³•å’ŒHessianè¿‘ä¼¼çœ‹å¾…Adamç­‰è‡ªé€‚åº”å­¦ä¹ ç‡ä¼˜åŒ–å™¨çš„ä¸€ä¸ªè§†è§’ï¼Œå¹¶è®¨è®ºäº†Hessianè¿‘ä¼¼çš„ç›¸å…³ç»“æœã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/10588">https://spaces.ac.cn/archives/10588</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Nov. 29, 2024). ã€Šä»Hessianè¿‘ä¼¼çœ‹è‡ªé€‚åº”å­¦ä¹ ç‡ä¼˜åŒ–å™¨ ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/10588">https://spaces.ac.cn/archives/10588</a></p>
<p>@online{kexuefm-10588,<br />
title={ä»Hessianè¿‘ä¼¼çœ‹è‡ªé€‚åº”å­¦ä¹ ç‡ä¼˜åŒ–å™¨},<br />
author={è‹å‰‘æ—},<br />
year={2024},<br />
month={Nov},<br />
url={\url{https://spaces.ac.cn/archives/10588}},<br />
} </p>
<hr />
<h2 id="_6">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</h2>
<h3 id="1-hessian">1. HessiançŸ©é˜µçš„å®šä¹‰å’Œä½œç”¨</h3>
<h4 id="11">1.1 åŸºæœ¬å®šä¹‰</h4>
<p>å¯¹äºæŸå¤±å‡½æ•°$\mathcal{L}(\boldsymbol{\theta}):\mathbb{R}^n\to\mathbb{R}$ï¼ŒHessiançŸ©é˜µå®šä¹‰ä¸ºï¼š</p>
<p>$$
\boldsymbol{\mathcal{H}}(\boldsymbol{\theta}) = \nabla^2_{\boldsymbol{\theta}}\mathcal{L}(\boldsymbol{\theta}) = \begin{bmatrix}
\frac{\partial^2 \mathcal{L}}{\partial \theta_1^2} & \frac{\partial^2 \mathcal{L}}{\partial \theta_1 \partial \theta_2} & \cdots & \frac{\partial^2 \mathcal{L}}{\partial \theta_1 \partial \theta_n} \\
\frac{\partial^2 \mathcal{L}}{\partial \theta_2 \partial \theta_1} & \frac{\partial^2 \mathcal{L}}{\partial \theta_2^2} & \cdots & \frac{\partial^2 \mathcal{L}}{\partial \theta_2 \partial \theta_n} \\
\vdots & \vdots & \ddots & \vdots \\
\frac{\partial^2 \mathcal{L}}{\partial \theta_n \partial \theta_1} & \frac{\partial^2 \mathcal{L}}{\partial \theta_n \partial \theta_2} & \cdots & \frac{\partial^2 \mathcal{L}}{\partial \theta_n^2}
\end{bmatrix}
$$</p>
<p><strong>æ€§è´¨</strong>ï¼šç”±Schwarzå®šç†ï¼Œåœ¨è¿ç»­å¯å¾®çš„æ¡ä»¶ä¸‹ï¼ŒHessiançŸ©é˜µæ˜¯å¯¹ç§°çŸ©é˜µï¼Œå³$\boldsymbol{\mathcal{H}}^{\top} = \boldsymbol{\mathcal{H}}$ã€‚</p>
<h4 id="12">1.2 å‡ ä½•æ„ä¹‰</h4>
<p>HessiançŸ©é˜µåˆ»ç”»äº†æŸå¤±å‡½æ•°åœ¨å‚æ•°ç©ºé—´ä¸­çš„æ›²ç‡ä¿¡æ¯ã€‚å¯¹äºäºŒæ¬¡å‡½æ•°$\mathcal{L}(\boldsymbol{\theta}) = \frac{1}{2}\boldsymbol{\theta}^{\top}\boldsymbol{A}\boldsymbol{\theta} + \boldsymbol{b}^{\top}\boldsymbol{\theta} + c$ï¼Œå…¶HessiançŸ©é˜µæ’ä¸º$\boldsymbol{\mathcal{H}} = \boldsymbol{A}$ã€‚</p>
<p><strong>æ­£å®šæ€§åˆ¤æ–­</strong>ï¼š
- è‹¥$\boldsymbol{\mathcal{H}} \succ 0$ï¼ˆæ­£å®šï¼‰ï¼Œåˆ™$\boldsymbol{\theta}$å¤„ä¸ºå±€éƒ¨æœ€å°å€¼
- è‹¥$\boldsymbol{\mathcal{H}} \prec 0$ï¼ˆè´Ÿå®šï¼‰ï¼Œåˆ™$\boldsymbol{\theta}$å¤„ä¸ºå±€éƒ¨æœ€å¤§å€¼
- è‹¥$\boldsymbol{\mathcal{H}}$ä¸å®šï¼Œåˆ™$\boldsymbol{\theta}$å¤„ä¸ºéç‚¹</p>
<h4 id="13">1.3 æ¡ä»¶æ•°ä¸ä¼˜åŒ–éš¾åº¦</h4>
<p>HessiançŸ©é˜µçš„æ¡ä»¶æ•°$\kappa(\boldsymbol{\mathcal{H}}) = \frac{\lambda_{\max}}{\lambda_{\min}}$å†³å®šäº†ä¼˜åŒ–çš„éš¾åº¦ï¼Œå…¶ä¸­$\lambda_{\max}$å’Œ$\lambda_{\min}$åˆ†åˆ«æ˜¯æœ€å¤§å’Œæœ€å°ç‰¹å¾å€¼ã€‚æ¡ä»¶æ•°è¶Šå¤§ï¼Œä¼˜åŒ–è¶Šå›°éš¾ã€‚</p>
<p>å¯¹äºæ¢¯åº¦ä¸‹é™æ³•ï¼Œæ”¶æ•›é€Ÿåº¦å—æ§äºï¼š
$$
\|\boldsymbol{\theta}_{t+1} - \boldsymbol{\theta}^*\| \leq \left(\frac{\kappa - 1}{\kappa + 1}\right)\|\boldsymbol{\theta}_t - \boldsymbol{\theta}^*\|
$$</p>
<p>å½“$\kappa \gg 1$æ—¶ï¼Œæ”¶æ•›é€Ÿåº¦ææ…¢ã€‚è¿™æ­£æ˜¯äºŒé˜¶æ–¹æ³•çš„ä¼˜åŠ¿æ‰€åœ¨â€”â€”é€šè¿‡$\boldsymbol{\mathcal{H}}^{-1}$é¢„æ¡ä»¶åŒ–å¯ä»¥æ”¹å–„æ¡ä»¶æ•°ã€‚</p>
<h3 id="2">2. ç‰›é¡¿æ³•çš„å®Œæ•´æ¨å¯¼</h3>
<h4 id="21">2.1 æ³°å‹’å±•å¼€ä¸äºŒé˜¶è¿‘ä¼¼</h4>
<p>åœ¨$\boldsymbol{\theta}_t$å¤„å¯¹$\mathcal{L}(\boldsymbol{\theta})$è¿›è¡ŒäºŒé˜¶æ³°å‹’å±•å¼€ï¼š</p>
<p>$$
\mathcal{L}(\boldsymbol{\theta}) = \mathcal{L}(\boldsymbol{\theta}_t) + \nabla\mathcal{L}(\boldsymbol{\theta}_t)^{\top}(\boldsymbol{\theta} - \boldsymbol{\theta}_t) + \frac{1}{2}(\boldsymbol{\theta} - \boldsymbol{\theta}_t)^{\top}\boldsymbol{\mathcal{H}}_t(\boldsymbol{\theta} - \boldsymbol{\theta}_t) + O(\|\boldsymbol{\theta} - \boldsymbol{\theta}_t\|^3)
$$</p>
<p>å¿½ç•¥é«˜é˜¶é¡¹ï¼Œå®šä¹‰äºŒé˜¶è¿‘ä¼¼ï¼š
$$
\tilde{\mathcal{L}}(\boldsymbol{\theta}) = \mathcal{L}(\boldsymbol{\theta}_t) + \boldsymbol{g}_t^{\top}(\boldsymbol{\theta} - \boldsymbol{\theta}_t) + \frac{1}{2}(\boldsymbol{\theta} - \boldsymbol{\theta}_t)^{\top}\boldsymbol{\mathcal{H}}_t(\boldsymbol{\theta} - \boldsymbol{\theta}_t)
$$</p>
<h4 id="22">2.2 æœ€ä¼˜æ­¥é•¿çš„å¯¼å‡º</h4>
<p>å¯¹$\tilde{\mathcal{L}}(\boldsymbol{\theta})$å…³äº$\boldsymbol{\theta}$æ±‚å¯¼ï¼š
$$
\frac{\partial \tilde{\mathcal{L}}}{\partial \boldsymbol{\theta}} = \boldsymbol{g}_t + \boldsymbol{\mathcal{H}}_t(\boldsymbol{\theta} - \boldsymbol{\theta}_t)
$$</p>
<p>ä»¤å¯¼æ•°ä¸ºé›¶ï¼Œå¾—åˆ°ï¼š
$$
\boldsymbol{g}_t + \boldsymbol{\mathcal{H}}_t(\boldsymbol{\theta}_{t+1} - \boldsymbol{\theta}_t) = \boldsymbol{0}
$$</p>
<p>è§£å¾—ç‰›é¡¿æ›´æ–°è§„åˆ™ï¼š
$$
\boldsymbol{\theta}_{t+1} = \boldsymbol{\theta}_t - \boldsymbol{\mathcal{H}}_t^{-1}\boldsymbol{g}_t
$$</p>
<h4 id="23">2.3 æ”¶æ•›æ€§åˆ†æ</h4>
<p><strong>å®šç†ï¼ˆç‰›é¡¿æ³•å±€éƒ¨äºŒæ¬¡æ”¶æ•›ï¼‰</strong>ï¼šå‡è®¾$\boldsymbol{\mathcal{H}}$åœ¨$\boldsymbol{\theta}^<em>$çš„é‚»åŸŸå†…Lipschitzè¿ç»­ï¼Œä¸”$\boldsymbol{\mathcal{H}}(\boldsymbol{\theta}^</em>) \succ 0$ï¼Œåˆ™å­˜åœ¨$\delta &gt; 0$ï¼Œå½“$|\boldsymbol{\theta}_0 - \boldsymbol{\theta}^*| &lt; \delta$æ—¶ï¼Œç‰›é¡¿æ³•äºŒæ¬¡æ”¶æ•›ï¼š</p>
<p>$$
\|\boldsymbol{\theta}_{t+1} - \boldsymbol{\theta}^*\| \leq C\|\boldsymbol{\theta}_t - \boldsymbol{\theta}^*\|^2
$$</p>
<p><strong>è¯æ˜æ€è·¯</strong>ï¼šåœ¨æœ€ä¼˜ç‚¹$\boldsymbol{\theta}^<em>$å¤„ï¼Œ$\boldsymbol{g}^</em> = \boldsymbol{0}$ã€‚å¯¹æ¢¯åº¦åœ¨$\boldsymbol{\theta}^*$å¤„æ³°å‹’å±•å¼€ï¼š
$$
\boldsymbol{g}_t = \boldsymbol{g}^* + \boldsymbol{\mathcal{H}}^*(\boldsymbol{\theta}_t - \boldsymbol{\theta}^*) + O(\|\boldsymbol{\theta}_t - \boldsymbol{\theta}^*\|^2) = \boldsymbol{\mathcal{H}}^*(\boldsymbol{\theta}_t - \boldsymbol{\theta}^*) + O(\|\boldsymbol{\theta}_t - \boldsymbol{\theta}^*\|^2)
$$</p>
<p>ä»£å…¥ç‰›é¡¿æ›´æ–°ï¼š
$$
\boldsymbol{\theta}_{t+1} - \boldsymbol{\theta}^* = \boldsymbol{\theta}_t - \boldsymbol{\theta}^* - \boldsymbol{\mathcal{H}}_t^{-1}\boldsymbol{g}_t = \boldsymbol{\mathcal{H}}_t^{-1}(\boldsymbol{\mathcal{H}}_t - \boldsymbol{\mathcal{H}}^*)(\boldsymbol{\theta}_t - \boldsymbol{\theta}^*) + O(\|\boldsymbol{\theta}_t - \boldsymbol{\theta}^*\|^2)
$$</p>
<p>ç”±Lipschitzè¿ç»­æ€§ï¼Œ$|\boldsymbol{\mathcal{H}}_t - \boldsymbol{\mathcal{H}}^<em>| \leq L|\boldsymbol{\theta}_t - \boldsymbol{\theta}^</em>|$ï¼Œå› æ­¤ï¼š
$$
\|\boldsymbol{\theta}_{t+1} - \boldsymbol{\theta}^*\| \leq C\|\boldsymbol{\theta}_t - \boldsymbol{\theta}^*\|^2
$$</p>
<h4 id="24">2.4 ç‰›é¡¿æ³•çš„è®¡ç®—å¤æ‚åº¦æŒ‘æˆ˜</h4>
<p>å¯¹äº$n$ç»´å‚æ•°ï¼š
- <strong>è®¡ç®—HessiançŸ©é˜µ</strong>ï¼š$O(n^2)$å­˜å‚¨ï¼Œ$O(n^2)$æˆ–$O(n^3)$è®¡ç®—ï¼ˆå–å†³äºå®ç°ï¼‰
- <strong>æ±‚é€†æˆ–æ±‚è§£çº¿æ€§ç³»ç»Ÿ</strong>ï¼š$O(n^3)$ï¼ˆå¦‚Choleskyåˆ†è§£ï¼‰
- <strong>æ¯æ­¥æ€»å¤æ‚åº¦</strong>ï¼š$O(n^3)$</p>
<p>åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œ$n$é€šå¸¸ä¸º$10^6 \sim 10^{10}$ï¼Œè¿™ä½¿å¾—å®Œæ•´çš„ç‰›é¡¿æ³•ä¸å¯è¡Œã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦Hessianè¿‘ä¼¼æ–¹æ³•ã€‚</p>
<h3 id="3">3. è‡ªé€‚åº”å­¦ä¹ ç‡çš„ç†è®ºåŸºç¡€</h3>
<h4 id="31">3.1 é¢„æ¡ä»¶åŒ–æ¢¯åº¦ä¸‹é™</h4>
<p>é¢„æ¡ä»¶åŒ–çš„æ€æƒ³æ˜¯é€šè¿‡çŸ©é˜µ$\boldsymbol{P}_t$å˜æ¢æ¢¯åº¦ï¼š
$$
\boldsymbol{\theta}_{t+1} = \boldsymbol{\theta}_t - \eta_t \boldsymbol{P}_t^{-1}\boldsymbol{g}_t
$$</p>
<p><strong>æœ€ä¼˜é¢„æ¡ä»¶å™¨</strong>ï¼šä»ç‰›é¡¿æ³•çš„è§’åº¦ï¼Œæœ€ä¼˜çš„é¢„æ¡ä»¶å™¨æ˜¯$\boldsymbol{P}_t = \boldsymbol{\mathcal{H}}_t$ã€‚</p>
<h4 id="32">3.2 å¯¹è§’è¿‘ä¼¼çš„åˆç†æ€§</h4>
<p>å‡è®¾å‚æ•°ä¹‹é—´çš„äºŒé˜¶ç›¸äº’ä½œç”¨è¾ƒå¼±ï¼Œå³HessiançŸ©é˜µè¿‘ä¼¼å¯¹è§’ï¼š
$$
\boldsymbol{\mathcal{H}} \approx \text{diag}(h_1, h_2, \ldots, h_n)
$$</p>
<p>æ­¤æ—¶ï¼Œä¸åŒå‚æ•°çš„æœ€ä¼˜å­¦ä¹ ç‡åº”è¯¥ä¸åŒï¼š
$$
\theta_{i,t+1} = \theta_{i,t} - \frac{\eta_t}{h_i}g_{i,t}
$$</p>
<p>è¿™æ­£æ˜¯è‡ªé€‚åº”å­¦ä¹ ç‡çš„æ ¸å¿ƒæ€æƒ³â€”â€”ä¸ºæ¯ä¸ªå‚æ•°åˆ†é…ä¸åŒçš„æœ‰æ•ˆå­¦ä¹ ç‡$\frac{\eta_t}{h_i}$ã€‚</p>
<h4 id="33">3.3 æ›²ç‡è‡ªé€‚åº”çš„å¿…è¦æ€§</h4>
<p>è€ƒè™‘ä¸€ä¸ªç®€å•çš„äºŒç»´äºŒæ¬¡å‡½æ•°ï¼š
$$
\mathcal{L}(\theta_1, \theta_2) = \frac{1}{2}(a\theta_1^2 + b\theta_2^2), \quad a \gg b
$$</p>
<p>å…¶HessiançŸ©é˜µä¸º$\boldsymbol{\mathcal{H}} = \text{diag}(a, b)$ã€‚ä½¿ç”¨ç»Ÿä¸€å­¦ä¹ ç‡$\eta$çš„SGDï¼š
$$
\theta_{1,t+1} = \theta_{1,t} - \eta a\theta_{1,t}, \quad \theta_{2,t+1} = \theta_{2,t} - \eta b\theta_{2,t}
$$</p>
<p>ä¸ºäº†ä¿è¯$\theta_1$æ–¹å‘æ”¶æ•›ï¼Œéœ€è¦$\eta &lt; \frac{2}{a}$ï¼›ä½†è¿™ä¼šå¯¼è‡´$\theta_2$æ–¹å‘æ”¶æ•›ææ…¢ï¼ˆå› ä¸º$b \ll a$ï¼‰ã€‚</p>
<p>è‹¥ä½¿ç”¨è‡ªé€‚åº”å­¦ä¹ ç‡$\eta_i = \frac{\eta}{h_i}$ï¼Œåˆ™ï¼š
$$
\theta_{1,t+1} = \theta_{1,t} - \frac{\eta}{a} a\theta_{1,t} = (1-\eta)\theta_{1,t}
$$
$$
\theta_{2,t+1} = \theta_{2,t} - \frac{\eta}{b} b\theta_{2,t} = (1-\eta)\theta_{2,t}
$$</p>
<p>ä¸¤ä¸ªæ–¹å‘ä»¥ç›¸åŒé€Ÿåº¦æ”¶æ•›ï¼Œè§£å†³äº†æ¡ä»¶æ•°é—®é¢˜ã€‚</p>
<h3 id="4-adamhessian">4. Adamä½œä¸ºå¯¹è§’Hessianè¿‘ä¼¼</h3>
<h4 id="41-hessian">4.1 ä»æ¢¯åº¦æ–¹å·®åˆ°Hessianå¹³æ–¹</h4>
<p>å›é¡¾æ­£æ–‡ä¸­çš„æ ¸å¿ƒæ¨å¯¼ã€‚å‡è®¾åœ¨æœ€ä¼˜ç‚¹$\boldsymbol{\theta}^*$é™„è¿‘ï¼Œæ¢¯åº¦å¯ä»¥çº¿æ€§è¿‘ä¼¼ï¼š
$$
\boldsymbol{g}_{\boldsymbol{\theta}} \approx \boldsymbol{\mathcal{H}}_{\boldsymbol{\theta}^*}(\boldsymbol{\theta} - \boldsymbol{\theta}^*)
$$</p>
<p>å½“$\boldsymbol{\theta} - \boldsymbol{\theta}^* \sim \mathcal{N}(\boldsymbol{0}, \sigma^2\boldsymbol{I})$æ—¶ï¼š
$$
\mathbb{E}[\boldsymbol{g}_{\boldsymbol{\theta}}\boldsymbol{g}_{\boldsymbol{\theta}}^{\top}] = \boldsymbol{\mathcal{H}}_{\boldsymbol{\theta}^*}\mathbb{E}[(\boldsymbol{\theta} - \boldsymbol{\theta}^*)(\boldsymbol{\theta} - \boldsymbol{\theta}^*)^{\top}]\boldsymbol{\mathcal{H}}_{\boldsymbol{\theta}^*}^{\top} = \sigma^2\boldsymbol{\mathcal{H}}_{\boldsymbol{\theta}^*}^2
$$</p>
<p><strong>å¯¹è§’åŒ–</strong>ï¼šå‡è®¾$\boldsymbol{\mathcal{H}}$å¯¹è§’ï¼Œåˆ™ï¼š
$$
\text{diag}(\mathbb{E}[\boldsymbol{g} \odot \boldsymbol{g}]) = \sigma^2 \text{diag}(\boldsymbol{\mathcal{H}}^2) = \sigma^2 \boldsymbol{h}^2
$$</p>
<p>å…¶ä¸­$\boldsymbol{h} = (h_1, h_2, \ldots, h_n)^{\top}$æ˜¯Hessiançš„å¯¹è§’å…ƒç´ ã€‚è§£å¾—ï¼š
$$
h_i = \frac{1}{\sigma}\sqrt{\mathbb{E}[g_i^2]}
$$</p>
<h4 id="42-adam">4.2 Adamçš„æ»‘åŠ¨å¹³å‡ä¼°è®¡</h4>
<p>Adamé€šè¿‡æŒ‡æ•°ç§»åŠ¨å¹³å‡ï¼ˆEMAï¼‰ä¼°è®¡$\mathbb{E}[g_i^2]$ï¼š
$$
v_{i,t} = \beta_2 v_{i,t-1} + (1-\beta_2)g_{i,t}^2
$$</p>
<p>å±•å¼€é€’å½’å…³ç³»ï¼š
$$
v_{i,t} = (1-\beta_2)\sum_{k=1}^{t}\beta_2^{t-k}g_{i,k}^2
$$</p>
<p>è¿™æ˜¯ä¸€ä¸ªæŒ‡æ•°åŠ æƒå¹³å‡ï¼Œæœ‰æ•ˆçª—å£å¤§å°çº¦ä¸º$\frac{1}{1-\beta_2}$ã€‚å½“$\beta_2 = 0.999$æ—¶ï¼Œæœ‰æ•ˆçª—å£çº¦ä¸º1000æ­¥ã€‚</p>
<p><strong>åå·®ä¿®æ­£</strong>ï¼šåˆå§‹æ—¶$v_{i,t}$è¢«ä½ä¼°ï¼ˆå› ä¸º$v_{i,0} = 0$ï¼‰ã€‚åå·®ä¿®æ­£ï¼š
$$
\hat{v}_{i,t} = \frac{v_{i,t}}{1-\beta_2^t}
$$</p>
<p>å¯ä»¥è¯æ˜ï¼Œå½“$g_{i,k}$æœä»ç¨³æ€åˆ†å¸ƒæ—¶ï¼Œ$\mathbb{E}[\hat{v}_{i,t}] \approx \mathbb{E}[g_i^2]$ã€‚</p>
<h4 id="43-adamhessian">4.3 Adamæ›´æ–°çš„Hessianè§£é‡Š</h4>
<p>ç»“åˆä»¥ä¸Šåˆ†æï¼ŒAdamçš„æ›´æ–°å¯ä»¥å†™æˆï¼š
$$
\boldsymbol{\theta}_{t+1} = \boldsymbol{\theta}_t - \eta_t \hat{\boldsymbol{\mathcal{H}}}_t^{-1}\hat{\boldsymbol{m}}_t
$$</p>
<p>å…¶ä¸­è¿‘ä¼¼Hessianä¸ºï¼š
$$
\hat{\boldsymbol{\mathcal{H}}}_t = \frac{1}{\eta_t\sigma}\text{diag}(\sqrt{\hat{\boldsymbol{v}}_t} + \epsilon)
$$</p>
<p><strong>$\epsilon$çš„ä½œç”¨</strong>ï¼š
1. æ•°å€¼ç¨³å®šæ€§ï¼šé˜²æ­¢é™¤é›¶
2. æ­£åˆ™åŒ–ï¼šç›¸å½“äºæ·»åŠ äº†$\frac{\epsilon}{\eta_t\sigma}$çš„å…ˆéªŒåˆ°Hessianå¯¹è§’å…ƒç´ 
3. æœ‰æ•ˆå­¦ä¹ ç‡ä¸‹ç•Œï¼šç¡®ä¿$\frac{\eta_t}{\sqrt{v_{i,t}}+\epsilon} \geq \frac{\eta_t}{\epsilon}$</p>
<h4 id="44">4.4 åŠ¨é‡é¡¹çš„ä½œç”¨</h4>
<p>Adamçš„åŠ¨é‡$\hat{\boldsymbol{m}}_t$æ˜¯æ¢¯åº¦çš„æŒ‡æ•°ç§»åŠ¨å¹³å‡ï¼š
$$
\hat{m}_{i,t} = \frac{\sum_{k=1}^{t}\beta_1^{t-k}(1-\beta_1)g_{i,k}}{1-\beta_1^t}
$$</p>
<p>ä»Hessianè§’åº¦ç†è§£ï¼ŒåŠ¨é‡è¿‘ä¼¼äºåœ¨æ»‘åŠ¨çª—å£å†…å¯¹æ¢¯åº¦æ±‚å¹³å‡ï¼Œè¿™ç›¸å½“äºåœ¨$\boldsymbol{\theta}$çš„å±€éƒ¨é‚»åŸŸå†…ç§¯åˆ†æ¢¯åº¦ä¿¡æ¯ã€‚å¦‚æœçª—å£è¿‡é•¿ï¼ˆ$\beta_1$æ¥è¿‘1ï¼‰ï¼Œåˆ™ï¼š
$$
\lim_{\beta_1 \to 1}\hat{m}_{i,t} \approx \mathbb{E}_{\boldsymbol{\theta} \sim \mathcal{N}(\boldsymbol{\theta}^*, \sigma^2\boldsymbol{I})}[g_i] = 0
$$</p>
<p>è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆ$\beta_1 &lt; \beta_2$ï¼šåŠ¨é‡éœ€è¦å±€éƒ¨ä¿¡æ¯ï¼Œè€ŒHessianä¼°è®¡éœ€è¦é•¿æœŸç»Ÿè®¡ã€‚</p>
<h3 id="5-adagradhessian">5. AdaGradçš„Hessianè§£é‡Š</h3>
<h4 id="51-adagrad">5.1 AdaGradç®—æ³•</h4>
<p>AdaGradç´¯ç§¯å†å²æ¢¯åº¦çš„å¹³æ–¹å’Œï¼š
$$
G_{i,t} = \sum_{k=1}^{t}g_{i,k}^2
$$</p>
<p>æ›´æ–°è§„åˆ™ï¼š
$$
\theta_{i,t+1} = \theta_{i,t} - \frac{\eta}{\sqrt{G_{i,t}} + \epsilon}g_{i,t}
$$</p>
<h4 id="52-hessian">5.2 å‡åŒ€å¹³å‡çš„Hessianä¼°è®¡</h4>
<p>AdaGradç›¸å½“äºå¯¹æ¢¯åº¦å¹³æ–¹è¿›è¡Œå‡åŒ€å¹³å‡ï¼ˆè€ŒéæŒ‡æ•°åŠ æƒï¼‰ï¼š
$$
\bar{g}_{i,t}^2 = \frac{1}{t}\sum_{k=1}^{t}g_{i,k}^2 \approx \mathbb{E}[g_i^2]
$$</p>
<p>å› æ­¤$G_{i,t} \approx t\mathbb{E}[g_i^2]$ï¼Œæœ‰æ•ˆå­¦ä¹ ç‡ä¸ºï¼š
$$
\eta_{i,t}^{\text{eff}} = \frac{\eta}{\sqrt{t\mathbb{E}[g_i^2]}} \propto \frac{1}{\sqrt{t}}
$$</p>
<p>è¿™æ˜¯AdaGradå­¦ä¹ ç‡è¡°å‡çš„æ ¹æºã€‚</p>
<h4 id="53-hessian">5.3 å¯¹è§’Hessianè¿‘ä¼¼</h4>
<p>ç±»æ¯”Adamçš„åˆ†æï¼ŒAdaGradéšå¼å‡è®¾ï¼š
$$
h_i \approx \frac{1}{\sigma}\sqrt{\frac{G_{i,t}}{t}} = \frac{1}{\sigma}\sqrt{\mathbb{E}[g_i^2]}
$$</p>
<p><strong>ä¸Adamçš„å¯¹æ¯”</strong>ï¼š
- Adamä½¿ç”¨æŒ‡æ•°ç§»åŠ¨å¹³å‡ï¼Œå¯ä»¥é€‚åº”éå¹³ç¨³åˆ†å¸ƒ
- AdaGradä½¿ç”¨ç´¯ç§¯å¹³å‡ï¼Œé€‚åˆå¹³ç¨³åˆ†å¸ƒä½†å­¦ä¹ ç‡å•è°ƒé€’å‡</p>
<h4 id="54">5.4 ç¨€ç–æ¢¯åº¦åœºæ™¯</h4>
<p>AdaGradåœ¨ç¨€ç–æ¢¯åº¦åœºæ™¯ä¸‹è¡¨ç°ä¼˜å¼‚ã€‚å‡è®¾ç¬¬$i$ä¸ªå‚æ•°çš„æ¢¯åº¦åªåœ¨ä¸€å°éƒ¨åˆ†æ­¥éª¤éé›¶ï¼š
$$
g_{i,k} = \begin{cases}
\bar{g}_i, & k \in S_i \\
0, & k \notin S_i
\end{cases}
$$</p>
<p>å…¶ä¸­$|S_i| = s \ll t$ã€‚æ­¤æ—¶ï¼š
$$
G_{i,t} = s\bar{g}_i^2, \quad \eta_{i,t}^{\text{eff}} = \frac{\eta}{\sqrt{s}\bar{g}_i}
$$</p>
<p>ç¨€ç–å‚æ•°è·å¾—æ›´å¤§çš„æœ‰æ•ˆå­¦ä¹ ç‡ï¼ˆå› ä¸º$s$å°ï¼‰ï¼Œè¿™æ­£æ˜¯NLPå’Œæ¨èç³»ç»Ÿéœ€è¦çš„ç‰¹æ€§ã€‚</p>
<h3 id="6-rmsprop">6. RMSPropçš„æ”¹è¿›æœºåˆ¶</h3>
<h4 id="61-rmsprop">6.1 RMSPropç®—æ³•</h4>
<p>RMSPropé€šè¿‡æŒ‡æ•°ç§»åŠ¨å¹³å‡è§£å†³AdaGradå­¦ä¹ ç‡å•è°ƒé€’å‡çš„é—®é¢˜ï¼š
$$
v_{i,t} = \beta v_{i,t-1} + (1-\beta)g_{i,t}^2
$$
$$
\theta_{i,t+1} = \theta_{i,t} - \frac{\eta}{\sqrt{v_{i,t}} + \epsilon}g_{i,t}
$$</p>
<p>é€šå¸¸$\beta = 0.9$æˆ–$0.99$ã€‚</p>
<h4 id="62-hessian">6.2 éå¹³ç¨³Hessianè¿½è¸ª</h4>
<p>åœ¨éå¹³ç¨³ä¼˜åŒ–é—®é¢˜ä¸­ï¼ŒHessiançŸ©é˜µéšæ—¶é—´å˜åŒ–ï¼š$\boldsymbol{\mathcal{H}}<em t_="t'">t \neq \boldsymbol{\mathcal{H}}</em>$ã€‚AdaGradçš„ç´¯ç§¯å¹³å‡æ— æ³•é€‚åº”è¿™ç§å˜åŒ–ï¼Œè€ŒRMSPropçš„æŒ‡æ•°åŠ æƒå¹³å‡ç»™äºˆè¿‘æœŸæ¢¯åº¦æ›´é«˜æƒé‡ï¼š
$$
v_{i,t} \approx \frac{1-\beta}{1-\beta^t}\sum_{k=1}^{t}\beta^{t-k}g_{i,k}^2 \approx \mathbb{E}_{\text{recent}}[g_i^2]
$$</p>
<p><strong>è¿½è¸ªèƒ½åŠ›åˆ†æ</strong>ï¼šå‡è®¾Hessianåœ¨$t_0$æ—¶åˆ»å‘ç”Ÿçªå˜ï¼Œä»$h_i^{\text{old}}$å˜ä¸º$h_i^{\text{new}}$ã€‚å®šä¹‰è¿½è¸ªè¯¯å·®ï¼š
$$
\varepsilon_t = |v_{i,t} - (h_i^{\text{new}})^2\sigma^2|
$$</p>
<p>å¯ä»¥è¯æ˜ï¼š
$$
\varepsilon_t \leq \beta^{t-t_0}\varepsilon_{t_0}
$$</p>
<p>è¿½è¸ªæ—¶é—´å¸¸æ•°$\tau = \frac{1}{1-\beta}$ã€‚å¯¹äº$\beta = 0.9$ï¼Œ$\tau = 10$æ­¥ï¼›$\beta = 0.99$æ—¶ï¼Œ$\tau = 100$æ­¥ã€‚</p>
<h4 id="63-adam">6.3 ä¸Adamçš„å…³ç³»</h4>
<p>Adamå¯ä»¥çœ‹ä½œRMSProp + åŠ¨é‡ï¼š
- RMSPropï¼š$\boldsymbol{\theta}<em t_1="t+1">{t+1} = \boldsymbol{\theta}_t - \frac{\eta}{\sqrt{v_t}+\epsilon}g_t$
- Adamï¼š$\boldsymbol{\theta}</em>m_t$} = \boldsymbol{\theta}_t - \frac{\eta}{\sqrt{v_t}+\epsilon</p>
<p>åŠ¨é‡$m_t$é™ä½äº†æ¢¯åº¦å™ªå£°çš„æ–¹å·®ã€‚è®¾$\text{Var}[g_t] = \sigma_g^2$ï¼Œåˆ™ï¼š
$$
\text{Var}[m_t] \approx \frac{1-\beta_1}{1+\beta_1}\sigma_g^2 < \sigma_g^2
$$</p>
<p>è¿™ä½¿å¾—Adamåœ¨å™ªå£°ç¯å¢ƒä¸‹æ›´ç¨³å®šã€‚</p>
<h3 id="7-fisher">7. è‡ªç„¶æ¢¯åº¦ä¸Fisherä¿¡æ¯çŸ©é˜µ</h3>
<h4 id="71">7.1 è‡ªç„¶æ¢¯åº¦çš„åŠ¨æœº</h4>
<p>æ™®é€šæ¢¯åº¦ä¸‹é™åœ¨å‚æ•°ç©ºé—´ä¸­æ²¿ç€æ¬§å‡ é‡Œå¾—æ¢¯åº¦æ–¹å‘ç§»åŠ¨ã€‚ä½†å‚æ•°ç©ºé—´çš„æ¬§å‡ é‡Œå¾—åº¦é‡ä¸ä¸€å®šåæ˜ æ¨¡å‹è¾“å‡ºç©ºé—´çš„çœŸå®è·ç¦»ã€‚</p>
<p><strong>ä¾‹å­</strong>ï¼šè€ƒè™‘ä¸¤ç»„å‚æ•°$\boldsymbol{\theta}_1$å’Œ$\boldsymbol{\theta}_2$ï¼Œå®ƒä»¬åœ¨å‚æ•°ç©ºé—´ä¸­è·ç¦»ç›¸åŒï¼ˆ$|\boldsymbol{\theta}_1 - \boldsymbol{\theta}_0| = |\boldsymbol{\theta}_2 - \boldsymbol{\theta}_0|$ï¼‰ï¼Œä½†å¯èƒ½å¯¼è‡´æ¨¡å‹è¾“å‡ºåˆ†å¸ƒçš„å·®å¼‚å¾ˆå¤§ã€‚</p>
<h4 id="72-fisher">7.2 Fisherä¿¡æ¯çŸ©é˜µ</h4>
<p>å¯¹äºæ¦‚ç‡æ¨¡å‹$p(\boldsymbol{y}|\boldsymbol{x}; \boldsymbol{\theta})$ï¼ŒFisherä¿¡æ¯çŸ©é˜µå®šä¹‰ä¸ºï¼š
$$
\boldsymbol{F}(\boldsymbol{\theta}) = \mathbb{E}_{(\boldsymbol{x},\boldsymbol{y})\sim p_{\text{data}}}\mathbb{E}_{\boldsymbol{y}'\sim p(\cdot|\boldsymbol{x};\boldsymbol{\theta})}\left[\nabla_{\boldsymbol{\theta}}\log p(\boldsymbol{y}'|\boldsymbol{x};\boldsymbol{\theta})\nabla_{\boldsymbol{\theta}}\log p(\boldsymbol{y}'|\boldsymbol{x};\boldsymbol{\theta})^{\top}\right]
$$</p>
<p>Fisherä¿¡æ¯çŸ©é˜µåº¦é‡äº†å‚æ•°å˜åŒ–å¯¹æ¨¡å‹è¾“å‡ºåˆ†å¸ƒçš„å½±å“ï¼Œæ˜¯å‚æ•°ç©ºé—´çš„<strong>é»æ›¼åº¦é‡</strong>ã€‚</p>
<h4 id="73">7.3 è‡ªç„¶æ¢¯åº¦å®šä¹‰</h4>
<p>è‡ªç„¶æ¢¯åº¦æ˜¯åœ¨Fisheråº¦é‡ä¸‹çš„æœ€é€Ÿä¸‹é™æ–¹å‘ï¼š
$$
\tilde{\boldsymbol{g}}_t = \boldsymbol{F}_t^{-1}\boldsymbol{g}_t
$$</p>
<p>æ›´æ–°è§„åˆ™ï¼š
$$
\boldsymbol{\theta}_{t+1} = \boldsymbol{\theta}_t - \eta_t \boldsymbol{F}_t^{-1}\boldsymbol{g}_t
$$</p>
<p><strong>å‡ ä½•è§£é‡Š</strong>ï¼šè‡ªç„¶æ¢¯åº¦åœ¨KLæ•£åº¦æ„ä¹‰ä¸‹æ‰¾åˆ°æœ€ä¼˜æ›´æ–°æ–¹å‘ã€‚å¯¹äºçº¦æŸä¼˜åŒ–é—®é¢˜ï¼š
$$
\min_{\boldsymbol{\delta}} \boldsymbol{g}_t^{\top}\boldsymbol{\delta}, \quad \text{s.t.} \quad D_{\text{KL}}(p(\cdot;\boldsymbol{\theta}_t) \| p(\cdot;\boldsymbol{\theta}_t + \boldsymbol{\delta})) \leq \epsilon
$$</p>
<p>è§£ä¸º$\boldsymbol{\delta}^* \propto -\boldsymbol{F}_t^{-1}\boldsymbol{g}_t$ã€‚</p>
<h4 id="74-fisherhessian">7.4 FisherçŸ©é˜µä¸Hessiançš„å…³ç³»</h4>
<p>å¯¹äºè´Ÿå¯¹æ•°ä¼¼ç„¶æŸå¤±$\mathcal{L}(\boldsymbol{\theta}) = -\mathbb{E}_{(\boldsymbol{x},\boldsymbol{y})}[\log p(\boldsymbol{y}|\boldsymbol{x};\boldsymbol{\theta})]$ï¼š</p>
<p><strong>ä¸€é˜¶å¯¼</strong>ï¼š
$$
\boldsymbol{g}(\boldsymbol{\theta}) = -\mathbb{E}_{(\boldsymbol{x},\boldsymbol{y})}[\nabla_{\boldsymbol{\theta}}\log p(\boldsymbol{y}|\boldsymbol{x};\boldsymbol{\theta})]
$$</p>
<p><strong>äºŒé˜¶å¯¼ï¼ˆHessianï¼‰</strong>ï¼š
$$
\boldsymbol{\mathcal{H}}(\boldsymbol{\theta}) = -\mathbb{E}_{(\boldsymbol{x},\boldsymbol{y})}[\nabla_{\boldsymbol{\theta}}^2\log p(\boldsymbol{y}|\boldsymbol{x};\boldsymbol{\theta})]
$$</p>
<p><strong>Fisherä¿¡æ¯çŸ©é˜µ</strong>ï¼š
$$
\boldsymbol{F}(\boldsymbol{\theta}) = \mathbb{E}_{(\boldsymbol{x},\boldsymbol{y})\sim p(\cdot;\boldsymbol{\theta})}[\nabla_{\boldsymbol{\theta}}\log p(\boldsymbol{y}|\boldsymbol{x};\boldsymbol{\theta})\nabla_{\boldsymbol{\theta}}\log p(\boldsymbol{y}|\boldsymbol{x};\boldsymbol{\theta})^{\top}]
$$</p>
<p>åœ¨æ¨¡å‹æ­£ç¡®æŒ‡å®šï¼ˆ$p_{\text{data}} = p(\cdot;\boldsymbol{\theta}^*)$ï¼‰çš„æƒ…å†µä¸‹ï¼Œæœ‰æ’ç­‰å¼ï¼š
$$
\boldsymbol{F}(\boldsymbol{\theta}) = \boldsymbol{\mathcal{H}}(\boldsymbol{\theta})
$$</p>
<p><strong>è¯æ˜</strong>ï¼šåˆ©ç”¨$\mathbb{E}_{\boldsymbol{y}\sim p}[\nabla\log p] = \boldsymbol{0}$ï¼Œè®¡ç®—ï¼š
$$
\nabla^2_{\boldsymbol{\theta}}\mathbb{E}_{\boldsymbol{y}}[\log p(\boldsymbol{y}|\boldsymbol{x};\boldsymbol{\theta})] = \mathbb{E}_{\boldsymbol{y}}[\nabla^2\log p] + \mathbb{E}_{\boldsymbol{y}}[\nabla\log p \cdot \nabla\log p^{\top}]
$$</p>
<p>å·¦è¾¹ä¸º0ï¼ˆå› ä¸º$\mathbb{E}_{\boldsymbol{y}}[\log p]$ä¸ä¾èµ–äº$\boldsymbol{\theta}$åœ¨çœŸå®åˆ†å¸ƒä¸‹ï¼‰ï¼Œå› æ­¤ï¼š
$$
\mathbb{E}_{\boldsymbol{y}}[\nabla^2\log p] = -\mathbb{E}_{\boldsymbol{y}}[\nabla\log p \cdot \nabla\log p^{\top}]
$$</p>
<p>å³$\boldsymbol{\mathcal{H}} = \boldsymbol{F}$ã€‚</p>
<h4 id="75-fisheradam">7.5 å¯¹è§’Fisherè¿‘ä¼¼ä¸Adam</h4>
<p>å®è·µä¸­å¸¸ç”¨å¯¹è§’Fisherè¿‘ä¼¼ï¼š
$$
\boldsymbol{F} \approx \text{diag}(\mathbb{E}[(\nabla_{\theta_i}\log p)^2])
$$</p>
<p>è¿™ä¸Adamçš„$\text{diag}(\mathbb{E}[g_i^2])$å½¢å¼ä¸€è‡´ï¼å› æ­¤ï¼ŒAdamä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯å¯¹è§’è‡ªç„¶æ¢¯åº¦çš„è¿‘ä¼¼ã€‚</p>
<h3 id="8-k-facshampoo">8. K-FACå’ŒShampooçš„å—å¯¹è§’è¿‘ä¼¼</h3>
<h4 id="81">8.1 å®Œæ•´çŸ©é˜µè¿‘ä¼¼çš„å›°éš¾</h4>
<p>å¯¹äº$n$ç»´å‚æ•°ï¼Œå­˜å‚¨å®Œæ•´çš„$\boldsymbol{F}$æˆ–$\boldsymbol{\mathcal{H}}$éœ€è¦$O(n^2)$ç©ºé—´ï¼Œæ±‚é€†éœ€è¦$O(n^3)$æ—¶é—´ã€‚åœ¨æ·±åº¦ç½‘ç»œä¸­ä¸å¯è¡Œã€‚</p>
<p><strong>å—å¯¹è§’è¿‘ä¼¼</strong>ï¼šå‡è®¾ä¸åŒå±‚ä¹‹é—´çš„å‚æ•°ç‹¬ç«‹ï¼Œå°†Hessianåˆ†è§£ä¸ºå—å¯¹è§’ï¼š
$$
\boldsymbol{\mathcal{H}} \approx \begin{bmatrix}
\boldsymbol{\mathcal{H}}_1 & & \\
& \boldsymbol{\mathcal{H}}_2 & \\
& & \ddots
\end{bmatrix}
$$</p>
<p>æ¯ä¸ªå—å¯¹åº”ä¸€å±‚çš„å‚æ•°ã€‚</p>
<h4 id="82-k-fackronecker-factored-approximate-curvature">8.2 K-FACï¼ˆKronecker-Factored Approximate Curvatureï¼‰</h4>
<p>K-FACè¿›ä¸€æ­¥å¯¹æ¯å±‚çš„FisherçŸ©é˜µè¿›è¡ŒKroneckeråˆ†è§£ã€‚</p>
<p><strong>è®¾å®š</strong>ï¼šè€ƒè™‘å…¨è¿æ¥å±‚$\boldsymbol{y} = \boldsymbol{W}\boldsymbol{x} + \boldsymbol{b}$ï¼Œå‚æ•°ä¸º$\boldsymbol{W} \in \mathbb{R}^{m \times n}$ã€‚å°†$\boldsymbol{W}$å‘é‡åŒ–ä¸º$\text{vec}(\boldsymbol{W}) \in \mathbb{R}^{mn}$ã€‚</p>
<p><strong>FisherçŸ©é˜µ</strong>ï¼šå¯¹äºè¿™ä¸€å±‚ï¼Œ
$$
\boldsymbol{F}_{\boldsymbol{W}} = \mathbb{E}\left[\nabla_{\text{vec}(\boldsymbol{W})}\log p \cdot \nabla_{\text{vec}(\boldsymbol{W})}\log p^{\top}\right]
$$</p>
<p><strong>Kroneckerè¿‘ä¼¼</strong>ï¼šK-FACå‡è®¾
$$
\boldsymbol{F}_{\boldsymbol{W}} \approx \boldsymbol{A} \otimes \boldsymbol{S}
$$</p>
<p>å…¶ä¸­ï¼š
- $\boldsymbol{A} = \mathbb{E}[\boldsymbol{a}\boldsymbol{a}^{\top}] \in \mathbb{R}^{m \times m}$ï¼Œ$\boldsymbol{a}$ä¸ºè¯¥å±‚çš„æ¿€æ´»å€¼
- $\boldsymbol{S} = \mathbb{E}[\boldsymbol{s}\boldsymbol{s}^{\top}] \in \mathbb{R}^{n \times n}$ï¼Œ$\boldsymbol{s}$ä¸ºè¯¥å±‚çš„æ¢¯åº¦
- $\otimes$è¡¨ç¤ºKroneckerç§¯</p>
<p><strong>Kroneckerç§¯æ€§è´¨</strong>ï¼š
$$
(\boldsymbol{A} \otimes \boldsymbol{S})^{-1} = \boldsymbol{A}^{-1} \otimes \boldsymbol{S}^{-1}
$$</p>
<p>å› æ­¤ï¼Œæ±‚é€†å¤æ‚åº¦ä»$O((mn)^3)$é™ä½åˆ°$O(m^3 + n^3)$ã€‚</p>
<p><strong>æ›´æ–°è§„åˆ™</strong>ï¼š
$$
\text{vec}(\boldsymbol{W}_{t+1}) = \text{vec}(\boldsymbol{W}_t) - \eta_t(\boldsymbol{A}_t^{-1} \otimes \boldsymbol{S}_t^{-1})\text{vec}(\boldsymbol{G}_t)
$$</p>
<p>ç­‰ä»·äºï¼š
$$
\boldsymbol{W}_{t+1} = \boldsymbol{W}_t - \eta_t \boldsymbol{A}_t^{-1}\boldsymbol{G}_t\boldsymbol{S}_t^{-1}
$$</p>
<p>å…¶ä¸­$\boldsymbol{G}<em _boldsymbol_W="\boldsymbol{W">t = \nabla</em>$ã€‚}_t}\mathcal{L</p>
<h4 id="83-shampoo">8.3 Shampooç®—æ³•</h4>
<p>Shampooæ˜¯K-FACçš„å˜ä½“ï¼Œä½¿ç”¨ä¸åŒçš„çŸ©é˜µåˆ†è§£ç­–ç•¥ã€‚</p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå¯¹äºçŸ©é˜µå‚æ•°$\boldsymbol{W} \in \mathbb{R}^{m \times n}$ï¼Œè¿‘ä¼¼Hessianä¸ºï¼š
$$
\boldsymbol{\mathcal{H}}_{\boldsymbol{W}} \approx \boldsymbol{L} \otimes \boldsymbol{R}
$$</p>
<p>å…¶ä¸­$\boldsymbol{L} \in \mathbb{R}^{m \times m}$å’Œ$\boldsymbol{R} \in \mathbb{R}^{n \times n}$é€šè¿‡AdaGradå¼çš„ç´¯ç§¯ä¼°è®¡ï¼š
$$
\boldsymbol{L}_t = \boldsymbol{L}_{t-1} + \boldsymbol{G}_t\boldsymbol{G}_t^{\top}
$$
$$
\boldsymbol{R}_t = \boldsymbol{R}_{t-1} + \boldsymbol{G}_t^{\top}\boldsymbol{G}_t
$$</p>
<p><strong>æ›´æ–°è§„åˆ™</strong>ï¼š
$$
\boldsymbol{W}_{t+1} = \boldsymbol{W}_t - \eta_t \boldsymbol{L}_t^{-1/4}\boldsymbol{G}_t\boldsymbol{R}_t^{-1/4}
$$</p>
<p>æ³¨æ„è¿™é‡Œä½¿ç”¨$-1/4$æ¬¡å¹‚ï¼ˆè€Œé$-1/2$ï¼‰ï¼Œæ˜¯ä¸ºäº†å¹³è¡¡ä¸¤ä¸ªæ–¹å‘çš„é¢„æ¡ä»¶åŒ–å¼ºåº¦ã€‚</p>
<p><strong>è®¡ç®—ä¼˜åŒ–</strong>ï¼š
- é€šè¿‡ç‰¹å¾åˆ†è§£è®¡ç®—çŸ©é˜µçš„åˆ†æ•°æ¬¡å¹‚
- æ¯éš”è‹¥å¹²æ­¥æ›´æ–°$\boldsymbol{L}_t^{-1/4}$å’Œ$\boldsymbol{R}_t^{-1/4}$ï¼ˆè€Œéæ¯æ­¥ï¼‰
- å¯¹äºå‘é‡å‚æ•°ï¼ˆå¦‚biasï¼‰ï¼Œé€€åŒ–ä¸ºAdaGradå¼çš„å¯¹è§’é¢„æ¡ä»¶</p>
<h4 id="84">8.4 å—å¯¹è§’è¿‘ä¼¼çš„ç†è®ºä¿è¯</h4>
<p><strong>å®šç†</strong>ï¼šå‡è®¾çœŸå®Hessianå¯ä»¥åˆ†è§£ä¸º$\boldsymbol{\mathcal{H}} = \boldsymbol{\mathcal{H}}_1 \oplus \boldsymbol{\mathcal{H}}_2 \oplus \cdots \oplus \boldsymbol{\mathcal{H}}_L$ï¼ˆå—å¯¹è§’ï¼‰ï¼Œä¸”æ¯å—çš„Kroneckerè¿‘ä¼¼è¯¯å·®æœ‰ç•Œï¼š
$$
\|\boldsymbol{\mathcal{H}}_l - \boldsymbol{A}_l \otimes \boldsymbol{S}_l\|_F \leq \epsilon_l
$$</p>
<p>åˆ™K-FACçš„é¢„æ¡ä»¶åŒ–è¯¯å·®æ»¡è¶³ï¼š
$$
\left\|\boldsymbol{\mathcal{H}}^{-1} - \bigoplus_{l=1}^{L}(\boldsymbol{A}_l^{-1} \otimes \boldsymbol{S}_l^{-1})\right\| \leq C\sum_{l=1}^{L}\frac{\epsilon_l}{\lambda_{\min}(\boldsymbol{\mathcal{H}}_l)^2}
$$</p>
<p>è¿™è¯´æ˜ï¼Œå½“Kroneckerç»“æ„è¿‘ä¼¼å‡†ç¡®æ—¶ï¼ŒK-FACå¯ä»¥å¾ˆå¥½åœ°è¿‘ä¼¼ç‰›é¡¿æ³•ã€‚</p>
<h3 id="9-muonhessian">9. Muonçš„éšå¼Hessiané¢„æ¡ä»¶</h3>
<h4 id="91-muon">9.1 Muonç®—æ³•æ¦‚è¿°</h4>
<p>Muonï¼ˆMomentum with Orthogonalizationï¼‰æ˜¯ä¸€ç§æ–°å‹ä¼˜åŒ–å™¨ï¼Œå®ƒé€šè¿‡åŠ¨é‡çš„æ­£äº¤åŒ–éšå¼åœ°è¿›è¡ŒHessiané¢„æ¡ä»¶åŒ–ã€‚</p>
<p><strong>æ ¸å¿ƒæ›´æ–°</strong>ï¼š
$$
\boldsymbol{m}_t = \beta \boldsymbol{m}_{t-1} + (1-\beta)\boldsymbol{g}_t
$$
$$
\tilde{\boldsymbol{m}}_t = \text{Orth}(\boldsymbol{m}_t, \boldsymbol{\theta}_t)
$$
$$
\boldsymbol{\theta}_{t+1} = \boldsymbol{\theta}_t - \eta_t \tilde{\boldsymbol{m}}_t
$$</p>
<p>å…¶ä¸­$\text{Orth}(\boldsymbol{m}, \boldsymbol{\theta})$è¡¨ç¤ºå°†$\boldsymbol{m}$ç›¸å¯¹äºæŸä¸ªåº¦é‡æ­£äº¤åŒ–ã€‚</p>
<h4 id="92">9.2 æ­£äº¤åŒ–ä¸éšå¼é¢„æ¡ä»¶</h4>
<p><strong>è§‚å¯Ÿ</strong>ï¼šåœ¨ç‰›é¡¿æ³•æ¡†æ¶ä¸‹ï¼Œæ›´æ–°æ–¹å‘$\boldsymbol{d}_t = -\boldsymbol{\mathcal{H}}_t^{-1}\boldsymbol{g}_t$æ»¡è¶³å…³äºHessianåº¦é‡çš„"æ­£äº¤æ€§"ã€‚</p>
<p>è€ƒè™‘äºŒæ¬¡å‡½æ•°$\mathcal{L}(\boldsymbol{\theta}) = \frac{1}{2}\boldsymbol{\theta}^{\top}\boldsymbol{\mathcal{H}}\boldsymbol{\theta} - \boldsymbol{b}^{\top}\boldsymbol{\theta}$ï¼Œæœ€ä¼˜è§£$\boldsymbol{\theta}^* = \boldsymbol{\mathcal{H}}^{-1}\boldsymbol{b}$ã€‚å®šä¹‰HessianèŒƒæ•°ï¼š
$$
\|\boldsymbol{x}\|_{\boldsymbol{\mathcal{H}}} = \sqrt{\boldsymbol{x}^{\top}\boldsymbol{\mathcal{H}}\boldsymbol{x}}
$$</p>
<p>ç‰›é¡¿æ–¹å‘$\boldsymbol{d}<em _boldsymbol_mathcal_H="\boldsymbol{\mathcal{H">t = -\boldsymbol{\mathcal{H}}^{-1}\boldsymbol{g}_t$ä½¿å¾—$|\boldsymbol{\theta}_t + \boldsymbol{d}_t - \boldsymbol{\theta}^*|</em>$æœ€å°ã€‚}}</p>
<h4 id="93-newton-schulz">9.3 å…·ä½“å®ç°ï¼šNewton-Schulzè¿­ä»£</h4>
<p>Muonä½¿ç”¨Newton-Schulzè¿­ä»£è¿‘ä¼¼çŸ©é˜µçš„é€†å¹³æ–¹æ ¹ï¼Œå®ç°éšå¼çš„Hessiané¢„æ¡ä»¶ã€‚</p>
<p><strong>Newton-Schulzè¿­ä»£</strong>ï¼šç»™å®šçŸ©é˜µ$\boldsymbol{A}$ï¼Œè¿­ä»£è®¡ç®—$\boldsymbol{A}^{-1/2}$ï¼š
$$
\boldsymbol{X}_{k+1} = \frac{1}{2}\boldsymbol{X}_k(3\boldsymbol{I} - \boldsymbol{A}\boldsymbol{X}_k^2)
$$</p>
<p>åˆå§‹åŒ–$\boldsymbol{X}_0 = \frac{1}{|\boldsymbol{A}|}\boldsymbol{I}$ï¼Œè¯¥è¿­ä»£ä¸‰é˜¶æ”¶æ•›åˆ°$\boldsymbol{A}^{-1/2}$ã€‚</p>
<p><strong>Muonä¸­çš„åº”ç”¨</strong>ï¼šå¯¹äºåŠ¨é‡$\boldsymbol{m}_t$ï¼Œè®¡ç®—ï¼š
$$
\boldsymbol{G}_t = \boldsymbol{m}_t\boldsymbol{m}_t^{\top}
$$
$$
\boldsymbol{G}_t^{-1/2} \approx \text{NewtonSchulz}(\boldsymbol{G}_t, n_{\text{iter}})
$$
$$
\tilde{\boldsymbol{m}}_t = \boldsymbol{G}_t^{-1/2}\boldsymbol{m}_t
$$</p>
<p>è¿™éšå¼åœ°å¯¹æ¢¯åº¦äºŒé˜¶çŸ©è¿›è¡Œäº†é¢„æ¡ä»¶åŒ–ã€‚</p>
<h4 id="94-adam">9.4 ä¸Adamçš„å¯¹æ¯”</h4>
<p><strong>Adamçš„é¢„æ¡ä»¶</strong>ï¼š
$$
\boldsymbol{P}_{\text{Adam}} = \text{diag}(\sqrt{v_1}, \sqrt{v_2}, \ldots, \sqrt{v_n})
$$</p>
<p><strong>Muonçš„é¢„æ¡ä»¶</strong>ï¼š
$$
\boldsymbol{P}_{\text{Muon}} \approx (\boldsymbol{m}_t\boldsymbol{m}_t^{\top})^{1/2}
$$</p>
<p>Muonè€ƒè™‘äº†å‚æ•°ä¹‹é—´çš„ç›¸å…³æ€§ï¼ˆéå¯¹è§’ç»“æ„ï¼‰ï¼Œç†è®ºä¸Šèƒ½æ•æ‰æ›´å¤šæ›²ç‡ä¿¡æ¯ã€‚ä½†è®¡ç®—æˆæœ¬ä¹Ÿæ›´é«˜ã€‚</p>
<p><strong>å¤æ‚åº¦å¯¹æ¯”</strong>ï¼š
- Adamï¼š$O(n)$ï¼ˆå¯¹è§’è¿ç®—ï¼‰
- Muonï¼š$O(n^2)$æˆ–æ›´é«˜ï¼ˆå–å†³äºNewton-Schulzè¿­ä»£æ¬¡æ•°å’ŒçŸ©é˜µç»´åº¦ï¼‰</p>
<p>å®è·µä¸­ï¼ŒMuoné€šå¸¸ç”¨äºé«˜ç»´ä½†ç»“æ„åŒ–çš„å‚æ•°ï¼ˆå¦‚Transformerçš„æƒé‡çŸ©é˜µï¼‰ã€‚</p>
<h3 id="10">10. æ”¶æ•›é€Ÿåº¦çš„ç†è®ºåˆ†æ</h3>
<h4 id="101-sgd">10.1 SGDçš„æ”¶æ•›é€Ÿç‡</h4>
<p>å¯¹äº$L$-å…‰æ»‘ã€$\mu$-å¼ºå‡¸çš„å‡½æ•°ï¼ŒSGD with constant step size $\eta \leq \frac{1}{L}$æ»¡è¶³ï¼š
$$
\mathbb{E}[\mathcal{L}(\boldsymbol{\theta}_t)] - \mathcal{L}(\boldsymbol{\theta}^*) \leq \frac{\|\boldsymbol{\theta}_0 - \boldsymbol{\theta}^*\|^2}{2\eta t} + \frac{\eta\sigma^2}{2}
$$</p>
<p>å…¶ä¸­$\sigma^2 = \mathbb{E}[|\boldsymbol{g} - \nabla\mathcal{L}|^2]$æ˜¯æ¢¯åº¦å™ªå£°çš„æ–¹å·®ã€‚</p>
<p><strong>æœ€ä¼˜å­¦ä¹ ç‡</strong>ï¼šå¹³è¡¡ä¸¤é¡¹ï¼Œå–$\eta^* \sim \frac{1}{\sqrt{t}}$ï¼Œå¾—åˆ°æ”¶æ•›ç‡$O(1/\sqrt{t})$ã€‚</p>
<h4 id="102">10.2 è‡ªé€‚åº”æ–¹æ³•çš„æ”¹è¿›</h4>
<p>Adamç­‰è‡ªé€‚åº”æ–¹æ³•é€šè¿‡å‚æ•°ç‰¹å®šçš„å­¦ä¹ ç‡æ”¹å–„æ¡ä»¶æ•°ä¾èµ–ã€‚</p>
<p><strong>å®šç†ï¼ˆAdamæ”¶æ•›ç‡ï¼Œç®€åŒ–ç‰ˆï¼‰</strong>ï¼šåœ¨å‡¸ä¸”Lipschitzæ¢¯åº¦å‡è®¾ä¸‹ï¼ŒAdamçš„regret boundä¸ºï¼š
$$
\sum_{t=1}^{T}[\mathcal{L}(\boldsymbol{\theta}_t) - \mathcal{L}(\boldsymbol{\theta}^*)] \leq O\left(\frac{d}{\sqrt{T}}\right)
$$</p>
<p>å…¶ä¸­$d$æ˜¯å‚æ•°ç»´åº¦ã€‚å¯¹æ¯”SGDçš„$O(d\sqrt{T})$ï¼ŒAdamåœ¨é«˜ç»´ç¨€ç–æƒ…å†µä¸‹ä¼˜åŠ¿æ˜æ˜¾ã€‚</p>
<p><strong>å…³é”®æ”¹è¿›</strong>ï¼šAdamçš„æœ‰æ•ˆå­¦ä¹ ç‡$\frac{\eta}{\sqrt{v_{i,t}}}$è‡ªé€‚åº”äºæ¯ä¸ªå‚æ•°çš„æ¢¯åº¦å°ºåº¦ï¼Œç­‰æ•ˆäºï¼š
$$
\eta_{i,t}^{\text{eff}} = \frac{\eta}{\sqrt{\sum_{k=1}^{t}g_{i,k}^2}}
$$</p>
<p>å¯¹äºç¨€ç–æ¢¯åº¦ï¼ˆéƒ¨åˆ†$g_{i,k} = 0$ï¼‰ï¼Œç›¸åº”å‚æ•°ä¿æŒè¾ƒå¤§å­¦ä¹ ç‡ï¼ŒåŠ é€Ÿæ”¶æ•›ã€‚</p>
<h4 id="103">10.3 äºŒé˜¶æ–¹æ³•çš„ç†è®ºä¼˜åŠ¿</h4>
<p><strong>ç‰›é¡¿æ³•çš„æ”¶æ•›ç‡</strong>ï¼šåœ¨$\boldsymbol{\theta}^*$çš„é‚»åŸŸå†…ï¼Œç‰›é¡¿æ³•äºŒæ¬¡æ”¶æ•›ï¼š
$$
\|\boldsymbol{\theta}_{t+1} - \boldsymbol{\theta}^*\| \leq C\|\boldsymbol{\theta}_t - \boldsymbol{\theta}^*\|^2
$$</p>
<p><strong>å‡†ç‰›é¡¿æ³•</strong>ï¼ˆå¦‚K-FACï¼‰ï¼šåœ¨Hessianè¿‘ä¼¼è¯¯å·®$|\boldsymbol{\mathcal{H}} - \tilde{\boldsymbol{\mathcal{H}}}| \leq \epsilon$çš„æ¡ä»¶ä¸‹ï¼Œè¶…çº¿æ€§æ”¶æ•›ï¼š
$$
\|\boldsymbol{\theta}_{t+1} - \boldsymbol{\theta}^*\| \leq C(1+\epsilon)\|\boldsymbol{\theta}_t - \boldsymbol{\theta}^*\|^{1+\alpha}
$$</p>
<p>å…¶ä¸­$\alpha \in (0, 1]$å–å†³äºè¿‘ä¼¼è´¨é‡ã€‚</p>
<h4 id="104">10.4 éå‡¸ä¼˜åŒ–çš„æŒ‘æˆ˜</h4>
<p>æ·±åº¦å­¦ä¹ ä¸­çš„æŸå¤±å‡½æ•°æ˜¯éå‡¸çš„ï¼Œä»¥ä¸Šå‡¸ä¼˜åŒ–ç†è®ºä¸å®Œå…¨é€‚ç”¨ã€‚</p>
<p><strong>éç‚¹é—®é¢˜</strong>ï¼šHessiançŸ©é˜µå¯èƒ½ä¸å®šï¼ˆæœ‰è´Ÿç‰¹å¾å€¼ï¼‰ï¼Œå¯¼è‡´ç‰›é¡¿æ³•æ–¹å‘é”™è¯¯ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š
1. <strong>Hessianä¿®æ­£</strong>ï¼š$\tilde{\boldsymbol{\mathcal{H}}} = \boldsymbol{\mathcal{H}} + \lambda\boldsymbol{I}$ï¼Œå…¶ä¸­$\lambda &gt; |\lambda_{\min}(\boldsymbol{\mathcal{H}})|$
2. <strong>ä¿¡èµ–åŸŸæ–¹æ³•</strong>ï¼šé™åˆ¶æ›´æ–°æ­¥é•¿$|\boldsymbol{\theta}_{t+1} - \boldsymbol{\theta}_t| \leq \Delta_t$
3. <strong>å¯¹è§’è¿‘ä¼¼</strong>ï¼šåªä½¿ç”¨Hessianå¯¹è§’å…ƒç´ ï¼ˆé€šå¸¸éè´Ÿï¼‰ï¼Œé¿å…è´Ÿæ›²ç‡</p>
<p><strong>Adamçš„é²æ£’æ€§</strong>ï¼šAdamé€šè¿‡$\sqrt{v_t}$å§‹ç»ˆä¿è¯æ›´æ–°æ–¹å‘ä¸æ¢¯åº¦ç›¸åï¼ˆä¸‹é™æ–¹å‘ï¼‰ï¼Œè‡ªç„¶é¿å…äº†è´Ÿæ›²ç‡é—®é¢˜ã€‚</p>
<h4 id="105">10.5 æ”¶æ•›é€Ÿåº¦çš„å®è¯æ¯”è¾ƒ</h4>
<p>ä»¥ImageNetè®­ç»ƒResNet-50ä¸ºä¾‹ï¼ˆå‡è®¾æ•°æ®ï¼‰ï¼š</p>
<table>
<thead>
<tr>
<th>ä¼˜åŒ–å™¨</th>
<th>æ”¶æ•›æ­¥æ•°ï¼ˆè‡³90% accï¼‰</th>
<th>æ¯æ­¥æ—¶é—´</th>
<th>æ€»æ—¶é—´</th>
</tr>
</thead>
<tbody>
<tr>
<td>SGD</td>
<td>90 epochs</td>
<td>1.0x</td>
<td>90x</td>
</tr>
<tr>
<td>Adam</td>
<td>70 epochs</td>
<td>1.0x</td>
<td>70x</td>
</tr>
<tr>
<td>K-FAC</td>
<td>50 epochs</td>
<td>1.5x</td>
<td>75x</td>
</tr>
<tr>
<td>Shampoo</td>
<td>45 epochs</td>
<td>2.0x</td>
<td>90x</td>
</tr>
</tbody>
</table>
<p><strong>è§‚å¯Ÿ</strong>ï¼š
- Adamæ¯”SGDå¿«ï¼ˆæ­¥æ•°å°‘ï¼‰
- äºŒé˜¶æ–¹æ³•ï¼ˆK-FAC/Shampooï¼‰æ­¥æ•°æ›´å°‘ï¼Œä½†æ¯æ­¥è®¡ç®—æˆæœ¬é«˜
- å®é™…å¢™é’Ÿæ—¶é—´çš„æƒè¡¡å–å†³äºå…·ä½“ç¡¬ä»¶å’Œå®ç°</p>
<h3 id="11_1">11. æ·±åº¦å­¦ä¹ ä¸­çš„å®è·µè€ƒè™‘</h3>
<h4 id="111-hessian">11.1 Hessianè¿‘ä¼¼çš„æœ‰æ•ˆæ€§æ¡ä»¶</h4>
<p><strong>å±€éƒ¨è¿‘ä¼¼å‡è®¾</strong>ï¼šå¤§å¤šæ•°åˆ†æå‡è®¾åœ¨$\boldsymbol{\theta}^*$é™„è¿‘ï¼Œæ¢¯åº¦å¯çº¿æ€§è¿‘ä¼¼ï¼š
$$
\boldsymbol{g}_{\boldsymbol{\theta}} \approx \boldsymbol{\mathcal{H}}_{\boldsymbol{\theta}^*}(\boldsymbol{\theta} - \boldsymbol{\theta}^*)
$$</p>
<p>è¿™åœ¨è®­ç»ƒåæœŸï¼ˆå¾®è°ƒé˜¶æ®µï¼‰è¾ƒä¸ºå‡†ç¡®ï¼Œä½†åœ¨è®­ç»ƒæ—©æœŸå¯èƒ½ä¸æˆç«‹ã€‚</p>
<p><strong>å¹³ç¨³æ€§å‡è®¾</strong>ï¼šAdamç­‰æ–¹æ³•å‡è®¾æ¢¯åº¦ç»Ÿè®¡é‡ç›¸å¯¹å¹³ç¨³ã€‚ä½†åœ¨ï¼š
- Learning rate warm-upé˜¶æ®µ
- Batch sizeå˜åŒ–æ—¶
- è·¨è¶Šä¸åŒè®­ç»ƒé˜¶æ®µï¼ˆå¦‚é¢„è®­ç»ƒâ†’å¾®è°ƒï¼‰</p>
<p>è¿™äº›å‡è®¾å¯èƒ½å¤±æ•ˆï¼Œéœ€è¦è°ƒæ•´è¶…å‚æ•°ï¼ˆå¦‚é‡ç½®åŠ¨é‡ç´¯ç§¯ï¼‰ã€‚</p>
<h4 id="112">11.2 æ•°å€¼ç¨³å®šæ€§</h4>
<p><strong>$\epsilon$çš„é€‰æ‹©</strong>ï¼šAdamä¸­çš„$\epsilon$ï¼ˆå…¸å‹å€¼$10^{-8}$ï¼‰éœ€è¦å¹³è¡¡ï¼š
- å¤ªå°ï¼šæ•°å€¼ä¸ç¨³å®šï¼Œå°¤å…¶åœ¨æ··åˆç²¾åº¦è®­ç»ƒä¸­
- å¤ªå¤§ï¼šæŠµæ¶ˆäº†è‡ªé€‚åº”æ•ˆæœï¼Œé€€åŒ–ä¸ºæ¥è¿‘SGD</p>
<p><strong>å»ºè®®</strong>ï¼š
- FP32è®­ç»ƒï¼š$\epsilon = 10^{-8}$
- FP16/BF16è®­ç»ƒï¼š$\epsilon = 10^{-6}$æˆ–$10^{-5}$</p>
<h4 id="113-hessian">11.3 è¶…å‚æ•°é€‰æ‹©çš„Hessianè§†è§’</h4>
<p><strong>å­¦ä¹ ç‡$\eta$</strong>ï¼šä»$\boldsymbol{\mathcal{H}} \approx \frac{1}{\eta\sigma}\text{diag}(\sqrt{v})$ï¼Œæœ‰æ•ˆå­¦ä¹ ç‡ä¸ºï¼š
$$
\eta_{i}^{\text{eff}} = \frac{\eta}{\sqrt{v_i}}
$$</p>
<p><strong>$\beta_2$çš„é€‰æ‹©</strong>ï¼š$\beta_2$æ§åˆ¶Hessianä¼°è®¡çš„æ—¶é—´çª—å£ã€‚è¾ƒå¤§çš„$\beta_2$ï¼ˆå¦‚0.999ï¼‰ä½¿å¾—ä¼°è®¡æ›´ç¨³å®šä½†ååº”æ…¢ï¼›è¾ƒå°çš„$\beta_2$ï¼ˆå¦‚0.9ï¼‰ååº”å¿«ä½†å¯èƒ½ä¸å‡†ç¡®ã€‚</p>
<p><strong>ç»éªŒæ³•åˆ™</strong>ï¼š
- ç¨³å®šã€å¹³ç¨³çš„ä»»åŠ¡ï¼ˆå¦‚æ”¶æ•›åçš„å¾®è°ƒï¼‰ï¼š$\beta_2 = 0.999$
- å¿«é€Ÿå˜åŒ–çš„ä»»åŠ¡ï¼ˆå¦‚å¼ºåŒ–å­¦ä¹ ã€GANï¼‰ï¼š$\beta_2 = 0.9$ æˆ–æ›´å°</p>
<h4 id="114">11.4 ä¸åŒä¼˜åŒ–å™¨çš„é€‚ç”¨åœºæ™¯</h4>
<table>
<thead>
<tr>
<th>ä¼˜åŒ–å™¨</th>
<th>æœ€é€‚åˆåœºæ™¯</th>
<th>Hessianè¿‘ä¼¼ç±»å‹</th>
<th>è®¡ç®—æˆæœ¬</th>
</tr>
</thead>
<tbody>
<tr>
<td>SGD+Momentum</td>
<td>è§†è§‰ã€å‡¸ä¼˜åŒ–</td>
<td>$\boldsymbol{\mathcal{H}} \approx \eta^{-1}\boldsymbol{I}$</td>
<td>æœ€ä½</td>
</tr>
<tr>
<td>AdaGrad</td>
<td>ç¨€ç–ç‰¹å¾ã€NLP</td>
<td>å¯¹è§’ç´¯ç§¯</td>
<td>ä½</td>
</tr>
<tr>
<td>RMSProp</td>
<td>éå¹³ç¨³ã€RL</td>
<td>å¯¹è§’æŒ‡æ•°å¹³å‡</td>
<td>ä½</td>
</tr>
<tr>
<td>Adam</td>
<td>é€šç”¨ã€é»˜è®¤é€‰æ‹©</td>
<td>å¯¹è§’+åŠ¨é‡</td>
<td>ä½</td>
</tr>
<tr>
<td>AdaBelief</td>
<td>æ”¹è¿›çš„Adam</td>
<td>å¯¹è§’åæ–¹å·®</td>
<td>ä½</td>
</tr>
<tr>
<td>K-FAC</td>
<td>å¤§è§„æ¨¡è§†è§‰</td>
<td>Kroneckerå—</td>
<td>ä¸­</td>
</tr>
<tr>
<td>Shampoo</td>
<td>Transformer</td>
<td>Kroneckerå—</td>
<td>ä¸­</td>
</tr>
<tr>
<td>Muon</td>
<td>ç»“æ„åŒ–å‚æ•°</td>
<td>éšå¼å…¨çŸ©é˜µ</td>
<td>é«˜</td>
</tr>
</tbody>
</table>
<h3 id="12_1">12. æ€»ç»“ä¸å±•æœ›</h3>
<h4 id="121">12.1 æ ¸å¿ƒæ´å¯Ÿ</h4>
<p>æœ¬æ¨å¯¼æ­ç¤ºäº†è‡ªé€‚åº”å­¦ä¹ ç‡ä¼˜åŒ–å™¨çš„ç»Ÿä¸€è§†è§’ï¼š</p>
<ol>
<li><strong>äºŒé˜¶æœ¬è´¨</strong>ï¼šAdamç­‰è‡ªé€‚åº”æ–¹æ³•æœ¬è´¨ä¸Šæ˜¯å¯¹è§’Hessianè¿‘ä¼¼çš„ç‰›é¡¿æ³•</li>
<li><strong>æ¢¯åº¦å¹³æ–¹çš„ç»Ÿè®¡æ„ä¹‰</strong>ï¼š$\mathbb{E}[g^2] \propto \boldsymbol{\mathcal{H}}^2$ï¼ˆé•¿æœŸå¹³å‡ï¼‰</li>
<li><strong>Fisher-Hessianè”ç³»</strong>ï¼šåœ¨æ¦‚ç‡æ¨¡å‹ä¸­ï¼ŒFisherä¿¡æ¯çŸ©é˜µç­‰äºHessian</li>
<li><strong>å—ç»“æ„çš„åˆ©ç”¨</strong>ï¼šK-FAC/Shampooé€šè¿‡Kroneckeråˆ†è§£åœ¨è®¡ç®—æˆæœ¬å’Œè¿‘ä¼¼ç²¾åº¦é—´æƒè¡¡</li>
</ol>
<h4 id="122">12.2 ç†è®ºä¸å®è·µçš„å·®è·</h4>
<p>å°½ç®¡ç†è®ºä¼˜ç¾ï¼Œå®è·µä¸­ä»æœ‰gapï¼š</p>
<ol>
<li><strong>éå‡¸æ€§</strong>ï¼šæ·±åº¦ç½‘ç»œçš„éå‡¸æ€§ä½¿å¾—å±€éƒ¨äºŒé˜¶è¿‘ä¼¼ä¸æ€»æ˜¯æœ‰æ•ˆ</li>
<li><strong>è®¡ç®—æˆæœ¬</strong>ï¼šå®Œæ•´Hessiançš„$O(n^2)$å¤æ‚åº¦åœ¨å¤§æ¨¡å‹ä¸­ä¸å¯è¡Œ</li>
<li><strong>è¶…å‚æ•°æ•æ„Ÿæ€§</strong>ï¼šè‡ªé€‚åº”æ–¹æ³•å¼•å…¥æ›´å¤šè¶…å‚æ•°ï¼ˆ$\beta_1, \beta_2, \epsilon$ï¼‰ï¼Œéœ€è¦ä»”ç»†è°ƒèŠ‚</li>
</ol>
<h4 id="123">12.3 æœªæ¥æ–¹å‘</h4>
<ol>
<li><strong>è‡ªåŠ¨è¶…å‚æ•°è°ƒèŠ‚</strong>ï¼šæ ¹æ®Hessianä¼°è®¡åŠ¨æ€è°ƒæ•´$\eta, \beta_2$</li>
<li><strong>æ··åˆç²¾åº¦Hessian</strong>ï¼šåœ¨ä½ç²¾åº¦ä¸‹é«˜æ•ˆè®¡ç®—å’Œå­˜å‚¨Hessianè¿‘ä¼¼</li>
<li><strong>Layer-wiseè‡ªé€‚åº”</strong>ï¼šä¸åŒå±‚ä½¿ç”¨ä¸åŒçš„Hessianè¿‘ä¼¼ç­–ç•¥</li>
<li><strong>ç†è®ºä¿è¯</strong>ï¼šåœ¨å®é™…æ·±åº¦ç½‘ç»œè®¾å®šä¸‹å»ºç«‹æ”¶æ•›æ€§ç†è®º</li>
</ol>
<p><strong>æœ€ç»ˆæ€è€ƒ</strong>ï¼šHessianè¿‘ä¼¼ä¸ºç†è§£ä¼˜åŒ–å™¨æä¾›äº†ç»Ÿä¸€æ¡†æ¶ã€‚ä»å¯¹è§’è¿‘ä¼¼ï¼ˆAdamï¼‰åˆ°å—è¿‘ä¼¼ï¼ˆK-FACï¼‰å†åˆ°éšå¼è¿‘ä¼¼ï¼ˆMuonï¼‰ï¼Œæœ¬è´¨ä¸Šæ˜¯åœ¨è®¡ç®—æˆæœ¬ä¸æ›²ç‡ä¿¡æ¯ç²¾åº¦ä¹‹é—´å¯»æ‰¾æœ€ä¼˜å¹³è¡¡ã€‚æ·±åº¦å­¦ä¹ çš„æœªæ¥ä¼˜åŒ–å™¨è®¾è®¡ï¼Œå¾ˆå¯èƒ½ç»§ç»­æ²¿ç€è¿™æ¡ä¸»çº¿â€”â€”æ›´é«˜æ•ˆåœ°è¿‘ä¼¼å’Œåˆ©ç”¨Hessianä¿¡æ¯ã€‚</p>
        </div>
    </div>
</body>
</html>