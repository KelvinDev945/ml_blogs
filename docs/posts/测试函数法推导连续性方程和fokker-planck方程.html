<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试函数法推导连续性方程和Fokker-Planck方程 | ML & Math Blog Posts</title>
    <meta name="description" content="测试函数法推导连续性方程和Fokker-Planck方程&para;
原文链接: https://spaces.ac.cn/archives/9461
发布日期: 

在文章《生成扩散模型漫谈（六）：一般框架之ODE篇》中，我们推导了SDE的Fokker-Planck方程；而在《生成扩散模型漫谈（十二）：“硬刚”扩散ODE》中，我们单独推导了ODE的连续性方程。它们都是描述随机变量沿着SDE/OD...">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css">

    <!-- Google Fonts -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/post.css">

    <!-- Custom JS -->
    <script src="../assets/js/collapsible.js" defer></script>

    <!-- MathJax for math rendering -->
    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true,
        processEnvironments: true
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Syntax highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/github.min.css">
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/highlight.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
        <div class="container">
            <a class="navbar-brand" href="../index.html">
                <i class="fas fa-brain"></i> ML & Math Blog
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../index.html"><i class="fas fa-home"></i> 首页</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Post Content -->
    <article class="container post-container my-5">
        <!-- Breadcrumb Navigation -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="../index.html"><i class="fas fa-home"></i> 首页</a></li>
                
                <li class="breadcrumb-item"><a href="../index.html?tags=详细推导">详细推导</a></li>
                
                <li class="breadcrumb-item active" aria-current="page">
                    #76 测试函数法推导连续性方程和Fokker-Planck方程
                </li>
            </ol>
        </nav>

        <!-- Post Header -->
        <header class="post-header mb-4">
            <h1 class="post-title">
                <span class="post-number">#76</span>
                测试函数法推导连续性方程和Fokker-Planck方程
            </h1>
            <div class="post-meta">
                <span><i class="far fa-calendar"></i> 2023-02-11</span>
                
            </div>
            
            <div class="post-tags mt-3">
                
                <a href="../index.html?tags=详细推导" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> 详细推导</span>
                </a>
                
                <a href="../index.html?tags=概率" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> 概率</span>
                </a>
                
                <a href="../index.html?tags=微分方程" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> 微分方程</span>
                </a>
                
                <a href="../index.html?tags=随机" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> 随机</span>
                </a>
                
                <a href="../index.html?tags=扩散" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> 扩散</span>
                </a>
                
                <a href="../index.html?tags=生成模型" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> 生成模型</span>
                </a>
                
            </div>
            
        </header>

        <div class="row">
            <!-- Main Content -->
            <div class="col-lg-9">
                <!-- Post Body -->
                <div class="post-content">
                    <h1 id="fokker-planck">测试函数法推导连续性方程和Fokker-Planck方程<a class="toc-link" href="#fokker-planck" title="Permanent link">&para;</a></h1>
<p><strong>原文链接</strong>: <a href="https://spaces.ac.cn/archives/9461">https://spaces.ac.cn/archives/9461</a></p>
<p><strong>发布日期</strong>: </p>
<hr />
<p>在文章<a href="/archives/9228">《生成扩散模型漫谈（六）：一般框架之ODE篇》</a>中，我们推导了SDE的Fokker-Planck方程；而在<a href="/archives/9280">《生成扩散模型漫谈（十二）：“硬刚”扩散ODE》</a>中，我们单独推导了ODE的连续性方程。它们都是描述随机变量沿着SDE/ODE演化的分布变化方程，连续性方程是Fokker-Planck方程的特例。在推导Fokker-Planck方程时，我们将泰勒展开硬套到了狄拉克函数上，虽然结果是对的，但未免有点不伦不类；在推导连续性方程时，我们结合了雅可比行列式和泰勒展开，方法本身比较常规，但没法用来推广到Fokker-Planck方程。</p>
<p>这篇文章我们介绍“测试函数法”，它是推导连续性方程和Fokker-Planck方程的标准方法之一，其分析过程比较正规，并且适用场景也比较广。</p>
<h2 id="_1">分部积分<a class="toc-link" href="#_1" title="Permanent link">&para;</a></h2>
<p>正式推导之前，这里先介绍后面推导会用到的关键结果——分部积分法的高维推广。</p>
<p>一般教程对分部积分的介绍仅限于一维情形，即<br />
\begin{equation}\int_a^b uv'dx = uv|<em _Omega="\Omega">a^b - \int_a^b vu'dx\end{equation}<br />
这里$u,v$是$x$的函数，$'$表示求函数关于$x$的导数。下面我们需要它的一个高维版本，为此，我们先回顾一维分部积分的推导过程，它依赖于求导的乘法法则：<br />
\begin{equation}(uv)' = uv' + vu'\end{equation}<br />
然后两边对$x$积分并移项，就得到分部积分公式。对于高维情形，我们考虑类似的公式：<br />
\begin{equation}\nabla\cdot(u\boldsymbol{v}) = \boldsymbol{v}\cdot\nabla u + u\nabla \cdot\boldsymbol{v}\end{equation}<br />
其中$u$是$\boldsymbol{x}$的标量函数，$\boldsymbol{v}$是$\boldsymbol{x}$的向量函数（维度跟$\boldsymbol{v}$一致），$\nabla$表示求函数关于$\boldsymbol{x}$的梯度。现在我们对两端在区域$\Omega$积分：<br />
\begin{equation}\int</em>}\nabla\cdot(u\boldsymbol{v})d\boldsymbol{x} = \int_{\Omega}\boldsymbol{v}\cdot\nabla u d\boldsymbol{x} + \int_{\Omega}u\nabla \cdot\boldsymbol{v} d\boldsymbol{x}\end{equation<br />
根据<a href="https://en.wikipedia.org/wiki/Divergence_theorem">高斯散度定理</a>，左侧等于$\int_{\partial\Omega}u\boldsymbol{v}\cdot\hat{\boldsymbol{n}}dS$，$\partial\Omega$是$\Omega$的边界，$\hat{\boldsymbol{n}}$是边界的外向单位法向量，$dS$是面积微元。所以，移项后有<br />
\begin{equation}\int_{\Omega}\boldsymbol{v}\cdot\nabla u d\boldsymbol{x} = \int_{\partial\Omega}u\boldsymbol{v}\cdot\hat{\boldsymbol{n}}dS - \int_{\Omega}u\nabla \cdot\boldsymbol{v} d\boldsymbol{x}\label{eq:int-by-parts}\end{equation}<br />
这就是我们要推导的高维空间分部积分公式。特别地，对于概率密度函数$p$，那么由于非负性和积分为1的限制，无穷远处必然有$p\to 0$和$\nabla p\to \boldsymbol{0}$，所以如果$\Omega$选为全空间（没有特别注明积分区域的，默认为全空间），那么分别将$u=p$和$\boldsymbol{v}=\nabla p$代入上式，得到<br />
\begin{align}\int\boldsymbol{v}\cdot\nabla p d\boldsymbol{x} =&amp;\, - \int p\nabla \cdot\boldsymbol{v} d\boldsymbol{x}\label{eq:int-by-parts-p} \\<br />
\int u\nabla \cdot\nabla p d\boldsymbol{x} = &amp;\,-\int\nabla p\cdot\nabla u d\boldsymbol{x}\label{eq:int-by-parts-gp}\end{align}<br />
如果要进一步严格化上述结论，可以假设$p$具有紧的支撑集。不过这纯粹是数学上的严格化，事实上对于一般理解来说，直接默认在无穷远处成立$p\to 0$和$\nabla p\to \boldsymbol{0}$就够了。</p>
<h2 id="ode">ODE演化<a class="toc-link" href="#ode" title="Permanent link">&para;</a></h2>
<p>测试函数法的原理，是如果对于任意函数$\phi(\boldsymbol{x})$，都成立<br />
\begin{equation}\int f(\boldsymbol{x})\phi(\boldsymbol{x})d\boldsymbol{x} = \int g(\boldsymbol{x})\phi(\boldsymbol{x})d\boldsymbol{x}\end{equation}<br />
那么就成立$f(\boldsymbol{x})=g(\boldsymbol{x})$，其中$\phi(\boldsymbol{x})$就叫做测试函数。更严谨的定义需要声明$\phi(\boldsymbol{x})$的选取空间，以及等号的具体含义（如严格相等/几乎处处相等/依概率相等之类），这里我们就不引入这些细节了。</p>
<p>对于ODE<br />
\begin{equation}\frac{d\boldsymbol{x}<em t="t" t_Delta="t+\Delta">t}{dt}=\boldsymbol{f}_t(\boldsymbol{x}_t)\label{eq:ode}\end{equation}<br />
我们将它离散化为<br />
\begin{equation}\boldsymbol{x}</em>} = \boldsymbol{x<em t="t" t_Delta="t+\Delta">t + \boldsymbol{f}_t(\boldsymbol{x}_t)\Delta t\label{eq:ode-diff}\end{equation}<br />
那么就有<br />
\begin{equation}\phi(\boldsymbol{x}</em>}) = \phi(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t + \boldsymbol{f}_t(\boldsymbol{x}_t)\Delta t)\approx \phi(\boldsymbol{x}_t) + \Delta t\,\,\boldsymbol{f}_t(\boldsymbol{x}_t)\cdot\nabla</em><em t="t" t_Delta="t+\Delta">t}\phi(\boldsymbol{x}_t)\end{equation}<br />
两边求期望，得到：<br />
\begin{equation}\int p</em>}(\boldsymbol{x<em t="t" t_Delta="t+\Delta">{t+\Delta t})\phi(\boldsymbol{x}</em>}) d\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">{t+\Delta t}\approx \int p_t(\boldsymbol{x}_t)\phi(\boldsymbol{x}_t)d\boldsymbol{x}_t + \Delta t\int p_t(\boldsymbol{x}_t)\boldsymbol{f}_t(\boldsymbol{x}_t)\cdot\nabla</em><em t="t" t_Delta="t+\Delta">t}\phi(\boldsymbol{x}_t)d\boldsymbol{x}_t\end{equation}<br />
由于积分的结果不依赖于被积自变量的记号，所以左边将$\boldsymbol{x}</em>}$换成$\boldsymbol{x<em t="t" t_Delta="t+\Delta">t$也是等价的：<br />
\begin{equation}\int p</em>}(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t)\phi(\boldsymbol{x}_t) d\boldsymbol{x}_t\approx \int p_t(\boldsymbol{x}_t)\phi(\boldsymbol{x}_t)d\boldsymbol{x}_t + \Delta t\int p_t(\boldsymbol{x}_t)\boldsymbol{f}_t(\boldsymbol{x}_t)\cdot\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\phi(\boldsymbol{x}_t)d\boldsymbol{x}_t\label{eq:change-var}\end{equation}<br />
将右边第一项移到左边，然后取$\Delta t\to 0$的极限，得到：<br />
\begin{equation}\int \frac{\partial p_t(\boldsymbol{x}_t)}{\partial t}\phi(\boldsymbol{x}_t) d\boldsymbol{x}_t = \int p_t(\boldsymbol{x}_t)\boldsymbol{f}_t(\boldsymbol{x}_t)\cdot\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\phi(\boldsymbol{x}_t)d\boldsymbol{x}_t\label{eq:dt-0}\end{equation}<br />
右端利用分部积分公式$\eqref{eq:int-by-parts-p}$得到<br />
\begin{equation}\int \frac{\partial p_t(\boldsymbol{x}_t)}{\partial t}\phi(\boldsymbol{x}_t) d\boldsymbol{x}_t = -\int \Big[\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\cdot\big(p_t(\boldsymbol{x}_t)\boldsymbol{f}_t(\boldsymbol{x}_t)\big)\Big]\phi(\boldsymbol{x}_t)d\boldsymbol{x}_t\end{equation}<br />
根据测试函数法的相等原理，就有<br />
\begin{equation}\frac{\partial p_t(\boldsymbol{x}_t)}{\partial t} = -\nabla</em>}_t}\cdot\big(p_t(\boldsymbol{x}_t)\boldsymbol{f}_t(\boldsymbol{x}_t)\big)\end{equation<br />
这称为“<a href="https://en.wikipedia.org/wiki/Continuity_equation">连续性方程</a>”。</p>
<h2 id="sde">SDE演化<a class="toc-link" href="#sde" title="Permanent link">&para;</a></h2>
<p>对于SDE<br />
\begin{equation}d\boldsymbol{x}<em t="t" t_Delta="t+\Delta">t = \boldsymbol{f}_t(\boldsymbol{x}_t) dt + g_t d\boldsymbol{w}\label{eq:sde}\end{equation}<br />
我们离散化为<br />
\begin{equation}\boldsymbol{x}</em>} = \boldsymbol{x<em t="t" t_Delta="t+\Delta">t + \boldsymbol{f}_t(\boldsymbol{x}_t) \Delta t + g_t \sqrt{\Delta t}\boldsymbol{\varepsilon},\quad \boldsymbol{\varepsilon}\sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{I})\label{eq:sde-diff}\end{equation}<br />
那么<br />
\begin{equation}\begin{aligned}<br />
\phi(\boldsymbol{x}</em>}) =&amp;\, \phi(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t + \boldsymbol{f}_t(\boldsymbol{x}_t) \Delta t + g_t \sqrt{\Delta t}\boldsymbol{\varepsilon}) \\<br />
\approx&amp;\, \phi(\boldsymbol{x}_t) + \left(\boldsymbol{f}_t(\boldsymbol{x}_t) \Delta t + g_t \sqrt{\Delta t}\boldsymbol{\varepsilon}\right)\cdot \nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\phi(\boldsymbol{x}_t) + \frac{1}{2} \left(g_t\sqrt{\Delta t}\boldsymbol{\varepsilon}\cdot \nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\right)^2\phi(\boldsymbol{x}_t)<br />
\end{aligned}\end{equation}<br />
两边求期望，注意右边要同时对$\boldsymbol{x}_t$和$\boldsymbol{\varepsilon}$求期望，其中$\boldsymbol{\varepsilon}$的期望可以事先求出，结果是<br />
\begin{equation}\phi(\boldsymbol{x}_t) + \Delta t\,\,\boldsymbol{f}_t(\boldsymbol{x}_t)\cdot \nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\phi(\boldsymbol{x}_t) + \frac{1}{2} \Delta t\,g_t^2\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\cdot\nabla</em><em t="t" t_Delta="t+\Delta">t}\phi(\boldsymbol{x}_t)<br />
\end{equation}<br />
于是<br />
\begin{equation}\begin{aligned}<br />
&amp;\,\int p</em>}(\boldsymbol{x<em t="t" t_Delta="t+\Delta">{t+\Delta t})\phi(\boldsymbol{x}</em>}) d\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">{t+\Delta t}\\<br />
\approx&amp;\, \int p_t(\boldsymbol{x}_t)\phi(\boldsymbol{x}_t)d\boldsymbol{x}_t + \Delta t\int p_t(\boldsymbol{x}_t)\boldsymbol{f}_t(\boldsymbol{x}_t)\cdot\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\phi(\boldsymbol{x}_t)d\boldsymbol{x}_t + \int\frac{1}{2} \Delta t\,g_t^2 p_t(\boldsymbol{x}_t)\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\cdot\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\phi(\boldsymbol{x}_t) d\boldsymbol{x}_t<br />
\end{aligned}\end{equation}<br />
跟式$\eqref{eq:change-var}$、式$\eqref{eq:dt-0}$类似，取$\Delta\to 0$的极限，得到<br />
\begin{equation}\int \frac{\partial p_t(\boldsymbol{x}_t)}{\partial t}\phi(\boldsymbol{x}_t) d\boldsymbol{x}_t = \int p_t(\boldsymbol{x}_t)\boldsymbol{f}_t(\boldsymbol{x}_t)\cdot\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\phi(\boldsymbol{x}_t)d\boldsymbol{x}_t + \int\frac{1}{2} \,g_t^2 p_t(\boldsymbol{x}_t)\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\cdot\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\phi(\boldsymbol{x}_t) d\boldsymbol{x}_t\end{equation}<br />
对右边第一项应用式$\eqref{eq:int-by-parts-p}$、对右边第二项先应用式$\eqref{eq:int-by-parts-gp}$再应用式$\eqref{eq:int-by-parts-p}$，得到<br />
\begin{equation}\int \frac{\partial p_t(\boldsymbol{x}_t)}{\partial t}\phi(\boldsymbol{x}_t) d\boldsymbol{x}_t = \int \left[-\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\cdot\big(p_t(\boldsymbol{x}_t)\boldsymbol{f}_t(\boldsymbol{x}_t)\big)+\frac{1}{2}g_t^2 \nabla</em>}}\cdot\nabla_{\boldsymbol{x}}p_t(\boldsymbol{x})\right]\phi(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t)d\boldsymbol{x}_t\end{equation}<br />
根据测试函数法的相等原理得<br />
\begin{equation}\frac{\partial p_t(\boldsymbol{x}_t)}{\partial t} = -\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\cdot\big(p_t(\boldsymbol{x}_t)\boldsymbol{f}_t(\boldsymbol{x}_t)\big)+\frac{1}{2}g_t^2 \nabla</em>}}\cdot\nabla_{\boldsymbol{x}}p_t(\boldsymbol{x})\end{equation<br />
这就是“<a href="https://en.wikipedia.org/wiki/Fokker%E2%80%93Planck_equation">Fokker-Planck方程</a>”。</p>
<h2 id="_2">文章小结<a class="toc-link" href="#_2" title="Permanent link">&para;</a></h2>
<p>本文介绍了用于推导某些概率方程的测试函数法，主要内容包括分部积分法的高维推广，以及ODE的连续性方程和SDE的Fokker-Planck方程的推导过程。</p>
<p><em><strong>转载到请包括本文地址：</strong><a href="https://spaces.ac.cn/archives/9461">https://spaces.ac.cn/archives/9461</a></em></p>
<p><em><strong>更详细的转载事宜请参考：</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="《科学空间FAQ》">《科学空间FAQ》</a></p>
<p><strong>如果您还有什么疑惑或建议，欢迎在下方评论区继续讨论。</strong></p>
<p><strong>如果您觉得本文还不错，欢迎分享/打赏本文。打赏并非要从中获得收益，而是希望知道科学空间获得了多少读者的真心关注。当然，如果你无视它，也不会影响你的阅读。再次表示欢迎和感谢！</strong></p>
<p>打赏</p>
<p><img alt="科学空间" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>微信打赏</p>
<p><img alt="科学空间" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>支付宝打赏</p>
<p>因为网站后台对打赏并无记录，因此欢迎在打赏时候备注留言。你还可以<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>点击这里</strong></a>或在下方评论区留言来告知你的建议或需求。</p>
<p><strong>如果您需要引用本文，请参考：</strong></p>
<p>苏剑林. (Feb. 11, 2023). 《测试函数法推导连续性方程和Fokker-Planck方程 》[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/9461">https://spaces.ac.cn/archives/9461</a></p>
<p>@online{kexuefm-9461,<br />
title={测试函数法推导连续性方程和Fokker-Planck方程},<br />
author={苏剑林},<br />
year={2023},<br />
month={Feb},<br />
url={\url{https://spaces.ac.cn/archives/9461}},<br />
} </p>
<hr />
<h2 id="_3">公式推导与注释<a class="toc-link" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="1">1. 测试函数的定义与性质<a class="toc-link" href="#1" title="Permanent link">&para;</a></h3>
<p><strong>1.1 测试函数空间</strong></p>
<p>测试函数（test function）是数学分析和偏微分方程理论中的核心概念，用于定义函数的弱形式（weak form）。测试函数$\phi(\boldsymbol{x})$通常需要满足以下条件：</p>
<ol>
<li><strong>光滑性</strong>：$\phi \in C^\infty(\mathbb{R}^n)$，即$\phi$是无穷次可微的</li>
<li><strong>紧支撑</strong>：存在有界区域$K \subset \mathbb{R}^n$，使得当$\boldsymbol{x} \notin K$时，$\phi(\boldsymbol{x}) = 0$</li>
<li><strong>衰减性</strong>：对于非紧支撑的情况，要求$\phi$及其所有导数在无穷远处快速衰减</li>
</ol>
<p>满足这些条件的函数空间记为$\mathcal{D}(\mathbb{R}^n)$或$C_0^\infty(\mathbb{R}^n)$，称为测试函数空间。</p>
<p><strong>1.2 测试函数的基本性质</strong></p>
<p>测试函数有以下重要性质：</p>
<p><strong>性质1（线性性）</strong>：如果$\phi_1, \phi_2 \in \mathcal{D}$，$\alpha, \beta \in \mathbb{R}$，则$\alpha\phi_1 + \beta\phi_2 \in \mathcal{D}$。</p>
<p><strong>性质2（导数封闭性）</strong>：如果$\phi \in \mathcal{D}$，则对任意多重指标$\alpha = (\alpha_1, \ldots, \alpha_n)$，有<br />
$$\frac{\partial^{|\alpha|} \phi}{\partial x_1^{\alpha_1} \cdots \partial x_n^{\alpha_n}} \in \mathcal{D}$$</p>
<p><strong>性质3（乘法封闭性）</strong>：如果$\phi \in \mathcal{D}$，$g \in C^\infty$，则$g\phi \in \mathcal{D}$（当$g$增长不太快时）。</p>
<p><strong>性质4（积分有界性）</strong>：由于紧支撑性，测试函数的任意次积分都是良定义的：<br />
$$\int_{\mathbb{R}^n} \left|\frac{\partial^{|\alpha|} \phi}{\partial x_1^{\alpha_1} \cdots \partial x_n^{\alpha_n}}\right| d\boldsymbol{x} &lt; \infty$$</p>
<p><strong>1.3 分布理论中的测试函数</strong></p>
<p>在分布理论（distribution theory）中，测试函数用于定义广义函数。一个分布$T$是测试函数空间$\mathcal{D}$上的连续线性泛函：<br />
$$T: \mathcal{D}(\mathbb{R}^n) \to \mathbb{R}$$<br />
满足线性性：<br />
$$T(\alpha\phi_1 + \beta\phi_2) = \alpha T(\phi_1) + \beta T(\phi_2)$$</p>
<p>例如，狄拉克$\delta$函数可以通过其作用在测试函数上的结果来定义：<br />
$$\langle \delta_{\boldsymbol{x}_0}, \phi \rangle = \phi(\boldsymbol{x}_0)$$</p>
<p>对于概率密度函数$p(\boldsymbol{x})$，它定义了一个分布：<br />
$$\langle p, \phi \rangle = \int_{\mathbb{R}^n} p(\boldsymbol{x})\phi(\boldsymbol{x}) d\boldsymbol{x}$$</p>
<h3 id="2">2. 弱形式与强形式的关系<a class="toc-link" href="#2" title="Permanent link">&para;</a></h3>
<p><strong>2.1 强形式与弱形式的定义</strong></p>
<p>考虑偏微分方程（PDE）：<br />
$$\mathcal{L}[u] = f$$<br />
其中$\mathcal{L}$是微分算子，$u$是未知函数，$f$是已知函数。</p>
<p><strong>强形式（Strong form）</strong>：函数$u$在经典意义下处处满足方程$\mathcal{L}[u] = f$。这要求$u$具有足够的光滑性，使得所有导数都存在。</p>
<p><strong>弱形式（Weak form）</strong>：对任意测试函数$\phi \in \mathcal{D}$，成立<br />
$$\langle \mathcal{L}[u], \phi \rangle = \langle f, \phi \rangle$$<br />
即<br />
$$\int_{\mathbb{R}^n} \mathcal{L}<a href="\boldsymbol{x}">u</a> \phi(\boldsymbol{x}) d\boldsymbol{x} = \int_{\mathbb{R}^n} f(\boldsymbol{x}) \phi(\boldsymbol{x}) d\boldsymbol{x}$$</p>
<p><strong>2.2 从强形式到弱形式</strong></p>
<p>如果$u$是强解（即在经典意义下满足方程），则对任意测试函数$\phi$，有：<br />
$$\int_{\mathbb{R}^n} \mathcal{L}<a href="\boldsymbol{x}">u</a> \phi(\boldsymbol{x}) d\boldsymbol{x} = \int_{\mathbb{R}^n} f(\boldsymbol{x}) \phi(\boldsymbol{x}) d\boldsymbol{x}$$<br />
因此强解必然是弱解。</p>
<p><strong>2.3 从弱形式到强形式</strong></p>
<p>反过来，如果$u$是充分光滑的弱解，并且对<strong>任意</strong>测试函数$\phi$都成立弱形式，则由分布理论的基本引理（fundamental lemma of the calculus of variations）可得：<br />
$$\mathcal{L}<a href="\boldsymbol{x}">u</a> = f(\boldsymbol{x}), \quad \text{几乎处处成立}$$</p>
<p><strong>基本引理</strong>：如果$g \in L^1_{loc}(\mathbb{R}^n)$满足<br />
$$\int_{\mathbb{R}^n} g(\boldsymbol{x}) \phi(\boldsymbol{x}) d\boldsymbol{x} = 0, \quad \forall \phi \in \mathcal{D}(\mathbb{R}^n)$$<br />
则$g(\boldsymbol{x}) = 0$几乎处处成立。</p>
<p><strong>证明思路</strong>：假设存在测度不为零的集合$E$使得$g(\boldsymbol{x}) &gt; 0$在$E$上成立。由于$g$的局部可积性和测试函数的任意性，可以构造一个支撑在$E$上的非负测试函数$\phi$，使得<br />
$$\int_{\mathbb{R}^n} g(\boldsymbol{x}) \phi(\boldsymbol{x}) d\boldsymbol{x} &gt; 0$$<br />
这与假设矛盾，因此$g = 0$几乎处处成立。</p>
<p><strong>2.4 弱形式的优势</strong></p>
<p>使用弱形式有以下优势：</p>
<ol>
<li><strong>放松光滑性要求</strong>：弱解不需要所有导数都存在，只需积分意义下的"弱导数"存在</li>
<li><strong>包含间断解</strong>：可以处理激波等间断解</li>
<li><strong>自然包含边界条件</strong>：通过分部积分，边界条件自然嵌入到弱形式中</li>
<li><strong>数值方法的基础</strong>：有限元方法等数值方法基于弱形式</li>
</ol>
<h3 id="3">3. 高维分部积分的详细推导<a class="toc-link" href="#3" title="Permanent link">&para;</a></h3>
<p><strong>3.1 梯度与散度的基本性质</strong></p>
<p>对于标量函数$u: \mathbb{R}^n \to \mathbb{R}$，梯度定义为：<br />
$$\nabla u = \left(\frac{\partial u}{\partial x_1}, \frac{\partial u}{\partial x_2}, \ldots, \frac{\partial u}{\partial x_n}\right)$$</p>
<p>对于向量函数$\boldsymbol{v} = (v_1, v_2, \ldots, v_n): \mathbb{R}^n \to \mathbb{R}^n$，散度定义为：<br />
$$\nabla \cdot \boldsymbol{v} = \sum_{i=1}^n \frac{\partial v_i}{\partial x_i}$$</p>
<p><strong>3.2 乘积的散度公式</strong></p>
<p>考虑标量函数$u$和向量函数$\boldsymbol{v}$的乘积$u\boldsymbol{v}$的散度：<br />
$$\nabla \cdot (u\boldsymbol{v}) = \nabla \cdot (uv_1, uv_2, \ldots, uv_n)$$</p>
<p>根据散度的定义：<br />
$$\nabla \cdot (u\boldsymbol{v}) = \sum_{i=1}^n \frac{\partial (uv_i)}{\partial x_i}$$</p>
<p>应用乘法法则$\frac{\partial (uv_i)}{\partial x_i} = v_i\frac{\partial u}{\partial x_i} + u\frac{\partial v_i}{\partial x_i}$：<br />
$$\nabla \cdot (u\boldsymbol{v}) = \sum_{i=1}^n \left(v_i\frac{\partial u}{\partial x_i} + u\frac{\partial v_i}{\partial x_i}\right)$$</p>
<p>重新整理：<br />
$$\nabla \cdot (u\boldsymbol{v}) = \sum_{i=1}^n v_i\frac{\partial u}{\partial x_i} + u\sum_{i=1}^n \frac{\partial v_i}{\partial x_i}$$</p>
<p>即：<br />
$$\nabla \cdot (u\boldsymbol{v}) = \boldsymbol{v} \cdot \nabla u + u\nabla \cdot \boldsymbol{v}$$</p>
<p>这是高维空间中的乘积法则。</p>
<p><strong>3.3 高斯散度定理</strong></p>
<p>高斯散度定理（也称为散度定理或Gauss定理）陈述：对于向量场$\boldsymbol{F}: \Omega \to \mathbb{R}^n$，其中$\Omega \subset \mathbb{R}^n$是具有光滑边界$\partial\Omega$的有界区域，成立：<br />
$$\int_\Omega \nabla \cdot \boldsymbol{F} \, d\boldsymbol{x} = \int_{\partial\Omega} \boldsymbol{F} \cdot \hat{\boldsymbol{n}} \, dS$$</p>
<p>其中$\hat{\boldsymbol{n}}$是边界$\partial\Omega$的外向单位法向量，$dS$是边界上的面积元。</p>
<p><strong>物理直观</strong>：散度定理表明，向量场在区域内的散度的总和，等于向量场穿过区域边界的总通量。</p>
<p><strong>3.4 高维分部积分公式的推导</strong></p>
<p>现在我们推导高维分部积分公式。对$\nabla \cdot (u\boldsymbol{v}) = \boldsymbol{v} \cdot \nabla u + u\nabla \cdot \boldsymbol{v}$两边在区域$\Omega$上积分：<br />
$$\int_\Omega \nabla \cdot (u\boldsymbol{v}) \, d\boldsymbol{x} = \int_\Omega \boldsymbol{v} \cdot \nabla u \, d\boldsymbol{x} + \int_\Omega u\nabla \cdot \boldsymbol{v} \, d\boldsymbol{x}$$</p>
<p>对左边应用高斯散度定理：<br />
$$\int_{\partial\Omega} u\boldsymbol{v} \cdot \hat{\boldsymbol{n}} \, dS = \int_\Omega \boldsymbol{v} \cdot \nabla u \, d\boldsymbol{x} + \int_\Omega u\nabla \cdot \boldsymbol{v} \, d\boldsymbol{x}$$</p>
<p>移项得到高维分部积分公式：<br />
$$\int_\Omega \boldsymbol{v} \cdot \nabla u \, d\boldsymbol{x} = \int_{\partial\Omega} u\boldsymbol{v} \cdot \hat{\boldsymbol{n}} \, dS - \int_\Omega u\nabla \cdot \boldsymbol{v} \, d\boldsymbol{x}$$</p>
<p><strong>3.5 概率密度函数的边界条件</strong></p>
<p>对于概率密度函数$p(\boldsymbol{x})$，由于其非负性和归一化条件：<br />
$$p(\boldsymbol{x}) \geq 0, \quad \int_{\mathbb{R}^n} p(\boldsymbol{x}) d\boldsymbol{x} = 1$$</p>
<p>在无穷远处必然有：<br />
$$\lim_{|\boldsymbol{x}| \to \infty} p(\boldsymbol{x}) = 0$$</p>
<p>更强地，由于概率质量必须是有限的，我们有：<br />
$$\lim_{|\boldsymbol{x}| \to \infty} |\boldsymbol{x}|^n p(\boldsymbol{x}) = 0$$</p>
<p>这意味着$p$的衰减速度快于$|\boldsymbol{x}|^{-n}$。进一步，对于光滑的概率密度，其梯度也必须快速衰减：<br />
$$\lim_{|\boldsymbol{x}| \to \infty} \nabla p(\boldsymbol{x}) = \boldsymbol{0}$$</p>
<p>因此，当$\Omega = \mathbb{R}^n$（全空间）时，边界项消失：<br />
$$\int_{\partial\mathbb{R}^n} u\boldsymbol{v} \cdot \hat{\boldsymbol{n}} \, dS = 0$$</p>
<p>这给出简化的分部积分公式：<br />
$$\int_{\mathbb{R}^n} \boldsymbol{v} \cdot \nabla p \, d\boldsymbol{x} = -\int_{\mathbb{R}^n} p\nabla \cdot \boldsymbol{v} \, d\boldsymbol{x}$$</p>
<p><strong>3.6 二阶导数的分部积分</strong></p>
<p>对于拉普拉斯算子$\Delta u = \nabla \cdot \nabla u$，我们可以应用两次分部积分。设$\boldsymbol{F} = \nabla p$，则：<br />
$$\int_{\mathbb{R}^n} u \nabla \cdot \nabla p \, d\boldsymbol{x} = \int_{\mathbb{R}^n} u \nabla \cdot (\nabla p) \, d\boldsymbol{x}$$</p>
<p>第一次分部积分（取$\boldsymbol{v} = \nabla p$）：<br />
$$\int_{\mathbb{R}^n} u \nabla \cdot (\nabla p) \, d\boldsymbol{x} = -\int_{\mathbb{R}^n} \nabla u \cdot \nabla p \, d\boldsymbol{x}$$</p>
<p>（边界项在无穷远处为零）</p>
<p>第二次分部积分（现在积分中$\nabla p$的角色变为向量场）：<br />
$$-\int_{\mathbb{R}^n} \nabla u \cdot \nabla p \, d\boldsymbol{x} = -\int_{\mathbb{R}^n} \nabla p \cdot \nabla u \, d\boldsymbol{x}$$</p>
<p>这可以看作是以$p$为"权重"，$\nabla u$为"向量场"的分部积分，但更常见的用法是保持这个形式：<br />
$$\int_{\mathbb{R}^n} u \Delta p \, d\boldsymbol{x} = -\int_{\mathbb{R}^n} \nabla u \cdot \nabla p \, d\boldsymbol{x}$$</p>
<p>对于对称的情况：<br />
$$\int_{\mathbb{R}^n} u \Delta p \, d\boldsymbol{x} = \int_{\mathbb{R}^n} p \Delta u \, d\boldsymbol{x}$$</p>
<p>（当边界项消失时）</p>
<h3 id="4">4. 连续性方程的完整推导<a class="toc-link" href="#4" title="Permanent link">&para;</a></h3>
<p><strong>4.1 ODE系统与流的概念</strong></p>
<p>考虑常微分方程（ODE）系统：<br />
$$\frac{d\boldsymbol{x}_t}{dt} = \boldsymbol{f}_t(\boldsymbol{x}_t)$$</p>
<p>其中$\boldsymbol{x}_t \in \mathbb{R}^n$是状态变量，$\boldsymbol{f}_t: \mathbb{R}^n \to \mathbb{R}^n$是速度场。</p>
<p>这个方程定义了一个<strong>流</strong>（flow）$\Phi_t: \mathbb{R}^n \to \mathbb{R}^n$，使得：<br />
$$\Phi_t(\boldsymbol{x}_0) = \boldsymbol{x}_t$$<br />
是初值为$\boldsymbol{x}_0$的解。</p>
<p><strong>4.2 概率密度的演化</strong></p>
<p>假设初始时刻$t=0$，随机变量$\boldsymbol{x}_0$的概率密度为$p_0(\boldsymbol{x})$。在时刻$t$，通过流映射$\Phi_t$，得到$\boldsymbol{x}_t = \Phi_t(\boldsymbol{x}_0)$。</p>
<p>概率守恒要求：<br />
$$P(\boldsymbol{x}_t \in A) = P(\boldsymbol{x}_0 \in \Phi_t^{-1}(A))$$</p>
<p>对于任意可测集合$A$，这可以写成：<br />
$$\int_A p_t(\boldsymbol{x}) d\boldsymbol{x} = \int_{\Phi_t^{-1}(A)} p_0(\boldsymbol{x}) d\boldsymbol{x}$$</p>
<p><strong>4.3 欧拉描述与拉格朗日描述</strong></p>
<p>在流体力学中，有两种描述方式：</p>
<ul>
<li><strong>拉格朗日描述</strong>：跟踪每个粒子的轨迹$\boldsymbol{x}_t = \Phi_t(\boldsymbol{x}_0)$</li>
<li><strong>欧拉描述</strong>：在固定空间点观察流体性质的变化</li>
</ul>
<p>连续性方程采用欧拉描述，描述固定空间点处密度$p_t(\boldsymbol{x})$如何随时间变化。</p>
<p><strong>4.4 离散化与泰勒展开</strong></p>
<p>将ODE离散化：<br />
$$\boldsymbol{x}_{t+\Delta t} = \boldsymbol{x}_t + \boldsymbol{f}_t(\boldsymbol{x}_t)\Delta t + O(\Delta t^2)$$</p>
<p>对于任意测试函数$\phi(\boldsymbol{x})$，应用泰勒展开：<br />
$$\phi(\boldsymbol{x}_{t+\Delta t}) = \phi(\boldsymbol{x}_t + \boldsymbol{f}_t(\boldsymbol{x}_t)\Delta t)$$</p>
<p>一阶泰勒展开：<br />
$$\phi(\boldsymbol{x}<em _boldsymbol_x="\boldsymbol{x">t + \boldsymbol{\delta}) \approx \phi(\boldsymbol{x}_t) + \boldsymbol{\delta} \cdot \nabla</em>|^2)$$}_t} \phi(\boldsymbol{x}_t) + O(|\boldsymbol{\delta</p>
<p>取$\boldsymbol{\delta} = \boldsymbol{f}<em t="t" t_Delta="t+\Delta">t(\boldsymbol{x}_t)\Delta t$：<br />
$$\phi(\boldsymbol{x}</em>}) = \phi(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t) + \Delta t \, \boldsymbol{f}_t(\boldsymbol{x}_t) \cdot \nabla</em>_t) + O(\Delta t^2)$$}_t} \phi(\boldsymbol{x</p>
<p><strong>4.5 期望值的演化</strong></p>
<p>对$\phi(\boldsymbol{x}<em t="t" t_Delta="t+\Delta">{t+\Delta t})$在$\boldsymbol{x}_t$分布下取期望：<br />
$$\mathbb{E}[\phi(\boldsymbol{x}</em>})] = \int p_t(\boldsymbol{x<em t="t" t_Delta="t+\Delta">t) \phi(\boldsymbol{x}</em>_t$$}) d\boldsymbol{x</p>
<p>代入泰勒展开：<br />
$$\mathbb{E}[\phi(\boldsymbol{x}_{t+\Delta t})] = \int p_t(\boldsymbol{x}_t) \left[\phi(\boldsymbol{x}_t) + \Delta t \, \boldsymbol{f}_t(\boldsymbol{x}_t) \cdot \nabla \phi(\boldsymbol{x}_t)\right] d\boldsymbol{x}_t + O(\Delta t^2)$$</p>
<p>分开积分：<br />
$$\mathbb{E}[\phi(\boldsymbol{x}_{t+\Delta t})] = \int p_t(\boldsymbol{x}_t) \phi(\boldsymbol{x}_t) d\boldsymbol{x}_t + \Delta t \int p_t(\boldsymbol{x}_t) \boldsymbol{f}_t(\boldsymbol{x}_t) \cdot \nabla \phi(\boldsymbol{x}_t) d\boldsymbol{x}_t + O(\Delta t^2)$$</p>
<p><strong>4.6 变量替换与密度演化</strong></p>
<p>另一方面，期望值也可以用$t+\Delta t$时刻的密度表示：<br />
$$\mathbb{E}[\phi(\boldsymbol{x}<em t="t" t_Delta="t+\Delta">{t+\Delta t})] = \int p</em>$$}(\boldsymbol{x}) \phi(\boldsymbol{x}) d\boldsymbol{x</p>
<p>注意这里积分变量记为$\boldsymbol{x}$（代表$t+\Delta t$时刻的状态）。由于积分变量只是哑变量，我们可以统一记为$\boldsymbol{x}<em t="t" t_Delta="t+\Delta">t$：<br />
$$\int p</em>_t + O(\Delta t^2)$$}(\boldsymbol{x}_t) \phi(\boldsymbol{x}_t) d\boldsymbol{x}_t = \int p_t(\boldsymbol{x}_t) \phi(\boldsymbol{x}_t) d\boldsymbol{x}_t + \Delta t \int p_t(\boldsymbol{x}_t) \boldsymbol{f}_t(\boldsymbol{x}_t) \cdot \nabla \phi(\boldsymbol{x}_t) d\boldsymbol{x</p>
<p><strong>4.7 时间导数的提取</strong></p>
<p>移项并除以$\Delta t$：<br />
$$\frac{1}{\Delta t}\int [p_{t+\Delta t}(\boldsymbol{x}_t) - p_t(\boldsymbol{x}_t)] \phi(\boldsymbol{x}_t) d\boldsymbol{x}_t = \int p_t(\boldsymbol{x}_t) \boldsymbol{f}_t(\boldsymbol{x}_t) \cdot \nabla \phi(\boldsymbol{x}_t) d\boldsymbol{x}_t + O(\Delta t)$$</p>
<p>取$\Delta t \to 0$的极限：<br />
$$\int \frac{\partial p_t(\boldsymbol{x}_t)}{\partial t} \phi(\boldsymbol{x}_t) d\boldsymbol{x}_t = \int p_t(\boldsymbol{x}_t) \boldsymbol{f}_t(\boldsymbol{x}_t) \cdot \nabla \phi(\boldsymbol{x}_t) d\boldsymbol{x}_t$$</p>
<p>这就是连续性方程的弱形式。</p>
<p><strong>4.8 应用分部积分得到强形式</strong></p>
<p>对右边应用分部积分公式：<br />
$$\int p_t(\boldsymbol{x}_t) \boldsymbol{f}_t(\boldsymbol{x}_t) \cdot \nabla \phi(\boldsymbol{x}_t) d\boldsymbol{x}_t = -\int \nabla \cdot [p_t(\boldsymbol{x}_t) \boldsymbol{f}_t(\boldsymbol{x}_t)] \phi(\boldsymbol{x}_t) d\boldsymbol{x}_t$$</p>
<p>（利用了$p$和$\boldsymbol{f}$的衰减性，边界项为零）</p>
<p>因此：<br />
$$\int \frac{\partial p_t(\boldsymbol{x}_t)}{\partial t} \phi(\boldsymbol{x}_t) d\boldsymbol{x}_t = -\int \nabla \cdot [p_t(\boldsymbol{x}_t) \boldsymbol{f}_t(\boldsymbol{x}_t)] \phi(\boldsymbol{x}_t) d\boldsymbol{x}_t$$</p>
<p>即：<br />
$$\int \left[\frac{\partial p_t(\boldsymbol{x}_t)}{\partial t} + \nabla \cdot (p_t(\boldsymbol{x}_t) \boldsymbol{f}_t(\boldsymbol{x}_t))\right] \phi(\boldsymbol{x}_t) d\boldsymbol{x}_t = 0$$</p>
<p>由于这对任意测试函数$\phi$成立，根据基本引理，得到连续性方程的强形式：<br />
$$\frac{\partial p_t(\boldsymbol{x}_t)}{\partial t} + \nabla \cdot [p_t(\boldsymbol{x}_t) \boldsymbol{f}_t(\boldsymbol{x}_t)] = 0$$</p>
<p>或写成：<br />
$$\frac{\partial p_t(\boldsymbol{x}_t)}{\partial t} = -\nabla \cdot [p_t(\boldsymbol{x}_t) \boldsymbol{f}_t(\boldsymbol{x}_t)]$$</p>
<p><strong>4.9 连续性方程的展开形式</strong></p>
<p>应用乘积的散度公式：<br />
$$\nabla \cdot (p\boldsymbol{f}) = \boldsymbol{f} \cdot \nabla p + p\nabla \cdot \boldsymbol{f}$$</p>
<p>连续性方程可以写成：<br />
$$\frac{\partial p_t}{\partial t} = -\boldsymbol{f}_t \cdot \nabla p_t - p_t \nabla \cdot \boldsymbol{f}_t$$</p>
<p>或者用物质导数（material derivative）的记号：<br />
$$\frac{\partial p_t}{\partial t} + \boldsymbol{f}_t \cdot \nabla p_t = -p_t \nabla \cdot \boldsymbol{f}_t$$</p>
<p>左边是沿着流的方向的导数，右边描述了流的压缩或膨胀效应。</p>
<h3 id="5-fokker-planck">5. Fokker-Planck方程的完整推导<a class="toc-link" href="#5-fokker-planck" title="Permanent link">&para;</a></h3>
<p><strong>5.1 随机微分方程（SDE）</strong></p>
<p>考虑Itô型随机微分方程：<br />
$$d\boldsymbol{x}_t = \boldsymbol{f}_t(\boldsymbol{x}_t) dt + g_t d\boldsymbol{w}_t$$</p>
<p>其中$\boldsymbol{w}_t \in \mathbb{R}^n$是标准布朗运动，$\boldsymbol{f}_t$是漂移项，$g_t$是扩散系数。</p>
<p>更一般地，扩散项可以是矩阵形式：<br />
$$d\boldsymbol{x}_t = \boldsymbol{f}_t(\boldsymbol{x}_t) dt + G_t d\boldsymbol{w}_t$$</p>
<p>其中$G_t \in \mathbb{R}^{n \times n}$。为简化，我们考虑标量扩散$g_t$的情况。</p>
<p><strong>5.2 Itô公式的应用</strong></p>
<p>Itô公式是随机微积分的核心工具，对于光滑函数$\phi(\boldsymbol{x})$，有：<br />
$$d\phi(\boldsymbol{x}<em i_j="i,j">t) = \nabla \phi \cdot d\boldsymbol{x}_t + \frac{1}{2} \sum</em>_t^j$$} \frac{\partial^2 \phi}{\partial x_i \partial x_j} d\boldsymbol{x}_t^i d\boldsymbol{x</p>
<p>其中$d\boldsymbol{x}<em ij="ij">t^i$是$\boldsymbol{x}_t$的第$i$个分量，且满足Itô乘法规则：<br />
$$dt \cdot dt = 0, \quad dt \cdot d\boldsymbol{w}_t = 0, \quad d\boldsymbol{w}_t^i \cdot d\boldsymbol{w}_t^j = \delta</em> dt$$</p>
<p><strong>5.3 Itô乘法表</strong></p>
<p>代入$d\boldsymbol{x}_t = \boldsymbol{f}_t dt + g_t d\boldsymbol{w}_t$：<br />
$$d\boldsymbol{x}_t^i d\boldsymbol{x}_t^j = (\boldsymbol{f}_t^i dt + g_t d\boldsymbol{w}_t^i)(\boldsymbol{f}_t^j dt + g_t d\boldsymbol{w}_t^j)$$</p>
<p>展开：<br />
$$d\boldsymbol{x}_t^i d\boldsymbol{x}_t^j = \boldsymbol{f}_t^i \boldsymbol{f}_t^j (dt)^2 + \boldsymbol{f}_t^i g_t dt \cdot d\boldsymbol{w}_t^j + g_t \boldsymbol{f}_t^j d\boldsymbol{w}_t^i \cdot dt + g_t^2 d\boldsymbol{w}_t^i d\boldsymbol{w}_t^j$$</p>
<p>应用Itô规则，保留$O(dt)$项：<br />
$$d\boldsymbol{x}<em ij="ij">t^i d\boldsymbol{x}_t^j = g_t^2 \delta</em> dt$$</p>
<p><strong>5.4 Itô公式的展开</strong></p>
<p>因此，Itô公式变为：<br />
$$d\phi(\boldsymbol{x}<em i_j="i,j">t) = \nabla \phi \cdot (\boldsymbol{f}_t dt + g_t d\boldsymbol{w}_t) + \frac{1}{2} \sum</em> dt$$} \frac{\partial^2 \phi}{\partial x_i \partial x_j} g_t^2 \delta_{ij</p>
<p>简化：<br />
$$d\phi(\boldsymbol{x}_t) = \nabla \phi \cdot \boldsymbol{f}_t dt + \nabla \phi \cdot g_t d\boldsymbol{w}_t + \frac{g_t^2}{2} \sum_i \frac{\partial^2 \phi}{\partial x_i^2} dt$$</p>
<p>即：<br />
$$d\phi(\boldsymbol{x}_t) = \left[\boldsymbol{f}_t \cdot \nabla \phi + \frac{g_t^2}{2} \Delta \phi\right] dt + g_t \nabla \phi \cdot d\boldsymbol{w}_t$$</p>
<p>其中$\Delta \phi = \nabla \cdot \nabla \phi = \sum_i \frac{\partial^2 \phi}{\partial x_i^2}$是拉普拉斯算子。</p>
<p><strong>5.5 有限差分近似</strong></p>
<p>将SDE离散化：<br />
$$\boldsymbol{x}_{t+\Delta t} = \boldsymbol{x}_t + \boldsymbol{f}_t(\boldsymbol{x}_t)\Delta t + g_t\sqrt{\Delta t}\boldsymbol{\varepsilon}$$</p>
<p>其中$\boldsymbol{\varepsilon} \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{I})$是标准正态随机变量。</p>
<p>注意布朗运动增量的方差：$\mathbb{E}[(w_{t+\Delta t} - w_t)^2] = \Delta t$，因此$d\boldsymbol{w}_t$的标准差为$\sqrt{\Delta t}$。</p>
<p><strong>5.6 测试函数的泰勒展开</strong></p>
<p>对$\phi(\boldsymbol{x}<em i_j="i,j">{t+\Delta t})$进行二阶泰勒展开：<br />
$$\phi(\boldsymbol{x}_t + \boldsymbol{\delta}) = \phi(\boldsymbol{x}_t) + \boldsymbol{\delta} \cdot \nabla \phi + \frac{1}{2} \sum</em>|^3)$$} \delta_i \delta_j \frac{\partial^2 \phi}{\partial x_i \partial x_j} + O(|\boldsymbol{\delta</p>
<p>其中$\boldsymbol{\delta} = \boldsymbol{f}_t\Delta t + g_t\sqrt{\Delta t}\boldsymbol{\varepsilon}$。</p>
<p><strong>5.7 随机项的期望计算</strong></p>
<p>对随机变量$\boldsymbol{\varepsilon}$取期望。首先，关键的期望值：<br />
$$\mathbb{E}[\varepsilon_i] = 0$$<br />
$$\mathbb{E}[\varepsilon_i \varepsilon_j] = \delta_{ij}$$<br />
$$\mathbb{E}[\varepsilon_i \varepsilon_j \varepsilon_k] = 0$$</p>
<p>计算$\boldsymbol{\delta}$的各阶矩：</p>
<p><strong>一阶项</strong>：<br />
$$\mathbb{E}_\varepsilon[\boldsymbol{\delta}] = \boldsymbol{f}_t\Delta t$$</p>
<p><strong>二阶项</strong>：<br />
$$\mathbb{E}<em>\varepsilon[\delta_i \delta_j] = \mathbb{E}</em>\varepsilon[(\boldsymbol{f}_t^i\Delta t + g_t\sqrt{\Delta t}\varepsilon_i)(\boldsymbol{f}_t^j\Delta t + g_t\sqrt{\Delta t}\varepsilon_j)]$$</p>
<p>展开：<br />
$$= \boldsymbol{f}_t^i\boldsymbol{f}_t^j(\Delta t)^2 + g_t^2\Delta t \mathbb{E}[\varepsilon_i\varepsilon_j] + g_t\sqrt{\Delta t}\Delta t(\boldsymbol{f}_t^i\mathbb{E}[\varepsilon_j] + \boldsymbol{f}_t^j\mathbb{E}[\varepsilon_i])$$</p>
<p>$$= \boldsymbol{f}<em ij="ij">t^i\boldsymbol{f}_t^j(\Delta t)^2 + g_t^2\Delta t \delta</em>$$</p>
<p>在$\Delta t \to 0$的极限下，保留主导项（$O(\Delta t)$项）：<br />
$$\mathbb{E}<em ij="ij">\varepsilon[\delta_i \delta_j] = g_t^2 \delta</em> \Delta t + O(\Delta t^2)$$</p>
<p><strong>5.8 期望值的计算</strong></p>
<p>对泰勒展开式取期望：<br />
$$\mathbb{E}<em t="t" t_Delta="t+\Delta">\varepsilon[\phi(\boldsymbol{x}</em>})] = \phi(\boldsymbol{x<em>t) + \mathbb{E}</em>\varepsilon[\boldsymbol{\delta}] \cdot \nabla \phi + \frac{1}{2} \sum_{i,j} \mathbb{E}_\varepsilon[\delta_i \delta_j] \frac{\partial^2 \phi}{\partial x_i \partial x_j} + O(\Delta t^{3/2})$$</p>
<p>代入上面计算的期望值：<br />
$$\mathbb{E}<em t="t" t_Delta="t+\Delta">\varepsilon[\phi(\boldsymbol{x}</em>)$$})] = \phi(\boldsymbol{x}_t) + \boldsymbol{f}_t\Delta t \cdot \nabla \phi + \frac{1}{2} \sum_i g_t^2\Delta t \frac{\partial^2 \phi}{\partial x_i^2} + O(\Delta t^{3/2</p>
<p>即：<br />
$$\mathbb{E}<em t="t" t_Delta="t+\Delta">\varepsilon[\phi(\boldsymbol{x}</em>)$$})] = \phi(\boldsymbol{x}_t) + \Delta t\left[\boldsymbol{f}_t \cdot \nabla \phi + \frac{g_t^2}{2} \Delta \phi\right] + O(\Delta t^{3/2</p>
<p><strong>5.9 对初始分布取期望</strong></p>
<p>现在对$\boldsymbol{x}<em t="t" t_Delta="t+\Delta">t$的分布$p_t$取期望：<br />
$$\int p</em>}(\boldsymbol{x}) \phi(\boldsymbol{x}) d\boldsymbol{x} = \int p_t(\boldsymbol{x<em>t) \mathbb{E}</em>\varepsilon[\phi(\boldsymbol{x}_{t+\Delta t})] d\boldsymbol{x}_t$$</p>
<p>代入上式：<br />
$$\int p_{t+\Delta t}(\boldsymbol{x}) \phi(\boldsymbol{x}) d\boldsymbol{x} = \int p_t(\boldsymbol{x}_t) \phi(\boldsymbol{x}_t) d\boldsymbol{x}_t + \Delta t \int p_t(\boldsymbol{x}_t) \left[\boldsymbol{f}_t \cdot \nabla \phi + \frac{g_t^2}{2} \Delta \phi\right] d\boldsymbol{x}_t + O(\Delta t^{3/2})$$</p>
<p><strong>5.10 弱形式的推导</strong></p>
<p>移项并取$\Delta t \to 0$：<br />
$$\int \frac{\partial p_t}{\partial t} \phi \, d\boldsymbol{x} = \int p_t \boldsymbol{f}_t \cdot \nabla \phi \, d\boldsymbol{x} + \int p_t \frac{g_t^2}{2} \Delta \phi \, d\boldsymbol{x}$$</p>
<p>这是Fokker-Planck方程的弱形式。</p>
<p><strong>5.11 第一项的分部积分</strong></p>
<p>对第一项应用分部积分：<br />
$$\int p_t \boldsymbol{f}_t \cdot \nabla \phi \, d\boldsymbol{x} = -\int \nabla \cdot (p_t \boldsymbol{f}_t) \phi \, d\boldsymbol{x}$$</p>
<p><strong>5.12 第二项的分部积分</strong></p>
<p>对第二项，需要应用两次分部积分。首先：<br />
$$\int p_t \Delta \phi \, d\boldsymbol{x} = \int p_t \nabla \cdot (\nabla \phi) \, d\boldsymbol{x}$$</p>
<p>第一次分部积分（$u = p_t$，$\boldsymbol{v} = \nabla \phi$）：<br />
$$\int p_t \nabla \cdot (\nabla \phi) \, d\boldsymbol{x} = -\int \nabla p_t \cdot \nabla \phi \, d\boldsymbol{x}$$</p>
<p>第二次分部积分（现在$\nabla \phi$看作"测试向量场"）：<br />
$$-\int \nabla p_t \cdot \nabla \phi \, d\boldsymbol{x} = \int \nabla \cdot (\nabla p_t) \phi \, d\boldsymbol{x} = \int \Delta p_t \, \phi \, d\boldsymbol{x}$$</p>
<p>因此：<br />
$$\int p_t \frac{g_t^2}{2} \Delta \phi \, d\boldsymbol{x} = \int \frac{g_t^2}{2} \Delta p_t \, \phi \, d\boldsymbol{x}$$</p>
<p><strong>5.13 Fokker-Planck方程的强形式</strong></p>
<p>综合两项：<br />
$$\int \frac{\partial p_t}{\partial t} \phi \, d\boldsymbol{x} = \int \left[-\nabla \cdot (p_t \boldsymbol{f}_t) + \frac{g_t^2}{2} \Delta p_t\right] \phi \, d\boldsymbol{x}$$</p>
<p>由于对任意$\phi$成立，得到Fokker-Planck方程：<br />
$$\frac{\partial p_t}{\partial t} = -\nabla \cdot (p_t \boldsymbol{f}_t) + \frac{g_t^2}{2} \Delta p_t$$</p>
<p>或写成：<br />
$$\frac{\partial p_t}{\partial t} = -\nabla \cdot (p_t \boldsymbol{f}_t) + \frac{1}{2}\nabla \cdot (g_t^2 \nabla p_t)$$</p>
<p>后一种形式更清楚地显示了方程的对流-扩散结构。</p>
<p><strong>5.14 Fokker-Planck方程的展开形式</strong></p>
<p>展开散度项：<br />
$$\nabla \cdot (p_t \boldsymbol{f}_t) = \boldsymbol{f}_t \cdot \nabla p_t + p_t \nabla \cdot \boldsymbol{f}_t$$</p>
<p>$$\frac{g_t^2}{2}\Delta p_t = \frac{g_t^2}{2} \nabla \cdot \nabla p_t$$</p>
<p>完整方程：<br />
$$\frac{\partial p_t}{\partial t} = -\boldsymbol{f}_t \cdot \nabla p_t - p_t \nabla \cdot \boldsymbol{f}_t + \frac{g_t^2}{2} \Delta p_t$$</p>
<p>这可以写成：<br />
$$\frac{\partial p_t}{\partial t} + \boldsymbol{f}_t \cdot \nabla p_t = -p_t \nabla \cdot \boldsymbol{f}_t + \frac{g_t^2}{2} \Delta p_t$$</p>
<p>左边是对流项（沿着流的导数），右边第一项是压缩/膨胀项，第二项是扩散项。</p>
<h3 id="6">6. 边界条件与稳态解<a class="toc-link" href="#6" title="Permanent link">&para;</a></h3>
<p><strong>6.1 边界条件的类型</strong></p>
<p>对于Fokker-Planck方程，常见的边界条件包括：</p>
<p><strong>（1）无穷远边界条件</strong>：<br />
$$\lim_{|\boldsymbol{x}| \to \infty} p_t(\boldsymbol{x}) = 0, \quad \lim_{|\boldsymbol{x}| \to \infty} \nabla p_t(\boldsymbol{x}) = \boldsymbol{0}$$</p>
<p><strong>（2）反射边界条件</strong>（reflecting boundary）：在边界$\partial\Omega$上，法向通量为零：<br />
$$(p_t \boldsymbol{f}_t - \frac{g_t^2}{2}\nabla p_t) \cdot \hat{\boldsymbol{n}} = 0$$</p>
<p><strong>（3）吸收边界条件</strong>（absorbing boundary）：在边界上，密度为零：<br />
$$p_t(\boldsymbol{x}) = 0, \quad \boldsymbol{x} \in \partial\Omega$$</p>
<p><strong>6.2 稳态解</strong></p>
<p>稳态解满足$\frac{\partial p}{\partial t} = 0$，即：<br />
$$-\nabla \cdot (p \boldsymbol{f}) + \frac{g^2}{2} \Delta p = 0$$</p>
<p>或写成：<br />
$$\nabla \cdot \left(p \boldsymbol{f} - \frac{g^2}{2}\nabla p\right) = 0$$</p>
<p>这意味着概率流密度（probability current）：<br />
$$\boldsymbol{J} = p \boldsymbol{f} - \frac{g^2}{2}\nabla p$$<br />
是无散的。</p>
<p><strong>6.3 详细平衡条件</strong></p>
<p>如果稳态解满足详细平衡（detailed balance）：<br />
$$\boldsymbol{J} = p \boldsymbol{f} - \frac{g^2}{2}\nabla p = \boldsymbol{0}$$</p>
<p>则有：<br />
$$p \boldsymbol{f} = \frac{g^2}{2}\nabla p$$</p>
<p>即：<br />
$$\boldsymbol{f} = \frac{g^2}{2p}\nabla p = \frac{g^2}{2}\nabla \ln p$$</p>
<p><strong>6.4 势函数与Boltzmann分布</strong></p>
<p>如果漂移项可以写成势函数的梯度：<br />
$$\boldsymbol{f}(\boldsymbol{x}) = -\nabla V(\boldsymbol{x})$$</p>
<p>则详细平衡条件变为：<br />
$$-\nabla V = \frac{g^2}{2}\nabla \ln p$$</p>
<p>即：<br />
$$\nabla \ln p = -\frac{2}{g^2}\nabla V$$</p>
<p>积分得：<br />
$$\ln p = -\frac{2V}{g^2} + C$$</p>
<p>因此稳态分布为Boltzmann分布：<br />
$$p(\boldsymbol{x}) \propto \exp\left(-\frac{2V(\boldsymbol{x})}{g^2}\right)$$</p>
<p>如果定义"温度"$T = \frac{g^2}{2}$（在物理单位中），则：<br />
$$p(\boldsymbol{x}) \propto \exp\left(-\frac{V(\boldsymbol{x})}{T}\right)$$</p>
<p>这是统计物理中的经典结果。</p>
<p><strong>6.5 稳态解的唯一性</strong></p>
<p>在适当条件下（如$\boldsymbol{f}$满足某种增长条件），稳态解是唯一的。这可以通过能量方法或者Lyapunov函数来证明。</p>
<p>考虑相对熵（Kullback-Leibler散度）：<br />
$$H(p_t | p_\infty) = \int p_t(\boldsymbol{x}) \ln\frac{p_t(\boldsymbol{x})}{p_\infty(\boldsymbol{x})} d\boldsymbol{x}$$</p>
<p>其中$p_\infty$是稳态解。可以证明：<br />
$$\frac{dH}{dt} \leq 0$$</p>
<p>且$\frac{dH}{dt} = 0$当且仅当$p_t = p_\infty$。这证明了系统最终会收敛到稳态。</p>
<h3 id="7-langevin">7. 与Langevin动力学的联系<a class="toc-link" href="#7-langevin" title="Permanent link">&para;</a></h3>
<p><strong>7.1 Langevin方程</strong></p>
<p>Langevin方程描述受到摩擦和随机力作用的粒子运动：<br />
$$m\frac{d^2 \boldsymbol{x}}{dt^2} = -\gamma \frac{d\boldsymbol{x}}{dt} - \nabla V(\boldsymbol{x}) + \boldsymbol{\xi}(t)$$</p>
<p>其中$\gamma$是摩擦系数，$V$是势能，$\boldsymbol{\xi}(t)$是随机力，满足：<br />
$$\langle \xi_i(t) \rangle = 0, \quad \langle \xi_i(t)\xi_j(t') \rangle = 2\gamma k_B T \delta_{ij}\delta(t-t')$$</p>
<p><strong>7.2 过阻尼极限</strong></p>
<p>在过阻尼（overdamped）极限下，$m \to 0$或$\gamma \to \infty$，惯性项可以忽略：<br />
$$\gamma \frac{d\boldsymbol{x}}{dt} = -\nabla V(\boldsymbol{x}) + \boldsymbol{\xi}(t)$$</p>
<p>即：<br />
$$d\boldsymbol{x} = -\frac{1}{\gamma}\nabla V(\boldsymbol{x}) dt + \frac{1}{\gamma}\boldsymbol{\xi}(t)dt$$</p>
<p>将随机力写成布朗运动形式，$\boldsymbol{\xi}(t)dt = \sqrt{2\gamma k_B T} d\boldsymbol{w}_t$：<br />
$$d\boldsymbol{x} = -\frac{1}{\gamma}\nabla V(\boldsymbol{x}) dt + \sqrt{\frac{2k_B T}{\gamma}} d\boldsymbol{w}_t$$</p>
<p><strong>7.3 对应的Fokker-Planck方程</strong></p>
<p>根据前面的推导，这个SDE对应的Fokker-Planck方程为：<br />
$$\frac{\partial p}{\partial t} = \nabla \cdot \left[\frac{1}{\gamma}\nabla V \, p + \frac{k_B T}{\gamma}\nabla p\right]$$</p>
<p>即：<br />
$$\frac{\partial p}{\partial t} = \frac{1}{\gamma}\nabla \cdot \left[\nabla V \, p + k_B T\nabla p\right]$$</p>
<p>这称为<strong>Smoluchowski方程</strong>，是Fokker-Planck方程在过阻尼Langevin动力学中的具体形式。</p>
<p><strong>7.4 平衡态验证</strong></p>
<p>稳态解满足：<br />
$$\nabla V \, p_\infty + k_B T\nabla p_\infty = \boldsymbol{0}$$</p>
<p>即：<br />
$$\nabla V \, p_\infty = -k_B T\nabla p_\infty$$</p>
<p>$$\nabla V = -k_B T\nabla \ln p_\infty$$</p>
<p>积分：<br />
$$p_\infty(\boldsymbol{x}) = \frac{1}{Z}\exp\left(-\frac{V(\boldsymbol{x})}{k_B T}\right)$$</p>
<p>其中$Z = \int \exp(-V/k_B T)d\boldsymbol{x}$是配分函数。这正是经典统计力学的正则分布！</p>
<h3 id="8">8. 数值求解方法<a class="toc-link" href="#8" title="Permanent link">&para;</a></h3>
<p><strong>8.1 有限差分方法</strong></p>
<p>对于一维Fokker-Planck方程：<br />
$$\frac{\partial p}{\partial t} = -\frac{\partial}{\partial x}(f(x)p) + \frac{g^2}{2}\frac{\partial^2 p}{\partial x^2}$$</p>
<p>采用前向Euler时间离散和中心差分空间离散：<br />
$$\frac{p_i^{n+1} - p_i^n}{\Delta t} = -\frac{(fp)<em i-1_2="i-1/2">{i+1/2}^n - (fp)</em>$$}^n}{\Delta x} + \frac{g^2}{2}\frac{p_{i+1}^n - 2p_i^n + p_{i-1}^n}{(\Delta x)^2</p>
<p>其中$p_i^n \approx p(x_i, t_n)$。</p>
<p><strong>8.2 上风格式</strong></p>
<p>对流项需要特别处理以保证数值稳定性。采用上风（upwind）格式：<br />
$$(fp)<em i_1_2="i+1/2">{i+1/2} = \begin{cases}<br />
f</em> \geq 0 \}p_i &amp; \text{if } f_{i+1/2<br />
f_{i+1/2}p_{i+1} &amp; \text{if } f_{i+1/2} &lt; 0<br />
\end{cases}$$</p>
<p>这保证了数值格式的单调性和稳定性。</p>
<p><strong>8.3 CFL条件</strong></p>
<p>数值稳定性要求时间步长满足CFL（Courant-Friedrichs-Lewy）条件：<br />
$$\Delta t \leq \min\left{\frac{\Delta x}{|f|_{\max}}, \frac{(\Delta x)^2}{g^2}\right}$$</p>
<p>第一项来自对流项，第二项来自扩散项。</p>
<p><strong>8.4 蒙特卡洛方法</strong></p>
<p>另一种方法是直接模拟SDE：<br />
$$\boldsymbol{x}_{n+1} = \boldsymbol{x}_n + \boldsymbol{f}(\boldsymbol{x}_n)\Delta t + g\sqrt{\Delta t}\boldsymbol{\varepsilon}_n$$</p>
<p>其中$\boldsymbol{\varepsilon}_n \sim \mathcal{N}(\boldsymbol{0}, \boldsymbol{I})$。</p>
<p>通过大量粒子的统计，可以估计概率密度：<br />
$$p_t(\boldsymbol{x}) \approx \frac{1}{N}\sum_{i=1}^N K_h(\boldsymbol{x} - \boldsymbol{x}_t^{(i)})$$</p>
<p>其中$K_h$是带宽为$h$的核函数（如高斯核）。</p>
<p><strong>8.5 谱方法</strong></p>
<p>对于周期边界条件，可以使用傅里叶谱方法。将$p(\boldsymbol{x}, t)$展开为傅里叶级数：<br />
$$p(\boldsymbol{x}, t) = \sum_{\boldsymbol{k}} \hat{p}_{\boldsymbol{k}}(t) e^{i\boldsymbol{k}\cdot\boldsymbol{x}}$$</p>
<p>Fokker-Planck方程在傅里叶空间变为ODE：<br />
$$\frac{d\hat{p}<em _boldsymbol_k="\boldsymbol{k">{\boldsymbol{k}}}{dt} = -i\boldsymbol{k} \cdot \widehat{(fp)}</em>$$}} - \frac{g^2}{2}|\boldsymbol{k}|^2 \hat{p}_{\boldsymbol{k}</p>
<p>这可以高精度地求解，但卷积项$\widehat{(fp)}_{\boldsymbol{k}}$的计算需要FFT。</p>
<p><strong>8.6 有限元方法</strong></p>
<p>将$p$在测试函数空间中展开：<br />
$$p(\boldsymbol{x}, t) = \sum_j p_j(t) \varphi_j(\boldsymbol{x})$$</p>
<p>其中${\varphi_j}$是有限元基函数。将此代入弱形式：<br />
$$\int \frac{\partial p}{\partial t} \phi \, d\boldsymbol{x} = \int \left[-\nabla \cdot (p\boldsymbol{f}) + \frac{g^2}{2}\Delta p\right] \phi \, d\boldsymbol{x}$$</p>
<p>取$\phi = \varphi_i$，得到ODE系统：<br />
$$M\frac{d\boldsymbol{p}}{dt} = A\boldsymbol{p}$$</p>
<p>其中$M_{ij} = \int \varphi_i\varphi_j d\boldsymbol{x}$是质量矩阵，$A_{ij}$包含对流和扩散项的贡献。</p>
<h3 id="9">9. 物理意义与多角度理解<a class="toc-link" href="#9" title="Permanent link">&para;</a></h3>
<p><strong>9.1 概率论视角</strong></p>
<p>从概率论角度，Fokker-Planck方程描述了随机过程$\boldsymbol{x}_t$的概率密度$p_t(\boldsymbol{x})$如何演化。它是Chapman-Kolmogorov方程在连续时间、连续状态空间中的微分形式。</p>
<p><strong>转移概率密度</strong>：定义$\mathcal{P}(t, \boldsymbol{x} | s, \boldsymbol{y})$为从$(s, \boldsymbol{y})$转移到$(t, \boldsymbol{x})$的条件概率密度，则：<br />
$$p_t(\boldsymbol{x}) = \int \mathcal{P}(t, \boldsymbol{x} | 0, \boldsymbol{y}) p_0(\boldsymbol{y}) d\boldsymbol{y}$$</p>
<p><strong>9.2 偏微分方程视角</strong></p>
<p>从PDE角度，Fokker-Planck方程是一个<strong>抛物型方程</strong>，结合了：<br />
- <strong>对流项</strong>：$-\nabla \cdot (p\boldsymbol{f})$，描述确定性漂移<br />
- <strong>扩散项</strong>：$\frac{g^2}{2}\Delta p$，描述随机扩散</p>
<p>这类似于对流-扩散方程：<br />
$$\frac{\partial u}{\partial t} + \boldsymbol{v} \cdot \nabla u = D\Delta u$$</p>
<p>但Fokker-Planck方程的对流项有特殊形式（守恒形式）。</p>
<p><strong>9.3 统计力学视角</strong></p>
<p>在统计力学中，Fokker-Planck方程描述了相空间中的概率流。对于Hamiltonian系统加上耗散和噪声：<br />
$$\dot{\boldsymbol{q}} = \frac{\partial H}{\partial \boldsymbol{p}}, \quad \dot{\boldsymbol{p}} = -\frac{\partial H}{\partial \boldsymbol{q}} - \gamma\boldsymbol{p} + \boldsymbol{\xi}(t)$$</p>
<p>其相空间分布满足相应的Fokker-Planck方程。</p>
<p><strong>9.4 信息论视角</strong></p>
<p>从信息论角度，Fokker-Planck方程描述了系统的Shannon熵：<br />
$$S(t) = -\int p_t(\boldsymbol{x}) \ln p_t(\boldsymbol{x}) d\boldsymbol{x}$$</p>
<p>的演化。可以证明，对于满足详细平衡的系统：<br />
$$\frac{dS}{dt} \geq 0$$</p>
<p>这是热力学第二定律的微观体现（$H$定理）。</p>
<p><strong>9.5 机器学习视角</strong></p>
<p>在扩散模型（diffusion models）中：<br />
- <strong>前向过程</strong>：向数据添加噪声，对应SDE：<br />
  $$d\boldsymbol{x} = -\frac{1}{2}\boldsymbol{x}dt + d\boldsymbol{w}$$</p>
<ul>
<li><strong>逆向过程</strong>：从噪声恢复数据，对应逆时间SDE：<br />
  $$d\boldsymbol{x} = \left[-\frac{1}{2}\boldsymbol{x} + \nabla \ln p_t(\boldsymbol{x})\right]dt + d\bar{\boldsymbol{w}}$$</li>
</ul>
<p>Fokker-Planck方程用于分析分布$p_t$的演化。</p>
<h3 id="10">10. 总结与推广<a class="toc-link" href="#10" title="Permanent link">&para;</a></h3>
<p><strong>10.1 方法总结</strong></p>
<p>测试函数法的核心步骤：<br />
1. 将动力学方程（ODE/SDE）离散化<br />
2. 对测试函数进行泰勒展开<br />
3. 对随机性取期望（如有）<br />
4. 对初始分布取期望，建立弱形式<br />
5. 应用分部积分转移导数<br />
6. 由测试函数的任意性得到强形式</p>
<p><strong>10.2 推广方向</strong></p>
<p>该方法可以推广到：<br />
- <strong>空间相关的扩散</strong>：$G_t(\boldsymbol{x})$是矩阵函数<br />
- <strong>跳跃过程</strong>：包含Poisson跳跃的过程<br />
- <strong>分数阶导数</strong>：非局部算子<br />
- <strong>非线性方程</strong>：如Burgers方程<br />
- <strong>无穷维情况</strong>：随机偏微分方程（SPDE）</p>
<p><strong>10.3 理论意义</strong></p>
<p>测试函数法是现代PDE理论的基础，连接了：<br />
- 经典的强解理论<br />
- 现代的弱解和分布理论<br />
- 数值分析中的变分方法<br />
- 物理中的守恒律</p>
<p>它为理解随机过程、偏微分方程和概率分布的演化提供了统一的框架。</p>
                </div>

                <!-- Previous/Next Navigation -->
                <nav class="post-navigation" aria-label="文章导航">
                    <div class="row g-3">
                        <div class="col-6">
                            
                            <a href="transformer升级之路8长度外推性与位置鲁棒性.html" class="nav-link-prev">
                                <div class="nav-direction"><i class="fas fa-chevron-left"></i> 上一篇</div>
                                <div class="nav-title">#75 Transformer升级之路：8、长度外推性与位置鲁棒性</div>
                            </a>
                            
                        </div>
                        <div class="col-6">
                            
                            <a href="生成扩散模型漫谈十六w距离-得分匹配.html" class="nav-link-next">
                                <div class="nav-direction">下一篇 <i class="fas fa-chevron-right"></i></div>
                                <div class="nav-title">#77 生成扩散模型漫谈（十六）：W距离 ≤ 得分匹配</div>
                            </a>
                            
                        </div>
                    </div>
                </nav>

                <!-- Back to Home -->
                <div class="text-center mt-4 mb-4">
                    <a href="../index.html" class="btn btn-outline-primary">
                        <i class="fas fa-arrow-left"></i> 返回首页
                    </a>
                </div>
            </div>

            <!-- Sidebar (TOC) -->
            <div class="col-lg-3">
                <aside class="sidebar">
                    
                    <div class="toc-sidebar">
                        <h5 class="toc-title"><i class="fas fa-list"></i> 目录</h5>
                        <div class="toc-content">
                            <div class="toc">
<ul>
<li><a href="#fokker-planck">测试函数法推导连续性方程和Fokker-Planck方程</a><ul>
<li><a href="#_1">分部积分</a></li>
<li><a href="#ode">ODE演化</a></li>
<li><a href="#sde">SDE演化</a></li>
<li><a href="#_2">文章小结</a></li>
<li><a href="#_3">公式推导与注释</a><ul>
<li><a href="#1">1. 测试函数的定义与性质</a></li>
<li><a href="#2">2. 弱形式与强形式的关系</a></li>
<li><a href="#3">3. 高维分部积分的详细推导</a></li>
<li><a href="#4">4. 连续性方程的完整推导</a></li>
<li><a href="#5-fokker-planck">5. Fokker-Planck方程的完整推导</a></li>
<li><a href="#6">6. 边界条件与稳态解</a></li>
<li><a href="#7-langevin">7. 与Langevin动力学的联系</a></li>
<li><a href="#8">8. 数值求解方法</a></li>
<li><a href="#9">9. 物理意义与多角度理解</a></li>
<li><a href="#10">10. 总结与推广</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

                        </div>
                        <div class="toc-actions">
                            <button class="btn btn-sm btn-outline-secondary" onclick="expandAll()">
                                <i class="fas fa-expand"></i> 全部展开
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="collapseAll()">
                                <i class="fas fa-compress"></i> 全部折叠
                            </button>
                        </div>
                    </div>
                    

                    <!-- Back to Top Button -->
                    <button id="backToTop" class="back-to-top" title="回到顶部">
                        <i class="fas fa-arrow-up"></i>
                    </button>
                </aside>
            </div>
        </div>
    </article>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>
                博客来源: <a href="https://spaces.ac.cn" target="_blank">科学空间</a> |
                内容经过整理并添加详细数学推导
            </p>
            <p>
                Powered by <a href="https://pages.github.com/" target="_blank">GitHub Pages</a>
            </p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Syntax highlighting -->
    <script>hljs.highlightAll();</script>

    <!-- Back to top functionality -->
    <script>
        // Show/hide back to top button based on scroll position
        window.addEventListener('scroll', function() {
            const backToTop = document.getElementById('backToTop');
            if (window.pageYOffset > 300) {
                backToTop.classList.add('show');
            } else {
                backToTop.classList.remove('show');
            }
        });

        // Smooth scroll to top
        document.getElementById('backToTop').addEventListener('click', function() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        // Sticky TOC sidebar
        window.addEventListener('scroll', function() {
            const sidebar = document.querySelector('.sidebar');
            if (!sidebar) return;

            const sidebarTop = sidebar.offsetTop;
            const scrollTop = window.pageYOffset;

            if (scrollTop > sidebarTop - 20) {
                sidebar.classList.add('sticky');
            } else {
                sidebar.classList.remove('sticky');
            }
        });
    </script>
</body>
</html>