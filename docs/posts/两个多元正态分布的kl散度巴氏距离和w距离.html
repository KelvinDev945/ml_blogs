<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>两个多元正态分布的KL散度、巴氏距离和W距离 | ML & Math Blog Posts</title>
    <meta name="description" content="两个多元正态分布的KL散度、巴氏距离和W距离&para;
原文链接: https://spaces.ac.cn/archives/8512
发布日期: 

正态分布是最常见的连续型概率分布之一。它是给定均值和协方差后的最大熵分布（参考《“熵”不起：从熵、最大熵原理到最大熵模型（二）》），也可以看作任意连续型分布的二阶近似，它的地位就相当于一般函数的线性近似。从这个角度来看，正态分布算得上是最简单的...">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css">

    <!-- Google Fonts -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/post.css">

    <!-- Custom JS -->
    <script src="../assets/js/collapsible.js" defer></script>

    <!-- MathJax for math rendering with equation numbering -->
    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true,
        processEnvironments: true,
        tags: 'ams',  // Enable equation numbering with AMS style
        tagSide: 'right',  // Place equation numbers on the right
        tagIndent: '0.8em',  // Indentation for equation numbers
        multlineWidth: '85%'
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Syntax highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/github.min.css">
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/highlight.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
        <div class="container">
            <a class="navbar-brand" href="../index.html">
                <i class="fas fa-brain"></i> ML & Math Blog
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../index.html"><i class="fas fa-home"></i> 首页</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Post Content -->
    <article class="container post-container my-5">
        <!-- Breadcrumb Navigation -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="../index.html"><i class="fas fa-home"></i> 首页</a></li>
                
                <li class="breadcrumb-item"><a href="../index.html?tags=概率">概率</a></li>
                
                <li class="breadcrumb-item active" aria-current="page">
                    #16 两个多元正态分布的KL散度、巴氏距离和W距离
                </li>
            </ol>
        </nav>

        <!-- Post Header -->
        <header class="post-header mb-4">
            <h1 class="post-title">
                <span class="post-number">#16</span>
                两个多元正态分布的KL散度、巴氏距离和W距离
            </h1>
            <div class="post-meta">
                <span><i class="far fa-calendar"></i> </span>
                
                <span class="ms-3">
                    <i class="fas fa-link"></i>
                    <a href="https://spaces.ac.cn/archives/8512" target="_blank" rel="noopener">原文链接</a>
                </span>
                
            </div>
            
            <div class="post-tags mt-3">
                
                <a href="../index.html?tags=概率" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> 概率</span>
                </a>
                
                <a href="../index.html?tags=矩阵" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> 矩阵</span>
                </a>
                
                <a href="../index.html?tags=优化" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> 优化</span>
                </a>
                
                <a href="../index.html?tags=生成模型" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> 生成模型</span>
                </a>
                
                <a href="../index.html?tags=attention" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> attention</span>
                </a>
                
            </div>
            
        </header>

        <div class="row">
            <!-- Main Content -->
            <div class="col-lg-9">
                <!-- Post Body -->
                <div class="post-content">
                    <h1 id="klw">两个多元正态分布的KL散度、巴氏距离和W距离<a class="toc-link" href="#klw" title="Permanent link">&para;</a></h1>
<p><strong>原文链接</strong>: <a href="https://spaces.ac.cn/archives/8512">https://spaces.ac.cn/archives/8512</a></p>
<p><strong>发布日期</strong>: </p>
<hr />
<p>正态分布是最常见的连续型概率分布之一。它是给定均值和协方差后的最大熵分布（参考<a href="/archives/3552">《“熵”不起：从熵、最大熵原理到最大熵模型（二）》</a>），也可以看作任意连续型分布的二阶近似，它的地位就相当于一般函数的线性近似。从这个角度来看，正态分布算得上是最简单的连续型分布了。也正因为简单，所以对于很多估计量来说，它都能写出解析解来。</p>
<p>本文主要来计算两个多元正态分布的几种度量，包括KL散度、巴氏距离和W距离，它们都有显式解析解。</p>
<h2 id="_1">正态分布<a class="toc-link" href="#_1" title="Permanent link">&para;</a></h2>
<p>这里简单回顾一下正态分布的一些基础知识。注意，仅仅是回顾，这还不足以作为正态分布的入门教程。</p>
<h3 id="_2">概率密度<a class="toc-link" href="#_2" title="Permanent link">&para;</a></h3>
<p>正态分布，也即高斯分布，是定义在$\mathbb{R}^n$上的连续型概率分布，其概率密度函数为<br />
\begin{equation}p(\boldsymbol{x})=\frac{1}{\sqrt{(2\pi)^n \det(\boldsymbol{\Sigma})}}\exp\left\{-\frac{1}{2}(\boldsymbol{x}-\boldsymbol{\mu})^{\top}\boldsymbol{\Sigma}^{-1}(\boldsymbol{x}-\boldsymbol{\mu})\right\}\end{equation}<br />
这里的$\boldsymbol{x},\boldsymbol{\mu}\in\mathbb{R}^n$，$\boldsymbol{\mu}$即均值向量（本文的向量默认情况下都为列向量），而$\boldsymbol{\Sigma}\in\mathbb{R}^{n\times n}$即为协方差矩阵，它要求是正定对称的。可以看到，正态分布由$\boldsymbol{\mu}$和$\boldsymbol{\Sigma}$唯一确定，因此不难想象它的统计量都是$\boldsymbol{\mu}$和$\boldsymbol{\Sigma}$的函数。当$\boldsymbol{\mu}=\boldsymbol{0}, \boldsymbol{\Sigma}=\boldsymbol{I}$时，对应的分布称为“标准正态分布”。</p>
<h3 id="_3">基本性质<a class="toc-link" href="#_3" title="Permanent link">&para;</a></h3>
<p>通常来说，基本的统计量就是均值和方差了，它们对应着正态分布的两个参数：<br />
\begin{equation}\begin{aligned}
\mathbb{E}<em _boldsymbol_x="\boldsymbol{x">{\boldsymbol{x}}\left[\boldsymbol{x}\right]=&amp;\int p(\boldsymbol{x}) \boldsymbol{x} dx=\boldsymbol{\mu}\\
\mathbb{E}</em>\\}}\left[(\boldsymbol{x}-\boldsymbol{\mu})(\boldsymbol{x}-\boldsymbol{\mu})^{\top}\right]=&amp;\int p(\boldsymbol{x}) (\boldsymbol{x}-\boldsymbol{\mu})(\boldsymbol{x}-\boldsymbol{\mu})^{\top} dx=\boldsymbol{\Sigma
\end{aligned}\end{equation}<br />
由此也可以推出二阶矩的结果：<br />
\begin{equation}
\mathbb{E}<em _boldsymbol_x="\boldsymbol{x">{\boldsymbol{x}}\left[\boldsymbol{x}\boldsymbol{x}^{\top}\right]=\boldsymbol{\mu}\boldsymbol{\mu}^{\top} + \mathbb{E}</em>}}\left[(\boldsymbol{x}-\boldsymbol{\mu})(\boldsymbol{x}-\boldsymbol{\mu})^{\top}\right]=\boldsymbol{\mu}\boldsymbol{\mu}^{\top} + \boldsymbol{\Sigma}\end{equation
还有一个常用的统计量是它的熵：
\begin{equation}\mathcal{H} = \mathbb{E}_{\boldsymbol{x}}\left[-\log p(\boldsymbol{x})\right]=\frac{n}{2}(1 + \log 2\pi) + \frac{1}{2}\log \det(\boldsymbol{\Sigma})<br />
\end{equation}<br />
其计算过程可以参考后面KL散度的推导。</p>
<h3 id="_4">高斯积分<a class="toc-link" href="#_4" title="Permanent link">&para;</a></h3>
<p>概率密度函数意味着$\int p(\boldsymbol{x}) d\boldsymbol{x} = 1$，这就可以推出：<br />
\begin{equation}\begin{aligned}
\sqrt{(2\pi)^n \det(\boldsymbol{\Sigma})} =&amp; \int\exp\left\{-\frac{1}{2}(\boldsymbol{x}-\boldsymbol{\mu})^{\top}\boldsymbol{\Sigma}^{-1}(\boldsymbol{x}-\boldsymbol{\mu})\right\}d\boldsymbol{x} \\
=&amp; \int\exp\left\{-\frac{1}{2}\boldsymbol{x}^{\top}\boldsymbol{\Sigma}^{-1}\boldsymbol{x}+\boldsymbol{\mu}^{\top}\boldsymbol{\Sigma}^{-1}\boldsymbol{x}-\frac{1}{2}\boldsymbol{\mu}^{\top}\boldsymbol{\Sigma}^{-1}\boldsymbol{\mu}\right\}d\boldsymbol{x}
\end{aligned}\end{equation}<br />
设$\boldsymbol{\omega} = \boldsymbol{\Sigma}^{-1}\boldsymbol{\mu}$，那么得到高斯积分<br />
\begin{equation}
\int\exp\left\{-\frac{1}{2}\boldsymbol{x}^{\top}\boldsymbol{\Sigma}^{-1}\boldsymbol{x}+\boldsymbol{\omega}^{\top}\boldsymbol{x}\right\}d\boldsymbol{x} = \sqrt{(2\pi)^n \det(\boldsymbol{\Sigma})}\exp\left\{\frac{1}{2}\boldsymbol{\omega}^{\top}\boldsymbol{\Sigma}\boldsymbol{\omega}\right\}\label{eq:g-int}
\end{equation}<br />
利用它我们可以算出正态分布的特征函数<br />
\begin{equation}\mathbb{E}_{\boldsymbol{x}}\left[\exp\left(\boldsymbol{\omega}^{\top}\boldsymbol{x}\right)\right]=\exp\left(\boldsymbol{\omega}^{\top}\boldsymbol{\mu}+\frac{1}{2}\boldsymbol{\omega}^{\top}\boldsymbol{\Sigma}\boldsymbol{\omega}\right)\\
\end{equation}<br />
特征函数可以用来算正态分布的各阶矩。</p>
<h2 id="_5">线性代数<a class="toc-link" href="#_5" title="Permanent link">&para;</a></h2>
<p>这里补充一些线性代数基础，它们在后面的推导中会频繁用到。同样地，这仅仅是“回顾”，并不能作为线性代数教程。</p>
<h3 id="_6">内积范数<a class="toc-link" href="#_6" title="Permanent link">&para;</a></h3>
<p>首先，我们来定义内积和范数。对于向量$\boldsymbol{x}=(x_1,\cdots,x_n)$和$\boldsymbol{y}=(y_1,\cdots,y_n)$，内积按照<br />
\begin{equation}\langle\boldsymbol{x},\boldsymbol{y}\rangle = \sum_{i=1}^n x_i y_i\end{equation}<br />
来定义，而模长定义为$\Vert \boldsymbol{x}\Vert = \sqrt{\langle\boldsymbol{x},\boldsymbol{x}\rangle}$。对于$m\times n$的矩阵$\boldsymbol{A}=(a_{i,j}),\boldsymbol{B}=(b_{i,j})$，我们按照类似的方式定义：<br />
\begin{equation}\langle\boldsymbol{A},\boldsymbol{B}\rangle_F = \sum_{i=1}^m\sum_{j=1}^n a_{i,j} b_{i,j}\end{equation}<br />
这称为Frobenius内积，对应的$\Vert \boldsymbol{A}\Vert_F = \sqrt{\langle\boldsymbol{A},\boldsymbol{A}\rangle_F}$称为Frobenius范数。不难看到，Frobenius内积和范数，事实上就是把矩阵展平为向量后，当作常规的向量来运算。</p>
<p>关于Frobenius内积，最关键的性质之一是成立恒等式<br />
\begin{equation}\langle\boldsymbol{A},\boldsymbol{B}\rangle_F = \text{Tr}\left(\boldsymbol{A}^{\top}\boldsymbol{B}\right) = \text{Tr}\left(\boldsymbol{B}\boldsymbol{A}^{\top}\right) = \text{Tr}\left(\boldsymbol{A}\boldsymbol{B}^{\top}\right) = \text{Tr}\left(\boldsymbol{B}^{\top}\boldsymbol{A}\right) \end{equation}<br />
也就是说，矩阵的Frobenius内积可以转化为矩阵乘法的迹，并且交换相乘顺序不改变结果（不改变迹的结果，但是矩阵乘法的整体结果会改变）。</p>
<h3 id="_7">正定对称<a class="toc-link" href="#_7" title="Permanent link">&para;</a></h3>
<p>接着，来看正定对称矩阵的一些性质。$\boldsymbol{\Sigma}$是一个正定对称矩阵，对称说的是$\boldsymbol{\Sigma}^{\top}=\boldsymbol{\Sigma}$，正定说的是对于任意非零向量$\boldsymbol{\xi}\in\mathbb{R}^n$，都有$\boldsymbol{\xi}^{\top}\boldsymbol{\Sigma}\boldsymbol{\xi} &gt; 0$。可以证明，如果$\boldsymbol{\Sigma}_1,\boldsymbol{\Sigma}_2$都是正定对称矩阵，那么$\boldsymbol{\Sigma}_1^{-1},\boldsymbol{\Sigma}_2^{-1},\boldsymbol{\Sigma}_1+\boldsymbol{\Sigma}_2$也都是正定对称矩阵。如果$\boldsymbol{C} = \boldsymbol{B}^{\top}\boldsymbol{A}\boldsymbol{B}$，$\boldsymbol{B}$是可逆阵，那么$\boldsymbol{C}$是正定对称的当且仅当$\boldsymbol{A}$是正定对称的。</p>
<p>此外还有半正定的概念，指对于任意非零向量$\boldsymbol{\xi}\in\mathbb{R}^n$，都有$\boldsymbol{\xi}^{\top}\boldsymbol{\Sigma}\boldsymbol{\xi} \geq 0$，也就是说可能存在非零向量$\boldsymbol{\xi}$使得$\boldsymbol{\xi}^{\top}\boldsymbol{\Sigma}\boldsymbol{\xi} = 0$。不过考虑到正定矩阵在半正定矩阵中稠密，所以我们不严格区分正定和半正定了，统一按照正定矩阵来处理。</p>
<p>正定对称矩阵有一个重要的性质，那就是它的SVD分解跟特征值分解一致，即具有下述形式的分解<br />
\begin{equation}\boldsymbol{\Sigma} = \boldsymbol{U}\boldsymbol{\Lambda}\boldsymbol{U}^{\top}\end{equation}<br />
其中$\boldsymbol{U}$是正交矩阵，而$\boldsymbol{\Lambda}$是对角阵，并且对角线上的元素都是正的。该结果的一个直接推论是：正定对称矩阵都可以“开平方”，其平方根为$\boldsymbol{\Sigma}^{1/2} = \boldsymbol{U}\boldsymbol{\Lambda}^{1/2}\boldsymbol{U}^{\top}$，其中$\boldsymbol{\Lambda}^{1/2}$是指将对角线上的元素都开平方，可以检验平方根矩阵也是正定对称的。反过来，可以开平方的对称矩阵，一定也是正定对称矩阵。</p>
<h3 id="_8">矩阵求导<a class="toc-link" href="#_8" title="Permanent link">&para;</a></h3>
<p>最后，在求Wasserstein距离的时候，还需要用到一些矩阵求导公式，如果不了解的读者，可以直接参考维基百科的“<a href="https://en.wikipedia.org/wiki/Matrix_calculus">Matrix Calculus</a>”。当然，其实也不难，主要用到了<br />
\begin{equation}\frac{\partial\,\text{Tr}\left(\boldsymbol{X}\boldsymbol{A}\right)}{\partial \boldsymbol{X}} = \boldsymbol{A}\end{equation}<br />
剩下的可以结合迹的运算公式来派生出来，比如<br />
\begin{equation}\frac{\partial\,\text{Tr}\left(\boldsymbol{A}\boldsymbol{X}\boldsymbol{B}\right)}{\partial \boldsymbol{X}} = \frac{\partial\,\text{Tr}\left(\boldsymbol{X}\boldsymbol{B}\boldsymbol{A}\right)}{\partial \boldsymbol{X}} = \boldsymbol{B}\boldsymbol{A}\end{equation}</p>
<h2 id="kl">KL散度<a class="toc-link" href="#kl" title="Permanent link">&para;</a></h2>
<p>作为第一个尝试，我们来算两个高斯分布的<a href="https://en.wikipedia.org/wiki/Kullback%E2%80%93Leibler_divergence">KL散度（Kullback-​Leibler divergence）</a>。KL散度算是最常用的分布度量之一了，因为它积分之前需要取对数，这对于指数簇分布来说通常能得到相对简单的结果。此外它还跟“熵”有着比较紧密的联系。</p>
<h3 id="_9">计算结果<a class="toc-link" href="#_9" title="Permanent link">&para;</a></h3>
<p>两个概率分布的KL散度定义为<br />
\begin{equation}KL(p(\boldsymbol{x})\Vert q(\boldsymbol{x}))=\mathbb{E}<em _boldsymbol_x="\boldsymbol{x">{\boldsymbol{x}\sim p(\boldsymbol{x})}\left[\log \frac{p(\boldsymbol{x})}{q(\boldsymbol{x})}\right]=\mathbb{E}</em>}\sim p(\boldsymbol{x})}\left[\log p(\boldsymbol{x})\right]+\mathbb{E}_{\boldsymbol{x}\sim p(\boldsymbol{x})}\left[-\log q(\boldsymbol{x})\right]\end{equation
对于两个正态分布来说，计算结果是
\begin{equation}<br />
KL(p(\boldsymbol{x})\Vert q(\boldsymbol{x}))=\frac{1}{2}\left[(\boldsymbol{\mu}_p-\boldsymbol{\mu}_q)^{\top}\boldsymbol{\Sigma}_q^{-1}(\boldsymbol{\mu}_p-\boldsymbol{\mu}_q)-\log \det(\boldsymbol{\Sigma}_q^{-1}\boldsymbol{\Sigma}_p) + \text{Tr}\left(\boldsymbol{\Sigma}_q^{-1}\boldsymbol{\Sigma}_p\right) - n\right]<br />
\end{equation}<br />
特别地，当$q$是标准正态分布时，结果简化为<br />
\begin{equation}
KL(p(\boldsymbol{x})\Vert q(\boldsymbol{x}))=\frac{1}{2}\left[\Vert\boldsymbol{\mu}_p\Vert^2-\log \det(\boldsymbol{\Sigma}_p) + \text{Tr}(\boldsymbol{\Sigma}_p) - n\right]\end{equation}</p>
<h3 id="_10">推导过程<a class="toc-link" href="#_10" title="Permanent link">&para;</a></h3>
<p>从KL散度的定义知道，我们主要把$\mathbb{E}<em _boldsymbol_x="\boldsymbol{x">{\boldsymbol{x}\sim p(\boldsymbol{x})}\left[-\log q(\boldsymbol{x})\right]$算出来就行了：<br />
\begin{equation}\begin{aligned}
\mathbb{E}</em>}\sim p(\boldsymbol{x})}\left[-\log q(\boldsymbol{x})\right] =&amp;\, \mathbb{E<em _boldsymbol_x="\boldsymbol{x">{\boldsymbol{x}\sim p(\boldsymbol{x})}\left[\frac{n}{2}\log 2\pi + \frac{1}{2}\log \det(\Sigma_q) + \frac{1}{2}(\boldsymbol{x}-\boldsymbol{\mu}_q)^{\top}\boldsymbol{\Sigma}_q^{-1}(\boldsymbol{x}-\boldsymbol{\mu}_q)\right]\\
=&amp;\,\frac{n}{2}\log 2\pi + \frac{1}{2}\log \det(\boldsymbol{\Sigma}_q) + \frac{1}{2}\mathbb{E}</em>}\sim p(\boldsymbol{x})}\left[(\boldsymbol{x}-\boldsymbol{\mu<em _boldsymbol_x="\boldsymbol{x">q)^{\top}\boldsymbol{\Sigma}_q^{-1}(\boldsymbol{x}-\boldsymbol{\mu}_q)\right]
\end{aligned}\end{equation}<br />
现在，关于迹的恒等式就可以派上用场了：<br />
\begin{equation}\begin{aligned}
\mathbb{E}</em>}\sim p(\boldsymbol{x})}\left[(\boldsymbol{x}-\boldsymbol{\mu<em _boldsymbol_x="\boldsymbol{x">q)^{\top}\boldsymbol{\Sigma}_q^{-1}(\boldsymbol{x}-\boldsymbol{\mu}_q)\right]=&amp;\,\mathbb{E}</em>}\sim p(\boldsymbol{x})}\left[\text{Tr}\left((\boldsymbol{x}-\boldsymbol{\mu<em _boldsymbol_x="\boldsymbol{x">q)^{\top}\boldsymbol{\Sigma}_q^{-1}(\boldsymbol{x}-\boldsymbol{\mu}_q)\right)\right]\\
=&amp;\,\mathbb{E}</em>}\sim p(\boldsymbol{x})}\left[\text{Tr}\left(\boldsymbol{\Sigma<em _boldsymbol_x="\boldsymbol{x">q^{-1}(\boldsymbol{x}-\boldsymbol{\mu}_q)(\boldsymbol{x}-\boldsymbol{\mu}_q)^{\top}\right)\right]\\
=&amp;\,\text{Tr}\left(\boldsymbol{\Sigma}_q^{-1}\mathbb{E}</em>}\sim p(\boldsymbol{x})}\left[(\boldsymbol{x}-\boldsymbol{\mu<em _boldsymbol_x="\boldsymbol{x">q)(\boldsymbol{x}-\boldsymbol{\mu}_q)^{\top}\right]\right)\\
=&amp;\,\text{Tr}\left(\boldsymbol{\Sigma}_q^{-1}\mathbb{E}</em>\right]\right)\\}\sim p(\boldsymbol{x})}\left[\boldsymbol{x}\boldsymbol{x}^{\top}-\boldsymbol{\mu}_q\boldsymbol{x}^{\top} - \boldsymbol{x}\boldsymbol{\mu}_q^{\top} + \boldsymbol{\mu}_q\boldsymbol{\mu}_q^{\top
=&amp;\,\text{Tr}\left(\boldsymbol{\Sigma}_q^{-1}\left(\boldsymbol{\Sigma}_p + \boldsymbol{\mu}_p\boldsymbol{\mu}_p^{\top}-\boldsymbol{\mu}_q\boldsymbol{\mu}_p^{\top} - \boldsymbol{\mu}_p\boldsymbol{\mu}_q^{\top} + \boldsymbol{\mu}_q\boldsymbol{\mu}_q^{\top}\right)\right)\\
=&amp;\,\text{Tr}\left(\boldsymbol{\Sigma}_q^{-1}\boldsymbol{\Sigma}_p + \boldsymbol{\Sigma}_q^{-1}(\boldsymbol{\mu}_p-\boldsymbol{\mu}_q)(\boldsymbol{\mu}_p-\boldsymbol{\mu}_q)^{\top}\right)\\
=&amp;\,\text{Tr}\left(\boldsymbol{\Sigma}_q^{-1}\boldsymbol{\Sigma}_p\right) + (\boldsymbol{\mu}_p-\boldsymbol{\mu}_q)^{\top}\boldsymbol{\Sigma}_q^{-1}(\boldsymbol{\mu}_p-\boldsymbol{\mu}_q)\\
\end{aligned}\end{equation}<br />
注意$\boldsymbol{\mu}_q=\boldsymbol{\mu}_p,\boldsymbol{\Sigma}_q=\boldsymbol{\Sigma}_p$时，上式就等于$n$，此时就对应正态分布的熵。所以最终得到<br />
\begin{equation}\begin{aligned}
KL(p(\boldsymbol{x})\Vert q(\boldsymbol{x}))=&amp;\,\frac{1}{2}\left[n\log 2\pi + \log \det(\boldsymbol{\Sigma}_q) + \text{Tr}\left(\boldsymbol{\Sigma}_q^{-1}\boldsymbol{\Sigma}_p\right) + (\boldsymbol{\mu}_p-\boldsymbol{\mu}_q)^{\top}\boldsymbol{\Sigma}_q^{-1}(\boldsymbol{\mu}_p-\boldsymbol{\mu}_q)\right] \\
&amp;\,\qquad- \frac{1}{2}\left[n\log 2\pi + \log \det(\boldsymbol{\Sigma}_p) + n\right]\\
=&amp;\,\frac{1}{2}\left[(\boldsymbol{\mu}_p-\boldsymbol{\mu}_q)^{\top}\boldsymbol{\Sigma}_q^{-1}(\boldsymbol{\mu}_p-\boldsymbol{\mu}_q)-\log \det(\boldsymbol{\Sigma}_q^{-1}\boldsymbol{\Sigma}_p) + \text{Tr}\left(\boldsymbol{\Sigma}_q^{-1}\boldsymbol{\Sigma}_p\right) - n\right]
\end{aligned}\end{equation}</p>
<h2 id="_11">巴氏距离<a class="toc-link" href="#_11" title="Permanent link">&para;</a></h2>
<p>然后，我们来看看<a href="https://en.wikipedia.org/wiki/Bhattacharyya_distance">巴氏距离（Bhattacharyya distance）</a>，它定义为<br />
\begin{equation}BD(p(\boldsymbol{x}), q(\boldsymbol{x})) = -\log \int \sqrt{p(\boldsymbol{x}) q(\boldsymbol{x})} d\boldsymbol{x}\end{equation}<br />
与之相关的还有一个叫做“<a href="https://en.wikipedia.org/wiki/Hellinger_distance">Hellinger距离</a>”的概念，它的平方定义为$\frac{1}{2}\int \left(\sqrt{p(\boldsymbol{x})} - \sqrt{q(\boldsymbol{x})}\right)^2 d\boldsymbol{x}$，展开后就能发现跟巴氏距离本质是等价的。</p>
<h3 id="_12">计算结果<a class="toc-link" href="#_12" title="Permanent link">&para;</a></h3>
<p>对于两个正态分布来说，它们的巴氏距离为<br />
\begin{equation}
BD(p(\boldsymbol{x}), q(\boldsymbol{x})) = \frac{1}{2}\log \frac{\det(\boldsymbol{\Sigma})}{\sqrt{\det(\boldsymbol{\Sigma}_p\boldsymbol{\Sigma}_q)}} + \frac{1}{8}(\boldsymbol{\mu}_p - \boldsymbol{\mu}_q)^{\top}\boldsymbol{\Sigma}^{-1}(\boldsymbol{\mu}_p - \boldsymbol{\mu}_q)
\end{equation}<br />
这里$\boldsymbol{\Sigma}=\frac{1}{2}(\boldsymbol{\Sigma}_p + \boldsymbol{\Sigma}_q)$。可以看到结果是对称的，这是因为巴氏距离的定义本身就是对称的。</p>
<p>当两者之一为标准正态分布时，结果并没有明显简化，所以这里就不单独写出来了。</p>
<h3 id="_13">推导过程<a class="toc-link" href="#_13" title="Permanent link">&para;</a></h3>
<p>按照定义，两个正态分布的巴氏距离，是下述积分的负对数：<br />
\begin{equation}\begin{aligned}
&amp;\qquad\int \sqrt{p(\boldsymbol{x}) q(\boldsymbol{x})} d\boldsymbol{x}=\frac{1}{\sqrt[4]{(2\pi)^{2n}\det(\boldsymbol{\Sigma}_p\boldsymbol{\Sigma}_q)}}\times \\
&amp;\int \exp\left\{-\frac{1}{4}(\boldsymbol{x}-\boldsymbol{\mu}_p)^{\top}\boldsymbol{\Sigma}_p^{-1}(\boldsymbol{x}-\boldsymbol{\mu}_p)-\frac{1}{4}(\boldsymbol{x}-\boldsymbol{\mu}_q)^{\top}\boldsymbol{\Sigma}_q^{-1}(\boldsymbol{x}-\boldsymbol{\mu}_q)\right\}d\boldsymbol{x}
\end{aligned}\end{equation}<br />
记$\boldsymbol{y}=\boldsymbol{x}-\boldsymbol{\mu}_p, \boldsymbol{\Delta}=\boldsymbol{\mu}_p - \boldsymbol{\mu}_q$，积分部分可以换元为<br />
\begin{equation}\begin{aligned}
&amp;\int \exp\left\{-\frac{1}{4}\boldsymbol{y}^{\top}\boldsymbol{\Sigma}_p^{-1}\boldsymbol{y}-\frac{1}{4}(\boldsymbol{y}+\boldsymbol{\Delta})^{\top}\boldsymbol{\Sigma}_q^{-1}(\boldsymbol{y}+\boldsymbol{\Delta})\right\}d\boldsymbol{y}\\
=&amp;\int \exp\left\{-\frac{1}{4}\boldsymbol{y}^{\top}\left(\boldsymbol{\Sigma}_p^{-1}+\boldsymbol{\Sigma}_q^{-1}\right)\boldsymbol{y}-\frac{1}{2}\boldsymbol{\Delta}^{\top}\boldsymbol{\Sigma}_q^{-1}\boldsymbol{y} - \frac{1}{4}\boldsymbol{\Delta}^{\top}\boldsymbol{\Sigma}_q^{-1}\boldsymbol{\Delta}\right\}d\boldsymbol{y}\\
=&amp;\int \exp\left\{-\frac{1}{2}\boldsymbol{y}^{\top}\left(\boldsymbol{\Sigma}_p^{-1}\boldsymbol{\Sigma}\boldsymbol{\Sigma}_q^{-1}\right)\boldsymbol{y}-\frac{1}{2}\boldsymbol{\Delta}^{\top}\boldsymbol{\Sigma}_q^{-1}\boldsymbol{y} - \frac{1}{4}\boldsymbol{\Delta}^{\top}\boldsymbol{\Sigma}_q^{-1}\boldsymbol{\Delta}\right\}d\boldsymbol{y}\end{aligned}\end{equation}<br />
这里$\boldsymbol{\Sigma}=\frac{1}{2}(\boldsymbol{\Sigma}_p + \boldsymbol{\Sigma}_q)$。按照前面介绍的高斯积分公式$\eqref{eq:g-int}$，积分结果是<br />
\begin{equation}\begin{aligned}
&amp;\,\sqrt{(2\pi)^n \det(\boldsymbol{\Sigma}_p^{-1}\boldsymbol{\Sigma}\boldsymbol{\Sigma}_q^{-1})^{-1}}\exp\left\{\frac{1}{8}\left(\boldsymbol{\Sigma}_q^{-1}\boldsymbol{\Delta}\right)^{\top}\left(\boldsymbol{\Sigma}_p^{-1}\boldsymbol{\Sigma}\boldsymbol{\Sigma}_q^{-1}\right)^{-1}\left(\boldsymbol{\Sigma}_q^{-1}\boldsymbol{\Delta}\right)-\frac{1}{4}\boldsymbol{\Delta}^{\top}\boldsymbol{\Sigma}_q^{-1}\boldsymbol{\Delta}\right\}\\
=&amp;\,\sqrt{(2\pi)^n \det(\boldsymbol{\Sigma}_q\boldsymbol{\Sigma}^{-1}\boldsymbol{\Sigma}_p)}\exp\left\{\frac{1}{8}\boldsymbol{\Delta}^{\top}\left(\boldsymbol{\Sigma}^{-1}\boldsymbol{\Sigma}_p\boldsymbol{\Sigma}_q^{-1} - 2\boldsymbol{\Sigma}_q^{-1}\right)\boldsymbol{\Delta}\right\}\\
=&amp;\,\sqrt{(2\pi)^n \det(\boldsymbol{\Sigma}_q\boldsymbol{\Sigma}^{-1}\boldsymbol{\Sigma}_p)}\exp\left\{\frac{1}{8}\boldsymbol{\Delta}^{\top}\boldsymbol{\Sigma}^{-1}\left(\boldsymbol{\Sigma}_p\boldsymbol{\Sigma}_q^{-1} - 2\boldsymbol{\Sigma}\boldsymbol{\Sigma}_q^{-1}\right)\boldsymbol{\Delta}\right\}\\
=&amp;\,\sqrt{(2\pi)^n \det(\boldsymbol{\Sigma}_q\boldsymbol{\Sigma}^{-1}\boldsymbol{\Sigma}_p)}\exp\left\{-\frac{1}{8}\boldsymbol{\Delta}^{\top}\boldsymbol{\Sigma}^{-1}\boldsymbol{\Delta}\right\}
\end{aligned}\end{equation}<br />
所以最终<br />
\begin{equation}\begin{aligned}
BD(p(\boldsymbol{x}), q(\boldsymbol{x})) =&amp;\, -\log \left[\frac{\sqrt{(2\pi)^n \det(\boldsymbol{\Sigma}_q\boldsymbol{\Sigma}^{-1}\boldsymbol{\Sigma}_p)}}{\sqrt[4]{(2\pi)^{2n}\det(\boldsymbol{\Sigma}_p\boldsymbol{\Sigma}_q)}}\exp\left\{-\frac{1}{8}\boldsymbol{\Delta}^{\top}\boldsymbol{\Sigma}^{-1}\boldsymbol{\Delta}\right\}\right] \\
=&amp;\, -\log \left[\frac{\sqrt[4]{\det(\boldsymbol{\Sigma}_p\boldsymbol{\Sigma}_q)}}{\sqrt{\det\left(\boldsymbol{\Sigma}\right)}}\exp\left\{-\frac{1}{8}\boldsymbol{\Delta}^{\top}\boldsymbol{\Sigma}^{-1}\boldsymbol{\Delta}\right\}\right]\\
=&amp;\,\frac{1}{2}\log \frac{\det(\boldsymbol{\Sigma})}{\sqrt{\det(\boldsymbol{\Sigma}_p\boldsymbol{\Sigma}_q)}} + \frac{1}{8}(\boldsymbol{\mu}_p - \boldsymbol{\mu}_q)^{\top}\boldsymbol{\Sigma}^{-1}(\boldsymbol{\mu}_p - \boldsymbol{\mu}_q)
\end{aligned}<br />
\end{equation}</p>
<h2 id="w">W距离<a class="toc-link" href="#w" title="Permanent link">&para;</a></h2>
<p>如果读者还想看了解更多关于概率散度的内容，可以参考书籍<a href="https://www.taylorfrancis.com/books/mono/10.1201/9781420034813/statistical-inference-based-divergence-measures-leandro-pardo">《Statistical Inference Based on Divergence Measures》</a>。现在我们转向另一类概率度量——基于最优传输的W距离（Wasserstein距离）。</p>
<p>沿用<a href="/archives/6280">《从Wasserstein距离、对偶理论到WGAN》</a>中的记号，W距离的定义如下：<br />
\begin{equation}\begin{aligned}
\mathcal{W}<em _Pi_p_q_="\Pi[p,q]" _gamma_in="\gamma\in">{\rho}[p,q]=&amp;\,\left(\inf</em>\\} \iint \gamma(\boldsymbol{x},\boldsymbol{y}) \Vert\boldsymbol{x} - \boldsymbol{y}\Vert^{\rho} d\boldsymbol{x}d\boldsymbol{y}\right)^{1/\rho
=&amp;\,\left(\inf_{\gamma\in \Pi[p,q]} \mathbb{E}_{(\boldsymbol{x},\boldsymbol{y})\sim\gamma(\boldsymbol{x},\boldsymbol{y})} \left[\Vert\boldsymbol{x} - \boldsymbol{y}\Vert^{\rho}\right]\right)^{1/\rho}
\end{aligned}\end{equation}<br />
根据笔者所找到的资料，对于两个正态分布的W距离，目前仅$\rho=2$时求出了解析解，因此下面都是在求$\mathcal{W}_2[p,q]$，并且简单起见，记<br />
\begin{equation}\mathcal{W}_2^2[p,q] = \left(\mathcal{W}_2[p,q]\right)^2\end{equation}</p>
<h3 id="_14">计算结果<a class="toc-link" href="#_14" title="Permanent link">&para;</a></h3>
<p>有意思的是，关于两个正态分布的W距离的结果，流传着两个不同的版本，这两个版本都有一定的认知度，但却没有看到有明确说两者等价的资料。两个版本出自不同的论文，还被冠以了不同的名字。</p>
<h4 id="1">版本1<a class="toc-link" href="#1" title="Permanent link">&para;</a></h4>
<p>首先是流传相对较广的版本，很多时候搜索“正态分布的Wasserstein距离”都是给出这个结果：<br />
\begin{equation}\mathcal{W}_2^2[p,q]=\Vert \boldsymbol{\mu}_p - \boldsymbol{\mu}_q\Vert^2 + \text{Tr}(\boldsymbol{\Sigma}_p) + \text{Tr}(\boldsymbol{\Sigma}_q) - 2\text{Tr}((\boldsymbol{\Sigma}_p^{1/2}\boldsymbol{\Sigma}_q\boldsymbol{\Sigma}_p^{1/2})^{1/2})\label{eq:w-v1}\end{equation}关于这个结果，有的读者可能困惑于“怎么关于$p,q$不是对称的”，事实上，它关于$p,q$是对称的，因为<br />
\begin{equation}\begin{aligned}\text{Tr}((\boldsymbol{\Sigma}_p^{1/2}\boldsymbol{\Sigma}_q\boldsymbol{\Sigma}_p^{1/2})^{1/2})=&amp;\,\text{Tr}((\boldsymbol{\Sigma}_p^{1/2}\boldsymbol{\Sigma}_q\boldsymbol{\Sigma}_p^{1/2})^{1/2}\boldsymbol{\Sigma}_p^{-1/2}\boldsymbol{\Sigma}_q^{-1/2}\boldsymbol{\Sigma}_q^{1/2}\boldsymbol{\Sigma}_p^{1/2})\\
=&amp;\,\text{Tr}(\boldsymbol{\Sigma}_q^{1/2}\boldsymbol{\Sigma}_p^{1/2}(\boldsymbol{\Sigma}_p^{1/2}\boldsymbol{\Sigma}_q\boldsymbol{\Sigma}_p^{1/2})^{1/2}\boldsymbol{\Sigma}_p^{-1/2}\boldsymbol{\Sigma}_q^{-1/2})
\end{aligned}\end{equation}<br />
然后我们可以直接验证$(\boldsymbol{\Sigma}_q^{1/2}\boldsymbol{\Sigma}_p^{1/2}(\boldsymbol{\Sigma}_p^{1/2}\boldsymbol{\Sigma}_q\boldsymbol{\Sigma}_p^{1/2})^{1/2}\boldsymbol{\Sigma}_p^{-1/2}\boldsymbol{\Sigma}_q^{-1/2})^2=\boldsymbol{\Sigma}_q^{1/2}\boldsymbol{\Sigma}_p\boldsymbol{\Sigma}_q^{1/2}$，所以有$\text{Tr}((\boldsymbol{\Sigma}_p^{1/2}\boldsymbol{\Sigma}_q\boldsymbol{\Sigma}_p^{1/2})^{1/2})=\text{Tr}((\boldsymbol{\Sigma}_q^{1/2}\boldsymbol{\Sigma}_p\boldsymbol{\Sigma}_q^{1/2})^{1/2})$。</p>
<h4 id="2">版本2<a class="toc-link" href="#2" title="Permanent link">&para;</a></h4>
<p>第二个看起来稍微简单一些的版本，结果是：<br />
\begin{equation}\mathcal{W}_2^2[p,q]=\Vert \boldsymbol{\mu}_p - \boldsymbol{\mu}_q\Vert^2 + \text{Tr}(\boldsymbol{\Sigma}_p) + \text{Tr}(\boldsymbol{\Sigma}_q) - 2\text{Tr}((\boldsymbol{\Sigma}_p\boldsymbol{\Sigma}_q)^{1/2})\label{eq:w-v2}\end{equation}<br />
这个版本通常被称为“<a href="https://en.wikipedia.org/wiki/Fr%C3%A9chet_distance">Fréchet距离</a>”，一般情况下通过关键词“正态分布的Fréchet距离”才能搜到这个结果。GAN中经常使用的评价指标FID（<a href="https://papers.cool/arxiv/1706.08500">Frechet Inception Distance</a>），就是基于这个公式进行计算的。可以模仿前面证明它关于$p,q$的对称性，当然也可以从下面的等价性讨论中直接得出。</p>
<h4 id="_15">等价性<a class="toc-link" href="#_15" title="Permanent link">&para;</a></h4>
<p>按道理，第2个版本简洁一些，应该以第二个版本为标准传播才对。所以为什么现在依然流传着两个不同的版本，笔者也相当困惑。从理论上来看，证明两个版本的等价性也不难，根据迹的恒等式我们有：<br />
\begin{equation}\begin{aligned}\text{Tr}((\boldsymbol{\Sigma}_p^{1/2}\boldsymbol{\Sigma}_q\boldsymbol{\Sigma}_p^{1/2})^{1/2})=&amp;\,\text{Tr}((\boldsymbol{\Sigma}_p^{1/2}\boldsymbol{\Sigma}_q\boldsymbol{\Sigma}_p^{1/2})^{1/2}\boldsymbol{\Sigma}_p^{-1/2}\boldsymbol{\Sigma}_p^{1/2})\\
=&amp;\,\text{Tr}(\boldsymbol{\Sigma}_p^{1/2}(\boldsymbol{\Sigma}_p^{1/2}\boldsymbol{\Sigma}_q\boldsymbol{\Sigma}_p^{1/2})^{1/2}\boldsymbol{\Sigma}_p^{-1/2})
\end{aligned}\end{equation}<br />
然后直接验证$(\boldsymbol{\Sigma}_p^{1/2}(\boldsymbol{\Sigma}_p^{1/2}\boldsymbol{\Sigma}_q\boldsymbol{\Sigma}_p^{1/2})^{1/2}\boldsymbol{\Sigma}_p^{-1/2})^2=\boldsymbol{\Sigma}_p \boldsymbol{\Sigma}_q$即可。</p>
<h4 id="_16">特殊时<a class="toc-link" href="#_16" title="Permanent link">&para;</a></h4>
<p>特别地，如果$\boldsymbol{\Sigma}_p,\boldsymbol{\Sigma}_q$的乘法可以交换，那么将会简化为非常直观的形式：<br />
\begin{equation}\mathcal{W}_2^2[p,q]=\Vert \boldsymbol{\mu}_p - \boldsymbol{\mu}_q\Vert^2 + \Vert \boldsymbol{\Sigma}_p^{1/2} - \boldsymbol{\Sigma}_q^{1/2}\Vert_F^2\label{eq:w-jiaohuan}\end{equation}<br />
为什么说它非常直观呢？因为正态分布的参数为$\boldsymbol{\mu},\boldsymbol{\Sigma}$，所以比较正态分布的差异其实就是比较$\boldsymbol{\mu},\boldsymbol{\Sigma}$的差异，按照机器学习的习惯，一个很容易相当想到的指标是平方误差<br />
\begin{equation}\mathcal{W}_2^2[p,q]=\Vert \boldsymbol{\mu}_p - \boldsymbol{\mu}_q\Vert^2 + \Vert \boldsymbol{\Sigma}_p - \boldsymbol{\Sigma}_q\Vert_F^2\end{equation}<br />
但从物理角度来看，这个指标是不妥的，因为如果将$\boldsymbol{\mu}$看成是长度量纲，那么$\boldsymbol{\Sigma}$就具有长度平方的量纲，所以$\Vert \boldsymbol{\mu}_p - \boldsymbol{\mu}_q\Vert^2$和$\Vert \boldsymbol{\Sigma}_p - \boldsymbol{\Sigma}_q\Vert_F^2$是具有不同量纲的两个量，不能相加。而为了使得量纲一致，直观的想法就是把$\boldsymbol{\Sigma}$“开平方”后再算平方误差，这就得到了式$\eqref{eq:w-jiaohuan}$。</p>
<p>特别地，当$q$为标准正态分布时，结果简化为<br />
\begin{equation}\mathcal{W}_2^2[p,q]=\Vert \boldsymbol{\mu}_p\Vert^2 + \Vert \boldsymbol{\Sigma}_p^{1/2} - \boldsymbol{I}\Vert_F^2\end{equation}</p>
<h3 id="1_1">推导过程1<a class="toc-link" href="#1_1" title="Permanent link">&para;</a></h3>
<p>现在介绍第一个证明，主要参考了论文<a href="https://projecteuclid.org/journals/michigan-mathematical-journal/volume-31/issue-2/A-class-of-Wasserstein-metrics-for-probability-distributions/10.1307/mmj/1029003026.full">《A class of Wasserstein metrics for probability distributions》</a>。另外<a href="https://www.sciencedirect.com/science/article/pii/0024379582901124">《The distance between two random vectors with given dispersion matrices》</a>也提供了一个类似的证明，也可以参考。</p>
<p>下面的推导过程则是经过笔者简化的，相对原论文的证明来说简单一些，但依然不可避免地会涉及到较多的线性代数知识，我们将分几个部分介绍。</p>
<h4 id="_17">去均值<a class="toc-link" href="#_17" title="Permanent link">&para;</a></h4>
<p>不失一般性，我们可以只考虑均值为0的分布$p,q$。因为如果$p,q$的均值不为0，那么设对应的均值为0的分布为$\tilde{p},\tilde{q}$，此时有<br />
\begin{equation}\begin{aligned}
&amp;\,\mathbb{E}<em _boldsymbol_x="(\boldsymbol{x">{(\boldsymbol{x},\boldsymbol{y})\sim\gamma(\boldsymbol{x},\boldsymbol{y})}\left[\Vert \boldsymbol{x} - \boldsymbol{y}\Vert^2\right] \\
=&amp;\, \mathbb{E}</em>},\boldsymbol{y})\sim\tilde{\gamma}(\boldsymbol{x},\boldsymbol{y})}\left[\Vert (\boldsymbol{x} + \boldsymbol{\mu<em _boldsymbol_x="(\boldsymbol{x">p) - (\boldsymbol{y} + \boldsymbol{\mu}_q)\Vert^2 \right]\\
=&amp;\,\mathbb{E}</em>},\boldsymbol{y})\sim\tilde{\gamma}(\boldsymbol{x},\boldsymbol{y})}\left[\Vert \boldsymbol{x} - \boldsymbol{y}\Vert^2 + \Vert \boldsymbol{\mu<em _boldsymbol_x="(\boldsymbol{x">p - \boldsymbol{\mu}_q\Vert^2 + 2\langle\boldsymbol{x} - \boldsymbol{y}, \boldsymbol{\mu}_p - \boldsymbol{\mu}_q\rangle\right]\\
=&amp;\,\Vert \boldsymbol{\mu}_p - \boldsymbol{\mu}_q\Vert^2 + \mathbb{E}</em>\Vert^2 \right]},\boldsymbol{y})\sim\tilde{\gamma}(\boldsymbol{x},\boldsymbol{y})}\left[\Vert \boldsymbol{x} - \boldsymbol{y
\end{aligned}\end{equation}<br />
该结果意味着<br />
\begin{equation}\mathcal{W}_2^2[p,q]=\Vert \boldsymbol{\mu}_p - \boldsymbol{\mu}_q\Vert^2 + \mathcal{W}_2^2[\tilde{p},\tilde{q}]\end{equation}<br />
所以，只需要算出均值都为零时的Wasserstein距离，然后加上$\Vert \boldsymbol{\mu}_p - \boldsymbol{\mu}_q\Vert^2$就得到了一般情况的结果。</p>
<h4 id="_18">纯代数<a class="toc-link" href="#_18" title="Permanent link">&para;</a></h4>
<p>现在我们假设$p,q$的均值均为0，然后计算<br />
\begin{equation}\begin{aligned}
\mathbb{E}<em _boldsymbol_x="(\boldsymbol{x">{(\boldsymbol{x},\boldsymbol{y})\sim\gamma(\boldsymbol{x},\boldsymbol{y})}\left[\Vert \boldsymbol{x} - \boldsymbol{y}\Vert^2\right] =&amp;\, \mathbb{E}</em>\right]\\},\boldsymbol{y})\sim\gamma(\boldsymbol{x},\boldsymbol{y})}\left[\boldsymbol{x}^{\top} \boldsymbol{x} + \boldsymbol{y}^{\top} \boldsymbol{y} - 2\boldsymbol{y}^{\top} \boldsymbol{x
=&amp;\, \mathbb{E}<em _boldsymbol_x="(\boldsymbol{x">{(\boldsymbol{x},\boldsymbol{y})\sim\gamma(\boldsymbol{x},\boldsymbol{y})}\left[\text{Tr}\left(\boldsymbol{x} \boldsymbol{x}^{\top} + \boldsymbol{y} \boldsymbol{y}^{\top} - 2\boldsymbol{x}\boldsymbol{y}^{\top} \right)\right]\\
=&amp;\, \text{Tr}\left(\mathbb{E}</em>\right]\right)\\},\boldsymbol{y})\sim\gamma(\boldsymbol{x},\boldsymbol{y})}\left[\boldsymbol{x} \boldsymbol{x}^{\top} + \boldsymbol{y} \boldsymbol{y}^{\top} - 2\boldsymbol{x}\boldsymbol{y}^{\top
=&amp;\, \text{Tr}(\boldsymbol{\Sigma}<em _gamma="\gamma">p) + \text{Tr}(\boldsymbol{\Sigma}_q) - 2\text{Tr}(\boldsymbol{C})
\end{aligned}\end{equation}<br />
其中<br />
\begin{equation}\boldsymbol{\Sigma}</em>}= \begin{pmatrix} \boldsymbol{\Sigma<em _boldsymbol_x="(\boldsymbol{x">p &amp; \boldsymbol{C}\\ \boldsymbol{C}^{\top} &amp; \boldsymbol{\Sigma}_q\end{pmatrix}=\mathbb{E}</em>},\boldsymbol{y})\sim\gamma(\boldsymbol{x},\boldsymbol{y})}\left[\begin{pmatrix}\boldsymbol{x} \\ \boldsymbol{y}\end{pmatrix}\begin{pmatrix}\boldsymbol{x}^{\top} &amp; \boldsymbol{y}^{\top}\end{pmatrix}\right]\end{equation<br />
构成联合分布$\gamma$的协方差矩阵。我们知道协方差矩阵是正定对阵矩阵，所以从代数的角度看，问题变成了：</p>
<blockquote>
<p>已知$\boldsymbol{\Sigma}_{\gamma}= \begin{pmatrix} \boldsymbol{\Sigma}_p &amp; \boldsymbol{C}\\ \boldsymbol{C}^{\top} &amp; \boldsymbol{\Sigma}_q\end{pmatrix}$为正定对称矩阵，求$\text{Tr}(\boldsymbol{C})$的最大值。</p>
</blockquote>
<h4 id="_19">舒尔补<a class="toc-link" href="#_19" title="Permanent link">&para;</a></h4>
<p>为此，我们需要利用下述关于“舒尔补”的恒等式：<br />
\begin{equation}
\begin{pmatrix} \boldsymbol{\Sigma}_p &amp; \boldsymbol{C}\\ \boldsymbol{C}^{\top} &amp; \boldsymbol{\Sigma}_q\end{pmatrix} = \begin{pmatrix} \boldsymbol{I} &amp; \boldsymbol{0}\\ \boldsymbol{C}^{\top}\boldsymbol{\Sigma}_p^{-1} &amp; \boldsymbol{I}\end{pmatrix} \begin{pmatrix} \boldsymbol{\Sigma}_p &amp; \boldsymbol{0}\\ \boldsymbol{0} &amp; \boldsymbol{\Sigma}_q - \boldsymbol{C}^{\top}\boldsymbol{\Sigma}_p^{-1}\boldsymbol{C}\end{pmatrix} \begin{pmatrix} \boldsymbol{I} &amp; \boldsymbol{\Sigma}_p^{-1}\boldsymbol{C} \\ \boldsymbol{0} &amp; \boldsymbol{I}\end{pmatrix}<br />
\end{equation}<br />
其中对称矩阵$\boldsymbol{S} = \boldsymbol{\Sigma}_q - \boldsymbol{C}^{\top}\boldsymbol{\Sigma}_p^{-1}\boldsymbol{C}$称为“<a href="https://en.wikipedia.org/wiki/Schur_complement">舒尔补（Schur Complement）</a>”，该分解具有$\boldsymbol{B}^{\top}\boldsymbol{A}\boldsymbol{B}$的形式，要想它是正定的，那么$\boldsymbol{A}$要是正定的，而$\boldsymbol{\Sigma}_p$已经是正定的，所以$\boldsymbol{S}$需要是正定的。</p>
<h4 id="_20">分参数<a class="toc-link" href="#_20" title="Permanent link">&para;</a></h4>
<p>尝试分离参数，即从$\boldsymbol{S} = \boldsymbol{\Sigma}_q - \boldsymbol{C}^{\top}\boldsymbol{\Sigma}_p^{-1}\boldsymbol{C}$中把$\boldsymbol{C}$解出来。首先移项得到$\boldsymbol{\Sigma}_q - \boldsymbol{S} = \boldsymbol{C}^{\top}\boldsymbol{\Sigma}_p^{-1}\boldsymbol{C}$，由于$\boldsymbol{\Sigma}_p$是正定对称的，所以$\boldsymbol{\Sigma}_p^{-1}$也是，从而$\boldsymbol{C}^{\top}\boldsymbol{\Sigma}_p^{-1}\boldsymbol{C}$也是正定对称的，那么它具有正定对称的平方根，即存在正定对称矩阵$\boldsymbol{R}$，使得<br />
\begin{equation}\boldsymbol{C}^{\top}\boldsymbol{\Sigma}_p^{-1}\boldsymbol{C} = \boldsymbol{R}^2\quad\Leftrightarrow\quad \left(\boldsymbol{\Sigma}_p^{-1/2}\boldsymbol{C}\boldsymbol{R}^{-1}\right)^{\top}\left(\boldsymbol{\Sigma}_p^{-1/2}\boldsymbol{C}\boldsymbol{R}^{-1}\right)=\boldsymbol{I}\end{equation}<br />
这说明$\boldsymbol{\Sigma}_p^{-1/2}\boldsymbol{C}\boldsymbol{R}^{-1}$是正交矩阵，记为$\boldsymbol{O}$，那么$\boldsymbol{C} = \boldsymbol{\Sigma}_p^{1/2}\boldsymbol{O}\boldsymbol{R}$。</p>
<h4 id="_21">乘子法<a class="toc-link" href="#_21" title="Permanent link">&para;</a></h4>
<p>此时，变量分别是$\boldsymbol{O}$和$\boldsymbol{R}$，求$\text{Tr}(\boldsymbol{C})=\text{Tr}(\boldsymbol{\Sigma}_p^{1/2}\boldsymbol{O}\boldsymbol{R})$的最大值。我们先固定$\boldsymbol{R}$，求取最大值时的$\boldsymbol{O}$，此时相当于在$\boldsymbol{O}^{\top}\boldsymbol{O}=\boldsymbol{I}$的约束下，求$\text{Tr}(\boldsymbol{\Sigma}_p^{1/2}\boldsymbol{O}\boldsymbol{R})$的最大值，我们用“<a href="https://en.wikipedia.org/wiki/Lagrange_multiplier">拉格朗日乘子法</a>”：引入新参数矩阵$\boldsymbol{W}$，转化为下述无约束极值问题<br />
\begin{equation}F = \text{Tr}(\boldsymbol{\Sigma}_p^{1/2}\boldsymbol{O}\boldsymbol{R}) - \frac{1}{2}\text{Tr}(\boldsymbol{W}(\boldsymbol{O}^{\top}\boldsymbol{O} - \boldsymbol{I}))\end{equation}<br />
求导：<br />
\begin{equation}\begin{aligned}
&amp;\frac{\partial F}{\partial \boldsymbol{O}} = \boldsymbol{0} \quad \Rightarrow\quad \boldsymbol{R}\boldsymbol{\Sigma}_p^{1/2} = \boldsymbol{W}\boldsymbol{O}^{\top}\\
&amp;\frac{\partial F}{\partial \boldsymbol{W}} = \boldsymbol{0} \quad \Rightarrow\quad \boldsymbol{O}^{\top}\boldsymbol{O} = \boldsymbol{I}\\
\end{aligned}\end{equation}<br />
首先留意到$\boldsymbol{O}^{\top}\boldsymbol{O} - \boldsymbol{I}$是对称的，因此对应的参数矩阵$\boldsymbol{W}$也是对称的，于是我们有：<br />
\begin{equation}\left(\boldsymbol{O}\boldsymbol{W}\boldsymbol{O}^{\top}\right)^2=\left(\boldsymbol{W}\boldsymbol{O}^{\top}\right)^{\top}\left(\boldsymbol{W}\boldsymbol{O}^{\top}\right)=\boldsymbol{\Sigma}_p^{1/2}\boldsymbol{R}^2\boldsymbol{\Sigma}_p^{1/2}\end{equation}<br />
即$\boldsymbol{O}\boldsymbol{W}\boldsymbol{O}^{\top}=(\boldsymbol{\Sigma}_p^{1/2}\boldsymbol{R}^2\boldsymbol{\Sigma}_p^{1/2})^{1/2}$，所以此时<br />
\begin{equation}\text{Tr}(\boldsymbol{\Sigma}_p^{1/2}\boldsymbol{O}\boldsymbol{R})=\text{Tr}(\boldsymbol{O}\boldsymbol{R}\boldsymbol{\Sigma}_p^{1/2})=\text{Tr}(\boldsymbol{O}\boldsymbol{W}\boldsymbol{O}^{\top})=\text{Tr}((\boldsymbol{\Sigma}_p^{1/2}\boldsymbol{R}^2\boldsymbol{\Sigma}_p^{1/2})^{1/2})\end{equation}</p>
<h4 id="_22">不等式<a class="toc-link" href="#_22" title="Permanent link">&para;</a></h4>
<p>最后需要把$\boldsymbol{R}$确定下来。回顾$\boldsymbol{R}$的定义，我们有$\boldsymbol{R}^2=\boldsymbol{\Sigma}_q - \boldsymbol{S}$，其中$\boldsymbol{S}$是正定矩阵。直觉上$\boldsymbol{S}=\boldsymbol{0}$时取得最大值，事实上也确实如此，这算是“<a href="https://en.wikipedia.org/wiki/Weyl%27s_inequality">Weyl不等式</a>”的一个直接推论。</p>
<p>根据Weyl不等式，如果矩阵$\boldsymbol{A},\boldsymbol{B}$都是正定对称矩阵，设$\boldsymbol{A},\boldsymbol{B},\boldsymbol{A}+\boldsymbol{B}$的特征值从小到大排列分别为$0\leq\lambda_1^{(A)} \leq \dots \leq \lambda_n^{(A)}$、$\lambda_1^{(B)} \leq \dots \leq \lambda_n^{(B)}$和$0\leq\lambda_1^{(A+B)} \leq \dots \leq \lambda_n^{(A+B)}$，那么对于任意$1\leq i \leq n$，都有$\lambda_i^{(A)}\leq \lambda_i^{(A+B)}$和$\lambda_i^{(B)}\leq \lambda_i^{(A+B)}$，也就是说：</p>
<blockquote>
<p>正定对称矩阵的和的特征值，一一对应地大于它们各自的特征值。</p>
</blockquote>
<p>有了这个结论，那就简单了，设$(\boldsymbol{\Sigma}_p^{1/2}(\boldsymbol{\Sigma}_q - \boldsymbol{S})\boldsymbol{\Sigma}_p^{1/2})^{1/2}$的特征值为$0 \leq \lambda_1 \leq \dots \leq \lambda_n$，那么它的迹就是$\lambda_1 + \dots + \lambda_n$，对应地，$\boldsymbol{\Sigma}_p^{1/2}(\boldsymbol{\Sigma}_q - \boldsymbol{S})\boldsymbol{\Sigma}_p^{1/2}$的特征值为$0 \leq \lambda_1^2 \leq \dots \leq \lambda_n^2$，注意$\boldsymbol{\Sigma}_p^{1/2}(\boldsymbol{\Sigma}_q - \boldsymbol{S})\boldsymbol{\Sigma}_p^{1/2}$是正定对称矩阵（对称是显然的，而因为它能开平方，所以正定），$\boldsymbol{\Sigma}_p^{1/2}\boldsymbol{S}\boldsymbol{\Sigma}_p^{1/2}$也是正定对称的（因为$\boldsymbol{S}$是正定对称的），所以它们的特征值，都不超过它们的和——也就是$\boldsymbol{\Sigma}_p^{1/2}\boldsymbol{\Sigma}_q\boldsymbol{\Sigma}_p^{1/2}$的特征值，所以说，$(\boldsymbol{\Sigma}_p^{1/2}(\boldsymbol{\Sigma}_q - \boldsymbol{S})\boldsymbol{\Sigma}_p^{1/2})^{1/2}$每个特征值的最大值（也就是迹的最大值），在$\boldsymbol{S}=\boldsymbol{0}$处取到。</p>
<p>至于Weyl不等式的证明，主要利用到了<a href="https://en.wikipedia.org/wiki/Rayleigh_quotient">Rayleigh quotient</a>和<a href="https://en.wikipedia.org/wiki/Min-max_theorem">Courant–Fischer定理</a>，有兴趣了解的读者自行查阅这两部分资料后，再查阅Wely不等式的证明就好。事实上，熟悉这两部分内容后，Weyl不等式基本上就“水到渠成”了。</p>
<h3 id="2_1">推导过程2<a class="toc-link" href="#2_1" title="Permanent link">&para;</a></h3>
<p>这里继续介绍另一个更为简单的证明，原始证明可以在<a href="https://core.ac.uk/download/pdf/82269844.pdf">《The Fréchet distance between multivariate normal distributions》</a>找到。相对于第一个证明而言，该证明更简单直接，尤其是不需要太多的纯线性代数知识。下面的推导过程依旧是经过笔者进一步简化的，比原始论文更好理解一些。</p>
<p>在这个推导过程中，“去均值”、“纯代数”两个步骤跟“推导过程1”是一样的，不再重复。所以，此时问题已经被转化为</p>
<blockquote>
<p>已知$\boldsymbol{\Sigma}_{\gamma}= \begin{pmatrix} \boldsymbol{\Sigma}_p &amp; \boldsymbol{C}\\ \boldsymbol{C}^{\top} &amp; \boldsymbol{\Sigma}_q\end{pmatrix}$为正定对称矩阵，求$\text{Tr}(\boldsymbol{C})$的最大值。</p>
</blockquote>
<h4 id="_23">分块阵<a class="toc-link" href="#_23" title="Permanent link">&para;</a></h4>
<p>由于$\boldsymbol{\Sigma}_{\gamma}$是正定对称矩阵，所以它必然可以表达成$\boldsymbol{D}\boldsymbol{D}^{\top}$的形式，我们将$\boldsymbol{D}$表达为分块矩阵$\begin{pmatrix}\boldsymbol{A} \\ \boldsymbol{B}\end{pmatrix}$，其中$\boldsymbol{A},\boldsymbol{B}\in \mathbb{R}^{n\times 2n}$，此时<br />
\begin{equation}\begin{pmatrix} \boldsymbol{\Sigma}_p &amp; \boldsymbol{C}\\ \boldsymbol{C}^{\top} &amp; \boldsymbol{\Sigma}_q\end{pmatrix} = \begin{pmatrix}\boldsymbol{A} \\ \boldsymbol{B}\end{pmatrix} \begin{pmatrix}\boldsymbol{A}^{\top} &amp; \boldsymbol{B}^{\top}\end{pmatrix} = \begin{pmatrix} \boldsymbol{A}\boldsymbol{A}^{\top} &amp; \boldsymbol{A}\boldsymbol{B}^{\top}\\ \boldsymbol{B}\boldsymbol{A}^{\top} &amp; \boldsymbol{B}\boldsymbol{B}^{\top}\end{pmatrix}\end{equation}<br />
对应地有$\boldsymbol{\Sigma}_p=\boldsymbol{A}\boldsymbol{A}^{\top}, \boldsymbol{\Sigma}_q=\boldsymbol{B}\boldsymbol{B}^{\top},\boldsymbol{C}=\boldsymbol{A}\boldsymbol{B}^{\top}$。</p>
<h4 id="_24">乘子法<a class="toc-link" href="#_24" title="Permanent link">&para;</a></h4>
<p>在上述参数化之下，问题转化为：</p>
<blockquote>
<p>已知$\boldsymbol{A}\boldsymbol{A}^{\top}=\boldsymbol{\Sigma}_p, \boldsymbol{B}\boldsymbol{B}^{\top}=\boldsymbol{\Sigma}_q$，求$\text{Tr}(\boldsymbol{A}\boldsymbol{B}^{\top})$的最大值。</p>
</blockquote>
<p>这是一个带约束的最大值问题，我们用“<a href="https://en.wikipedia.org/wiki/Lagrange_multiplier">拉格朗日乘子法</a>”：引入新参数矩阵$\boldsymbol{W}_p, \boldsymbol{W}_q$，转化为下述无约束极值问题<br />
\begin{equation}F = \text{Tr}(\boldsymbol{A}\boldsymbol{B}^{\top}) - \frac{1}{2}\text{Tr}(\boldsymbol{W}_p(\boldsymbol{A}\boldsymbol{A}^{\top} - \boldsymbol{\Sigma}_p)) - \frac{1}{2}\text{Tr}(\boldsymbol{W}_q(\boldsymbol{B}\boldsymbol{B}^{\top} - \boldsymbol{\Sigma}_q))\end{equation}<br />
求导：<br />
\begin{equation}\begin{aligned}
&amp;\frac{\partial F}{\partial \boldsymbol{A}} = \boldsymbol{0} \quad \Rightarrow\quad \boldsymbol{B}^{\top} = \boldsymbol{A}^{\top}\boldsymbol{W}_p\\
&amp;\frac{\partial F}{\partial \boldsymbol{B}} = \boldsymbol{0} \quad \Rightarrow\quad \boldsymbol{A}^{\top} = \boldsymbol{B}^{\top}\boldsymbol{W}_q\\
&amp;\frac{\partial F}{\partial \boldsymbol{W}_p} = \boldsymbol{0} \quad \Rightarrow\quad \boldsymbol{A}\boldsymbol{A}^{\top} = \boldsymbol{\Sigma}_p\\
&amp;\frac{\partial F}{\partial \boldsymbol{W}_q} = \boldsymbol{0} \quad \Rightarrow\quad \boldsymbol{B}\boldsymbol{B}^{\top} = \boldsymbol{\Sigma}_q\\
\end{aligned}\end{equation}<br />
注意到$\boldsymbol{A}\boldsymbol{A}^{\top} - \boldsymbol{\Sigma}_p$和$\boldsymbol{B}\boldsymbol{B}^{\top} - \boldsymbol{\Sigma}_q$都是对称的，所以对应的参数矩阵$\boldsymbol{W}_p, \boldsymbol{W}_q$也是对称的，此时<br />
\begin{equation}\boldsymbol{\Sigma}_q = \boldsymbol{B}\boldsymbol{B}^{\top} = \left(\boldsymbol{A}^{\top}\boldsymbol{W}_p\right)^{\top}\left(\boldsymbol{A}^{\top}\boldsymbol{W}_p\right)=\boldsymbol{W}_p\boldsymbol{A}\boldsymbol{A}^{\top}\boldsymbol{W}_p=\boldsymbol{W}_p\boldsymbol{\Sigma}_p\boldsymbol{W}_p\\
\end{equation}<br />
令$\boldsymbol{W}_p=\boldsymbol{\Sigma}_p^{-1/2}\boldsymbol{R}\boldsymbol{\Sigma}_p^{-1/2}$，代入上式得$\boldsymbol{\Sigma}_q=\boldsymbol{\Sigma}_p^{-1/2}\boldsymbol{R}^2\boldsymbol{\Sigma}_p^{-1/2}$，即<br />
\begin{equation}\boldsymbol{R} = (\boldsymbol{\Sigma}_p^{1/2}\boldsymbol{\Sigma}_q\boldsymbol{\Sigma}_p^{1/2})^{1/2}
\end{equation}<br />
而<br />
\begin{equation}\begin{aligned}
\text{Tr}(\boldsymbol{A}\boldsymbol{B}^{\top}) =&amp;\, \text{Tr}(\boldsymbol{A}\boldsymbol{A}^{\top}\boldsymbol{W}_p)=\text{Tr}(\boldsymbol{\Sigma}_p\boldsymbol{W}_p)\\
=&amp;\,\text{Tr}(\boldsymbol{\Sigma}_p^{1/2}\boldsymbol{R}\boldsymbol{\Sigma}_p^{-1/2}) = \text{Tr}(\boldsymbol{R}\boldsymbol{\Sigma}_p^{-1/2}\boldsymbol{\Sigma}_p^{1/2})\\
=&amp;\,\text{Tr}(\boldsymbol{R})
\end{aligned}\end{equation}</p>
<h2 id="_25">文章小结<a class="toc-link" href="#_25" title="Permanent link">&para;</a></h2>
<p>本文详细计算了两个多元正态分布的KL散度、巴氏距离和W距离，给出了它们的显式解析解，这些结果在某些场景下可以作为隐变量的正则项使用，来规范隐变量的分布。此外，本文还可以作为比较有挑战性的线性代数练习题，供大家参考练习。</p>
<p><em><strong>转载到请包括本文地址：</strong><a href="https://spaces.ac.cn/archives/8512">https://spaces.ac.cn/archives/8512</a></em></p>
<p><em><strong>更详细的转载事宜请参考：</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="《科学空间FAQ》">《科学空间FAQ》</a></p>
<p><strong>如果您还有什么疑惑或建议，欢迎在下方评论区继续讨论。</strong></p>
<p><strong>如果您觉得本文还不错，欢迎分享/打赏本文。打赏并非要从中获得收益，而是希望知道科学空间获得了多少读者的真心关注。当然，如果你无视它，也不会影响你的阅读。再次表示欢迎和感谢！</strong></p>
<p>打赏</p>
<p><img alt="科学空间" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>微信打赏</p>
<p><img alt="科学空间" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>支付宝打赏</p>
<p>因为网站后台对打赏并无记录，因此欢迎在打赏时候备注留言。你还可以<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>点击这里</strong></a>或在下方评论区留言来告知你的建议或需求。</p>
<p><strong>如果您需要引用本文，请参考：</strong></p>
<p>苏剑林. (Jul. 08, 2021). 《两个多元正态分布的KL散度、巴氏距离和W距离 》[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/8512">https://spaces.ac.cn/archives/8512</a></p>
<p>@online{kexuefm-8512,<br />
title={两个多元正态分布的KL散度、巴氏距离和W距离},<br />
author={苏剑林},<br />
year={2021},<br />
month={Jul},<br />
url={\url{https://spaces.ac.cn/archives/8512}},<br />
} </p>
<hr />
<h2 id="_26">公式推导与注释<a class="toc-link" href="#_26" title="Permanent link">&para;</a></h2>
<p>TODO: 添加详细的数学公式推导和注释</p>
                </div>

                <!-- Previous/Next Navigation -->
                <nav class="post-navigation" aria-label="文章导航">
                    <div class="row g-3">
                        <div class="col-6">
                            
                            <a href="gelu的两个初等函数近似是怎么来的.html" class="nav-link-prev">
                                <div class="nav-direction"><i class="fas fa-chevron-left"></i> 上一篇</div>
                                <div class="nav-title">#15 GELU的两个初等函数近似是怎么来的</div>
                            </a>
                            
                        </div>
                        <div class="col-6">
                            
                            <a href="中文任务还是sota吗我们给simcse补充了一些实验.html" class="nav-link-next">
                                <div class="nav-direction">下一篇 <i class="fas fa-chevron-right"></i></div>
                                <div class="nav-title">#17 中文任务还是SOTA吗？我们给SimCSE补充了一些实验</div>
                            </a>
                            
                        </div>
                    </div>
                </nav>

                <!-- Back to Home -->
                <div class="text-center mt-4 mb-4">
                    <a href="../index.html" class="btn btn-outline-primary">
                        <i class="fas fa-arrow-left"></i> 返回首页
                    </a>
                </div>
            </div>

            <!-- Sidebar (TOC) -->
            <div class="col-lg-3">
                <aside class="sidebar">
                    
                    <div class="toc-sidebar">
                        <h5 class="toc-title"><i class="fas fa-list"></i> 目录</h5>
                        <div class="toc-content">
                            <div class="toc">
<ul>
<li><a href="#klw">两个多元正态分布的KL散度、巴氏距离和W距离</a><ul>
<li><a href="#_1">正态分布</a><ul>
<li><a href="#_2">概率密度</a></li>
<li><a href="#_3">基本性质</a></li>
<li><a href="#_4">高斯积分</a></li>
</ul>
</li>
<li><a href="#_5">线性代数</a><ul>
<li><a href="#_6">内积范数</a></li>
<li><a href="#_7">正定对称</a></li>
<li><a href="#_8">矩阵求导</a></li>
</ul>
</li>
<li><a href="#kl">KL散度</a><ul>
<li><a href="#_9">计算结果</a></li>
<li><a href="#_10">推导过程</a></li>
</ul>
</li>
<li><a href="#_11">巴氏距离</a><ul>
<li><a href="#_12">计算结果</a></li>
<li><a href="#_13">推导过程</a></li>
</ul>
</li>
<li><a href="#w">W距离</a><ul>
<li><a href="#_14">计算结果</a></li>
<li><a href="#1_1">推导过程1</a></li>
<li><a href="#2_1">推导过程2</a></li>
</ul>
</li>
<li><a href="#_25">文章小结</a></li>
<li><a href="#_26">公式推导与注释</a></li>
</ul>
</li>
</ul>
</div>

                        </div>
                        <div class="toc-actions">
                            <button class="btn btn-sm btn-outline-secondary" onclick="expandAll()">
                                <i class="fas fa-expand"></i> 全部展开
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="collapseAll()">
                                <i class="fas fa-compress"></i> 全部折叠
                            </button>
                        </div>
                    </div>
                    

                    <!-- Back to Top Button -->
                    <button id="backToTop" class="back-to-top" title="回到顶部">
                        <i class="fas fa-arrow-up"></i>
                    </button>
                </aside>
            </div>
        </div>
    </article>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>
                博客来源: <a href="https://spaces.ac.cn" target="_blank">科学空间</a> |
                内容经过整理并添加详细数学推导
            </p>
            <p>
                Powered by <a href="https://pages.github.com/" target="_blank">GitHub Pages</a>
            </p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Syntax highlighting -->
    <script>hljs.highlightAll();</script>

    <!-- Back to top functionality -->
    <script>
        // Show/hide back to top button based on scroll position
        window.addEventListener('scroll', function() {
            const backToTop = document.getElementById('backToTop');
            if (window.pageYOffset > 300) {
                backToTop.classList.add('show');
            } else {
                backToTop.classList.remove('show');
            }
        });

        // Smooth scroll to top
        document.getElementById('backToTop').addEventListener('click', function() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        // Sticky TOC sidebar
        window.addEventListener('scroll', function() {
            const sidebar = document.querySelector('.sidebar');
            if (!sidebar) return;

            const sidebarTop = sidebar.offsetTop;
            const scrollTop = window.pageYOffset;

            if (scrollTop > sidebarTop - 20) {
                sidebar.classList.add('sticky');
            } else {
                sidebar.classList.remove('sticky');
            }
        });
    </script>
</body>
</html>