<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>低秩近似之路（五）：CUR | ML & Math Blog Posts</title>
    <meta name="description" content="低秩近似之路（五）：CUR&para;
原文链接: https://spaces.ac.cn/archives/10662
发布日期: 

再次回到低秩近似之路上。在《低秩近似之路（四）：ID》中，我们介绍了“插值分解（Interpolative Decomposition，ID）”，这是为矩阵$\boldsymbol{M}\in\mathbb{R}^{n\times m}$寻找$\boldsym...">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css">

    <!-- Google Fonts -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/post.css">

    <!-- Custom JS -->
    <script src="../assets/js/collapsible.js" defer></script>

    <!-- MathJax for math rendering with equation numbering -->
    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true,
        processEnvironments: true,
        tags: 'ams',  // Enable equation numbering with AMS style
        tagSide: 'right',  // Place equation numbers on the right
        tagIndent: '0.8em',  // Indentation for equation numbers
        multlineWidth: '85%'
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Syntax highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/github.min.css">
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/highlight.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
        <div class="container">
            <a class="navbar-brand" href="../index.html">
                <i class="fas fa-brain"></i> ML & Math Blog
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../index.html"><i class="fas fa-home"></i> 首页</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Post Content -->
    <article class="container post-container my-5">
        <!-- Breadcrumb Navigation -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="../index.html"><i class="fas fa-home"></i> 首页</a></li>
                
                <li class="breadcrumb-item"><a href="../index.html?tags=近似">近似</a></li>
                
                <li class="breadcrumb-item active" aria-current="page">
                    #305 低秩近似之路（五）：CUR
                </li>
            </ol>
        </nav>

        <!-- Post Header -->
        <header class="post-header mb-4">
            <h1 class="post-title">
                <span class="post-number">#305</span>
                低秩近似之路（五）：CUR
            </h1>
            <div class="post-meta">
                <span><i class="far fa-calendar"></i> 2025-01-12</span>
                
            </div>
            
            <div class="post-tags mt-3">
                
                <a href="../index.html?tags=近似" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> 近似</span>
                </a>
                
                <a href="../index.html?tags=最优" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> 最优</span>
                </a>
                
                <a href="../index.html?tags=矩阵" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> 矩阵</span>
                </a>
                
                <a href="../index.html?tags=低秩" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> 低秩</span>
                </a>
                
                <a href="../index.html?tags=生成模型" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> 生成模型</span>
                </a>
                
            </div>
            
        </header>

        <div class="row">
            <!-- Main Content -->
            <div class="col-lg-9">
                <!-- Post Body -->
                <div class="post-content">
                    <h1 id="cur">低秩近似之路（五）：CUR<a class="toc-link" href="#cur" title="Permanent link">&para;</a></h1>
<p><strong>原文链接</strong>: <a href="https://spaces.ac.cn/archives/10662">https://spaces.ac.cn/archives/10662</a></p>
<p><strong>发布日期</strong>: </p>
<hr />
<p>再次回到低秩近似之路上。在<a href="/archives/10501">《低秩近似之路（四）：ID》</a>中，我们介绍了“插值分解（Interpolative Decomposition，ID）”，这是为矩阵$\boldsymbol{M}\in\mathbb{R}^{n\times m}$寻找$\boldsymbol{C}\boldsymbol{Z}$形式的近似的过程，其中$\boldsymbol{C}\in\mathbb{R}^{n\times r}$是矩阵$\boldsymbol{M}$的若干列，而$\boldsymbol{Z}\in\mathbb{R}^{r\times m}$是任意矩阵。</p>
<p>这篇文章我们将介绍CUR分解，它跟插值分解的思想一脉相承，都是以原始矩阵的行、列为“骨架”来构建原始矩阵的近似，跟ID只用行或列之一不同，CUR分解同时用到了行和列。</p>
<h2 id="_1">基本定义<a class="toc-link" href="#_1" title="Permanent link">&para;</a></h2>
<p>其实这不是本站第一次出现CUR分解了。早在<a href="/archives/8180">《Nyströmformer：基于矩阵分解的线性化Attention方案》</a>我们就介绍过矩阵的Nyström近似，它实际上就是CUR分解，后来在<a href="/archives/9336">《利用CUR分解加速交互式相似度模型的检索》</a>还介绍了CUR分解在降低交互式相似度模型的检索复杂度的应用。</p>
<p>CUR分解能有这些应用，关键在于它名称中的“C”和“R”。具体来说，CUR分解试图为矩阵$\boldsymbol{M}\in\mathbb{R}^{n\times m}$寻找如下形式的近似：<br />
\begin{equation}\mathop{\text{argmin}}<em _:_S_1_="[:,S_1]">{S_1,S_2,\boldsymbol{\mathcal{U}}}\Vert \underbrace{\boldsymbol{M}</em>}<em _S_2_:_="[S_2,:]">{\boldsymbol{\mathcal{C}}}\boldsymbol{\mathcal{U}}\underbrace{\boldsymbol{M}</em>}<em S_boldsymbol_Z="S,\boldsymbol{Z">{\boldsymbol{\mathcal{R}}} - \boldsymbol{M}\Vert_F^2\quad\text{s.t.}\quad \left\{\begin{aligned}&amp;S_1\subset\{0,1,\cdots,m-1\},|S_1|=r\\
&amp;S_2\subset\{0,1,\cdots,n-1\},|S_2|=r \\
&amp;\boldsymbol{\mathcal{U}}\in\mathbb{R}^{r\times r}
\end{aligned}\right.\end{equation}<br />
为了区分SVD的$\boldsymbol{U}$，这里用了花体的$\boldsymbol{\mathcal{C}},\boldsymbol{\mathcal{U}},\boldsymbol{\mathcal{R}}$。作为对比，上一篇介绍的ID是<br />
\begin{equation}\mathop{\text{argmin}}</em>}}\Vert \underbrace{\boldsymbol{M<em _boldsymbol_C="\boldsymbol{C">{[:,S]}}</em>}}\boldsymbol{Z} - \boldsymbol{M}\Vert_F^2\quad\text{s.t.}\quad \left\{\begin{aligned
&amp;S\subset\{0,1,\cdots,m-1\},|S|=r\\
&amp;\boldsymbol{Z}\in\mathbb{R}^{r\times m}
\end{aligned}\right.\end{equation}<br />
而SVD找的低秩近似是<br />
\begin{equation}\mathop{\text{argmin}}<em _:_:r_="[:,:r]">{\boldsymbol{U},\boldsymbol{\Sigma},\boldsymbol{V}}\Vert \boldsymbol{U}</em>}\boldsymbol{\Sigma<em _:_:r_="[:,:r]">{[:r,:r]}\boldsymbol{V}</em>}^{\top} - \boldsymbol{M}\Vert_F^2\quad\text{s.t.}\quad \left\{\begin{aligned
&amp;\boldsymbol{U}\in\mathbb{R}^{n\times n}, \boldsymbol{U}^{\top}\boldsymbol{U} = \boldsymbol{I}<em _min_n_m_="\min(n,m)">n \\
&amp;\boldsymbol{V}\in\mathbb{R}^{m\times n}, \boldsymbol{V}^{\top}\boldsymbol{V} = \boldsymbol{I}_m \\
&amp;\boldsymbol{\Sigma}=\text{diag}(\sigma_1,\cdots,\sigma</em>})\in\mathbb{R}_{\geq 0}^{n\times m
\end{aligned}\right.\end{equation}<br />
在<a href="/archives/10407">SVD篇</a>我们证明过，SVD可以找到$r$秩近似的最优解，但它本身的计算复杂度高，并且$\boldsymbol{U},\boldsymbol{V}$的物理意义并不直观。相比之下，CUR分解用原本矩阵的列$\boldsymbol{\mathcal{C}}$和行$\boldsymbol{\mathcal{R}}$替代了$\boldsymbol{\mathcal{U}},\boldsymbol{V}$，虽然在近似程度方面不如SVD，但在可解释性、储存成本、计算成本等方面都更优。</p>
<p>从外观上来看，SVD近似的左右矩阵$\boldsymbol{U},\boldsymbol{V}$更复杂而中间矩阵$\boldsymbol{\Sigma}$更简单，而CUR分解则相反，它是左右矩阵左右矩阵$\boldsymbol{\mathcal{C}},\boldsymbol{\mathcal{R}}$更简单而中间矩阵$\boldsymbol{\mathcal{U}}$更复杂。</p>
<h2 id="u">U的选择<a class="toc-link" href="#u" title="Permanent link">&para;</a></h2>
<p>很明显，CUR分解的难度在于行列的选择，因为当$\boldsymbol{\mathcal{C}},\boldsymbol{\mathcal{R}}$给定后，$\boldsymbol{\mathcal{U}}$的最优解是可以利用<a href="/archives/10366">伪逆</a>解析地表示出来：<br />
\begin{equation}\boldsymbol{\mathcal{U}}^* = \boldsymbol{\mathcal{C}}^{\dagger}\boldsymbol{M}\boldsymbol{\mathcal{R}}^{\dagger}\end{equation}<br />
求解过程可以参考伪逆篇的推导。其实这个解也很直观，假设$\boldsymbol{\mathcal{C}},\boldsymbol{\mathcal{R}}$都是可逆矩阵的话，那么方程$\boldsymbol{\mathcal{C}}\boldsymbol{\mathcal{U}}\boldsymbol{\mathcal{R}}=\boldsymbol{M}$的解自然是$\boldsymbol{\mathcal{U}}=\boldsymbol{\mathcal{C}}^{-1}\boldsymbol{M}\boldsymbol{\mathcal{R}}^{-1}$，而不可逆的时候就把逆${}^{-1}$换成伪逆${}^{\dagger}$。</p>
<p>除了这个理论最优解外，CUR分解还有一个经常用的、某种意义上更为直观的选择：<br />
\begin{equation}\boldsymbol{\mathcal{U}} = \boldsymbol{M}_{[S_2,S_1]}^{\dagger}\end{equation}<br />
注意切片运算的优先级高于转置和伪逆，所以这个$\boldsymbol{\mathcal{U}}$实际上就是$\boldsymbol{\mathcal{C}},\boldsymbol{\mathcal{R}}$的公共部分组成的子矩阵的伪逆。</p>
<p>怎么理解这个选择呢？通过交换行列，我们可以让被选中的行列都排在前面，并假设$\boldsymbol{M}<em _boldsymbol_M="\boldsymbol{M">{[S_2,S_1]}$可逆，那么该结果可以用分块矩阵写成<br />
\begin{equation}\underbrace{\begin{pmatrix}\boldsymbol{A} &amp; \boldsymbol{B} \\ \boldsymbol{C} &amp; \boldsymbol{D}\end{pmatrix}}</em>}} \approx \underbrace{\begin{pmatrix}\boldsymbol{A} \\ \boldsymbol{C}\end{pmatrix}<em _boldsymbol_mathcal_U="\boldsymbol{\mathcal{U">{\boldsymbol{\mathcal{C}}}\,\,\underbrace{\boldsymbol{A}^{-1}}</em>}}}\,\,\underbrace{\begin{pmatrix}\boldsymbol{A} &amp; \boldsymbol{B}\end{pmatrix}}_{\boldsymbol{\mathcal{R}}} = \begin{pmatrix}\boldsymbol{A} &amp; \boldsymbol{B} \\ \boldsymbol{C} &amp; \boldsymbol{C}\boldsymbol{A}^{-1}\boldsymbol{B}\end{pmatrix}\label{eq:id-abcd}\end{equation<br />
可以看到，此时的CUR分解精确地重建出了选出来的$\boldsymbol{A},\boldsymbol{B},\boldsymbol{C}$（或者说$\boldsymbol{\mathcal{C}},\boldsymbol{\mathcal{R}}$），并用$\boldsymbol{C}\boldsymbol{A}^{-1}\boldsymbol{B}$来近似$\boldsymbol{D}$，此时的CUR分解相当于一种“矩阵补全（Matrix Completion）”方法。</p>
<p>值得指出的是，由于两个$\boldsymbol{\mathcal{U}}$都用到了伪逆，且伪逆的定义并不要求方阵，所以最一般的CUR分解其实不要求$\boldsymbol{\mathcal{C}}$/$\boldsymbol{\mathcal{R}}$具有相同的列数/行数，如果有必要，我们可以为$\boldsymbol{\mathcal{C}}$/$\boldsymbol{\mathcal{R}}$选择不同数量的列/行。</p>
<h2 id="_2">行列选择<a class="toc-link" href="#_2" title="Permanent link">&para;</a></h2>
<p>解决完$\boldsymbol{\mathcal{U}}$之后，下面主要就是$\boldsymbol{\mathcal{C}},\boldsymbol{\mathcal{R}}$的选择了。由于行、列的选择本质上是等价的，所以下面我们以列的选择为例。</p>
<p>也就是说，下面我们的任务就是从矩阵$\boldsymbol{M}$中选出$r$个关键列，作为它的“骨架”，也可以叫做“轮廓”、“草图”等，这个问题我们其实在上两篇文章（即<a href="/archives/10427">CR篇</a>和<a href="/archives/10501">ID篇</a>）已经探究过，里边的方案也可以用来构建CUR分解的$\boldsymbol{\mathcal{C}},\boldsymbol{\mathcal{R}}$，包括</p>
<blockquote>
<p>1、选择模长最大的$r$列；</p>
<p>2、以模长为权随机采样$r$列；</p>
<p>3、均匀随机采样$r$列；</p>
<p>4、按列驱QR分解选择前$r$列。</p>
</blockquote>
<p>这些方案各有优劣，都有它们的适用场景和隐含假设。除此之外，我们也可以考虑一些更直观的做法，比如考虑到关键列的含义似乎跟“聚类中心”相似，所以我们可以将$n$个列向量聚成$k$类，然后选择距离聚类中心最近的$k$个向量。当$n$实在太大时，又可以先随机抽取一部分，然后再在这些向量中执行上述选择算法。</p>
<p>总的来说，列选择是矩阵近似中的一个经典问题，英文关键词是Randomized Linear Algebra、Column Subset Selection等，大家一搜就可以找到很多资料。</p>
<h2 id="_3">杠杆分数<a class="toc-link" href="#_3" title="Permanent link">&para;</a></h2>
<p>当然，作为一篇新文章，最好还是要介绍一些新方法，所以接下来我们再介绍另外两种列选择的思路。第一种我们称为“杠杆分数（Leverage Scores）”，它是通过线性回归的思想来进行列选择。</p>
<p>首先，我们将矩阵$\boldsymbol{M}$视为$m$个$n$维样本，然后相应地有$m$个$d$维向量构成目标矩阵$\boldsymbol{Y}$，我们的任务是用$\boldsymbol{M}$预测$\boldsymbol{Y}$，模型采用最简单的线性模型，优化目标是最小二乘<br />
\begin{equation}\boldsymbol{W}^<em> = \mathop{\text{argmin}}_{\boldsymbol{W}} \Vert\boldsymbol{Y} - \boldsymbol{W}\boldsymbol{M}\Vert_F^2\label{eq:linear-loss}\end{equation}<br />
这个目标我们在伪逆篇已经解决过，答案是$\boldsymbol{W}^</em> = \boldsymbol{Y}\boldsymbol{M}^{\dagger}$，假设$n &lt; m$且$\boldsymbol{M}$的秩为$n$，那么可以进一步写出$\boldsymbol{W}^<em> = \boldsymbol{Y}\boldsymbol{M}^{\top}(\boldsymbol{M}\boldsymbol{M}^{\top})^{-1}$，于是我们有<br />
\begin{equation}\hat{\boldsymbol{Y}} = \boldsymbol{W}^</em>\boldsymbol{M} = \boldsymbol{Y}\boldsymbol{M}^{\top}(\boldsymbol{M}\boldsymbol{M}^{\top})^{-1}\boldsymbol{M} = \boldsymbol{Y}\boldsymbol{H}\end{equation}<br />
这里$\boldsymbol{H}=\boldsymbol{M}^{\top}(\boldsymbol{M}\boldsymbol{M}^{\top})^{-1}\boldsymbol{M}$称为“帽子矩阵（Hat Matrix）”，据说是因为它将$\boldsymbol{Y}$变成$\hat{\boldsymbol{Y}}$，就像是给$\boldsymbol{Y}$带上了一定帽子（即$\hat{}$）。设$\boldsymbol{m}<em i_i="i,i">i$是$\boldsymbol{M}$的第$i$个列向量，在这里也就是第$i$个样本，那么我们认为<br />
\begin{equation}\boldsymbol{H}</em>} = \boldsymbol{m<em i_i="i,i">i^{\top}(\boldsymbol{M}\boldsymbol{M}^{\top})^{-1}\boldsymbol{m}_i\end{equation}<br />
衡量了该样本在预测$\hat{\boldsymbol{Y}}$时的作用，这就是“杠杆分数（Leverage Scores）”。我们认为选出$r$个关键列，就相当于要选出$r$个最重要的样本，于是可以选择$\boldsymbol{H}</em>$最大的$r$列。</p>
<p>当$\boldsymbol{M}\boldsymbol{M}^{\top}$不可逆时，论文<a href="https://papers.cool/arxiv/1511.07263">《Input Sparsity Time Low-Rank Approximation via Ridge Leverage Score Sampling》</a>将Leverage Scores推广为“Ridge Leverage Score”，实际就是在目标$\eqref{eq:linear-loss}$基础上加了个正则项使其可逆。但实际上我们知道，伪逆的概念是不要求满秩的，所以可以直接通过SVD来计算伪逆，这就不需要额外引入正则项了。</p>
<p>设$\boldsymbol{M}$的SVD为$\boldsymbol{U}\boldsymbol{\Sigma}\boldsymbol{V}^{\top}$，那么<br />
\begin{equation}\boldsymbol{H} = \boldsymbol{M}^{\dagger}\boldsymbol{M} = (\boldsymbol{V}\boldsymbol{\Sigma}^{\dagger}\boldsymbol{U}^{\top})(\boldsymbol{U}\boldsymbol{\Sigma}\boldsymbol{V}^{\top}) = \boldsymbol{V}(\boldsymbol{\Sigma}^{\dagger}\boldsymbol{\Sigma})\boldsymbol{V}^{\top}\end{equation}<br />
假设$\boldsymbol{M}$的秩为$\gamma$（$\gamma$不是$r$），那么按照伪逆的计算规则，$\boldsymbol{\Sigma}^{\dagger}\boldsymbol{\Sigma}$是一个$m\times m$的对角矩阵，对角线上前$\gamma$个元素全是1，其余是0，所以<br />
\begin{equation}\boldsymbol{H} = \boldsymbol{V}<em _:_:_gamma_="[:,:\gamma]">{[:,:\gamma]}\boldsymbol{V}</em>}^{\top}\quad\Rightarrow\quad \boldsymbol{H<em _i-1_:_gamma_="[i-1,:\gamma]">{i,i} = \Vert\boldsymbol{V}</em>}\Vert^2\end{equation
注意，$\boldsymbol{H}<em _i-1_:_gamma_="[i-1,:\gamma]">{i,i}$表示$\boldsymbol{H}$的第$i$行、$i$列元素，计数从1开始，但切片的规则按照Python来，计数从0开始，所以最后的切片是${}</em>}$。现在我们看到，要计算$\boldsymbol{M}$的列的杠杆分数，只需要将它SVD为$\boldsymbol{U}\boldsymbol{\Sigma}\boldsymbol{V}^{\top}$，然后计算$\boldsymbol{V<em _:_:_gamma_="[:,:\gamma]">{[:,:\gamma]}$各行的模长平方；同理，要计算行的杠杆分数，则只需要计算$\boldsymbol{U}</em>$各行的模长平方。</p>
<p>由于$\boldsymbol{V}$本身是正交矩阵，因此恒成立<br />
\begin{equation}\sum_{i=1}^m \boldsymbol{H}<em i="1">{i,i} = \sum</em>}^m\Vert\boldsymbol{V<em i_i="i,i">{[i-1,:\gamma]}\Vert^2 = \gamma\end{equation}<br />
因此除了选杠杆分数最大的$r$列之外，还可以构造分布$p_i = \boldsymbol{H}</em> / \gamma$来随机采样。</p>
<p>杠杆分数跟$\boldsymbol{M}$的秩$\gamma$相关，而$\boldsymbol{M}$的秩等于$\boldsymbol{M}$的非零奇异值个数，所以它会被接近零的奇异值影响，但这些偏小的奇异值实际作用不大，所以实践中$\gamma$一般取$\boldsymbol{M}$较显著的奇异值（主奇异值）个数。杠杆分数的另一个问题是需要先SVD，实践中多数会采用一些近似SVD算法。至于近似SVD算法的内容，我们后面有机会再谈了。</p>
<h2 id="deim">DEIM法<a class="toc-link" href="#deim" title="Permanent link">&para;</a></h2>
<p>另外一种要介绍的列选择方法叫做<a href="https://papers.cool/arxiv/1407.5516">DEIM</a>，全称是Discrete Empirical Interpolation Method，这里也不去考究这个名称的来源了，但大致上可以确定的是，杠杆分数和DEIM都是CUR分解常用的列选择方法，而且DEIM跟CUR分解的联系更为密切，所以近年来愈加流行。</p>
<p>DEIM的出发点是恒等式$\eqref{eq:id-abcd}$，在该式的$\boldsymbol{\mathcal{C}},\boldsymbol{\mathcal{U}},\boldsymbol{\mathcal{R}}$之下，CUR分解的误差取决于$\Vert \boldsymbol{D} - \boldsymbol{C}\boldsymbol{A}^{-1}\boldsymbol{B}\Vert_F$。什么时候这个式子会小呢？直观的想法是$\boldsymbol{A}$比较大，$\boldsymbol{B},\boldsymbol{C},\boldsymbol{D}$都比较小时，整个式子肯定也很小。但$\boldsymbol{A}$是一个矩阵，怎么衡量大小呢？行列式的绝对值可以作为一个参考指标。所以，一个可行方案是选择让$\boldsymbol{M}_{[S_2,S_1]}$行列式绝对值最大的对应行列。</p>
<p>当然，这个方案只有理论价值，因为精确找到行列式绝对值最大的子矩阵也是NP-Hard的，但它提供了一个目标，我们可以尝试找一个贪心解，当$r=1$时，找绝对值最大的行列式也就是找绝对值最大的元素，这是可以接受的，然后可以递归下去。DEIM沿用了这个思路，但它不是从$\boldsymbol{M}$出发，而是借鉴了杠杆分数的做法，从SVD之后的$\boldsymbol{V}$出发。</p>
<p>杠杆分数将 <em>从$\boldsymbol{M}$找关键列</em> 转化为 <em _:_:_gamma_="[:,:\gamma]">从$\boldsymbol{V}</em>$，我们只需要选择行。}$找关键行_ ，排序指标是行模长平方，DEIM则试图通过为$\boldsymbol{V}$找CUR近似来找关键行。可$\boldsymbol{M}$的CUR还没解决，现在又来一个$\boldsymbol{V}$的CUR，不是越搞越复杂？不会，这里还是简化一点的，因为$\boldsymbol{V}$是$\boldsymbol{M}$的SVD结果，它按照奇异值大小排序过了，所以我们可以认为$\boldsymbol{V}$的列已经按重要性排好序了，因此最重要的$r$列必然是$\boldsymbol{V}_{[:,:r]</p>
<p>如前面所述，求解思路是贪心算法，最重要的列自然是第一列$\boldsymbol{V}<em>{[:,0]}$，那最重要的行呢？我们要选择它跟第一列相交的行列时绝对值最大的那一行，说白了就是第一列绝对值对大的元素所在的那一行，这样我们就有了初始行列。假设我们已经选出了$k$个关键行，下标集为$S_k$，那怎么选出第$k+1$关键行呢？首先，我们知道由 _已选出的$k$行</em> 和 <em>前$k$列</em> 构建的CUR近似是$\boldsymbol{V}<em _S_k_:k_="[S_k,:k]">{[:,:k]}\boldsymbol{V}</em>}^{-1}\boldsymbol{V<em _:_k_="[:,k]">{[S_k,:]}$，第$k+1$列的误差是<br />
\begin{equation}\boldsymbol{V}</em>} - \boldsymbol{V<em _S_k_:k_="[S_k,:k]">{[:,:k]}\boldsymbol{V}</em>}^{-1}\boldsymbol{V}_{[S_k,k]}\end{equation
由式$\eqref{eq:id-abcd}$我们知道此种CUR近似能恢复所选的行和列，所以上式中已被选出的$k$行对应的分量必然为零，因此剩余的绝对值最大的非零元素必然不在已选出的$k$行之中，我们选择它的所在行作为第$k+1$个关键行。</p>
<p>简而言之，DEIM利用奇异值分解已经为$\boldsymbol{V}$的列向量排好序的特点，将CUR分解转化为一个单纯的行搜索问题，减少了搜索方向，然后通过贪心算法求解，每一步的选择依据是误差最大元素所在行。更详细的介绍和证明可以参考<a href="https://papers.cool/arxiv/1407.5516">《A DEIM Induced CUR Factorization》</a>和<a href="https://personal.math.vt.edu/embree/cur_talk.pdf">《CUR Matrix Factorizations: Algorithms, Analysis, Applications》</a>。</p>
<h2 id="_4">文章小结<a class="toc-link" href="#_4" title="Permanent link">&para;</a></h2>
<p>本文介绍了CUR分解，它可以视为上一篇文章介绍的插值分解（ID）的进一步延伸，特点是同时以原始矩阵的若干行与列作为骨架来构建低秩近似。</p>
<p><em><strong>转载到请包括本文地址：</strong><a href="https://spaces.ac.cn/archives/10662">https://spaces.ac.cn/archives/10662</a></em></p>
<p><em><strong>更详细的转载事宜请参考：</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="《科学空间FAQ》">《科学空间FAQ》</a></p>
<p><strong>如果您还有什么疑惑或建议，欢迎在下方评论区继续讨论。</strong></p>
<p><strong>如果您觉得本文还不错，欢迎分享/打赏本文。打赏并非要从中获得收益，而是希望知道科学空间获得了多少读者的真心关注。当然，如果你无视它，也不会影响你的阅读。再次表示欢迎和感谢！</strong></p>
<p>打赏</p>
<p><img alt="科学空间" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>微信打赏</p>
<p><img alt="科学空间" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>支付宝打赏</p>
<p>因为网站后台对打赏并无记录，因此欢迎在打赏时候备注留言。你还可以<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>点击这里</strong></a>或在下方评论区留言来告知你的建议或需求。</p>
<p><strong>如果您需要引用本文，请参考：</strong></p>
<p>苏剑林. (Jan. 12, 2025). 《低秩近似之路（五）：CUR 》[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/10662">https://spaces.ac.cn/archives/10662</a></p>
<p>@online{kexuefm-10662,<br />
title={低秩近似之路（五）：CUR},<br />
author={苏剑林},<br />
year={2025},<br />
month={Jan},<br />
url={\url{https://spaces.ac.cn/archives/10662}},<br />
} </p>
<hr />
<h2 id="_5">公式推导与注释<a class="toc-link" href="#_5" title="Permanent link">&para;</a></h2>
<p>本节将详细推导CUR分解的数学理论，包括定义、算法、误差分析和应用。所有重要公式都使用编号标记。</p>
<h3 id="1-cur">1. CUR分解的形式化定义<a class="toc-link" href="#1-cur" title="Permanent link">&para;</a></h3>
<p><strong>定义1.1 (CUR分解)</strong>: 给定矩阵 $\boldsymbol{M}\in\mathbb{R}^{n\times m}$，其CUR分解定义为：</p>
<p>\begin{equation}
\boldsymbol{M} \approx \boldsymbol{\mathcal{C}} \boldsymbol{\mathcal{U}} \boldsymbol{\mathcal{R}}
\tag{1}
\end{equation}</p>
<p>其中：
- $\boldsymbol{\mathcal{C}} \in \mathbb{R}^{n \times r}$ 是从 $\boldsymbol{M}$ 中选择的 $r$ 列组成的矩阵
- $\boldsymbol{\mathcal{R}} \in \mathbb{R}^{r \times m}$ 是从 $\boldsymbol{M}$ 中选择的 $r$ 行组成的矩阵
- $\boldsymbol{\mathcal{U}} \in \mathbb{R}^{r \times r}$ 是中间系数矩阵</p>
<p><strong>优化目标</strong>: CUR分解的优化问题可形式化为：</p>
<p>\begin{equation}
\min_{S_1, S_2, \boldsymbol{\mathcal{U}}} |\boldsymbol{M}<em _S_2_:_="[S_2,:]">{[:,S_1]} \boldsymbol{\mathcal{U}} \boldsymbol{M}</em>|_F^2
\tag{2}
\end{equation}} - \boldsymbol{M</p>
<p>约束条件：
\begin{equation}
\begin{cases}
S_1 \subset {1,2,\ldots,m}, \quad |S_1| = r \
S_2 \subset {1,2,\ldots,n}, \quad |S_2| = r \
\boldsymbol{\mathcal{U}} \in \mathbb{R}^{r \times r}
\end{cases}
\tag{3}
\end{equation}</p>
<h3 id="2-boldsymbolmathcalu">2. $\boldsymbol{\mathcal{U}}$ 的最优解推导<a class="toc-link" href="#2-boldsymbolmathcalu" title="Permanent link">&para;</a></h3>
<p><strong>命题2.1</strong>: 当 $\boldsymbol{\mathcal{C}}$ 和 $\boldsymbol{\mathcal{R}}$ 固定时，$\boldsymbol{\mathcal{U}}$ 的最优解为：</p>
<p>\begin{equation}
\boldsymbol{\mathcal{U}}^* = \boldsymbol{\mathcal{C}}^{\dagger} \boldsymbol{M} \boldsymbol{\mathcal{R}}^{\dagger}
\tag{4}
\end{equation}</p>
<p>其中 $\dagger$ 表示Moore-Penrose伪逆。</p>
<p><strong>证明</strong>: 优化目标可以写为：</p>
<p>\begin{equation}
f(\boldsymbol{\mathcal{U}}) = |\boldsymbol{\mathcal{C}} \boldsymbol{\mathcal{U}} \boldsymbol{\mathcal{R}} - \boldsymbol{M}|_F^2
\tag{5}
\end{equation}</p>
<p>展开Frobenius范数：</p>
<p>\begin{equation}
f(\boldsymbol{\mathcal{U}}) = \text{tr}\left[(\boldsymbol{\mathcal{C}} \boldsymbol{\mathcal{U}} \boldsymbol{\mathcal{R}} - \boldsymbol{M})^T (\boldsymbol{\mathcal{C}} \boldsymbol{\mathcal{U}} \boldsymbol{\mathcal{R}} - \boldsymbol{M})\right]
\tag{6}
\end{equation}</p>
<p>展开并利用迹的循环性质：</p>
<p>\begin{equation}
\begin{aligned}
f(\boldsymbol{\mathcal{U}}) &amp;= \text{tr}(\boldsymbol{\mathcal{R}}^T \boldsymbol{\mathcal{U}}^T \boldsymbol{\mathcal{C}}^T \boldsymbol{\mathcal{C}} \boldsymbol{\mathcal{U}} \boldsymbol{\mathcal{R}}) - 2\text{tr}(\boldsymbol{\mathcal{R}}^T \boldsymbol{\mathcal{U}}^T \boldsymbol{\mathcal{C}}^T \boldsymbol{M}) + \text{tr}(\boldsymbol{M}^T \boldsymbol{M})
\end{aligned}
\tag{7}
\end{equation}</p>
<p>对 $\boldsymbol{\mathcal{U}}$ 求导并令其为零（使用矩阵求导法则 $\frac{\partial}{\partial \boldsymbol{X}} \text{tr}(\boldsymbol{A}\boldsymbol{X}\boldsymbol{B}) = \boldsymbol{A}^T \boldsymbol{B}^T$）：</p>
<p>\begin{equation}
\frac{\partial f}{\partial \boldsymbol{\mathcal{U}}} = 2\boldsymbol{\mathcal{C}}^T \boldsymbol{\mathcal{C}} \boldsymbol{\mathcal{U}} \boldsymbol{\mathcal{R}} \boldsymbol{\mathcal{R}}^T - 2\boldsymbol{\mathcal{C}}^T \boldsymbol{M} \boldsymbol{\mathcal{R}}^T = 0
\tag{8}
\end{equation}</p>
<p>整理得到正规方程：</p>
<p>\begin{equation}
\boldsymbol{\mathcal{C}}^T \boldsymbol{\mathcal{C}} \boldsymbol{\mathcal{U}} \boldsymbol{\mathcal{R}} \boldsymbol{\mathcal{R}}^T = \boldsymbol{\mathcal{C}}^T \boldsymbol{M} \boldsymbol{\mathcal{R}}^T
\tag{9}
\end{equation}</p>
<p>利用伪逆的性质 $\boldsymbol{A}^{\dagger} = (\boldsymbol{A}^T \boldsymbol{A})^{-1} \boldsymbol{A}^T$（当 $\boldsymbol{A}$ 列满秩时），我们得到：</p>
<p>\begin{equation}
\boldsymbol{\mathcal{U}}^* = (\boldsymbol{\mathcal{C}}^T \boldsymbol{\mathcal{C}})^{-1} \boldsymbol{\mathcal{C}}^T \boldsymbol{M} \boldsymbol{\mathcal{R}}^T (\boldsymbol{\mathcal{R}} \boldsymbol{\mathcal{R}}^T)^{-1} = \boldsymbol{\mathcal{C}}^{\dagger} \boldsymbol{M} \boldsymbol{\mathcal{R}}^{\dagger}
\tag{10}
\end{equation}</p>
<p><strong>几何解释</strong>: 公式(4)的几何意义是：$\boldsymbol{\mathcal{U}}$ 通过最小二乘方法将 $\boldsymbol{M}$ 从列空间 $\text{col}(\boldsymbol{\mathcal{C}})$ 和行空间 $\text{row}(\boldsymbol{\mathcal{R}})$ 的角度进行最佳逼近。</p>
<h3 id="3">3. 交叉子矩阵方法<a class="toc-link" href="#3" title="Permanent link">&para;</a></h3>
<p><strong>命题3.1</strong>: CUR分解的另一个常用选择是：</p>
<p>\begin{equation}
\boldsymbol{\mathcal{U}} = \boldsymbol{M}_{[S_2, S_1]}^{\dagger}
\tag{11}
\end{equation}</p>
<p>其中 $\boldsymbol{M}_{[S_2, S_1]}$ 是 $\boldsymbol{\mathcal{C}}$ 和 $\boldsymbol{\mathcal{R}}$ 的交叉子矩阵。</p>
<p><strong>分块矩阵表示</strong>: 不失一般性，通过行列重排，设选中的行列排在前面：</p>
<p>\begin{equation}
\boldsymbol{M} = \begin{pmatrix}
\boldsymbol{A} &amp; \boldsymbol{B} \
\boldsymbol{C} &amp; \boldsymbol{D}
\end{pmatrix}
\tag{12}
\end{equation}</p>
<p>其中 $\boldsymbol{A} \in \mathbb{R}^{r \times r}$ 是交叉子矩阵，则CUR近似为：</p>
<p>\begin{equation}
\boldsymbol{M} \approx \begin{pmatrix}
\boldsymbol{A} \
\boldsymbol{C}
\end{pmatrix} \boldsymbol{A}^{\dagger} \begin{pmatrix}
\boldsymbol{A} &amp; \boldsymbol{B}
\end{pmatrix} = \begin{pmatrix}
\boldsymbol{A}\boldsymbol{A}^{\dagger}\boldsymbol{A} &amp; \boldsymbol{A}\boldsymbol{A}^{\dagger}\boldsymbol{B} \
\boldsymbol{C}\boldsymbol{A}^{\dagger}\boldsymbol{A} &amp; \boldsymbol{C}\boldsymbol{A}^{\dagger}\boldsymbol{B}
\end{pmatrix}
\tag{13}
\end{equation}</p>
<p>当 $\boldsymbol{A}$ 满秩时，$\boldsymbol{A}\boldsymbol{A}^{\dagger} = \boldsymbol{I}_r$，因此：</p>
<p>\begin{equation}
\boldsymbol{M} \approx \begin{pmatrix}
\boldsymbol{A} &amp; \boldsymbol{B} \
\boldsymbol{C} &amp; \boldsymbol{C}\boldsymbol{A}^{-1}\boldsymbol{B}
\end{pmatrix}
\tag{14}
\end{equation}</p>
<p><strong>解释</strong>:
- 选中的行列 $\boldsymbol{A}, \boldsymbol{B}, \boldsymbol{C}$ 被<strong>精确重构</strong>
- 未选中部分 $\boldsymbol{D}$ 通过 $\boldsymbol{C}\boldsymbol{A}^{-1}\boldsymbol{B}$ 进行<strong>插值近似</strong>
- 这种方法相当于一种<strong>矩阵补全</strong>策略</p>
<h3 id="4-svd">4. 与SVD的关系<a class="toc-link" href="#4-svd" title="Permanent link">&para;</a></h3>
<p><strong>定理4.1 (SVD的最优性)</strong>: 设 $\boldsymbol{M}$ 的SVD分解为：</p>
<p>\begin{equation}
\boldsymbol{M} = \sum_{i=1}^{\min(n,m)} \sigma_i \boldsymbol{u}_i \boldsymbol{v}_i^T = \boldsymbol{U} \boldsymbol{\Sigma} \boldsymbol{V}^T
\tag{15}
\end{equation}</p>
<p>则秩-$r$ 的最优逼近为：</p>
<p>\begin{equation}
\boldsymbol{M}<em i="1">r^* = \sum</em>}^{r} \sigma_i \boldsymbol{u<em _1:r=",1:r">i \boldsymbol{v}_i^T = \boldsymbol{U}</em>} \boldsymbol{\Sigma<em _1:r=",1:r">{1:r,1:r} \boldsymbol{V}</em>^T
\tag{16}
\end{equation}</p>
<p>满足：</p>
<p>\begin{equation}
|\boldsymbol{M} - \boldsymbol{M}<em i="r+1">r^*|_F^2 = \sum</em> \sigma_i^2
\tag{17}
\end{equation}}^{\min(n,m)</p>
<p><strong>CUR与SVD的误差比较</strong>: 定义近似比率：</p>
<p>\begin{equation}
\rho = \frac{|\boldsymbol{M} - \boldsymbol{\mathcal{C}}\boldsymbol{\mathcal{U}}\boldsymbol{\mathcal{R}}|_F^2}{|\boldsymbol{M} - \boldsymbol{M}_r^*|_F^2}
\tag{18}
\end{equation}</p>
<p>理论上 $\rho \geq 1$，好的CUR算法能使 $\rho$ 接近1。</p>
<p><strong>命题4.2</strong>: 对于良好选择的 $\boldsymbol{\mathcal{C}}, \boldsymbol{\mathcal{R}}$，存在常数 $C$ 使得：</p>
<p>\begin{equation}
|\boldsymbol{M} - \boldsymbol{\mathcal{C}}\boldsymbol{\mathcal{C}}^{\dagger}\boldsymbol{M}\boldsymbol{\mathcal{R}}^{\dagger}\boldsymbol{\mathcal{R}}|_F \leq C \cdot |\boldsymbol{M} - \boldsymbol{M}_r^*|_F
\tag{19}
\end{equation}</p>
<h3 id="5">5. 杠杆分数采样理论<a class="toc-link" href="#5" title="Permanent link">&para;</a></h3>
<p><strong>定义5.1 (帽子矩阵)</strong>: 对于 $\boldsymbol{M} \in \mathbb{R}^{n \times m}$ ($n &lt; m$)，列帽子矩阵定义为：</p>
<p>\begin{equation}
\boldsymbol{H}_{\text{col}} = \boldsymbol{M}^T (\boldsymbol{M}\boldsymbol{M}^T)^{\dagger} \boldsymbol{M}
\tag{20}
\end{equation}</p>
<p>行帽子矩阵定义为：</p>
<p>\begin{equation}
\boldsymbol{H}_{\text{row}} = \boldsymbol{M}^T (\boldsymbol{M}^T\boldsymbol{M})^{\dagger} \boldsymbol{M}
\tag{21}
\end{equation}</p>
<p><strong>几何意义</strong>: $\boldsymbol{H}_{\text{col}}$ 将向量投影到 $\boldsymbol{M}$ 的列空间。设线性回归问题为：</p>
<p>\begin{equation}
\min_{\boldsymbol{W}} |\boldsymbol{Y} - \boldsymbol{W}\boldsymbol{M}|_F^2
\tag{22}
\end{equation}</p>
<p>最优解为 $\boldsymbol{W}^* = \boldsymbol{Y}\boldsymbol{M}^{\dagger}$，预测值为：</p>
<p>\begin{equation}
\hat{\boldsymbol{Y}} = \boldsymbol{W}^* \boldsymbol{M} = \boldsymbol{Y} \boldsymbol{M}^{\dagger} \boldsymbol{M} = \boldsymbol{Y} \boldsymbol{H}_{\text{col}}
\tag{23}
\end{equation}</p>
<p><strong>定义5.2 (杠杆分数)</strong>: 第 $j$ 列的杠杆分数定义为：</p>
<p>\begin{equation}
\ell_j = [\boldsymbol{H}<em jj="jj">{\text{col}}]</em>_j
\tag{24}
\end{equation}} = \boldsymbol{m}_j^T (\boldsymbol{M}\boldsymbol{M}^T)^{\dagger} \boldsymbol{m</p>
<p>其中 $\boldsymbol{m}_j$ 是 $\boldsymbol{M}$ 的第 $j$ 列。</p>
<p><strong>命题5.3 (杠杆分数的SVD表示)</strong>: 设 $\boldsymbol{M} = \boldsymbol{U}\boldsymbol{\Sigma}\boldsymbol{V}^T$，秩为 $\gamma$，则：</p>
<p>\begin{equation}
\boldsymbol{H}<em _1:_gamma=",1:\gamma">{\text{col}} = \boldsymbol{M}^{\dagger} \boldsymbol{M} = \boldsymbol{V}\boldsymbol{\Sigma}^{\dagger}\boldsymbol{\Sigma}\boldsymbol{V}^T = \boldsymbol{V}</em>^T
\tag{25}
\end{equation}} \boldsymbol{V}_{:,1:\gamma</p>
<p>因此：</p>
<p>\begin{equation}
\ell_j = |\boldsymbol{V}<em i="1">{j,1:\gamma}|_2^2 = \sum</em>^2
\tag{26}
\end{equation}}^{\gamma} V_{ji</p>
<p><strong>性质</strong>: 杠杆分数满足：</p>
<p>\begin{equation}
\sum_{j=1}^{m} \ell_j = \text{tr}(\boldsymbol{H}_{\text{col}}) = \gamma
\tag{27}
\end{equation}</p>
<p><strong>采样策略</strong>:
1. <strong>确定性</strong>: 选择杠杆分数最大的 $r$ 列
2. <strong>随机性</strong>: 按概率分布 $p_j = \ell_j / \gamma$ 采样 $r$ 列</p>
<p><strong>定理5.4 (杠杆分数采样误差界)</strong>: 若按杠杆分数采样 $r = O(k \log k / \epsilon^2)$ 列（$k$ 是目标秩），则以高概率：</p>
<p>\begin{equation}
|\boldsymbol{M} - \boldsymbol{\mathcal{C}}\boldsymbol{\mathcal{C}}^{\dagger}\boldsymbol{M}|_F \leq (1+\epsilon) |\boldsymbol{M} - \boldsymbol{M}_k|_F
\tag{28}
\end{equation}</p>
<h3 id="6-deim">6. DEIM算法详解<a class="toc-link" href="#6-deim" title="Permanent link">&para;</a></h3>
<p><strong>算法思想</strong>: DEIM (Discrete Empirical Interpolation Method) 基于贪心策略，从SVD的右奇异向量中选择行。</p>
<p><strong>输入</strong>: 矩阵 $\boldsymbol{M} \in \mathbb{R}^{n \times m}$，目标秩 $r$</p>
<p><strong>步骤</strong>:</p>
<p><strong>Step 1</strong>: 计算SVD（或截断SVD）：</p>
<p>\begin{equation}
\boldsymbol{M} \approx \boldsymbol{U}<em 1:r_1:r="1:r,1:r">{:,1:r} \boldsymbol{\Sigma}</em>^T
\tag{29}
\end{equation}} \boldsymbol{V}_{:,1:r</p>
<p><strong>Step 2</strong>: 初始化，选择 $\boldsymbol{V}_{:,1}$ 绝对值最大元素的行：</p>
<p>\begin{equation}
i_1 = \arg\max_{i \in {1,\ldots,m}} |V_{i,1}|
\tag{30}
\end{equation}</p>
<p>设 $S_1 = {i_1}$。</p>
<p><strong>Step 3</strong>: 对 $k = 2, 3, \ldots, r$，递归选择：</p>
<p>计算残差：</p>
<p>\begin{equation}
\boldsymbol{r}<em _k=",k">k = \boldsymbol{V}</em>} - \boldsymbol{V<em S__k-1="S_{k-1">{:,1:k-1} \boldsymbol{V}</em>},1:k-1}^{-1} \boldsymbol{V<em k-1="k-1">{S</em>
\tag{31}
\end{equation}},k</p>
<p>选择残差最大的行：</p>
<p>\begin{equation}
i_k = \arg\max_{i \notin S_{k-1}} |r_{k,i}|
\tag{32}
\end{equation}</p>
<p>更新 $S_k = S_{k-1} \cup {i_k}$。</p>
<p><strong>Step 4</strong>: 输出列索引 $S_r$，构造：</p>
<p>\begin{equation}
\boldsymbol{\mathcal{C}} = \boldsymbol{M}<em S_r_S_r="S_r,S_r">{:,S_r}, \quad \boldsymbol{\mathcal{U}} = \boldsymbol{M}</em>
\tag{33}
\end{equation}}^{\dagger</p>
<p><strong>定理6.1 (DEIM误差界)</strong>: DEIM选择的列满足：</p>
<p>\begin{equation}
|\boldsymbol{V}<em _1:r=",1:r">{:,1:r} - \boldsymbol{V}</em>}\boldsymbol{V<em S_r_:="S_r,:">{S_r,1:r}^{-1}\boldsymbol{V}</em>|<em _r_1:=",r+1:">F \leq \sqrt{r(r+1)} |\boldsymbol{V}</em>|_F
\tag{34}
\end{equation}</p>
<p><strong>贪心准则的直觉</strong>: 在每一步，我们选择当前CUR近似误差最大的位置，确保：
- 选中的列能捕获主要的方差
- 交叉子矩阵 $\boldsymbol{V}_{S_r,1:r}$ 尽可能良好条件（行列式绝对值大）</p>
<h3 id="7">7. 误差分析<a class="toc-link" href="#7" title="Permanent link">&para;</a></h3>
<p><strong>定理7.1 (一般误差界)</strong>: 对于CUR分解 $\boldsymbol{M} \approx \boldsymbol{\mathcal{C}}\boldsymbol{\mathcal{U}}\boldsymbol{\mathcal{R}}$，近似误差可分解为：</p>
<p>\begin{equation}
\boldsymbol{M} - \boldsymbol{\mathcal{C}}\boldsymbol{\mathcal{U}}\boldsymbol{\mathcal{R}} = (\boldsymbol{I} - \boldsymbol{\mathcal{C}}\boldsymbol{\mathcal{C}}^{\dagger})\boldsymbol{M} + \boldsymbol{\mathcal{C}}\boldsymbol{\mathcal{C}}^{\dagger}\boldsymbol{M}(\boldsymbol{I} - \boldsymbol{\mathcal{R}}^{\dagger}\boldsymbol{\mathcal{R}})
\tag{35}
\end{equation}</p>
<p>当使用 $\boldsymbol{\mathcal{U}} = \boldsymbol{\mathcal{C}}^{\dagger}\boldsymbol{M}\boldsymbol{\mathcal{R}}^{\dagger}$ 时。</p>
<p><strong>证明</strong>: 展开右边：</p>
<p>\begin{equation}
\begin{aligned}
&amp;(\boldsymbol{I} - \boldsymbol{\mathcal{C}}\boldsymbol{\mathcal{C}}^{\dagger})\boldsymbol{M} + \boldsymbol{\mathcal{C}}\boldsymbol{\mathcal{C}}^{\dagger}\boldsymbol{M}(\boldsymbol{I} - \boldsymbol{\mathcal{R}}^{\dagger}\boldsymbol{\mathcal{R}}) \
&amp;= \boldsymbol{M} - \boldsymbol{\mathcal{C}}\boldsymbol{\mathcal{C}}^{\dagger}\boldsymbol{M} + \boldsymbol{\mathcal{C}}\boldsymbol{\mathcal{C}}^{\dagger}\boldsymbol{M} - \boldsymbol{\mathcal{C}}\boldsymbol{\mathcal{C}}^{\dagger}\boldsymbol{M}\boldsymbol{\mathcal{R}}^{\dagger}\boldsymbol{\mathcal{R}} \
&amp;= \boldsymbol{M} - \boldsymbol{\mathcal{C}}(\boldsymbol{\mathcal{C}}^{\dagger}\boldsymbol{M}\boldsymbol{\mathcal{R}}^{\dagger})\boldsymbol{\mathcal{R}} \
&amp;= \boldsymbol{M} - \boldsymbol{\mathcal{C}}\boldsymbol{\mathcal{U}}\boldsymbol{\mathcal{R}}
\end{aligned}
\tag{36}
\end{equation}</p>
<p><strong>推论7.2</strong>: 利用三角不等式：</p>
<p>\begin{equation}
|\boldsymbol{M} - \boldsymbol{\mathcal{C}}\boldsymbol{\mathcal{U}}\boldsymbol{\mathcal{R}}|_F \leq |(\boldsymbol{I} - \boldsymbol{\mathcal{C}}\boldsymbol{\mathcal{C}}^{\dagger})\boldsymbol{M}|_F + |\boldsymbol{\mathcal{C}}\boldsymbol{\mathcal{C}}^{\dagger}\boldsymbol{M}(\boldsymbol{I} - \boldsymbol{\mathcal{R}}^{\dagger}\boldsymbol{\mathcal{R}})|_F
\tag{37}
\end{equation}</p>
<p>第一项是列选择误差，第二项是行选择误差。</p>
<p><strong>定理7.3 (随机CUR误差界)</strong>: 若按杠杆分数采样 $r = \Omega(k/\epsilon^2)$ 列和行，则以概率至少 $1-\delta$：</p>
<p>\begin{equation}
|\boldsymbol{M} - \boldsymbol{\mathcal{C}}\boldsymbol{\mathcal{U}}\boldsymbol{\mathcal{R}}|_F \leq (1+\epsilon)|\boldsymbol{M} - \boldsymbol{M}_k|_F + \delta |\boldsymbol{M}|_F
\tag{38}
\end{equation}</p>
<h3 id="8">8. 算法复杂度分析<a class="toc-link" href="#8" title="Permanent link">&para;</a></h3>
<p><strong>SVD方法</strong>:
- 完整SVD: $O(\min(nm^2, n^2m))$
- 截断SVD (如randomized SVD): $O(nmr)$</p>
<p><strong>CUR分解复杂度</strong>:</p>
<p><strong>杠杆分数方法</strong>:
1. 计算截断SVD: $O(nmr)$
2. 计算杠杆分数: $O(mr)$
3. 选择/采样列: $O(m + nr)$
4. 计算 $\boldsymbol{\mathcal{U}}$: $O(nr^2 + r^2m + r^3)$</p>
<p>总计: $O(nmr + r^3)$</p>
<p><strong>DEIM方法</strong>:
1. 计算截断SVD: $O(nmr)$
2. 贪心选择（$r$ 次迭代，每次 $O(mr)$）: $O(mr^2)$
3. 计算 $\boldsymbol{\mathcal{U}}$: $O(r^3)$</p>
<p>总计: $O(nmr + mr^2)$</p>
<p><strong>存储复杂度对比</strong>:
- SVD: 需存储 $\boldsymbol{U}<em 1:r_1:r="1:r,1:r">{:,1:r}, \boldsymbol{\Sigma}</em>^T$，共 $O(nr + mr + r)$
- CUR: 需存储列索引、行索引和 $\boldsymbol{\mathcal{U}}$，共 $O(nr + mr + r^2)$}, \boldsymbol{V}_{:,1:r</p>
<h3 id="9">9. 数值示例<a class="toc-link" href="#9" title="Permanent link">&para;</a></h3>
<p><strong>示例9.1</strong>: 考虑一个低秩矩阵：</p>
<p>\begin{equation}
\boldsymbol{M} = \begin{pmatrix}
1 &amp; 2 &amp; 3 &amp; 4 \
2 &amp; 4 &amp; 6 &amp; 8 \
3 &amp; 6 &amp; 9 &amp; 12 \
4 &amp; 8 &amp; 12 &amp; 16
\end{pmatrix} + \boldsymbol{E}
\tag{39}
\end{equation}</p>
<p>其中 $\boldsymbol{E}$ 是小扰动。精确地，$\boldsymbol{M} = \boldsymbol{v}\boldsymbol{v}^T$，$\boldsymbol{v} = (1,2,3,4)^T$，秩为1。</p>
<p><strong>SVD</strong>: 主奇异值 $\sigma_1 \approx \sqrt{30}$，对应：</p>
<p>\begin{equation}
\boldsymbol{u}_1 = \frac{1}{\sqrt{30}}(1,2,3,4)^T, \quad \boldsymbol{v}_1 = \frac{1}{\sqrt{30}}(1,2,3,4)^T
\tag{40}
\end{equation}</p>
<p>秩-1近似：$\boldsymbol{M}_1 = \sigma_1 \boldsymbol{u}_1 \boldsymbol{v}_1^T = \boldsymbol{M}$（无扰动时）。</p>
<p><strong>CUR</strong> (选择第1列和第1行):</p>
<p>\begin{equation}
\boldsymbol{\mathcal{C}} = \begin{pmatrix} 1 \ 2 \ 3 \ 4 \end{pmatrix}, \quad
\boldsymbol{\mathcal{R}} = \begin{pmatrix} 1 &amp; 2 &amp; 3 &amp; 4 \end{pmatrix}
\tag{41}
\end{equation}</p>
<p>\begin{equation}
\boldsymbol{\mathcal{U}} = (\boldsymbol{\mathcal{C}}^T \boldsymbol{\mathcal{C}})^{-1} \boldsymbol{\mathcal{C}}^T \boldsymbol{M} \boldsymbol{\mathcal{R}}^T (\boldsymbol{\mathcal{R}} \boldsymbol{\mathcal{R}}^T)^{-1} = \frac{1}{30} \cdot 30 \cdot \frac{1}{30} = 1
\tag{42}
\end{equation}</p>
<p>CUR近似：</p>
<p>\begin{equation}
\boldsymbol{\mathcal{C}}\boldsymbol{\mathcal{U}}\boldsymbol{\mathcal{R}} = \begin{pmatrix} 1 \ 2 \ 3 \ 4 \end{pmatrix} \cdot 1 \cdot \begin{pmatrix} 1 &amp; 2 &amp; 3 &amp; 4 \end{pmatrix} = \boldsymbol{M}
\tag{43}
\end{equation}</p>
<p>完美重构！</p>
<p><strong>示例9.2 (杠杆分数计算)</strong>: 对于</p>
<p>\begin{equation}
\boldsymbol{M} = \begin{pmatrix}
1 &amp; 0 &amp; 0 \
0 &amp; 1 &amp; 0 \
0 &amp; 0 &amp; 1 \
0 &amp; 0 &amp; 0
\end{pmatrix}
\tag{44}
\end{equation}</p>
<p>SVD给出 $\boldsymbol{V} = \boldsymbol{I}_3$（前3个奇异值为1），因此：</p>
<p>\begin{equation}
\ell_1 = |\boldsymbol{V}_{1,:}|^2 = 1, \quad \ell_2 = 1, \quad \ell_3 = 1
\tag{45}
\end{equation}</p>
<p>所有列的杠杆分数相等，随机采样时每列被选中的概率相同。</p>
<h3 id="10">10. 应用场景<a class="toc-link" href="#10" title="Permanent link">&para;</a></h3>
<p><strong>应用10.1 (推荐系统)</strong>: 用户-物品评分矩阵 $\boldsymbol{R} \in \mathbb{R}^{n_u \times n_i}$，CUR分解：
- $\boldsymbol{\mathcal{C}}$: 代表性物品
- $\boldsymbol{\mathcal{R}}$: 代表性用户
- $\boldsymbol{\mathcal{U}}$: 代表用户对代表物品的偏好</p>
<p>优势：可解释性强，能识别"原型用户"和"原型物品"。</p>
<p><strong>应用10.2 (文档聚类)</strong>: 文档-词矩阵 $\boldsymbol{X} \in \mathbb{R}^{n_d \times n_w}$，CUR选择：
- 代表性词汇（列）
- 代表性文档（行）</p>
<p>用于降维和特征选择。</p>
<p><strong>应用10.3 (图像压缩)</strong>: 图像矩阵 $\boldsymbol{I} \in \mathbb{R}^{h \times w}$：
- $\boldsymbol{\mathcal{C}}$: 代表性列（垂直条纹）
- $\boldsymbol{\mathcal{R}}$: 代表性行（水平条纹）</p>
<p>存储成本：$r(h+w+r)$ vs. 原始 $hw$，当 $r \ll \min(h,w)$ 时显著压缩。</p>
<h3 id="11-cur">11. CUR的可解释性优势<a class="toc-link" href="#11-cur" title="Permanent link">&para;</a></h3>
<p>相比SVD，CUR的关键优势在于<strong>可解释性</strong>：</p>
<p><strong>对比表</strong>:</p>
<table>
<thead>
<tr>
<th>方面</th>
<th>SVD</th>
<th>CUR</th>
</tr>
</thead>
<tbody>
<tr>
<td>基向量</td>
<td>抽象的正交向量</td>
<td>原始数据的行/列</td>
</tr>
<tr>
<td>物理意义</td>
<td>难以解释</td>
<td>直观可解释</td>
</tr>
<tr>
<td>稀疏性</td>
<td>密集矩阵</td>
<td>保持原始稀疏性</td>
</tr>
<tr>
<td>计算</td>
<td>需全矩阵</td>
<td>可增量/流式</td>
</tr>
</tbody>
</table>
<p><strong>定理11.1 (稀疏性保持)</strong>: 若 $\boldsymbol{M}$ 是稀疏矩阵（每行/列非零元素 $\leq s$），则：
- $\boldsymbol{\mathcal{C}}, \boldsymbol{\mathcal{R}}$ 同样稀疏（每列/行非零元素 $\leq s$）
- SVD的 $\boldsymbol{U}, \boldsymbol{V}$ 通常是稠密的</p>
<h3 id="12">12. 小结与展望<a class="toc-link" href="#12" title="Permanent link">&para;</a></h3>
<p>CUR分解通过以下方式实现低秩近似：</p>
<p>\begin{equation}
\underbrace{\text{原始矩阵}}<em _boldsymbol_mathcal_C="\boldsymbol{\mathcal{C">{\boldsymbol{M}} \approx \underbrace{\text{代表列}}</em>}}} \times \underbrace{\text{系数矩阵}<em _boldsymbol_mathcal_R="\boldsymbol{\mathcal{R">{\boldsymbol{\mathcal{U}}} \times \underbrace{\text{代表行}}</em>
\tag{46}
\end{equation}}}</p>
<p><strong>核心要点</strong>:
1. $\boldsymbol{\mathcal{U}}$ 的最优解通过伪逆给出（公式4）
2. 列/行选择是关键：杠杆分数和DEIM是主流方法
3. 误差界与SVD相当（在对数因子内）
4. 可解释性和稀疏性是主要优势</p>
<p><strong>未来方向</strong>:
- 自适应采样策略
- 流式/在线CUR算法
- 张量CUR分解
- 深度学习中的应用（注意力机制的CUR近似）</p>
<p>\begin{equation}
\boxed{\text{CUR分解：保持数据原始结构的智能低秩近似}}
\tag{47}
\end{equation}</p>
                </div>

                <!-- Previous/Next Navigation -->
                <nav class="post-navigation" aria-label="文章导航">
                    <div class="row g-3">
                        <div class="col-6">
                            
                            <a href="为什么梯度裁剪的默认模长是1.html" class="nav-link-prev">
                                <div class="nav-direction"><i class="fas fa-chevron-left"></i> 上一篇</div>
                                <div class="nav-title">#304 为什么梯度裁剪的默认模长是1？</div>
                            </a>
                            
                        </div>
                        <div class="col-6">
                            
                            <a href="细水长flow之tarflow流模型满血归来.html" class="nav-link-next">
                                <div class="nav-direction">下一篇 <i class="fas fa-chevron-right"></i></div>
                                <div class="nav-title">#306 细水长flow之TARFLOW：流模型满血归来？</div>
                            </a>
                            
                        </div>
                    </div>
                </nav>

                <!-- Back to Home -->
                <div class="text-center mt-4 mb-4">
                    <a href="../index.html" class="btn btn-outline-primary">
                        <i class="fas fa-arrow-left"></i> 返回首页
                    </a>
                </div>
            </div>

            <!-- Sidebar (TOC) -->
            <div class="col-lg-3">
                <aside class="sidebar">
                    
                    <div class="toc-sidebar">
                        <h5 class="toc-title"><i class="fas fa-list"></i> 目录</h5>
                        <div class="toc-content">
                            <div class="toc">
<ul>
<li><a href="#cur">低秩近似之路（五）：CUR</a><ul>
<li><a href="#_1">基本定义</a></li>
<li><a href="#u">U的选择</a></li>
<li><a href="#_2">行列选择</a></li>
<li><a href="#_3">杠杆分数</a></li>
<li><a href="#deim">DEIM法</a></li>
<li><a href="#_4">文章小结</a></li>
<li><a href="#_5">公式推导与注释</a><ul>
<li><a href="#1-cur">1. CUR分解的形式化定义</a></li>
<li><a href="#2-boldsymbolmathcalu">2. $\boldsymbol{\mathcal{U}}$ 的最优解推导</a></li>
<li><a href="#3">3. 交叉子矩阵方法</a></li>
<li><a href="#4-svd">4. 与SVD的关系</a></li>
<li><a href="#5">5. 杠杆分数采样理论</a></li>
<li><a href="#6-deim">6. DEIM算法详解</a></li>
<li><a href="#7">7. 误差分析</a></li>
<li><a href="#8">8. 算法复杂度分析</a></li>
<li><a href="#9">9. 数值示例</a></li>
<li><a href="#10">10. 应用场景</a></li>
<li><a href="#11-cur">11. CUR的可解释性优势</a></li>
<li><a href="#12">12. 小结与展望</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

                        </div>
                        <div class="toc-actions">
                            <button class="btn btn-sm btn-outline-secondary" onclick="expandAll()">
                                <i class="fas fa-expand"></i> 全部展开
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="collapseAll()">
                                <i class="fas fa-compress"></i> 全部折叠
                            </button>
                        </div>
                    </div>
                    

                    <!-- Back to Top Button -->
                    <button id="backToTop" class="back-to-top" title="回到顶部">
                        <i class="fas fa-arrow-up"></i>
                    </button>
                </aside>
            </div>
        </div>
    </article>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>
                博客来源: <a href="https://spaces.ac.cn" target="_blank">科学空间</a> |
                内容经过整理并添加详细数学推导
            </p>
            <p>
                Powered by <a href="https://pages.github.com/" target="_blank">GitHub Pages</a>
            </p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Syntax highlighting -->
    <script>hljs.highlightAll();</script>

    <!-- Back to top functionality -->
    <script>
        // Show/hide back to top button based on scroll position
        window.addEventListener('scroll', function() {
            const backToTop = document.getElementById('backToTop');
            if (window.pageYOffset > 300) {
                backToTop.classList.add('show');
            } else {
                backToTop.classList.remove('show');
            }
        });

        // Smooth scroll to top
        document.getElementById('backToTop').addEventListener('click', function() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        // Sticky TOC sidebar
        window.addEventListener('scroll', function() {
            const sidebar = document.querySelector('.sidebar');
            if (!sidebar) return;

            const sidebarTop = sidebar.offsetTop;
            const scrollTop = window.pageYOffset;

            if (scrollTop > sidebarTop - 20) {
                sidebar.classList.add('sticky');
            } else {
                sidebar.classList.remove('sticky');
            }
        });
    </script>
</body>
</html>