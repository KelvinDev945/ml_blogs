<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>基于量子化假设推导模型的尺度定律（Scaling Law） | ML & Math Blog Posts</title>
    <meta name="description" content="基于量子化假设推导模型的尺度定律（Scaling Law）
原文链接: https://spaces.ac.cn/archives/9607
发布日期: 

尺度定律（Scaling Law），指的是模型能力与模型尺度之间的渐近关系。具体来说，模型能力我们可以简单理解为模型的损失函数，模型尺度可以指模型参数量、训练数据量、训练步数等，所谓尺度定律，就是研究损失函数跟参数量、数据量、训练步数等变量的...">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css">

    <!-- Google Fonts -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/post.css">

    <!-- MathJax for math rendering -->
    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true,
        processEnvironments: true
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Syntax highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/github.min.css">
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/highlight.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
        <div class="container">
            <a class="navbar-brand" href="../index.html">
                <i class="fas fa-brain"></i> ML & Math Blog
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../index.html"><i class="fas fa-home"></i> 首页</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Post Content -->
    <article class="container post-container my-5">
        <!-- Post Header -->
        <header class="post-header mb-4">
            <h1 class="post-title">基于量子化假设推导模型的尺度定律（Scaling Law）</h1>
            <div class="post-meta">
                <span><i class="far fa-calendar"></i> </span>
                
                <span class="ms-3">
                    <i class="fas fa-link"></i>
                    <a href="https://spaces.ac.cn/archives/9607" target="_blank">原文链接</a>
                </span>
                
            </div>
            
            <div class="post-tags mt-3">
                
                <span class="tag"><i class="fas fa-tag"></i> 模型</span>
                <span class="tag"><i class="fas fa-tag"></i> 分析</span>
                <span class="tag"><i class="fas fa-tag"></i> 量子</span>
                <span class="tag"><i class="fas fa-tag"></i> 尺度定律</span>
                <span class="tag"><i class="fas fa-tag"></i> 生成模型</span>
                
            </div>
            
        </header>

        <!-- Post Body -->
        <div class="post-content">
            <h1 id="scaling-law">基于量子化假设推导模型的尺度定律（Scaling Law）</h1>
<p><strong>原文链接</strong>: <a href="https://spaces.ac.cn/archives/9607">https://spaces.ac.cn/archives/9607</a></p>
<p><strong>发布日期</strong>: </p>
<hr />
<p>尺度定律（Scaling Law），指的是模型能力与模型尺度之间的渐近关系。具体来说，模型能力我们可以简单理解为模型的损失函数，模型尺度可以指模型参数量、训练数据量、训练步数等，所谓尺度定律，就是研究损失函数跟参数量、数据量、训练步数等变量的大致关系。<a href="https://papers.cool/arxiv/2001.08361">《Scaling Laws for Neural Language Models》</a>、<a href="https://papers.cool/arxiv/2203.15556">《Training Compute-Optimal Large Language Models》</a>等工作的实验结果表明，神经网络的尺度定律多数呈现“幂律（Power law）”的形式。</p>
<p>为什么会是幂律呢？能否从理论上解释呢？论文<a href="https://papers.cool/arxiv/2303.13506">《The Quantization Model of Neural Scaling》</a>基于“量子化”假设给出了一个颇为有趣的推导。本文一同来欣赏一下。</p>
<h2 id="_1">推导假设</h2>
<p>首先，我们假设对于一个特定的任务，存在一个“完美模型”，我们所训练的模型，都是这个“完美模型”的一个逼近。进一步地，假设“完美模型”是由“量子（Quanta）”组成的，每个量子代表一种能力（注意，这里的量子主要是指虚拟的能力单位，并非我们能叫出名字的具体能力）。</p>
<p>为了完成任务，往往需要多种能力，所以不失一般性，我们假设“完美模型”包含无穷多个能力量子，不同的量子负责解决不同难度的样本。通常来说，简单样本会占多数，困难样本是少数，所以这些能力量子可以按照出现频率从高到低进行排序，分别标记为$1,2,\cdots,k,\dots$，对应的出现频率则为$p_1,p_2,\cdots,p_k,\cdots$。</p>
<p>最后，我们假设这些能力量子的频率服从“<a href="https://en.wikipedia.org/wiki/Zipf%27s_law">Zipf定律（Zipf's law）</a>”，即<br />
\begin{equation}p_k = \frac{k^{-\gamma - 1}}{Z_{\gamma}}\end{equation}<br />
其中$\gamma &gt; 0$，$Z_{\gamma}$是归一化因子$\sum\limits_{k=1}^{\infty}k^{-\gamma - 1}$。</p>
<h2 id="zipf">Zipf定律</h2>
<p>可能读者想问，为什么是Zipf定律呢？Zipf定律是Zipf在1949年发表的经验定律，他的原始发现是一个单词出现的频率大致与它在频率表里的排名成反比，后来人们把它一般化为跟“排名的幂”成反比，并且发现在很多地方都能观察到Zipf定律。</p>
<p>Zipf本人以及一些后来者都尝试在一些更贴近本质的假设之下对Zipf定律进行推导，相关工作可以在维基百科找到，这里就不展开了。对于笔者来说，选择Zipf定律的最重要原因其实是——<strong>也没其他可选了。</strong></p>
<p>别忘了，$p_k$已经从高到低排序过了，所以$p_k$是一个单调递减函数，我们能想到的非负的、单调递减的函数有啥呢？无外乎就指数函数和幂函数了吧，指数函数衰减得很快，所以没有长尾现象，而幂函数衰减慢一些，相对来说更加长尾。所以选哪个，取决于我们对尾部重要性的先验认知。对于前面的能力量子假设，我们认为每一种能力都很关键，所以只能选择幂函数了，结果也就是Zipf定律。</p>
<h2 id="_2">基本结果</h2>
<p>回到正题。前面假设理想模型有无穷多个能力量子，而对于一个容量有限的现实模型，它只能学习到$n$个量子，为了能够覆盖更多的样本，模型应该去学习前$n$个量子。假设每个量子都能够将它对应的样本的损失从$b$降低到$a$，那么可以预估模型的平均损失为<br />
\begin{equation}L = a \sum_{k=1}^n p_k + b \sum_{k=n+1}^{\infty} p_k\end{equation}<br />
前$n$个量子已经被学习到了，所以这部分样本的损失都为$a$，后面的量子没有被学习到，所以损失为$b$。这个假设看起来有点强，将$a,b$设为$k$的函数可能更合理些，但结果已经有代表性了（参考原论文附录）。对于上式，我们可以完成一个渐近估计：<br />
\begin{equation}\begin{aligned}<br />
L =&amp;\, a \sum_{k=1}^{\infty} p_k + (b - a) \sum_{k=n+1}^{\infty} p_k \\<br />
=&amp;\, a + (b - a) \sum_{k=n+1}^{\infty} \frac{k^{-\gamma-1}}{Z_{\gamma}} \\<br />
\sim&amp;\, a + (b - a) \int_n^{\infty} \frac{k^{-\gamma-1}}{Z_{\gamma}} dk \\<br />
=&amp;\, a + \frac{b - a}{\gamma Z_{\gamma}} n^{-\gamma} \\<br />
\end{aligned}\end{equation}<br />
它表明模型的能力（损失函数）跟能力量子的数目$n$的关系呈现幂律$n^{-\gamma}$的形式。显然，这里的$a$就代表损失函数的最小值，如果$a=0$，那么就有$L\sim \mathcal{O}(n^{-\gamma})$。下面我们都假设$a=0$。</p>
<h2 id="_3">尺度定律</h2>
<p>基本结果中的$n$，是模型学到的能力量子的数目，到目前为止还只是一个虚拟的概念，接下来我们将它跟模型常见的变量联系起来。</p>
<p><strong>参数量：</strong> 假设模型的参数量为$N$，然后假设平均每$C$个参数才能学到一个能力量子（假设$C$是常数），那么很显然有$n\propto N$，以及<br />
\begin{equation}L\sim \mathcal{O}(N^{-\gamma})\end{equation}</p>
<p><strong>数据量：</strong> 假设训练集的总样本数为$D$，由于我们假设不同的量子负责解决不同难度的样本，所以我们可以很自然地认为由量子$1$解决的样本数为$Dp_1$、由量子$2$解决的样本数为$Dp_2$、由量子$3$解决的样本数为$Dp_3$、...，然后我们假设学习一个量子至少需要$\tau$个样本，那么$Dp_k &lt; \tau$的量子都无法学到。于是由$\tau=D p_n$我们可以解得$n\propto D^{1/(\gamma + 1)}$，代入得到<br />
\begin{equation}L\sim \mathcal{O}(D^{-\gamma/(\gamma + 1)})\end{equation}</p>
<p><strong>训练量：</strong> 假设模型的参数量和训练集的样本数都无上限，那么模型学到的量子数$n$就取决于训练步数$S$了。假设批大小为$B$，那么平均来说学习量子$1$的样本数为$Bp_1$、学习量子$2$的样本数为$Bp_2$、学习量子$3$的样本数为$Bp_3$、...，同样假设学习一个量子至少需要学习$\tau$个样本，那么经过$S$步训练后，量子$n$共学习了$SBp_n$个样本，于是由$\tau=SB p_n$可以解得$n\propto S^{1/(\gamma + 1)}$，代入得到<br />
\begin{equation}L\sim \mathcal{O}(S^{-\gamma/(\gamma + 1)})\end{equation}</p>
<p>可以看到，虽然结果都是幂律，但是因为$\gamma &gt; \gamma/(\gamma + 1) \in (0, 1)$，所以很显然参数量对模型能力的影响更加大一些。</p>
<h2 id="_4">涌现现象</h2>
<p>可能有读者想问，能力量子化假设是否可以用来解释大模型的涌现（Emergency）现象呢？</p>
<p>一定程度上可以。前面我们假设完美模型应该具有无穷多个能力量子，如果将这个无穷改为有限，那么通过增加参数量，模型总会有机会覆盖所有的能力量子，达到理论最优的完美模型，这就是涌现。又或者说，完美模型还是应该具有无穷多个能力量子，但人类对智能的“分辨力”只有有限个量子（人类本身未必是完美的），所以当大模型学到一定数目的能量量子后，在人类的视角中就是完美的“涌现”了。</p>
<h2 id="_5">文章小结</h2>
<p>本文介绍了从量子化假设来推导模型的尺度定律（Scaling Law）的过程，具体来说就是模型的损失函数与参数量、数据量、训练量的渐近关系，并简单分析了它与涌现现象的可能联系。</p>
<p><em><strong>转载到请包括本文地址：</strong><a href="https://spaces.ac.cn/archives/9607">https://spaces.ac.cn/archives/9607</a></em></p>
<p><em><strong>更详细的转载事宜请参考：</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="《科学空间FAQ》">《科学空间FAQ》</a></p>
<p><strong>如果您还有什么疑惑或建议，欢迎在下方评论区继续讨论。</strong></p>
<p><strong>如果您觉得本文还不错，欢迎分享/打赏本文。打赏并非要从中获得收益，而是希望知道科学空间获得了多少读者的真心关注。当然，如果你无视它，也不会影响你的阅读。再次表示欢迎和感谢！</strong></p>
<p>打赏</p>
<p><img alt="科学空间" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>微信打赏</p>
<p><img alt="科学空间" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>支付宝打赏</p>
<p>因为网站后台对打赏并无记录，因此欢迎在打赏时候备注留言。你还可以<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>点击这里</strong></a>或在下方评论区留言来告知你的建议或需求。</p>
<p><strong>如果您需要引用本文，请参考：</strong></p>
<p>苏剑林. (May. 18, 2023). 《基于量子化假设推导模型的尺度定律（Scaling Law） 》[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/9607">https://spaces.ac.cn/archives/9607</a></p>
<p>@online{kexuefm-9607,<br />
title={基于量子化假设推导模型的尺度定律（Scaling Law）},<br />
author={苏剑林},<br />
year={2023},<br />
month={May},<br />
url={\url{https://spaces.ac.cn/archives/9607}},<br />
} </p>
<hr />
<h2 id="_6">公式推导与注释</h2>
<p>TODO: 添加详细的数学公式推导和注释</p>
        </div>

        <!-- Back to Home -->
        <div class="text-center mt-5 mb-4">
            <a href="../index.html" class="btn btn-outline-primary">
                <i class="fas fa-arrow-left"></i> 返回首页
            </a>
        </div>
    </article>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>
                博客来源: <a href="https://spaces.ac.cn" target="_blank">科学空间</a> |
                内容经过整理并添加详细数学推导
            </p>
            <p>
                Powered by <a href="https://pages.github.com/" target="_blank">GitHub Pages</a>
            </p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Syntax highlighting -->
    <script>hljs.highlightAll();</script>
</body>
</html>
