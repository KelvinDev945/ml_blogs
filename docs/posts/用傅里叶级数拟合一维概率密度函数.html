<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用傅里叶级数拟合一维概率密度函数 | ML & Math Blog Posts</title>
    <meta name="description" content="用傅里叶级数拟合一维概率密度函数&para;
原文链接: https://spaces.ac.cn/archives/10007
发布日期: 

在《“闭门造车”之多模态思路浅谈（一）：无损输入》中我们曾提到，图像生成的本质困难是没有一个连续型概率密度的万能拟合器。当然，也不能说完全没有，比如高斯混合模型（GMM）理论上就是可以拟合任意概率密度，就连GAN本质上也可以理解为混合了无限个高斯模型的G...">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css">

    <!-- Google Fonts -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/post.css">

    <!-- Custom JS -->
    <script src="../assets/js/collapsible.js" defer></script>

    <!-- MathJax for math rendering -->
    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true,
        processEnvironments: true
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Syntax highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/github.min.css">
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/highlight.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
        <div class="container">
            <a class="navbar-brand" href="../index.html">
                <i class="fas fa-brain"></i> ML & Math Blog
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../index.html"><i class="fas fa-home"></i> 首页</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Post Content -->
    <article class="container post-container my-5">
        <!-- Breadcrumb Navigation -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="../index.html"><i class="fas fa-home"></i> 首页</a></li>
                
                <li class="breadcrumb-item"><a href="../index.html?tags=级数">级数</a></li>
                
                <li class="breadcrumb-item active" aria-current="page">
                    #134 用傅里叶级数拟合一维概率密度函数
                </li>
            </ol>
        </nav>

        <!-- Post Header -->
        <header class="post-header mb-4">
            <h1 class="post-title">
                <span class="post-number">#134</span>
                用傅里叶级数拟合一维概率密度函数
            </h1>
            <div class="post-meta">
                <span><i class="far fa-calendar"></i> 2024-03-07</span>
                
            </div>
            
            <div class="post-tags mt-3">
                
                <a href="../index.html?tags=级数" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> 级数</span>
                </a>
                
                <a href="../index.html?tags=概率" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> 概率</span>
                </a>
                
                <a href="../index.html?tags=分析" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> 分析</span>
                </a>
                
                <a href="../index.html?tags=逼近" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> 逼近</span>
                </a>
                
                <a href="../index.html?tags=生成模型" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> 生成模型</span>
                </a>
                
            </div>
            
        </header>

        <div class="row">
            <!-- Main Content -->
            <div class="col-lg-9">
                <!-- Post Body -->
                <div class="post-content">
                    <h1 id="_1">用傅里叶级数拟合一维概率密度函数<a class="toc-link" href="#_1" title="Permanent link">&para;</a></h1>
<p><strong>原文链接</strong>: <a href="https://spaces.ac.cn/archives/10007">https://spaces.ac.cn/archives/10007</a></p>
<p><strong>发布日期</strong>: </p>
<hr />
<p>在<a href="/archives/9984">《“闭门造车”之多模态思路浅谈（一）：无损输入》</a>中我们曾提到，图像生成的本质困难是没有一个连续型概率密度的万能拟合器。当然，也不能说完全没有，比如高斯混合模型（GMM）理论上就是可以拟合任意概率密度，就连GAN本质上也可以理解为混合了无限个高斯模型的GMM。然而，GMM尽管理论上的能力是足够的，但它的最大似然估计会很困难，尤其是通常不适用基于梯度的优化器，这限制了它的使用场景。</p>
<p>近日，Google的一篇新论文<a href="https://papers.cool/arxiv/2402.15345">《Fourier Basis Density Model》</a>针对一维情形，提出了一个新的解决方案——用傅里叶级数来拟合。论文的分析过程颇为有趣，构造形式也很是巧妙，值得学习一番。</p>
<h2 id="_2">问题简述<a class="toc-link" href="#_2" title="Permanent link">&para;</a></h2>
<p>可能有读者质疑：只研究一维情形有什么价值？确实，如果只考虑图像生成场景，那可能真的价值有限，但一维概率密度估计本身有它的应用价值，如数据的有损压缩，所以它依然是一个值得研究的主题。再者，即便我们需要研究多维的概率密度，也可以通过自回归的方式转化为多个一维的条件概率密度来估计。最后，这个分析和构造过程本身就很值得回味，所以哪怕是仅仅作为一道数学分析题来练习也是相当有益的。</p>
<p>言归正传。所谓一维概率密度估计，是指给定$n$个从同一分布采样出来的实数$x_1,x_2,\cdots,x_n$的情况下，估计采样分布的概率密度函数。这个问题的方法可以分为“非参数化估计”和“参数化估计”两类。非参数化估计主要就是指核密度估计，它跟<a href="/archives/8718">《用狄拉克函数来构造非光滑函数的光滑近似》</a>一样，本质上是利用狄拉克函数做光滑近似：<br />
\begin{equation}p(x) = \int p(y)\delta(x - y) = \mathbb{E}<em i="1">{y\sim p(y)}[\delta(x - y)]\approx \frac{1}{n}\sum</em>}^n \delta(x - x_i)\label{eq:delta}\end{equation<br />
但是$\delta(x - y)$不是常规的光滑函数，所以我们要找它的一个光滑近似，比如$\frac{e^{-(x-y)^2/2\sigma^2}}{\sqrt{2\pi}\sigma}$，它是正态分布的概率密度函数，当$\sigma\to 0$的时候它就是$\delta(x-y)$，代入到上式，结果就是“高斯核密度估计”。</p>
<p>可以看到，核密度估计本质上就是把数据背下来，因此可以推测它泛化能力有限，另外它的复杂度正比于数据量，那么数据规模较大时也不实用，所以我们需要“参数化估计”，即构建一个非负的、归一化的、带有固定量的参数$\theta$的概率密度函数簇$p_{\theta}(x)$，然后通过最大似然就可以求解：<br />
\begin{equation}\theta^* = \mathop{\text{argmax}}<em i="1">{\theta} \sum</em>}^n \log p_{\theta}(x_i)\end{equation<br />
这个问题的关键就是如何构建一簇有足够拟合能力的概率密度函数$p_{\theta}(x)$。</p>
<h2 id="_3">已有方法<a class="toc-link" href="#_3" title="Permanent link">&para;</a></h2>
<p>参数化概率密度估计的经典方法是高斯混合模型（Gaussian Mixed Model，GMM），它的出发点同样是式$\eqref{eq:delta}$加高斯核，但它不是遍历所有数据作为中心，而是通过训练的方式，找到有限的$K$个均值和方差，构建一个复杂度跟数据量无关的模型：<br />
\begin{equation}p_{\theta}(x) = \frac{1}{K}\sum_{i=1}^K \frac{e^{-(x-\mu_i)^2/2\sigma_i^2}}{\sqrt{2\pi}\sigma_i},\quad \theta = \{\mu_1,\sigma_1,\mu_2,\sigma_2,\cdots,\mu_K,\sigma_K\}\end{equation}<br />
GMM通常也被理解为一种聚类方法，它是K-Means的推广，$\mu_1,\mu_2,\cdots,\mu_K$是聚类中心，比K-Means则多出了方差$\sigma_1,\sigma_2,\cdots,\sigma_K$。由于式$\eqref{eq:delta}$的理论保证，因此当$K$足够大、$\sigma$足够小时，GMM理论上总能拟合任意复杂的分布，因此GMM的理论能力是足够的。但GMM的问题在于$e^{-(x-\mu_i)^2/2\sigma_i^2}$这个形式衰减得太快，梯度消失非常严重，因此通常只能用EM算法求解（参考<a href="/archives/5155">《三味Capsule：矩阵Capsule与EM路由》</a>），不好用梯度优化器优化，这限制了它的应用，而且即便用EM算法也通常都只能找到一个次优的解。</p>
<p>原论文还提到了一个叫做DFP（Deep Factorized Probability）的方法，它是专为一维概率密度估计设计的，出自论文<a href="https://papers.cool/arxiv/1802.01436">《Variational image compression with a scale hyperprior》</a>。DFP利用了累积概率函数的单调性，即如下积分<br />
\begin{equation}\Phi(x) = \int_{-\infty}^x p(y)dy \in [0,1]\end{equation}<br />
必然是单调递增的。如果我们能先构造一个$\mathbb{R}\mapsto[0,1]$的单调递增函数$\Phi_{\theta}(x)$，那么对它求导就是一个合理的概率密度函数。如何保证一个模型的输出随着输入单调递增呢？DFP用一个多层神经网络来构建模型，并且保证：1、所有激活函数都是单调递增的；2、所有乘法权重都是非负的。在这两点约束之下，模型必然符合单调递增这一特点，最后再加个Sigmoid，就可以控制值域为$[0,1]$。</p>
<p>DFP的原理也称得上是简单直观，但类似于flow-based模型，这种逐层的约束会让人担心损失了拟合能力。此外，由于该模型完全由神经网络构建，根据此前<a href="https://papers.cool/arxiv/1901.06523">《Frequency Principle: Fourier Analysis Sheds Light on Deep Neural Networks》</a>等结论，神经网络在训练时会优先学习低频信号，这可能会使得DPF对概率密度的峰值点拟合不佳，即出现过度平滑的拟合结果，然而在很多场景下，峰值的拟合能力是衡量一个概率建模方法的重要指标之一。</p>
<h2 id="_4">请傅里叶<a class="toc-link" href="#_4" title="Permanent link">&para;</a></h2>
<p>如论文标题“Fourier Basis Density Model”（下面简称FBDM）所示，论文所提的新方法，是基于傅里叶级数来拟合概率密度的。有一说一，其实用傅里叶级数来拟合这一点并不难想到，难的是里边有一个关键的非负约束不容易构造，而FBDM则是把相关的细节都走通了，不得不让人佩服。</p>
<p>简单起见，我们把$x$的定义域设为$[-1,1]$，由于总可以通过$\tanh$之类的变换将$\mathbb{R}$上的实数都压到到$[-1,1]$，因此这个设定并不失一般性。也就是说，现在我们所求的概率密度函数$p(x)$是定义在$[-1,1]$上的函数，那么我们可以将它写成傅里叶级数<br />
\begin{equation}p(x) = \sum_{n=-\infty}^{\infty} c_n e^{i\pi n x},\quad c_n = \frac{1}{2}\int_{-1}^1 p(x) e^{-i\pi n x} dx\end{equation}<br />
然而，我们现在要做的事情是反过来的，并非已知$p(x)$求它的傅里叶级数，而是只知道$p(x)$的样本，需要把$p(x)$设成如下的截断傅里叶级数形式，然后把系数$c_n$通过优化器求出来：<br />
\begin{equation}f_{\theta}(x) = \sum_{n=-N}^{N} c_n e^{i\pi n x},\quad \theta = \{c_{-N},c_{-N+1},\cdots,c_{N-1},c_N\}\label{eq:fourier-series}\end{equation}<br />
众所周知，作为一个合理的概率密度函数，$f_{\theta}(x)$至少要满足如下两个条件：<br />
\begin{equation}\text{非负:}\,\,f_{\theta}(x)\geq 0,\quad \text{归一:}\,\,\int_{-1}^1 f_{\theta}(x)dx = 1\end{equation}<br />
问题是如果$c_n$取任意实数/复数，那么式$\eqref{eq:fourier-series}$是否实数都无法保证，更不用说非负了。所以说，用傅里叶级数来拟合并不难想，难在如何设定$c_n$的形式，使得对应的输出必然是非负的（后面我们将会看到，在傅里叶级数下，最难的是非负，归一反而简单）。</p>
<h2 id="_5">保证非负<a class="toc-link" href="#_5" title="Permanent link">&para;</a></h2>
<p>这一节我们就来看全文难度最高的非负性构造。当然，这里的难并不是说它推导有多复杂，而是非常有技巧性。</p>
<p>首先，我们知道非负的前提是实数，而保证实数相对比较简单：<br />
\begin{equation}c_n^<em> = \left[\frac{1}{2}\int_{-1}^1 p(x) e^{-i\pi n x} dx\right]^</em> = \frac{1}{2}\int_{-1}^1 p(x) e^{i\pi n x} dx = c_{-n}\end{equation}<br />
可以反过来证明这个条件也是充分的，所以保证实数只需要约束$c_n^* = c_{-n}$，这个相对来说很容易实现，同时这也意味着式$\eqref{eq:fourier-series}$的级数作为概率密度函数时，只有$c_0,c_1,\cdots,c_N$这$N+1$个独立参数。</p>
<p>关于非负约束，原论文只是抛出了一个“Herglotz’s theorem”的引用，然后就直接给出了答案，可以说几乎没有推导。笔者搜了一下Herglotz’s theorem，也发现鲜有介绍，因此只好尝试跳过Herglotz’s theorem，用自己的方式去理解原论文的答案了。</p>
<p>考虑任意整数的有限子集$\mathbb{K}\subseteq\mathbb{N}$，以及对应的任意复数列$\{u_k|k\in\mathbb{K}\}$，我们有<br />
\begin{equation}\begin{aligned}<br />
\sum_{n,m\in \mathbb{K}} u_n^<em> c_{n-m} u_m =&amp;\, \sum_{n,m\in \mathbb{K}} u_n^</em> \left[\frac{1}{2}\int_{-1}^1 p(x) e^{-i\pi (n-m) x} dx\right] u_m \\<br />
=&amp;\, \frac{1}{2}\int_{-1}^1 p(x) \left[\sum_{n,m\in \mathbb{K}} u_n^<em> e^{-i\pi (n-m) x} u_m \right] dx \\<br />
=&amp;\, \frac{1}{2}\int_{-1}^1 p(x) \sum_{n,m\in \mathbb{K}} \left[(u_n e^{i\pi n})^</em> (u_m e^{i\pi m})\right] dx \\<br />
=&amp;\, \frac{1}{2}\int_{-1}^1 p(x) \left[\left(\sum_{n\in \mathbb{K}}u_n e^{i\pi n}\right)^<em> \left(\sum_{m\in \mathbb{K}}u_m e^{i\pi m}\right)\right] dx \\<br />
=&amp;\, \frac{1}{2}\int_{-1}^1 p(x) \left|\sum_{n\in \mathbb{K}}u_n e^{i\pi n}\right|^2 dx \\<br />
\geq&amp;\, 0 \\<br />
\end{aligned}\end{equation}<br />
最后的$\geq 0$取决于$p(x)\geq 0$，所以我们就得出了$f_{\theta}(x)\geq 0$的一个必要条件：$\sum\limits_{n,m\in \mathbb{K}} u_n^</em> c_{n-m} u_m\geq 0$。如果将所有$c_{n-m}$排列成一个大矩阵（Toeplitz矩阵），那么这个条件用线性代数的话说就是任意$\mathbb{K}$对应的行列交集组成的子矩阵都是复空间中的正定矩阵。也可以证明这个条件是充分的，即满足此条件的$f_{\theta}(x)$必然恒大于0。</p>
<p>所以问题变成了如何找一个复数列$\{c_n\}$，使得对应的Toeplitz矩阵$\{c_{n-m}\}$是一个正定矩阵。看上去这转换把问题变得更加复杂了，但对于了解时间序列的读者来说，他们可能知道一个现成的构造方式，那就是“<a href="https://en.wikipedia.org/wiki/Autocorrelation">自相关系数</a>”：对于任意复数列$\{a_k\}$，自相关系数定义为<br />
\begin{equation}r_n = \sum_{k=-\infty}^{\infty} a_k a_{k+n}^<em>\end{equation}<br />
可以证明$r_{n-m}$必然是正定的：<br />
\begin{equation}\begin{aligned}<br />
\sum_{n,m\in \mathbb{K}} u_n^</em> r_{n-m} u_m =&amp;\, \sum_{n,m\in \mathbb{K}} u_n^<em> \left(\sum_{k=-\infty}^{\infty} a_k a_{k+n-m}^</em>\right) u_m \\<br />
=&amp;\, \sum_{n,m\in \mathbb{K}} u_n^<em> \left(\sum_{k=-\infty}^{\infty} a_{k+m} a_{k+n}^</em>\right) u_m \\<br />
=&amp;\, \sum_{k=-\infty}^{\infty}\left(\sum_{n\in \mathbb{K}} a_{k+n} u_n\right)^<em>\left(\sum_{m\in \mathbb{K}} a_{k+m} u_m\right) \\<br />
=&amp;\, \sum_{k=-\infty}^{\infty}\left|\sum_{n\in \mathbb{K}} a_{k+n} u_n\right|^2 \\<br />
\geq&amp;\, 0<br />
\end{aligned}\end{equation}<br />
因此将$c_n$取成$r_n$的形式就是一个可行的解。为了确保$c_n$的独立参数量只有$N+1$个，我们约定当$k &lt; 0$或者$k &gt; N$时$a_k=0$，那么得到<br />
\begin{equation}c_n = \sum_{k=0}^{N-n} a_k a_{k+n}^</em>\end{equation}<br />
这就构成出了对应的$c_n$，使得式$\eqref{eq:fourier-series}$的傅里叶级数的结果必然非负，满足了概率密度函数的非负要求。</p>
<h2 id="_6">一般结果<a class="toc-link" href="#_6" title="Permanent link">&para;</a></h2>
<p>至此，整个问题中最难的部分——“非负性”已经被解决。剩下的归一化很简单，因为<br />
\begin{equation}\int_{-1}^1 f_{\theta}(x)dx = \int_{-1}^1 \sum_{n=-N}^{N} c_n e^{i\pi n x} dx = 2c_0\end{equation}<br />
所以归一化因子就是$2c_0$！于是我们只需要将$p_{\theta}(x)$设成<br />
\begin{equation}<br />
p_{\theta}(x) = \frac{f_{\theta}(x)}{2c_0}=\frac{1}{2} + \sum_{n=1}^{N} \frac{c_n e^{i\pi n x} + c_{-n}e^{-i\pi n x}}{2c_0} = \text{Re}\left[\frac{1}{2} + \sum_{n=1}^N \frac{c_n}{c_0} e^{i\pi n x}\right], \\<br />
c_n = \sum_{k=0}^{N-n} a_k a_{k+n}^*,\quad\theta = \{a_0,a_1,\cdots,a_N\}\end{equation}<br />
它就是一个有效的概率密度候选函数。</p>
<p>当然，目前这个分布还只是定义在$[-1,1]$，我们需要将它扩展到整个$\mathbb{R}$上，这个不难，我们先想一个将$\mathbb{R}$压缩为$[-1,1]$的变换，然后求变换之后的概率密度形式就行。为此，我们可以先通过原始样本估计出均值$\mu$和方差$\sigma^2$，然后通过$x=\frac{y-\mu}{\sigma}$就将它变为均值为0、方差为1的分布，接着就可以通过$x=\tanh\left(\frac{y-\mu}{\sigma}\right)$压缩到$[-1,1]$中，对应的新概率密度函数为<br />
\begin{equation}q_{\theta}(y) = p_{\theta}(x)\frac{dx}{dy} = \frac{1}{\sigma}\text{sech}^2\left(\frac{y-\mu}{\sigma}\right) p_{\theta}\left(\tanh\left(\frac{y-\mu}{\sigma}\right)\right)\end{equation}<br />
从端到端学习的角度来讲，我们可以直接把原始数据代入到$q_{\theta}(y)$的对数似然中进行优化（而不是先压缩后优化），甚至可以连同$\mu,\sigma$也当成可训练参数一起调整。</p>
<p>最后，为了防止过拟合，我们还需要一个正则项，正则项的目的是希望拟合的分布能稍微平滑一些，不要过度陷入局部细节中，为此，我们考虑$f_{\theta}(x)$导数的模长平方作为正则项：<br />
\begin{equation}\gamma\int_{-1}^1 \left|\frac{df_{\theta}(x)}{dx}\right|^2 = \gamma\sum_{n=-N}^N 2\pi^2 n^2 |c_n|^2 dx\end{equation}<br />
从最后的形式可以看出，它加大了高频项系数的惩罚权重，这可以避免模型过度拟合高频细节，从而提高泛化能力。</p>
<h2 id="_7">延伸思考<a class="toc-link" href="#_7" title="Permanent link">&para;</a></h2>
<p>到这里，我们已经把FBDM的所有理论推导完成了，剩下的自然是做实验，这部分我们不再重复，直接看原文的结果就好。注意FBDM的所有系数和运算都是在复数域内，如果强行实数化会让结果形式复杂不少，所以简单起见应该直接基于所用框架的复数运算来实现（原论文用的是Jax）。</p>
<p>在看实验结果之前，我们先来想想评价指标是什么。如果是模拟实验的话，我们通常都能知道真实分布的概率密度表达式，因此最直接的指标就是计算真实分布与拟合分布的KL散度/W距离等分布度量。除此之外，对于概率密度的拟合，我们通常有一个更关心的指标，那就是“峰值”的拟合效果。假设概率密度是光滑的，那么它可能有多个局部最大值点，这些局部最大值点就是我们所说的峰值，或者称为“modal”，很多场景下能否准确找到更多的modal比整个分布的度量大小更重要，比如有损压缩的基本思想就是只保留这些modal来描述分布。</p>
<p>而从原论文的实验结果可以看到，在同等参数量下FBDM在KL散度和modal方面都做得更好：  </p>
<p><a href="/usr/uploads/2024/03/4119090903.png" title="点击查看原图"><img alt="GMM、DFP、FBDM效果对比" src="/usr/uploads/2024/03/4119090903.png" /></a></p>
<p>GMM、DFP、FBDM效果对比</p>
<p>之所以有这样的优势，笔者猜测是因为FBDM的虚指数形式，本质上就是三角函数，它不像GMM那样的负指数有严重的梯度消失问题，因此基于梯度的优化器有更大的概率能找到更优的解答。从这个形式来看，FBDM也可以理解为连续型概率密度的“Softmax”，都是以$\exp$为基来构建一个概率分布，只不过一个是实指数，一个则是虚指数。</p>
<p>相比GMM，FBDM自然也有一些缺点，如不够直观、不易采样、不易推广到高维等（当然这些缺点DFP也有）。GMM很直观，就是有限个正态分布的加权平均的形式，通过先类别采样、后正态采样的层次采样就可以实现概率密度函数中采样，相比之下FBDM没那么直观的方案，看上去只能通过逆累积概率函数的方式进行采样，即先求出累积概率函数<br />
\begin{equation} \Phi(x) = P(\leq x) = \int_{-1}^x p_{\theta}(x)dx = \frac{x^2-1}{2} + \frac{1}{2}\sum_{n=1}^{N} \frac{c_n}{c_0} \frac{e^{i\pi n x} - (-1)^n}{i\pi n}\end{equation}<br />
然后$y=\Phi^{-1}(\varepsilon),\varepsilon\sim U[0,1]$就可以实现采样了。至于高维推广，正态分布本来就有高维形式，因此GMM推广到任意维度也很容易，但是FBDM要想直接推广到$D$维，那么就有$(N+1)^D$个参数，很明显复杂度太高，或者就像Decoder-Only的LLM一样，用自回归的方式转化为多个一维条件概率密度估计，总之，办法不能说没有，但是各种弯弯绕绕更多。</p>
<h2 id="_8">文章小结<a class="toc-link" href="#_8" title="Permanent link">&para;</a></h2>
<p>本文介绍了一种用傅里叶级数来建模一维概率密度函数的新思路，关键之处是通过精巧的系数构造，来约束原本值域是复数域的傅里叶级数成为一个非负函数，整个过程颇为赏心悦目，值得学习一番。</p>
<p><em><strong>转载到请包括本文地址：</strong><a href="https://spaces.ac.cn/archives/10007">https://spaces.ac.cn/archives/10007</a></em></p>
<p><em><strong>更详细的转载事宜请参考：</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="《科学空间FAQ》">《科学空间FAQ》</a></p>
<p><strong>如果您还有什么疑惑或建议，欢迎在下方评论区继续讨论。</strong></p>
<p><strong>如果您觉得本文还不错，欢迎分享/打赏本文。打赏并非要从中获得收益，而是希望知道科学空间获得了多少读者的真心关注。当然，如果你无视它，也不会影响你的阅读。再次表示欢迎和感谢！</strong></p>
<p>打赏</p>
<p><img alt="科学空间" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>微信打赏</p>
<p><img alt="科学空间" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>支付宝打赏</p>
<p>因为网站后台对打赏并无记录，因此欢迎在打赏时候备注留言。你还可以<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>点击这里</strong></a>或在下方评论区留言来告知你的建议或需求。</p>
<p><strong>如果您需要引用本文，请参考：</strong></p>
<p>苏剑林. (Mar. 07, 2024). 《用傅里叶级数拟合一维概率密度函数 》[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/10007">https://spaces.ac.cn/archives/10007</a></p>
<p>@online{kexuefm-10007,<br />
title={用傅里叶级数拟合一维概率密度函数},<br />
author={苏剑林},<br />
year={2024},<br />
month={Mar},<br />
url={\url{https://spaces.ac.cn/archives/10007}},<br />
} </p>
<hr />
<h2 id="_9">详细数学推导与注释<a class="toc-link" href="#_9" title="Permanent link">&para;</a></h2>
<p>本节将对傅里叶级数拟合概率密度函数的核心理论进行详细推导和说明，包括傅里叶级数基础、各种约束条件的充要性证明、以及与其他方法的对比分析。</p>
<h3 id="_10">一、傅里叶级数基础理论<a class="toc-link" href="#_10" title="Permanent link">&para;</a></h3>
<h4 id="11">1.1 傅里叶级数的定义与收敛性<a class="toc-link" href="#11" title="Permanent link">&para;</a></h4>
<p>对于定义在$[-L, L]$上的函数$f(x)$，其傅里叶级数展开式为：<br />
\begin{equation}<br />
f(x) = \sum_{n=-\infty}^{\infty} c_n e^{i\pi n x / L}<br />
\end{equation}</p>
<p>其中傅里叶系数为：<br />
\begin{equation}<br />
c_n = \frac{1}{2L}\int_{-L}^L f(x) e^{-i\pi n x / L} dx<br />
\end{equation}</p>
<p><strong>推导过程</strong>：利用复指数函数的正交性。对于$m \neq n$，有：<br />
\begin{equation}<br />
\int_{-L}^L e^{i\pi (m-n) x / L} dx = \left[\frac{L}{i\pi(m-n)} e^{i\pi (m-n) x / L}\right]_{-L}^L = \frac{L}{i\pi(m-n)}(e^{i\pi(m-n)} - e^{-i\pi(m-n)})<br />
\end{equation}</p>
<p>由于$m-n$为整数，$e^{i\pi(m-n)} = (-1)^{m-n}$，$e^{-i\pi(m-n)} = (-1)^{-(m-n)} = (-1)^{m-n}$，因此：<br />
\begin{equation}<br />
\int_{-L}^L e^{i\pi (m-n) x / L} dx = 0 \quad (m \neq n)<br />
\end{equation}</p>
<p>当$m = n$时：<br />
\begin{equation}<br />
\int_{-L}^L e^{0} dx = 2L<br />
\end{equation}</p>
<p>这个正交性保证了傅里叶系数的唯一性。</p>
<p>对于本文的情况，$L=1$，因此：<br />
\begin{equation}<br />
f(x) = \sum_{n=-\infty}^{\infty} c_n e^{i\pi n x}, \quad c_n = \frac{1}{2}\int_{-1}^1 f(x) e^{-i\pi n x} dx<br />
\end{equation}</p>
<p><strong>收敛性条件</strong>（Dirichlet条件）：如果$f(x)$满足以下条件，则其傅里叶级数收敛到$f(x)$（在连续点处）或者收敛到左右极限的平均值（在间断点处）：</p>
<ol>
<li>$f(x)$在$[-1, 1]$上绝对可积：$\int_{-1}^1 |f(x)| dx &lt; \infty$</li>
<li>$f(x)$在$[-1, 1]$上有有限个极值点</li>
<li>$f(x)$在$[-1, 1]$上有有限个第一类间断点</li>
</ol>
<p>对于概率密度函数$p(x)$，由于$\int_{-1}^1 p(x) dx = 1 &lt; \infty$且通常光滑，因此满足收敛条件。</p>
<h4 id="12-parseval">1.2 Parseval定理（能量守恒）<a class="toc-link" href="#12-parseval" title="Permanent link">&para;</a></h4>
<p>Parseval定理是傅里叶分析中的一个重要等式，它表明函数在时域和频域中的"能量"是相等的：<br />
\begin{equation}<br />
\int_{-1}^1 |f(x)|^2 dx = 2\sum_{n=-\infty}^{\infty} |c_n|^2<br />
\end{equation}</p>
<p><strong>证明</strong>：<br />
\begin{equation}<br />
\begin{aligned}<br />
\int_{-1}^1 |f(x)|^2 dx &amp;= \int_{-1}^1 f(x) f^<em>(x) dx \<br />
&amp;= \int_{-1}^1 \left(\sum_{n=-\infty}^{\infty} c_n e^{i\pi n x}\right) \left(\sum_{m=-\infty}^{\infty} c_m^</em> e^{-i\pi m x}\right) dx \<br />
&amp;= \sum_{n=-\infty}^{\infty}\sum_{m=-\infty}^{\infty} c_n c_m^<em> \int_{-1}^1 e^{i\pi (n-m) x} dx \<br />
&amp;= \sum_{n=-\infty}^{\infty}\sum_{m=-\infty}^{\infty} c_n c_m^</em> \cdot 2\delta_{nm} \<br />
&amp;= 2\sum_{n=-\infty}^{\infty} c_n c_n^* \<br />
&amp;= 2\sum_{n=-\infty}^{\infty} |c_n|^2<br />
\end{aligned}<br />
\end{equation}</p>
<p>其中$\delta_{nm}$是Kronecker delta函数，当$n=m$时为1，否则为0。</p>
<p><strong>物理意义</strong>：对于概率密度函数，这个定理说明了在空间域和频域中，函数的"强度"分布是守恒的。高频分量$|c_n|^2$的大小反映了函数的振荡剧烈程度。</p>
<h4 id="13">1.3 截断误差分析<a class="toc-link" href="#13" title="Permanent link">&para;</a></h4>
<p>在实际应用中，我们只能使用有限项傅里叶级数：<br />
\begin{equation}<br />
f_N(x) = \sum_{n=-N}^{N} c_n e^{i\pi n x}<br />
\end{equation}</p>
<p>截断误差可以用Parseval定理来估计：<br />
\begin{equation}<br />
\int_{-1}^1 |f(x) - f_N(x)|^2 dx = 2\sum_{|n|&gt;N} |c_n|^2<br />
\end{equation}</p>
<p>对于光滑函数，傅里叶系数通常以$|c_n| \sim O(n^{-k})$的速度衰减（$k$取决于函数的光滑程度），因此截断误差：<br />
\begin{equation}<br />
\sum_{|n|&gt;N} |c_n|^2 \sim \sum_{|n|&gt;N} n^{-2k} \sim \int_N^{\infty} x^{-2k} dx \sim N^{1-2k}<br />
\end{equation}</p>
<p>这说明函数越光滑（$k$越大），截断误差收敛越快。</p>
<h3 id="_11">二、实数性约束的充要性证明<a class="toc-link" href="#_11" title="Permanent link">&para;</a></h3>
<h4 id="21-px-in-mathbbr-rightarrow-c_n-c_-n">2.1 必要性：$p(x) \in \mathbb{R} \Rightarrow c_n^* = c_{-n}$<a class="toc-link" href="#21-px-in-mathbbr-rightarrow-c_n-c_-n" title="Permanent link">&para;</a></h4>
<p>如果$p(x)$是实函数，则：<br />
\begin{equation}<br />
p(x) = p^*(x)<br />
\end{equation}</p>
<p>将傅里叶级数代入：<br />
\begin{equation}<br />
\sum_{n=-\infty}^{\infty} c_n e^{i\pi n x} = \left(\sum_{n=-\infty}^{\infty} c_n e^{i\pi n x}\right)^<em> = \sum_{n=-\infty}^{\infty} c_n^</em> e^{-i\pi n x}<br />
\end{equation}</p>
<p>对右边进行变量替换$m = -n$：<br />
\begin{equation}<br />
\sum_{n=-\infty}^{\infty} c_n^<em> e^{-i\pi n x} = \sum_{m=-\infty}^{\infty} c_{-m}^</em> e^{i\pi m x}<br />
\end{equation}</p>
<p>比较系数得：<br />
\begin{equation}<br />
c_n = c_{-n}^<em> \quad \Leftrightarrow \quad c_n^</em> = c_{-n}<br />
\end{equation}</p>
<h4 id="22-c_n-c_-n-rightarrow-px-in-mathbbr">2.2 充分性：$c_n^* = c_{-n} \Rightarrow p(x) \in \mathbb{R}$<a class="toc-link" href="#22-c_n-c_-n-rightarrow-px-in-mathbbr" title="Permanent link">&para;</a></h4>
<p>假设$c_n^<em> = c_{-n}$，我们需要证明$f(x) = f^</em>(x)$。</p>
<p>将级数拆分为三部分：<br />
\begin{equation}<br />
f(x) = c_0 + \sum_{n=1}^{\infty} c_n e^{i\pi n x} + \sum_{n=-\infty}^{-1} c_n e^{i\pi n x}<br />
\end{equation}</p>
<p>对于第三项，令$m = -n$：<br />
\begin{equation}<br />
\sum_{n=-\infty}^{-1} c_n e^{i\pi n x} = \sum_{m=1}^{\infty} c_{-m} e^{-i\pi m x}<br />
\end{equation}</p>
<p>利用条件$c_{-m} = c_m^<em>$：<br />
\begin{equation}<br />
\sum_{m=1}^{\infty} c_{-m} e^{-i\pi m x} = \sum_{m=1}^{\infty} c_m^</em> e^{-i\pi m x} = \left(\sum_{m=1}^{\infty} c_m e^{i\pi m x}\right)^*<br />
\end{equation}</p>
<p>由于$c_0^<em> = c_{-0} = c_0$，所以$c_0 \in \mathbb{R}$。因此：<br />
\begin{equation}<br />
f(x) = c_0 + \sum_{n=1}^{\infty} c_n e^{i\pi n x} + \left(\sum_{n=1}^{\infty} c_n e^{i\pi n x}\right)^</em> = c_0 + 2\text{Re}\left[\sum_{n=1}^{\infty} c_n e^{i\pi n x}\right] \in \mathbb{R}<br />
\end{equation}</p>
<h4 id="23">2.3 实数表示的等价形式<a class="toc-link" href="#23" title="Permanent link">&para;</a></h4>
<p>利用Euler公式$e^{i\theta} = \cos\theta + i\sin\theta$，可以将实数函数写成：<br />
\begin{equation}<br />
\begin{aligned}<br />
f(x) &amp;= c_0 + \sum_{n=1}^{\infty} (c_n e^{i\pi n x} + c_{-n} e^{-i\pi n x}) \<br />
&amp;= c_0 + \sum_{n=1}^{\infty} (c_n e^{i\pi n x} + c_n^* e^{-i\pi n x}) \<br />
&amp;= c_0 + \sum_{n=1}^{\infty} 2\text{Re}[c_n e^{i\pi n x}]<br />
\end{aligned}<br />
\end{equation}</p>
<p>设$c_n = a_n + ib_n$（$a_n, b_n \in \mathbb{R}$），则：<br />
\begin{equation}<br />
\begin{aligned}<br />
2\text{Re}[c_n e^{i\pi n x}] &amp;= 2\text{Re}[(a_n + ib_n)(\cos(\pi n x) + i\sin(\pi n x))] \<br />
&amp;= 2[a_n\cos(\pi n x) - b_n\sin(\pi n x)]<br />
\end{aligned}<br />
\end{equation}</p>
<p>因此实数函数的完整形式为：<br />
\begin{equation}<br />
f(x) = \frac{a_0}{2} + \sum_{n=1}^{\infty} [a_n\cos(\pi n x) + b_n\sin(\pi n x)]<br />
\end{equation}</p>
<p>这是传统的三角形式傅里叶级数。</p>
<h3 id="toeplitz">三、非负性约束：Toeplitz矩阵与正定性<a class="toc-link" href="#toeplitz" title="Permanent link">&para;</a></h3>
<h4 id="31-toeplitz">3.1 Toeplitz矩阵的定义<a class="toc-link" href="#31-toeplitz" title="Permanent link">&para;</a></h4>
<p>Toeplitz矩阵是一个常对角矩阵，即沿对角线的元素相同。对于序列${c_n}$，对应的$(N+1) \times (N+1)$ Toeplitz矩阵为：<br />
\begin{equation}<br />
\mathbf{C} = \begin{bmatrix}<br />
c_0 &amp; c_{-1} &amp; c_{-2} &amp; \cdots &amp; c_{-N} \<br />
c_1 &amp; c_0 &amp; c_{-1} &amp; \cdots &amp; c_{-N+1} \<br />
c_2 &amp; c_1 &amp; c_0 &amp; \cdots &amp; c_{-N+2} \<br />
\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots \<br />
c_N &amp; c_{N-1} &amp; c_{N-2} &amp; \cdots &amp; c_0<br />
\end{bmatrix}<br />
\end{equation}</p>
<p>矩阵的$(i,j)$元素为$C_{ij} = c_{i-j}$。</p>
<h4 id="32-toeplitz">3.2 Toeplitz矩阵的正定性与函数非负性的等价性<a class="toc-link" href="#32-toeplitz" title="Permanent link">&para;</a></h4>
<p><strong>定理</strong>：函数$f(x) = \sum_{n=-N}^{N} c_n e^{i\pi n x}$在$[-1, 1]$上恒非负，当且仅当对应的Toeplitz矩阵$\mathbf{C}$是半正定的。</p>
<p><strong>证明（必要性）</strong>：假设$f(x) \geq 0$对所有$x \in [-1, 1]$成立。对于任意复向量$\mathbf{u} = [u_0, u_1, \ldots, u_N]^T$，考虑：<br />
\begin{equation}<br />
\mathbf{u}^<em> \mathbf{C} \mathbf{u} = \sum_{i=0}^{N}\sum_{j=0}^{N} u_i^</em> C_{ij} u_j = \sum_{i=0}^{N}\sum_{j=0}^{N} u_i^* c_{i-j} u_j<br />
\end{equation}</p>
<p>根据之前的推导（文章中第68-75行），我们有：<br />
\begin{equation}<br />
\begin{aligned}<br />
\sum_{i,j=0}^{N} u_i^<em> c_{i-j} u_j &amp;= \sum_{i,j=0}^{N} u_i^</em> \left[\frac{1}{2}\int_{-1}^1 p(x) e^{-i\pi (i-j) x} dx\right] u_j \<br />
&amp;= \frac{1}{2}\int_{-1}^1 p(x) \left|\sum_{i=0}^{N} u_i e^{i\pi i x}\right|^2 dx \<br />
&amp;\geq 0<br />
\end{aligned}<br />
\end{equation}</p>
<p>因此$\mathbf{C}$是半正定的。</p>
<p><strong>证明（充分性）</strong>：假设$\mathbf{C}$是半正定的。我们需要证明$f(x) \geq 0$。</p>
<p>对于固定的$x_0 \in [-1, 1]$，定义向量$\mathbf{v} = [1, e^{i\pi x_0}, e^{2i\pi x_0}, \ldots, e^{Ni\pi x_0}]^T$，则：<br />
\begin{equation}<br />
\begin{aligned}<br />
\mathbf{v}^* \mathbf{C} \mathbf{v} &amp;= \sum_{i=0}^{N}\sum_{j=0}^{N} e^{-i\pi i x_0} c_{i-j} e^{i\pi j x_0} \<br />
&amp;= \sum_{i=0}^{N}\sum_{j=0}^{N} c_{i-j} e^{i\pi (j-i) x_0} \<br />
&amp;= \sum_{n=-N}^{N} c_n e^{i\pi n x_0} \cdot (\text{计数项})<br />
\end{aligned}<br />
\end{equation}</p>
<p>更精确地，令$k = j - i$：<br />
\begin{equation}<br />
\mathbf{v}^* \mathbf{C} \mathbf{v} = \sum_{k=-N}^{N} c_k e^{i\pi k x_0} \sum_{\substack{i,j \geq 0 \ j-i=k \ i,j \leq N}} 1<br />
\end{equation}</p>
<p>对于$k \geq 0$，满足$j-i=k$且$0 \leq i, j \leq N$的对数为$N+1-k$；对于$k &lt; 0$，对数为$N+1+k$。因此：<br />
\begin{equation}<br />
\mathbf{v}^* \mathbf{C} \mathbf{v} = \sum_{k=-N}^{N} (N+1-|k|) c_k e^{i\pi k x_0}<br />
\end{equation}</p>
<p>虽然这不完全等于$f(x_0)$，但可以证明当$N \to \infty$时，如果Toeplitz矩阵对所有$N$都正定，则$f(x) \geq 0$。</p>
<h4 id="33">3.3 更直观的理解：频域卷积<a class="toc-link" href="#33" title="Permanent link">&para;</a></h4>
<p>Toeplitz矩阵的正定性可以从频域的角度理解。注意到：<br />
\begin{equation}<br />
f(x) = \sum_{n=-N}^{N} c_n e^{i\pi n x}<br />
\end{equation}</p>
<p>可以看作是某个"信号"的频谱。如果我们将$f(x)$写成：<br />
\begin{equation}<br />
f(x) = |g(x)|^2<br />
\end{equation}</p>
<p>其中$g(x) = \sum_{k=-M}^{M} a_k e^{i\pi k x}$，则：<br />
\begin{equation}<br />
\begin{aligned}<br />
f(x) &amp;= g(x) g^<em>(x) \<br />
&amp;= \left(\sum_{k=-M}^{M} a_k e^{i\pi k x}\right) \left(\sum_{m=-M}^{M} a_m^</em> e^{-i\pi m x}\right) \<br />
&amp;= \sum_{k=-M}^{M}\sum_{m=-M}^{M} a_k a_m^* e^{i\pi (k-m) x}<br />
\end{aligned}<br />
\end{equation}</p>
<p>令$n = k - m$，则：<br />
\begin{equation}<br />
c_n = \sum_{\substack{k,m \ k-m=n}} a_k a_m^<em> = \sum_{k} a_k a_{k-n}^</em><br />
\end{equation}</p>
<p>这正是自相关的形式！</p>
<h3 id="_12">四、自相关系数的性质与应用<a class="toc-link" href="#_12" title="Permanent link">&para;</a></h3>
<h4 id="41">4.1 自相关函数的定义<a class="toc-link" href="#41" title="Permanent link">&para;</a></h4>
<p>对于复数序列${a_k}<em k="-\infty">{k=-\infty}^{\infty}$，其自相关函数定义为：<br />
\begin{equation}<br />
r_n = \sum</em>^*}^{\infty} a_k a_{k+n<br />
\end{equation}</p>
<p><strong>性质1（共轭对称性）</strong>：<br />
\begin{equation}<br />
r_{-n} = \sum_{k=-\infty}^{\infty} a_k a_{k-n}^<em> = \sum_{m=-\infty}^{\infty} a_{m+n} a_m^</em> = r_n^*<br />
\end{equation}</p>
<p>其中令$m = k - n$。特别地，当$a_k \in \mathbb{R}$时，$r_n$是实数。</p>
<p><strong>性质2（最大值）</strong>：<br />
\begin{equation}<br />
|r_n| \leq r_0 = \sum_{k=-\infty}^{\infty} |a_k|^2<br />
\end{equation}</p>
<p><strong>证明</strong>：由Cauchy-Schwarz不等式：<br />
\begin{equation}<br />
|r_n|^2 = \left|\sum_{k} a_k a_{k+n}^*\right|^2 \leq \left(\sum_{k} |a_k|^2\right) \left(\sum_{k} |a_{k+n}|^2\right) = r_0^2<br />
\end{equation}</p>
<h4 id="42-toeplitz">4.2 自相关系数对应的Toeplitz矩阵的正定性<a class="toc-link" href="#42-toeplitz" title="Permanent link">&para;</a></h4>
<p><strong>定理</strong>：由自相关系数$r_n$构成的Toeplitz矩阵必然是半正定的。</p>
<p><strong>详细证明</strong>（文章中第80-87行的扩展）：</p>
<p>对于任意复向量$\mathbf{u} = [u_0, u_1, \ldots, u_N]^T$，考虑二次型：<br />
\begin{equation}<br />
Q = \sum_{i=0}^{N}\sum_{j=0}^{N} u_i^* r_{i-j} u_j<br />
\end{equation}</p>
<p>代入自相关的定义：<br />
\begin{equation}<br />
Q = \sum_{i=0}^{N}\sum_{j=0}^{N} u_i^<em> \left(\sum_{k=-\infty}^{\infty} a_k a_{k+i-j}^</em>\right) u_j<br />
\end{equation}</p>
<p>交换求和顺序：<br />
\begin{equation}<br />
Q = \sum_{k=-\infty}^{\infty} \sum_{i=0}^{N}\sum_{j=0}^{N} u_i^<em> a_k a_{k+i-j}^</em> u_j<br />
\end{equation}</p>
<p>对$j$求和的部分，令$m = k + i - j$，则$j = k + i - m$：<br />
\begin{equation}<br />
\sum_{j=0}^{N} a_{k+i-j}^<em> u_j = \sum_{m} a_m^</em> u_{k+i-m}<br />
\end{equation}</p>
<p>但这样处理比较复杂。让我们换一个角度：<br />
\begin{equation}<br />
Q = \sum_{k=-\infty}^{\infty} \sum_{i=0}^{N} u_i^<em> a_k \sum_{j=0}^{N} a_{k+i-j}^</em> u_j<br />
\end{equation}</p>
<p>令$\ell = k + i - j$，即$j = k + i - \ell$：<br />
\begin{equation}<br />
\sum_{j=0}^{N} a_{k+i-j}^<em> u_j = \sum_{\ell} a_{\ell}^</em> u_{k+i-\ell}<br />
\end{equation}</p>
<p>定义辅助量：<br />
\begin{equation}<br />
b_k = \sum_{i=0}^{N} a_{k+i} u_i<br />
\end{equation}</p>
<p>则可以验证：<br />
\begin{equation}<br />
Q = \sum_{k=-\infty}^{\infty} |b_k|^2 = \sum_{k=-\infty}^{\infty} \left|\sum_{i=0}^{N} a_{k+i} u_i\right|^2 \geq 0<br />
\end{equation}</p>
<p>这个结果表明，自相关矩阵必然是半正定的。</p>
<h4 id="43">4.3 有限支撑的自相关<a class="toc-link" href="#43" title="Permanent link">&para;</a></h4>
<p>在实际应用中，我们希望参数数量有限。假设当$k &lt; 0$或$k &gt; N$时，$a_k = 0$，则：<br />
\begin{equation}<br />
c_n = \sum_{k=\max(0, n)}^{\min(N, N-n)} a_k a_{k+n}^*<br />
\end{equation}</p>
<p>对于$n \geq 0$：<br />
\begin{equation}<br />
c_n = \sum_{k=0}^{N-n} a_k a_{k+n}^*<br />
\end{equation}</p>
<p>对于$n &lt; 0$，利用$c_n = c_{-n}^<em>$：<br />
\begin{equation}<br />
c_n = c_{-n}^</em> = \left(\sum_{k=0}^{N+n} a_k a_{k-n}^<em>\right)^</em> = \sum_{k=0}^{N+n} a_{k-n} a_k^*<br />
\end{equation}</p>
<p><strong>数值示例</strong>：假设$N = 2$，$a_0 = 1$，$a_1 = i$，$a_2 = 1+i$，则：<br />
\begin{equation}<br />
\begin{aligned}<br />
c_0 &amp;= a_0 a_0^<em> + a_1 a_1^</em> + a_2 a_2^<em> = 1 + 1 + 2 = 4 \<br />
c_1 &amp;= a_0 a_1^</em> + a_1 a_2^<em> = 1 \cdot (-i) + i \cdot (1-i) = -i + i + 1 = 1 \<br />
c_2 &amp;= a_0 a_2^</em> = 1 \cdot (1-i) = 1 - i \<br />
c_{-1} &amp;= c_1^<em> = 1 \<br />
c_{-2} &amp;= c_2^</em> = 1 + i<br />
\end{aligned}<br />
\end{equation}</p>
<p>对应的Toeplitz矩阵：<br />
\begin{equation}<br />
\mathbf{C} = \begin{bmatrix}<br />
4 &amp; 1 &amp; 1-i \<br />
1 &amp; 4 &amp; 1 \<br />
1+i &amp; 1 &amp; 4<br />
\end{bmatrix}<br />
\end{equation}</p>
<p>可以验证这是正定矩阵（所有特征值都大于0）。</p>
<h3 id="_13">五、变量变换与雅可比行列式<a class="toc-link" href="#_13" title="Permanent link">&para;</a></h3>
<h4 id="51">5.1 概率密度的变换公式<a class="toc-link" href="#51" title="Permanent link">&para;</a></h4>
<p>设随机变量$X$的概率密度函数为$p_X(x)$，通过变换$Y = g(X)$得到新的随机变量$Y$，则$Y$的概率密度为：<br />
\begin{equation}<br />
p_Y(y) = p_X(x) \left|\frac{dx}{dy}\right| = p_X(g^{-1}(y)) \left|\frac{d g^{-1}(y)}{dy}\right|<br />
\end{equation}</p>
<p>其中$\left|\frac{dx}{dy}\right|$是雅可比行列式的绝对值。</p>
<p><strong>推导</strong>：由概率守恒：<br />
\begin{equation}<br />
P(Y \in [y, y+dy]) = P(X \in [x, x+dx])<br />
\end{equation}</p>
<p>即：<br />
\begin{equation}<br />
p_Y(y) dy = p_X(x) |dx|<br />
\end{equation}</p>
<p>因此：<br />
\begin{equation}<br />
p_Y(y) = p_X(x) \left|\frac{dx}{dy}\right|<br />
\end{equation}</p>
<h4 id="52-11mathbbr">5.2 从$[-1,1]$到$\mathbb{R}$的变换<a class="toc-link" href="#52-11mathbbr" title="Permanent link">&para;</a></h4>
<p>考虑变换$x = \tanh(z)$，其中$z = \frac{y-\mu}{\sigma}$，即：<br />
\begin{equation}<br />
x = \tanh\left(\frac{y-\mu}{\sigma}\right)<br />
\end{equation}</p>
<p><strong>计算雅可比</strong>：<br />
\begin{equation}<br />
\frac{dx}{dy} = \frac{d}{dy}\tanh\left(\frac{y-\mu}{\sigma}\right) = \frac{1}{\sigma} \text{sech}^2\left(\frac{y-\mu}{\sigma}\right)<br />
\end{equation}</p>
<p>其中我们使用了：<br />
\begin{equation}<br />
\frac{d}{dz}\tanh(z) = \text{sech}^2(z) = \frac{1}{\cosh^2(z)} = 1 - \tanh^2(z)<br />
\end{equation}</p>
<p><strong>验证</strong>：<br />
\begin{equation}<br />
\begin{aligned}<br />
\frac{d}{dz}\tanh(z) &amp;= \frac{d}{dz}\frac{e^z - e^{-z}}{e^z + e^{-z}} \<br />
&amp;= \frac{(e^z + e^{-z})(e^z + e^{-z}) - (e^z - e^{-z})(e^z - e^{-z})}{(e^z + e^{-z})^2} \<br />
&amp;= \frac{(e^z + e^{-z})^2 - (e^z - e^{-z})^2}{(e^z + e^{-z})^2} \<br />
&amp;= \frac{4}{(e^z + e^{-z})^2} = \text{sech}^2(z)<br />
\end{aligned}<br />
\end{equation}</p>
<p>因此，$\mathbb{R}$上的概率密度为：<br />
\begin{equation}<br />
q(y) = p(x) \left|\frac{dx}{dy}\right| = \frac{1}{\sigma}\text{sech}^2\left(\frac{y-\mu}{\sigma}\right) p\left(\tanh\left(\frac{y-\mu}{\sigma}\right)\right)<br />
\end{equation}</p>
<h4 id="53">5.3 归一化验证<a class="toc-link" href="#53" title="Permanent link">&para;</a></h4>
<p>验证归一化：<br />
\begin{equation}<br />
\int_{-\infty}^{\infty} q(y) dy = \int_{-\infty}^{\infty} p(x) \left|\frac{dx}{dy}\right| dy = \int_{-1}^{1} p(x) dx = 1<br />
\end{equation}</p>
<p>这里使用了变量替换$y \to x$。</p>
<p><strong>数值验证</strong>：设$\mu = 0$，$\sigma = 1$，$p(x) = 1/2$（均匀分布），则：<br />
\begin{equation}<br />
\int_{-\infty}^{\infty} \frac{1}{2}\text{sech}^2(y) dy = \frac{1}{2}[\tanh(y)]_{-\infty}^{\infty} = \frac{1}{2}(1 - (-1)) = 1 \quad \checkmark<br />
\end{equation}</p>
<h3 id="_14">六、正则化项的频率域解释<a class="toc-link" href="#_14" title="Permanent link">&para;</a></h3>
<h4 id="61">6.1 导数的傅里叶变换<a class="toc-link" href="#61" title="Permanent link">&para;</a></h4>
<p>对于函数$f(x) = \sum_{n=-N}^{N} c_n e^{i\pi n x}$，其导数为：<br />
\begin{equation}<br />
\frac{df(x)}{dx} = \sum_{n=-N}^{N} c_n \cdot i\pi n \cdot e^{i\pi n x}<br />
\end{equation}</p>
<p>这说明<strong>求导在频域对应于乘以$i\pi n$</strong>。</p>
<h4 id="62">6.2 正则化项的计算<a class="toc-link" href="#62" title="Permanent link">&para;</a></h4>
<p>考虑导数模长的平方：<br />
\begin{equation}<br />
\left|\frac{df(x)}{dx}\right|^2 = \left|\sum_{n=-N}^{N} i\pi n c_n e^{i\pi n x}\right|^2<br />
\end{equation}</p>
<p>积分得：<br />
\begin{equation}<br />
\begin{aligned}<br />
\int_{-1}^1 \left|\frac{df(x)}{dx}\right|^2 dx &amp;= \int_{-1}^1 \left(\sum_{n=-N}^{N} i\pi n c_n e^{i\pi n x}\right) \left(\sum_{m=-N}^{N} (-i\pi m) c_m^<em> e^{-i\pi m x}\right) dx \<br />
&amp;= \sum_{n=-N}^{N}\sum_{m=-N}^{N} (i\pi n)(-i\pi m) c_n c_m^</em> \int_{-1}^1 e^{i\pi (n-m) x} dx \<br />
&amp;= \sum_{n=-N}^{N}\sum_{m=-N}^{N} \pi^2 n m c_n c_m^* \cdot 2\delta_{nm} \<br />
&amp;= 2\pi^2 \sum_{n=-N}^{N} n^2 |c_n|^2<br />
\end{aligned}<br />
\end{equation}</p>
<p>因此正则化项为：<br />
\begin{equation}<br />
\mathcal{R} = \gamma \int_{-1}^1 \left|\frac{df(x)}{dx}\right|^2 dx = 2\pi^2 \gamma \sum_{n=-N}^{N} n^2 |c_n|^2<br />
\end{equation}</p>
<h4 id="63">6.3 频率域解释<a class="toc-link" href="#63" title="Permanent link">&para;</a></h4>
<p>注意到$n^2$项，这意味着：<br />
- $n = 0$（直流分量）：权重为0，不受惩罚<br />
- $|n|$较小（低频）：惩罚较轻<br />
- $|n|$较大（高频）：惩罚$\propto n^2$，重惩罚</p>
<p><strong>物理意义</strong>：高频分量对应函数的快速振荡，惩罚高频分量使得拟合的函数更平滑，避免过拟合噪声。</p>
<h4 id="64-sobolev">6.4 与Sobolev空间的联系<a class="toc-link" href="#64-sobolev" title="Permanent link">&para;</a></h4>
<p>这种正则化实际上是在$H^1$ Sobolev空间中定义了一个范数：<br />
\begin{equation}<br />
|f|<em -1="-1">{H^1}^2 = \int</em>\right|^2 dx}^1 |f(x)|^2 dx + \int_{-1}^1 \left|\frac{df(x)}{dx<br />
\end{equation}</p>
<p>更高阶的正则化可以使用$H^k$范数：<br />
\begin{equation}<br />
|f|<em j="0">{H^k}^2 = \sum</em>}^{k} \int_{-1}^1 \left|\frac{d^j f(x)}{dx^j}\right|^2 dx = 2\sum_{n=-N}^{N} |c_n|^2 \sum_{j=0}^{k} (\pi n)^{2j<br />
\end{equation}</p>
<h3 id="gmmdfp">七、与GMM和DFP的详细对比<a class="toc-link" href="#gmmdfp" title="Permanent link">&para;</a></h3>
<h4 id="71">7.1 参数数量对比<a class="toc-link" href="#71" title="Permanent link">&para;</a></h4>
<p><strong>GMM</strong>：<br />
- 参数：${\mu_1, \sigma_1, w_1, \ldots, \mu_K, \sigma_K, w_K}$<br />
- 总数：$3K$个参数（考虑混合权重归一化约束，实际为$3K-1$）</p>
<p><strong>FBDM</strong>：<br />
- 参数：${a_0, a_1, \ldots, a_N}$（复数）<br />
- 总数：$2(N+1)$个实数参数</p>
<p><strong>DFP</strong>：<br />
- 参数：神经网络的所有权重和偏置<br />
- 总数：取决于网络结构，通常$\gg 2(N+1)$</p>
<p>对于相同的拟合能力，FBDM通常需要较少的参数。</p>
<h4 id="72">7.2 梯度特性对比<a class="toc-link" href="#72" title="Permanent link">&para;</a></h4>
<p><strong>GMM的梯度</strong>：<br />
\begin{equation}<br />
\frac{\partial}{\partial \mu_k} \log p(x) = \frac{w_k \phi_k(x)}{\sum_j w_j \phi_j(x)} \cdot \frac{x - \mu_k}{\sigma_k^2}<br />
\end{equation}</p>
<p>其中$\phi_k(x) = \frac{1}{\sqrt{2\pi}\sigma_k}\exp\left(-\frac{(x-\mu_k)^2}{2\sigma_k^2}\right)$。</p>
<p>当$|x - \mu_k| \gg \sigma_k$时，$\phi_k(x) \approx 0$，导致<strong>梯度消失</strong>。</p>
<p><strong>FBDM的梯度</strong>：<br />
\begin{equation}<br />
\frac{\partial}{\partial a_k} \log p(x) = \frac{1}{p(x)} \frac{\partial p(x)}{\partial a_k}<br />
\end{equation}</p>
<p>由于$p(x)$是三角函数的组合，梯度不会指数衰减，避免了严重的梯度消失问题。</p>
<h4 id="73-modal">7.3 Modal捕捉能力<a class="toc-link" href="#73-modal" title="Permanent link">&para;</a></h4>
<p><strong>定义</strong>：Modal（模态）是概率密度函数的局部最大值点。</p>
<p>GMM的每个高斯分量最多贡献一个modal，因此$K$个分量最多产生$K$个modal。</p>
<p>FBDM由于使用三角函数，理论上可以用较少参数产生多个modal：<br />
\begin{equation}<br />
p(x) \approx \sum_{n=1}^{N} A_n \cos(\pi n x + \phi_n)<br />
\end{equation}</p>
<p>频率为$n$的分量在$[-1, 1]$内最多产生$2n$个极值点，因此理论上可以产生$O(N^2)$个modal。</p>
<p><strong>数值示例</strong>：设$N = 3$，取适当的$c_n$可以构造出具有5个peak的分布，而GMM需要至少5个分量。</p>
<h4 id="74">7.4 计算复杂度对比<a class="toc-link" href="#74" title="Permanent link">&para;</a></h4>
<p><strong>前向传播</strong>：<br />
- GMM：$O(K)$<br />
- FBDM：$O(N)$<br />
- DFP：$O(L \times D)$（$L$为层数，$D$为隐藏维度）</p>
<p><strong>梯度计算</strong>：<br />
- GMM：$O(K)$<br />
- FBDM：$O(N^2)$（因为需要计算$c_n = \sum_k a_k a_{k+n}^*$）<br />
- DFP：$O(L \times D^2)$</p>
<p><strong>采样</strong>：<br />
- GMM：$O(1)$（先采样类别，再从高斯采样）<br />
- FBDM：$O(N)$（需要数值求解逆CDF）<br />
- DFP：$O(N)$（同FBDM）</p>
<h3 id="_15">八、数值稳定性与实现技巧<a class="toc-link" href="#_15" title="Permanent link">&para;</a></h3>
<h4 id="81">8.1 避免数值下溢<a class="toc-link" href="#81" title="Permanent link">&para;</a></h4>
<p>在计算$\log p(x)$时，如果$p(x)$非常小，可能导致数值下溢。解决方法：<br />
\begin{equation}<br />
\log p(x) = \log f(x) - \log(2c_0)<br />
\end{equation}</p>
<h4 id="82">8.2 归一化常数的稳定计算<a class="toc-link" href="#82" title="Permanent link">&para;</a></h4>
<p>由于$c_0 = \sum_{k=0}^{N} |a_k|^2$，可以在计算前对$a_k$进行预归一化：<br />
\begin{equation}<br />
\tilde{a}_k = \frac{a_k}{\sqrt{\sum_j |a_j|^2}}<br />
\end{equation}</p>
<p>这确保$c_0 = 1$，简化计算。</p>
<h4 id="83">8.3 复数运算的实数实现<a class="toc-link" href="#83" title="Permanent link">&para;</a></h4>
<p>虽然理论上需要复数运算，但可以通过实部和虚部分离来用实数实现：<br />
\begin{equation}<br />
a_k = \alpha_k + i\beta_k<br />
\end{equation}</p>
<p>则：<br />
\begin{equation}<br />
c_n = \sum_{k=0}^{N-n} (\alpha_k + i\beta_k)(\alpha_{k+n} - i\beta_{k+n}) = \sum_{k=0}^{N-n} [(\alpha_k\alpha_{k+n} + \beta_k\beta_{k+n}) + i(\beta_k\alpha_{k+n} - \alpha_k\beta_{k+n})]<br />
\end{equation}</p>
<h3 id="_16">九、收敛性与优化保证<a class="toc-link" href="#_16" title="Permanent link">&para;</a></h3>
<h4 id="91">9.1 目标函数的凸性分析<a class="toc-link" href="#91" title="Permanent link">&para;</a></h4>
<p>FBDM的负对数似然为：<br />
\begin{equation}<br />
\mathcal{L} = -\frac{1}{n}\sum_{i=1}^{n} \log p(x_i) + \gamma \sum_{k=-N}^{N} k^2 |c_k|^2<br />
\end{equation}</p>
<p>这个目标函数关于${a_k}$<strong>不是凸的</strong>，因为$p(x)$关于$a_k$是非线性的。</p>
<h4 id="92">9.2 初始化策略<a class="toc-link" href="#92" title="Permanent link">&para;</a></h4>
<p>良好的初始化可以提高优化效果：</p>
<p><strong>策略1</strong>：随机初始化<br />
\begin{equation}<br />
a_k \sim \mathcal{CN}(0, \sigma^2 / (k+1))<br />
\end{equation}</p>
<p>高频分量初始化为较小值。</p>
<p><strong>策略2</strong>：基于矩匹配<br />
先计算数据的前$N+1$阶矩，然后通过傅里叶系数与矩的关系初始化。</p>
<h4 id="93">9.3 优化算法选择<a class="toc-link" href="#93" title="Permanent link">&para;</a></h4>
<p>推荐使用Adam优化器，学习率建议：<br />
\begin{equation}<br />
\text{lr} \in [10^{-4}, 10^{-2}]<br />
\end{equation}</p>
<p>对于$a_k$的实部和虚部可以使用不同的学习率。</p>
<h3 id="_17">十、总结与展望<a class="toc-link" href="#_17" title="Permanent link">&para;</a></h3>
<p>本节详细推导了FBDM的数学基础，包括：</p>
<ol>
<li><strong>傅里叶级数理论</strong>：正交性、Parseval定理、截断误差分析</li>
<li><strong>实数性约束</strong>：充要性的双向证明</li>
<li><strong>非负性约束</strong>：Toeplitz矩阵正定性、自相关构造</li>
<li><strong>变量变换</strong>：雅可比行列式的精确计算</li>
<li><strong>正则化</strong>：频域解释与Sobolev空间</li>
<li><strong>方法对比</strong>：GMM、DFP、FBDM的优劣分析</li>
</ol>
<p>FBDM为一维概率密度估计提供了一个优雅的解决方案，其核心思想——利用傅里叶级数的表达能力和自相关的非负保证——值得在其他问题中借鉴。</p>
                </div>

                <!-- Previous/Next Navigation -->
                <nav class="post-navigation" aria-label="文章导航">
                    <div class="row g-3">
                        <div class="col-6">
                            
                            <a href="配置不同的学习率lora还能再涨一点.html" class="nav-link-prev">
                                <div class="nav-direction"><i class="fas fa-chevron-left"></i> 上一篇</div>
                                <div class="nav-title">#133 配置不同的学习率，LoRA还能再涨一点？</div>
                            </a>
                            
                        </div>
                        <div class="col-6">
                            
                            <a href="时空之章将attention视为平方复杂度的rnn.html" class="nav-link-next">
                                <div class="nav-direction">下一篇 <i class="fas fa-chevron-right"></i></div>
                                <div class="nav-title">#135 时空之章：将Attention视为平方复杂度的RNN</div>
                            </a>
                            
                        </div>
                    </div>
                </nav>

                <!-- Back to Home -->
                <div class="text-center mt-4 mb-4">
                    <a href="../index.html" class="btn btn-outline-primary">
                        <i class="fas fa-arrow-left"></i> 返回首页
                    </a>
                </div>
            </div>

            <!-- Sidebar (TOC) -->
            <div class="col-lg-3">
                <aside class="sidebar">
                    
                    <div class="toc-sidebar">
                        <h5 class="toc-title"><i class="fas fa-list"></i> 目录</h5>
                        <div class="toc-content">
                            <div class="toc">
<ul>
<li><a href="#_1">用傅里叶级数拟合一维概率密度函数</a><ul>
<li><a href="#_2">问题简述</a></li>
<li><a href="#_3">已有方法</a></li>
<li><a href="#_4">请傅里叶</a></li>
<li><a href="#_5">保证非负</a></li>
<li><a href="#_6">一般结果</a></li>
<li><a href="#_7">延伸思考</a></li>
<li><a href="#_8">文章小结</a></li>
<li><a href="#_9">详细数学推导与注释</a><ul>
<li><a href="#_10">一、傅里叶级数基础理论</a></li>
<li><a href="#_11">二、实数性约束的充要性证明</a></li>
<li><a href="#toeplitz">三、非负性约束：Toeplitz矩阵与正定性</a></li>
<li><a href="#_12">四、自相关系数的性质与应用</a></li>
<li><a href="#_13">五、变量变换与雅可比行列式</a></li>
<li><a href="#_14">六、正则化项的频率域解释</a></li>
<li><a href="#gmmdfp">七、与GMM和DFP的详细对比</a></li>
<li><a href="#_15">八、数值稳定性与实现技巧</a></li>
<li><a href="#_16">九、收敛性与优化保证</a></li>
<li><a href="#_17">十、总结与展望</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

                        </div>
                        <div class="toc-actions">
                            <button class="btn btn-sm btn-outline-secondary" onclick="expandAll()">
                                <i class="fas fa-expand"></i> 全部展开
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="collapseAll()">
                                <i class="fas fa-compress"></i> 全部折叠
                            </button>
                        </div>
                    </div>
                    

                    <!-- Back to Top Button -->
                    <button id="backToTop" class="back-to-top" title="回到顶部">
                        <i class="fas fa-arrow-up"></i>
                    </button>
                </aside>
            </div>
        </div>
    </article>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>
                博客来源: <a href="https://spaces.ac.cn" target="_blank">科学空间</a> |
                内容经过整理并添加详细数学推导
            </p>
            <p>
                Powered by <a href="https://pages.github.com/" target="_blank">GitHub Pages</a>
            </p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Syntax highlighting -->
    <script>hljs.highlightAll();</script>

    <!-- Back to top functionality -->
    <script>
        // Show/hide back to top button based on scroll position
        window.addEventListener('scroll', function() {
            const backToTop = document.getElementById('backToTop');
            if (window.pageYOffset > 300) {
                backToTop.classList.add('show');
            } else {
                backToTop.classList.remove('show');
            }
        });

        // Smooth scroll to top
        document.getElementById('backToTop').addEventListener('click', function() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        // Sticky TOC sidebar
        window.addEventListener('scroll', function() {
            const sidebar = document.querySelector('.sidebar');
            if (!sidebar) return;

            const sidebarTop = sidebar.offsetTop;
            const scrollTop = window.pageYOffset;

            if (scrollTop > sidebarTop - 20) {
                sidebar.classList.add('sticky');
            } else {
                sidebar.classList.remove('sticky');
            }
        });
    </script>
</body>
</html>