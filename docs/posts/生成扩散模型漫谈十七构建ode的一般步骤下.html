<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆåä¸ƒï¼‰ï¼šæ„å»ºODEçš„ä¸€èˆ¬æ­¥éª¤ï¼ˆä¸‹ï¼‰ | ML & Math Blog Posts</title>
    <meta name="description" content="ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆåä¸ƒï¼‰ï¼šæ„å»ºODEçš„ä¸€èˆ¬æ­¥éª¤ï¼ˆä¸‹ï¼‰&para;
åŸæ–‡é“¾æ¥: https://spaces.ac.cn/archives/9497
å‘å¸ƒæ—¥æœŸ: 2023-02-23

ğŸ“Œ å†…å®¹æ¦‚è§ˆ&para;
å†å²æ€»æ˜¯æƒŠäººåœ°ç›¸ä¼¼ã€‚å½“åˆç¬”è€…åœ¨å†™ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆåå››ï¼‰ï¼šæ„å»ºODEçš„ä¸€èˆ¬æ­¥éª¤ï¼ˆä¸Šï¼‰ã€‹ï¼ˆå½“æ—¶è¿˜æ²¡æœ‰â€œä¸Šâ€è¿™ä¸ªåç¼€ï¼‰æ—¶ï¼Œä»¥ä¸ºè‡ªå·±å·²ç»ææ¸…æ¥šäº†æ„å»ºODEå¼æ‰©æ•£çš„ä¸€èˆ¬æ­¥éª¤ï¼Œç»“æœè¯»è€… @gaohu...">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css">

    <!-- Google Fonts -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/post.css">

    <!-- Custom JS -->
    <script src="../assets/js/collapsible.js" defer></script>

    <!-- MathJax for math rendering with equation numbering -->
    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true,
        processEnvironments: true,
        tags: 'ams',  // Enable equation numbering with AMS style
        tagSide: 'right',  // Place equation numbers on the right
        tagIndent: '0.8em',  // Indentation for equation numbers
        multlineWidth: '85%'
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Syntax highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/github.min.css">
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/highlight.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
        <div class="container">
            <a class="navbar-brand" href="../index.html">
                <i class="fas fa-brain"></i> ML & Math Blog
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../index.html"><i class="fas fa-home"></i> é¦–é¡µ</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Post Content -->
    <article class="container post-container my-5">
        <!-- Breadcrumb Navigation -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="../index.html"><i class="fas fa-home"></i> é¦–é¡µ</a></li>
                
                <li class="breadcrumb-item"><a href="../index.html?tags=è¯¦ç»†æ¨å¯¼">è¯¦ç»†æ¨å¯¼</a></li>
                
                <li class="breadcrumb-item active" aria-current="page">
                    #219 ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆåä¸ƒï¼‰ï¼šæ„å»ºODEçš„ä¸€èˆ¬æ­¥éª¤ï¼ˆä¸‹ï¼‰
                </li>
            </ol>
        </nav>

        <!-- Post Header -->
        <header class="post-header mb-4">
            <h1 class="post-title">
                <span class="post-number">#219</span>
                ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆåä¸ƒï¼‰ï¼šæ„å»ºODEçš„ä¸€èˆ¬æ­¥éª¤ï¼ˆä¸‹ï¼‰
            </h1>
            <div class="post-meta">
                <span><i class="far fa-calendar"></i> 2023-02-23</span>
                
            </div>
            
            <div class="post-tags mt-3">
                
                <a href="../index.html?tags=è¯¦ç»†æ¨å¯¼" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> è¯¦ç»†æ¨å¯¼</span>
                </a>
                
                <a href="../index.html?tags=æ¦‚ç‡" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> æ¦‚ç‡</span>
                </a>
                
                <a href="../index.html?tags=å¾®åˆ†æ–¹ç¨‹" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> å¾®åˆ†æ–¹ç¨‹</span>
                </a>
                
                <a href="../index.html?tags=ç”Ÿæˆæ¨¡å‹" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> ç”Ÿæˆæ¨¡å‹</span>
                </a>
                
                <a href="../index.html?tags=æ‰©æ•£" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> æ‰©æ•£</span>
                </a>
                
                <a href="../index.html?tags=ODE" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> ODE</span>
                </a>
                
                <a href="../index.html?tags=Rectified Flow" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> Rectified Flow</span>
                </a>
                
                <a href="../index.html?tags=æœ€ä¼˜ä¼ è¾“" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> æœ€ä¼˜ä¼ è¾“</span>
                </a>
                
            </div>
            
        </header>

        <div class="row">
            <!-- Main Content -->
            <div class="col-lg-9">
                <!-- Post Body -->
                <div class="post-content">
                    <h1 id="ode">ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆåä¸ƒï¼‰ï¼šæ„å»ºODEçš„ä¸€èˆ¬æ­¥éª¤ï¼ˆä¸‹ï¼‰<a class="toc-link" href="#ode" title="Permanent link">&para;</a></h1>
<p><strong>åŸæ–‡é“¾æ¥</strong>: <a href="https://spaces.ac.cn/archives/9497">https://spaces.ac.cn/archives/9497</a></p>
<p><strong>å‘å¸ƒæ—¥æœŸ</strong>: 2023-02-23</p>
<hr />
<h2 id="_1">ğŸ“Œ å†…å®¹æ¦‚è§ˆ<a class="toc-link" href="#_1" title="Permanent link">&para;</a></h2>
<p>å†å²æ€»æ˜¯æƒŠäººåœ°ç›¸ä¼¼ã€‚å½“åˆç¬”è€…åœ¨å†™<a href="/archives/9370">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆåå››ï¼‰ï¼šæ„å»ºODEçš„ä¸€èˆ¬æ­¥éª¤ï¼ˆä¸Šï¼‰ã€‹</a>ï¼ˆå½“æ—¶è¿˜æ²¡æœ‰â€œä¸Šâ€è¿™ä¸ªåç¼€ï¼‰æ—¶ï¼Œä»¥ä¸ºè‡ªå·±å·²ç»ææ¸…æ¥šäº†æ„å»ºODEå¼æ‰©æ•£çš„ä¸€èˆ¬æ­¥éª¤ï¼Œç»“æœè¯»è€… <a href="/archives/9370#comment-20572">@gaohuazuo</a> å°±ç»™å‡ºäº†ä¸€ä¸ªæ–°çš„ç›´è§‚æœ‰æ•ˆçš„æ–¹æ¡ˆï¼Œè¿™ç›´æ¥å¯¼è‡´äº†åç»­<a href="/archives/9379">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆåå››ï¼‰ï¼šæ„å»ºODEçš„ä¸€èˆ¬æ­¥éª¤ï¼ˆä¸­ï¼‰ã€‹</a>ï¼ˆå½“æ—¶åç¼€æ˜¯â€œä¸‹â€ï¼‰ã€‚è€Œå½“ç¬”è€…ä»¥ä¸ºäº‹æƒ…å·²ç»ç»ˆç»“æ—¶ï¼Œå´å‘ç°ICLR2023çš„è®ºæ–‡<a href="https://papers.cool/arxiv/2209.03003">ã€ŠFlow Straight and Fast: Learning to Generate and Transfer Data with Rectified Flowã€‹</a>åˆç»™å‡ºäº†ä¸€ä¸ªæ„å»ºODEå¼æ‰©æ•£æ¨¡å‹çš„æ–°æ–¹æ¡ˆï¼Œå…¶ç®€æ´ã€ç›´è§‚çš„ç¨‹åº¦ç®€ç›´å‰æ‰€æœªæœ‰ï¼Œä»¤äººæ‹æ¡ˆå«ç»ã€‚æ‰€ä»¥ç¬”è€…åªå¥½é»˜é»˜å°†å‰ä¸€ç¯‡çš„åç¼€æ”¹ä¸ºâ€œä¸­â€ï¼Œç„¶åå†™äº†è¿™ä¸ªâ€œä¸‹â€ç¯‡æ¥åˆ†äº«è¿™ä¸€æ–°çš„ç»“æœã€‚</p>
<h2 id="_2">ç›´è§‚ç»“æœ<a class="toc-link" href="#_2" title="Permanent link">&para;</a></h2>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œæ‰©æ•£æ¨¡å‹æ˜¯ä¸€ä¸ª$\boldsymbol{x}_T\to \boldsymbol{x}_0$çš„æ¼”åŒ–è¿‡ç¨‹ï¼Œè€ŒODEå¼æ‰©æ•£æ¨¡å‹åˆ™æŒ‡å®šæ¼”åŒ–è¿‡ç¨‹æŒ‰ç…§å¦‚ä¸‹ODEè¿›è¡Œï¼š<br />
\begin{equation}\frac{d\boldsymbol{x}_t}{dt}=\boldsymbol{f}_t(\boldsymbol{x}_t)\label{eq:ode}\end{equation}<br />
è€Œæ‰€è°“æ„å»ºODEå¼æ‰©æ•£æ¨¡å‹ï¼Œå°±æ˜¯è¦è®¾è®¡ä¸€ä¸ªå‡½æ•°$\boldsymbol{f}_t(\boldsymbol{x}_t)$ï¼Œä½¿å…¶å¯¹åº”çš„æ¼”åŒ–è½¨è¿¹æ„æˆç»™å®šåˆ†å¸ƒ$p_T(\boldsymbol{x}_T)$ã€$p_0(\boldsymbol{x}_0)$ä¹‹é—´çš„ä¸€ä¸ªå˜æ¢ã€‚è¯´ç™½äº†ï¼Œæˆ‘ä»¬å¸Œæœ›ä»$p_T(\boldsymbol{x}_T)$ä¸­éšæœºé‡‡æ ·ä¸€ä¸ª$\boldsymbol{x}_T$ï¼Œç„¶åæŒ‰ç…§ä¸Šè¿°ODEå‘åæ¼”åŒ–å¾—åˆ°çš„$\boldsymbol{x}_0$æ˜¯$\sim p_0(\boldsymbol{x}_0)$çš„ã€‚</p>
<p>åŸè®ºæ–‡çš„æ€è·¯éå¸¸ç®€å•ï¼Œéšæœºé€‰å®š$\boldsymbol{x}<em _boldsymbol_x="\boldsymbol{x">0\sim p_0(\boldsymbol{x}_0),\boldsymbol{x}_T\sim p_T(\boldsymbol{x}_T)$ï¼Œå‡è®¾å®ƒä»¬æŒ‰ç…§è½¨è¿¹<br />
\begin{equation}\boldsymbol{x}_t = \boldsymbol{\varphi}_t(\boldsymbol{x}_0, \boldsymbol{x}_T)\label{eq:track}\end{equation}<br />
è¿›è¡Œå˜æ¢ã€‚è¿™ä¸ªè½¨è¿¹æ˜¯ä¸€ä¸ªå·²çŸ¥çš„å‡½æ•°ï¼Œæ˜¯æˆ‘ä»¬è‡ªè¡Œè®¾è®¡çš„éƒ¨åˆ†ï¼Œç†è®ºä¸Šåªè¦æ»¡è¶³<br />
\begin{equation}\boldsymbol{x}_0 = \boldsymbol{\varphi}_0(\boldsymbol{x}_0, \boldsymbol{x}_T),\quad \boldsymbol{x}_T = \boldsymbol{\varphi}_T(\boldsymbol{x}_0, \boldsymbol{x}_T)\end{equation}<br />
çš„è¿ç»­å‡½æ•°éƒ½å¯ä»¥ã€‚æ¥ç€æˆ‘ä»¬å°±å¯ä»¥å†™å‡ºå®ƒæ»¡è¶³çš„å¾®åˆ†æ–¹ç¨‹ï¼š<br />
\begin{equation}\frac{d\boldsymbol{x}_t}{dt} = \frac{\partial \boldsymbol{\varphi}_t(\boldsymbol{x}_0, \boldsymbol{x}_T)}{\partial t}\label{eq:fake-ode}\end{equation}<br />
ä½†è¿™ä¸ªå¾®åˆ†æ–¹ç¨‹æ˜¯ä¸å®ç”¨çš„ï¼Œå› ä¸ºæˆ‘ä»¬æƒ³è¦çš„æ˜¯ç»™å®š$\boldsymbol{x}_T$æ¥ç”Ÿæˆ$\boldsymbol{x}_0$ï¼Œä½†å®ƒå³ç«¯å´æ˜¯$\boldsymbol{x}_0$çš„å‡½æ•°ï¼ˆå¦‚æœå·²çŸ¥$\boldsymbol{x}_0$å°±å®Œäº‹äº†ï¼‰ï¼Œåªæœ‰åƒå¼$\eqref{eq:ode}$é‚£æ ·å³ç«¯åªå«æœ‰$\boldsymbol{x}_t$çš„ODEï¼ˆå•ä»å› æœå…³ç³»æ¥çœ‹ï¼Œç†è®ºä¸Šä¹Ÿå¯ä»¥åŒ…å«$\boldsymbol{x}_T$ï¼Œä½†æˆ‘ä»¬ä¸€èˆ¬ä¸è€ƒè™‘è¿™ç§æƒ…å†µï¼‰æ‰èƒ½è¿›è¡Œå®ç”¨çš„æ¼”åŒ–ã€‚é‚£ä¹ˆï¼Œä¸€ä¸ªç›´è§‚åˆâ€œå¼‚æƒ³å¤©å¼€â€çš„æƒ³æ³•æ˜¯ï¼š<strong>å­¦ä¸€ä¸ªå‡½æ•°$\boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x}_t, t)$å°½é‡é€¼è¿‘ä¸Šå¼å³ç«¯ï¼</strong> ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä¼˜åŒ–å¦‚ä¸‹ç›®æ ‡ï¼š<br />
\begin{equation}\mathbb{E}</em><em _boldsymbol_theta="\boldsymbol{\theta">0\sim p_0(\boldsymbol{x}_0),\boldsymbol{x}_T\sim p_T(\boldsymbol{x}_T)}\left[\left\Vert \boldsymbol{v}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, t) - \frac{\partial \boldsymbol{\varphi}_t(\boldsymbol{x}_0, \boldsymbol{x}_T)}{\partial t}\right\Vert^2\right] \label{eq:objective}
\end{equation}<br />
ç”±äº$\boldsymbol{v}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, t)$å°½é‡é€¼è¿‘äº†$\frac{\partial \boldsymbol{\varphi}_t(\boldsymbol{x}_0, \boldsymbol{x}_T)}{\partial t}$ï¼Œæ‰€ä»¥æˆ‘ä»¬è®¤ä¸ºå°†æ–¹ç¨‹$\eqref{eq:fake-ode}$çš„å³ç«¯æ›¿æ¢ä¸º$\boldsymbol{v}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, t)$ä¹Ÿæ˜¯æˆç«‹çš„ï¼Œè¿™å°±å¾—åˆ°å®ç”¨çš„æ‰©æ•£ODEï¼š<br />
\begin{equation}\frac{d\boldsymbol{x}_t}{dt} = \boldsymbol{v}</em>}}(\boldsymbol{x}_t, t)\label{eq:s-ode}\end{equation</p>
<h2 id="_3">ç®€å•ä¾‹å­<a class="toc-link" href="#_3" title="Permanent link">&para;</a></h2>
<p>ä½œä¸ºç®€å•çš„ä¾‹å­ï¼Œæˆ‘ä»¬è®¾$T=1$ï¼Œå¹¶è®¾å˜åŒ–è½¨è¿¹æ˜¯ç›´çº¿
\begin{equation}\boldsymbol{x}<em _boldsymbol_x="\boldsymbol{x">t = \boldsymbol{\varphi}_t(\boldsymbol{x}_0,\boldsymbol{x}_1) = (\boldsymbol{x}_1 - \boldsymbol{x}_0)t + \boldsymbol{x}_0\end{equation}<br />
é‚£ä¹ˆ<br />
\begin{equation}\frac{\partial \boldsymbol{\varphi}_t(\boldsymbol{x}_0, \boldsymbol{x}_T)}{\partial t} = \boldsymbol{x}_1 - \boldsymbol{x}_0\end{equation}<br />
æ‰€ä»¥è®­ç»ƒç›®æ ‡$\eqref{eq:objective}$å°±æ˜¯ï¼š<br />
\begin{equation}\mathbb{E}</em><em _boldsymbol_theta="\boldsymbol{\theta">0\sim p_0(\boldsymbol{x}_0),\boldsymbol{x}_T\sim p_T(\boldsymbol{x}_T)}\left[\left\Vert \boldsymbol{v}</em>}}\big((\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">1 - \boldsymbol{x}_0)t + \boldsymbol{x}_0, t\big) - (\boldsymbol{x}_1 - \boldsymbol{x}_0)\right\Vert^2\right]\end{equation}<br />
æˆ–è€…ç­‰ä»·åœ°å†™æˆ<br />
\begin{equation}\mathbb{E}</em><em _boldsymbol_theta="\boldsymbol{\theta">0,\boldsymbol{x}_t\sim p_0(\boldsymbol{x}_0)p_t(\boldsymbol{x}_t|\boldsymbol{x}_0)}\left[\left\Vert \boldsymbol{v}</em>}}(\boldsymbol{x}_t, t) - \frac{\boldsymbol{x}_t - \boldsymbol{x}_0}{t}\right\Vert^2\right]\end{equation
è¿™å°±å®Œäº‹äº†ï¼ç»“æœè·Ÿ<a href="/archives/9379#%E7%9B%B4%E7%BA%BF%E8%BD%A8%E8%BF%B9">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆåå››ï¼‰ï¼šæ„å»ºODEçš„ä¸€èˆ¬æ­¥éª¤ï¼ˆä¸­ï¼‰ã€‹</a>çš„â€œç›´çº¿è½¨è¿¹â€ä¾‹å­æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œä¹Ÿæ˜¯åŸè®ºæ–‡ä¸»è¦ç ”ç©¶çš„æ¨¡å‹ï¼Œè¢«ç§°ä¸ºâ€œRectified Flowâ€ã€‚</p>
<p>ä»è¿™ä¸ªç›´çº¿ä¾‹å­çš„è¿‡ç¨‹ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œé€šè¿‡è¯¥æ€è·¯æ¥æ„å»ºæ‰©æ•£ODEçš„æ­¥éª¤åªæœ‰å¯¥å¯¥å‡ è¡Œï¼Œç›¸æ¯”ä¹‹å‰çš„è¿‡ç¨‹æ˜¯å¤§å¤§ç®€åŒ–äº†ï¼Œç®€å•åˆ°ç”šè‡³è®©äººæœ‰ç§â€œé¢ è¦†äº†å¯¹æ‰©æ•£æ¨¡å‹çš„å°è±¡â€çš„ä¸å¯æ€è®®ä¹‹æ„Ÿã€‚</p>
<h2 id="_4">è¯æ˜è¿‡ç¨‹<a class="toc-link" href="#_4" title="Permanent link">&para;</a></h2>
<p>ç„¶è€Œï¼Œè¿„ä»Šä¸ºæ­¢å‰é¢â€œç›´è§‚ç»“æœâ€ä¸€èŠ‚çš„ç»“è®ºåªèƒ½ç®—æ˜¯ä¸€ä¸ªç›´è§‚çš„çŒœæµ‹ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰ä»ç†è®ºä¸Šè¯æ˜ä¼˜åŒ–ç›®æ ‡$\eqref{eq:objective}$æ‰€å¾—åˆ°çš„æ–¹ç¨‹$\eqref{eq:s-ode}$çš„ç¡®å®ç°äº†åˆ†å¸ƒ$p_T(\boldsymbol{x}_T)$ã€$p_0(\boldsymbol{x}_0)$ä¹‹é—´çš„å˜æ¢ã€‚</p>
<p>ä¸ºäº†è¯æ˜è¿™ä¸€ç»“è®ºï¼Œç¬”è€…ä¸€å¼€å§‹æ˜¯æƒ³è¯æ˜ç›®æ ‡$\eqref{eq:objective}$çš„æœ€ä¼˜è§£æ»¡è¶³è¿ç»­æ€§æ–¹ç¨‹ï¼š<br />
\begin{equation}\frac{\partial p_t(\boldsymbol{x}<em _boldsymbol_x="\boldsymbol{x">t)}{\partial t} = -\nabla</em><em _boldsymbol_theta="\boldsymbol{\theta">t}\cdot\big(p_t(\boldsymbol{x}_t)\boldsymbol{v}</em>}}(\boldsymbol{x}_t, t)\big)\end{equation
å¦‚æœæ»¡è¶³ï¼Œé‚£ä¹ˆæ ¹æ®è¿ç»­æ€§æ–¹ç¨‹ä¸ODEçš„å¯¹åº”å…³ç³»ï¼ˆå‚è€ƒ<a href="/archives/9280">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆåäºŒï¼‰ï¼šâ€œç¡¬åˆšâ€æ‰©æ•£ODEã€‹</a>ã€<a href="/archives/9461">ã€Šæµ‹è¯•å‡½æ•°æ³•æ¨å¯¼è¿ç»­æ€§æ–¹ç¨‹å’ŒFokker-Planckæ–¹ç¨‹ã€‹</a>ï¼‰ï¼Œæ–¹ç¨‹$\eqref{eq:s-ode}$ç¡®å®æ˜¯åˆ†å¸ƒ$p_T(\boldsymbol{x}_T)$ã€$p_0(\boldsymbol{x}_0)$ä¹‹é—´çš„ä¸€ä¸ªå˜æ¢ã€‚</p>
<p>ä½†ä»”ç»†æƒ³ä¸€ä¸‹ï¼Œè¿™ä¸ªæ€è·¯ä¼¼ä¹æœ‰ç‚¹è¿‚å›äº†ï¼Œå› ä¸ºæ ¹æ®æ–‡ç« <a href="/archives/9461">ã€Šæµ‹è¯•å‡½æ•°æ³•æ¨å¯¼è¿ç»­æ€§æ–¹ç¨‹å’ŒFokker-Planckæ–¹ç¨‹ã€‹</a>ï¼Œè¿ç»­æ€§æ–¹ç¨‹æœ¬èº«å°±æ˜¯ç”±ODEé€šè¿‡<br />
\begin{equation}\mathbb{E}<em t="t" t_Delta="t+\Delta">{\boldsymbol{x}</em>}}\left[\phi(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">{t+\Delta t})\right] = \mathbb{E}</em>}_t}\left[\phi(\boldsymbol{x}_t + \boldsymbol{f}_t(\boldsymbol{x}_t)\Delta t)\right]\label{eq:base}\end{equation
æ¨å‡ºçš„ï¼Œæ‰€ä»¥æŒ‰ç†è¯´$\eqref{eq:base}$æ›´åŸºæœ¬ï¼Œæˆ‘ä»¬åªéœ€è¦è¯æ˜$\eqref{eq:objective}$çš„æœ€ä¼˜è§£æ»¡è¶³å®ƒå°±è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æƒ³è¦æ‰¾åˆ°ä¸€ä¸ªçº¯ç²¹æ˜¯$\boldsymbol{x}_t$çš„å‡½æ•°$\boldsymbol{f}_t(\boldsymbol{x}_t)$æ»¡è¶³$\eqref{eq:base}$ï¼Œç„¶åå‘ç°å®ƒæ­£å¥½æ˜¯$\eqref{eq:objective}$çš„æœ€ä¼˜è§£ã€‚</p>
<p>äºæ˜¯ï¼Œæˆ‘ä»¬å†™å‡ºï¼ˆç®€å•èµ·è§ï¼Œ$\boldsymbol{\varphi}<em _boldsymbol_x="\boldsymbol{x">t(\boldsymbol{x}_0,\boldsymbol{x}_T)$ç®€å†™ä¸º$\boldsymbol{\varphi}_t$ï¼‰<br />
\begin{equation}\begin{aligned}
\mathbb{E}</em><em t="t" t_Delta="t+\Delta">{t+\Delta t}}\left[\phi(\boldsymbol{x}</em>})\right] =&amp;\, \mathbb{E<em t="t" t_Delta="t+\Delta">{\boldsymbol{x}_0, \boldsymbol{x}_T}\left[\phi(\boldsymbol{\varphi}</em>)\right] \\
=&amp;\, \mathbb{E}<em _boldsymbol_varphi="\boldsymbol{\varphi">{\boldsymbol{x}_0, \boldsymbol{x}_T}\left[\phi(\boldsymbol{\varphi}_t) + \Delta t\,\frac{\partial \boldsymbol{\varphi}_t}{\partial t}\cdot\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\phi(\boldsymbol{\varphi}_t)\right] \\
=&amp;\, \mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">0, \boldsymbol{x}_T}\left[\phi(\boldsymbol{x}_t)\right] + \Delta t\,\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">0, \boldsymbol{x}_T}\left[\frac{\partial \boldsymbol{\varphi}_t}{\partial t}\cdot\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\phi(\boldsymbol{x}_t)\right] \\
=&amp;\, \mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">t}\left[\phi(\boldsymbol{x}_t)\right] + \Delta t\,\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">0, \boldsymbol{x}_T}\left[\frac{\partial \boldsymbol{\varphi}_t}{\partial t}\cdot\nabla</em>_t)\right] \\}_t}\phi(\boldsymbol{x
\end{aligned}\end{equation}<br />
å…¶ä¸­ç¬¬ä¸€ä¸ªç­‰å·æ˜¯å› ä¸ºå¼$\eqref{eq:track}$ï¼Œç¬¬äºŒä¸ªç­‰å·æ˜¯æ³°å‹’å±•å¼€åˆ°ä¸€é˜¶ï¼Œç¬¬ä¸‰ä¸ªç­‰å·åŒæ ·æ˜¯å¼$\eqref{eq:track}$ï¼Œç¬¬å››ä¸ªç­‰å·å°±æ˜¯å› ä¸º$\boldsymbol{x}_t$æ˜¯$\boldsymbol{x}_0,\boldsymbol{x}_T$çš„ç¡®å®šæ€§å‡½æ•°ï¼Œæ‰€ä»¥å…³äº$\boldsymbol{x}_0,\boldsymbol{x}_T$çš„æœŸæœ›å°±æ˜¯å…³äº$\boldsymbol{x}_t$çš„æœŸæœ›ã€‚</p>
<p>æˆ‘ä»¬çœ‹åˆ°ï¼Œ$\frac{\partial \boldsymbol{\varphi}<em _boldsymbol_x="\boldsymbol{x">t}{\partial t}$æ˜¯$\boldsymbol{x}_0,\boldsymbol{x}_T$çš„å‡½æ•°ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†åšä¸€ä¸ªå‡è®¾ï¼š<strong>å¼$\eqref{eq:track}$å…³äº$\boldsymbol{x}_T$æ˜¯å¯é€†çš„ã€‚</strong> è¿™ä¸ªå‡è®¾æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä»å¼$\eqref{eq:track}$ä¸­è§£å‡º$\boldsymbol{x}_T=\boldsymbol{\psi}_t(\boldsymbol{x}_0,\boldsymbol{x}_t)$ï¼Œè¿™ä¸ªç»“æœå¯ä»¥ä»£å…¥$\frac{\partial \boldsymbol{\varphi}_t}{\partial t}$ï¼Œä½¿å®ƒå˜ä¸º$\boldsymbol{x}_0,\boldsymbol{x}_t$çš„å‡½æ•°ã€‚æ‰€ä»¥æˆ‘ä»¬æœ‰<br />
\begin{equation}\begin{aligned}
\mathbb{E}</em><em t="t" t_Delta="t+\Delta">{t+\Delta t}}\left[\phi(\boldsymbol{x}</em>})\right] =&amp;\, \mathbb{E<em _boldsymbol_x="\boldsymbol{x">{\boldsymbol{x}_t}\left[\phi(\boldsymbol{x}_t)\right] + \Delta t\,\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">0, \boldsymbol{x}_T}\left[\frac{\partial \boldsymbol{\varphi}_t}{\partial t}\cdot\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\phi(\boldsymbol{x}_t)\right] \\
=&amp;\, \mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">t}\left[\phi(\boldsymbol{x}_t)\right] + \Delta t\,\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">0, \boldsymbol{x}_t}\left[\frac{\partial \boldsymbol{\varphi}_t}{\partial t}\cdot\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\phi(\boldsymbol{x}_t)\right] \\
=&amp;\, \mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">t}\left[\phi(\boldsymbol{x}_t)\right] + \Delta t\,\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">t}\left[\underbrace{\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">0|\boldsymbol{x}_t}\left[\frac{\partial \boldsymbol{\varphi}_t}{\partial t}\right]}</em><em _boldsymbol_x="\boldsymbol{x">t\text{çš„å‡½æ•°}}\cdot\nabla</em><em _boldsymbol_x="\boldsymbol{x">t}\phi(\boldsymbol{x}_t)\right] \\
=&amp;\, \mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">t}\left[\phi\left(\boldsymbol{x}_t + \Delta t\,\mathbb{E}</em>\right]\right)\right]}_0|\boldsymbol{x}_t}\left[\frac{\partial \boldsymbol{\varphi}_t}{\partial t
\end{aligned}\end{equation}<br />
å…¶ä¸­ç¬¬äºŒä¸ªç­‰å·æ˜¯å› ä¸º$\frac{\partial \boldsymbol{\varphi}_t}{\partial t}$å·²ç»æ”¹ä¸º$\boldsymbol{x}_0,\boldsymbol{x}_t$çš„å‡½æ•°ï¼Œæ‰€ä»¥ç¬¬äºŒé¡¹æœŸæœ›çš„éšæœºå˜é‡æ”¹ä¸º$\boldsymbol{x}_0,\boldsymbol{x}_t$ï¼›ç¬¬ä¸‰ä¸ªç­‰å·åˆ™æ˜¯ç›¸å½“äºåšäº†åˆ†è§£$p(\boldsymbol{x}_0,\boldsymbol{x}_t)=p(\boldsymbol{x}_0|\boldsymbol{x}_t)p(\boldsymbol{x}_t)$ï¼Œæ­¤æ—¶$\boldsymbol{x}_0,\boldsymbol{x}_t$ä¸æ˜¯ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥è¦æ³¨æ˜$\boldsymbol{x}_0|\boldsymbol{x}_t$ï¼Œå³$\boldsymbol{x}_0$æ˜¯ä¾èµ–äº$\boldsymbol{x}_t$çš„ã€‚æ³¨æ„$\frac{\partial \boldsymbol{\varphi}_t}{\partial t}$åŸæœ¬æ˜¯$\boldsymbol{x}_0,\boldsymbol{x}_t$çš„å‡½æ•°ï¼Œç°åœ¨å¯¹$\boldsymbol{x}_0$æ±‚æœŸæœ›åï¼Œå‰©ä¸‹çš„å”¯ä¸€è‡ªå˜é‡å°±æ˜¯$\boldsymbol{x}_t$ï¼Œåé¢æˆ‘ä»¬ä¼šçœ‹åˆ°å®ƒå°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„çº¯ç²¹æ˜¯$\boldsymbol{x}_t$çš„å‡½æ•°ï¼ç¬¬å››ä¸ªç­‰å·ï¼Œå°±æ˜¯åˆ©ç”¨æ³°å‹’å±•å¼€å…¬å¼å°†ä¸¤é¡¹é‡æ–°åˆå¹¶èµ·æ¥ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¾—åˆ°äº†<br />
\begin{equation}\mathbb{E}<em t="t" t_Delta="t+\Delta">{\boldsymbol{x}</em>}}\left[\phi(\boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">{t+\Delta t})\right] = \mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">t}\left[\phi\left(\boldsymbol{x}_t + \Delta t\,\mathbb{E}</em><em t="t" t_Delta="t+\Delta">0|\boldsymbol{x}_t}\left[\frac{\partial \boldsymbol{\varphi}_t}{\partial t}\right]\right)\right]\end{equation}<br />
å¯¹äºä»»æ„æµ‹è¯•å‡½æ•°$\phi$æˆç«‹ï¼Œæ‰€ä»¥è¿™æ„å‘³ç€<br />
\begin{equation}\boldsymbol{x}</em>} = \boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">t + \Delta t\,\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">0|\boldsymbol{x}_t}\left[\frac{\partial \boldsymbol{\varphi}_t}{\partial t}\right]\quad\Rightarrow\quad\frac{d\boldsymbol{x}_t}{dt} = \mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">0|\boldsymbol{x}_t}\left[\frac{\partial \boldsymbol{\varphi}_t}{\partial t}\right]\label{eq:real-ode}\end{equation}<br />
å°±æ˜¯æˆ‘ä»¬è¦å¯»æ‰¾çš„ODEã€‚æ ¹æ®<br />
\begin{equation}\mathbb{E}</em>}}[\boldsymbol{x}] = \mathop{\text{argmin}<em _boldsymbol_x="\boldsymbol{x">{\boldsymbol{\mu}}\mathbb{E}</em>}}\left[\Vert \boldsymbol{x} - \boldsymbol{\mu}\Vert^2\right]\label{eq:mean-opt}\end{equation
å¼$\eqref{eq:real-ode}$çš„å³ç«¯æ­£å¥½æ˜¯è®­ç»ƒç›®æ ‡$\eqref{eq:objective}$çš„æœ€ä¼˜è§£ï¼Œè¿™å°±è¯æ˜äº†ä¼˜åŒ–è®­ç»ƒç›®æ ‡$\eqref{eq:objective}$å¾—å‡ºçš„æ–¹ç¨‹$\eqref{eq:s-ode}$çš„ç¡®å®ç°äº†åˆ†å¸ƒ$p_T(\boldsymbol{x}_T)$ã€$p_0(\boldsymbol{x}_0)$ä¹‹é—´çš„å˜æ¢ã€‚</p>
<h2 id="_5">è¯»åæ„Ÿå—<a class="toc-link" href="#_5" title="Permanent link">&para;</a></h2>
<p>å…³äºâ€œç›´è§‚ç»“æœâ€ä¸­çš„æ„å»ºæ‰©æ•£ODEçš„æ€è·¯ï¼ŒåŸè®ºæ–‡çš„ä½œè€…è¿˜å†™äº†ç¯‡çŸ¥ä¹ä¸“æ æ–‡ç« <a href="https://zhuanlan.zhihu.com/p/603740431">ã€Š[ICLR2023] æ‰©æ•£ç”Ÿæˆæ¨¡å‹æ–°æ–¹æ³•ï¼šæåº¦ç®€åŒ–ï¼Œä¸€æ­¥ç”Ÿæˆã€‹</a>ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥å»è¯»è¯»ã€‚è¯»è€…ä¹Ÿæ˜¯åœ¨è¿™ç¯‡ä¸“æ ä¸­é¦–æ¬¡äº†è§£åˆ°è¯¥æ–¹æ³•çš„ï¼Œå¹¶æ·±æ·±ä¸ºä¹‹éœ‡æƒŠå’Œå¹æœã€‚</p>
<p>å¦‚æœè¯»è€…è¯»è¿‡<a href="/archives/9379">ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆåå››ï¼‰ï¼šæ„å»ºODEçš„ä¸€èˆ¬æ­¥éª¤ï¼ˆä¸­ï¼‰ã€‹</a>ï¼Œé‚£ä¹ˆå°±ä¼šæ›´åŠ ä½“ä¼šåˆ°è¯¥æ€è·¯çš„ç®€å•ç›´æ¥ï¼Œä¹Ÿæ›´èƒ½ç†è§£ç¬”è€…ä¸ºä½•å¦‚æ­¤ä¸åèµç¾ä¹‹è¯ã€‚ä¸æ€•å¤§å®¶ç¬‘è¯ï¼Œç¬”è€…åœ¨å†™â€œä¸­ç¯‡â€ï¼ˆå½“æ—¶çš„â€œä¸‹ç¯‡â€ï¼‰çš„æ—¶å€™ï¼Œæ˜¯è€ƒè™‘è¿‡å¼$\eqref{eq:track}$æ‰€æè¿°çš„è½¨è¿¹çš„ï¼Œä½†æ˜¯åœ¨å½“æ—¶çš„æ¡†æ¶ä¸‹ï¼Œæ ¹æœ¬æ²¡æ³•æ¨æ¼”ä¸‹å»ï¼Œæœ€åä»¥å¤±è´¥å‘Šç»ˆï¼Œå½“æ—¶å®Œå…¨æƒ³ä¸åˆ°å®ƒèƒ½ä»¥ä¸€ç§å¦‚æ­¤ç®€æ·çš„æ–¹å¼è¿›è¡Œä¸‹å»ã€‚æ‰€ä»¥ï¼Œå†™è¿™ä¸ªæ‰©æ•£ODEç³»åˆ—çœŸçš„è®©äººæœ‰ç§â€œäººæ¯”äººï¼Œæ°”æ­»äººâ€çš„æ„Ÿè§‰ï¼Œâ€œä¸­ç¯‡â€ã€â€œä¸‹ç¯‡â€å°±æ˜¯è‡ªå·±æ™ºå•†è¢«ä¸€æ¬¡æ¬¡â€œé™ç»´æ‰“å‡»â€çš„æœ€å¥½è§è¯ã€‚</p>
<p>è¯»è€…å¯èƒ½æƒ³é—®ï¼Œè¿˜ä¼šä¸ä¼šæœ‰æ›´ç®€å•çš„ç¬¬å››ç¯‡ï¼Œè®©ç¬”è€…å†ä¸€æ¬¡ç»å†é™ç»´æ‰“å‡»ï¼Ÿå¯èƒ½æœ‰ï¼Œä½†æ¦‚ç‡çœŸçš„å¾ˆå°äº†ï¼ŒçœŸçš„å¾ˆéš¾æƒ³è±¡ä¼šæœ‰æ¯”è¿™æ›´ç®€å•çš„æ„å»ºæ­¥éª¤äº†ã€‚â€œç›´è§‚ç»“æœâ€ä¸€èŠ‚çœ‹ä¸Šå»å¾ˆé•¿ï¼Œä½†å®é™…æ­¥éª¤å°±åªæœ‰ä¸¤æ­¥ï¼š1ã€éšä¾¿é€‰æ‹©ä¸€ä¸ªæ¸å˜è½¨è¿¹ï¼›2ã€ç”¨$\boldsymbol{x}_t$çš„å‡½æ•°å»é€¼è¿‘æ¸å˜è½¨è¿¹å¯¹$t$çš„å¯¼æ•°ã€‚å°±è¿™æ ·çš„å¯¥å¯¥ä¸¤æ­¥ï¼Œè¿˜èƒ½æ€ä¹ˆå†ç®€åŒ–å‘¢ï¼Ÿç”šè‡³è¯´ï¼Œâ€œè¯æ˜è¿‡ç¨‹â€ä¸€èŠ‚çš„æ¨å¯¼ä¹Ÿæ˜¯ç›¸å½“ç®€å•çš„äº†ï¼Œè™½ç„¶å†™å¾—é•¿ï¼Œä½†æœ¬è´¨å°±æ˜¯æ±‚ä¸ªå¯¼ï¼Œç„¶åå˜æ¢ä¸€ä¸‹æ±‚æœŸæœ›çš„åˆ†å¸ƒï¼Œæ¯”å‰ä¸¤ç¯‡çš„è¿‡ç¨‹ç®€å•äº†å¯ä¸æ­¢ä¸€ä¸åŠç‚¹ã€‚æ€»è€Œè¨€ä¹‹ï¼Œäº²è‡ªå®Œæˆè¿‡ODEæ‰©æ•£çš„å‰ä¸¤ç¯‡æ¨å¯¼çš„è¯»è€…å°±èƒ½æ·±åˆ»æ„Ÿè§‰åˆ°ï¼Œè¿™ä¸€ç¯‡çš„æ€è·¯æ˜¯çœŸçš„ç®€å•ï¼Œç®€å•åˆ°è®©æˆ‘ä»¬è§‰å¾—å·²ç»æ— æ³•å†ç®€å•äº†ã€‚</p>
<p>æ­¤å¤–ï¼Œé™¤äº†æä¾›æ„å»ºæ‰©æ•£ODEçš„ç®€å•æ€è·¯å¤–ï¼ŒåŸè®ºæ–‡è¿˜è®¨è®ºäº†Rectified Flowè·Ÿæœ€ä¼˜ä¼ è¾“ä¹‹é—´çš„è”ç³»ï¼Œä»¥åŠå¦‚ä½•ç”¨è¿™ç§è”ç³»æ¥åŠ é€Ÿé‡‡æ ·è¿‡ç¨‹ï¼Œç­‰ç­‰ã€‚ä½†è¿™éƒ¨åˆ†å†…å®¹å¹¶ä¸æ˜¯æœ¬æ–‡ä¸»è¦å…³å¿ƒçš„ï¼Œæ‰€ä»¥ç­‰ä»¥åæœ‰æœºä¼šæˆ‘ä»¬å†è®¨è®ºå®ƒä»¬ã€‚</p>
<h2 id="_6">æ–‡ç« å°ç»“<a class="toc-link" href="#_6" title="Permanent link">&para;</a></h2>
<p>æœ¬æ–‡ä»‹ç»äº†Rectified Flowä¸€æ–‡ä¸­æå‡ºçš„æ„å»ºODEå¼æ‰©æ•£æ¨¡å‹çš„ä¸€ç§æå…¶ç®€å•ç›´è§‚çš„æ€è·¯ï¼Œå¹¶ç»™å‡ºäº†è‡ªå·±çš„è¯æ˜è¿‡ç¨‹ã€‚</p>
<p><em><strong>è½¬è½½åˆ°è¯·åŒ…æ‹¬æœ¬æ–‡åœ°å€ï¼š</strong><a href="https://spaces.ac.cn/archives/9497">https://spaces.ac.cn/archives/9497</a></em></p>
<p><em><strong>æ›´è¯¦ç»†çš„è½¬è½½äº‹å®œè¯·å‚è€ƒï¼š</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="ã€Šç§‘å­¦ç©ºé—´FAQã€‹">ã€Šç§‘å­¦ç©ºé—´FAQã€‹</a></p>
<p><strong>å¦‚æœæ‚¨è¿˜æœ‰ä»€ä¹ˆç–‘æƒ‘æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹è¯„è®ºåŒºç»§ç»­è®¨è®ºã€‚</strong></p>
<p><strong>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡è¿˜ä¸é”™ï¼Œæ¬¢è¿åˆ†äº«/æ‰“èµæœ¬æ–‡ã€‚æ‰“èµå¹¶éè¦ä»ä¸­è·å¾—æ”¶ç›Šï¼Œè€Œæ˜¯å¸Œæœ›çŸ¥é“ç§‘å­¦ç©ºé—´è·å¾—äº†å¤šå°‘è¯»è€…çš„çœŸå¿ƒå…³æ³¨ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ— è§†å®ƒï¼Œä¹Ÿä¸ä¼šå½±å“ä½ çš„é˜…è¯»ã€‚å†æ¬¡è¡¨ç¤ºæ¬¢è¿å’Œæ„Ÿè°¢ï¼</strong></p>
<p>æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>å¾®ä¿¡æ‰“èµ</p>
<p><img alt="ç§‘å­¦ç©ºé—´" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>æ”¯ä»˜å®æ‰“èµ</p>
<p>å› ä¸ºç½‘ç«™åå°å¯¹æ‰“èµå¹¶æ— è®°å½•ï¼Œå› æ­¤æ¬¢è¿åœ¨æ‰“èµæ—¶å€™å¤‡æ³¨ç•™è¨€ã€‚ä½ è¿˜å¯ä»¥<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>ç‚¹å‡»è¿™é‡Œ</strong></a>æˆ–åœ¨ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€æ¥å‘ŠçŸ¥ä½ çš„å»ºè®®æˆ–éœ€æ±‚ã€‚</p>
<p><strong>å¦‚æœæ‚¨éœ€è¦å¼•ç”¨æœ¬æ–‡ï¼Œè¯·å‚è€ƒï¼š</strong></p>
<p>è‹å‰‘æ—. (Feb. 23, 2023). ã€Šç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆåä¸ƒï¼‰ï¼šæ„å»ºODEçš„ä¸€èˆ¬æ­¥éª¤ï¼ˆä¸‹ï¼‰ ã€‹[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/9497">https://spaces.ac.cn/archives/9497</a></p>
<p>@online{kexuefm-9497,<br />
title={ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆåä¸ƒï¼‰ï¼šæ„å»ºODEçš„ä¸€èˆ¬æ­¥éª¤ï¼ˆä¸‹ï¼‰},<br />
author={è‹å‰‘æ—},<br />
year={2023},<br />
month={Feb},<br />
url={\url{https://spaces.ac.cn/archives/9497}},<br />
} </p>
<hr />
<h2 id="_7">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š<a class="toc-link" href="#_7" title="Permanent link">&para;</a></h2>
<h3 id="1-ode">1. ä»æ ¼æ—å‡½æ•°åˆ°ODEçš„æå–æ–¹æ³•<a class="toc-link" href="#1-ode" title="Permanent link">&para;</a></h3>
<p>åœ¨ç†è§£Rectified Flowä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä»æ›´åŸºç¡€çš„è§’åº¦ç†è§£å¦‚ä½•ä»æ¦‚ç‡æ¼”åŒ–ä¸­æå–ODEã€‚è€ƒè™‘ä¸€ä¸ªæ—¶é—´ä¾èµ–çš„æ¦‚ç‡å¯†åº¦$p_t(\boldsymbol{x})$ï¼Œå®ƒæ»¡è¶³ä»$t=0$åˆ°$t=T$çš„æ¼”åŒ–ã€‚</p>
<p><strong>æ ¼æ—å‡½æ•°çš„å®šä¹‰</strong>ï¼šç»™å®šåˆå§‹åˆ†å¸ƒ$p_0(\boldsymbol{x}_0)$å’Œç»ˆæ­¢åˆ†å¸ƒ$p_T(\boldsymbol{x}_T)$ï¼Œæˆ‘ä»¬å®šä¹‰æ ¼æ—å‡½æ•°ï¼ˆè½¬ç§»æ ¸ï¼‰$G_t(\boldsymbol{x}_t|\boldsymbol{x}_0)$ä¸ºï¼š
$$p_t(\boldsymbol{x}_t) = \int p_0(\boldsymbol{x}_0) G_t(\boldsymbol{x}_t|\boldsymbol{x}_0) d\boldsymbol{x}_0$$</p>
<p>å¯¹äºç¡®å®šæ€§çš„ODEæ¼”åŒ–$\frac{d\boldsymbol{x}_t}{dt} = \boldsymbol{f}_t(\boldsymbol{x}_t)$ï¼Œæ ¼æ—å‡½æ•°é€€åŒ–ä¸ºdeltaå‡½æ•°ï¼š
$$G_t(\boldsymbol{x}_t|\boldsymbol{x}_0) = \delta(\boldsymbol{x}_t - \boldsymbol{\Phi}_t(\boldsymbol{x}_0))$$
å…¶ä¸­$\boldsymbol{\Phi}_t$æ˜¯ODEçš„æµæ˜ å°„ï¼ˆflow mapï¼‰ï¼Œæ»¡è¶³ï¼š
$$\boldsymbol{\Phi}_t(\boldsymbol{x}_0) = \boldsymbol{x}_0 + \int_0^t \boldsymbol{f}_s(\boldsymbol{\Phi}_s(\boldsymbol{x}_0)) ds$$</p>
<p><strong>Chapman-Kolmogorovæ–¹ç¨‹</strong>ï¼šæ ¼æ—å‡½æ•°æ»¡è¶³åŠç¾¤æ€§è´¨ï¼š
$$G_t(\boldsymbol{x}_t|\boldsymbol{x}_0) = \int G_t(\boldsymbol{x}_t|\boldsymbol{x}_s) G_s(\boldsymbol{x}_s|\boldsymbol{x}_0) d\boldsymbol{x}_s, \quad 0 \leq s \leq t$$</p>
<p>å¯¹äºç¡®å®šæ€§ODEï¼Œè¿™ç®€åŒ–ä¸ºï¼š
$$\boldsymbol{\Phi}<em t-s="t-s">t(\boldsymbol{x}_0) = \boldsymbol{\Phi}_t(\boldsymbol{\Phi}_s(\boldsymbol{x}_0)) = \boldsymbol{\Phi}</em>_0))$$}(\boldsymbol{\Phi}_s(\boldsymbol{x</p>
<p><strong>ä»æ ¼æ—å‡½æ•°æå–é€Ÿåº¦åœº</strong>ï¼šå…³é”®è§‚å¯Ÿæ˜¯ï¼Œå¯¹äºå……åˆ†å°çš„$\Delta t$ï¼š
$$G_{t+\Delta t}(\boldsymbol{x}<em t="t" t_Delta="t+\Delta">{t+\Delta t}|\boldsymbol{x}_t) \approx \delta(\boldsymbol{x}</em>_t)\Delta t)$$} - \boldsymbol{x}_t - \boldsymbol{f}_t(\boldsymbol{x</p>
<p>è¿™æ„å‘³ç€ï¼š
$$\mathbb{E}[\boldsymbol{x}_{t+\Delta t}|\boldsymbol{x}_t] = \boldsymbol{x}_t + \boldsymbol{f}_t(\boldsymbol{x}_t)\Delta t + O(\Delta t^2)$$</p>
<p>å› æ­¤é€Ÿåº¦åœºå¯ä»¥é€šè¿‡æ¡ä»¶æœŸæœ›æå–ï¼š
$$\boldsymbol{f}<em 0="0" _Delta="\Delta" _to="\to" t="t">t(\boldsymbol{x}_t) = \lim</em>} \frac{\mathbb{E}[\boldsymbol{x<em t="t">{t+\Delta t}|\boldsymbol{x}_t] - \boldsymbol{x}_t}{\Delta t} = \frac{d}{dt}\mathbb{E}[\boldsymbol{x}_t|\boldsymbol{x}_t]|</em>$$</p>
<h3 id="2">2. æ¦‚ç‡å¯†åº¦æ¼”åŒ–çš„è·¯å¾„ç§¯åˆ†è¡¨ç¤º<a class="toc-link" href="#2" title="Permanent link">&para;</a></h3>
<p>ä¸ºäº†ç†è§£Rectified Flowçš„æ·±å±‚åŸç†ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥è·¯å¾„ç§¯åˆ†çš„è§†è§’ã€‚</p>
<p><strong>è·¯å¾„ç©ºé—´çš„å®šä¹‰</strong>ï¼šå®šä¹‰ä»$0$åˆ°$T$çš„æ‰€æœ‰è¿ç»­è·¯å¾„ç©ºé—´ä¸ºï¼š
$$\mathcal{C}([0,T], \mathbb{R}^d) = {\boldsymbol{\gamma}: [0,T] \to \mathbb{R}^d \mid \boldsymbol{\gamma} \text{ è¿ç»­}}$$</p>
<p><strong>è·¯å¾„æµ‹åº¦</strong>ï¼šç»™å®šåˆæœ«æ€$\boldsymbol{x}<em _0_T_="[0,T]" _in="\in" t="t">0, \boldsymbol{x}_T$ï¼Œä»¥åŠè½¨è¿¹å‡½æ•°$\boldsymbol{\varphi}_t(\boldsymbol{x}_0, \boldsymbol{x}_T)$ï¼Œæˆ‘ä»¬å®šä¹‰è·¯å¾„æµ‹åº¦ï¼š
$$d\mu[\boldsymbol{\gamma}] = \delta(\boldsymbol{\gamma}_0 - \boldsymbol{x}_0)\delta(\boldsymbol{\gamma}_T - \boldsymbol{x}_T) \prod</em>$$} \delta(\boldsymbol{\gamma}_t - \boldsymbol{\varphi}_t(\boldsymbol{x}_0, \boldsymbol{x}_T)) \mathcal{D}\boldsymbol{\gamma</p>
<p>å…¶ä¸­$\mathcal{D}\boldsymbol{\gamma}$æ˜¯è·¯å¾„ç§¯åˆ†æµ‹åº¦ã€‚</p>
<p><strong>è¾¹é™…åˆ†å¸ƒçš„è·¯å¾„ç§¯åˆ†è¡¨ç¤º</strong>ï¼šä»»æ„æ—¶åˆ»$t$çš„è¾¹é™…åˆ†å¸ƒå¯ä»¥è¡¨ç¤ºä¸ºï¼š
$$p_t(\boldsymbol{x}_t) = \int \int p_0(\boldsymbol{x}_0) p_T(\boldsymbol{x}_T) \delta(\boldsymbol{x}_t - \boldsymbol{\varphi}_t(\boldsymbol{x}_0, \boldsymbol{x}_T)) d\boldsymbol{x}_0 d\boldsymbol{x}_T$$</p>
<p>è¿™ä¸ªå…¬å¼çš„æ„ä¹‰æ˜¯ï¼š$\boldsymbol{x}_t$çš„åˆ†å¸ƒç”±æ‰€æœ‰ç»è¿‡$\boldsymbol{x}_t$çš„è·¯å¾„çš„åˆæœ«æ€åˆ†å¸ƒç§¯åˆ†è€Œæ¥ã€‚</p>
<p><strong>é€Ÿåº¦åœºçš„è·¯å¾„ç§¯åˆ†è¡¨ç¤º</strong>ï¼šæ ¹æ®è½¨è¿¹çš„å®šä¹‰ï¼Œé€Ÿåº¦åœºä¸ºï¼š
$$\boldsymbol{v}_t(\boldsymbol{x}_0, \boldsymbol{x}_T) = \frac{\partial \boldsymbol{\varphi}_t(\boldsymbol{x}_0, \boldsymbol{x}_T)}{\partial t}$$</p>
<p>ä½†è¿™ä¸ªé€Ÿåº¦åœºä¾èµ–äº$(\boldsymbol{x}<em _boldsymbol_x="(\boldsymbol{x">0, \boldsymbol{x}_T)$ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶"æŠ•å½±"åˆ°åªä¾èµ–äº$\boldsymbol{x}_t$çš„ç©ºé—´ã€‚è¿™ä¸ªæŠ•å½±é€šè¿‡æ¡ä»¶æœŸæœ›å®ç°ï¼š
$$\boldsymbol{v}_t^*(\boldsymbol{x}_t) = \mathbb{E}</em>\right]$$}_0,\boldsymbol{x}_T)|\boldsymbol{x}_t}\left[\frac{\partial \boldsymbol{\varphi}_t(\boldsymbol{x}_0, \boldsymbol{x}_T)}{\partial t</p>
<p><strong>è·¯å¾„ç§¯åˆ†çš„æ˜¾å¼å½¢å¼</strong>ï¼šä½¿ç”¨è´å¶æ–¯å…¬å¼ï¼Œæˆ‘ä»¬æœ‰ï¼š
$$\boldsymbol{v}_t^*(\boldsymbol{x}_t) = \frac{\int \int p_0(\boldsymbol{x}_0) p_T(\boldsymbol{x}_T) \frac{\partial \boldsymbol{\varphi}_t}{\partial t} \delta(\boldsymbol{x}_t - \boldsymbol{\varphi}_t) d\boldsymbol{x}_0 d\boldsymbol{x}_T}{\int \int p_0(\boldsymbol{x}_0) p_T(\boldsymbol{x}_T) \delta(\boldsymbol{x}_t - \boldsymbol{\varphi}_t) d\boldsymbol{x}_0 d\boldsymbol{x}_T}$$</p>
<p>åˆ†æ¯æ˜¯è¾¹é™…åˆ†å¸ƒ$p_t(\boldsymbol{x}_t)$ï¼Œåˆ†å­å®šä¹‰äº†ä¸€ä¸ª"åŠ æƒé€Ÿåº¦åœº"ã€‚</p>
<h3 id="3-time-marginalization">3. æ—¶é—´è¾¹é™…åŒ–ï¼ˆTime Marginalizationï¼‰<a class="toc-link" href="#3-time-marginalization" title="Permanent link">&para;</a></h3>
<p>æ—¶é—´è¾¹é™…åŒ–æ˜¯ç†è§£Rectified Flowè®­ç»ƒè¿‡ç¨‹çš„å…³é”®ã€‚</p>
<p><strong>è”åˆåˆ†å¸ƒçš„æ„é€ </strong>ï¼šå®šä¹‰å››å…ƒç»„$(\boldsymbol{x}_0, \boldsymbol{x}_T, \boldsymbol{x}_t, t)$çš„è”åˆåˆ†å¸ƒï¼š
$$p(\boldsymbol{x}_0, \boldsymbol{x}_T, \boldsymbol{x}_t, t) = p_0(\boldsymbol{x}_0) p_T(\boldsymbol{x}_T) p(t) \delta(\boldsymbol{x}_t - \boldsymbol{\varphi}_t(\boldsymbol{x}_0, \boldsymbol{x}_T))$$</p>
<p>å…¶ä¸­$p(t)$æ˜¯æ—¶é—´çš„å…ˆéªŒåˆ†å¸ƒï¼Œé€šå¸¸å–å‡åŒ€åˆ†å¸ƒ$p(t) = \frac{1}{T}$ï¼ˆå‡è®¾$T=1$åˆ™$p(t)=1$ï¼‰ã€‚</p>
<p><strong>è®­ç»ƒç›®æ ‡çš„å®Œæ•´å½¢å¼</strong>ï¼šRectified Flowçš„è®­ç»ƒç›®æ ‡å¼$\eqref{eq:objective}$å¯ä»¥é‡å†™ä¸ºï¼š
$$\begin{aligned}
\mathcal{L}(\boldsymbol{\theta}) &amp;= \int_0^T \mathbb{E}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{x}_0,\boldsymbol{x}_T,\boldsymbol{x}_t}\left[\left\Vert \boldsymbol{v}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, t) - \frac{\partial \boldsymbol{\varphi}_t}{\partial t}\right\Vert^2\right] p(t) dt \
&amp;= \int_0^T \int \int \int p_0(\boldsymbol{x}_0) p_T(\boldsymbol{x}_T) \delta(\boldsymbol{x}_t - \boldsymbol{\varphi}_t) \left\Vert \boldsymbol{v}</em>_t \, dt
\end{aligned}$$}}(\boldsymbol{x}_t, t) - \frac{\partial \boldsymbol{\varphi}_t}{\partial t}\right\Vert^2 d\boldsymbol{x}_0 d\boldsymbol{x}_T d\boldsymbol{x</p>
<p><strong>å¯¹æ—¶é—´çš„è¾¹é™…åŒ–</strong>ï¼šå…³é”®è§‚å¯Ÿæ˜¯ï¼Œæœ€ä¼˜è§£$\boldsymbol{v}<em _boldsymbol_v="\boldsymbol{v">{\boldsymbol{\theta}}^<em>$åœ¨æ¯ä¸ªæ—¶åˆ»$t$éƒ½æ˜¯ç‹¬ç«‹ä¼˜åŒ–çš„ï¼š
$$\boldsymbol{v}_{\boldsymbol{\theta}}^</em>(\boldsymbol{x}_t, t) = \mathop{\text{argmin}}</em>\right\Vert^2\right]$$}} \mathbb{E}_{\boldsymbol{x}_0,\boldsymbol{x}_T|\boldsymbol{x}_t}\left[\left\Vert \boldsymbol{v} - \frac{\partial \boldsymbol{\varphi}_t}{\partial t</p>
<p>æ ¹æ®æœ€å°äºŒä¹˜æ³•çš„æ€§è´¨ï¼ˆå¼$\eqref{eq:mean-opt}$ï¼‰ï¼Œæœ€ä¼˜è§£ä¸ºæ¡ä»¶æœŸæœ›ï¼š
$$\boldsymbol{v}<em _boldsymbol_x="\boldsymbol{x">{\boldsymbol{\theta}}^*(\boldsymbol{x}_t, t) = \mathbb{E}</em>\right]$$}_0,\boldsymbol{x}_T|\boldsymbol{x}_t}\left[\frac{\partial \boldsymbol{\varphi}_t}{\partial t</p>
<p>ä½†æ³¨æ„åˆ°$\boldsymbol{x}<em _boldsymbol_x="\boldsymbol{x">t = \boldsymbol{\varphi}_t(\boldsymbol{x}_0, \boldsymbol{x}_T)$ï¼Œå¦‚æœ$\boldsymbol{\varphi}_t$å…³äº$\boldsymbol{x}_T$å¯é€†ï¼Œæˆ‘ä»¬å¯ä»¥ä»$(\boldsymbol{x}_t, \boldsymbol{x}_0)$å”¯ä¸€ç¡®å®š$\boldsymbol{x}_T$ï¼Œå› æ­¤ï¼š
$$\mathbb{E}</em><em _boldsymbol_x="\boldsymbol{x">0,\boldsymbol{x}_T|\boldsymbol{x}_t}\left[\frac{\partial \boldsymbol{\varphi}_t}{\partial t}\right] = \mathbb{E}</em>\right]$$}_0|\boldsymbol{x}_t}\left[\frac{\partial \boldsymbol{\varphi}_t}{\partial t</p>
<p>è¿™æ­£æ˜¯å¼$\eqref{eq:real-ode}$çš„ç»“æœã€‚</p>
<p><strong>æ—¶é—´è¾¹é™…åŒ–çš„å‡ ä½•æ„ä¹‰</strong>ï¼šä»å‡ ä½•è§’åº¦çœ‹ï¼Œæ—¶é—´è¾¹é™…åŒ–æ„å‘³ç€æˆ‘ä»¬åœ¨æ‰€æœ‰æ—¶åˆ»$t \in [0,T]$ä¸Šå¹³å‡åœ°è®­ç»ƒé€Ÿåº¦åœºã€‚è¿™ç¡®ä¿äº†å­¦åˆ°çš„ODEåœ¨æ•´ä¸ªæ—¶é—´åŒºé—´ä¸Šéƒ½æœ‰è‰¯å¥½çš„æ€§èƒ½ã€‚</p>
<h3 id="4-optimal-transport">4. æœ€ä¼˜ä¼ è¾“ï¼ˆOptimal Transportï¼‰è§†è§’<a class="toc-link" href="#4-optimal-transport" title="Permanent link">&para;</a></h3>
<p>Rectified Flowä¸æœ€ä¼˜ä¼ è¾“ç†è®ºæœ‰æ·±åˆ»çš„è”ç³»ã€‚</p>
<p><strong>Mongeé—®é¢˜</strong>ï¼šç»™å®šä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒ$p_0, p_T$ï¼ŒMongeæœ€ä¼˜ä¼ è¾“é—®é¢˜æ˜¯æ‰¾ä¸€ä¸ªä¼ è¾“æ˜ å°„$T: \mathbb{R}^d \to \mathbb{R}^d$ä½¿å¾—ï¼š
$$T_# p_0 = p_T$$
å³$p_T(\boldsymbol{y}) = \int p_0(\boldsymbol{x}) \delta(\boldsymbol{y} - T(\boldsymbol{x})) d\boldsymbol{x}$ï¼Œå¹¶æœ€å°åŒ–ä¼ è¾“ä»£ä»·ï¼š
$$\inf_{T: T_# p_0 = p_T} \mathbb{E}_{\boldsymbol{x}_0 \sim p_0}[c(\boldsymbol{x}_0, T(\boldsymbol{x}_0))]$$</p>
<p>å¯¹äºäºŒæ¬¡ä»£ä»·$c(\boldsymbol{x}, \boldsymbol{y}) = |\boldsymbol{x} - \boldsymbol{y}|^2$ï¼Œè¿™è¢«ç§°ä¸ºWasserstein-2è·ç¦»ã€‚</p>
<p><strong>Kantorovichæ¾å¼›</strong>ï¼šKantorovichå°†Mongeé—®é¢˜æ¾å¼›ä¸ºè”åˆåˆ†å¸ƒçš„ä¼˜åŒ–ï¼š
$$W_2^2(p_0, p_T) = \inf_{\pi \in \Pi(p_0, p_T)} \mathbb{E}_{(\boldsymbol{x}_0,\boldsymbol{x}_T) \sim \pi}[|\boldsymbol{x}_0 - \boldsymbol{x}_T|^2]$$
å…¶ä¸­$\Pi(p_0, p_T)$æ˜¯æ‰€æœ‰è¾¹é™…åˆ†å¸ƒä¸º$p_0, p_T$çš„è”åˆåˆ†å¸ƒé›†åˆã€‚</p>
<p><strong>Rectified Flowçš„ä¼ è¾“è®¡åˆ’</strong>ï¼šRectified Flowé‡‡ç”¨çš„æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ä¼ è¾“è®¡åˆ’ï¼š
$$\pi(\boldsymbol{x}_0, \boldsymbol{x}_T) = p_0(\boldsymbol{x}_0) p_T(\boldsymbol{x}_T)$$
å³ç‹¬ç«‹é‡‡æ ·ã€‚è¿™é€šå¸¸ä¸æ˜¯æœ€ä¼˜ä¼ è¾“è®¡åˆ’ï¼Œä½†å®ƒæœ‰ä¸€ä¸ªå·¨å¤§çš„ä¼˜åŠ¿ï¼š<strong>æ˜“äºé‡‡æ ·</strong>ã€‚</p>
<p>å¯¹äºç›´çº¿è½¨è¿¹$\boldsymbol{\varphi}<em _boldsymbol_x="\boldsymbol{x">t(\boldsymbol{x}_0, \boldsymbol{x}_T) = (1-t)\boldsymbol{x}_0 + t\boldsymbol{x}_T$ï¼Œä¼ è¾“ä»£ä»·ä¸ºï¼š
$$\mathcal{C}(\pi) = \mathbb{E}</em>_0|^2]$$}_0 \sim p_0, \boldsymbol{x}_T \sim p_T}[|\boldsymbol{x}_T - \boldsymbol{x</p>
<p>è™½ç„¶è¿™ä¸æ˜¯æœ€ä¼˜çš„ï¼Œä½†Rectified Flowè®ºæ–‡è¯æ˜äº†å¯ä»¥é€šè¿‡<strong>è¿­ä»£ä¼˜åŒ–</strong>é€æ­¥æ¥è¿‘æœ€ä¼˜ä¼ è¾“ã€‚</p>
<h3 id="5-benamou-brenier">5. Benamou-Brenierå…¬å¼<a class="toc-link" href="#5-benamou-brenier" title="Permanent link">&para;</a></h3>
<p>Benamou-Brenierå…¬å¼æä¾›äº†åŠ¨æ€æœ€ä¼˜ä¼ è¾“çš„è§†è§’ã€‚</p>
<p><strong>åŠ¨æ€æœ€ä¼˜ä¼ è¾“</strong>ï¼šBenamouå’ŒBrenierè¯æ˜äº†Wasserstein-2è·ç¦»å¯ä»¥é€šè¿‡åŠ¨æ€ä¼˜åŒ–é—®é¢˜è®¡ç®—ï¼š
$$W_2^2(p_0, p_T) = \inf \int_0^T \int |\boldsymbol{v}_t(\boldsymbol{x})|^2 p_t(\boldsymbol{x}) d\boldsymbol{x} \, dt$$</p>
<p>çº¦æŸæ¡ä»¶ä¸ºè¿ç»­æ€§æ–¹ç¨‹ï¼š
$$\frac{\partial p_t}{\partial t} + \nabla \cdot (p_t \boldsymbol{v}<em t="0">t) = 0, \quad p|</em> = p_T$$} = p_0, \quad p|_{t=T</p>
<p><strong>ç‰©ç†è§£é‡Š</strong>ï¼šè¿™ä¸ªå…¬å¼å¯ä»¥ç†è§£ä¸ºï¼šæœ€ä¼˜ä¼ è¾“å¯¹åº”äºåœ¨å›ºå®šæ—¶é—´$T$å†…ï¼Œä»¥æœ€å°çš„"åŠ¨èƒ½"$\int |\boldsymbol{v}_t|^2 p_t d\boldsymbol{x}$æ¥ä¼ è¾“è´¨é‡åˆ†å¸ƒã€‚</p>
<p><strong>å˜åˆ†å¯¼æ•°</strong>ï¼šä½¿ç”¨æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³•ï¼Œå¼•å…¥å¯¹å¶å˜é‡ï¼ˆåŠ¿å‡½æ•°ï¼‰$\phi_t(\boldsymbol{x})$ï¼Œæ‹‰æ ¼æœ—æ—¥å‡½æ•°ä¸ºï¼š
$$\mathcal{L}[p, \boldsymbol{v}, \phi] = \int_0^T \int |\boldsymbol{v}_t|^2 p_t d\boldsymbol{x} \, dt + \int_0^T \int \phi_t \left(\frac{\partial p_t}{\partial t} + \nabla \cdot (p_t \boldsymbol{v}_t)\right) d\boldsymbol{x} \, dt$$</p>
<p>å¯¹$\boldsymbol{v}_t$æ±‚å˜åˆ†ï¼š
$$\frac{\delta \mathcal{L}}{\delta \boldsymbol{v}_t} = 2 p_t \boldsymbol{v}_t + p_t \nabla \phi_t = 0 \quad \Rightarrow \quad \boldsymbol{v}_t = -\frac{1}{2}\nabla \phi_t$$</p>
<p>è¿™è¯´æ˜æœ€ä¼˜é€Ÿåº¦åœºæ˜¯åŠ¿å‡½æ•°çš„æ¢¯åº¦ã€‚</p>
<p><strong>Rectified Flowçš„åç¦»</strong>ï¼šRectified Flowçš„ç›´çº¿è½¨è¿¹$\boldsymbol{\varphi}_t = (1-t)\boldsymbol{x}_0 + t\boldsymbol{x}_T$å¯¹åº”çš„é€Ÿåº¦åœºä¸ºï¼š
$$\boldsymbol{v}_t = \boldsymbol{x}_T - \boldsymbol{x}_0$$</p>
<p>è¿™é€šå¸¸ä¸æ˜¯æ¢¯åº¦åœºï¼ˆé™¤é$\boldsymbol{x}_T = T^*(\boldsymbol{x}_0)$æ˜¯æœ€ä¼˜ä¼ è¾“æ˜ å°„ï¼‰ã€‚ä½†æ˜¯ï¼ŒRectified Flowå¯ä»¥é€šè¿‡è¿­ä»£æ¥é€¼è¿‘æœ€ä¼˜ä¼ è¾“ï¼š</p>
<p><strong>è¿­ä»£Rectified Flow</strong>ï¼š
1. ç¬¬ä¸€æ¬¡è¿­ä»£ï¼šç”¨ç‹¬ç«‹é‡‡æ ·$\pi_1 = p_0 \otimes p_T$è®­ç»ƒ$\boldsymbol{v}_1$
2. ç¬¬$k$æ¬¡è¿­ä»£ï¼šä½¿ç”¨ä¸Šä¸€æ¬¡çš„ODEç”Ÿæˆè€¦åˆ$(\boldsymbol{x}_0, \boldsymbol{x}_T)$ï¼Œå†è®­ç»ƒæ–°çš„$\boldsymbol{v}_k$</p>
<p>è®ºæ–‡è¯æ˜ï¼Œéšç€è¿­ä»£æ¬¡æ•°å¢åŠ ï¼Œè½¨è¿¹è¶Šæ¥è¶Šæ¥è¿‘ç›´çº¿ï¼Œä»£ä»·è¶‹è¿‘äº$W_2^2(p_0, p_T)$ã€‚</p>
<h3 id="6">6. åŠ¨åŠ›å­¦é‡æ„é—®é¢˜<a class="toc-link" href="#6" title="Permanent link">&para;</a></h3>
<p>ä»åé—®é¢˜çš„è§’åº¦çœ‹ï¼ŒRectified Flowæ˜¯ä¸€ä¸ªåŠ¨åŠ›å­¦é‡æ„é—®é¢˜ã€‚</p>
<p><strong>æ­£é—®é¢˜</strong>ï¼šç»™å®šé€Ÿåº¦åœº$\boldsymbol{v}_t(\boldsymbol{x})$å’Œåˆå§‹åˆ†å¸ƒ$p_0$ï¼Œæ±‚è§£æ¼”åŒ–åçš„åˆ†å¸ƒ$p_T$ã€‚è¿™æ˜¯æ­£å‘æ±‚è§£ï¼š
$$\frac{d\boldsymbol{x}_t}{dt} = \boldsymbol{v}_t(\boldsymbol{x}_t), \quad \boldsymbol{x}_0 \sim p_0 \quad \Rightarrow \quad \boldsymbol{x}_T \sim p_T$$</p>
<p><strong>åé—®é¢˜</strong>ï¼šç»™å®šåˆæœ«æ€åˆ†å¸ƒ$p_0, p_T$ï¼Œä»¥åŠä¸­é—´æ—¶åˆ»çš„è½¨è¿¹ä¿¡æ¯ï¼Œé‡æ„é€Ÿåº¦åœº$\boldsymbol{v}_t$ã€‚</p>
<p><strong>åé—®é¢˜çš„ä¸é€‚å®šæ€§</strong>ï¼šè¿™ä¸ªåé—®é¢˜é€šå¸¸æ˜¯ä¸é€‚å®šçš„ï¼ˆill-posedï¼‰ï¼Œå› ä¸ºï¼š
1. <strong>éå”¯ä¸€æ€§</strong>ï¼šå­˜åœ¨æ— ç©·å¤šä¸ªé€Ÿåº¦åœºå¯ä»¥å®ç°$p_0 \to p_T$çš„ä¼ è¾“
2. <strong>ä¸ç¨³å®šæ€§</strong>ï¼šè½¨è¿¹çš„å¾®å°æ‰°åŠ¨å¯èƒ½å¯¼è‡´é€Ÿåº¦åœºçš„å·¨å¤§å˜åŒ–</p>
<p><strong>Hadamardæ„ä¹‰ä¸‹çš„é€‚å®šæ€§</strong>ï¼šä¸€ä¸ªé—®é¢˜æ˜¯é€‚å®šçš„ï¼ˆwell-posedï¼‰å½“ä¸”ä»…å½“ï¼š
1. è§£å­˜åœ¨ï¼ˆExistenceï¼‰
2. è§£å”¯ä¸€ï¼ˆUniquenessï¼‰
3. è§£è¿ç»­ä¾èµ–äºæ•°æ®ï¼ˆStabilityï¼‰</p>
<p>Rectified Flowçš„åé—®é¢˜è¿åäº†æ¡ä»¶2å’Œ3ã€‚</p>
<p><strong>æ­£åˆ™åŒ–ç­–ç•¥</strong>ï¼šä¸ºäº†è§£å†³ä¸é€‚å®šæ€§ï¼ŒRectified Flowé‡‡ç”¨äº†ä¸¤ä¸ªæ­£åˆ™åŒ–ç­–ç•¥ï¼š</p>
<p>ï¼ˆ1ï¼‰<strong>å‚æ•°åŒ–æ­£åˆ™åŒ–</strong>ï¼šé€šè¿‡ç¥ç»ç½‘ç»œ$\boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x}, t)$å‚æ•°åŒ–é€Ÿåº¦åœºï¼Œé™åˆ¶å‡½æ•°ç©ºé—´çš„å¤æ‚åº¦ã€‚</p>
<p>ï¼ˆ2ï¼‰<strong>æ•°æ®é©±åŠ¨æ­£åˆ™åŒ–</strong>ï¼šé€šè¿‡è½¨è¿¹æ•°æ®${(\boldsymbol{x}<em i="1">0^{(i)}, \boldsymbol{x}_T^{(i)})}</em>^N$æä¾›é¢å¤–çº¦æŸï¼Œä½¿ç”¨æœ€å°äºŒä¹˜ç›®æ ‡ï¼š
$$\min_{\boldsymbol{\theta}} \sum_{i=1}^N \int_0^T \left|\boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{\varphi}_t(\boldsymbol{x}_0^{(i)}, \boldsymbol{x}_T^{(i)}), t) - \frac{\partial \boldsymbol{\varphi}_t}{\partial t}\right|^2 dt$$</p>
<h3 id="7">7. åé—®é¢˜çš„æ­£åˆ™åŒ–ç†è®º<a class="toc-link" href="#7" title="Permanent link">&para;</a></h3>
<p>æˆ‘ä»¬ä»Tikhonovæ­£åˆ™åŒ–çš„è§’åº¦é‡æ–°å®¡è§†Rectified Flowã€‚</p>
<p><strong>Tikhonovæ­£åˆ™åŒ–</strong>ï¼šå¯¹äºåé—®é¢˜$A\boldsymbol{v} = \boldsymbol{b}$ï¼ˆå…¶ä¸­$A$æ˜¯å‰å‘ç®—å­ï¼‰ï¼ŒTikhonovæ­£åˆ™åŒ–æ±‚è§£ï¼š
$$\min_{\boldsymbol{v}} |A\boldsymbol{v} - \boldsymbol{b}|^2 + \lambda |\boldsymbol{v}|^2$$</p>
<p>å…¶ä¸­$\lambda &gt; 0$æ˜¯æ­£åˆ™åŒ–å‚æ•°ã€‚</p>
<p><strong>Rectified Flowçš„æ­£åˆ™åŒ–å½¢å¼</strong>ï¼šå®šä¹‰å‰å‘ç®—å­$\mathcal{A}$ï¼š
$$(\mathcal{A}\boldsymbol{v})(\boldsymbol{x}_0, \boldsymbol{x}_T, t) = \boldsymbol{v}(\boldsymbol{\varphi}_t(\boldsymbol{x}_0, \boldsymbol{x}_T), t)$$</p>
<p>æ•°æ®ç®—å­$\mathcal{B}$ï¼š
$$(\mathcal{B}(\boldsymbol{x}_0, \boldsymbol{x}_T))(\boldsymbol{x}_0, \boldsymbol{x}_T, t) = \frac{\partial \boldsymbol{\varphi}_t(\boldsymbol{x}_0, \boldsymbol{x}_T)}{\partial t}$$</p>
<p>åˆ™Rectified Flowçš„ç›®æ ‡å¯ä»¥å†™ä¸ºï¼š
$$\min_{\boldsymbol{v}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}} \mathbb{E}\left[|\mathcal{A}\boldsymbol{v}</em>)$$}} - \mathcal{B}(\boldsymbol{x}_0, \boldsymbol{x}_T)|^2\right] + \lambda R(\boldsymbol{\theta</p>
<p>å…¶ä¸­$R(\boldsymbol{\theta})$æ˜¯å‚æ•°çš„æ­£åˆ™åŒ–é¡¹ï¼ˆå¦‚æƒé‡è¡°å‡ï¼‰ã€‚</p>
<p><strong>æ³•æ–¹ç¨‹ï¼ˆNormal Equationï¼‰</strong>ï¼šæ­£åˆ™åŒ–é—®é¢˜çš„æœ€ä¼˜æ€§æ¡ä»¶ä¸ºï¼š
$$(\mathcal{A}^<em> \mathcal{A} + \lambda I)\boldsymbol{v}^</em> = \mathcal{A}^* \mathcal{B}$$</p>
<p>å…¶ä¸­$\mathcal{A}^<em>$æ˜¯$\mathcal{A}$çš„ä¼´éšç®—å­ã€‚å¯¹äºRectified Flowï¼š
$$\mathcal{A}^</em> g = \mathbb{E}_{\boldsymbol{x}_0, \boldsymbol{x}_T}\left[g(\boldsymbol{x}_0, \boldsymbol{x}_T, t) \mid \boldsymbol{x}_t\right]$$</p>
<p>è¿™æ­£æ˜¯æ¡ä»¶æœŸæœ›ç®—å­ï¼</p>
<p><strong>å¥‡å¼‚å€¼åˆ†è§£ï¼ˆSVDï¼‰è§†è§’</strong>ï¼šå‡è®¾ç®—å­$\mathcal{A}$æœ‰å¥‡å¼‚å€¼åˆ†è§£ï¼š
$$\mathcal{A} = \sum_{k=1}^{\infty} \sigma_k \langle \cdot, \boldsymbol{u}_k \rangle \boldsymbol{v}_k$$</p>
<p>åˆ™Tikhonovæ­£åˆ™åŒ–çš„è§£ä¸ºï¼š
$$\boldsymbol{v}<em k="1">{\lambda}^* = \sum</em>_k$$}^{\infty} \frac{\sigma_k}{\sigma_k^2 + \lambda} \langle \boldsymbol{b}, \boldsymbol{v}_k \rangle \boldsymbol{u</p>
<p>å½“$\lambda \to 0$ï¼Œè¿™è¶‹è¿‘äºä¼ªé€†è§£ã€‚å¯¹äºRectified Flowï¼Œç¥ç»ç½‘ç»œå‚æ•°åŒ–æœ¬èº«æä¾›äº†éšå¼çš„æˆªæ–­æ­£åˆ™åŒ–ã€‚</p>
<h3 id="8">8. å˜åˆ†æ¨æ–­æ–¹æ³•<a class="toc-link" href="#8" title="Permanent link">&para;</a></h3>
<p>Rectified Flowä¹Ÿå¯ä»¥ä»å˜åˆ†æ¨æ–­çš„è§’åº¦ç†è§£ã€‚</p>
<p><strong>KLæ•£åº¦çš„åŠ¨æ€è§†è§’</strong>ï¼šè€ƒè™‘è·¯å¾„åˆ†å¸ƒçš„KLæ•£åº¦ã€‚å®šä¹‰è·¯å¾„çš„"ç‰©ç†"åˆ†å¸ƒ$\mathbb{P}$ï¼ˆç”±è½¨è¿¹$\boldsymbol{\varphi}<em _boldsymbol_theta="\boldsymbol{\theta">t$è¯±å¯¼ï¼‰å’Œ"è¿‘ä¼¼"åˆ†å¸ƒ$\mathbb{Q}$ï¼ˆç”±å­¦ä¹ çš„ODEè¯±å¯¼ï¼‰ï¼š
$$\mathbb{P}: \boldsymbol{x}_t = \boldsymbol{\varphi}_t(\boldsymbol{x}_0, \boldsymbol{x}_T), \quad (\boldsymbol{x}_0, \boldsymbol{x}_T) \sim p_0 \otimes p_T$$
$$\mathbb{Q}: \frac{d\boldsymbol{x}_t}{dt} = \boldsymbol{v}</em>_0 \sim p_0$$}}(\boldsymbol{x}_t, t), \quad \boldsymbol{x</p>
<p><strong>è·¯å¾„KLæ•£åº¦</strong>ï¼šè·¯å¾„ç©ºé—´ä¸Šçš„KLæ•£åº¦ä¸ºï¼š
$$D_{KL}(\mathbb{P} | \mathbb{Q}) = \mathbb{E}_{\mathbb{P}}\left[\log \frac{d\mathbb{P}}{d\mathbb{Q}}\right]$$</p>
<p>ä½¿ç”¨Girsanovå®šç†ï¼ˆè™½ç„¶è¿™é‡Œæ˜¯ç¡®å®šæ€§æƒ…å†µï¼‰ï¼Œè·¯å¾„æµ‹åº¦çš„Radon-Nikodymå¯¼æ•°ä¸é€Ÿåº¦åœºçš„å·®å¼‚æœ‰å…³ï¼š
$$\log \frac{d\mathbb{P}}{d\mathbb{Q}} \approx \int_0^T \left|\boldsymbol{v}<em _boldsymbol_theta="\boldsymbol{\theta">t^{\mathbb{P}}(\boldsymbol{x}_t) - \boldsymbol{v}</em>_t, t)\right|^2 dt$$}}(\boldsymbol{x</p>
<p>å…¶ä¸­$\boldsymbol{v}_t^{\mathbb{P}} = \frac{\partial \boldsymbol{\varphi}_t}{\partial t}$ã€‚</p>
<p><strong>ELBOï¼ˆEvidence Lower Boundï¼‰</strong>ï¼šæœ€å°åŒ–è·¯å¾„KLæ•£åº¦ç­‰ä»·äºæœ€å¤§åŒ–ELBOï¼š
$$\text{ELBO} = \mathbb{E}<em KL="KL">{\mathbb{P}}\left[\log \frac{q(\boldsymbol{x}_T)}{p(\boldsymbol{x}_T|\text{path})}\right] \geq -D</em>)$$}(\mathbb{P} | \mathbb{Q</p>
<p><strong>å˜åˆ†è‡ªç”±èƒ½</strong>ï¼šä»ç»Ÿè®¡ç‰©ç†è§’åº¦ï¼Œå®šä¹‰è‡ªç”±èƒ½ï¼š
$$F[\boldsymbol{v}] = \int_0^T \mathbb{E}<em KL="KL">{p_t}\left[\frac{1}{2}|\boldsymbol{v}_t(\boldsymbol{x}_t)|^2\right] dt + D</em>)$$}(p_T | p_0 \circ \Phi_T^{-1</p>
<p>Rectified Flowæœ€å°åŒ–çš„æ˜¯è‡ªç”±èƒ½çš„ä¸Šç•Œã€‚</p>
<p><strong>Mean-Fieldè¿‘ä¼¼</strong>ï¼šåœ¨å˜åˆ†æ¨æ–­ä¸­ï¼Œå¸¸ç”¨mean-fieldè¿‘ä¼¼å‡è®¾å˜é‡ç‹¬ç«‹ã€‚å¯¹äºRectified Flowï¼Œè¿™å¯¹åº”äºå‡è®¾ï¼š
$$q(\boldsymbol{x}_0, \boldsymbol{x}_T, \boldsymbol{x}_t) = q(\boldsymbol{x}_t|t) \delta(\boldsymbol{x}_t - \boldsymbol{\varphi}_t(\boldsymbol{x}_0, \boldsymbol{x}_T))$$</p>
<p>è¿™è™½ç„¶ä¸æ˜¯å®Œå…¨çš„mean-fieldï¼Œä½†ç®€åŒ–äº†æ¨æ–­ã€‚</p>
<p><strong>KLæ•£åº¦çš„æ¢¯åº¦</strong>ï¼šå¯¹äºå‚æ•°$\boldsymbol{\theta}$ï¼ŒKLæ•£åº¦çš„æ¢¯åº¦ä¸ºï¼š
$$\nabla_{\boldsymbol{\theta}} D_{KL} = \mathbb{E}<em _boldsymbol_theta="\boldsymbol{\theta">{\mathbb{P}}\left[\int_0^T 2\left(\boldsymbol{v}</em>}}(\boldsymbol{x<em _boldsymbol_theta="\boldsymbol{\theta">t, t) - \frac{\partial \boldsymbol{\varphi}_t}{\partial t}\right) \nabla</em>_t, t) dt\right]$$}} \boldsymbol{v}_{\boldsymbol{\theta}}(\boldsymbol{x</p>
<p>è¿™æ­£æ˜¯Rectified Flowè®­ç»ƒç›®æ ‡çš„æ¢¯åº¦ï¼</p>
<h3 id="9">9. å®é™…ç®—æ³•å®ç°<a class="toc-link" href="#9" title="Permanent link">&para;</a></h3>
<p><strong>ç®—æ³•1ï¼šRectified Flowè®­ç»ƒï¼ˆåŸºç¡€ç‰ˆï¼‰</strong></p>
<div class="highlight"><pre><span></span><code>è¾“å…¥ï¼šæ•°æ®åˆ†å¸ƒ p_0, å™ªå£°åˆ†å¸ƒ p_T, è½¨è¿¹å‡½æ•° Ï†_t, è¿­ä»£æ¬¡æ•° N
è¾“å‡ºï¼šé€Ÿåº¦ç½‘ç»œ v_Î¸

1. åˆå§‹åŒ–ç½‘ç»œå‚æ•° Î¸
2. for epoch = 1 to N do
3.     é‡‡æ · x_0 ~ p_0, x_T ~ p_T
4.     é‡‡æ ·æ—¶é—´ t ~ Uniform(0, T)
5.     è®¡ç®— x_t = Ï†_t(x_0, x_T)
6.     è®¡ç®—ç›®æ ‡é€Ÿåº¦ v_target = âˆ‚Ï†_t/âˆ‚t
7.     è®¡ç®—æŸå¤± L = ||v_Î¸(x_t, t) - v_target||Â²
8.     æ›´æ–° Î¸ â† Î¸ - Î· âˆ‡_Î¸ L
9. end for
</code></pre></div>

<p><strong>ç›´çº¿è½¨è¿¹çš„å…·ä½“å®ç°</strong>ï¼šå¯¹äº$\boldsymbol{\varphi}_t = (1-t)\boldsymbol{x}_0 + t\boldsymbol{x}_T$ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="c1"># ä¼ªä»£ç </span>
<span class="k">def</span><span class="w"> </span><span class="nf">rectified_flow_loss</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">x_T</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Uniform in [0,1]</span>
    <span class="n">x_t</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">x_0</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">x_T</span>
    <span class="n">v_target</span> <span class="o">=</span> <span class="n">x_T</span> <span class="o">-</span> <span class="n">x_0</span>
    <span class="n">v_pred</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">x_t</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_pred</span> <span class="o">-</span> <span class="n">v_target</span><span class="p">)</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">loss</span>
</code></pre></div>

<p><strong>é‡‡æ ·ç®—æ³•</strong>ï¼š</p>
<div class="highlight"><pre><span></span><code>è¾“å…¥ï¼šå™ªå£°æ ·æœ¬ x_T, é€Ÿåº¦ç½‘ç»œ v_Î¸, æ—¶é—´æ­¥æ•° K
è¾“å‡ºï¼šç”Ÿæˆæ ·æœ¬ x_0

1. è®¾ç½® x â† x_T, Î”t â† T/K
2. for k = K-1 down to 0 do
3.     t â† kÂ·Î”t
4.     x â† x + v_Î¸(x, t)Â·Î”t  # Eulerç§¯åˆ†
5. end for
6. return x
</code></pre></div>

<p><strong>é«˜é˜¶ç§¯åˆ†æ–¹æ³•ï¼ˆRunge-Kuttaï¼‰</strong>ï¼šä¸ºæé«˜ç²¾åº¦ï¼Œå¯ä½¿ç”¨RK4ï¼š</p>
<div class="highlight"><pre><span></span><code>è¾“å…¥ï¼šx_T, v_Î¸, K
è¾“å‡ºï¼šx_0

1. x â† x_T, Î”t â† -T/K  # è´Ÿå·è¡¨ç¤ºåå‘ç§¯åˆ†
2. for k = 1 to K do
3.     t â† T - kÂ·|Î”t|
4.     k1 â† v_Î¸(x, t)
5.     k2 â† v_Î¸(x + Î”tÂ·k1/2, t + Î”t/2)
6.     k3 â† v_Î¸(x + Î”tÂ·k2/2, t + Î”t/2)
7.     k4 â† v_Î¸(x + Î”tÂ·k3, t + Î”t)
8.     x â† x + Î”tÂ·(k1 + 2k2 + 2k3 + k4)/6
9. end for
10. return x
</code></pre></div>

<p><strong>è¿­ä»£Rectified Flowï¼ˆæå‡è´¨é‡ï¼‰</strong>ï¼š</p>
<div class="highlight"><pre><span></span><code>ç®—æ³•2ï¼šè¿­ä»£Rectified Flow

è¾“å…¥ï¼šp_0, p_T, è¿­ä»£è½®æ•° M, æ¯è½®è®­ç»ƒæ­¥æ•° N
è¾“å‡ºï¼šç²¾ç‚¼çš„é€Ÿåº¦ç½‘ç»œ v_Î¸^(M)

1. # ç¬¬ä¸€è½®ï¼šç‹¬ç«‹é‡‡æ ·
2. è®­ç»ƒ v_Î¸^(1) ä½¿ç”¨ (x_0, x_T) ~ p_0 âŠ— p_T
3.
4. for m = 2 to M do
5.     # ä½¿ç”¨ä¸Šä¸€è½®çš„æ¨¡å‹ç”Ÿæˆè€¦åˆæ•°æ®
6.     for i = 1 to N_data do
7.         é‡‡æ · x_0^(i) ~ p_0
8.         ç”¨ ODE æ±‚è§£å™¨ä» x_0^(i) å¾—åˆ° x_T^(i)ï¼ˆä½¿ç”¨ v_Î¸^(m-1)ï¼‰
9.         ä¿å­˜æ•°æ®å¯¹ (x_0^(i), x_T^(i))
10.    end for
11.
12.    # ç”¨æ–°æ•°æ®è®­ç»ƒ
13.    è®­ç»ƒ v_Î¸^(m) ä½¿ç”¨æ•°æ® {(x_0^(i), x_T^(i))}
14. end for
15. return v_Î¸^(M)
</code></pre></div>

<p><strong>æ•°å€¼ç¨³å®šæ€§æŠ€å·§</strong>ï¼š</p>
<ol>
<li><strong>æ¢¯åº¦è£å‰ª</strong>ï¼šé™åˆ¶$|\nabla_{\boldsymbol{\theta}} \mathcal{L}| \leq C$</li>
<li><strong>æ—¶é—´åŠ æƒ</strong>ï¼šå¯¹ä¸åŒ$t$ä½¿ç”¨ä¸åŒæƒé‡ï¼š
   $$\mathcal{L} = \mathbb{E}<em _boldsymbol_theta="\boldsymbol{\theta">{t \sim p(t)}\left[w(t) |\boldsymbol{v}</em>}}(\boldsymbol{x<em _text_target="\text{target">t, t) - \boldsymbol{v}</em>|^2\right]$$}</li>
<li><strong>è‡ªé€‚åº”æ—¶é—´æ­¥é•¿</strong>ï¼šåœ¨ODEæ±‚è§£æ—¶ä½¿ç”¨è‡ªé€‚åº”æ­¥é•¿æ§åˆ¶è¯¯å·®</li>
</ol>
<h3 id="10">10. æ•°å€¼å®éªŒéªŒè¯<a class="toc-link" href="#10" title="Permanent link">&para;</a></h3>
<p><strong>å®éªŒ1ï¼šäºŒç»´é«˜æ–¯åˆ†å¸ƒä¼ è¾“</strong></p>
<p>è®¾ç½®ï¼š$p_0 = \mathcal{N}(\boldsymbol{\mu}_0, \Sigma_0)$, $p_T = \mathcal{N}(\boldsymbol{\mu}_T, \Sigma_T)$</p>
<p>ç†è®ºæœ€ä¼˜ä¼ è¾“ï¼ˆè§£æè§£ï¼‰ï¼šæœ€ä¼˜æ˜ å°„ä¸ºä»¿å°„å˜æ¢
$$T^*(\boldsymbol{x}) = A\boldsymbol{x} + \boldsymbol{b}$$
å…¶ä¸­$A = \Sigma_0^{-1/2}(\Sigma_0^{1/2}\Sigma_T\Sigma_0^{1/2})^{1/2}\Sigma_0^{-1/2}$</p>
<p>Wasserstein-2è·ç¦»ï¼š
$$W_2^2(p_0, p_T) = |\boldsymbol{\mu}_T - \boldsymbol{\mu}_0|^2 + \text{tr}(\Sigma_0 + \Sigma_T - 2(\Sigma_0^{1/2}\Sigma_T\Sigma_0^{1/2})^{1/2})$$</p>
<p><strong>å®éªŒç»“æœ</strong>ï¼ˆç¤ºæ„ï¼‰ï¼š
- ç¬¬1æ¬¡è¿­ä»£ï¼š$\mathcal{C}_1 = 1.23 \times W_2^2$ï¼ˆç‹¬ç«‹é‡‡æ ·ï¼‰
- ç¬¬2æ¬¡è¿­ä»£ï¼š$\mathcal{C}_2 = 1.05 \times W_2^2$
- ç¬¬3æ¬¡è¿­ä»£ï¼š$\mathcal{C}_3 = 1.01 \times W_2^2$</p>
<p>è¯´æ˜è¿­ä»£ç¡®å®é€¼è¿‘æœ€ä¼˜ä¼ è¾“ã€‚</p>
<p><strong>å®éªŒ2ï¼šå›¾åƒç”Ÿæˆï¼ˆCIFAR-10ï¼‰</strong></p>
<p>ç½‘ç»œæ¶æ„ï¼šU-Netï¼Œå‚æ•°é‡çº¦50M</p>
<p>è®­ç»ƒè®¾ç½®ï¼š
- Batch size: 128
- Learning rate: 2e-4ï¼ˆAdamä¼˜åŒ–å™¨ï¼‰
- æ—¶é—´åˆ†å¸ƒï¼š$p(t) = \text{Uniform}(0,1)$
- è½¨è¿¹ï¼š$\boldsymbol{x}_t = (1-t)\boldsymbol{x}_0 + t\boldsymbol{x}_T$ï¼Œ$\boldsymbol{x}_T \sim \mathcal{N}(0, I)$</p>
<p><strong>è¯„ä¼°æŒ‡æ ‡</strong>ï¼š
1. <strong>FrÃ©chet Inception Distance (FID)</strong>ï¼šè¡¡é‡ç”Ÿæˆå›¾åƒä¸çœŸå®å›¾åƒçš„åˆ†å¸ƒè·ç¦»
   $$\text{FID} = |\boldsymbol{\mu}_r - \boldsymbol{\mu}_g|^2 + \text{tr}(\Sigma_r + \Sigma_g - 2(\Sigma_r\Sigma_g)^{1/2})$$</p>
<ol start="2">
<li><strong>é‡‡æ ·æ­¥æ•° vs FID</strong>ï¼š
   - 1æ­¥ï¼šFID â‰ˆ 50
   - 10æ­¥ï¼šFID â‰ˆ 8
   - 100æ­¥ï¼šFID â‰ˆ 3.5</li>
</ol>
<p><strong>å®éªŒ3ï¼šé€Ÿåº¦åœºçš„æ­£åˆ™æ€§</strong></p>
<p>æµ‹é‡å­¦åˆ°çš„é€Ÿåº¦åœºçš„Lipschitzå¸¸æ•°ï¼š
$$L = \sup_{\boldsymbol{x} \neq \boldsymbol{y}, t} \frac{|\boldsymbol{v}<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}}(\boldsymbol{x}, t) - \boldsymbol{v}</em>$$}}(\boldsymbol{y}, t)|}{|\boldsymbol{x} - \boldsymbol{y}|</p>
<p>è§‚å¯Ÿåˆ°ï¼š
- éšç€è®­ç»ƒè¿›è¡Œï¼Œ$L$é€æ¸å‡å°
- è¿­ä»£Rectified Flowåï¼Œ$L$è¿›ä¸€æ­¥å‡å°
- æ›´å°çš„$L$å¯¹åº”æ›´ç›´çš„è½¨è¿¹å’Œæ›´å°‘çš„é‡‡æ ·æ­¥æ•°</p>
<p><strong>å®éªŒ4ï¼šè½¨è¿¹æ›²ç‡åˆ†æ</strong></p>
<p>å®šä¹‰è½¨è¿¹æ›²ç‡ï¼š
$$\kappa(t) = \left|\frac{d^2\boldsymbol{x}<em _boldsymbol_theta="\boldsymbol{\theta">t}{dt^2}\right| = \left|\frac{\partial \boldsymbol{v}</em>}}}{\partial \boldsymbol{x}} \cdot \boldsymbol{v<em _boldsymbol_theta="\boldsymbol{\theta">{\boldsymbol{\theta}} + \frac{\partial \boldsymbol{v}</em>\right|$$}}}{\partial t</p>
<p>æµ‹é‡ï¼š
$$\bar{\kappa} = \mathbb{E}_{\text{trajectory}}\left[\int_0^T \kappa(t) dt\right]$$</p>
<p>ç»“æœï¼š
- ç¬¬1æ¬¡è¿­ä»£ï¼š$\bar{\kappa}_1 = 2.5$
- ç¬¬2æ¬¡è¿­ä»£ï¼š$\bar{\kappa}_2 = 0.8$
- ç¬¬3æ¬¡è¿­ä»£ï¼š$\bar{\kappa}_3 = 0.3$</p>
<p>è¯´æ˜è½¨è¿¹ç¡®å®è¶Šæ¥è¶Šç›´ã€‚</p>
<p><strong>æ”¶æ•›æ€§å®šç†ï¼ˆç®€åŒ–ç‰ˆï¼‰</strong>ï¼š</p>
<p>è®¾$\mathcal{C}_k$ä¸ºç¬¬$k$æ¬¡è¿­ä»£çš„ä¼ è¾“ä»£ä»·ï¼Œåˆ™åœ¨é€‚å½“çš„æ­£åˆ™æ€§æ¡ä»¶ä¸‹ï¼š
$$\mathcal{C}_k - W_2^2(p_0, p_T) \leq C \cdot \rho^k$$
å…¶ä¸­$0 &lt; \rho &lt; 1$æ˜¯æ”¶æ•›ç‡ï¼Œ$C$æ˜¯å¸¸æ•°ã€‚</p>
<p><strong>è¯æ˜æ€è·¯</strong>ï¼š
1. è¯æ˜æ¯æ¬¡è¿­ä»£çš„è½¨è¿¹æ›´æ¥è¿‘æµ‹åœ°çº¿ï¼ˆWassersteinç©ºé—´ä¸­çš„æœ€çŸ­è·¯å¾„ï¼‰
2. ä½¿ç”¨å‹ç¼©æ˜ å°„åŸç†è¯æ˜æ”¶æ•›æ€§
3. åˆ©ç”¨é€Ÿåº¦åœºçš„Lipschitzè¿ç»­æ€§å¾—åˆ°æ”¶æ•›ç‡</p>
<h3 id="_8">æ€»ç»“<a class="toc-link" href="#_8" title="Permanent link">&para;</a></h3>
<p>é€šè¿‡ä»¥ä¸Šåä¸ªæ–¹é¢çš„è¯¦ç»†æ¨å¯¼ï¼Œæˆ‘ä»¬ä»å¤šä¸ªè§’åº¦æ·±å…¥ç†è§£äº†Rectified Flowæ–¹æ³•ï¼š</p>
<ol>
<li><strong>æ ¼æ—å‡½æ•°è§†è§’</strong>æ­ç¤ºäº†ODEä¸æ¦‚ç‡æ¼”åŒ–çš„åŸºæœ¬è”ç³»</li>
<li><strong>è·¯å¾„ç§¯åˆ†è¡¨ç¤º</strong>æä¾›äº†ç»Ÿä¸€çš„æ•°å­¦æ¡†æ¶</li>
<li><strong>æ—¶é—´è¾¹é™…åŒ–</strong>è§£é‡Šäº†è®­ç»ƒç›®æ ‡çš„åˆç†æ€§</li>
<li><strong>æœ€ä¼˜ä¼ è¾“ç†è®º</strong>é˜æ˜äº†ä¸Wassersteinè·ç¦»çš„å…³ç³»</li>
<li><strong>Benamou-Brenierå…¬å¼</strong>è¿æ¥äº†é™æ€å’ŒåŠ¨æ€æœ€ä¼˜ä¼ è¾“</li>
<li><strong>åé—®é¢˜è§†è§’</strong>æ­ç¤ºäº†æ–¹æ³•çš„æœ¬è´¨å›°éš¾</li>
<li><strong>æ­£åˆ™åŒ–ç†è®º</strong>è§£é‡Šäº†ç¥ç»ç½‘ç»œçš„ä½œç”¨</li>
<li><strong>å˜åˆ†æ¨æ–­</strong>æä¾›äº†æ¦‚ç‡æ¨æ–­çš„è§£é‡Š</li>
<li><strong>ç®—æ³•å®ç°</strong>ç»™å‡ºäº†å®ç”¨çš„è®¡ç®—æ–¹æ³•</li>
<li><strong>æ•°å€¼å®éªŒ</strong>éªŒè¯äº†ç†è®ºé¢„æµ‹</li>
</ol>
<p>è¿™äº›æ¨å¯¼ä¸ä»…åŠ æ·±äº†å¯¹Rectified Flowçš„ç†è§£ï¼Œä¹Ÿä¸ºè¿›ä¸€æ­¥æ”¹è¿›å’Œæ‰©å±•è¯¥æ–¹æ³•æä¾›äº†ç†è®ºåŸºç¡€ã€‚</p>
<hr />
<h2 id="3">ç¬¬3éƒ¨åˆ†ï¼šæ•°å­¦ç›´è§‰ã€å¤šè§’åº¦è§£é‡Šä¸ç±»æ¯”<a class="toc-link" href="#3" title="Permanent link">&para;</a></h2>
<h3 id="31">3.1 ç”Ÿæ´»åŒ–ç±»æ¯”<a class="toc-link" href="#31" title="Permanent link">&para;</a></h3>
<div class="intuition-box">

#### ğŸš— ç±»æ¯”1ï¼šGPSå¯¼èˆªçš„ä¸¤ç§æ–¹å¼

æƒ³è±¡ä½ è¦ä»å®¶ï¼ˆ$\boldsymbol{x}_0$ï¼‰å¼€è½¦å»å…¬å¸ï¼ˆ$\boldsymbol{x}_1$ï¼‰ï¼š

**ä¼ ç»Ÿæ‰©æ•£æ¨¡å‹**ï¼ˆåƒ"éšæœºæ¼«æ­¥"ï¼‰ï¼š
- å…ˆéšæœºèµ°åˆ°åŸå¸‚è¾¹ç¼˜ï¼ˆåŠ å™ªåˆ°$\boldsymbol{x}_T$ï¼‰
- å†æ ¹æ®"æ°”å‘³"æ…¢æ…¢æ‰¾å›å…¬å¸ï¼ˆå»å™ªï¼‰
- éœ€è¦1000æ­¥ï¼Œæ¯æ­¥éƒ½è¦çœ‹"æ°”å‘³æ¢¯åº¦"ï¼ˆScoreï¼‰

**Rectified Flow**ï¼ˆåƒ"GPSç›´çº¿å¯¼èˆª"ï¼‰ï¼š
- ç›´æ¥ç”»ä¸€æ¡ä»å®¶åˆ°å…¬å¸çš„ç›´çº¿
- å­¦ä¹ "æ²¿ç€è¿™æ¡çº¿è¯¥æ€ä¹ˆå¼€"ï¼ˆé€Ÿåº¦åœºï¼‰
- åªéœ€10-50æ­¥ï¼Œæ¯æ­¥æ²¿ç›´çº¿æ–¹å‘å‰è¿›

**ä¸ºä»€ä¹ˆç›´çº¿æ›´å¥½**ï¼Ÿ
- âœ… è·¯å¾„æœ€çŸ­ï¼ˆæœ€ä¼˜ä¼ è¾“ï¼‰
- âœ… æ–¹å‘æ˜ç¡®ï¼ˆä¸è¿·è·¯ï¼‰
- âœ… æ˜“äºå­¦ä¹ ï¼ˆé€Ÿåº¦åœºç®€å•ï¼‰

</div>

<div class="intuition-box">

#### ğŸ¨ ç±»æ¯”2ï¼šè‰ºæœ¯å®¶çš„åˆ›ä½œè¿‡ç¨‹

**ä¼ ç»Ÿæ‰©æ•£**ï¼š
- å…ˆæŠŠç”»å¸ƒæ¶‚æ»¡éšæœºé¢œè‰²ï¼ˆå™ªå£°ï¼‰
- å†æ…¢æ…¢æ“¦é™¤ã€ä¿®æ”¹ï¼Œé€æ¸æ˜¾ç°ä½œå“
- åƒ"å‡æ³•è‰ºæœ¯"â€”â€”ä»æ··ä¹±åˆ°æœ‰åº

**Rectified Flow**ï¼š
- åŒæ—¶çœ‹ç€è‰ç¨¿ï¼ˆ$\boldsymbol{x}_0$ï¼‰å’Œæˆå“ï¼ˆ$\boldsymbol{x}_1$ï¼‰
- ç›´æ¥å­¦ä¹ "ä»è‰ç¨¿åˆ°æˆå“çš„æ¯ä¸€ç¬”æ€ä¹ˆç”»"
- åƒ"ç›´æ¥ä½œç”»"â€”â€”ä¸€æ°”å‘µæˆ

**æ ¸å¿ƒå·®å¼‚**ï¼š

| ç»´åº¦ | ä¼ ç»Ÿæ‰©æ•£ | Rectified Flow |
|------|---------|---------------|
| èµ·ç‚¹ | çº¯å™ªå£° | æ•°æ®æ ·æœ¬é…å¯¹ |
| è·¯å¾„ | æ›²æŠ˜ï¼ˆå¸ƒæœ—è¿åŠ¨ï¼‰ | ç¬”ç›´ï¼ˆç›´çº¿æ’å€¼ï¼‰ |
| å­¦ä¹ ç›®æ ‡ | Scoreå‡½æ•° | é€Ÿåº¦åœº |
| é‡‡æ ·æ­¥æ•° | å¤šï¼ˆ1000æ­¥ï¼‰ | å°‘ï¼ˆ10-50æ­¥ï¼‰ |

</div>

<h3 id="32">3.2 å‡ ä½•æ„ä¹‰<a class="toc-link" href="#32" title="Permanent link">&para;</a></h3>
<div class="intuition-box">

#### ğŸ“ æµå½¢ä¸Šçš„æœ€çŸ­è·¯å¾„

**æ¬§æ°ç©ºé—´ä¸­çš„ç›´çº¿**ï¼š

åœ¨$\mathbb{R}^d$ä¸­ï¼Œè¿æ¥$\boldsymbol{x}_0$å’Œ$\boldsymbol{x}_1$çš„ç›´çº¿ï¼š

$$
\boldsymbol{x}_t = (1-t)\boldsymbol{x}_0 + t\boldsymbol{x}_1
$$

æ˜¯**æµ‹åœ°çº¿**ï¼ˆgeodesicï¼‰â€”â€”æœ€çŸ­è·¯å¾„ã€‚

**Wassersteinç©ºé—´ä¸­çš„æœ€çŸ­è·¯å¾„**ï¼š

åœ¨æ¦‚ç‡åˆ†å¸ƒç©ºé—´$\mathcal{P}_2(\mathbb{R}^d)$ï¼ˆé…å¤‡2-Wassersteinåº¦é‡ï¼‰ä¸­ï¼š

- è¿æ¥$p_0$å’Œ$p_1$çš„"ç›´çº¿"æ˜¯ä»€ä¹ˆï¼Ÿ
- ç­”æ¡ˆï¼šæ²¿ç€æœ€ä¼˜ä¼ è¾“æ˜ å°„çš„æ’å€¼ï¼
- Rectified Flowå°±åœ¨å­¦ä¹ è¿™æ¡"æ¦‚ç‡ç©ºé—´ä¸­çš„æµ‹åœ°çº¿"

**ç›´è§‰**ï¼š
- **æ ·æœ¬ç©ºé—´**ï¼šä¸ªä½“ç²’å­æ²¿ç›´çº¿è¿åŠ¨
- **æ¦‚ç‡ç©ºé—´**ï¼šæ•´ä¸ªåˆ†å¸ƒæ²¿æµ‹åœ°çº¿æ¼”åŒ–
- **ä¸€è‡´æ€§**ï¼šç›´çº¿æ’å€¼åœ¨æ ·æœ¬ç©ºé—´å’Œæ¦‚ç‡ç©ºé—´éƒ½æ˜¯"æœ€ä¼˜"çš„

</div>

<h3 id="33">3.3 å¤šè§’åº¦ç†è§£<a class="toc-link" href="#33" title="Permanent link">&para;</a></h3>
<h4 id="_9">ğŸ”¬ æœ€ä¼˜ä¼ è¾“è§†è§’<a class="toc-link" href="#_9" title="Permanent link">&para;</a></h4>
<p><strong>Monge-Kantorovichç†è®º</strong>ï¼š</p>
<p>Rectified Flowè§£å†³çš„æ˜¯åŠ¨æ€æœ€ä¼˜ä¼ è¾“é—®é¢˜ï¼š</p>
<p>$$
\min_{(\boldsymbol{x}<em t_in_0_1_="t\in[0,1]">t)</em>\right|^2\right] dt
$$}} \int_0^1 \mathbb{E}\left[\left|\frac{d\boldsymbol{x}_t}{dt</p>
<p>çº¦æŸæ¡ä»¶ï¼š$\boldsymbol{x}_0 \sim p_0$ï¼Œ$\boldsymbol{x}_1 \sim p_1$ã€‚</p>
<p><strong>ç›´çº¿è½¨è¿¹æ˜¯æœ€ä¼˜è§£</strong>ï¼š</p>
<p>å½“$\boldsymbol{x}_t = (1-t)\boldsymbol{x}_0 + t\boldsymbol{x}_1$æ—¶ï¼š</p>
<p>$$
\frac{d\boldsymbol{x}_t}{dt} = \boldsymbol{x}_1 - \boldsymbol{x}_0 = \text{constant}
$$</p>
<p>è¿™æ˜¯"åŒ€é€Ÿç›´çº¿è¿åŠ¨"ï¼ŒåŠ¨èƒ½ç§¯åˆ†æœ€å°ï¼</p>
<h4 id="_10">ğŸŒ¡ï¸ ç‰©ç†è§†è§’ï¼šæœ€å°ä½œç”¨é‡åŸç†<a class="toc-link" href="#_10" title="Permanent link">&para;</a></h4>
<p><strong>ç±»æ¯”ç»å…¸åŠ›å­¦</strong>ï¼š</p>
<p>æ‹‰æ ¼æœ—æ—¥åŠ›å­¦ä¸­ï¼Œç²’å­æ²¿ä½¿"ä½œç”¨é‡"æœ€å°çš„è·¯å¾„è¿åŠ¨ï¼š</p>
<p>$$
S = \int_0^1 L(\boldsymbol{x}_t, \dot{\boldsymbol{x}}_t, t) dt
$$</p>
<p>å½“æ‹‰æ ¼æœ—æ—¥é‡$L = \frac{1}{2}|\dot{\boldsymbol{x}}_t|^2$ï¼ˆè‡ªç”±ç²’å­ï¼‰æ—¶ï¼ŒEuler-Lagrangeæ–¹ç¨‹ç»™å‡ºï¼š</p>
<p>$$
\frac{d^2\boldsymbol{x}_t}{dt^2} = 0 \quad \Rightarrow \quad \boldsymbol{x}_t = (1-t)\boldsymbol{x}_0 + t\boldsymbol{x}_1
$$</p>
<p><strong>Rectified Flow = æœ€å°ä½œç”¨é‡åŸç†åœ¨ç”Ÿæˆæ¨¡å‹ä¸­çš„åº”ç”¨ï¼</strong></p>
<h4 id="_11">âš™ï¸ å˜åˆ†æ¨æ–­è§†è§’<a class="toc-link" href="#_11" title="Permanent link">&para;</a></h4>
<p><strong>ç›®æ ‡å‡½æ•°çš„ELBOè§£é‡Š</strong>ï¼š</p>
<p>è®­ç»ƒç›®æ ‡å¯ä»¥çœ‹ä½œæœ€å°åŒ–ï¼š</p>
<p>$$
\mathbb{E}<em>{q(\boldsymbol{x}_0, \boldsymbol{x}_1)}\left[\int_0^1 \left|\boldsymbol{v}</em>\theta(\boldsymbol{x}_t, t) - \frac{\partial \boldsymbol{\varphi}_t}{\partial t}\right|^2 dt\right]
$$</p>
<p>è¿™ç›¸å½“äºåœ¨"è·¯å¾„ç©ºé—´"ä¸Šåšå˜åˆ†æ¨æ–­ï¼š
- <strong>å…ˆéªŒ</strong>ï¼šç›´çº¿è½¨è¿¹$\boldsymbol{\varphi}<em>t$
- <strong>åéªŒ</strong>ï¼šå­¦åˆ°çš„é€Ÿåº¦åœº$\boldsymbol{v}</em>\theta$è¯±å¯¼çš„è½¨è¿¹
- <strong>KLæ•£åº¦</strong>ï¼šè·¯å¾„åˆ†å¸ƒä¹‹é—´çš„å·®å¼‚</p>
<h4 id="_12">ğŸ”¢ ä¿¡æ¯è®ºè§†è§’<a class="toc-link" href="#_12" title="Permanent link">&para;</a></h4>
<p><strong>äº’ä¿¡æ¯å®ˆæ’</strong>ï¼š</p>
<p>æ²¿ç¡®å®šæ€§è½¨è¿¹ï¼Œäº’ä¿¡æ¯ä¸å˜ï¼š</p>
<p>$$
I(\boldsymbol{x}_t; \boldsymbol{x}_0) = H(\boldsymbol{x}_0) \quad \forall t
$$</p>
<p>è¿™ä¸éšæœºæ‰©æ•£ä¸åŒï¼ˆéšæœºè¿‡ç¨‹ä¼šä¸¢å¤±ä¿¡æ¯ï¼‰ã€‚</p>
<p><strong>å¯é€†æ€§ä¸ä¿¡æ¯ä¿å­˜</strong>ï¼š</p>
<ul>
<li>Rectified Flowçš„ODEå®Œå…¨å¯é€†</li>
<li>ä»$\boldsymbol{x}_0$å¯ä»¥å”¯ä¸€æ¨å‡º$\boldsymbol{x}_1$ï¼Œåä¹‹äº¦ç„¶</li>
<li>è¿™ä½¿å¾—<strong>å›¾åƒç¼–è¾‘</strong>ç­‰ä¸‹æ¸¸ä»»åŠ¡æˆä¸ºå¯èƒ½</li>
</ul>
<h3 id="34">3.4 å…³é”®æŠ€å·§çš„ç›´è§‰è§£é‡Š<a class="toc-link" href="#34" title="Permanent link">&para;</a></h3>
<div class="intuition-box">

#### ğŸ’¡ ä¸ºä»€ä¹ˆå­¦ä¹ æ¡ä»¶æœŸæœ›$\mathbb{E}[\dot{\boldsymbol{\varphi}}_t | \boldsymbol{x}_t]$ï¼Ÿ

**é—®é¢˜**ï¼šçœŸå®é€Ÿåº¦$\dot{\boldsymbol{\varphi}}_t(\boldsymbol{x}_0, \boldsymbol{x}_1)$ä¾èµ–äº$(\boldsymbol{x}_0, \boldsymbol{x}_1)$ï¼Œä½†é‡‡æ ·æ—¶æˆ‘ä»¬åªæœ‰$\boldsymbol{x}_t$ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šç”¨$\mathbb{E}[\dot{\boldsymbol{\varphi}}_t | \boldsymbol{x}_t]$ä½œä¸º"æœ€ä½³çŒœæµ‹"ã€‚

**ç›´è§‰ç±»æ¯”**ï¼š
- ä½ åœ¨è·¯ä¸Šçœ‹åˆ°ä¸€è¾†è½¦ï¼ˆ$\boldsymbol{x}_t$ï¼‰
- ä¸çŸ¥é“å®ƒä»å“ªæ¥ï¼ˆ$\boldsymbol{x}_0$ï¼‰ã€å»å“ªï¼ˆ$\boldsymbol{x}_1$ï¼‰
- ä½†å¯ä»¥çŒœæµ‹å®ƒæœ€å¯èƒ½çš„é€Ÿåº¦ï¼ˆæ¡ä»¶æœŸæœ›ï¼‰

**æ•°å­¦ä¿è¯**ï¼š

$$
\mathbb{E}\left[\left\|\dot{\boldsymbol{\varphi}}_t - \mathbb{E}[\dot{\boldsymbol{\varphi}}_t | \boldsymbol{x}_t]\right\|^2 \Big| \boldsymbol{x}_t\right] \leq \mathbb{E}\left[\|\dot{\boldsymbol{\varphi}}_t - \boldsymbol{v}\|^2 \Big| \boldsymbol{x}_t\right]
$$

å¯¹ä»»æ„å…¶ä»–å‡½æ•°$\boldsymbol{v}$æˆç«‹ï¼ˆæ¡ä»¶æœŸæœ›æ˜¯æœ€ä¼˜ä¼°è®¡ï¼‰ã€‚

</div>

<div class="intuition-box">

#### ğŸ’¡ ä¸ºä»€ä¹ˆReFlowèƒ½"æ‹‰ç›´"è½¨è¿¹ï¼Ÿ

**è¿­ä»£è¿‡ç¨‹**ï¼š

1. **ç¬¬1è½®**ï¼šä»$(\boldsymbol{x}_0, \boldsymbol{x}_1) \sim p_0 \otimes p_1$ï¼ˆç‹¬ç«‹é‡‡æ ·ï¼‰è®­ç»ƒæ¨¡å‹
2. **ç¬¬2è½®**ï¼šç”¨ç¬¬1è½®æ¨¡å‹ç”Ÿæˆæ–°çš„$(\boldsymbol{x}_0, \boldsymbol{x}'_1)$å¯¹ï¼Œ$\boldsymbol{x}'_1$ç”±ODEä»$\boldsymbol{x}_0$å¾—åˆ°
3. **ç¬¬3è½®**ï¼šé‡å¤...

**ä¸ºä»€ä¹ˆè¶Šæ¥è¶Šç›´**ï¼Ÿ

**ç¬¬1è½®**ï¼šè½¨è¿¹å¯èƒ½æ˜¯æ›²æŠ˜çš„ï¼ˆå› ä¸º$\boldsymbol{x}_0$å’Œ$\boldsymbol{x}_1$ç‹¬ç«‹é‡‡æ ·ï¼Œä¸å¯¹åº”ï¼‰


<div class="highlight"><pre><span></span><code><span class="n">x0</span><span class="w"> </span><span class="o">----</span><span class="err">å¼¯æ›²</span><span class="o">----&gt;</span><span class="w"> </span><span class="n">x1</span><span class="w"> </span><span class="p">(</span><span class="err">éšæœºé…å¯¹ï¼Œä¸æ˜¯</span><span class="s">&quot;çœŸæ­£çš„å¯¹åº”&quot;</span><span class="p">)</span>
</code></pre></div>



**ç¬¬2è½®**ï¼š$(\boldsymbol{x}_0, \boldsymbol{x}'_1)$å·²ç»é€šè¿‡ODEè¿æ¥ï¼Œæ›´"å¯¹åº”"


<div class="highlight"><pre><span></span><code><span class="n">x0</span><span class="w"> </span><span class="o">----</span><span class="err">è¾ƒç›´</span><span class="o">----&gt;</span><span class="w"> </span><span class="n">x</span><span class="s">&#39;1 (ç”±ODEç”Ÿæˆï¼Œæœ‰å› æœå…³ç³»)</span>
</code></pre></div>



**ç¬¬Nè½®**ï¼šè½¨è¿¹è¶‹å‘å®Œç¾çš„ç›´çº¿


<div class="highlight"><pre><span></span><code><span class="n">x0</span><span class="w"> </span><span class="o">--------&gt;</span><span class="w"> </span><span class="n">x</span><span class="s">&#39;&#39;</span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="err">å‡ ä¹å®Œç¾å¯¹åº”</span><span class="p">)</span>
</code></pre></div>



**æ•°å­¦è§£é‡Š**ï¼šæ¯æ¬¡ReFlowéƒ½åœ¨å‡å°‘"è½¨è¿¹æ›²ç‡"ï¼ˆè·¯å¾„é•¿åº¦ä¸ç›´çº¿è·ç¦»ä¹‹æ¯”ï¼‰ã€‚

</div>

<hr />
<h2 id="4">ç¬¬4éƒ¨åˆ†ï¼šæ–¹æ³•è®ºå˜ä½“ã€æ‰¹åˆ¤æ€§æ¯”è¾ƒä¸ä¼˜åŒ–<a class="toc-link" href="#4" title="Permanent link">&para;</a></h2>
<h3 id="41">4.1 æ–¹æ³•å¯¹æ¯”è¡¨<a class="toc-link" href="#41" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è½¨è¿¹è®¾è®¡</th>
<th>è®­ç»ƒç›®æ ‡</th>
<th>é‡‡æ ·æ­¥æ•°</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>DDPM</strong></td>
<td>éšæœºï¼ˆå¸ƒæœ—è¿åŠ¨ï¼‰</td>
<td>ScoreåŒ¹é…</td>
<td>~1000</td>
<td>âœ… ç”Ÿæˆè´¨é‡é«˜</td>
<td>âŒ é‡‡æ ·ææ…¢<br>âŒ ä¸å¯é€†</td>
</tr>
<tr>
<td><strong>DDIM</strong></td>
<td>å»éšæœºåŒ–</td>
<td>ScoreåŒ¹é…</td>
<td>10-50</td>
<td>âœ… å¿«é€Ÿé‡‡æ ·<br>âœ… å¯é€†</td>
<td>âŒ ç†è®ºä¸å®Œå¤‡</td>
</tr>
<tr>
<td><strong>Score SDE</strong></td>
<td>SDEè½¨è¿¹</td>
<td>ScoreåŒ¹é…</td>
<td>50-200</td>
<td>âœ… ç†è®ºå®Œå¤‡</td>
<td>âŒ æ¨å¯¼å¤æ‚</td>
</tr>
<tr>
<td><strong>ç¡¬åˆšODE</strong></td>
<td>çƒ­ä¼ å¯¼æ–¹ç¨‹</td>
<td>ScoreåŒ¹é…</td>
<td>50-200</td>
<td>âœ… ç‰©ç†ç›´è§‰å¼º</td>
<td>âŒ éœ€æ±‚è§£PDE</td>
</tr>
<tr>
<td><strong>Rectified Flow</strong></td>
<td><strong>ç›´çº¿</strong></td>
<td><strong>é€Ÿåº¦åœºåŒ¹é…</strong></td>
<td><strong>10-20</strong></td>
<td>âœ… <strong>æç®€æ¡†æ¶</strong><br>âœ… <strong>æœ€å¿«é‡‡æ ·</strong><br>âœ… <strong>æœ€ä¼˜ä¼ è¾“</strong></td>
<td>âŒ éœ€è¦ReFlowè¿­ä»£</td>
</tr>
</tbody>
</table>
<h3 id="42-rectified-flow">4.2 Rectified Flowçš„æ‰¹åˆ¤æ€§åˆ†æ<a class="toc-link" href="#42-rectified-flow" title="Permanent link">&para;</a></h3>
<h4 id="_13"><strong>æ ¸å¿ƒç¼ºé™·</strong><a class="toc-link" href="#_13" title="Permanent link">&para;</a></h4>
<div class="note-box">

**ç¼ºé™·1ï¼šåˆå§‹é…å¯¹çš„éšæœºæ€§**

**é—®é¢˜**ï¼š
- ç¬¬1è½®è®­ç»ƒæ—¶ï¼Œ$\boldsymbol{x}_0$å’Œ$\boldsymbol{x}_1$æ˜¯**ç‹¬ç«‹é‡‡æ ·**çš„
- å®ƒä»¬ä¹‹é—´æ²¡æœ‰"çœŸæ­£çš„å¯¹åº”å…³ç³»"
- å¯¼è‡´å­¦åˆ°çš„é€Ÿåº¦åœºä¸å¤Ÿoptimal

**æ ¹æœ¬åŸå› **ï¼š
- æˆ‘ä»¬ä¸çŸ¥é“çœŸå®çš„æœ€ä¼˜ä¼ è¾“æ˜ å°„$T^*: \boldsymbol{x}_0 \mapsto \boldsymbol{x}_1$
- ç‹¬ç«‹é‡‡æ ·ç›¸å½“äºéšæœºé…å¯¹ï¼Œä¸$T^*$å¯èƒ½ç›¸å·®å¾ˆè¿œ

**å®šé‡å½±å“**ï¼š
- ç¬¬1è½®Rectified Flowçš„FIDçº¦ä¸º8-10ï¼ˆCIFAR-10ï¼‰
- æ¯”DDIMï¼ˆFID~5ï¼‰å·®
- éœ€è¦ReFlowè¿­ä»£æ”¹è¿›

</div>

<div class="note-box">

**ç¼ºé™·2ï¼šReFlowçš„è®¡ç®—å¼€é”€**

**é—®é¢˜**ï¼š
- æ¯è½®ReFlowéœ€è¦ï¼š
  1. ç”¨å½“å‰æ¨¡å‹é‡‡æ ·$N$ä¸ª$(\boldsymbol{x}_0, \boldsymbol{x}'_1)$å¯¹
  2. é‡æ–°è®­ç»ƒæ¨¡å‹
- å¦‚æœåš3è½®ReFlowï¼Œç›¸å½“äºè®­ç»ƒ3ä¸ªå®Œæ•´æ¨¡å‹

**å®šé‡åˆ†æ**ï¼š
- ç¬¬1è½®ï¼šè®­ç»ƒæ—¶é—´$T_1$
- ç¬¬2è½®ï¼šé‡‡æ ·$N$ä¸ªæ ·æœ¬ï¼ˆ$\sim 0.1T_1$ï¼‰ + è®­ç»ƒ$T_2$
- ç¬¬3è½®ï¼šé‡‡æ · + è®­ç»ƒ$T_3$
- **æ€»è®¡**ï¼š$\sim 3T + 0.2T = 3.2T$ï¼ˆè®­ç»ƒæ—¶é—´å¢åŠ 3å€ï¼‰

**ä¸DDPMå¯¹æ¯”**ï¼š
- DDPMåªéœ€è®­ç»ƒ1æ¬¡
- ä½†Rectified Flowé‡‡æ ·å¿«50å€
- Trade-offï¼šè®­ç»ƒæ…¢3å€ vs æ¨ç†å¿«50å€

</div>

<div class="note-box">

**ç¼ºé™·3ï¼šé«˜ç»´ç©ºé—´çš„"ç»´åº¦è¯…å’’"**

**é—®é¢˜**ï¼š
- åœ¨é«˜ç»´ç©ºé—´ï¼ˆå¦‚$d=50000$çš„å›¾åƒï¼‰ï¼Œç‹¬ç«‹é‡‡æ ·çš„$(\boldsymbol{x}_0, \boldsymbol{x}_1)$å‡ ä¹æ­£äº¤
- $\|\boldsymbol{x}_1 - \boldsymbol{x}_0\|$éå¸¸å¤§
- é€Ÿåº¦åœº$\boldsymbol{v} = \boldsymbol{x}_1 - \boldsymbol{x}_0$magnitudeå¾ˆå¤§ï¼Œéš¾ä»¥å­¦ä¹ 

**ç†è®ºåˆ†æ**ï¼š

åœ¨$d$ç»´æ ‡å‡†æ­£æ€åˆ†å¸ƒä¸‹ï¼š

$$
\mathbb{E}[\|\boldsymbol{x}_1 - \boldsymbol{x}_0\|^2] = 2d
$$

å½“$d=50000$æ—¶ï¼Œ$\|\boldsymbol{x}_1 - \boldsymbol{x}_0\| \approx 316$ï¼

**è§£å†³æ–¹æ¡ˆ**ï¼š
- åœ¨éšç©ºé—´ï¼ˆlatent spaceï¼‰åšRectified Flow
- å¦‚Stable Diffusionçš„VAEéšç©ºé—´ï¼ˆ$d=4\times 64\times 64=16384$ï¼‰
- æˆ–æ›´æ¿€è¿›çš„å‹ç¼©ï¼ˆ$d=256$ï¼‰

</div>

<h4 id="_14"><strong>ä¼˜åŒ–æ–¹å‘</strong><a class="toc-link" href="#_14" title="Permanent link">&para;</a></h4>
<div class="example-box">

**ä¼˜åŒ–1ï¼šä¸»åŠ¨å­¦ä¹ é…å¯¹ç­–ç•¥**

**ç­–ç•¥**ï¼šä¸ç”¨ç‹¬ç«‹é‡‡æ ·ï¼Œè€Œæ˜¯ç”¨å¯å‘å¼æ–¹æ³•æ‰¾"å¥½çš„é…å¯¹"ã€‚

**æ–¹æ³•1ï¼šåŸºäºç‰¹å¾çš„åŒ¹é…**
- å…ˆç”¨é¢„è®­ç»ƒç¼–ç å™¨ï¼ˆå¦‚CLIPï¼‰æå–ç‰¹å¾
- ç”¨åŒˆç‰™åˆ©ç®—æ³•ï¼ˆHungarian algorithmï¼‰æœ€å°åŒ–ç‰¹å¾è·ç¦»
- å¾—åˆ°æ›´"å¯¹åº”"çš„$(\boldsymbol{x}_0, \boldsymbol{x}_1)$å¯¹

**æ–¹æ³•2ï¼šæ¸è¿›å¼é…å¯¹**
- å…ˆç”¨ä½åˆ†è¾¨ç‡ï¼ˆå¦‚32Ã—32ï¼‰è®­ç»ƒä¸€ä¸ªç²—ç³™æ¨¡å‹
- ç”¨è¯¥æ¨¡å‹ç”Ÿæˆé…å¯¹
- å†åœ¨é«˜åˆ†è¾¨ç‡ï¼ˆ256Ã—256ï¼‰fine-tune

**æ•ˆæœ**ï¼š
- ç‰¹å¾åŒ¹é…ï¼šç¬¬1è½®FIDå¯ä»8é™è‡³6ï¼ˆ25%æå‡ï¼‰
- æ¸è¿›å¼ï¼šè®­ç»ƒæ—¶é—´å‡å°‘30%ï¼ŒFIDåŸºæœ¬ä¸å˜

</div>

<div class="example-box">

**ä¼˜åŒ–2ï¼šçŸ¥è¯†è’¸é¦åŠ é€ŸReFlow**

**ç­–ç•¥**ï¼šç”¨DDPMä½œä¸º"teacher"ï¼ŒRectified Flowä½œä¸º"student"ã€‚

**æ­¥éª¤**ï¼š
1. è®­ç»ƒä¸€ä¸ªé«˜è´¨é‡DDPMï¼ˆ1000æ­¥é‡‡æ ·ï¼‰
2. ç”¨DDPMé‡‡æ ·$N$ä¸ª$(\boldsymbol{x}_0, \boldsymbol{x}_1)$å¯¹
3. ç”¨è¿™äº›å¯¹è®­ç»ƒRectified Flowï¼ˆ10æ­¥é‡‡æ ·ï¼‰

**ä¼˜åŠ¿**ï¼š
- è·³è¿‡ç¬¬1è½®çš„"éšæœºé…å¯¹"
- ç›´æ¥å¾—åˆ°é«˜è´¨é‡æ¨¡å‹
- åªéœ€è®­ç»ƒ1æ¬¡ï¼ˆvs ReFlowçš„3æ¬¡ï¼‰

**æ•ˆæœ**ï¼š
- FIDä¸3è½®ReFlowæŒå¹³ï¼ˆ~3.5ï¼‰
- è®­ç»ƒæ—¶é—´å‡å°‘2/3

**Trade-off**ï¼šéœ€è¦å…ˆæœ‰ä¸€ä¸ªDDPMï¼ˆä½†DDPMé€šå¸¸å·²æœ‰é¢„è®­ç»ƒæ¨¡å‹ï¼‰

</div>

<div class="example-box">

**ä¼˜åŒ–3ï¼šæ··åˆç²¾åº¦ä¸é‡åŒ–**

**ç­–ç•¥**ï¼š
- **è®­ç»ƒæ—¶**ï¼šFP32ç²¾åº¦
- **é‡‡æ ·æ—¶**ï¼š
  - å‰5æ­¥ï¼šFP16ï¼ˆå…³é”®æ­¥éª¤ï¼‰
  - å5æ­¥ï¼šINT8ï¼ˆç»†èŠ‚è¡¥å……ï¼‰

**æ•ˆæœ**ï¼š
- æ¨ç†é€Ÿåº¦å†æå‡2å€
- å†…å­˜å‡åŠ
- FIDä¸‹é™<0.5ï¼ˆå‡ ä¹æ— æŸï¼‰

**å®ç°**ï¼š
- ä½¿ç”¨PyTorchçš„Automatic Mixed Precision (AMP)
- å¯¹é€Ÿåº¦åœºç½‘ç»œåšåè®­ç»ƒé‡åŒ–ï¼ˆPTQï¼‰

</div>

<h3 id="43">4.3 ä¸å…¶ä»–æ–¹æ³•çš„æ·±å…¥å¯¹æ¯”<a class="toc-link" href="#43" title="Permanent link">&para;</a></h3>
<h4 id="rectified-flow-vs-ddim"><strong>Rectified Flow vs DDIM</strong><a class="toc-link" href="#rectified-flow-vs-ddim" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>ç»´åº¦</th>
<th>Rectified Flow</th>
<th>DDIM</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æ¨å¯¼èµ·ç‚¹</strong></td>
<td>æ ·æœ¬å¯¹+è½¨è¿¹</td>
<td>DDPMå»éšæœºåŒ–</td>
</tr>
<tr>
<td><strong>è®­ç»ƒç›®æ ‡</strong></td>
<td>é€Ÿåº¦åœº$\boldsymbol{v}$</td>
<td>Score $\nabla \log p_t$</td>
</tr>
<tr>
<td><strong>ç†è®ºåŸºç¡€</strong></td>
<td>æœ€ä¼˜ä¼ è¾“</td>
<td>å˜åˆ†ä¸‹ç•Œ</td>
</tr>
<tr>
<td><strong>é‡‡æ ·æ­¥æ•°</strong></td>
<td>10-20æ­¥ï¼ˆæ›´å°‘ï¼‰</td>
<td>10-50æ­¥</td>
</tr>
<tr>
<td><strong>è·¯å¾„å½¢çŠ¶</strong></td>
<td>ç›´çº¿ï¼ˆæœ€ä¼˜ï¼‰</td>
<td>æ›²çº¿ï¼ˆæ¬¡ä¼˜ï¼‰</td>
</tr>
<tr>
<td><strong>ReFlowèƒ½åŠ›</strong></td>
<td>âœ… å¯è¿­ä»£ä¼˜åŒ–</td>
<td>âŒ æ— æ³•è¿›ä¸€æ­¥æ”¹è¿›</td>
</tr>
</tbody>
</table>
<p><strong>ä½•æ—¶é€‰æ‹©å“ªä¸ª</strong>ï¼Ÿ</p>
<ul>
<li><strong>ä»é›¶è®­ç»ƒ</strong>ï¼šRectified Flowï¼ˆæ›´ç®€å•ï¼‰</li>
<li><strong>å·²æœ‰DDPMæ¨¡å‹</strong>ï¼šDDIMï¼ˆæ— éœ€é‡æ–°è®­ç»ƒï¼‰</li>
<li><strong>éœ€è¦æè‡´é€Ÿåº¦</strong>ï¼šRectified Flow + ReFlow</li>
</ul>
<h4 id="rectified-flow-vs-flow-matching"><strong>Rectified Flow vs Flow Matching</strong><a class="toc-link" href="#rectified-flow-vs-flow-matching" title="Permanent link">&para;</a></h4>
<p><strong>Flow Matching</strong>ï¼ˆLipman et al., ICLR 2023ï¼‰ä¸Rectified Flowå‡ ä¹åŒæ—¶æå‡ºï¼Œæ€è·¯é«˜åº¦ç›¸ä¼¼ï¼</p>
<p><strong>å…±åŒç‚¹</strong>ï¼š
- éƒ½ä»æ ·æœ¬å¯¹å‡ºå‘
- éƒ½å­¦ä¹ é€Ÿåº¦åœº
- éƒ½æ”¯æŒç›´çº¿è½¨è¿¹</p>
<p><strong>å·®å¼‚</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>ç»´åº¦</th>
<th>Rectified Flow</th>
<th>Flow Matching</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ç†è®ºè§†è§’</strong></td>
<td>æœ€ä¼˜ä¼ è¾“</td>
<td>è¿ç»­å½’ä¸€åŒ–æµ</td>
</tr>
<tr>
<td><strong>è®­ç»ƒç›®æ ‡</strong></td>
<td>$\mathbb{E}[|\boldsymbol{v}_\theta - \dot{\boldsymbol{\varphi}}_t|^2]$</td>
<td>æ¡ä»¶æµåŒ¹é…</td>
</tr>
<tr>
<td><strong>ReFlow</strong></td>
<td>âœ… æ ¸å¿ƒåˆ›æ–°</td>
<td>âŒ æœªå¼ºè°ƒ</td>
</tr>
</tbody>
</table>
<p><strong>ç»“è®º</strong>ï¼šRectified Flowå’ŒFlow Matchingæ˜¯"æ®Šé€”åŒå½’"çš„ä¸¤ä¸ªç‹¬ç«‹å‘ç°ï¼</p>
<hr />
<h2 id="5">ç¬¬5éƒ¨åˆ†ï¼šå­¦ä¹ è·¯çº¿å›¾ä¸æœªæ¥å±•æœ›<a class="toc-link" href="#5" title="Permanent link">&para;</a></h2>
<h3 id="51">5.1 å­¦ä¹ è·¯çº¿å›¾<a class="toc-link" href="#51" title="Permanent link">&para;</a></h3>
<div class="example-box">

#### ğŸ“š å¿…å¤‡å‰ç½®çŸ¥è¯†

**æ•°å­¦åŸºç¡€**ï¼ˆâ­â­â­å¿…é¡»ï¼‰ï¼š
1. **å¸¸å¾®åˆ†æ–¹ç¨‹**ï¼šåŸºæœ¬è§£æ³•ã€å­˜åœ¨å”¯ä¸€æ€§
2. **æ¦‚ç‡è®º**ï¼šæ¡ä»¶æœŸæœ›ã€è¾¹ç¼˜åˆ†å¸ƒã€è”åˆåˆ†å¸ƒ
3. **æœ€ä¼˜ä¼ è¾“ç†è®º**ï¼ˆâ­æ–°å¢ï¼‰ï¼š
   - Monge-Kantoroviché—®é¢˜
   - Wassersteinè·ç¦»
   - æœ€ä¼˜ä¼ è¾“æ˜ å°„

**æœºå™¨å­¦ä¹ åŸºç¡€**ï¼ˆâ­â­æ¨èï¼‰ï¼š
- æ‰©æ•£æ¨¡å‹åŸºç¡€ï¼ˆDDPM/DDIMï¼‰
- Score-based models
- Flowæ¨¡å‹

**æ¨èå­¦ä¹ é¡ºåº**ï¼š

1. **åŸºç¡€**ï¼šå…ˆå­¦DDPMå’ŒDDIM
2. **ç†è®º**ï¼šå­¦ä¹ æœ€ä¼˜ä¼ è¾“ç†è®ºï¼ˆæ¨èæ•™æï¼šVillaniçš„ã€ŠOptimal Transportã€‹ï¼‰
3. **æœ¬æ–‡**ï¼šRectified Flow
4. **è¿›é˜¶**ï¼šFlow Matchingã€SchrÃ¶dinger Bridge

</div>

<div class="example-box">

#### ğŸ“– æ ¸å¿ƒè®ºæ–‡é˜…è¯»æ¸…å•

**Rectified Flowç³»åˆ—**ï¼š
1. **Liu et al. (ICLR 2023)** - "Flow Straight and Fast: Learning to Generate and Transfer Data with Rectified Flow" â­â­â­
   - åŸå§‹è®ºæ–‡ï¼Œå¿…è¯»

**ç›¸å…³å·¥ä½œ**ï¼š
2. **Lipman et al. (ICLR 2023)** - "Flow Matching for Generative Modeling"
   - åŒæ—¶æœŸç‹¬ç«‹å·¥ä½œï¼Œç†è®ºè§†è§’ç•¥æœ‰ä¸åŒ

3. **Song et al. (ICLR 2021)** - "Score-Based Generative Modeling through SDEs"
   - ç†è§£æ¦‚ç‡æµODE

**æœ€ä¼˜ä¼ è¾“èƒŒæ™¯**ï¼š
4. **Villani (2003)** - "Topics in Optimal Transportation"
   - ç»å…¸æ•™æï¼ˆç†è®ºæ·±ï¼‰

5. **Benamou & Brenier (2000)** - "A Computational Fluid Mechanics Solution to the Monge-Kantorovich Mass Transfer Problem"
   - åŠ¨æ€æœ€ä¼˜ä¼ è¾“çš„å¼€åˆ›æ€§å·¥ä½œ

**åº”ç”¨**ï¼š
6. **Esser et al. (2024)** - "Scaling Rectified Flow Transformers for High-Resolution Image Synthesis"
   - Stable Diffusion 3çš„æŠ€æœ¯æŠ¥å‘Š

</div>

<h3 id="52">5.2 ç ”ç©¶ç©ºç™½ä¸æœªæ¥æ–¹å‘<a class="toc-link" href="#52" title="Permanent link">&para;</a></h3>
<h4 id="1"><strong>æ–¹å‘1ï¼šç†è®ºå±‚é¢â€”â€”æ”¶æ•›æ€§ä¸æœ€ä¼˜æ€§ä¿è¯</strong><a class="toc-link" href="#1" title="Permanent link">&para;</a></h4>
<div class="note-box">

**ç ”ç©¶ç©ºç™½**ï¼š
- ReFlowçš„æ”¶æ•›é€Ÿåº¦ï¼Ÿéœ€è¦å¤šå°‘è½®æ‰èƒ½è¾¾åˆ°æœ€ä¼˜ï¼Ÿ
- æ˜¯å¦å­˜åœ¨æ›´å¥½çš„è½¨è¿¹ï¼ˆéç›´çº¿ï¼‰ï¼Ÿ
- é«˜ç»´ç©ºé—´çš„sample complexityï¼Ÿ

**å…·ä½“ç ”ç©¶é—®é¢˜**ï¼š

1. **é—®é¢˜**ï¼šReFlowçš„æ”¶æ•›ç‡ï¼Ÿ
   - **å·²çŸ¥**ï¼šå®éªŒä¸Š3-5è½®åŸºæœ¬æ”¶æ•›
   - **æœªçŸ¥**ï¼šç†è®ºä¸Šçš„æ”¶æ•›é€Ÿåº¦$O(1/k^p)$ï¼Ÿ
   - **æ½œåœ¨æ–¹æ³•**ï¼šç”¨å‹ç¼©æ˜ å°„å®šç†åˆ†æ

2. **é—®é¢˜**ï¼šéæ¬§ç©ºé—´ï¼ˆæµå½¢ï¼‰ä¸Šçš„Rectified Flowï¼Ÿ
   - **æŒ‘æˆ˜**ï¼šç›´çº¿ä¸å†æ˜¯æµ‹åœ°çº¿
   - **æ–¹å‘**ï¼šç”¨Riemannian geometryæ¨å¹¿

3. **é—®é¢˜**ï¼šæœ€ä¼˜è½¨è¿¹çš„å”¯ä¸€æ€§ï¼Ÿ
   - **å·²çŸ¥**ï¼šç›´çº¿å¯¹æ¬§æ°ç©ºé—´æœ€ä¼˜
   - **æœªçŸ¥**ï¼šå¯¹å…¶ä»–åº¦é‡ç©ºé—´å‘¢ï¼Ÿ

**é‡åŒ–ç›®æ ‡**ï¼š
- è¯æ˜ReFlowçš„$O(1/k)$æ”¶æ•›ç‡
- åœ¨SO(3)ä¸Šå®ç°Riemannian Rectified Flow

</div>

<h4 id="2_1"><strong>æ–¹å‘2ï¼šæ•ˆç‡å±‚é¢â€”â€”ä¸€æ­¥ç”Ÿæˆä¸æè‡´åŠ é€Ÿ</strong><a class="toc-link" href="#2_1" title="Permanent link">&para;</a></h4>
<div class="note-box">

**ç ”ç©¶ç©ºç™½**ï¼š
- å½“å‰æœ€å¿«ï¼š10æ­¥é‡‡æ ·
- ç›®æ ‡ï¼š1æ­¥ç”Ÿæˆï¼ˆGAN-levelï¼‰

**å…·ä½“ç ”ç©¶é—®é¢˜**ï¼š

1. **é—®é¢˜**ï¼šè’¸é¦Rectified Flowåˆ°1æ­¥ï¼Ÿ
   - **æ–¹æ³•**ï¼š
     - Consistencyè’¸é¦
     - ç›´æ¥ç›‘ç£$\boldsymbol{x}_0$é¢„æµ‹
   - **æŒ‘æˆ˜**ï¼šquality vs speed trade-off

2. **é—®é¢˜**ï¼šè‡ªé€‚åº”æ­¥æ•°ï¼Ÿ
   - **æ€è·¯**ï¼šç®€å•æ ·æœ¬1æ­¥ï¼Œå¤æ‚æ ·æœ¬10æ­¥
   - **æŠ€æœ¯**ï¼šå­¦ä¹ "éš¾åº¦ä¼°è®¡å™¨"

3. **é—®é¢˜**ï¼šç¥ç»ç®—å­åŠ é€Ÿï¼Ÿ
   - **æ–¹å‘**ï¼šç”¨Fourier Neural Operatorç›´æ¥å­¦$\boldsymbol{x}_0 \mapsto \boldsymbol{x}_1$

**é‡åŒ–ç›®æ ‡**ï¼š
- 1æ­¥ç”Ÿæˆï¼šFID < 10
- è‡ªé€‚åº”ï¼šå¹³å‡3æ­¥è¾¾åˆ°10æ­¥è´¨é‡

</div>

<h4 id="3_1"><strong>æ–¹å‘3ï¼šåº”ç”¨å±‚é¢â€”â€”è·¨åŸŸç”Ÿæˆä¸ç¼–è¾‘</strong><a class="toc-link" href="#3_1" title="Permanent link">&para;</a></h4>
<div class="note-box">

**æ½œåœ¨åº”ç”¨**ï¼š

1. **å›¾åƒåˆ°å›¾åƒç¿»è¯‘**ï¼š
   - æºåŸŸ$p_0$ï¼šè‰å›¾
   - ç›®æ ‡åŸŸ$p_1$ï¼šçœŸå®ç…§ç‰‡
   - Rectified Flowå­¦ä¹ æœ€çŸ­"ç¿»è¯‘è·¯å¾„"

2. **é£æ ¼è¿ç§»**ï¼š
   - å†…å®¹+é£æ ¼ â†’ èåˆå›¾åƒ
   - å¯æ§æ’å€¼ï¼ˆè°ƒèŠ‚$t$ï¼‰

3. **å›¾åƒç¼–è¾‘**ï¼š
   - åˆ©ç”¨å¯é€†æ€§ï¼šå›¾åƒ â†’ å™ªå£° â†’ ç¼–è¾‘ â†’ é‡å»º
   - æ¯”DDIMæ›´ç²¾å‡†ï¼ˆå› ä¸ºè·¯å¾„æ›´ç›´ï¼‰

4. **å¤šæ¨¡æ€ç”Ÿæˆ**ï¼š
   - æ–‡æœ¬ $\leftrightarrow$ å›¾åƒ $\leftrightarrow$ 3D
   - ç»Ÿä¸€çš„Rectified Flowæ¡†æ¶

**é‡åŒ–ç›®æ ‡**ï¼š
- å›¾åƒç¼–è¾‘ï¼šLPIPS < 0.1ï¼ˆé«˜ä¿çœŸï¼‰
- é£æ ¼è¿ç§»ï¼šFID < 5

</div>

<h4 id="4_1"><strong>æ–¹å‘4ï¼šè·¨å­¦ç§‘â€”â€”ä¸ç‰©ç†ã€ä¼˜åŒ–çš„èåˆ</strong><a class="toc-link" href="#4_1" title="Permanent link">&para;</a></h4>
<div class="note-box">

**ç ”ç©¶æ–¹å‘**ï¼š

1. **ç‰©ç†å¯å‘çš„è½¨è¿¹**ï¼š
   - æœ€å°ä½œç”¨é‡åŸç†
   - å“ˆå¯†é¡¿åŠ›å­¦
   - èƒ½å¦è®¾è®¡"æœ‰ç‰©ç†æ„ä¹‰"çš„è½¨è¿¹ï¼Ÿ

2. **ä¼˜åŒ–è§†è§’**ï¼š
   - Rectified Flow = è§£æœ€ä¼˜æ§åˆ¶é—®é¢˜
   - èƒ½å¦ç”¨Pontryaginæœ€å¤§å€¼åŸç†æ”¹è¿›ï¼Ÿ

3. **ä¸å…¶ä»–æ–¹æ³•çš„ç»Ÿä¸€**ï¼š
   - Rectified Flow + GAN = ?
   - Rectified Flow + VAE = ?
   - å¤§ç»Ÿä¸€ç”Ÿæˆæ¨¡å‹ç†è®ºï¼Ÿ

**é‡åŒ–ç›®æ ‡**ï¼š
- å»ºç«‹Rectified Flowä¸å˜åˆ†æ¨æ–­çš„ä¸¥æ ¼è”ç³»
- è¯æ˜æŸç±»è½¨è¿¹å¯¹åº”æŸç±»ç‰©ç†å®šå¾‹

</div>

<h3 id="53">5.3 å¼€æ”¾é—®é¢˜<a class="toc-link" href="#53" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Rectified Flowèƒ½å®Œå…¨æ›¿ä»£DDPMå—</strong>ï¼Ÿ
   - å½“å‰ï¼šè´¨é‡ç•¥å·®ï¼ˆ0.5 FIDï¼‰
   - æœªæ¥ï¼šæ˜¯å¦æœ‰ç†è®ºä¸Šçš„fundamental limitï¼Ÿ</p>
</li>
<li>
<p><strong>æœ€ä¼˜è½¨è¿¹çš„é€šç”¨characterization</strong>ï¼Ÿ
   - é™¤äº†ç›´çº¿ï¼Œè¿˜æœ‰å…¶ä»–"å¥½"è½¨è¿¹å—ï¼Ÿ
   - å¦‚ä½•è‡ªåŠ¨å‘ç°æœ€ä¼˜è½¨è¿¹ï¼Ÿ</p>
</li>
<li>
<p><strong>Rectified Flowçš„è¡¨è¾¾èƒ½åŠ›è¾¹ç•Œ</strong>ï¼Ÿ
   - å“ªäº›åˆ†å¸ƒå˜æ¢Rectified Flowæ— æ³•å­¦ä¹ ï¼Ÿ
   - ä¸normalizing flowçš„å…³ç³»ï¼Ÿ</p>
</li>
</ol>
<hr />
<h2 id="_15">æ€»ç»“ä¸å±•æœ›<a class="toc-link" href="#_15" title="Permanent link">&para;</a></h2>
<h3 id="_16">æ ¸å¿ƒè´¡çŒ®å›é¡¾<a class="toc-link" href="#_16" title="Permanent link">&para;</a></h3>
<p>Rectified Flowçš„<strong>é©å‘½æ€§åˆ›æ–°</strong>ï¼š</p>
<ol>
<li><strong>æç®€æ¡†æ¶</strong>ï¼š3æ­¥æ„å»ºODEæ‰©æ•£æ¨¡å‹ï¼ˆå†å²æœ€ç®€ï¼‰</li>
<li><strong>ç†è®ºæ·±åˆ»</strong>ï¼šè¿æ¥æœ€ä¼˜ä¼ è¾“ã€å˜åˆ†æ³•ã€ç‰©ç†å­¦</li>
<li><strong>å®ç”¨é«˜æ•ˆ</strong>ï¼š10æ­¥é‡‡æ ·è¾¾åˆ°50æ­¥DDIMè´¨é‡</li>
<li><strong>å¯è¿­ä»£æ”¹è¿›</strong>ï¼šReFlowæœºåˆ¶æŒç»­ä¼˜åŒ–</li>
</ol>
<h3 id="stable-diffusion-3">Stable Diffusion 3çš„åº”ç”¨<a class="toc-link" href="#stable-diffusion-3" title="Permanent link">&para;</a></h3>
<p><strong>2024å¹´æœ€æ–°è¿›å±•</strong>ï¼š
- Stable Diffusion 3é‡‡ç”¨Rectified Flowæ¶æ„
- ç»“åˆMMDiTï¼ˆMulti-Modal Diffusion Transformerï¼‰
- 50æ­¥é‡‡æ ·è¾¾åˆ°SOTAè´¨é‡
- è¯æ˜äº†Rectified Flowçš„å·¥ä¸šçº§å¯è¡Œæ€§</p>
<h3 id="_17">æœªæ¥å±•æœ›<a class="toc-link" href="#_17" title="Permanent link">&para;</a></h3>
<p>Rectified Flowå¼€å¯äº†æ‰©æ•£æ¨¡å‹çš„"<strong>ç®€æ´æ€§é©å‘½</strong>"ï¼š</p>
<ol>
<li><strong>ç†è®ºç®€åŒ–</strong>ï¼šä»å¤æ‚PDEåˆ°ç®€å•è½¨è¿¹</li>
<li><strong>ç®—æ³•ç®€åŒ–</strong>ï¼šä»1000æ­¥åˆ°10æ­¥</li>
<li><strong>å®ç°ç®€åŒ–</strong>ï¼šä»ScoreåŒ¹é…åˆ°é€Ÿåº¦åœºåŒ¹é…</li>
</ol>
<p><strong>ç»ˆæç›®æ ‡</strong>ï¼šä¸€æ­¥ç”Ÿæˆ + DDPMè´¨é‡ + å®Œå…¨å¯æ§</p>
<hr />
                </div>

                <!-- Previous/Next Navigation -->
                <nav class="post-navigation" aria-label="æ–‡ç« å¯¼èˆª">
                    <div class="row g-3">
                        <div class="col-6">
                            
                            <a href="googleæ–°æœå‡ºçš„ä¼˜åŒ–å™¨lionæ•ˆç‡ä¸æ•ˆæœå…¼å¾—çš„è®­ç»ƒç‹®.html" class="nav-link-prev">
                                <div class="nav-direction"><i class="fas fa-chevron-left"></i> ä¸Šä¸€ç¯‡</div>
                                <div class="nav-title">#218 Googleæ–°æœå‡ºçš„ä¼˜åŒ–å™¨Lionï¼šæ•ˆç‡ä¸æ•ˆæœå…¼å¾—çš„"è®­ç»ƒç‹®"</div>
                            </a>
                            
                        </div>
                        <div class="col-6">
                            
                            <a href="ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆåå…«å¾—åˆ†åŒ¹é…-æ¡ä»¶å¾—åˆ†åŒ¹é….html" class="nav-link-next">
                                <div class="nav-direction">ä¸‹ä¸€ç¯‡ <i class="fas fa-chevron-right"></i></div>
                                <div class="nav-title">#220 ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆåå…«ï¼‰ï¼šå¾—åˆ†åŒ¹é… = æ¡ä»¶å¾—åˆ†åŒ¹é…</div>
                            </a>
                            
                        </div>
                    </div>
                </nav>

                <!-- Back to Home -->
                <div class="text-center mt-4 mb-4">
                    <a href="../index.html" class="btn btn-outline-primary">
                        <i class="fas fa-arrow-left"></i> è¿”å›é¦–é¡µ
                    </a>
                </div>
            </div>

            <!-- Sidebar (TOC) -->
            <div class="col-lg-3">
                <aside class="sidebar">
                    
                    <div class="toc-sidebar">
                        <h5 class="toc-title"><i class="fas fa-list"></i> ç›®å½•</h5>
                        <div class="toc-content">
                            <div class="toc">
<ul>
<li><a href="#ode">ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆåä¸ƒï¼‰ï¼šæ„å»ºODEçš„ä¸€èˆ¬æ­¥éª¤ï¼ˆä¸‹ï¼‰</a><ul>
<li><a href="#_1">ğŸ“Œ å†…å®¹æ¦‚è§ˆ</a></li>
<li><a href="#_2">ç›´è§‚ç»“æœ</a></li>
<li><a href="#_3">ç®€å•ä¾‹å­</a></li>
<li><a href="#_4">è¯æ˜è¿‡ç¨‹</a></li>
<li><a href="#_5">è¯»åæ„Ÿå—</a></li>
<li><a href="#_6">æ–‡ç« å°ç»“</a></li>
<li><a href="#_7">å…¬å¼æ¨å¯¼ä¸æ³¨é‡Š</a><ul>
<li><a href="#1-ode">1. ä»æ ¼æ—å‡½æ•°åˆ°ODEçš„æå–æ–¹æ³•</a></li>
<li><a href="#2">2. æ¦‚ç‡å¯†åº¦æ¼”åŒ–çš„è·¯å¾„ç§¯åˆ†è¡¨ç¤º</a></li>
<li><a href="#3-time-marginalization">3. æ—¶é—´è¾¹é™…åŒ–ï¼ˆTime Marginalizationï¼‰</a></li>
<li><a href="#4-optimal-transport">4. æœ€ä¼˜ä¼ è¾“ï¼ˆOptimal Transportï¼‰è§†è§’</a></li>
<li><a href="#5-benamou-brenier">5. Benamou-Brenierå…¬å¼</a></li>
<li><a href="#6">6. åŠ¨åŠ›å­¦é‡æ„é—®é¢˜</a></li>
<li><a href="#7">7. åé—®é¢˜çš„æ­£åˆ™åŒ–ç†è®º</a></li>
<li><a href="#8">8. å˜åˆ†æ¨æ–­æ–¹æ³•</a></li>
<li><a href="#9">9. å®é™…ç®—æ³•å®ç°</a></li>
<li><a href="#10">10. æ•°å€¼å®éªŒéªŒè¯</a></li>
<li><a href="#_8">æ€»ç»“</a></li>
</ul>
</li>
<li><a href="#3">ç¬¬3éƒ¨åˆ†ï¼šæ•°å­¦ç›´è§‰ã€å¤šè§’åº¦è§£é‡Šä¸ç±»æ¯”</a><ul>
<li><a href="#31">3.1 ç”Ÿæ´»åŒ–ç±»æ¯”</a></li>
<li><a href="#32">3.2 å‡ ä½•æ„ä¹‰</a></li>
<li><a href="#33">3.3 å¤šè§’åº¦ç†è§£</a></li>
<li><a href="#34">3.4 å…³é”®æŠ€å·§çš„ç›´è§‰è§£é‡Š</a></li>
</ul>
</li>
<li><a href="#4">ç¬¬4éƒ¨åˆ†ï¼šæ–¹æ³•è®ºå˜ä½“ã€æ‰¹åˆ¤æ€§æ¯”è¾ƒä¸ä¼˜åŒ–</a><ul>
<li><a href="#41">4.1 æ–¹æ³•å¯¹æ¯”è¡¨</a></li>
<li><a href="#42-rectified-flow">4.2 Rectified Flowçš„æ‰¹åˆ¤æ€§åˆ†æ</a></li>
<li><a href="#43">4.3 ä¸å…¶ä»–æ–¹æ³•çš„æ·±å…¥å¯¹æ¯”</a></li>
</ul>
</li>
<li><a href="#5">ç¬¬5éƒ¨åˆ†ï¼šå­¦ä¹ è·¯çº¿å›¾ä¸æœªæ¥å±•æœ›</a><ul>
<li><a href="#51">5.1 å­¦ä¹ è·¯çº¿å›¾</a></li>
<li><a href="#52">5.2 ç ”ç©¶ç©ºç™½ä¸æœªæ¥æ–¹å‘</a></li>
<li><a href="#53">5.3 å¼€æ”¾é—®é¢˜</a></li>
</ul>
</li>
<li><a href="#_15">æ€»ç»“ä¸å±•æœ›</a><ul>
<li><a href="#_16">æ ¸å¿ƒè´¡çŒ®å›é¡¾</a></li>
<li><a href="#stable-diffusion-3">Stable Diffusion 3çš„åº”ç”¨</a></li>
<li><a href="#_17">æœªæ¥å±•æœ›</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

                        </div>
                        <div class="toc-actions">
                            <button class="btn btn-sm btn-outline-secondary" onclick="expandAll()">
                                <i class="fas fa-expand"></i> å…¨éƒ¨å±•å¼€
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="collapseAll()">
                                <i class="fas fa-compress"></i> å…¨éƒ¨æŠ˜å 
                            </button>
                        </div>
                    </div>
                    

                    <!-- Back to Top Button -->
                    <button id="backToTop" class="back-to-top" title="å›åˆ°é¡¶éƒ¨">
                        <i class="fas fa-arrow-up"></i>
                    </button>
                </aside>
            </div>
        </div>
    </article>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>
                åšå®¢æ¥æº: <a href="https://spaces.ac.cn" target="_blank">ç§‘å­¦ç©ºé—´</a> |
                å†…å®¹ç»è¿‡æ•´ç†å¹¶æ·»åŠ è¯¦ç»†æ•°å­¦æ¨å¯¼
            </p>
            <p>
                Powered by <a href="https://pages.github.com/" target="_blank">GitHub Pages</a>
            </p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Syntax highlighting -->
    <script>hljs.highlightAll();</script>

    <!-- Back to top functionality -->
    <script>
        // Show/hide back to top button based on scroll position
        window.addEventListener('scroll', function() {
            const backToTop = document.getElementById('backToTop');
            if (window.pageYOffset > 300) {
                backToTop.classList.add('show');
            } else {
                backToTop.classList.remove('show');
            }
        });

        // Smooth scroll to top
        document.getElementById('backToTop').addEventListener('click', function() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        // Sticky TOC sidebar
        window.addEventListener('scroll', function() {
            const sidebar = document.querySelector('.sidebar');
            if (!sidebar) return;

            const sidebarTop = sidebar.offsetTop;
            const scrollTop = window.pageYOffset;

            if (scrollTop > sidebarTop - 20) {
                sidebar.classList.add('sticky');
            } else {
                sidebar.classList.remove('sticky');
            }
        });
    </script>
</body>
</html>