<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>生成扩散模型漫谈（十三）：从万有引力到扩散模型 | ML & Math Blog Posts</title>
    <meta name="description" content="生成扩散模型漫谈（十三）：从万有引力到扩散模型&para;
原文链接: https://spaces.ac.cn/archives/9305
发布日期: 

对于很多读者来说，生成扩散模型可能是他们遇到的第一个能够将如此多的数学工具用到深度学习上的模型。在这个系列文章中，我们已经展示了扩散模型与数学分析、概率统计、常微分方程、随机微分方程乃至偏微分方程等内容的深刻联系，可以说，即便是做数学物理方程...">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css">

    <!-- Google Fonts -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/post.css">

    <!-- Custom JS -->
    <script src="../assets/js/collapsible.js" defer></script>

    <!-- MathJax for math rendering -->
    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true,
        processEnvironments: true
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Syntax highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/github.min.css">
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/highlight.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
        <div class="container">
            <a class="navbar-brand" href="../index.html">
                <i class="fas fa-brain"></i> ML & Math Blog
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../index.html"><i class="fas fa-home"></i> 首页</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Post Content -->
    <article class="container post-container my-5">
        <!-- Breadcrumb Navigation -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="../index.html"><i class="fas fa-home"></i> 首页</a></li>
                
                <li class="breadcrumb-item"><a href="../index.html?tags=引力">引力</a></li>
                
                <li class="breadcrumb-item active" aria-current="page">
                    #33 生成扩散模型漫谈（十三）：从万有引力到扩散模型
                </li>
            </ol>
        </nav>

        <!-- Post Header -->
        <header class="post-header mb-4">
            <h1 class="post-title">
                <span class="post-number">#33</span>
                生成扩散模型漫谈（十三）：从万有引力到扩散模型
            </h1>
            <div class="post-meta">
                <span><i class="far fa-calendar"></i> </span>
                
                <span class="ms-3">
                    <i class="fas fa-link"></i>
                    <a href="https://spaces.ac.cn/archives/9305" target="_blank" rel="noopener">原文链接</a>
                </span>
                
            </div>
            
            <div class="post-tags mt-3">
                
                <a href="../index.html?tags=引力" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> 引力</span>
                </a>
                
                <a href="../index.html?tags=场论" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> 场论</span>
                </a>
                
                <a href="../index.html?tags=生成模型" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> 生成模型</span>
                </a>
                
                <a href="../index.html?tags=扩散" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> 扩散</span>
                </a>
                
                <a href="../index.html?tags=生成模型" class="tag-link">
                    <span class="tag"><i class="fas fa-tag"></i> 生成模型</span>
                </a>
                
            </div>
            
        </header>

        <div class="row">
            <!-- Main Content -->
            <div class="col-lg-9">
                <!-- Post Body -->
                <div class="post-content">
                    <h1 id="_1">生成扩散模型漫谈（十三）：从万有引力到扩散模型<a class="toc-link" href="#_1" title="Permanent link">&para;</a></h1>
<p><strong>原文链接</strong>: <a href="https://spaces.ac.cn/archives/9305">https://spaces.ac.cn/archives/9305</a></p>
<p><strong>发布日期</strong>: </p>
<hr />
<p>对于很多读者来说，生成扩散模型可能是他们遇到的第一个能够将如此多的数学工具用到深度学习上的模型。在这个系列文章中，我们已经展示了扩散模型与数学分析、概率统计、常微分方程、随机微分方程乃至偏微分方程等内容的深刻联系，可以说，即便是做数学物理方程的纯理论研究的同学，大概率也可以在扩散模型中找到自己的用武之地。</p>
<p>在这篇文章中，我们再介绍一个同样与数学物理有深刻联系的扩散模型——由“万有引力定律”启发的ODE式扩散模型，出自论文<a href="https://papers.cool/arxiv/2209.11178">《Poisson Flow Generative Models》</a>（简称PFGM），它给出了一个构建ODE式扩散模型的全新视角。</p>
<h2 id="_2">万有引力<a class="toc-link" href="#_2" title="Permanent link">&para;</a></h2>
<p>中学时期我们就学过万有引力定律，大概的描述方式是：</p>
<blockquote>
<p>两个质点彼此之间相互吸引的作用力，是与它们的质量乘积成正比，并与它们之间的距离成平方反比。</p>
</blockquote>
<p>这里我们忽略质量和常数，主要关心它的方向和与距离的关系，假设引力源位于$\boldsymbol{y}$，那么位于$\boldsymbol{x}$的物体所受到的引力可以记为<br />
\begin{equation}\boldsymbol{F}(\boldsymbol{x}) = -\frac{1}{4\pi}\frac{\boldsymbol{x} - \boldsymbol{y}}{\Vert \boldsymbol{x} - \boldsymbol{y}\Vert^3}\label{eq:grad-3}\end{equation}<br />
$\frac{1}{4\pi}$这个因子我们可以先不管它，它不影响后面的分析。准确来说，上式描述的是三维空间的引力场，对于$d$维空间来说，其引力场的形式为<br />
\begin{equation}\boldsymbol{F}(\boldsymbol{x}) = -\frac{1}{S_d(1)}\frac{\boldsymbol{x} - \boldsymbol{y}}{\Vert \boldsymbol{x} - \boldsymbol{y}\Vert^d}\label{eq:grad-d}\end{equation}<br />
其中$S_d(1)$是$d$维单位超球面的表面积。该式实际上就是$d$维Poisson方程的格林函数的梯度，这也就是论文标题中的“Poisson”一词的来源。</p>
<h2 id="_3">沿场线走<a class="toc-link" href="#_3" title="Permanent link">&para;</a></h2>
<p>如果引力源有多个，那么直接将各个引力源的引力相加即可，这是引力场的线性可加性。下面我们画出了四个引力源的向量场，其中引力源用黑色点标记出，彩色线表示场线：  </p>
<p><a href="/usr/uploads/2022/10/3097555639.svg" title="点击查看原图"><img alt="引力场示意图" src="/usr/uploads/2022/10/3097555639.svg" /></a></p>
<p>引力场示意图</p>
<p>从上述引力场图我们可以看出它的一个重要特点：</p>
<blockquote>
<p>除了极少数外，大部分场线都是从远处出发，终止于某个引力源点。</p>
</blockquote>
<p>此时，一个直观而又“异想天开”的主意是：</p>
<blockquote>
<p>如果每个引力源都代表着一个要生成的真实样本点，那么远处的任意点只要沿着场线运动，不就都可以演变成一个真实样本点了吗？</p>
</blockquote>
<p>这就是<a href="https://papers.cool/arxiv/2209.11178">《Poisson Flow Generative Models》</a>一文最核心的天才想法！</p>
<h2 id="_4">等效质心<a class="toc-link" href="#_4" title="Permanent link">&para;</a></h2>
<p>当然，天才归天才，要将它真正变成一个可用的模型，还有很多细节要补充。比如我们刚才说“远处的任意点”，这就是扩散模型的初始分布了，那么问题就来了：“远处”是多远？“任意点”该如何采样？如果采样方式过于复杂，那也没有价值了。</p>
<p>幸运的是，引力场有一个非常重要的等效性质：</p>
<blockquote>
<p>无穷远处的多源引力场，等价于位于质心、质量叠加的质点引力场。</p>
</blockquote>
<p>也就是说，当距离足够远时，我们只需要当它是位于质心的单源质点引力场。下图也画出了多源引力场及其对应的质心引力场，可以看到，当距离变大时（橙色圆圈位置），两者的引力场几乎一致了。  </p>
<p><a href="/usr/uploads/2022/10/1214065996.svg" title="点击查看原图"><img alt="多源引力场" src="/usr/uploads/2022/10/1214065996.svg" /></a></p>
<p>多源引力场</p>
<p><a href="/usr/uploads/2022/10/488016129.svg" title="点击查看原图"><img alt="质心引力场" src="/usr/uploads/2022/10/488016129.svg" /></a></p>
<p>质心引力场</p>
<p>单个质点的引力场有什么特点？各向同性！这意味着在足够大半径时，可以认为场线是均匀地穿过以质点为球心的球面的，所以我们在一个半径足够大的球面上进行均匀采样就可以了，这就解决了初始分布的采样问题。至于“足够大”是多大，我们后面再说。</p>
<h2 id="_5">模式坍缩<a class="toc-link" href="#_5" title="Permanent link">&para;</a></h2>
<p>所以生成模型就这样构建好了？还没有。引力场的各向同性使得对应的初始分布易于采样，然而也会造成引力源的相互抵消现象，从而出现“模式坍缩（Mode Collapse）”。</p>
<p>具体来说，我们先来画出均匀分布在球壳上的引力场，它的分布是这样的：  </p>
<p><a href="/usr/uploads/2022/10/1113525710.svg" title="点击查看原图"><img alt="引力源各向同性的引力场" src="/usr/uploads/2022/10/1113525710.svg" /></a></p>
<p>引力源各向同性的引力场</p>
<p>发现特点了没？在球壳外部是正常的各向同性分布，但是在球壳内部是“空”的！也就是说球壳内部的引力场相互抵消了，相当于一个真空地带，这个现象笔者在十多年前的科普博客<a href="/archives/988">《球壳内部的均匀力场》</a>也介绍过。</p>
<p>抵消现象意味着任意选一个球面，球面上均匀分布的引力源由于引力相互抵消，那么就相当于不存在该引力源了。而我们说了，本文构建生成模型的方式，是通过远处的任意点沿着场线运动，直达某个引力源。如果引力源相互抵消，那么就意味着永远也达不到某些引力源，即意味着某些真实样本无法生成，生成结果就会缺失多样性，这就是“模式坍缩”现象。</p>
<h2 id="_6">增加一维<a class="toc-link" href="#_6" title="Permanent link">&para;</a></h2>
<p>看上去模式坍缩无论如何都是不能避免的。因为在构建生成模型的时候，我们通常假设真实样本服从一个连续型的分布，这样一来，任选一个球面，哪怕真实样本在该球面的分布不是均匀的，我们也能从中挑出一个均匀分布的“子集”，该“子集”的引力就相互抵消了，相当于这些数据点不存在了，继而发生模式坍缩。</p>
<p>那么这条路真的走到尽头了吗？并没有！这时候PFGM的第二个“天才想法”来了：<strong>增加一维！</strong></p>
<p>刚才我们分析了，模式坍缩无法避免，是因为连续性分布的假设导致各向同性无法避免。要想避免模式坍缩，就要想办法杜绝分布的各向同性。可是真实样本的分布是目标分布，这是不能改变的，然而我们可以给它增加一维，如果我们在$d+1$维空间去讨论，那么原来的$d$维分布可以视为$d+1$维空间的一个平面，平面就不可能各向同性了。举个低维空间的例子。我们知道对于二维空间来说，“圆”是各向同性的，但对于三维空间来说，“球”才是各向同性的，二维空间中各向同性的“圆”，在三维空间看来就不是各向同性了。</p>
<p>所以，假设要生成的真实样本原来是$\boldsymbol{x}\in\mathbb{R}^d$的，我们引入一个新维度$t$，使得数据点变为$(\boldsymbol{x},t)\in\mathbb{R}^{d+1}$，而原来真实样本服从的分布是$\boldsymbol{x}\sim \tilde{p}(\boldsymbol{x})$的，现在改为$(\boldsymbol{x},t)\sim \delta(t)\tilde{p}(\boldsymbol{x})$，其中$\delta(t)$是狄拉克分布，其实就是将真实样本放到$d+1$维空间的$t=0$平面上。这样处理后，在$d+1$维空间中，真实样本点的$t$取值总是0，因此就不能出现各向同性现象了（类比刚才“三维空间中的圆”的例子）。</p>
<h2 id="_7">豁然开朗<a class="toc-link" href="#_7" title="Permanent link">&para;</a></h2>
<p>乍一看，增加一维只是一个数学上的小技巧，但细细品味之下，我们会越发感觉它妙不可言，很多在原来$d$维空间中不好处理的细节问题，在$d+1$维空间中就豁然开朗了。</p>
<p>根据式$\eqref{eq:grad-d}$和引力的线性叠加性，我们可以写出此时$d+1$维空间的引力场为<br />
\begin{equation}\begin{aligned}<br />
\boldsymbol{F}(\boldsymbol{x}, t) =&amp;\, -\frac{1}{S_{d+1}(1)}\iint\frac{(\boldsymbol{x} - \boldsymbol{x}<em d_1="d+1">0, t - t_0)}{(\Vert\boldsymbol{x} - \boldsymbol{x}_0\Vert^2 + (t - t_0)^2)^{(d+1)/2}}\delta(t_0)\tilde{p}(\boldsymbol{x}_0) d\boldsymbol{x}_0dt_0 \\<br />
=&amp;\, -\frac{1}{S</em>}(1)}\int\frac{(\boldsymbol{x} - \boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">0, t)}{(\Vert\boldsymbol{x} - \boldsymbol{x}_0\Vert^2 + t^2)^{(d+1)/2}}\tilde{p}(\boldsymbol{x}_0) d\boldsymbol{x}_0 \\<br />
\triangleq&amp;\, (\boldsymbol{F}</em>}}, \boldsymbol{F<em _boldsymbol_x="\boldsymbol{x">t)<br />
\end{aligned}\label{eq:field}\end{equation}<br />
其中$\boldsymbol{F}</em>}}$是$\boldsymbol{F}(\boldsymbol{x}, t)$的前$d$个分量，$\boldsymbol{F<em _boldsymbol_x="\boldsymbol{x">t$是它的第$d+1$个分量。下一节我们再来讨论$\boldsymbol{F}(\boldsymbol{x}, t)$怎么学，现在假设$\boldsymbol{F}(\boldsymbol{x}, t)$已经知道了，那么接下来就是要沿着场线运动，也就是运动轨迹要时刻跟$\boldsymbol{F}(\boldsymbol{x}, t)$同方向，即<br />
\begin{equation}(d\boldsymbol{x}, dt) = (\boldsymbol{F}</em>}}, \boldsymbol{F<em _boldsymbol_x="\boldsymbol{x">t) d\tau\quad\Rightarrow\quad \frac{d\boldsymbol{x}}{dt} = \frac{\boldsymbol{F}</em>}}}{\boldsymbol{F}_t}\label{eq:ode}\end{equation<br />
这就是生成过程所需要的微分方程（ODE）。在之前的$d$维方案中，除了有模式坍缩问题外，什么时候终止也是一个不好处理的细节问题。直观来想，就是沿着场线运动，直到撞上一个真实样本后就停止，但什么时候才是“撞上”，这个并不好判断。而在$d+1$维方案中，我们知道真实样本都是在$t=0$这个面上，所以可以很自然地以$t=0$为终止信号了。</p>
<p>至于初始分布，按照前面的讨论，应该是“半径足够大的、$d+1$维的球面均匀分布”，但既然我们是以$t=0$为终止信号，那么我们不妨固定一个足够大的$t=T$（大致是$40\sim 100$这个量级），然后在$t=T$这个平面上做采样，这样一来生成过程就变成了微分方程$\eqref{eq:ode}$从$t=T$到$t=0$的运动过程了，生成过程的始和终都变得相当明朗。</p>
<p>当然，如果在固定的$t=T$平面上采样，那肯定就不是均匀的了。事实上有：<br />
\begin{equation}p_{prior}(\boldsymbol{x}) \propto \frac{1}{(\Vert\boldsymbol{x}\Vert^2 + T^2)^{(d+1)/2}}\end{equation}<br />
推导过程见下面的框。可以看到，概率密度只依赖于模长$\Vert\boldsymbol{x}\Vert$，所以从该分布采样的方案是先按照特定的分布采样模长，然后再按均匀分布采样方向，将两者进行组合。对于模长的采样，记$r=\Vert\boldsymbol{x}\Vert$，我们将它换元到超球坐标，就可以得到$p_{prior}(r)\propto r^{d-1}(r^2 + T^2)^{-(d+1)/2}$，然后利用逆累积概率函数法进行采样就行了（参考<a href="/archives/8404#%E7%89%B9%E6%AE%8A%E6%96%B9%E5%90%91">《变分自编码器（七）：球面上的VAE（vMF-VAE）》</a>）。</p>
<blockquote>
<p><strong>初始分布的推导：</strong> 场线是均匀穿过$d+1$维超球面上的，所以$(\boldsymbol{x}, T)$处的密度是反比于$S_{d+1}(\boldsymbol{x}, T)$，即$\propto \frac{1}{(\Vert\boldsymbol{x}\Vert^2 + T^2)^{d/2}}$，但现在不是在球面，而是在$t=T$的平面上，所以我们要将球面投影到平面上，示意图如下：  </p>
<p><a href="/usr/uploads/2022/10/1762495694.svg" title="点击查看原图"><img alt="球面到t=T平面的投影" src="/usr/uploads/2022/10/1762495694.svg" /></a></p>
<p>球面到t=T平面的投影</p>
<p>如上图，当$B$、$D$两点充分接近时，有$\Delta OAB\sim \Delta BDC$，所以<br />
 \begin{equation}\frac{|BC|}{|BD|} = \frac{|OB|}{|OA|} = \frac{\sqrt{\Vert\boldsymbol{x}\Vert^2 + T^2}}{T}\end{equation}<br />
 也就是说，原本球面上单位长度的弧，投影到平面上后长度变为了$\frac{\sqrt{\Vert\boldsymbol{x}\Vert^2 + T^2}}{T}$倍，由于只有一个维度变化，所以原来球面上的面积元，投影后也变为$\frac{\sqrt{\Vert\boldsymbol{x}\Vert^2 + T^2}}{T}$倍，因此根据概率反比面积，我们可以得到<br />
 \begin{equation}p_{prior}(\boldsymbol{x}) \propto \frac{1}{S_{d+1}(\boldsymbol{x}, T)}\times \frac{T}{\sqrt{\Vert\boldsymbol{x}\Vert^2 + T^2}}\propto \frac{1}{(\Vert\boldsymbol{x}\Vert^2 + T^2)^{(d+1)/2}}\end{equation}</p>
</blockquote>
<h2 id="_8">场的训练<a class="toc-link" href="#_8" title="Permanent link">&para;</a></h2>
<p>现在，初始分布有了，微分方程也有了，所以就只差向量场函数$\boldsymbol{F}(\boldsymbol{x}, t)$的训练了。从微分方程$\eqref{eq:ode}$可以看出，它只依赖于向量场的相对值，因此向量场的缩放不影响最终结果。根据式$\eqref{eq:field}$，向量场可以写为<br />
\begin{equation}\boldsymbol{F}(\boldsymbol{x}, t) = \mathbb{E}<em _boldsymbol_x="\boldsymbol{x">{\boldsymbol{x}_0\sim \tilde{p}(\boldsymbol{x}_0)}\left[-\frac{(\boldsymbol{x} - \boldsymbol{x}_0, t)}{(\Vert\boldsymbol{x} - \boldsymbol{x}_0\Vert^2 + t^2)^{(d+1)/2}}\right]\end{equation}<br />
根据我们在<a href="/archives/9209">《生成扩散模型漫谈（五）：一般框架之SDE篇》</a>、<a href="/archives/9245">《生成扩散模型漫谈（七）：最优扩散方差估计（上）》</a>等文章多次用到一个结论：<br />
\begin{equation}\mathbb{E}</em>}}[\boldsymbol{x}] = \mathop{\text{argmin}<em _boldsymbol_x="\boldsymbol{x">{\boldsymbol{\mu}}\mathbb{E}</em>}}\left[\Vert \boldsymbol{x} - \boldsymbol{\mu}\Vert^2\right]\end{equation<br />
我们可以引入函数$\boldsymbol{s}<em _boldsymbol_x="\boldsymbol{x">{\boldsymbol{\theta}}(\boldsymbol{x}, t)$来学习$\boldsymbol{F}(\boldsymbol{x}, t)$，训练目标为<br />
\begin{equation}\mathbb{E}</em><em _boldsymbol_theta="\boldsymbol{\theta">0\sim \tilde{p}(\boldsymbol{x}_0)}\left[\left\Vert\boldsymbol{s}</em>}}(\boldsymbol{x}, t) + \frac{(\boldsymbol{x} - \boldsymbol{x<em _boldsymbol_x="\boldsymbol{x">0, t)}{(\Vert\boldsymbol{x} - \boldsymbol{x}_0\Vert^2 + t^2)^{(d+1)/2}}\right\Vert^2\right]\label{eq:loss}\end{equation}<br />
然而，上述目标的$\boldsymbol{x},t$还需要采样，它的采样方式没有明确定义。这就是PFGM的主要特点之一，它直接定义了反向过程（生成过程），不需要定义前向过程，而这一步的采样实际上就相当于前向过程。为此，原论文考虑地每个真实样本进行扰动的方式来构建$\boldsymbol{x},t$的样本：<br />
\begin{equation}\boldsymbol{x} = \boldsymbol{x}_0 + \Vert \boldsymbol{\varepsilon}</em>}}\Vert (1+\tau)^m \boldsymbol{u},\quad t = |\varepsilon_t| (1+\tau)^m\end{equation<br />
其中$(\boldsymbol{\varepsilon}<em _d_1_times_d_1_="(d+1)\times(d+1)">{\boldsymbol{x}},\varepsilon_t)\sim\mathcal{N}(\boldsymbol{0}, \sigma^2\boldsymbol{I}</em>$是$d$维单位球面上均匀分布的单位向量，而$\tau,\sigma,M$则都是常数。~~这个设计有颇多的主观性，大家自行欣赏和领会即可，这里不做过多展开。~~ 后续讨论请看})$，$m\sim U[0,M]$，$\boldsymbol{u<a href="/archives/9370#%E9%97%AE%E9%A2%98%E9%87%8D%E6%8B%BE">这里</a>。</p>
<p>最后，原论文的训练目标跟本文的式$\eqref{eq:loss}$略有不同，大致相当于<br />
\begin{equation}\left\Vert\boldsymbol{s}<em _boldsymbol_x="\boldsymbol{x">{\boldsymbol{\theta}}(\boldsymbol{x}, t) + \text{Normalize}\left(\mathbb{E}</em>}_0\sim \tilde{p}(\boldsymbol{x}_0)}\left[\frac{(\boldsymbol{x} - \boldsymbol{x}_0, t)}{(\Vert\boldsymbol{x} - \boldsymbol{x}_0\Vert^2 + t^2)^{(d+1)/2}}\right]\right)\right\Vert^2\end{equation<br />
实际训练时由于只能采样有限个$\boldsymbol{x}_0$对括号里边的期望进行估算，因此该目标实际上是一个有偏估计。当然有偏不一定就比无偏更差，具体为什么原论文使用有偏估计，这里暂时不得而知，猜测是因为有偏估计由于对向量进行了归一化操作，可能会使得训练进程更加稳定，但是也因为有偏的估计进行了归一化，所以需要较大的batch_size才能比较准，这对实验成本提了要求。</p>
<h2 id="_9">实验结果<a class="toc-link" href="#_9" title="Permanent link">&para;</a></h2>
<p>可以说，PFGM是一个彻底的新框架，它不再像之前一样依赖于高斯假设，并且得到了一个确实有着全新内涵的模型。然而，我们不能“为新而新”，如果新的框架没有做出更有说服力的结果，那么新就是没有意义的。</p>
<p>当然，原论文的实验结果，肯定了PFGM的价值，比如得到了更好的评估指标、更快的生成速度，以及对超参数（包括模型架构）有更好的鲁棒性等，这里就不一一展示了，大家自行读原论文就好。我看了看原论文中了NeurIPS 2022，不得不说这确实是实至名归的顶会论文啊！</p>
<blockquote>
<p><strong>官方Github：<a href="https://github.com/Newbeeer/Poisson_flow">https://github.com/Newbeeer/Poisson_flow</a></strong></p>
</blockquote>
<p><a href="/usr/uploads/2022/10/3603165335.png" title="点击查看原图"><img alt="PFGM的实验结果（部分）" src="/usr/uploads/2022/10/3603165335.png" /></a></p>
<p>PFGM的实验结果（部分）</p>
<h2 id="_10">文章小结<a class="toc-link" href="#_10" title="Permanent link">&para;</a></h2>
<p>本文介绍了一个由“万有引力定律”启发的ODE式扩散模型，它突破了以往众多扩散模型对高斯假设的依赖，是一个基于场论来构建ODE式扩散模型的全新框架，整个模型颇多启发性，值得仔细研读。</p>
<p><em><strong>转载到请包括本文地址：</strong><a href="https://spaces.ac.cn/archives/9305">https://spaces.ac.cn/archives/9305</a></em></p>
<p><em><strong>更详细的转载事宜请参考：</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="《科学空间FAQ》">《科学空间FAQ》</a></p>
<p><strong>如果您还有什么疑惑或建议，欢迎在下方评论区继续讨论。</strong></p>
<p><strong>如果您觉得本文还不错，欢迎分享/打赏本文。打赏并非要从中获得收益，而是希望知道科学空间获得了多少读者的真心关注。当然，如果你无视它，也不会影响你的阅读。再次表示欢迎和感谢！</strong></p>
<p>打赏</p>
<p><img alt="科学空间" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>微信打赏</p>
<p><img alt="科学空间" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>支付宝打赏</p>
<p>因为网站后台对打赏并无记录，因此欢迎在打赏时候备注留言。你还可以<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>点击这里</strong></a>或在下方评论区留言来告知你的建议或需求。</p>
<p><strong>如果您需要引用本文，请参考：</strong></p>
<p>苏剑林. (Oct. 18, 2022). 《生成扩散模型漫谈（十三）：从万有引力到扩散模型 》[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/9305">https://spaces.ac.cn/archives/9305</a></p>
<p>@online{kexuefm-9305,<br />
title={生成扩散模型漫谈（十三）：从万有引力到扩散模型},<br />
author={苏剑林},<br />
year={2022},<br />
month={Oct},<br />
url={\url{https://spaces.ac.cn/archives/9305}},<br />
} </p>
<hr />
<h2 id="_11">公式推导与注释<a class="toc-link" href="#_11" title="Permanent link">&para;</a></h2>
<p>TODO: 添加详细的数学公式推导和注释</p>
                </div>

                <!-- Previous/Next Navigation -->
                <nav class="post-navigation" aria-label="文章导航">
                    <div class="row g-3">
                        <div class="col-6">
                            
                            <a href="从hessian近似看自适应学习率优化器.html" class="nav-link-prev">
                                <div class="nav-direction"><i class="fas fa-chevron-left"></i> 上一篇</div>
                                <div class="nav-title">#32 从Hessian近似看自适应学习率优化器</div>
                            </a>
                            
                        </div>
                        <div class="col-6">
                            
                            <a href="transformer升级之路6旋转位置编码的完备性分析.html" class="nav-link-next">
                                <div class="nav-direction">下一篇 <i class="fas fa-chevron-right"></i></div>
                                <div class="nav-title">#34 Transformer升级之路：6、旋转位置编码的完备性分析</div>
                            </a>
                            
                        </div>
                    </div>
                </nav>

                <!-- Back to Home -->
                <div class="text-center mt-4 mb-4">
                    <a href="../index.html" class="btn btn-outline-primary">
                        <i class="fas fa-arrow-left"></i> 返回首页
                    </a>
                </div>
            </div>

            <!-- Sidebar (TOC) -->
            <div class="col-lg-3">
                <aside class="sidebar">
                    
                    <div class="toc-sidebar">
                        <h5 class="toc-title"><i class="fas fa-list"></i> 目录</h5>
                        <div class="toc-content">
                            <div class="toc">
<ul>
<li><a href="#_1">生成扩散模型漫谈（十三）：从万有引力到扩散模型</a><ul>
<li><a href="#_2">万有引力</a></li>
<li><a href="#_3">沿场线走</a></li>
<li><a href="#_4">等效质心</a></li>
<li><a href="#_5">模式坍缩</a></li>
<li><a href="#_6">增加一维</a></li>
<li><a href="#_7">豁然开朗</a></li>
<li><a href="#_8">场的训练</a></li>
<li><a href="#_9">实验结果</a></li>
<li><a href="#_10">文章小结</a></li>
<li><a href="#_11">公式推导与注释</a></li>
</ul>
</li>
</ul>
</div>

                        </div>
                        <div class="toc-actions">
                            <button class="btn btn-sm btn-outline-secondary" onclick="expandAll()">
                                <i class="fas fa-expand"></i> 全部展开
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="collapseAll()">
                                <i class="fas fa-compress"></i> 全部折叠
                            </button>
                        </div>
                    </div>
                    

                    <!-- Back to Top Button -->
                    <button id="backToTop" class="back-to-top" title="回到顶部">
                        <i class="fas fa-arrow-up"></i>
                    </button>
                </aside>
            </div>
        </div>
    </article>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>
                博客来源: <a href="https://spaces.ac.cn" target="_blank">科学空间</a> |
                内容经过整理并添加详细数学推导
            </p>
            <p>
                Powered by <a href="https://pages.github.com/" target="_blank">GitHub Pages</a>
            </p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Syntax highlighting -->
    <script>hljs.highlightAll();</script>

    <!-- Back to top functionality -->
    <script>
        // Show/hide back to top button based on scroll position
        window.addEventListener('scroll', function() {
            const backToTop = document.getElementById('backToTop');
            if (window.pageYOffset > 300) {
                backToTop.classList.add('show');
            } else {
                backToTop.classList.remove('show');
            }
        });

        // Smooth scroll to top
        document.getElementById('backToTop').addEventListener('click', function() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        // Sticky TOC sidebar
        window.addEventListener('scroll', function() {
            const sidebar = document.querySelector('.sidebar');
            if (!sidebar) return;

            const sidebarTop = sidebar.offsetTop;
            const scrollTop = window.pageYOffset;

            if (scrollTop > sidebarTop - 20) {
                sidebar.classList.add('sticky');
            } else {
                sidebar.classList.remove('sticky');
            }
        });
    </script>
</body>
</html>