<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>矩阵平方根和逆平方根的高效计算 | ML & Math Blog Posts</title>
    <meta name="description" content="矩阵平方根和逆平方根的高效计算
原文链接: https://spaces.ac.cn/archives/11158
发布日期: 

设$\boldsymbol{P}\in\mathbb{R}^{n\times n}$是一个特征值都是非负实数的$n$阶方阵，本文来讨论它的平方根$\boldsymbol{P}^{1/2}$和逆平方根$\boldsymbol{P}^{-1/2}$的计算。
基本概念
矩阵...">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css">

    <!-- Google Fonts -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/post.css">

    <!-- MathJax for math rendering -->
    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true,
        processEnvironments: true
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Syntax highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/github.min.css">
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/highlight.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
        <div class="container">
            <a class="navbar-brand" href="../index.html">
                <i class="fas fa-brain"></i> ML & Math Blog
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../index.html"><i class="fas fa-home"></i> 首页</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Post Content -->
    <article class="container post-container my-5">
        <!-- Post Header -->
        <header class="post-header mb-4">
            <h1 class="post-title">矩阵平方根和逆平方根的高效计算</h1>
            <div class="post-meta">
                <span><i class="far fa-calendar"></i> </span>
                
                <span class="ms-3">
                    <i class="fas fa-link"></i>
                    <a href="https://spaces.ac.cn/archives/11158" target="_blank">原文链接</a>
                </span>
                
            </div>
            
            <div class="post-tags mt-3">
                
                <span class="tag"><i class="fas fa-tag"></i> 代数</span>
                <span class="tag"><i class="fas fa-tag"></i> 迭代</span>
                <span class="tag"><i class="fas fa-tag"></i> 矩阵</span>
                <span class="tag"><i class="fas fa-tag"></i> 线性</span>
                <span class="tag"><i class="fas fa-tag"></i> 生成模型</span>
                
            </div>
            
        </header>

        <!-- Post Body -->
        <div class="post-content">
            <h1 id="_1">矩阵平方根和逆平方根的高效计算</h1>
<p><strong>原文链接</strong>: <a href="https://spaces.ac.cn/archives/11158">https://spaces.ac.cn/archives/11158</a></p>
<p><strong>发布日期</strong>: </p>
<hr />
<p>设$\boldsymbol{P}\in\mathbb{R}^{n\times n}$是一个特征值都是非负实数的$n$阶方阵，本文来讨论它的平方根$\boldsymbol{P}^{1/2}$和逆平方根$\boldsymbol{P}^{-1/2}$的计算。</p>
<h2 id="_2">基本概念</h2>
<p>矩阵$\boldsymbol{P}$的平方根，指的是满足$\boldsymbol{X}^2=\boldsymbol{P}$的矩阵$\boldsymbol{X}$。我们知道正数都有两个平方根，因此不难想象矩阵平方根一般也不唯一。不过，“算术平方根”是唯一的，一个正数的算术平方根是正的那个平方根，类似地，我们将$\boldsymbol{P}$的特征值全是非负数的那个平方根称为算术平方根。本文要求的矩阵平方根，默认都是指算术平方根。</p>
<p>本文的计算依赖于我们在<a href="/archives/11056">《矩阵符号函数mcsgn能计算什么？》</a>讨论过的矩阵符号函数：<br />
\begin{equation}\newcommand{mcsgn}{\mathop{\text{mcsgn}}}\mcsgn(\boldsymbol{M}) = (\boldsymbol{M}^2)^{-1/2}\boldsymbol{M}= \boldsymbol{M}(\boldsymbol{M}^2)^{-1/2}<br />
\end{equation}<br />
简单来说，它就是把任意矩阵$\boldsymbol{M}\in\mathbb{R}^{n\times n}$的特征值变成对应的符号函数的新矩阵。假设$\boldsymbol{M}$的特征值都是实数，那么$\mcsgn$可以通过Newton-Schulz迭代高效计算：<br />
\begin{equation}\newcommand{tr}{\mathop{\text{tr}}}\boldsymbol{X}<em t_1="t+1">0 = \frac{\boldsymbol{M}}{\sqrt{\tr(\boldsymbol{M}^2)}},\qquad \boldsymbol{X}</em>} = a_{t+1}\boldsymbol{X<em t_1="t+1">t + b</em>}\boldsymbol{X<em t_1="t+1">t^3 + c</em>}\boldsymbol{X}_t^5\end{equation<br />
其中$\frac{\boldsymbol{M}}{\sqrt{\tr(\boldsymbol{M}^2)}}$是为了将$\boldsymbol{X}_0$的特征值都缩放到$[-1,1]$内，而$a_t,b_t,c_t$是<a href="/archives/10996">《msign算子的Newton-Schulz迭代（下）》</a>所推导的系数：<br />
\begin{array}{c|ccc}<br />
\hline<br />
t &amp; a\times 1.01 &amp; b\times 1.01^3 &amp; c\times 1.01^5 \\<br />
\hline<br />
\quad 1\quad &amp; 8.28721 &amp; -23.5959 &amp; 17.3004 \\<br />
2 &amp; 4.10706 &amp; -2.94785 &amp; 0.544843 \\<br />
3 &amp; 3.94869 &amp; -2.9089 &amp; 0.551819 \\<br />
4 &amp; 3.31842 &amp; -2.48849 &amp; 0.510049 \\<br />
5 &amp; 2.30065 &amp; -1.6689 &amp; 0.418807 \\<br />
6 &amp; 1.8913 &amp; 1.268 &amp; 0.376804 \\<br />
7 &amp; 1.875 &amp; -1.25 &amp; 0.375 \\<br />
8 &amp; 1.875 &amp; -1.25 &amp; 0.375 \\<br />
\hline<br />
\end{array}<br />
实际上，当$\boldsymbol{M}$的特征值全都是实数时，$\mcsgn$的计算原理跟另一种矩阵符号函数$\newcommand{msign}{\mathop{\text{msign}}}\msign$是相通的。</p>
<h2 id="_3">计算原理</h2>
<p>接下来计算的出发点是恒等式<br />
\begin{equation}\mcsgn\left(\begin{bmatrix}\boldsymbol{0} &amp; \boldsymbol{A} \\ \boldsymbol{B} &amp; \boldsymbol{0}\end{bmatrix}\right)=\begin{bmatrix}\boldsymbol{0} &amp; \boldsymbol{A}(\boldsymbol{B}\boldsymbol{A})^{-1/2} \\ \boldsymbol{B}(\boldsymbol{A}\boldsymbol{B})^{-1/2} &amp; \boldsymbol{0}\end{bmatrix}\label{eq:core}\end{equation}<br />
直接代入$\mcsgn$的定义就可以验证上式成立（注：$\boldsymbol{A},\boldsymbol{B}$未必是方阵）。接下来我们要确定什么情况下左端求$\mcsgn$的矩阵的特征值全都是实数。设$\lambda$是它的一个非零特征值，那么<br />
\begin{equation}0=\det\left(\lambda\boldsymbol{I} - \begin{bmatrix}\boldsymbol{0} &amp; \boldsymbol{A} \\ \boldsymbol{B} &amp; \boldsymbol{0} \end{bmatrix}\right) = \det\left(\begin{bmatrix}\lambda\boldsymbol{I} &amp; -\boldsymbol{A} \\ -\boldsymbol{B} &amp; \lambda\boldsymbol{I} \end{bmatrix}\right) = \det(\lambda^2 \boldsymbol{I} - \boldsymbol{A}\boldsymbol{B})\end{equation}<br />
即$\lambda^2$是矩阵$\boldsymbol{A}\boldsymbol{B}$的特征值。这意味着上述分块矩阵的全体特征值都是实数，当且仅当$\boldsymbol{A}\boldsymbol{B}$的全体特征值非负。</p>
<p>直接对原矩阵进行迭代自然是可以的，但会比较浪费计算，我们可以利用它的反对角线结构来降低计算量。因为<br />
\begin{equation}<br />
\begin{bmatrix}\boldsymbol{0} &amp; \boldsymbol{Y} \\<br />
\boldsymbol{Z} &amp; \boldsymbol{0}\end{bmatrix}^3 = \begin{bmatrix}\boldsymbol{0} &amp; (\boldsymbol{Y}\boldsymbol{Z})\boldsymbol{Y} \\<br />
\boldsymbol{Z}(\boldsymbol{Y}\boldsymbol{Z}) &amp; \boldsymbol{0}\end{bmatrix},\quad<br />
\begin{bmatrix}\boldsymbol{0} &amp; \boldsymbol{Y} \\<br />
\boldsymbol{Z} &amp; \boldsymbol{0}\end{bmatrix}^5 = \begin{bmatrix}\boldsymbol{0} &amp; (\boldsymbol{Y}\boldsymbol{Z})^2\boldsymbol{Y} \\<br />
\boldsymbol{Z}(\boldsymbol{Y}\boldsymbol{Z})^2 &amp; \boldsymbol{0}\end{bmatrix} \\<br />
\end{equation}<br />
我们可以得到迭代<br />
\begin{gather}<br />
\boldsymbol{Y}<em t_1="t+1">{t+1} = (a</em>}\boldsymbol{I} + b_{t+1}\boldsymbol{Y<em t_1="t+1">t\boldsymbol{Z}_t + c</em>}(\boldsymbol{Y<em t_1="t+1">t\boldsymbol{Z}_t)^2)\boldsymbol{Y}_t \label{eq:r1} \\[6pt]<br />
\boldsymbol{Z}</em>} = \boldsymbol{Z<em t_1="t+1">t(a</em>}\boldsymbol{I} + b_{t+1}\boldsymbol{Y<em t_1="t+1">t\boldsymbol{Z}_t + c</em>}(\boldsymbol{Y<em t_1="t+1">t\boldsymbol{Z}_t)^2) \label{eq:r2}<br />
\end{gather}<br />
那么$\boldsymbol{Y}_t\to \boldsymbol{A}(\boldsymbol{B}\boldsymbol{A})^{-1/2},\boldsymbol{Z}_t\to \boldsymbol{B}(\boldsymbol{A}\boldsymbol{B})^{-1/2}$。特别地，将上面两式相乘可以得到$\boldsymbol{Y}_t\boldsymbol{Z}_t$的递归<br />
\begin{equation}\boldsymbol{Y}</em>}\boldsymbol{Z<em t_1="t+1">{t+1} = (a</em>}\boldsymbol{I} + b_{t+1}\boldsymbol{Y<em t_1="t+1">t\boldsymbol{Z}_t + c</em>}(\boldsymbol{Y}_t\boldsymbol{Z}_t)^2)^2\boldsymbol{Y}_t\boldsymbol{Z}_t\label{eq:r3}\end{equation</p>
<h2 id="_4">求平方根</h2>
<p>现在正式进入平方根的计算。由于假设了$\boldsymbol{P}$的特征值非负，我们总可以通过除以$\tr(\boldsymbol{P})$进一步将它的特征值压缩到$0\sim 1$之间，因此不失一般性，我们假设$\boldsymbol{P}$的特征值都在$[0,1]$内，这样就可以直接用Newton-Schulz迭代计算$\mcsgn$了。</p>
<p>将$\boldsymbol{A}=\boldsymbol{P},\boldsymbol{B}=\boldsymbol{I}$代入到式$\eqref{eq:core}$，可以得到<br />
\begin{equation}\mcsgn\left(\begin{bmatrix}\boldsymbol{0} &amp; \boldsymbol{P} \\ \boldsymbol{I} &amp; \boldsymbol{0}\end{bmatrix}\right)=\begin{bmatrix}\boldsymbol{0} &amp; \boldsymbol{P}^{1/2} \\ \boldsymbol{P}^{-1/2} &amp; \boldsymbol{0}\end{bmatrix}\end{equation}<br />
非常神奇，理论上通过只需要$\mcsgn$一次，就可以把平方根和逆平方根都求出来，也就是按照式$\eqref{eq:r1}$和$\eqref{eq:r2}$迭代，我们就可以同时完成两个任务！</p>
<p>然而，实际上没有这么理想。如果$\boldsymbol{P}$有非常接近于0的奇异值，那么$\boldsymbol{P}^{-1/2}$是会数值爆炸的（相当于出现了$1/\sqrt{0}$），但$\boldsymbol{P}^{1/2}$并不会，所以假设我们只关心$\boldsymbol{P}^{1/2}$的值，同时计算$\boldsymbol{P}^{1/2},\boldsymbol{P}^{-1/2}$反而会增加数值不稳定性。这时候更好的办法是通过式$\eqref{eq:r1}$和$\eqref{eq:r3}$来迭代，只计算$\boldsymbol{P}^{1/2}$：<br />
\begin{gather}<br />
\boldsymbol{Y}<em t_1="t+1">0 = \boldsymbol{P}, \quad \boldsymbol{Y}_0\boldsymbol{Z}_0 = \boldsymbol{P} \notag\\[6pt]<br />
\boldsymbol{Y}</em>} = (a_{t+1}\boldsymbol{I} + b_{t+1}\boldsymbol{Y<em t_1="t+1">t\boldsymbol{Z}_t + c</em>}(\boldsymbol{Y<em t_1="t+1">t\boldsymbol{Z}_t)^2)\boldsymbol{Y}_t \\[6pt]<br />
\boldsymbol{Y}</em>}\boldsymbol{Z<em t_1="t+1">{t+1} = (a</em>}\boldsymbol{I} + b_{t+1}\boldsymbol{Y<em t_1="t+1">t\boldsymbol{Z}_t + c</em>}(\boldsymbol{Y<em t_to_infty="t\to\infty">t\boldsymbol{Z}_t)^2)^2\boldsymbol{Y}_t\boldsymbol{Z}_t \\[6pt]<br />
\lim</em>\notag} \boldsymbol{Y}_t = \boldsymbol{P}^{1/2<br />
\end{gather}<br />
由于$\boldsymbol{Z}_t$的极限是$\boldsymbol{P}^{-1/2}$，所以$\boldsymbol{Y}_t\boldsymbol{Z}_t$的极限是$\boldsymbol{I}$，因此迭代$\boldsymbol{Y}_t\boldsymbol{Z}_t$更不容易出现数值风险。参考代码如下：</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">abc</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
    <span class="n">coefs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mf">8.287212018145622</span><span class="p">,</span> <span class="o">-</span><span class="mf">23.59588651909882</span><span class="p">,</span> <span class="mf">17.300387312530923</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">4.107059111542197</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.9478499167379084</span><span class="p">,</span> <span class="mf">0.54484310829266</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">3.9486908534822938</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.908902115962947</span><span class="p">,</span> <span class="mf">0.5518191394370131</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">3.3184196573706055</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.488488024314878</span><span class="p">,</span> <span class="mf">0.5100489401237208</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">2.3006520199548186</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.6689039845747518</span><span class="p">,</span> <span class="mf">0.4188073119525678</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">1.8913014077874002</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2679958271945908</span><span class="p">,</span> <span class="mf">0.37680408948524996</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">1.875</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.25</span><span class="p">,</span> <span class="mf">0.375</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">coefs</span><span class="p">[:</span><span class="n">steps</span><span class="p">]</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">steps</span> <span class="o">-</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">coefs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="k">yield</span> <span class="n">a</span> <span class="o">/</span> <span class="mf">1.01</span><span class="p">,</span> <span class="n">b</span> <span class="o">/</span> <span class="mf">1.01</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">c</span> <span class="o">/</span> <span class="mf">1.01</span><span class="o">**</span><span class="mi">5</span>

<span class="k">def</span><span class="w"> </span><span class="nf">msqrt</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">YZ</span> <span class="o">=</span> <span class="n">P</span> <span class="o">/</span> <span class="p">(</span><span class="n">t</span> <span class="o">:=</span> <span class="n">np</span><span class="o">.</span><span class="kp">trace</span><span class="p">(</span><span class="n">P</span><span class="p">))</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">eye</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="kp">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">abc</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">I</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">YZ</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">YZ</span> <span class="o">@</span> <span class="n">YZ</span>
        <span class="n">Y</span><span class="p">,</span> <span class="n">YZ</span> <span class="o">=</span> <span class="n">W</span> <span class="o">@</span> <span class="n">Y</span><span class="p">,</span> <span class="n">W</span> <span class="o">@</span> <span class="n">W</span> <span class="o">@</span> <span class="n">YZ</span>
    <span class="k">return</span> <span class="n">Y</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mf">0.5</span>

<span class="n">d</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">:=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">@</span> <span class="n">x</span><span class="o">.</span><span class="n">T</span>
<span class="n">np</span><span class="o">.</span><span class="kp">abs</span><span class="p">(</span><span class="n">msqrt</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="o">@</span> <span class="n">msqrt</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="o">-</span> <span class="n">P</span><span class="p">)</span><span class="o">.</span><span class="kp">mean</span><span class="p">()</span>  <span class="c1"># ~= 2e-4</span>
</code></pre></div>

<h2 id="_5">逆平方根</h2>
<p>如果我们必须要显式地求出逆平方根$\boldsymbol{P}^{-1/2}$，那么就没什么好办法了，该爆炸的始终都会爆炸，这时候不管是式$\eqref{eq:r2},\eqref{eq:r1}$组合还是式$\eqref{eq:r2},\eqref{eq:r3}$组合，效果都应该差不多，不过后者应该会相对稳定一点：<br />
\begin{gather}<br />
\boldsymbol{Z}<em t_1="t+1">0 = \boldsymbol{I}, \quad \boldsymbol{Y}_0\boldsymbol{Z}_0 = \boldsymbol{P} \notag\\[6pt]<br />
\boldsymbol{Z}</em>} = \boldsymbol{Z<em t_1="t+1">t(a</em>}\boldsymbol{I} + b_{t+1}\boldsymbol{Y<em t_1="t+1">t\boldsymbol{Z}_t + c</em>}(\boldsymbol{Y<em t_1="t+1">t\boldsymbol{Z}_t)^2)\label{eq:r2-rsqrt} \\[6pt]<br />
\boldsymbol{Y}</em>}\boldsymbol{Z<em t_1="t+1">{t+1} = (a</em>}\boldsymbol{I} + b_{t+1}\boldsymbol{Y<em t_1="t+1">t\boldsymbol{Z}_t + c</em>}(\boldsymbol{Y<em t_to_infty="t\to\infty">t\boldsymbol{Z}_t)^2)^2\boldsymbol{Y}_t\boldsymbol{Z}_t\label{eq:r3-rsqrt} \\[6pt]<br />
\lim</em>\notag} \boldsymbol{Z}_t = \boldsymbol{P}^{-1/2<br />
\end{gather}</p>
<p>参考代码如下：</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">mrsqrt</span><span class="p">(</span><span class="n">P</span><span class="o">,</span><span class="w"> </span><span class="n">steps</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span><span class="o">:</span>
<span class="w">    </span><span class="n">YZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">P</span><span class="p">))</span>
<span class="w">    </span><span class="n">Z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="o">,</span><span class="w"> </span><span class="n">b</span><span class="o">,</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">abc</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span><span class="o">:</span>
<span class="w">        </span><span class="n">W</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">YZ</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">YZ</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">YZ</span>
<span class="w">        </span><span class="n">Z</span><span class="o">,</span><span class="w"> </span><span class="n">YZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Z</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">W</span><span class="o">,</span><span class="w"> </span><span class="n">W</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">W</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">YZ</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Z</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">t</span><span class="o">**</span><span class="mf">0.5</span>

<span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span>
<span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">d</span><span class="o">,</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">d</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">x</span><span class="o">.</span><span class="n">T</span>
<span class="n">np</span><span class="o">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">mrsqrt</span><span class="p">(</span><span class="n">P</span><span class="p">)</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">mrsqrt</span><span class="p">(</span><span class="n">P</span><span class="p">)</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="w">  </span><span class="c1"># ~= 5e-4</span>
</code></pre></div>

<h2 id="_6">矩阵相乘</h2>
<p>不过在大多数时候，求$\boldsymbol{P}^{-1/2}$只是一个中间步骤，求完之后通常还要跟另一个矩阵做乘法。设矩阵$\boldsymbol{G}\in\mathbb{R}^{m\times n}$，我们需要计算$\boldsymbol{G}\boldsymbol{P}^{-1/2}$，如果我们能将$\boldsymbol{G}\boldsymbol{P}^{-1/2}$作为一个整体的迭代对象，那么相比单独求出$\boldsymbol{P}^{-1/2}$然后再执行矩阵乘法，往往有更好的数值稳定性。</p>
<p>让我们仔细观察式$\eqref{eq:r2-rsqrt}$和$\eqref{eq:r3-rsqrt}$，不难看出，当我们将$\boldsymbol{Y}<em t_1="t+1">t\boldsymbol{Z}_t$视为一个整体时，它的迭代式$\eqref{eq:r3-rsqrt}$其实是独立于$\boldsymbol{Z}_t$的，所以$\boldsymbol{Z}_t$的式$\eqref{eq:r2-rsqrt}$本质上就只是一个线性递归！我们在它左边乘以一个矩阵，并不改变迭代形式，只需要修改一下初始值，于是得到<br />
\begin{gather}<br />
\boldsymbol{Z}_0 = \boldsymbol{G}, \quad \boldsymbol{Y}_0\boldsymbol{Z}_0 = \boldsymbol{P} \notag\\[6pt]<br />
\boldsymbol{Z}</em>} = \boldsymbol{Z<em t_1="t+1">t(a</em>}\boldsymbol{I} + b_{t+1}\boldsymbol{Y<em t_1="t+1">t\boldsymbol{Z}_t + c</em>}(\boldsymbol{Y<em t_1="t+1">t\boldsymbol{Z}_t)^2) \label{eq:r2-final} \\[6pt]<br />
\boldsymbol{Y}</em>}\boldsymbol{Z<em t_1="t+1">{t+1} = (a</em>}\boldsymbol{I} + b_{t+1}\boldsymbol{Y<em t_1="t+1">t\boldsymbol{Z}_t + c</em>}(\boldsymbol{Y<em t_to_infty="t\to\infty">t\boldsymbol{Z}_t)^2)^2\boldsymbol{Y}_t\boldsymbol{Z}_t \label{eq:r3-final}\\[6pt]<br />
\lim</em>\notag} \boldsymbol{Z}_t = \boldsymbol{G}\boldsymbol{P}^{-1/2<br />
\end{gather}</p>
<p>参考代码：</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>

<span class="k">def</span><span class="w"> </span><span class="nf">matmul_mrsqrt</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
    <span class="n">YZ</span> <span class="o">=</span> <span class="n">P</span> <span class="o">/</span> <span class="p">(</span><span class="n">t</span> <span class="o">:=</span> <span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">P</span><span class="p">))</span>
    <span class="n">Z</span><span class="p">,</span> <span class="n">I</span> <span class="o">=</span> <span class="n">G</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">abc</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">I</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">YZ</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">YZ</span> <span class="o">@</span> <span class="n">YZ</span>
        <span class="n">Z</span><span class="p">,</span> <span class="n">YZ</span> <span class="o">=</span> <span class="n">Z</span> <span class="o">@</span> <span class="n">W</span><span class="p">,</span> <span class="n">W</span> <span class="o">@</span> <span class="n">W</span> <span class="o">@</span> <span class="n">YZ</span>
    <span class="k">return</span> <span class="n">Z</span> <span class="o">/</span> <span class="n">t</span><span class="o">**</span><span class="mf">0.5</span>

<span class="n">d</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">:=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">@</span> <span class="n">x</span><span class="o">.</span><span class="n">T</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">d</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span><span class="o">**</span><span class="mf">0.5</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">matmul_mrsqrt</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">X</span> <span class="o">@</span> <span class="n">sp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">sqrtm</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="o">-</span> <span class="n">G</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>  <span class="c1"># ~= 1e-4</span>
</code></pre></div>

<p>现在，让我们回过头来看求平方根的算法，不难看出它其实就是$\boldsymbol{G}=\boldsymbol{P}$时本节迭代的另一个等价写法，即$\boldsymbol{P}^{1/2}=\boldsymbol{P}\boldsymbol{P}^{-1/2}$。所以，虽然我们看上去式分开了三节来讨论了三个迭代，但它们本质上都是最后一个迭代的特例！</p>
<h2 id="_7">终极推广</h2>
<p>最后，我们还可以将它推广到$\boldsymbol{Q}^{-1/2}\boldsymbol{G}\boldsymbol{P}^{-1/2}$的计算，其中$\boldsymbol{Q}\in\mathbb{R}^{m\times m}$是另一个特征值非负的矩阵，结果如下：<br />
\begin{gather}<br />
\boldsymbol{G}<em t_1="t+1">0 = \boldsymbol{G}, \quad \boldsymbol{Q}_0 = \boldsymbol{Q},\quad \boldsymbol{P}_0 = \boldsymbol{P} \notag\\[6pt]<br />
\boldsymbol{G}</em>} = (a_{t+1}\boldsymbol{I} + b_{t+1}\boldsymbol{Q<em t_1="t+1">t + c</em>}\boldsymbol{Q<em t_1="t+1">t^2)\boldsymbol{G}_t(a</em>}\boldsymbol{I} + b_{t+1}\boldsymbol{P<em t_1="t+1">t + c</em>}\boldsymbol{P<em t_1="t+1">t^2) \\[6pt]<br />
\boldsymbol{Q}</em>} = (a_{t+1}\boldsymbol{I} + b_{t+1}\boldsymbol{Q<em t_1="t+1">t + c</em>}\boldsymbol{Q<em t_1="t+1">t^2)^2\boldsymbol{Q}_t \\[6pt]<br />
\boldsymbol{P}</em>} = (a_{t+1}\boldsymbol{I} + b_{t+1}\boldsymbol{P<em t_1="t+1">t + c</em>}\boldsymbol{P<em t_to_infty="t\to\infty">t^2)^2\boldsymbol{P}_t \\[6pt]<br />
\lim</em>\notag} \boldsymbol{G}_t = \boldsymbol{Q}^{-1/2}\boldsymbol{G}\boldsymbol{P}^{-1/2<br />
\end{gather}</p>
<p>参考代码：</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">mrsqrt_matmul_mrsqrt</span><span class="p">(</span><span class="n">Q</span><span class="o">,</span><span class="w"> </span><span class="n">G</span><span class="o">,</span><span class="w"> </span><span class="n">P</span><span class="o">,</span><span class="w"> </span><span class="n">steps</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span><span class="o">:</span>
<span class="w">    </span><span class="n">Q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Q</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">t1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">Q</span><span class="p">))</span>
<span class="w">    </span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">t2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">P</span><span class="p">))</span>
<span class="w">    </span><span class="n">I1</span><span class="o">,</span><span class="w"> </span><span class="n">I2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">Q</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">,</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="o">,</span><span class="w"> </span><span class="n">b</span><span class="o">,</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">abc</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span><span class="o">:</span>
<span class="w">        </span><span class="n">W1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">I1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Q</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Q</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">Q</span>
<span class="w">        </span><span class="n">W2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">I2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">P</span>
<span class="w">        </span><span class="n">G</span><span class="o">,</span><span class="w"> </span><span class="n">Q</span><span class="o">,</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">W1</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">G</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">W2</span><span class="o">,</span><span class="w"> </span><span class="n">W1</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">W1</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">Q</span><span class="o">,</span><span class="w"> </span><span class="n">W2</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">W2</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">P</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">G</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">t1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t2</span><span class="p">)</span><span class="w"> </span><span class="o">**</span><span class="mf">0.5</span>

<span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span>
<span class="n">Q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">d</span><span class="o">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">x</span><span class="o">.</span><span class="n">T</span>
<span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">d</span><span class="o">,</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">d</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">x</span><span class="o">.</span><span class="n">T</span>
<span class="n">G</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">d</span><span class="o">,</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">d</span><span class="o">**</span><span class="mf">0.5</span>
<span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mrsqrt_matmul_mrsqrt</span><span class="p">(</span><span class="n">Q</span><span class="o">,</span><span class="w"> </span><span class="n">G</span><span class="o">,</span><span class="w"> </span><span class="n">P</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">sqrtm</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">sp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">sqrtm</span><span class="p">(</span><span class="n">P</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">G</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="w">  </span><span class="c1"># ~= 2e-3</span>
</code></pre></div>

<p>请读者根据前几节的结果自行完成证明。</p>
<p>对于<a href="https://papers.cool/arxiv/1802.09568">Shampoo优化器</a>，我们需要求$\boldsymbol{Q}^{-1/4}\boldsymbol{G}\boldsymbol{P}^{-1/4}$，目前看来比较可行的方案是分别先求出$\boldsymbol{Q}^{1/2}$和$\boldsymbol{P}^{1/2}$，然后代入上述迭代中求$(\boldsymbol{Q}^{1/2})^{-1/2}\boldsymbol{G}(\boldsymbol{P}^{1/2})^{-1/2}$。看上去计算量比较大，但实际上在Optimizer的Update阶段，算力往往不是瓶颈，只要算法可以充分并行，那么时间并不会明显增加，刚好$\boldsymbol{Q}^{1/2}$和$\boldsymbol{P}^{1/2}$的计算可以并行，迭代过程中两个W1、W2也可以并行，因此应该还能接受。</p>
<p>当然，比Muon慢是肯定的，毕竟Shampoo复杂度增加了这么多，总不能一点代价都不用付出（后续见<a href="/archives/11175">《矩阵r次方根和逆r次方根的高效计算》</a>）。</p>
<h2 id="_8">文章小结</h2>
<p>本文提出了将矩阵的平方根和逆平方根转化为$\mcsgn$形式，利用它的Newton-Schulz迭代来实现高效计算的过程。</p>
<p><em><strong>转载到请包括本文地址：</strong><a href="https://spaces.ac.cn/archives/11158">https://spaces.ac.cn/archives/11158</a></em></p>
<p><em><strong>更详细的转载事宜请参考：</strong></em><a href="https://spaces.ac.cn/archives/6508#%E6%96%87%E7%AB%A0%E5%A6%82%E4%BD%95%E8%BD%AC%E8%BD%BD/%E5%BC%95%E7%94%A8" title="《科学空间FAQ》">《科学空间FAQ》</a></p>
<p><strong>如果您还有什么疑惑或建议，欢迎在下方评论区继续讨论。</strong></p>
<p><strong>如果您觉得本文还不错，欢迎分享/打赏本文。打赏并非要从中获得收益，而是希望知道科学空间获得了多少读者的真心关注。当然，如果你无视它，也不会影响你的阅读。再次表示欢迎和感谢！</strong></p>
<p>打赏</p>
<p><img alt="科学空间" src="https://spaces.ac.cn/usr/themes/geekg/payment/wx.png" /></p>
<p>微信打赏</p>
<p><img alt="科学空间" src="https://spaces.ac.cn/usr/themes/geekg/payment/zfb.png" /></p>
<p>支付宝打赏</p>
<p>因为网站后台对打赏并无记录，因此欢迎在打赏时候备注留言。你还可以<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=tN7d1drY3drrx8H0xcWa19vZ"><strong>点击这里</strong></a>或在下方评论区留言来告知你的建议或需求。</p>
<p><strong>如果您需要引用本文，请参考：</strong></p>
<p>苏剑林. (Jul. 19, 2025). 《矩阵平方根和逆平方根的高效计算 》[Blog post]. Retrieved from <a href="https://spaces.ac.cn/archives/11158">https://spaces.ac.cn/archives/11158</a></p>
<p>@online{kexuefm-11158,<br />
title={矩阵平方根和逆平方根的高效计算},<br />
author={苏剑林},<br />
year={2025},<br />
month={Jul},<br />
url={\url{https://spaces.ac.cn/archives/11158}},<br />
} </p>
<hr />
<h2 id="_9">公式推导与注释</h2>
<p>TODO: 添加详细的数学公式推导和注释</p>
        </div>

        <!-- Back to Home -->
        <div class="text-center mt-5 mb-4">
            <a href="../index.html" class="btn btn-outline-primary">
                <i class="fas fa-arrow-left"></i> 返回首页
            </a>
        </div>
    </article>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>
                博客来源: <a href="https://spaces.ac.cn" target="_blank">科学空间</a> |
                内容经过整理并添加详细数学推导
            </p>
            <p>
                Powered by <a href="https://pages.github.com/" target="_blank">GitHub Pages</a>
            </p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Syntax highlighting -->
    <script>hljs.highlightAll();</script>
</body>
</html>
