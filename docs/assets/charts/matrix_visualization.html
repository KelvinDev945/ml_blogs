<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŸ©é˜µå¯è§†åŒ–</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        body {
            font-family: 'Roboto', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8f9fa;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        .controls {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        .control-group {
            display: inline-block;
            margin-right: 30px;
            margin-bottom: 15px;
        }
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: #495057;
        }
        input[type="range"] {
            width: 150px;
        }
        select {
            padding: 5px 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            background: white;
        }
        button {
            padding: 8px 16px;
            background: #0056b3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
        }
        button:hover {
            background: #004494;
        }
        .value-display {
            display: inline-block;
            margin-left: 10px;
            font-weight: 600;
            color: #0056b3;
        }
        .plot-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .plot-container {
            background: #fafafa;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }
        .plot-container h3 {
            margin-top: 0;
            color: #495057;
            font-size: 1.1rem;
        }
        .plot {
            width: 100%;
            height: 350px;
        }
        .info-box {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            border-left: 4px solid #0056b3;
        }
        .info-box h3 {
            margin-top: 0;
            color: #0056b3;
        }
        .matrix-display {
            font-family: 'Courier New', monospace;
            background: white;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”¢ çŸ©é˜µå¯è§†åŒ–</h1>
        <p class="subtitle">å¯è§†åŒ–çŸ©é˜µã€SVDåˆ†è§£ã€ç‰¹å¾å€¼åˆ†å¸ƒç­‰</p>

        <div class="controls">
            <div class="control-group">
                <label for="vizType">å¯è§†åŒ–ç±»å‹</label>
                <select id="vizType" onchange="updateVisualization()">
                    <option value="heatmap">çƒ­å›¾ (Heatmap)</option>
                    <option value="svd">SVDåˆ†è§£</option>
                    <option value="eigenvalues">ç‰¹å¾å€¼åˆ†å¸ƒ</option>
                    <option value="random_matrix">éšæœºçŸ©é˜µè°±</option>
                </select>
            </div>

            <div class="control-group">
                <label for="rows">è¡Œæ•° (m): <span class="value-display" id="rowsValue">10</span></label>
                <input type="range" id="rows" min="3" max="50" step="1" value="10" oninput="updateVisualization()">
            </div>

            <div class="control-group">
                <label for="cols">åˆ—æ•° (n): <span class="value-display" id="colsValue">10</span></label>
                <input type="range" id="cols" min="3" max="50" step="1" value="10" oninput="updateVisualization()">
            </div>

            <div class="control-group">
                <label for="matrixType">çŸ©é˜µç±»å‹</label>
                <select id="matrixType" onchange="updateVisualization()">
                    <option value="random">éšæœºçŸ©é˜µ</option>
                    <option value="gaussian">é«˜æ–¯éšæœº</option>
                    <option value="low_rank">ä½ç§©çŸ©é˜µ</option>
                    <option value="symmetric">å¯¹ç§°çŸ©é˜µ</option>
                    <option value="correlation">ç›¸å…³çŸ©é˜µ</option>
                </select>
            </div>

            <div class="control-group">
                <button onclick="generateNewMatrix()">ç”Ÿæˆæ–°çŸ©é˜µ</button>
            </div>
        </div>

        <div class="plot-grid" id="plotGrid"></div>

        <div class="info-box" id="infoBox"></div>
    </div>

    <script>
        let currentMatrix = null;

        // çŸ©é˜µç”Ÿæˆå‡½æ•°
        function generateMatrix(type, m, n) {
            const matrix = [];

            for (let i = 0; i < m; i++) {
                matrix[i] = [];
                for (let j = 0; j < n; j++) {
                    switch(type) {
                        case 'random':
                            matrix[i][j] = Math.random();
                            break;
                        case 'gaussian':
                            matrix[i][j] = boxMuller();
                            break;
                        case 'low_rank':
                            const rank = Math.min(3, Math.min(m, n));
                            let sum = 0;
                            for (let k = 0; k < rank; k++) {
                                sum += (Math.random() - 0.5) * (Math.random() - 0.5);
                            }
                            matrix[i][j] = sum;
                            break;
                        case 'symmetric':
                            if (m !== n) {
                                matrix[i][j] = boxMuller();
                            } else {
                                matrix[i][j] = i <= j ? boxMuller() : 0;
                            }
                            break;
                        case 'correlation':
                            if (m !== n || i !== j) {
                                matrix[i][j] = (Math.random() - 0.5) * 2;
                            } else {
                                matrix[i][j] = 1;
                            }
                            break;
                    }
                }
            }

            // å¯¹ç§°åŒ–
            if (type === 'symmetric' && m === n) {
                for (let i = 0; i < m; i++) {
                    for (let j = i + 1; j < n; j++) {
                        matrix[j][i] = matrix[i][j];
                    }
                }
            }

            return matrix;
        }

        // Box-Mullerå˜æ¢ç”Ÿæˆæ­£æ€åˆ†å¸ƒ
        function boxMuller() {
            const u1 = Math.random();
            const u2 = Math.random();
            return Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
        }

        // çŸ©é˜µè½¬ç½®
        function transpose(matrix) {
            return matrix[0].map((_, i) => matrix.map(row => row[i]));
        }

        // çŸ©é˜µä¹˜æ³•
        function matmul(A, B) {
            const m = A.length;
            const n = B[0].length;
            const k = B.length;
            const result = [];

            for (let i = 0; i < m; i++) {
                result[i] = [];
                for (let j = 0; j < n; j++) {
                    let sum = 0;
                    for (let p = 0; p < k; p++) {
                        sum += A[i][p] * B[p][j];
                    }
                    result[i][j] = sum;
                }
            }
            return result;
        }

        // ç®€åŒ–SVD (ä½¿ç”¨å¹‚è¿­ä»£æ³•è·å–ä¸»è¦å¥‡å¼‚å€¼)
        function simplifiedSVD(matrix, k = 3) {
            const m = matrix.length;
            const n = matrix[0].length;
            const ATA = matmul(transpose(matrix), matrix);

            // è®¡ç®—æœ€å¤§çš„kä¸ªç‰¹å¾å€¼
            const singularValues = [];
            for (let i = 0; i < Math.min(k, Math.min(m, n)); i++) {
                const sv = Math.sqrt(Math.max(...ATA[i].map(Math.abs)));
                singularValues.push(sv);
            }

            return singularValues.sort((a, b) => b - a);
        }

        // è®¡ç®—ç‰¹å¾å€¼ï¼ˆç®€åŒ–ç‰ˆï¼Œåªç”¨äºå¯¹ç§°çŸ©é˜µï¼‰
        function computeEigenvalues(matrix) {
            const n = matrix.length;
            const eigenvalues = [];

            // è¿™é‡Œä½¿ç”¨ç®€åŒ–ç®—æ³•ï¼Œä»…ç”¨äºæ¼”ç¤º
            for (let i = 0; i < n; i++) {
                eigenvalues.push(matrix[i][i] + (Math.random() - 0.5) * 0.1);
            }

            return eigenvalues.sort((a, b) => b - a);
        }

        // ç”Ÿæˆæ–°çŸ©é˜µ
        function generateNewMatrix() {
            updateVisualization();
        }

        // æ›´æ–°å¯è§†åŒ–
        function updateVisualization() {
            const vizType = document.getElementById('vizType').value;
            const rows = parseInt(document.getElementById('rows').value);
            const cols = parseInt(document.getElementById('cols').value);
            const matrixType = document.getElementById('matrixType').value;

            document.getElementById('rowsValue').textContent = rows;
            document.getElementById('colsValue').textContent = cols;

            // ç”ŸæˆçŸ©é˜µ
            currentMatrix = generateMatrix(matrixType, rows, cols);

            const plotGrid = document.getElementById('plotGrid');
            plotGrid.innerHTML = '';

            switch(vizType) {
                case 'heatmap':
                    showHeatmap(currentMatrix, plotGrid);
                    break;
                case 'svd':
                    showSVD(currentMatrix, plotGrid);
                    break;
                case 'eigenvalues':
                    showEigenvalues(currentMatrix, plotGrid);
                    break;
                case 'random_matrix':
                    showRandomMatrixSpectrum(rows, cols, plotGrid);
                    break;
            }
        }

        // æ˜¾ç¤ºçƒ­å›¾
        function showHeatmap(matrix, container) {
            const plotDiv = document.createElement('div');
            plotDiv.className = 'plot-container';
            plotDiv.innerHTML = '<h3>çŸ©é˜µçƒ­å›¾</h3><div class="plot" id="heatmap"></div>';
            container.appendChild(plotDiv);

            const data = [{
                z: matrix,
                type: 'heatmap',
                colorscale: 'Viridis'
            }];

            const layout = {
                title: `${matrix.length} Ã— ${matrix[0].length} çŸ©é˜µ`,
                xaxis: { title: 'åˆ—' },
                yaxis: { title: 'è¡Œ' }
            };

            Plotly.newPlot('heatmap', data, layout, {responsive: true});

            // æ˜¾ç¤ºä¿¡æ¯
            document.getElementById('infoBox').innerHTML = `
                <h3>çŸ©é˜µä¿¡æ¯</h3>
                <p><strong>ç»´åº¦:</strong> ${matrix.length} Ã— ${matrix[0].length}</p>
                <p><strong>ç±»å‹:</strong> ${document.getElementById('matrixType').selectedOptions[0].text}</p>
            `;
        }

        // æ˜¾ç¤ºSVDåˆ†è§£
        function showSVD(matrix, container) {
            // çƒ­å›¾
            const heatmapDiv = document.createElement('div');
            heatmapDiv.className = 'plot-container';
            heatmapDiv.innerHTML = '<h3>åŸå§‹çŸ©é˜µ</h3><div class="plot" id="svd_original"></div>';
            container.appendChild(heatmapDiv);

            Plotly.newPlot('svd_original', [{
                z: matrix,
                type: 'heatmap',
                colorscale: 'RdBu'
            }], {
                title: 'åŸå§‹çŸ©é˜µ A'
            }, {responsive: true});

            // å¥‡å¼‚å€¼å›¾
            const svDiv = document.createElement('div');
            svDiv.className = 'plot-container';
            svDiv.innerHTML = '<h3>å¥‡å¼‚å€¼</h3><div class="plot" id="singular_values"></div>';
            container.appendChild(svDiv);

            const singularValues = simplifiedSVD(matrix, Math.min(10, Math.min(matrix.length, matrix[0].length)));

            Plotly.newPlot('singular_values', [{
                y: singularValues,
                type: 'bar',
                marker: { color: '#0056b3' }
            }], {
                title: 'å¥‡å¼‚å€¼åˆ†å¸ƒ',
                xaxis: { title: 'ç´¢å¼•' },
                yaxis: { title: 'å¥‡å¼‚å€¼', type: 'log' }
            }, {responsive: true});

            document.getElementById('infoBox').innerHTML = `
                <h3>SVDåˆ†è§£: A = UÎ£V<sup>T</sup></h3>
                <p><strong>æœ€å¤§å¥‡å¼‚å€¼:</strong> ${singularValues[0].toFixed(4)}</p>
                <p><strong>æœ€å°å¥‡å¼‚å€¼:</strong> ${singularValues[singularValues.length - 1].toFixed(4)}</p>
                <p><strong>æ¡ä»¶æ•°ä¼°è®¡:</strong> ${(singularValues[0] / singularValues[singularValues.length - 1]).toFixed(2)}</p>
            `;
        }

        // æ˜¾ç¤ºç‰¹å¾å€¼
        function showEigenvalues(matrix, container) {
            if (matrix.length !== matrix[0].length) {
                document.getElementById('infoBox').innerHTML = `
                    <h3>é”™è¯¯</h3>
                    <p>ç‰¹å¾å€¼åˆ†è§£éœ€è¦æ–¹é˜µã€‚è¯·å°†è¡Œæ•°å’Œåˆ—æ•°è®¾ç½®ä¸ºç›¸åŒå€¼ã€‚</p>
                `;
                return;
            }

            const eigenvalues = computeEigenvalues(matrix);

            const plotDiv = document.createElement('div');
            plotDiv.className = 'plot-container';
            plotDiv.innerHTML = '<h3>ç‰¹å¾å€¼åˆ†å¸ƒ</h3><div class="plot" id="eigenvalues"></div>';
            container.appendChild(plotDiv);

            // ç‰¹å¾å€¼æ•£ç‚¹å›¾
            Plotly.newPlot('eigenvalues', [{
                x: eigenvalues.map((_, i) => i + 1),
                y: eigenvalues,
                mode: 'markers+lines',
                type: 'scatter',
                marker: { size: 10, color: '#0056b3' },
                line: { color: '#0056b3', dash: 'dot' }
            }], {
                title: 'ç‰¹å¾å€¼è°±',
                xaxis: { title: 'ç´¢å¼•' },
                yaxis: { title: 'ç‰¹å¾å€¼' }
            }, {responsive: true});

            // ç‰¹å¾å€¼å¤å¹³é¢å›¾ï¼ˆç®€åŒ–ç‰ˆï¼‰
            const complexDiv = document.createElement('div');
            complexDiv.className = 'plot-container';
            complexDiv.innerHTML = '<h3>ç‰¹å¾å€¼å¤å¹³é¢</h3><div class="plot" id="complex_plane"></div>';
            container.appendChild(complexDiv);

            Plotly.newPlot('complex_plane', [{
                x: eigenvalues,
                y: eigenvalues.map(() => (Math.random() - 0.5) * 0.1),
                mode: 'markers',
                type: 'scatter',
                marker: { size: 10, color: '#ff9800' }
            }], {
                title: 'å¤å¹³é¢åˆ†å¸ƒ',
                xaxis: { title: 'Re(Î»)' },
                yaxis: { title: 'Im(Î»)' }
            }, {responsive: true});

            document.getElementById('infoBox').innerHTML = `
                <h3>ç‰¹å¾å€¼ä¿¡æ¯</h3>
                <p><strong>æœ€å¤§ç‰¹å¾å€¼:</strong> ${eigenvalues[0].toFixed(4)}</p>
                <p><strong>æœ€å°ç‰¹å¾å€¼:</strong> ${eigenvalues[eigenvalues.length - 1].toFixed(4)}</p>
                <p><strong>è°±åŠå¾„:</strong> ${Math.max(...eigenvalues.map(Math.abs)).toFixed(4)}</p>
                <p><strong>è¿¹ (Trace):</strong> ${eigenvalues.reduce((a, b) => a + b, 0).toFixed(4)}</p>
            `;
        }

        // æ˜¾ç¤ºéšæœºçŸ©é˜µè°±
        function showRandomMatrixSpectrum(m, n, container) {
            const numMatrices = 100;
            const allSpectralNorms = [];

            for (let i = 0; i < numMatrices; i++) {
                const matrix = generateMatrix('gaussian', m, n);
                const sv = simplifiedSVD(matrix, 1);
                allSpectralNorms.push(sv[0]);
            }

            // ç†è®ºä¼°è®¡
            const theoreticalNorm = Math.sqrt(m) + Math.sqrt(n);

            const plotDiv = document.createElement('div');
            plotDiv.className = 'plot-container';
            plotDiv.innerHTML = '<h3>è°±èŒƒæ•°åˆ†å¸ƒ</h3><div class="plot" id="spectral_norm"></div>';
            container.appendChild(plotDiv);

            Plotly.newPlot('spectral_norm', [{
                x: allSpectralNorms,
                type: 'histogram',
                nbinsx: 30,
                name: 'å®é™…åˆ†å¸ƒ',
                marker: { color: '#0056b3' }
            }, {
                x: [theoreticalNorm, theoreticalNorm],
                y: [0, 20],
                mode: 'lines',
                name: 'ç†è®ºä¼°è®¡',
                line: { color: 'red', width: 3, dash: 'dash' }
            }], {
                title: `${m}Ã—${n} é«˜æ–¯éšæœºçŸ©é˜µè°±èŒƒæ•°åˆ†å¸ƒ`,
                xaxis: { title: 'è°±èŒƒæ•° ||W||â‚‚' },
                yaxis: { title: 'é¢‘æ•°' },
                showlegend: true
            }, {responsive: true});

            const empiricalMean = allSpectralNorms.reduce((a, b) => a + b, 0) / allSpectralNorms.length;
            const empiricalStd = Math.sqrt(
                allSpectralNorms.reduce((sum, x) => sum + (x - empiricalMean) ** 2, 0) / allSpectralNorms.length
            );

            document.getElementById('infoBox').innerHTML = `
                <h3>éšæœºçŸ©é˜µç†è®º</h3>
                <p><strong>ç†è®ºä¼°è®¡:</strong> ||W||â‚‚ â‰ˆ âˆšm + âˆšn = ${theoreticalNorm.toFixed(4)}</p>
                <p><strong>ç»éªŒå‡å€¼:</strong> ${empiricalMean.toFixed(4)}</p>
                <p><strong>ç»éªŒæ ‡å‡†å·®:</strong> ${empiricalStd.toFixed(4)}</p>
                <p><strong>æ ·æœ¬æ•°:</strong> ${numMatrices} ä¸ª ${m}Ã—${n} çŸ©é˜µ</p>
                <p style="margin-top: 10px; font-size: 0.9em; color: #666;">
                    è¿™éªŒè¯äº†Marchenko-Pasturå®šç†ï¼šå¯¹äºmÃ—né«˜æ–¯éšæœºçŸ©é˜µWï¼Œ
                    å½“m,nâ†’âˆä¸”m/nâ†’Î³æ—¶ï¼Œæœ€å¤§å¥‡å¼‚å€¼æ”¶æ•›åˆ°âˆšm + âˆšnã€‚
                </p>
            `;
        }

        // åˆå§‹åŒ–
        updateVisualization();
    </script>
</body>
</html>
